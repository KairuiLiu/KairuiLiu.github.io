<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>LiuKairui&#39;s Blog</title>
  
  <subtitle>æ•´ç‚¹è–¯æ¡</subtitle>
  <link href="https://blog.liukairui.me/atom.xml" rel="self"/>
  
  <link href="https://blog.liukairui.me/"/>
  <updated>2023-03-02T16:00:01.000Z</updated>
  <id>https://blog.liukairui.me/</id>
  
  <author>
    <name>Liu Kairui</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>åª’ä½“å…ƒæ•°æ®ç›¸å…³æ–¹æ³•</title>
    <link href="https://blog.liukairui.me/article/%E5%AA%92%E4%BD%93%E5%85%83%E6%95%B0%E6%8D%AE%E7%9B%B8%E5%85%B3%E6%96%B9%E6%B3%95/"/>
    <id>https://blog.liukairui.me/article/%E5%AA%92%E4%BD%93%E5%85%83%E6%95%B0%E6%8D%AE%E7%9B%B8%E5%85%B3%E6%96%B9%E6%B3%95/</id>
    <published>2023-03-02T16:00:01.000Z</published>
    <updated>2023-03-02T16:00:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘ä¸€ç›´å¥½å¥‡ chrome /æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•è·å–åˆ°ç”¨æˆ·ç½‘ç«™æ­£åœ¨æ’­æ”¾çš„åª’ä½“ä¿¡æ¯(æ ‡é¢˜, ä½œè€…, æ’­æ”¾è¿›åº¦,ä¸“è¾‘å°é¢)å¹¶æä¾›ç±»ä¼¼ä¸Šä¸€é¦–ä¸‹ä¸€é¦– API çš„</p><p><img src="./åª’ä½“å…ƒæ•°æ®ç›¸å…³æ–¹æ³•/chrome_player.png" style="zoom:50%;" /></p><p><img src="./åª’ä½“å…ƒæ•°æ®ç›¸å…³æ–¹æ³•/macos.jpg" style="zoom: 25%;" /></p><p>æ›¾ç»æœ‰äº†è§£è¿‡ Linux ä¸ŠåŸºäº D-Bus çš„ <span class="exturl" data-url="aHR0cHM6Ly93aWtpLmFyY2hsaW51eC5vcmcvdGl0bGUvTVBSSVM=">mpris<i class="fa fa-external-link-alt"></i></span>åè®®å¤§æ¦‚å¯ä»¥çŒœåˆ°ç³»ç»Ÿå¯ä»¥é€šè¿‡ç±»ä¼¼çš„åè®®è·å–åˆ°æµè§ˆå™¨ä¸ŠæŠ¥çš„åª’ä½“ä¿¡æ¯,ä½†æ˜¯ä¸€ç›´ä¸æ˜ç™½æµè§ˆå™¨æ˜¯æ€ä¹ˆè·å–åˆ°ç½‘ç«™æ’­æ”¾çš„åª’ä½“ä¿¡æ¯çš„.</p><h2 id="video-æ ‡ç­¾ä¸Šçš„å…ƒæ•°æ®"><code>&lt;video&gt;</code>æ ‡ç­¾ä¸Šçš„å…ƒæ•°æ®</h2><p>è€ƒè™‘åˆ° <code>&lt;video&gt;</code> æœ‰ä¸€ä¸ª<code>onloadedmetadata</code> å›è°ƒ, æ„Ÿè§‰ <code>&lt;video&gt;</code>ä¸Šè‚¯å‘¢ä¸ªå­˜ç€è§†é¢‘çš„å…ƒæ•°æ®, äºæ˜¯è¯»å– <code>&lt;video&gt;</code> çš„å±æ€§,å‘ç°ä¸Šé¢<strong>åªæœ‰æ’­æ”¾è¿›åº¦, æ€»æ—¶é•¿, è§†é¢‘é•¿å®½</strong>è¿™å‡ ä¸ªä¿¡æ¯.è§†é¢‘çš„æ ‡é¢˜, ä½œè€…, ä¸“è¾‘åå¹¶æ²¡æœ‰</p><h2 id="ä»æ— éšœç¢è§’åº¦å…¥æ‰‹">ä»æ— éšœç¢è§’åº¦å…¥æ‰‹</h2><p>å¯¹äºè§†è§‰éšœç¢ç”¨æˆ·,ç½‘ç«™åœ¨æ’­æ”¾è§†é¢‘çš„æ—¶å€™ä¸€å®šåšäº†ç‰¹æ®Šç…§é¡¾(ä¾‹å¦‚åªå±•ç¤ºå°é¢, è‡ªåŠ¨æœ—è¯»å­—å¹•) åœ¨MDN ä¸Šæ‰¾åˆ°äº† <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvQVBJL1dlYlZUVF9BUEk=">WebVTT<i class="fa fa-external-link-alt"></i></span>è¯¥æ–‡ä»¶<strong>æ ‡è¯†äº†åª’ä½“æ ‡é¢˜,</strong> ä½†æ˜¯è¿™ä¼¼ä¹å¹¶ä¸æ˜¯ä¸€å¥—å¼ºåˆ¶æ ‡å‡†,å¾ˆå¤šç½‘ç«™éƒ½æ²¡æœ‰ä½¿ç”¨</p><h2 id="ä»-api-è§’åº¦å…¥æ‰‹">ä» API è§’åº¦å…¥æ‰‹</h2><p>æˆ‘ä»¬åªæ˜¯æƒ³çŸ¥é“ JS ä¸ŠæŠ¥åª’ä½“ä¿¡æ¯çš„åè®®åå­—æ˜¯ä»€ä¹ˆ,äºæ˜¯æˆ‘å°è¯•çˆ¬å–åŒ…å«è§†é¢‘å…ƒä¿¡æ¯çš„è¯·æ±‚æŠ¥æ–‡, å¦‚æœä¸€ä¸ªåŒ…é‡Œé¢åªæœ‰åª’ä½“å…ƒæ•°æ®,è€Œè¿™ä¸ª API åˆæ˜¯æœ‰è¯­ä¹‰çš„(ä¾‹å¦‚<code>example.com/api/video/xxx-api/</code>) é‚£ä¹ˆå¤§æ¦‚èƒ½çŒœåˆ°å­˜åœ¨ä¸€ä¸ª<code>xxx</code> åè®®ç”¨äºæè¿°å…ƒæ•°æ®. ä½†æ˜¯æ²¡æœ‰æ”¶è·</p><h2 id="ä»-chromium-è®¾è®¡æ–‡æ¡£å…¥æ‰‹">ä» Chromium è®¾è®¡æ–‡æ¡£å…¥æ‰‹</h2><p>æ—¢ç„¶æ˜¯ Chromium çš„åŠŸèƒ½, Chromium ä¸€å®šä¼šæœ‰å…³äºè¿™æ–¹é¢çš„ä»‹ç». åœ¨ <ahref="chromium.org/developers/design-documents/">Chromiumé¡¹ç›®çš„å¼€å‘è€…è®¾è®¡æ–‡æ¡£ç´¢å¼•</a> æœç´¢ <code>media</code>(å› ä¸ºè§†é¢‘éŸ³é¢‘éƒ½å¯ä»¥è¢«æ£€æµ‹, æ‰€ä»¥ä¸èƒ½æœç´¢ <code>video</code> /<code>audio</code>) æ‰¾åˆ° <span class="exturl" data-url="aHR0cHM6Ly93d3cuY2hyb21pdW0ub3JnL2RldmVsb3BlcnMvZGVzaWduLWRvY3VtZW50cy9leHRlbnNpb25zL3Byb3Bvc2VkLWNoYW5nZXMvYXBpcy11bmRlci1kZXZlbG9wbWVudC9tZWRpYS1nYWxsZXJ5Lw==">MediaGallery<i class="fa fa-external-link-alt"></i></span>è¿™ä¸ª feature, åœ¨ä»‹ç»ä¸­å¯ä»¥çœ‹åˆ°</p><blockquote><p>Overview Media and metadata access API. ...</p></blockquote><p>åœ¨ MDN ä¸Šä»¥ <code>Media and metadata access API</code>ä¸ºå…³é”®å­—å°±å¯ä»¥æ‰¾åˆ° <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL01lZGlhTWV0YWRhdGE=">MediaMetadata<i class="fa fa-external-link-alt"></i></span>è¿™ä¸ª API.</p><p>è¿™å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿, ä»–åŒ…å«äº†: æ ‡é¢˜, è‰ºæœ¯å®¶, ç»„, åˆ›å»ºè€…, ä¸“è¾‘å,åª’ä½“ç›¸å…³çš„å›¾ç‰‡(ä¸€èˆ¬æ˜¯ä¸“è¾‘å°é¢)æ•°ç»„</p><p>ä¸€ä¸‹æ˜¯ä¸€ä¸ª metadate æ ·ä¾‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">navigator<span class="token punctuation">.</span>mediaSession<span class="token punctuation">.</span>metadata <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaMetadata</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"Unforgettable"</span><span class="token punctuation">,</span>  <span class="token literal-property property">artist</span><span class="token operator">:</span> <span class="token string">"Nat King Cole"</span><span class="token punctuation">,</span>  <span class="token literal-property property">album</span><span class="token operator">:</span> <span class="token string">"The Ultimate Collection (Remastered)"</span><span class="token punctuation">,</span>  <span class="token literal-property property">artwork</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">&#123;</span>      <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">"https://dummyimage.com/96x96"</span><span class="token punctuation">,</span>      <span class="token literal-property property">sizes</span><span class="token operator">:</span> <span class="token string">"96x96"</span><span class="token punctuation">,</span>      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"image/png"</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span>      <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">"https://dummyimage.com/128x128"</span><span class="token punctuation">,</span>      <span class="token literal-property property">sizes</span><span class="token operator">:</span> <span class="token string">"128x128"</span><span class="token punctuation">,</span>      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"image/png"</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span>      <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">"https://dummyimage.com/192x192"</span><span class="token punctuation">,</span>      <span class="token literal-property property">sizes</span><span class="token operator">:</span> <span class="token string">"192x192"</span><span class="token punctuation">,</span>      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"image/png"</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span>      <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">"https://dummyimage.com/256x256"</span><span class="token punctuation">,</span>      <span class="token literal-property property">sizes</span><span class="token operator">:</span> <span class="token string">"256x256"</span><span class="token punctuation">,</span>      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"image/png"</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span>      <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">"https://dummyimage.com/384x384"</span><span class="token punctuation">,</span>      <span class="token literal-property property">sizes</span><span class="token operator">:</span> <span class="token string">"384x384"</span><span class="token punctuation">,</span>      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"image/png"</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span>      <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">"https://dummyimage.com/512x512"</span><span class="token punctuation">,</span>      <span class="token literal-property property">sizes</span><span class="token operator">:</span> <span class="token string">"512x512"</span><span class="token punctuation">,</span>      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"image/png"</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ›´å¤šåŠŸèƒ½">æ›´å¤šåŠŸèƒ½</h2><p>mediaSession è¿˜å¯ä»¥æ§åˆ¶æ’­æ”¾ä½ç½®, åˆ‡æ¢éŸ³è½¨, æŒ‚æ–­ç”µè¯, åˆ‡æ¢éº¦å…‹é£,å¼€å¯æ‘„åƒå¤´</p><p>å‚è€ƒ: https://web.dev/media-session/</p>]]></content>
    
    
    <summary type="html">ä¸€äº›ä¸åª’ä½“å…ƒä¿¡æ¯ç›¸å…³çš„ BOM API</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="JS" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/JS/"/>
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="JS" scheme="https://blog.liukairui.me/tags/JS/"/>
    
  </entry>
  
  <entry>
    <title>å‰ç«¯æ€§èƒ½ä¼˜åŒ–æ€»ç»“</title>
    <link href="https://blog.liukairui.me/article/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%80%BB%E7%BB%93/"/>
    <id>https://blog.liukairui.me/article/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%80%BB%E7%BB%93/</id>
    <published>2023-02-22T16:00:01.000Z</published>
    <updated>2023-02-22T16:00:01.000Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">  <script id="hbeData" type="hbeData" data-hmacdigest="dac89393a69d8fb57fe30bea45cfb905bd1968127d73b296a836496ad269e0f8">704ff6397c7b272062858255de77aee2f255e0c04c07e5e7e4724836cd9e81098987f7769ac2be87ffd352c8eb5715eb4815489b55b4907a60fbd76989d3fed9d9fae6903ee85bdfb6d16bbe80e841760fbb4293458e2d7d74a62ecd5fe6572fbed7b7d944496cc7b2c06c47d7765f5e69813cdb456feb79b0383ed7c69ef7bd06205b229e851ace68f1654e6bcbc6639f38fc83acf013ecd823d39884abdc8e7ffd8f3ec0509ec2ba1276a6b2c35f20d8849cba166abefc3231289848be925d9e54b7a6da6f60efa9587617c9699d7e25ba8fdec42d90fb10ccaf9149df1a48e90de3f500821e761e99470eeb920e76d81c539891076e7b7b5beb66c377f73b3121b8bca8b4274c0eea34b32fe0fa5c8c65f67c83b64a1ca475454c15f3c4c4344b9f0e97ec4baf61a41b463f4693508ea1ac26944992a60adb2f6f0d2ef8a182fda12bdff36135a7eff1c5f976259a72ed60ab4aff9b6acdab22a1f8feb98f209b6da5a37da994df12f5d5236a5002a9e8878aef07b11f2491581fd1df717a41f8bfd1e7a2e59b96eea7cf15067baebe74f964fb9f5d56a69e5c3c78f086555559ba0e72aafc92fd0b6edddc199c1af9bfc82b49d12144bbbf954f1f767ad96348a3cc7b5e605f8efc7999f8bec1aa315ae363bc7395826a741ca02847e81435161cf750c523d5a8ef35d774c2054c1f12ffbdf13b72013d73a6ad65c79a23e51c14476adfb2990b027645785e0c15305d9c0c2c0dde96f1f467c9c4284e213cbeec38a649e21417c33fcd174485c17e5222421bfeba7b37388a86b7e656e5cb2be8801046bc7f1b2f9d5a7b9315041872a1eb5c6f073ea80c41e054dcd90f96b1d678790ff0da4de22ff2ce13f72cdb8012fde575a3756d6c70d8ba0f5a1fe4f13d399cf1d3a418f81281e89d45059ab63f0e901c9af941b34f0d1f2e52fc532b9232578f7b171dee0d634c95e4f9d7ad017413b2a8f59b77210d2b7a6c5757e3aec497e1d22821460690352a67348c49df0ea28bc0bf695154cb8cf5b35560ecb974d84f48943c17d6a484603aaa18cc3f2d597c9de33e3831dfdd3c7c45fe165c2feaa607b39c91ec8791e8a99a09ce779387157abcf98861d4291808d89dbb733905b6973ab42e485b313215406bc96bd8f7d82734bcd9071a9a2c4b9a5df207b0c12808af43085a14662a3acc4b269a2369acb4c4c6feee6374c039ef8f81bf91a07fe760024c49a3e69bd1e3ce216b5ed8df317044c54ff26990dcd5747d242c8f49937d3e86cc7aadf6b28c369c2f5c8ea553430847b2bf58d7a05321a62bfea08c09c3a0bff19d2b5e6521482c831c922a92da04328d88a5c44a160ffcd041f5b1fc3661ac7784edd5c1a6135c412347dc8b64da17c594a774534d3171a4fd583f3fdf1fb7620f0da3d72a46191a478bdabbb67d548481b478870e7e8c74d1f66e46034229f9abe65c46d0fd0949deaf37aac7cfb1b098d12358d642b35cb31ff45fc8298f5ec42ff5bea6cbdd648b21f413a4d6de402f4383efdd406b6fa8d0fdbb3128d8ba9e40829d1a0696d996e634aef38fa90e46ae7b0ee01e2f7f8ea82892d58774971be3c2aa6f4050f5124dcb6e186b4d73975171254e0bcfa3c58c1e1b14844f4f74977baf874dfdea09f037e8a219d80d051a138796f48e2f78868b19013c97413686cfd63aea7c921c86bf47426bf5098741f5a867011478e82271ef2f549f4ae57749146e42d375f433575fb6370c5b9c20e19e131af9aaba0d6b1c98b5deb113b78b7d839ac794f4480f130cfa4c9bdba179c15df42fce818b894f1953899fbb0aecfd3a157e2125e534f7945c0f6a3cadaa4a09d04477afc8aef74f7e36a89d1e63d0a278ff65111705af167ddcd61b67d8a483e0286e99c5fce8f5192ff78765e3aef89d4fc2460c5fa345b1a469f7f53ee33780d845d1a9b1acd766fff5f430fca78ccf60cc1d3561d50de1f1e63964fbcc546059c9ab952c5720512f0112ffabaa7dd9ec40714d7c3beef9a995c46ad4765026acf1dcfb5332fcbf4e98f5e67ccea88bcd9b10adf6ce1c6d913e31db03e3783fae1ba5e9f05eabebc80fa52065978cf1ac9815a85dedf99c0730a966343f65375b47a6f4087a3610f9dde6c20670e0b380c8818b76d595247a69c016e6ce75b00e4acf36c93d66624e35691bc925e0ab8c2a583e573e3372accc6587b2406390aa55f45770cf7586d9e36ac2b9b03e9fa1fffae457bfd772150ee3b08a05e1b87e3dc938d375ad79d957232a4920735787099df8505a201ddd4a6de81e2f40f09314cdad69d65fb0a61b30a981413386b9f2ebd5e52f0f6df76b95ae703a295c5d07fda950f1d55c6dc3e7c970318b392c8079bc74927205d4cb3c7ba1826469ec7a8131f918ad7aa47b7fb90dc7c89c4a467232f5cfc5520e6a1e88ba8c8d652e43b5565ebe5a408f02f5529e3602d70cdd88f685f47e8ae7b535033f194df983af61ac927a029964cd18cfe394521a4da340d2460fc573ec0df773fbe192fa0874cf65cf8e2584f241bf2e56e2367339a5599d12b0898fe9fcfa072b25913bdc2cd1424fdd34962606d6b4f4384614170275ca658a2b1bd738d3fd4918430071e891580bad22f0428efc8cb53d80e82c90b5c6d9819269d6fefc1658fcd804422b4142732ca0cca35d493be0c3652ef9d59b195e737514513efaefbd8c282fe32780ef5c661e2caac16c500f012d588267f7c3ba8bbbc8cf501cedaf9d6dc3d48446c681892ca9eb1db8d16730629544e592e4c95af24b27b43f3a428c85080d0d16ae5470f1ca06761d2c54b5dcc5c97559e8a6ca9de4bbb2f012ece03f2fa585aef584a44a75ff8e276584548b3259908f46474c5b273b28c027dd36d28171848875ece5f0e0674ffca2e36d25835409ca42f08da4a39d8f2a308f4eb1a70a8a8a3759d90fde75bf929482b0a415290f5794664dbdd38357f2f5feec36492fe203b07513ce67cab152994a0cecc7d9ca4e5059defad2ee109b6abb939c49db05d1327cf7d505c867cd0b23780eee23290a34bdc5f0d2da78aa94d3775f1a0c7ad1bdd3ac02a55ef3b62d3865713f1520b01e45994629e17492189658a69abc62599a9662d5a06c79899c7bd87757c21283181ad343416594bfb215085ea04ece8788923734f89475e334dd8dbecc727159efd305e578bfe6c251b53168e6228e88c2ac2e2929918ac1d9e3f6af3fa6ab55952884ec3156896a197a9d91f896379e50bd79287e441333638d66bffb4e701515baef072d8c557d334c94ec0871abf139fb139af7bab6694ea20f26b2ef7cdd5a8d9fd2f30eb971e4975064dfad85bf9ecb24871daff2fe1cb9790e77646e90881fac468a1f51093a7bb48f8449cd3dded4b4f6b4238fde64587e0cf4eb8d77934a17e982cd068898ca5747eef1370d98c590c28781fbf91ac52cf1ad11624599e595adb006ba5b0d6953660c0a42cfec4affad40342b7792517f9af8b813ac72b487600df4df757dba7a4a468600f3cecedb9f1684562e4d3053b61e72f50d297c32225792568210eaf5cd5a06876836052c9c3a75f96d8e9017b4d6a7a31f65ceb8f29e635f20f76df052f0d45217db4c84d5b943eb23481f107059879fce2280cb851755221c6ba051c316b6ae1e6eb78715843a9e797c3776661599f8826a551290b944f74667c29ca06c9d97f5c094377f3e46aa31237a938345bac6c6a4f354d0c886258262104b0fc381a03475490756776064abd41d39744b7ddb6f0eebdede0b3d8bd9e99863acd408333cfef11f2baa28233793baf1d00a107199246304f9a19456fa1de917d4f566b25eb9fccec54ee313ca1b129a1f197c1cce2836a410703c2c71c6774af441d4b577c9d4bd48099fe809c0ccf86302b3a059253ef5892151724e9576363ce064f072e3d5f3c64bbc6631750d28868c9b8cbc2c172bfb4c7d56ae2a7052e29ab322c6f111d210691203d0779f25679dc5022011f76d4e8825680bc62e8639b1005bb6d8aa39471504a336d3e5676479eb5c9ab3765322d16e81708eb27a1adf198c1f8a485f0b2699e676ff00f6b75ad6f1d30c409be0921b9811bab1a14617935368a3e8c21f1c955a6cc6c90317e0452b03901c6fece666c22960f661457d1541a27435790ec828b7f53c00672803b8cce4175acdb4fa6ea7dc5305ddb51df173349642a1d31d6e36cc50c7f06844adb6ad38b5a4e82b959956d0c102080e304af8f33f88690d5ec028f0f91c8782a227ccbab3a11d95847d54c28f84c562420c7d462fac749c4493905e033fba2fa7808124ed6a983d8eb31a8e9b6506d8daf2bd92129544af42266b4663604325e37ae4ff71755ff69688443c304d4edf250c34b325f7fb702ab4d38abcd62ade714ee1cb02c89d5b9df6644bfb3910b204c11c66752fa751b6f2021e617152080432457b66651b20a1356b946e5c1fb1ba03cf6f02d1e69dbf256827bb8d82aceaa5808d2a4efea6abcb39090110004d923485424624cc2193dfbc3d2e213582e6c1373d69352900abef98e9ec2e43df03c0a8a7cbaa0bcc84587dbf7f84848828e1a647b3cb100220c3242ed4ed21fa2608a840d3b50240297b17b208b2c62383fb844c16fcb29bacadcd408be833f31d2d710d141d5f3f1c32a98235ad58fe0824229865bf433638a82a36f906c184e43568a671593ffe14042e65e59aab0329ff67c4deb024fe275b24abb5c35023bc0664f051b63e5ebd61f960749ecfb683ad3b0893bbbfc773d3b470d084a244e6ae17c47beb6991b2fa6bb25cae9113146496e0ba8c9a288724c462d692793f502a2b742f37b194145d9f4410b94aa4b4892789992f38726925efadc174a8c5555eff96b4479ae93b19eefe01ecf3ba28ebb977f8679dfebc4449b6e60534b3ea986cf4bf6515f9ddd506e76a4c8019cb09e7330a6467c29f88569d6a5e3fa09e55b1375c877e682a2a0b188ef3ae449082c028564bcd7b2e4ffff6c6ad6ce6bc15ebdebff4610e7b169ed6b815459b1a3a510516ffb2096defdce6786df5c76e4a3d135f01a959a4b4dc970127b7eb76d51e8d6b548bb5fd3e74bc430732c14e107ae0d81eb4bb253abbcdeddd3cce790dcf6ffa24c3f9f74c4515e6dd4fc69441e092c4978882edac02d3a9121b02e74408de9d5bf77abbf6a0a27910ee863de7fa77fa9b09d465d31da1d588fb02dfa5f2f1a36f6d56552dd401d3750fc8f97f8fbf4635b46c10116e727dad813b18bdeaa1e8cb3bce1f8e54f01200ebf7ebd8be98358b1a61d6bd775470df60770a7f8c7d3786f34a29d417ba1e0f0bae6b943ef6e005c0139370029f179923c49bd534cb05e6f87e543f1e774de167051e47d830822dd51aefdb4d8845214f73737756304b1defbab633acb4ffad24f2b570cb2667b7c9ee8620503bba94e56b59e074aca39fdee2992a153cdb5afee0e335c081ff4271b2f0e75d36f9f34755bf4ddf2bbf647899acfb49a1400146f21e89c716c26f20e54b4f23e14888d38f1319b981e1416504f025edfcff168df65550fe68a189f78db0ff63d4b75ee4c00f98115e54a7d3d982e74fb3473e010d774fc95039201e1f5fcbee83785489bda32c3cd7f0dc4a18a5329cc447345762bad914ff1a8ffea38720d26790ebdeb079fefec7be475db77241256edf5c4a0237dfe5b01edf9c58c5dfa4e60c523138e79dda2a3103f3dc7570e4b81275016410f5fd7957d242c4c7155d95eb26144a8da0d8a357bf9e1ab96717097b183331720699172db0924aa5a565c9dd89c8f02ce04083972f85cd77b30b69889d08cd35d6330af6634afa8f06ea4a3ef5180036e109a1960603bbd70e62abadf3f9d316d0cc1c51e25ed52c4e68384a80061e5cc6982b3ed12e4c495d6f08f50bd7bf61e404cd0a4c5be12ab795e7f7fcc2e67f72e8d31df08fb1cb4b814db51b808a1516ae1d12d403339102f0e88605b5f0552398d00ed804976a192aeef8bb55b483f660ea5267a62fa819274d1d6c06242d8e276f5482e383d90a0a2f86b524962b35d1fa8c5d842df6683616d64ff70c90f606017aa93bd3cb96b8cfa2a75aa8b079fa64d6978fab86cc03392d19c782895b861a99a1d069d072100994041eac65c28c327f88742d71128fa41be03ad6734b5faf0beaab465f1b30e7571b482d04aaa826d4fd6f9adf120b90354e909372f243b6fc33106a00027f09440fd212eef58ef628d04cf5525f596dc772c82abfeb3a6c58d0e38a7684d0c7e4643bea8a1391a9d74f341f34859f382a96aca1d486784f5427b5fe64be55235698d764ad127f38b42e112ddeb6163af520ee45dfda1ec50d2dadfbb86e86704411052f5b9e57c799e6270a51be1b7f718c22c770f611b38751c13ffb96cb1fdbaa53d1f687c7ff8e89903a3269d5dffd3f4de82025c039aad56b2b4401254a0773043360ac5030ec6fdf3b3b7e3e6ae8c8634a1f669df5c496b904ca0b45ace62a0db307cf2a7a9078267697886e6635db7f806e9c28bd9b76df82be07ac37a6cc95436b9937576820d2099d1351bc99877cb274c47d7a05c0cf1fc2400a59932dbd909e223dcd4b737c7f5a9798ab5caef4d79172268af4aeebc4fdca178648905cc69a239487ac3a1ea98e09e58038208b5346e51ecca3ca2cdbf167e00281698357030825212fc828b4611fe432a195d9a9eca25d6789b80851534a88e667d0f706d226592c8254248a9e85f6a6101bdc3fb396d7e39d17c45384d323c64e74140ebccc40634101b55c40b99336ce0f425c36db9678e32b3b16456fccd010617a9211f5fa060e65724348299dde134ad73a4c561d5a0733dba1963be0f2b77f9166492a6c74919e824aa0bd0adac456593fb5f6b238edcd33faa13308b9efcacbc2e81a622180edb74b35bc9401bae109b6dc51a00038bb12398fce226419e1a93cf5c1d7517062a1fe6428a462d98ac4712584657d4714022eca81d41264b5f7bfaebb8d17111f9264a5d3e680241ef933dfcc44f4b5d9db0d11db72fbd0e95d5063210dc82ba31c5d0446b664a4218b148c35a43745d290e12d279fafeb5db3591fce184c34708fd2c964d594baefaadb649d689e3f4b86bafb91a71d6e66cd0adaf771d5f81855a4a6a51b9d691d9d8bcf333fe4037382e59adabb47a771d848285057132b37ead555f91017c27cc4c34fdfa9f4894b48de7319384c2fd6f2cafbdee6ab902a071cac956e3b64045ea08dd6e70c87a5420fca8830399606ac753c422a04d87712ee1866d5d47e3c8e69b8345df4e66b268a0b33b9f955724939d0f9f925a9b2a67ca540aa512e65c75178360d682fe248326de242c6a0158a7c2f5c918e1f67cc5ff82884b3354ba47786e8fc090ac9e0117d2876fb0d26e3299557a15a77fbb10792d0f98b3f51de807a615b4e5a59db3e9da739d1d3bb1b6ebcffdc42da3337bd5f24e1a0b9b611180ca9c77839e968c240bde044808fea2c3f028d2284eed1a2472ebfc937e28951f56edc1715cbbf56128728bb185f9c6a61cac0454718108266244c4ef82a21d2046b616014e20c5a3e26a3dba5b314d4ee468dfa015ecff9d3a6e971f09d056561abf39363650d1a3fc16d8731aa273aa7bc35d97549302d1f9f4c970f1b2257858e7d8a4c0f5ad533032981e98fbbee434f18cd852b50d6568176ed28b6169d030b57c028682b3f7124017a38407e29deb99b7d386f937236c381ac1e857e457482017636e27d269cf83a7947c047a261cdd247aea3132811c5c13ba21c3ffca806b000b95ee66dde6c79aae11a57a254817ead9c3e7236225490295fd450c6457d3244c5834f3c4020d953656c9187c871be179806587b7392b9e57fff5f40655737ebf5934f5fcc7b70279b853a609f473bd923f7fad8bdbd89a6107de14b9b246c158b114bcfc1858ce90553a60446d4f878ff714e33ddec10eca3e376898a002ac81f949ede7d8306a1c951c185bfcfd209bf89a71e44101cd5665afa1678f01f5928c9ed38b4494b4da6bd34cec48911d87293cb6e5e3dea53f0999bc94c808c6b7074d757ad7c893fc630b6bfd3973775e7a286eb402de72b9ad1fb26bbdd0a3bce038946ea33e1f6db2c07c7e0cbc8a2af0ddb2cb7ae082a4726b00946f2d30102d35c2b839fafa7bee0a7de9e76ac605a489a53409ea70cd1c3d1efedf8e38337e5749896477c2d4add2fbdf8caf26bed7c56182c59fbdb191b600f9957dc76aebcbe1674d3500ea41046a2ddcc00b4e30c38bf93c892bcab752794380733a025a33244f6fd8edbe2295256e00b5bdc9b12e31ff3cbfc1db7c6e7d3bae07e36960d9e19b4f658361b48ae71b6810c2c895a8514209f6c581c6cc6eef47e2b9a9a50916a63cad22dcc33a029ed88954134e19f907900b1178650809fd03baa2c25f3f5223609027e0b094ac758a25f4886fb5958c0298d10fed02037b7ef6dcded0d9f13f732d93379dce59d7b9fae1f4efc5e2e0d3d9439562fde8eab070c4a1a28caeee66e6ebcc9c0428626091d404bb8c9eccf6c1c4e209e84525b48f9196a408baeb334da9a12cac3796ef4737e6c0197ee977756262c44ee94094721c5c181ea7e6234533318051243602ef4729f4c90ce5e8596d32ad2ae0d92e86414dea8a5e3930b40932d768ccec84b98fe65bfe1d95a74780aa7e9748c16d321dca75b66364a68736c8658d2e16c713cddc51e9a5b97450a19da606f921836eaff0d105f5bf5c511c200c6f78b727b0ff0202c71155e89d2faa6dacf1f0ee5652aea1933a267eb18970b1ddff41a9231b174fd7977143f08eaec9a30ed0db2ff0c3e4ff787a589c5901972c4254c74897b0fa4e407eb0db48db8361d4514d2a51c7dfce0a84f70c0e351bdae12c264e9e8b1824250e3bf8c4ac7a6207f4bb3408e9b13af23b4ada1d645ac0667bd85fa58d8b5553443fb890c4f8ed17ae742451ecd3a91dafb96b38126bd5e4a1e4662d25c768b2b63a07eeb7572ff80d4eedf2cd643c35d2fa17ecb0a793ba18453c3791be9e355cde2bbaf96cffac213a2c3a57255791bfb4f7ba60007633f220536a3c77f83a5a599fa68337b5623fd8abdc2134c0c684db87ce1d58cfb412989d0ed53e58e829640527b75b9de367f2bfa4837133caf08e33b69b4d8d811882ea0cd7ad1013ed0479f3abed84006a7ded48e09897508f37649b5e9bc464889f0fcdd64eebc504231aee827c79e124be373ceec6cc88c3126006df4f56ddd7035ce37193c21630f861cb0aeb848a1909345120453ad21db629a5d424016dd87e8a23bc8e36b60a55b092af0c5ea2a66ad586bb7966835852194a99247b81c0b002947192ab1871606fe5bfb274607031676d58d2296e4c7956d8098a5cb36eaa38d4a7fca572a9ca5930867866c72d3128f9de7a700cc5aedb75e1a997e8210ea87450bf16d356ff3f9d27f9ac07e0ea45782612cc8b618fb28367569b4cea87996e28a4933824ca19943015a5fbb01fb51d5c5a240178b53be6351e4b9b211f965bd8ec4d1790e5ceafb330453971b4091e305d9699dffb3af8de6834ab1f4402c0949571ec1ce7fdd1ce7418a19f6e3840884d3befdb07b1e04a388676e8f659b880be75cdd8ea3bc43a18ddcf6d2e2cf9b35a79a94ae69dd399bd7d7156f5a17f3e5c2af745f99d2a11edf51</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-wave">      <input class="hbe hbe-input-field hbe-input-field-wave" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-wave" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-wave">æ–‡ç« è¢«åŠ å¯†äº†, è¯·è¾“å…¥å¯†ç æŸ¥çœ‹.</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-wave" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">ğŸ”’å„ç§å„æ ·æ€§èƒ½ä¼˜åŒ–çš„å¥‡æ·«å¼‚å·§</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="åŠ å¯†æ–‡ç« " scheme="https://blog.liukairui.me/tags/%E5%8A%A0%E5%AF%86%E6%96%87%E7%AB%A0/"/>
    
    <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://blog.liukairui.me/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€äº› React çš„ Tips</title>
    <link href="https://blog.liukairui.me/article/%E4%B8%80%E4%BA%9BReact%E7%9A%84Tips/"/>
    <id>https://blog.liukairui.me/article/%E4%B8%80%E4%BA%9BReact%E7%9A%84Tips/</id>
    <published>2023-02-12T16:00:01.000Z</published>
    <updated>2023-02-12T16:00:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åŸºç¡€">åŸºç¡€</h2><ul><li><p><strong>ä¿®æ”¹æ•°ç»„ç±»å‹çš„ state</strong></p><ul><li><p>ğŸ’©æ‹·è´-ä¿®æ”¹-å›å¡«</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">addItem</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// push ä¼šä¿®æ”¹åŸæ•°ç»„æ‰€ä»¥å¿…é¡»å¤åˆ¶</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> items <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ğŸ‘ï¸åˆå¹¶-å›å¡«</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">addItem</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">items</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// concat å¹¶ä¸ä¼šä¿®æ”¹åŸæ•°ç»„</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p><strong><code>state</code> &amp; <code>props</code>å¼‚æ­¥çš„</strong></p><ul><li><p>ğŸ’©ç›´æ¥ä½¿ç”¨ <code>state</code> &amp; <code>props</code> åšæ›´æ–°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>increment<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>ğŸ‘ï¸ä½¿ç”¨å‡½æ•°æ›´æ–°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">+</span> props<span class="token punctuation">.</span>increment<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p><strong><code>useState</code>åˆå§‹å€¼ä½•æ—¶é‡‡ç”¨å‡½æ•°ä½œä¸ºå…¥å‚</strong></p><ul><li><p>å½“åˆå§‹å€¼éœ€è¦è¢«è®¡ç®—æ—¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pre<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=></span> pre <span class="token operator">+</span> cur<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ’© åœ¨æ¯æ¬¡æ¸²æŸ“ç»„ä»¶æ—¶, reduce éƒ½ä¼šè¢«è®¡ç®—ä¸€éç»“æœç„¶åè¢«ä¸¢å¼ƒ</span><span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>  props<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pre<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=></span> pre <span class="token operator">+</span> cur<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ‘ï¸ åœ¨æ¯æ¬¡æ¸²æŸ“ç»„ä»¶æ—¶, éƒ½ä¼šå£°æ˜ä¸€ä¸ªåŒ¿åå‡½æ•°, ä½†æ˜¯å‡½æ•°ä¸ä¼šæ‰§è¡Œ, ä¸ä¼šè®¡ç®— reduce</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åˆå§‹å€¼æ˜¯å¾ˆå¤æ‚å¯¹è±¡æ—¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>k1<span class="token punctuation">,</span> k2<span class="token punctuation">,</span> k3<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">,</span> k1000<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ’© åœ¨æ¯æ¬¡æ¸²æŸ“ç»„ä»¶æ—¶, éƒ½è¦èŠ±å¤§åŠ›æ°”ä¸€ä¸ªå¾ˆå¤§çš„å¯¹è±¡, ç„¶åä¸¢å¼ƒ</span><span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>k1<span class="token punctuation">,</span> k2<span class="token punctuation">,</span> k3<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">,</span> k1000<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ‘ï¸ å‡½æ•°çš„å£°æ˜è€—æ—¶ä¸å‡½æ•°å†…éƒ¨çš„ä»£ç é‡ä¸ç›¸å…³</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p><strong><code>useState</code> &amp;<code>useRef</code></strong></p><ul><li><p>åŒºåˆ«: <code>useState</code> çš„å€¼åœ¨æ¯ä¸ª <code>render</code>ä¸­éƒ½æ˜¯ç‹¬ç«‹å­˜åœ¨çš„, è€Œ <code>useRef.current</code>åˆ™æ›´åƒæ˜¯ç›¸å¯¹äºrenderå‡½æ•°çš„ä¸€ä¸ªå…¨å±€å˜é‡, æ¯æ¬¡ä»–ä¼šä¿æŒ <code>render</code>çš„æœ€æ–°çŠ¶æ€. (<code>useRef</code> ç›¸å½“äºåˆ›å»ºäº†ç±»ç»„ä»¶çš„æˆå‘˜å˜é‡)</p></li><li><p>åœºæ™¯</p><ul><li>å˜é‡ç»´æŠ¤ UI çŠ¶æ€, æ›´æ–°æ—¶éœ€è¦åˆ·æ–° UI: <code>useState</code></li><li>å˜é‡ä¸ç»´æŠ¤ UI çŠ¶æ€, æ›´æ–°æ—¶ä¸éœ€è¦åˆ·æ–° UI: <code>useRef</code></li><li>å˜é‡ä¸æ›´æ–°: <code>const [foo] = useState(initValue)</code></li></ul></li><li><p>é™·é˜±: ä¸è¦ä½¿ç”¨ <code>ref</code> éå¹‚ç­‰(å¢é‡)çš„æ›´æ–°<code>ref</code>. åœ¨ StrictMode çš„ Dev ç¯å¢ƒä¸‹, ç»„ä»¶ä¼šè¢«æ¸²æŸ“ä¸¤æ¬¡,ä»¥æ£€æŸ¥ç»„ä»¶çš„å¹‚ç­‰æ€§, å¹¶ä¸”ä¸æä¾› Warning...</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">ref1<span class="token punctuation">.</span>current <span class="token operator">=</span> ref1<span class="token punctuation">.</span>current <span class="token operator">+</span> <span class="token number">1</span> <span class="token comment">// ğŸ’© ä¼šæ‰§è¡Œä¸¤æ¬¡ç›¸å½“äº + 2</span>ref1<span class="token punctuation">.</span>current <span class="token operator">=</span> someState <span class="token operator">+</span> <span class="token number">1</span> <span class="token comment">// ğŸ‘ï¸ state è¿ç»­æ¸²æŸ“ä¸¤æ¬¡å€¼å¹¶ä¸ä¼šå˜</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul></li><li><p>TODO</p></li></ul>]]></content>
    
    
    <summary type="html">èœèœå­</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="å‰ç«¯æ¡†æ¶" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/"/>
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="React" scheme="https://blog.liukairui.me/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>WebAnimation ä¸ FLIP æŠ€æœ¯</title>
    <link href="https://blog.liukairui.me/article/WebAnimation%E4%B8%8EFLIP%E6%8A%80%E6%9C%AF/"/>
    <id>https://blog.liukairui.me/article/WebAnimation%E4%B8%8EFLIP%E6%8A%80%E6%9C%AF/</id>
    <published>2023-02-08T16:00:01.000Z</published>
    <updated>2023-02-08T16:00:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="web-animations-api">Web Animations API</h2><p>ç±»ä¼¼äº CSS in JS çš„ animation å®ç°.</p><ul><li><p>åŸºæœ¬ä½¿ç”¨</p><ul><li><p>å®šä¹‰å…³é”®å¸§</p><p>ä½¿ç”¨å¯¹è±¡æ•°ç»„çš„æ¨¡å¼å®šä¹‰å…³é”®å¸§</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> aliceTumbling <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token punctuation">&#123;</span> <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token string">'rotate(0) translate3D(-50%, -50%, 0)'</span><span class="token punctuation">,</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#000'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#431236'</span><span class="token punctuation">,</span> <span class="token literal-property property">offset</span><span class="token operator">:</span> <span class="token number">0.3</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span> <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token string">'rotate(360deg) translate3D(-50%, -50%, 0)'</span><span class="token punctuation">,</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#000'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ <code>offset</code> æŒ‡å®šå…³é”®å¸§å‡ºç°åœ¨åŠ¨ç”»ä½ç½®çš„ç™¾åˆ†æ¯”,é¦–å°¾å¯¹è±¡é»˜è®¤ <code>offset = 0/1</code></p><p>è‹¥ä¸æŒ‡å®š <code>offset</code> åˆ™ç›´æ¥é€‰å–ä¸­ç‚¹ä½œä¸º <code>offset</code>,ä¾‹å¦‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span> <span class="token punctuation">&#123;</span><span class="token comment">/*...*/</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- ç¬¬ä¸€ä¸ªå…ƒç´ , offset = 0</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">offset</span><span class="token operator">:</span> <span class="token number">0.4</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- æ‰‹åŠ¨æŒ‡å®š, offset = 0.4</span> <span class="token punctuation">&#123;</span><span class="token comment">/*...*/</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- æœªæŒ‡å®š, å‡åˆ†ä¸º 0.4 + (1-0.4)/3*1 = 0.6</span> <span class="token punctuation">&#123;</span><span class="token comment">/*...*/</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- æœªæŒ‡å®š, å‡åˆ†ä¸º 0.4 + (1-0.4)/3*2 = 0.8</span> <span class="token punctuation">&#123;</span><span class="token comment">/*...*/</span><span class="token punctuation">&#125;</span> <span class="token comment">// &lt;- æœ€åä¸€ä¸ªå…ƒç´ , offset = 1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å®šä¹‰åŠ¨ç”»æ‰§è¡Œæ¨¡å¼</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> aliceTiming <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>  <span class="token literal-property property">iterations</span><span class="token operator">:</span> <span class="token number">Infinity</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ‰§è¡ŒåŠ¨ç”»</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> anim <span class="token operator">=</span> elem<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>aliceTumbling<span class="token punctuation">,</span> aliceTiming<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul></li><li><p>Hooks</p><ul><li>ä¸‹é¢çš„ <code>anim</code> å°±æ˜¯ <code>elem.animate()</code>çš„è¿”å›å€¼</li><li><code>anim.play() / anim.pause()</code>: æ‰§è¡Œ / æš‚åœåŠ¨ç”». æ³¨æ„,åŠ¨ç”»åœ¨ <code>animate()</code> çš„æ—¶å€™å›è‡ªåŠ¨æ‰§è¡Œ, å¦‚éœ€æ‰‹åŠ¨æ§åˆ¶éœ€è¦ç«‹åˆ»<code>pause</code> ä¸€ä¸‹</li><li><code>anim.playbackRate</code>: åŠ¨ç”»æ‰§è¡Œé€Ÿç‡(å¯ä»¥ä¸ºè´Ÿæ•°),å¯å†™å±æ€§</li><li><code>anim.currentTime</code>: åŠ¨ç”»æ‰§è¡Œæ—¶é—´, å¯å†™å±æ€§</li><li><code>anim.effect.timing.duration</code>: åŠ¨ç”»æŒç»­æ—¶é—´, ç±»ä¼¼å±æ€§è§<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvQVBJL1dlYl9BbmltYXRpb25zX0FQSS9Vc2luZ190aGVfV2ViX0FuaW1hdGlvbnNfQVBJ">MDN<i class="fa fa-external-link-alt"></i></span></li><li><code>anim.finish()</code>: åŠ¨ç”»ç»“æŸ</li><li><code>anim.cancel()</code>: ç»ˆæ­¢åŠ¨ç”»</li><li><code>Animation.reverse()</code>: åå‘æ’­æ”¾åŠ¨ç”»</li><li><code>document.getAnimations()</code>: è·å–å…¨éƒ¨ Web Animationæ³¨å†ŒåŠ¨ç”»</li><li><code>anim.onfinish(callback)</code>: åŠ¨ç”»ç»“æŸå›è°ƒ</li><li><code>anim.oncancel(callback)</code>: åŠ¨ç”»å–æ¶ˆå›è°ƒ</li></ul></li></ul><h2 id="flip-æŠ€æœ¯">FLIP æŠ€æœ¯</h2><p>å½“æˆ‘ä»¬éœ€è¦å¯¹ DOM çš„ä½ç½®åšè°ƒæ•´ä½†æ˜¯åˆä¸çŸ¥é“ç›®æ ‡ä½ç½®çš„å…·ä½“æ—¶å¯ä»¥ç”¨ FLIPå®ç°å¸¦æœ‰è¿‡æ¸¡åŠ¨ç”»çš„ä½ç½®è°ƒæ•´.</p><p>ä¾‹å¦‚, æœ‰ <code>a b c d</code> å…ƒç´ , æˆ‘ä»¬å¸Œæœ›å°†å…ƒç´ å˜ä¸º<code>d c b a</code>. å¯ä»¥ç›´æ¥é€šè¿‡ DOM API è°ƒæ•´ä½ç½®, ä½†æ˜¯æ— æ³•å®ç°åŠ¨ç”».FLIP çš„åšæ³•æ˜¯å…ˆå°†å…ƒç´ çš„èµ·å§‹ä½ç½®è®°ä¸‹æ¥, å†è°ƒæ•´åˆ°ç›®æ ‡ä½ç½®, å†é€šè¿‡ CSSå°†å…ƒç´ è°ƒåˆ°åŸä¸ºæ­¢, æœ€åé€šè¿‡åŠ¨ç”»å®Œæˆè¿‡æ¸¡</p><ul><li><strong>First</strong>ï¼šåœ¨ä»»ä½•äº‹æƒ…å‘ç”Ÿä¹‹å‰ï¼Œè®°å½•å°†è¦è½¬æ¢çš„å…ƒç´ çš„å½“å‰ï¼ˆå³ç¬¬ä¸€ï¼‰ä½ç½®å’Œå°ºå¯¸ã€‚æ‚¨å¯ä»¥ä½¿ç”¨<code>element.getBoundingClientRect()</code>å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</li><li><strong>Last</strong>ï¼šæ‰§è¡Œä½¿è¿‡æ¸¡ç¬é—´å‘ç”Ÿçš„ä»£ç ï¼Œå¹¶è®°å½•å…ƒç´ çš„æœ€ç»ˆï¼ˆå³lastï¼‰ä½ç½®å’Œå°ºå¯¸ã€‚</li><li><strong>Invert</strong>ï¼šç”±äºå…ƒç´ ä½äºæœ€åä¸€ä¸ªä½ç½®ï¼Œæˆ‘ä»¬æƒ³é€šè¿‡<code>transform</code>ä¿®æ”¹å…¶ä½ç½®å’Œå°ºå¯¸æ¥åˆ›å»ºå®ƒä½äºç¬¬ä¸€ä¸ªä½ç½®çš„é”™è§‰ã€‚è¿™éœ€è¦ä¸€ç‚¹æ•°å­¦è¿ç®—ï¼Œä½†å¹¶ä¸éš¾ã€‚</li><li><strong>Play</strong>ï¼šå…ƒç´ åè½¬ï¼ˆå¹¶å‡è£…åœ¨ç¬¬ä¸€ä¸ªä½ç½®ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å…¶è®¾ç½®ä¸º<code>transform</code>æ¥å°†å…¶ç§»å›åˆ°æœ€åä¸€ä¸ªä½ç½®<code>none</code>ã€‚</li></ul><p><span class="exturl" data-url="aHR0cHM6Ly92Mi52dWVqcy5vcmcvdjIvZ3VpZGUvdHJhbnNpdGlvbnMuaHRtbCNMaXN0LU1vdmUtVHJhbnNpdGlvbnM=">vue2 æ–‡æ¡£<i class="fa fa-external-link-alt"></i></span>ä¸­æåˆ°çš„æ•ˆæœ</p><iframe src="https://codesandbox.io/embed/github/vuejs/v2.vuejs.org/tree/master/src/v2/examples/vue-20-list-move-transitions?fontsize=14&amp;hidenavigation=1" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" title="vue-20-list-move-transitions" allow="accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"></iframe><h2 id="åŠ¨ç”»å®ç°çš„æ¯”è¾ƒ">åŠ¨ç”»å®ç°çš„æ¯”è¾ƒ</h2><p>åŠ¨ç”»çš„å®ç°æ–¹æ³•:</p><ul><li>çº¯ CSS (animation / transition) with GPU</li><li>çº¯ JS (requestAnimationFrame &amp; style)</li><li>WebAnimation API</li></ul><p>å…¶ä¸­</p><ul><li><p>JS å®ç°çš„åŠ¨ç”»ä¼šè¢«åŒæ­¥ä»£ç é˜»å¡. ä½†æ˜¯æ›´åŠ çµæ´»</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token comment">/*...*/</span><span class="token punctuation">)</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;- request å¡æ­»</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>ä¸ä½¿ç”¨ GPU æ¸²æŸ“çš„ CSS åŠ¨ç”»ä¼šè¢«åŒæ­¥ä»£ç é˜»å¡, é‡‡ç”¨ GPU çš„ä¸é˜»å¡.åªè¦åŠ¨ç”»æ¶‰åŠçš„å±æ€§ä¸å¼•èµ· reflow åŠ¨ç”»çš„é‡‡æ ·å°±ä¼šäº¤ç»™ GPU å¤„ç†.</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">#alice_css</span> <span class="token punctuation">&#123;</span>  <span class="token property">animation</span><span class="token punctuation">:</span> cssRound infinite 3s linear<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@keyframes</span> cssRound</span> <span class="token punctuation">&#123;</span>  <span class="token selector">0%</span> <span class="token punctuation">&#123;</span>    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>  <span class="token comment">/* &lt;- left ä¼šå¼•å‘é‡ç»˜, æ­¤æ—¶åŠ¨ç”»çš„æ¸²æŸ“æ˜¯ç”± CPU å®Œæˆçš„, å¦‚æœæ‰§è¡Œ while(true); åŠ¨ç”»å°±ä¼šå¡æ­»*/</span>  <span class="token punctuation">&#125;</span>  <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>    <span class="token property">left</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">#alice_css</span> <span class="token punctuation">&#123;</span>  <span class="token property">animation</span><span class="token punctuation">:</span> cssRound infinite 3s linear<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@keyframes</span> cssRound</span> <span class="token punctuation">&#123;</span>  <span class="token selector">0%</span> <span class="token punctuation">&#123;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateZ</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* &lt;- rotateZ ä¸ä¼šå¼•å‘é‡ç»˜, æ­¤æ—¶åŠ¨ç”»çš„æ¸²æŸ“æ˜¯ç”± GPU å®Œæˆçš„, å¦‚æœæ‰§è¡Œ while(true); åŠ¨ç”»ä¸ä¼šå¡æ­»*/</span>  <span class="token punctuation">&#125;</span>  <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateZ</span><span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› æ­¤, èƒ½ä½¿ç”¨ CSS åŠ¨ç”»çš„å°±ä¸è¦ç”¨ JS åŠ¨ç”»</p></li><li><p>WebAnimation API: é€šè¿‡ JS çš„æ–¹å¼å®šä¹‰åŠ¨ç”», æœ€ç»ˆä¼šå°†åŠ¨ç”»æ•ˆæœé€šè¿‡CSS åŠ¨ç”»å®Œæˆ, å…¶å¯¹åŒæ­¥ JS ä»£ç é˜»å¡çš„è¡¨ç°ä¸ CSS åŠ¨ç”»ä¸€è‡´</p><p>è¿™ä¸ª API æ—¢ä¿ç•™äº† JS çš„çµæ´»æ€§(æ§åˆ¶åŠ¨ç”»æ‰§è¡Œ, åŠ¨ç”»æ‰§è¡Œè§‚æµ‹, ä¸JSäº¤äº’),åŒæ—¶ä½¿ç”¨ç±»ä¼¼ CSS çš„æ–¹å¼æ‰§è¡ŒåŠ¨ç”», å‡å°‘äº†åŒæ­¥ä»£ç å¯¹åŠ¨ç”»çš„å½±å“</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> aliceJs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'alice_js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> aliceRoundJs <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token punctuation">&#123;</span> <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token string">'rotateZ(0deg)'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- åŒæ­¥ä»£ç é˜»å¡ä¹Ÿå¡æ­»</span>    <span class="token punctuation">&#123;</span> <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token string">'rotateZ(360deg)'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> aliceTimeJs <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>    <span class="token literal-property property">iterations</span><span class="token operator">:</span> <span class="token number">Infinity</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  aliceJs<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>aliceRoundJs<span class="token punctuation">,</span> aliceTimeJs<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> aliceJs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'alice_js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> aliceRoundJs <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token punctuation">&#123;</span> <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token string">'0'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// &lt;- åŒæ­¥ä»£ç é˜»å¡ä¹Ÿä¸å¡æ­»</span>  <span class="token punctuation">&#123;</span> <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token string">'300px'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> aliceTimeJs <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>  <span class="token literal-property property">iterations</span><span class="token operator">:</span> <span class="token number">Infinity</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>aliceJs<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>aliceRoundJs<span class="token punctuation">,</span> aliceTimeJs<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul>]]></content>
    
    
    <summary type="html">ä¸€äº›åŠ¨ç”»ç›¸å…³çš„é­”æ³•</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="åŠ¨ç”»" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/%E5%8A%A8%E7%94%BB/"/>
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="æ€§èƒ½" scheme="https://blog.liukairui.me/tags/%E6%80%A7%E8%83%BD/"/>
    
    <category term="åŠ¨ç”»" scheme="https://blog.liukairui.me/tags/%E5%8A%A8%E7%94%BB/"/>
    
  </entry>
  
  <entry>
    <title>Chrome DevTool Console APIs</title>
    <link href="https://blog.liukairui.me/article/ChromeDevToolConsoleAPIs/"/>
    <id>https://blog.liukairui.me/article/ChromeDevToolConsoleAPIs/</id>
    <published>2023-02-02T16:00:01.000Z</published>
    <updated>2023-02-02T16:00:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="console-apis">Console APIs</h2><blockquote><p>æ¥è‡ª: https://developer.chrome.com/docs/devtools/console/api</p><p>ä»¥ä¸‹æ’ä»¶å¯åœ¨ JavaScript ä»£ç ä¸­ä½¿ç”¨, é DevTools ä¸“æœ‰ API</p></blockquote><ul><li><p><code>console.assert(assertion, obj1[, obj2...])</code>: ä¼ å…¥ä¸€ä¸ªboolean è‹¥ä¸ºå‡åˆ™æŠ›å‡ºå¼‚å¸¸</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">assert</span><span class="token punctuation">(</span>number <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">number</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token literal-property property">errorMsg</span><span class="token operator">:</span> errorMsg<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p><code>console.count([label])</code>: è¾“å‡º label è¢«æ”¾å…¥ countæ‰§è¡Œçš„æ¬¡æ•°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// default: 1 (ä¸å†™ label å°±æ˜¯ default)</span>console<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token string">'coffee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// coffee: 1</span>console<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token string">'coffee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// coffee: 2</span>console<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// default: 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>console.countReset([label])</code>: é‡ç½®ä¸€ä¸ª count</p></li><li><p><code>console.debug / info / error / warn</code>: ä¸<code>console.log</code> ç”¨æ³•ç›¸åŒ, ä½†ç­‰çº§ä¸åŒ</p></li><li><p><code>console.dir()</code>: æ‰“å°å¯¹è±¡</p></li><li><p><code>console.dirxml(xml)</code>: æ‰“å° XML å¯¹è±¡</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">dirxml</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p><code>console.table</code>: æ‰“å°è¡¨æ ¼</p></li><li><p><code>console.group*</code>: ä¸€ç³»åˆ—æ‰“å°å¯æŠ˜å æ—¥å¿—çš„æ–¹æ³•</p></li><li><p><code>console.time([label]) / console.timeEnd([label])</code>:è®¡æ—¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> square <span class="token operator">=</span> i <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>console.trace()</code>: æ‰“å°å½“å‰è°ƒç”¨æ ˆ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">first</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token function">second</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">second</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token function">third</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">third</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token function">fourth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">fourth</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> console<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="console-å®ç”¨-apis">Console å®ç”¨ APIs</h2><blockquote><p>å†…å®¹æ¥è‡ª:https://developer.chrome.com/docs/devtools/console/utilities</p><p>ä»¥ä¸‹ API åœ¨ JS ä¸­ä¸å¯ç”¨, ä»…é™ DevTool ä¸‹ä½¿ç”¨</p></blockquote><ul><li><p><code>$_</code>: è¿”å›æœ€è¿‘è®¡ç®—çš„è¡¨è¾¾å¼å€¼</p></li><li><p><code>$0-$4</code>: è¿”å›æœ€è¿‘ 1 - 5 ä¸ª Elementé¢æ¿é€‰ä¸­çš„å…ƒç´ </p></li><li><p><code>$(selector, startNode)</code>: é€‰ä¸­ä¸€ä¸ªå…ƒç´ , ç›¸å½“äº<code>document.querySelector(selector)</code>, å…¶ä¸­<code>startNode</code> ä¸ºæ£€ç´¢çš„æ ¹èŠ‚ç‚¹. æ³¨æ„<strong>è¿™ä¸æ˜¯jQuery</strong></p></li><li><p><code>$$(selector, startNode)</code>: é€‰ä¸­å…ƒç´ , ç›¸å½“äº<code>document.querySelectorAll(selector)</code>, å…¶ä¸­<code>startNode</code> ä¸ºæ£€ç´¢çš„æ ¹èŠ‚ç‚¹. æ³¨æ„<strong>è¿™ä¸æ˜¯jQuery</strong></p></li><li><p><code>$x(selector)</code>: é€šè¿‡ <code>xpath</code> é€‰ä¸­å…ƒç´ , ä¾‹å¦‚<code>$x("//p")</code></p></li><li><p><code>copy(object)</code>å°†æŒ‡å®šå¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼å¤åˆ¶åˆ°å‰ªè´´æ¿</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">copy</span><span class="token punctuation">(</span>$0<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p><code>debug(fn) / undebug(fn)</code>: è°ƒè¯•å‡½æ•°,å½“å‡½æ•°è¢«è°ƒç”¨æ—¶ä¸­æ–­æ‰§è¡Œå¹¶è·³è½¬æºä»£ç é¢æ¿</p></li><li><p><code>dir / dirxml / key / value</code>: å’Œ<code>console.*</code> ä¸€æ ·, åªä¸è¿‡æ˜¯åšäº† preclude</p></li><li><p><code>inspect(object / function)</code>: è‹¥ä¸º Element åˆ™åœ¨Element é¢æ¿é€‰ä¸­å…ƒç´ . è‹¥ä¸º function åˆ™åœ¨æºä»£ç ä¸­æ˜¾ç¤ºå‡½æ•°</p></li><li><p><code>getEventListeners(element)</code>: è·å– Elementçš„æ‰€æœ‰äº‹ä»¶ç›‘å¬.</p></li><li><p><code>keys(object) / values(object)</code>: è·å–å¯¹è±¡çš„ key /value</p></li><li><p><code>monitor(fn) / unmonitor(fn)</code>:å½“å‡½æ•°è¢«è°ƒç”¨æ—¶è¾“å‡ºå‡½æ•°åä¸è°ƒç”¨å‚æ•°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">monitor</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// function sum called with arguments: 1, 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>monitorEvents(element, stirng[] | string) / unmonitorEvents(object[, events])</code>:ç›‘å¬å¯¹è±¡çš„äº‹ä»¶è¢«è§¦å‘, è§¦å‘åè¾“å‡ºäº‹ä»¶ä¸ <code>event</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">monitorEvents</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"resize"</span><span class="token punctuation">,</span> <span class="token string">"scroll"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">// resize Event &#123;isTrusted: true, type: 'resize', target: Window, currentTarget: Window, eventPhase: 2, â€¦&#125;</span><span class="token function">monitorEvents</span><span class="token punctuation">(</span>$0<span class="token punctuation">,</span> <span class="token string">"key"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p><code>profile([label]) / profileEnd([label])</code>: å¼€å¯ /å…³é—­ä¸€ä¸ª JavaScript æ€§èƒ½åˆ†æ. å…³é—­åå¯åœ¨ DevTool çš„ JavaScriptæ€§èƒ½å‰–æå™¨æŸ¥çœ‹åˆ†æå†…å®¹. <strong>æ”¯æŒåŒæ—¶å¼€å¤šä¸ªåˆ†æå™¨</strong></p></li><li><p><code>queryObjects(Constructor)</code>:è¿”å›ä¸€ä¸ªæ„é€ å‡½æ•°çš„æ‰€æœ‰å®ä¾‹çš„<strong>ç±»æ•°ç»„</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">queryObjects</span><span class="token punctuation">(</span>Promise<span class="token punctuation">)</span><span class="token comment">//Array(20)</span><span class="token comment">//0: Promise &#123;&lt;pending>&#125;</span><span class="token comment">//1: Promise &#123;&lt;pending>&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ul>]]></content>
    
    
    <summary type="html">ä¸€äº› Concole API ä»¥åŠä¸€äº›åªæœ‰åœ¨ Chrome DevTool Console ä¸‹å¯ç”¨çš„é­”æ³•</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="DevTool" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/DevTool/"/>
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="DevTool" scheme="https://blog.liukairui.me/tags/DevTool/"/>
    
    <category term="è°ƒè¯•" scheme="https://blog.liukairui.me/tags/%E8%B0%83%E8%AF%95/"/>
    
    <category term="chrome" scheme="https://blog.liukairui.me/tags/chrome/"/>
    
  </entry>
  
  <entry>
    <title>å¥‡æ€ªçš„ DOM API</title>
    <link href="https://blog.liukairui.me/article/%E5%A5%87%E6%80%AA%E7%9A%84DOMAPI/"/>
    <id>https://blog.liukairui.me/article/%E5%A5%87%E6%80%AA%E7%9A%84DOMAPI/</id>
    <published>2023-01-18T16:00:01.000Z</published>
    <updated>2023-01-18T16:00:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="node-element">Node &amp; Element</h2><ul><li><p><strong>ä¸¤è€…å…³ç³»</strong>: Element æ˜¯ Node çš„å­ç±»</p></li><li><p><strong>åŒºåˆ†æ–¹æ³•</strong>: ä¸€ä¸ªç®€æ˜“çš„åŒºåˆ† Node å’Œ Elementçš„æ–¹æ³•æ˜¯: <strong>æ‰€æœ‰æŒ‰ç…§æ ‡ç­¾è¯­æ³•ä¹¦å†™çš„å…ƒç´ éƒ½æ˜¯ Element</strong>.ä¾ç…§è¿™ä¸ªè§„åˆ™,</p><ul><li><p>ä»¥ä¸‹èŠ‚ç‚¹éƒ½æ˜¯ä¸æ˜¯ Element è€Œæ˜¯ Node</p><ul><li><p>Text Node: <code>"I am a text node"</code></p></li><li><p><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvQVBJL0NEQVRBU2VjdGlvbg==">CDataSection Node<i class="fa fa-external-link-alt"></i></span>:<code>&lt;![CDATA[  &lt; &gt; &amp; ]]&gt;</code></p></li><li><p><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1Byb2Nlc3NpbmdJbnN0cnVjdGlvbg==">ProcessingInstruction Node<i class="fa fa-external-link-alt"></i></span>:<code>&lt;?xml-stylesheet type="text/css" href="rule.css"?&gt;</code></p></li><li><p>Comment Node: <code>&lt;!-- I am comment--&gt;</code></p></li><li><p>Document Type Node: <code>&lt;!doctype html&gt;</code></p></li><li><p><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvQVBJL0RvY3VtZW50RnJhZ21lbnQ=">DocumentFragment Node<i class="fa fa-external-link-alt"></i></span>: <code>#document</code></p></li><li><p><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvQVBJL0F0dHI=">AttributeNode<i class="fa fa-external-link-alt"></i></span>: <code>class="dmeo"</code></p></li></ul></li><li><p>ä»¥ä¸‹èŠ‚ç‚¹æ˜¯ Element</p><ul><li>Element Node</li><li>Document Node</li></ul></li></ul><p>å¯ä»¥é‡‡ç”¨ <code>node instanceof Node</code>,<code>node instanceof Element</code> åˆ¤æ–­èŠ‚ç‚¹ç±»å‹</p><p>ä¹Ÿå¯ä»¥é‡‡ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvQVBJL05vZGUvbm9kZVR5cGU=">nodeType<i class="fa fa-external-link-alt"></i></span>åˆ¤æ–­</p></li><li><p><strong>property åŒºåˆ«</strong></p><ul><li><p><strong><code>childNodes</code> &amp;<code>children</code></strong></p><p>åè€…åªèƒ½è·å–å­ <code>Element</code> ä¸èƒ½è·å–é Element çš„ Node.å‰è€…è¿”å›çš„æ˜¯ <code>NodeList</code> åè€…è¿”å›çš„æ˜¯<code>HTMLCollection</code>. <code>HTMLCollection</code>æ²¡æœ‰ä»»ä½•æ•°ç»„æ–¹æ³•, ä¾‹å¦‚ <code>map()</code>, <code>find()</code>,<code>forEach()</code> ç­‰ç­‰. ä½†æ˜¯NodeListç¡®å®æœ‰ <code>forEach()</code>æ–¹æ³•. è¿™æ˜¯å®ƒå”¯ä¸€æ‹¥æœ‰çš„æ•°ç»„æ–¹æ³•. <code>HTMLCollection</code>æ€»æ˜¯å®æ—¶æ›´æ–°.</p></li><li><p><strong><code>firstChild</code> &amp;<code>lastChild</code></strong> è¿”å›çš„ <code>NodeList</code></p></li><li><p><strong><code>getElement*</code></strong> è¿”å›çš„æ˜¯<code>HTMLCollection</code></p><p><strong><code>query*</code></strong> è¿”å›çš„æ˜¯<code>NodeList</code></p></li><li><p><strong><code>tagName</code> &amp;<code>nodeName</code></strong></p><p><code>nodeName</code> ä¸º <code>Node</code> çš„æ–¹æ³•,<code>tagName</code> ä¸º <code>Element</code> çš„æ–¹æ³•</p><p><code>nodeName</code> ç»“æœå…¨å¤§å†™, <code>tagName</code>å…¨å°å†™</p></li><li><p><strong><code>innerText</code> &amp;<code>textContent</code>:</strong> <code>innerText</code> æ˜¯<code>Element</code> çš„æ–¹æ³•, <code>textContent</code> æ˜¯<code>Node</code> çš„æ–¹æ³•</p></li><li><p><strong><code>setAttribute</code></strong> æ˜¯ä¸€ä¸ª<code>Element</code> æ–¹æ³•</p></li><li><p>CSS é€‰æ‹©å™¨åªèƒ½é€‰ä¸­ Element./img</p></li></ul></li></ul><h2 id="innertext-textcontent"><code>innerText</code> &amp;<code>textContent</code></h2><ul><li><code>innerText</code>Â æ˜¯ <code>Element</code> çš„æ–¹æ³•,<code>textContent</code> æ˜¯ <code>Node</code> çš„æ–¹æ³•</li><li><code>textContent</code> ä¼šæŠŠæ‰€æœ‰å­å…ƒç´ çš„æ–‡æœ¬è¿æ¥èµ·æ¥å¹¶è¿”å›, ä½†æ˜¯<code>innerText</code> ä¼šè¿”å›ä¸€ä¸ª"äººç±»å¯è§&amp;å¯è¯»"çš„æ–‡æœ¬,å®ƒä¸ä¼šè¿”å›ä¸å¯è§å…ƒç´ çš„æ–‡æœ¬(ä¾‹å¦‚<code>&lt;style&gt;</code>ã€<code>&lt;script&gt;</code>ã€<code>&lt;span style="display:none"&gt;</code>).å°±å¥½åƒä½ ç”¨é¼ æ ‡é€‰ä¸­è¿™æ®µæ–‡æœ¬åå† Ctrl+C å¾—åˆ°çš„æ–‡æœ¬.</li><li>ä¹Ÿæ­£å› ä¸ºä¸Šé¢è¿™ä¸€ç‚¹, æ‰€ä»¥åœ¨è¯»å–(æˆ–ä¿®æ”¹)ä¸€ä¸ªå…ƒç´ çš„<code>innerText</code> å±æ€§æ—¶ä¼šä¸ºäº†è®¡ç®— CSS è€Œé€ æˆä¸€æ¬¡é‡ç»˜(reflow),æ‰€ä»¥å®ƒçš„æ€§èƒ½æ¯” <code>textContent</code> ä½.</li></ul><h2 id="æ ·å¼ä¸å±æ€§">æ ·å¼ä¸å±æ€§</h2><ul><li><p>å¢åŠ æ ·å¼:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Ele<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> xxx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å¢åŠ  class</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Ele<span class="token punctuation">.</span>className<span class="token operator">=</span><span class="token string">'aaa'</span>  <span class="token comment">// è®¾ç½®å…ƒç´ çš„classä¸ºaaa ï¼Œå¦‚æœå…ƒç´ ä¸ŠåŸæœ¬æœ‰classåˆ™ä¼šè¦†ç›–</span>Ele<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"aaa"</span><span class="token punctuation">)</span> <span class="token comment">// ç»™Eleæ–°å¢aaa</span>Ele<span class="token punctuation">.</span>className <span class="token operator">+=</span> <span class="token string">" aaa"</span>  <span class="token comment">// ç»™Eleæ–°å¢aaa</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>åŒ…å« class</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Ele<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"aaa"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å¢åŠ å±æ€§</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Ele<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"data-id"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>åˆ é™¤å±æ€§</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Ele<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">"data-id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>è·å–å±æ€§å€¼</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"data-id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><blockquote><p>ä»¥ä¸‹å†…å®¹æ¥è‡ª: https://juejin.cn/post/6966062224892756005</p></blockquote><h2 id="å°ºå¯¸ç›¸å…³">å°ºå¯¸ç›¸å…³</h2><ul><li><p>å°ºå¯¸ç¤ºæ„å›¾</p><figure><img src="./img08.jpg" alt="img01" /><figcaption aria-hidden="true">img01</figcaption></figure></li><li><p>è·å–å®é™…å±å¹•å®½é«˜</p><figure><img src="./img01.png" alt="img01" /><figcaption aria-hidden="true">img01</figcaption></figure><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">W</span>  <span class="token operator">=</span>  window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width<span class="token keyword">const</span> <span class="token constant">H</span>  <span class="token operator">=</span>  window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>è·å–æµè§ˆå™¨å®½é«˜</p><figure><img src="./img02.png" alt="img02" /><figcaption aria-hidden="true">img02</figcaption></figure><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">W</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>outerWidth<span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">H</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>outerHeight<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>è·å–å½“å‰çª—å£å®½é«˜ï¼ˆæµè§ˆå™¨è§†å£å®½é«˜ï¼‰</p><figure><img src="./img03.png" alt="img03" /><figcaption aria-hidden="true">img03</figcaption></figure><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">W</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">H</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>è·å–å…ƒç´ å¸ƒå±€å®½é«˜</p><figure><img src="./img04.png" alt="img04" /><figcaption aria-hidden="true">img04</figcaption></figure><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">W</span> <span class="token operator">=</span> element<span class="token punctuation">.</span>offsetWidth<span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">H</span> <span class="token operator">=</span> element<span class="token punctuation">.</span>offsetHeight<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>è·å–å…ƒç´ å†…å®¹å®½é«˜</p><figure><img src="./img05.png" alt="img05" /><figcaption aria-hidden="true">img05</figcaption></figure><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">W</span> <span class="token operator">=</span> element<span class="token punctuation">.</span>scrollWidth<span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">H</span> <span class="token operator">=</span> element<span class="token punctuation">.</span>scrollHeight<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>è·å–æ»šåŠ¨åè¢«éšè—é¡µé¢çš„å®½é«˜</p><figure><img src="./img06.png" alt="img06" /><figcaption aria-hidden="true">img06</figcaption></figure><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">H</span> <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">W</span> <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollLeft<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>è·å–å…ƒç´ è·ç¦»é¡¶éƒ¨å’Œå·¦è¾¹è·ç¦»</p><figure><img src="./img07.png" alt="img07" /><figcaption aria-hidden="true">img07</figcaption></figure><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> top <span class="token operator">=</span> Ele<span class="token punctuation">.</span>offsetTop<span class="token punctuation">;</span><span class="token keyword">const</span> left <span class="token operator">=</span> Ele<span class="token punctuation">.</span>offsetLeft<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul><h2 id="äº‹ä»¶ç›¸å…³">äº‹ä»¶ç›¸å…³</h2><h3 id="é¼ æ ‡äº‹ä»¶">é¼ æ ‡äº‹ä»¶</h3><ul><li><p>å•å‡»äº‹ä»¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Ele<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"onclick"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>åŒå‡»äº‹ä»¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Ele<span class="token punctuation">.</span><span class="token function-variable function">ondblclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"ondblclick"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>å³å‡»äº‹ä»¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Ele<span class="token punctuation">.</span><span class="token function-variable function">oncontextmenu</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"oncontextmenu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Ele<span class="token punctuation">.</span><span class="token function-variable function">onmousedown</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"onmousedown"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>é¼ æ ‡ç§»åŠ¨äº‹ä»¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Ele<span class="token punctuation">.</span><span class="token function-variable function">onmousemove</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"onmousemove"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>é¼ æ ‡æŠ¬èµ·äº‹ä»¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Ele<span class="token punctuation">.</span><span class="token function-variable function">onmouseup</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"onmouseup"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>é¼ æ ‡è¿›æ¥äº‹ä»¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// é¼ æ ‡ç§»åŠ¨åˆ°è‡ªèº«æ—¶å€™ä¼šè§¦å‘äº‹ä»¶ï¼ŒåŒæ—¶ç§»åŠ¨åˆ°å…¶å­å…ƒç´ èº«ä¸Šä¹Ÿä¼šè§¦å‘äº‹ä»¶</span>Ele<span class="token punctuation">.</span><span class="token function-variable function">onmouseover</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"onmouseover"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// é¼ æ ‡ç§»åŠ¨åˆ°è‡ªèº«æ˜¯ä¼šè§¦å‘äº‹ä»¶ï¼Œä½†æ˜¯ç§»åŠ¨åˆ°å…¶å­å…ƒç´ èº«ä¸Šä¸ä¼šè§¦å‘äº‹ä»¶</span>Ele<span class="token punctuation">.</span><span class="token function-variable function">onmouseenter</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"onmouseenter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>é¼ æ ‡ç¦»å¼€äº‹ä»¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// é¼ æ ‡ç§»åŠ¨åˆ°è‡ªèº«æ—¶å€™ä¼šè§¦å‘äº‹ä»¶ï¼ŒåŒæ—¶ç§»åŠ¨åˆ°å…¶å­å…ƒç´ èº«ä¸Šä¹Ÿä¼šè§¦å‘äº‹ä»¶</span>Ele<span class="token punctuation">.</span><span class="token function-variable function">onmouseout</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"onmouseout"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// é¼ æ ‡ç§»åŠ¨åˆ°è‡ªèº«æ˜¯ä¼šè§¦å‘äº‹ä»¶ï¼Œä½†æ˜¯ç§»åŠ¨åˆ°å…¶å­å…ƒç´ èº«ä¸Šä¸ä¼šè§¦å‘äº‹ä»¶</span>Ele<span class="token punctuation">.</span><span class="token function-variable function">onmouseleave</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"onmouseleave"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="é”®ç›˜äº‹ä»¶">é”®ç›˜äº‹ä»¶</h3><ul><li><code>keydown</code>ï¼šå½“ç”¨æˆ·æŒ‰ä¸‹é”®ç›˜ä¸Šçš„ä»»æ„é”®æ—¶è§¦å‘ï¼Œè€Œä¸”å¦‚æœæŒ‰ä½æŒ‰ä½ä¸æ”¾çš„è¯ï¼Œä¼šé‡å¤è§¦å‘æ­¤äº‹ä»¶ã€‚</li><li><code>keypress</code>ï¼šå½“ç”¨æˆ·æŒ‰ä¸‹é”®ç›˜ä¸Šçš„å­—ç¬¦é”®æ—¶è§¦å‘ï¼ˆå°±æ˜¯è¯´ç”¨æˆ·æŒ‰äº†ä¸€ä¸ªèƒ½åœ¨å±å¹•ä¸Šè¾“å‡ºå­—ç¬¦çš„æŒ‰é”®keypressäº‹ä»¶æ‰ä¼šè§¦å‘ï¼‰ï¼Œè€Œä¸”å¦‚æœæŒ‰ä½ä¸æ”¾çš„ï¼Œä¼šé‡å¤è§¦å‘æ­¤äº‹ä»¶ï¼ˆæŒ‰ä¸‹Escé”®ä¹Ÿä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶ï¼‰ã€‚</li><li><code>keyup</code>ï¼šå½“ç”¨æˆ·é‡Šæ”¾é”®ç›˜ä¸Šçš„é”®æ—¶è§¦å‘ã€‚</li></ul><h3 id="è¡¨å•äº‹ä»¶">è¡¨å•äº‹ä»¶</h3><ul><li><code>submit</code>ï¼šè¡¨å•æäº¤</li><li><code>reset</code>ï¼šè¡¨å•é‡ç½®</li><li><code>change</code>ï¼šå€¼å‘ç”Ÿæ”¹å˜</li><li><code>blur</code>ï¼šç¦»ç„¦ï¼ˆä¸ä¼šå†’æ³¡ï¼‰</li><li><code>focus</code>ï¼šèšç„¦ï¼ˆä¸ä¼šå†’æ³¡ï¼‰</li></ul><h3 id="window">window</h3><p><code>window</code>äº‹ä»¶æŒ‡çš„æ˜¯æµè§ˆå™¨çª—å£æœ¬èº«è€Œä¸æ˜¯çª—å£å†…çš„æ–‡æ¡£å¯¹è±¡ã€‚</p><ul><li><code>onload</code>ï¼šå½“æ–‡æ¡£å’Œèµ„æºåŠ è½½å®Œæˆåè°ƒç”¨</li><li><code>unload</code>ï¼šå½“ç”¨æˆ·ç¦»å¼€å½“å‰æ–‡æ¡£è½¬è€Œå…¶ä»–æ–‡æ¡£æ—¶è°ƒç”¨</li><li><code>resize</code>ï¼šæµè§ˆå™¨çª—å£æ”¹å˜</li></ul><h3 id="å…¶ä»–äº‹ä»¶">å…¶ä»–äº‹ä»¶</h3><ul><li><p><code>beforeunload</code>ï¼šå…³é—­æµè§ˆå™¨çª—å£ä¹‹å‰è§¦å‘çš„äº‹ä»¶</p></li><li><p><code>DOMContentLoaded</code>ï¼šæ–‡æ¡£å¯¹è±¡åŠ è½½å®Œæˆä¹‹åå°±è§¦å‘çš„äº‹ä»¶ï¼Œæ— éœ€ç­‰å¾…æ ·å¼ã€å›¾ç‰‡ç­‰èµ„æº</p></li><li><p><code>readystatechange</code>ï¼šdocumentæœ‰ readyState å±æ€§æ¥æè¿°document çš„ loadingçŠ¶æ€ï¼ŒreadyState çš„æ”¹å˜ä¼šè§¦å‘ readystatechangeäº‹ä»¶</p><ul><li><p><code>document.readyState === 'complete'</code>é¡µé¢å·²åŠ è½½å®Œæ¯•</p></li><li><p><code>document.readyState === 'loading'</code>é¡µé¢æ­£åœ¨åŠ è½½</p></li></ul></li><li><p><code>pageShow</code> å’Œ<code>pagehide</code>ï¼šæ¯æ¬¡ç”¨æˆ·æµè§ˆå…³é—­é¡µé¢æ—¶è§¦å‘</p></li></ul>]]></content>
    
    
    <summary type="html">æ˜“æ·· &amp; æ˜“å¿˜çš„ API ä»¬</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="JS" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/JS/"/>
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€äº›@&lt;svg width=&quot;32&quot; height=&quot;32&quot; viewBox=&quot;0 0 24 29&quot; style=&quot;vertical-align:bottom&quot;&gt;&lt;path fill=&quot;currentColor&quot; d=&quot;M19.877 1.468L24 2.534v18.942l-4.123 1.056V1.468zM6.53 10.898l4.115 1.064v8.978L6.53 22.003V10.896zM0 2.572l4.115 1.064v16.736L0 21.428V2.572zm17.455 5.62V19.3l-4.122-1.064V9.257l4.122-1.064z&quot;/&gt;&lt;/svg&gt;çš„ä¸œè¥¿</title>
    <link href="https://blog.liukairui.me/article/%E4%B8%80%E4%BA%9BByteD%E7%9A%84%E4%B8%9C%E8%A5%BF/"/>
    <id>https://blog.liukairui.me/article/%E4%B8%80%E4%BA%9BByteD%E7%9A%84%E4%B8%9C%E8%A5%BF/</id>
    <published>2023-01-17T16:00:01.000Z</published>
    <updated>2023-01-17T16:00:01.000Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">  <script id="hbeData" type="hbeData" data-hmacdigest="754aa6ffc3f7b68f22d2d3ef64c86f04798a57fb211d1a666fab72012b54e53e">34e85ffb0b6d2d12b6c2e177fdc7251e7292bae7e81645cf9a3bcb831b55e8cc88bdb9fee83aaedf03f728c5eae46c29a9c8995b7a2cce5ac17cad16f25e8ba844b4de052198c04f952f42f020fac630225c4be6b68123b5e693ff50e8ff3adbbf11fb5ac5d7e44a46b0b472269efaac6b8afa19c5b49b58b79050b28bfabb03149f3ba01cfecee10ed700e0f52254a8b85d210f072b4d7890e5f2a99fdb826e2f4defb0b4d46a209e3acfa1ebdb30c5e61cb76b296f21f67cca71eb7fd9c0d21da779ccc4bbf5b668289672afa38a49f7954dba6bf5984f973e4056309b2f4e658bfd0ac15031fbfd595462d9e2566224bb88b0c840b7d87f222010313806424573a9a95f939075c5755911f85bb0cc55b4af2b49ef1645b4830d549a7ab9ee0f1ab09512f64db9f226d4a7ca0a9c833083df74522cb2ac29fe909f4024bdec848fda0d16b68002f5f1c7bc761cc77e747a803299c59d28828e025b09060ac6ddde3259f42d69f202a5e87864065effc2170222eb877655cbbc75808d34bffda5394ec6cbc704782b30e5e61eefe5d10a2b277479b01f26e5d9c5a4be4e7ae4fa082ccb17a691c4efb7d6e61c6025d410969bbdb89601e5226d65f9004b689bfb46e237a349ea297be3ea925d308f5ecd6a1ac5245e52221d15eb20c3041d6557061f086c1aa1c6c0a97848dba731071267b72e712ff3e3e93cec8b1fb39a73e4984477d74fea6f678f7859b448f8bc8746ace908f79f924d7dec3127ff6c54b7c4acc8d645bc5199b468b8698ddb926238e349d5e8e742e341bfc16381be93fe02a0ab204c9135a243d6ae405806890da171987ecce426a4fea13b7979bc8bf17c2442f6d2a56375cc45a2a611e5d5c1ba140b205a6e301cbe1630c88c36d0c1462e831e64ec6fb018db6b6c9708e7c339e36cc79c623eebdd5f29b938be0c2811f87967178f27ac69ef6e1e6ef582440ed2eb617edabec1c98d30e06e9f650931d63991e5752de806dadf6cc81eec5f6fc8953108c605c8a8883dae79d5584bc7c3d1333ff497286b5103a8109b5c27872ba9c6f4573c1614a3b4414706592403f597e1e8bc38eeb74163f62da0a3690d3b40f5c1079484b4ee44a038d96e0c25db317e459f24dfd86552c49ac50fdef70b16686e68eb6490399fc2ec7a9e3a71099b477476bee3c4c2829e828006843d91accb3b558e2c8ae41ffd40092fae7a909dc5d5d3bcc24924d9c91f5d34e2e0b8be21e2333d082518a504f583d06e137d04778d6eb98024fde689edd0c60a3bd56ca29a24bbce7f25d9a47c3d73a647aae9666a7228853810f1b1dfed42003f7552f7b997e7d072e3a857090700ed369226fbee4e42eb67956db757dd28c8e34ecbafd23f382e5064951e74cfb8f165646e186ded8f07538015c8ede4e43aeff148a1786d037e58408dfb05a6f23a2a9bfa68db60e3123af5e9a18258ef2a1c9113417acc241535e40e42575d8358629eda5df4cc00d6e33c884a38d7d179aae2bb5c1b10e29d925ca2498e55af814d87f062dc4baf9ed04dd8025ee7e1fe014caebd1615f64dbbd1ff1fb6496054e45f43b5ee08b981773e9ab83c6209a7e4177e2613c6b2e314494e2032218a5226c14ddeb9b2becffccba70a4bf69ed68186e616fa52a12d53829b872ebea585aeb849581be1c51cae3f241a0991854c7f02bdfdd73994d1071f53fc5f7c6224365d1bbb2ba98a69b7a65f417b990ebe167572561c7d8557963f3bdcb1081f991247ff0c633f256794a9f0845f66a0879154b61290182d6e32573ae5dd781556d25fbfe355b1b8fca0de8e0bd211204c4d17d89a3fa79c9b0a426735b6b9bc0e322f9a040d9f0e8eb4ffc647493c2dffe748c789dee2f8270fd1d0e86637ab0cf403230a5698198918d75f91b1b0ef4dbd73ac54e109ef7ff4d68e0ce93d11a15a86189fb6a0d660bc6c97a5464bc5e757eb54c4fab68db7b04cc5c4c208c8ffa4e0da947ce7f4e84ea45fc21bec2f154745948bde90dccfef1d9709e350b7ef62007617e0e31fa5514f497420fc622f01db4eee57f15220bae6e3040ab41821faa2017a3a0b2610b1a1f322e488ce058bdd96cff2401c7a009ac825eb336d65d31d201e4453992adc7f66edaf7d6ebf5d7464c0decef042bf882b591d424c1c5d2f40886456cfdf12abab453026757ea339ea83d5bc6251220fbcd32f836b198987b31a2d39331e851d2cc89a1cc62c30ac312eced4f0e9d1c2fd84b36ae621f3bc4be42b69f7fb689665a9722dfa88e5a1bd87e598f188879fac896d86e830bda20f158bd33777034375a243293194c31558f885d39b64325af321154984b5ffaf4d2f5e83f485e7ca342dac5c4b34b3a81197d18e9282cdc29651b598b8110bc147478faae7963dbaf0c750d26a2cc75c71da533750f46761c7bacf6776a0232815f681a4ee82c5ee39f01df5d5b850ec8acb5f10d5aadb949844d6d06907a7cc38c7889703f045bac299146270e143096c703aab23cca0679f49552cbac3efc8eabd2fe777d2bcf4941eadfd3c09090ff0ee4b7165f1f57f1587b0180b18a783eb5b6a53c0af281296cd42a429858110d62d8fefdd26120255b4fe4487b47f99b0db7e7d523b4d0a22a05d45c36d8f85e94c94557679f2ec24ed506fb2d8b855ae19e51e30ec68aa7d3d60ef088c36610624ea44409f48cceab8a7451988d751153be79dfec13574c57763fd5305fd20e0b74303b14831ca9e9374b5a0b67950fc4bd14307b2afa66cc03699bfbdf3e7ea19f377abf89e9916e9c0d1bbef50ccafd15c1c9d13765923af81fbd1594d3660d741ed27b5559b70cd4412e630e27766aa3d226588fa63067fc38a4e1e68bd15191a1c482f27256532717db96d7bb6364a3d414ec8c7c6373b4bcc184b99ce0120c9cae8786dbba90a7a9aa7381385909a06f3304c6e63637f80fe094b85b331088665d11bf59324ecdd085c5c8a287c6c2d7b02c6f220e10736cf9b12eeb80528078c58745e26349e50134c0b513c5e8178f71160968e29b94f506f214be60c1fa5c8afc80b4f1005ac14d77605c673e8ce17bb507ceabccb5d83137838491e1fe8f7a719fe80a339e5c93876f7ee0400a7f061aaac9db5c3c06686812b1659f34c7949c9e2e0fcd63fda8988860fd9930b8c909490c33594d8e984db31986090e308e8a35ae581265cfaa10cbe027d3219cfccbcf80176c25f317c18c24deac83b7f1242c08d582fb14311653f03d67a8de5836938bdbde7fa252026d1961baa98bd063f60c530a231c565b0b74e826dcdb1fb127ad0e568035e9daaec2ad1425cbe9eabdbc8db879cda00fe8e1f6dd33140d207ad9630564f4f0f62195907f6aab52790fd7e1fa6b19ad6d9a2e519874ba023af523d7f99b4b70843b11e72950a92d4704e3d2e5242cf61ba26e1e1481c0c6579a369aa70b4d272dfe4656801a6087d7525d7cb4ae601c76348fbc403ca89f7dccc0f51af614bcadb7470e3cef4375454ca3f23068f58f8de5a5eef6e3cbd75cf0a30cbf2096a5827b93a95b3b027fdb1de02467b9e12c6f8be3e7c4273c2215766d38f0ec2ef6980df5d10233f8b726f450fadc27464af63cd1eee46bb52592d93dcf303e0c9ece31b0efad6208386eccacbc4a95f3eab7a359d20d8e4f377d93f11bb0b69ba0f8b2844acb58b9d21be4666f8c9166e6d3a10e17b01093dfa589f67b44ff5e9db55bfd3bf7ef3d25195b58237d436dfe6d1bf79c2a1aa516e061130746aa11d9b75149ba708e96d19b7a5444dcdc29b763f37988252f72883359b0bbd84a91738902e1968c3697e1acdf105869e896a709359edd9695573807bdc172dd2369e97e6e5c93b6d76cbbfd12e297a2cce927d34c8bcbeff7b47cb319c84a120b68a98bee74c02e7f7878a4f2a7e1dabfbbcfbbc53316a7ecd7763798255e23540254b84a4426d692a0ce5b8f8eff571154a5b1092083214f755412a9160e413002ee3d64c8bbf5d9c04cf6548c5801e3a7186ec402b3cbf5257c04e502d4a9d9a602e0abe94e64a3695ca6b49a32e81baa0d1db7d54e08985da9847ba1ec4590773f35fc4a34afcdac8c1f86f7193545e970d4e3ed08979490ca8263bd1b22a102a4601bb7e76c9b67b8d45197e2bb9a907318e90a650d48979ba9273e3652ebffac208f0cb8ec19c652928b9761e2f24b5b732a1422516c6ea543e1d16b91f5399456c0b1e070e22d3784769713e9e618c4fcb88c49ec348ec8fc15c60d0d8f6860976427e392b8cb8e9ce07e765c97fcc1af8f2ddbd45576a16fab5ce46ecfcec2b7029df345d59cdf9835349c6084b9dcef9098bed66c2ca5afb600d7bc7a778adae89019371105f029d5f3a16f838a0095f71bbd8c2a2fbb4382080775da2c8d949c4b0f24f490e859467797eebe329bfeebc56da6d312981c4678847d570361a9b82e50f35a8f6110e2866d4f2d18c027ac5cb2fe21df5ec7489fda5f5dde3c273e03dc0338d9ecc7b3aa5620b3d6c5b71f6477f2fc9ad4ac0e2ea1c05fa96f2c426d17bbb4065ef16c7fa916f7f9c77d30c0f03b56f0b0e2cf8968f1b745d9191c8ded64f1bc6dc35d416fa99743ea397191c91b10efd62c687fde55af01e55808d1a5b4f4ff5df547c1b35b623fee5497c3d2a058f3b5699ca82f881c1c2ff87a746c70bcbf82c0cb227775da03362f2a905732c561ce4c7703bcb662e33b0901e683fe5a532fb1f30c7702984274f311ef9167c5221ac196636ede016ed183f5df3576a424c55af56c411f6baf69d76e675f757c80a3c6f10eaf28cc12b2084203d6388b07966c27d59f28f090d692ba1d80dd448b58952b89f9285500f7d639bee8a223a2c91cfd9f044b6377e6785a2fefb34052aa3e2365d6a40b756bde00ae0817602696a274233052eea2025ec74fb8451758e5ff047c9f3960c029ccdcdf3c5afe14e4420be53d6076c0e08c90c9dd54e3ce5c8ebabc78a28608c2de0f28fddf835b874e28f27e84cb7be71fb3f7f800b8af9bfb52343fa369253368395db2fdebb83227ea27b113d2708e2978887c64392fb9a8cf824cb7c7730e58cbea27065f15b487c3e19f8a789b96e32766b7988605fbd6f6c92f6d93caa00bcd76c267be835c32d3f427c569d226644b3f09a4a0d1bfd762c1adad4d6d8b3ebab643ee4368107760fbf4c46c7d02e374020b429ee9eb303738feaec642d607a54aa9a493b2738ef036fcd6cb5782affb035b51201cd822a78b9249e282a1250015eefe02ba9179b4d1ad2879e14dce732d2cb7e608695036d80dbe833f86240d2a954546d0f745494b925cf36e4c7fc5664887c736ac734087f95a86d1bdd820b5620530dfbc933a2d7a992621a257454bef8db450b5df26c6508721da3d45ad9348957859e7b3ad9cc95199060b1e3cc1205459ba51c8e11c696bb84e7a100f427750555fcc176f240c70881216326e31e37c0365eb01f608594642406f44dfcc0a0e331cc34db2eebc7628fa4b5647e533aa3e21819454a05ce104f4344d858daf15bc34c7cab8e4d076977055a20401f46957b797efa6a8d64fa9a02816bf6431ca9d2d8bc9d8f672053a457fd8f7010dfd13ca9881b3bb358e57c2da8268715c390208ec1f3308be4718301e0b263621418e33fde922f7ad7f246c245f01c95440935e445003ea27c6060300719c024f3935c68b4fff4c228594829e9b0b116cf0eab71e156eab66825a60bdf20f83213b5057b24f7d93cb9e2ad479633c4f69f54f99522fc3001a87840e9c65311022b6adf4e4a7ec206744c287dc80403bd3cbc9ae0eef4f19e3d60701878b7d3e9fce9eb726f534efab068d85db6050c5015b1eb862df5392b026fe548d1d4cbf4a0f2d38f49d586b4db3331cd65624a7110ce48c317ff5db764394fb30d2a3e53a0e48f9b983f879c35b8676207e0d67d71b9a8388f8cf9db7b258a255dd481d7419c21312c3d6db4b4dd62b03f0b9ac6d78e03a43fca2890e82f9cd1b3881cff6d6e3f129621ba33166a84020ec8193f52bd99aaa93ab548cd300fd13c90c195e16d4e3b52e204db330ea7666c9fed559caf411edb1f1e488c73246f5e22fb8af5f42b8319bff80e298045e7dca805b9c7346ea859ff17e333744d5363d71a86f8db22f0454e12ad7dca3f6423e0ce9fb9e312c5992e1122f23dda8b43bc7b9eb0b5b0c79d11c82fcaacf88c1fe50b7b5c5c757bc1a012d274210c4e47e8d7159be84e40c32d830cdc10ac8116c20d9e1497c73c69849a25913975c01a4a4cbc4a4cc531703cc6f41f2b902b5240eccedfe49f1eda24df107b65297aa51b29c2fb59a9e422812446f2f5de33c3246730c9c0b82f59480acc6f9052541ebb3d234356acf80cc960d9b896d023adcd544f613737c99875d2bc7f49214e2c08ef907cf5697b3e0912de0883719ab6f5b306bbe15515d10c194c8e624804ab7980f2c9b4b4a6e3ff6311c018c9f11020a2067a2a1a7a74ccb382d300c0353a853d8380f122c06d7307e9f98ef5e8f5717c05e3f06dab23963539bdbaa39ada6bb05c32a711b3514faa1064bb63628fc2723873f2550efc78231cd1738dbc414f0792af2af5b1a1086f4ecb2f768e7a75f133fa59e0cd67ed9a085218047b1fb89f74643ca32381735a3fa0736008a22529496529bcdd95751d430930ed2f67c0b2c6cbc8b0f9bc904d5c1edd36d34e2af67c404b4925e973415b95d5c4d9150305d3180de0eaffd776b6cf07d5135cdb02a421a0eb11f0878567927d001dfc8b2ca466b930dae0a8d083a9949da7a156783510f8e442e52d0387dd5f79974b7185fcffda4d763101f89411e7baf80377c5f95a6a2701a66cd7d3ad5ceab34b8b4a620286f741ba1be478b3082da8b1d8f0319f3bb30a7dfc17a9d0db277b59445fc0a1ab68a39307467ab0c2ac1aa75ec77a66fe9fc6ad7d8df930c20c060e4377cf0a100251c2f328c83bdccbddfd9a6afa31cb88fb61f7824467fa7b60598c5002817bad238b86ee7b547bae69788a54dcd046d4c71c652d09cc6aac2e4acd01d0eb7d83fcc8c5acab807b993e0a9b2e01624923376fb7069aa63dfcba033b44133c98f9d0c9c5cde5c393c40a970c49e781377c25d5332ba0923e40acd95ddaae0e96dea70cc24b5e0fe65f51f25be38b7916939a17c26e631f0d28b0cf3c34c13c25354eb20d218dcf0e74e22918a8cb8c5d75bc7bb3b6214f7e2ef61f1a561c9ba4922343dc2d39ace3d275fe281aed38df98074a25ea17c9e0b8aacd73cccc540d6314bb94101bf7621f77ee648422fe93dce8d0cebf91fae13f2d6868933911992a3168819a8555ca96c7bfcdffd6343fe3e73393dd798f22a8d1c51adbb399dae7451541cd77cd86c4b96c8baaf3bf3a50bd6c4c20edf01b659ac3f805efb156e1e3743297e669c1e65870540085eb1e52e7e6d8dc6ad4cc46f37fd7575f67813778341dbbb94c2efd83a1d0b6ed08bbe1e6251e82c8d070ee7967924bafa2b786bb510d500a22f9a8a03cb6a7ecad94ff47e5b666a56ae3be9c2de724cb9bd14d16f9972a83d5e5cff3b98cac468f3c8f0d8fcfde56879977b345e85c8411aaba34bba4fdf22fe3ce4d7ead4fc2860936bc23d84815a9454fdbd28ca6dc4c887bebbd86344ec22126c3689371738eb421247f5283e6bcd0bb3a618aa5c4083e1ac46fc45babe5d1afa666de7f7dc314c09c0f50a767c81d5c9838cdf2c84571f166222162946e76adbda93c0f915bf454ea000f396b72aa0db6b83f36fc45560ab880c4bd084815d85ed36f2e1986f718353218c515be5206f18da059930b89f758ca6bb77ca2e5ad6c6ea1fed51b606312d83f9f1a5537d95d9846cb8b81d32bc386bd9bc954e904f275a462f2b29b4fd4c3396cec25665b0fd6ef29eb168efd33b2cd7b46c07887a269b60b3598d639e7229402bd9a3a46f5fdb04b1cf0a3fda2ab6db995b6e7efc4bb487bf09d4967834cc1fd1ea2977d2a3922c6d05c6e9a9ec4cddd4905ee171564281d81e80edc4ed531e546804999403adb7d1076b30973b6a7830c896dddfd2aebd7aa363711d1e9d46c83a1cb67bf1f0ceacd1aabef8cad5beec4036bb7449bd5ea7a8da4328843dd041c8671a62239f8a877c71f98099fe31023b8d9ac992169e31558eaf2d01d060a76bd23ae3a97f8c8b4e5163120143de62860b439045fca65fbccaee8d8aebed141de1c143dffcaceac9bfbee407288c3c707f065a747882dc4ea539ba1f7b7a01ca1723c0d12bca575d14481e6430c4a1ab775cfd54201ca4c6a3ee0a4e8260bb6d04c1f888da96f68b1c68d312d2e8cf24cc85024494be42c760fd5951091ea35a24048f50f0849d9aecbd49d205704e4b8b671e936f89d94a5020659c1f9f9354ddced64d0e1deb88739657381e5782ff28c3083ac9866b7a90c952b11c9ac9c2d330b4b6eb41b34c270b3a64f5d0a6a8a98426c12ae96b00e0844262e9ff2b6c7afd4e8398e99b3fb9bd957ee166ae1dc637c27f1d8be534a2313640ab19fe3003b65fd84ed70ed1b6d9fc01e54909bd4400985501d67c4a7a253cf139cc4ee1664d97b671d2f70fc46cfb5f6c1a126d1f850c790f8da8135e9a60bbcf82c91a58ae8f90919b3216c096001364c82852079e44ce933b9b809da0b08282644ab49f132992d68e3c4929491c4295c119366d4b39ea4525489ba4b3f3605ecfd8b7610e6ed24fd9e25274ec75a2183d29cfc2a2621ea26144336e38e5c5509df18bb03a3e971237a3ea19bdb2a0e639296f289e925485912e911c1111ec06227785f5e898f08229c3d28a2e4b1ab830853cd1c0ad644cf66b3d374e33bc0093c8bbde6312983addc37ec0ce8be80ed46deec641bb889fed5bed462bf90be2e6b1382d82be41eb795b85fbc19f0d0ec44a77a123871bd4ae03da980f2d1dbca584fdb19edcfc54f31b0a7b5fbd6875be6bbf7819ed795f0eff1b94b1b6f3c629136bdbc0fbae92106e7f29052e7cb191c01fcbb76683e7518e621145807670112faedd7856803e70d25d273234346d0da4c5af4f94b806fbb3d43ae6bcabf0376c401d969b38491fca03b1114339d3a72c34a805509b398d6a845f6f8eb0b1189c86c7f72954e2a0084221394e5b6e7877609ed301cdc63e54c79c1a98813467af2474a717e1f2403de1e857b6a16dd38e4a032c7557b042850e140f9b5f21620a1ea5a4add8c4725cf22182668e00b68885ed5d2977106391a1abe027d54b0520b6284d5d7606669028d68585158de5e97e21f366378546645806588a075faad57050dadc64b585f0f506525e8ad6d73d19b8a810b3ac72aaf0f9bdbef9259f744cb3708da7070eb21d141b844e6acbb64bef831192b9388b4bdf059957687e189c6e9f9dd6fc44e0d59067605c878ff1b8db0f1db300829c4446d150d410189e7f4c0015296b2c21272eb6f7bf66ae5997e6555b8696ce1d85cac94531c1fd85d013826c1b55bd653918ab3dc76830d59ae0c0ba19c13d4f7426188ea5305c266413b70c7953d4ec38c02e8d2356f42367fb6cc836bbeaf1b326c687e79feb3a615c7e9aef6fae626340a22a13ca451b7e7e31b2684ba5dca55aea4c08dea92da584a2d1afb7de72c0223d76b6643ff705ba7eca10f68183bc8ff1ad1f0c3eb6854758fd7279a1188fd934ff08e4e5487fdfce2f540e8984441fcf3513d83b050d3040d323b830811259b71cebbcfe3ca4e761cc080f8576b0d209ca46cbfe9faf1427ae4d69696a6b90bc0aa23d8e353a82d9714705d89723cb858df677be38d5f9602d05f3d68a2130bb9d2a9bc426e09a48f27348fcbc85772829cd2cf7ba28520c69ac73d73cee2ffc1f5c27d9abe3e20e1d6c52c227dff039a51de9baf52edd67fdd3c076f7a03f982523a99b292fa620c5151538ed3aa76692b51ec47dbb8ddfeda1089a9f0ed615c50cba9ecbffb163e6a56f3d67a0689962d8ed5fc47cb0dbad99a96f7def44896aa248c606a2ee51600bee4d93ab5b7c0c4297e2a47cb52ea1cb4dfd3cda5daa4a7ba8277566731b51459fe45e2849385c8df6dc5dd7faca2fd7a123aa52cfe331e0c730130681b342518faa74b20cf49aff7b1c07ae6bae495b5fb454de1eec22cc7a0e45b1816e69a369351c160ab27d02df806a275c1fc2e0bcd2092e0c16e1587f360e0a1685ed8fd5889fe307ef0d4961e3f7dba05c2ebc32a3eff4df9ed6bb3be2460f79cc84b711887222878dd4b41155a40be8095ace3200810fd730b8100ef19913826d08a7da8c4e745c4b4d0c647fd9b0f234c07d6f3059f71fb89992fcf3693188b2bddcee9e7ccdff001162ea3a655b27b79295d8014eec1ec5508e700b5bb1ddc6da3cfad13c3aedb54f24e82f91e1036b830cec58c26221f07028290cef0fae67c9c84af959d10a5ce648f36bfdfcd7853eb2017025426098e6caa8d94c21ec8ccc8a347b6d5c1deecf400db922202eea119dbda69b6755ad4e46705a3e651ddddd9a8e19b1e3c3ee7e885ab8518f51be3af259b24230c9ce023aa3d844cdba34a612e202ccbc097a2b07164d34acac8cbef184b565cdff3f634dd4d94375ef579e42dffaa25050d1dddbdce8060e4fcf7fe177f2a8f33ae29e81bd8d173586063453e8fe5abecc5e0abcbe39fb369e6144677f231584f792c737350518a3e039f3f21f86bf2dd172f55f749c8b721d2c1ffc8b4e8adb5068d1935b0874b489e718ec1c1674db0013da94ebd9ea5c4949eb4e81df3e6d3e5b510a1b91159b36aa5c4eef24013f14b64717fd2a72b3f76acf057ffdf0c83846b0fbca83a0b6194f72eec17b79589f237ccb06214ad0877b7f2998249d3506aa3bef4d5a1823a28df651c4c736fbd8700e7ef05187b2e780c5efa926739b4fc60723964bfaec75f3c70a07ea032f343e3c9d772cd45f2bb119e0f5124de5aa2a64c4d1c364a458b0bd5bb86694106aa0d3c7f8929b44124c01e7c5d9b912a9e034f19a4b02f28d13a417a0257b06cf12209b7a6e49aeb278304fd8855a4a554f2479f13cc578261f5d21737f0269ad9b334d08151e5861d100a594fa325aead93ce5ec4d52e57a99a259d23d5bf73c6ec9f5fbd1b0b087de1b2049d2f91ed6480600efd176d681e0fac5bf9fe67c120cf2cfb601732c60faa95323322a5b1ee48fb6aff67ae8c13da331ec95d03d2ec61d5065775d4bced8f88664aa7256cc9b7f983881c5b16d6501152f20181cf29f4032755a33ec43c31042a16f187fb6b2ac111d7d190b38c3128b7e74c80d1a6af7eb57a2d7bd18199431148a4f10d607f2c53a8b2cc9fe9598789535fef461ee69b1c9516edcb01afd2d05cde11e1b620f83080a4decea96d5f58d2d8c70f6840874c3b06443596eca43725f8f04a940606094b956070b4ab3321724017f0b9e46a9e0d1b24ebd50bd6ec23c117ee2e1fb768cc89d067dafda0b7113ed18c49152d2fbc0d37546051c85de1db9306b5c8b0e7719021a26df7878e5af2142faa682ce0e6b2a3abdbe785794a97c420b6e5338029ffb791ca5c88fbb8a446bf3c30464095d7db7e14999106ef8ef1c7188de2a4f2368f2e7c21c471ebb1a06935d1eeef3eb6379e0f2fd47acac385ed62abf085bb6dda69af9b1888137e7aa6e64e07f9bef5a67d53de96b2663de90a49f255ddf537e7d776622c885e94097a50b3651b6c5abe804c5aa3ad4d8637a292ab68953da098579ae08477703a72a3dee7a7c404bbe94d4db7fb4a7a850038ca0dc18e87c18a6724847eda17ebcf2ebc7026a374438fe52ebaaaf96ac84c536bb016a0359303363927651873182e5d1c3c6f7c30bcc7de794cae3aee5ab32d12930c338e7909061708e4a3db06085b19d5949a7719131d581e5dac74172c2d1dca468ab2a17e897b3c611e57f5a988eea50b3db8bbf24618a2114fb18e533576d246bbedd3e4217e5702e64f1f8117b8be59beb1df4ba4c7b1f132fc955f97616ea321a07e6bce02173d1f0aa60d214120a3d6dee903feada7b4416207196d9842976c763825caf76e259813469fbe993a74a5dadb5a77788964e842d2559a6c8a7ddd71549aacb3e91fb19b97ed3395b9a4ee1f6f38d4038b1c4956742f2c803df81f5197ab9cf1bf426a76370ce17f61d984691be7fe28a4a909ed8bf9d578698f031be77066b650e60b22d107acd2a2b7cb60c95700102d566126b64f19f2d79b8968d73df5b6ef1878c4d3291bf8cd6305dd43b6bb7027f925516a21ed8c738461eee5c6bdd7c66c18bc0bb6bc3b2c83eb7d6811d5f818cead2b90edc014a778688087059974276f843c9d8ab615cea56932896cc2220f45011762602216060a46cacb5a98fc6dbe2f916a43916812c805a2db921f67a73d938e77a212ec66ef78e32c6612d1e256030b0c8a5b61525b3980edf0281f25efa6bbb8304adb3423f4e60c8065d55bf3a39c7211c98733edb7a12d424592b97a5f5f0ffb85be0a29e40baa398dc284d22eaff12b990b161c395b5e892cacc3013f17531b0d5ab7901b181221cd8dec05fd9818d734edd55e8b235e7fa871e45c9c65fde1ef590f22645e3d73fd2d36722f9c6786e627bc1326f6dbe4ec1f1eed358c37058f5ee8bb53065a0eb8b24618b83fe66fd885ab8face9197aa728111fe9a64f01f21096101ac6ecdf7c8af0a990f0c2a3106112c5210ea88f8a23ac62a692f39d5ae95282cebb1a00381f5d2ded2be888b1b6cf579a62c49cbdaed96c5cdcdf56724ca7521a6c0bfd1c692f89e2753073f0015a247ebc19893c26c0abb758480865c654f247e2853edf7300d6d22eaec374bfe2f3b477f914f49cd3db6bb3b3919785a269368f9ad29761b28ebaed57c4466171ded28f9bcebb4dc6e349da5c43d7592703ab41c130a4aab8732ad472f90c723783ddcad219ac2afefa9e0a7731eb14e380d9e15aaeeae763bfb4c31ccea64280d01440a58bfb0f4210e58ebad96fbcbfae137c5e9c581ba13b7fd46d474f00698aafa5d7fbdeea72e09c30f350e2a25e5adbe393fd8e032d3178b231fb4db65563c742fc88309b882e16baab7a70b3ce0cf49f9ba920d446164b5aa43b738be482dec04b4ddcd61485000dcbdd54dce63096dd9ab7f598b50d93f27823ddad708c8fca175d542742b98864294224091529b96493d3a8f0a51ad8803694328ee0b18b2ec60c136cecc075abf21322bfe15ee21e74e41195a26006fac6f4322136e9c8a34551b78c1bcce5647ae106cf19e12d41bd325b16b5b74e44938acde04c7ab60da653964a03eb02c520ecb409ef3d7448a24ecce2d5e5374bba55ed275c134b65891405513e4039f402843bfe89b09bdee47d2b7841062076e3ad57c5c3a72f80d6908ca4884ccb3110f61cb0476fc58efcdb6d1ab328cf747c7e7a95b4f735611c2d188562ed910e3cb985f49be807a68ffa7a2f42501c7adeaaa6ff06134125ff79083cc980e09c99cd453d55e15a756a424bcf7bb173fcade6c4e6315a7928c44c64c0c49fd7d442e83bea3ae7421e3d07e24280e16b81aaaaadca5cf1809b5b9d63ef9c830a17c820f1f1dba4fe93de5a9d581dff6054e86a13b344ac912df5abca58b8c78d55c6a514f47e8964f20ef7b0f8292bcb8f394f0fb00ce63b781694d8dc505074334720032f0dc37d2a695ec340b92cf987b7aee5273aa059238b10a843ea00dfdefb97fc91927feedcb7cdfbed4ea39b2593ce77c8e1677ee89806eed1cfc3b837ab06df2b5f9d9dbdd1d9847ab33f80e5b9f8c1e3e511573b7025f8972bba57907545fd30ff08fe517927186e551a516352af97088eb249ce7f4ebed007c014dc1b6a4e6b3a9b2f005d091bf653230deaf4bfe2b2d6fe7a41bae3c883ff47892323d1a48bff5bb69c41030a4a12f7863cbfd5aae8517980c73548b18c7c8fef33e7a4a3ba5f4b1fde3cd729d7017085c32845bb8cee1ee018325d9c12a1bcd4ff2958e4444ca23f2ac0b75888f4c920e0ffad00e15cf8734c2c39fb3fb6d6ce4332e53451d160fad78c46d19109ad6793c9a36074fdf82fcf1b0ea662e2244a3d70d2da77a59950aec50d330cd5acfd7407d8d3a4fc626a86e9b95530a5fb35f0871dd5d426698210a8123e522ca1b1d6f5041f403a04a3fb1906ce1f7510ec8b49508734dbb216fb72054e68e9f9f164295e3303f6dbad583e9d241a3f3ed6f45c4f5046ebd8a80c77c3f628f124d160020631218daef99dc68423bfe13b18ce05a7000ccb68a9665c45593fadab6c5a73733db4f7326d6a7b211fe3564cb55811e6f3b90fa38f7102123842e7f348570d162d1ff9ee67207d342ab77bdd36586418bda603d2fea365b3f6e9f4a25713fd89bcc9992de4c3e239a939c624726a9253608c88f90c49a8eb9274e89702f47cd781534a578fb24f953d4a32b9e84dd64da7de438805172157e40459d2b81d9cf27a352dcc41eadceccd8c9bd85a42a50ad5a748c39196ef7472b4580293aaa5822c9c2b76e8ddff6be4b112346e47b8cb1b24a35fd8bd00f704c33f1abb5c8ae40ca8d01eea3423d10574023b32bcc7350987645f36a075f4772fb4fcb3937d8ea4a462b41b177da90e27188fabfcdb3414a7057d13af59406d6aec1611beb4a312edec0d53ba7528d5e407a5d6a0c610ddafd9d1f73868cce5aa518a4e657244d9cdeb5c9088a03d7e1f7865a456a1e7abb1ea26ad56c32beff43ad04ed52d657686a358da84011449bfd41b25978481f7e147be635782ea7cc254348c8d84f41340923ffdac90c1c0c7440eb5a459cffb5dcc43595017fd881077b8e9835987d85ec4f816f16053c7a3912a66d9365d76bba60a402850d541fb3af2fe5f9fcc9a1097edac69f597500bb0909bffc972c84291bb3f8de591545ff573e4cfb6a1df68bc37765ecf329757b47bebed67a55ad6b264ea7bbbb976d68a259efbdf54f4dbc9e52726a3d5ce6342730417283607899be292e484001576d5a177ce49e7f523866ffd21b7d252e5e32489c1a0c67bb1e348418934a602c60cb3cb33544deba36325bdfcd79c9630711a82a06cb4524d7f7b837357c6ef610e24617e8be2d8c2234a18dcbe0c851582ae49c5ba992133a7d81b3742e6dbada382d22fabcdfdbb1b09bc56580b0eaec9d80f7377450b1d918410342159996910ce12f8d529f37734f4404d5e4236d4946486c85655a91c953aa6dc2455e315df32f2ecb7958919d7f49bfda431f370b43520ffce221b6b0cdb029c53825b2c201d8784c32fb705f776ca768b3807edfdc390683f494f1889c4d7d5b3803bd9fd7a6e69d4bd6b0cef8e4431dde6d4e6c7a933252d1d45991c1ccf3b653a54f12ef59e359de3eaddb5eb8a61718d40050b9f42e508caa0efde4b8a59fa5e0d41a8a7205f44a80384c9fb8e19ed92e00e1d6f9a72310bb2064b649e5b7e768217517f1bffea51792038661fdfe4b09656499a5ebb2ab1c607363ac85993cfd5e1457a732697f30a9c47baa5745a03adecbcea3d49a21cf029ce93e381762fa2c0850fe9e41ea664492c27a84effa7fa35035fb889cae14f1dab65e3b06b6bfb1f1a609f7c40a8ff4ca760c590e5f86b45e9ad88bd8bd7bcaf84159c90fb8dd3cae716bb060cc117f7faa5da6bb4423d30ecfef5a8ee882326ea36e4c4ea3ed2ce133fbbc09268def8abad79e1b0b099843f69aa093638be790bb1c112e9224b2561aa87c61459968787801e3c33f2a66c397fda03723aba6f7f6ccf7de0c0ce9bd977fea87e6dbce8bdbfe316acdfce6454ac13e6dbda8452130749948d706edb5f3d9e64779acbc315e3da9a4b20cc101976cf0011903f55f71f48c741004f6f46d2e6867d72a0767d3cb62dba5fd90cefdc169aa51d6deb8d15f09c8e0f3dc9ce70a227c0d83a3a0b8c687d0d6611b167922806055f9c49d8a447007045bcfdda646447c4e31d99ce10034b35d6ebb9fbcbf1b37f151502671fe8f7ce8ff68ac1adcdcea4a6a805ecf26eaf97c83d9fce23c8788ad225628c09435b24374f40b58d5b751c4a2c2ca9b9d7ded2a578767eb75972f489573da9c83cecf0ada7cff45de23107fa21087c3a8b59a4ae2ae4b3007604165ee2fe4f2e4d34083d6a745b6a75b6a0ec6b7cd74d47e4b26f0fad12c88655cb05f689dfb736520be5efb140c6aadecff7058740390f4ea8c6992d2ee653b092b208473ce12b15a7019b0e8c6605201925e380494b4a3db2db540d4b537352a26b9ed1adfc81a974f9e6eded5d5781f73cb1ecded619c4153ba3278da473d2d1474cd142b007a6f0d7ec6695c5f5e45bcdc61e9180fe6228a460a0831d7e28a90e6341a195482fe185e1d07f8708d5076101f561551ae0ed0954187af47e6c8eb56a838f045070f768133fe217a76615f50ae897828242551b89ac1865b99fe68bcff5b88086fe8e1a37719440575f3b51125023ed7334358221d734aea902f4356a1172abcba57b5701c4ee30acba4590c6533e78b0534641cc30ca2f15eaefd9b43e2b7cd49d726229420b9e81353103aec5c219d108d719e093c5d88b6c06c5f04f5861c3cb5f23a727fa9f7d2cb261041314f775968e583cb432a7ecb891629c05fd4030e920ffef31c44a4ac486051bd8b7c85179f11979e832daa2944c5c4d5eafaae48db590b5acb0527f04d72037a620dc5050420fe8477c1406cf6d2a1e62e01ea7d395eb02ddf6541fc73ea9781365eb27e28abb20ad0bef5c5f9262064988a035f7e407711efb0d55c440aff1a3205e0c50821f3a9e3b74a899f6eecbd12f37773823db98e902d44c75bc9c00632235c36a3efbf0c416c91cb023f1876744bea4b86f00998820c916e1a48b2bab9b275ac3ffacb4b356bc4bb0cfbe98df8d06ab4fa8628d80b85ceadb3580c38b820acb026120117d8ed2a9e9d73e2110ae27971a010f69319609198ef49902560270be47d262184241ca98dd3a7f20e6b677ee9aa28055c8f8b5e5ef067b05c8e9383a6feccf5cfb3d73b567a6eba71730586d4391bd122bb8f95ac6220d03e7f882a812e7012a5758bfafbe37bba11be042d2decc430e0de68c44965f2882afbff156870596a2f9bb0358d2788b29cf5e7f858c786d850f14465734c9bae14e06cd88b4e2ef6d86b6117d11438ce5d7adf5ce70691c2061abb0e4ad95e4c695ad5aab9cce5df9ff3536577b69f994638d7df0ef06bd3e9e45ccaee866841f72b61c2d3ea265d8201ca10b75d5cf8b4bcec291d41f3b1e03da893afd4a1ec1823f03f25707ab28b9e6aa5810ace4ad2cd372f543248cf38cb272ad2f7dc36a71e0ec3ebc3ed88931c818a28d7b7764255c2b840fa6a9bfa94a8bb447aa4c43896e3f9a8a4491992cd2d77548184bead970556c3872dcf4bb924d92f0f16605040f701d368a4cdcfb1bc9f53a496512f4ec36c95a40f2d23b8c93402eecc754b64fc84a9516b310330f9687cf029c04dd37e9980988eb7dadc7020358606ec3e9be219850ef2d0c8165684c07aba3fa90f53289ebefbb0969686063f56ce65e78bd6d9a74d0997bc25bf15ae6c41f13fefc4e002e7a5694df7eeaf10f5ff8a53e030eb153f9d5f27664069009553c6f8eb36ac8478f7aa59c7e16fa6e1500b4b2a3940f49bb9f3d045e15a48e53f8a56752cc9fffbe12b16e7c4b95b8964a5c48f5187b9921d8f1bfe4366bd2e0bf448c8aba8eb5489f06114fec7c233925030e68a9b5b022050b72fff20802d2d083e5d15288d7f86219deb650c955d95c9d8aa91107e780494d12580ace5503b731a91cf67cfd8cad90f70a25787a827a8b847a8c3a2b01cfc1745b69c3c2c761fb856fa4ca601d0cd1bcb1cf33fdc60fedd6b34c8aac90f45e2266ab0381b76b68ef601aac16f4a0623e0c18d1327741ddf0fc5743d99c5ee2f5998da124dbb09606b733a5972eadd85c1c934ac3d8c01f39618e1319dd81c62b4bc66be262e84becfa577eb4446090b576aa250825e0e464feaa9f0a03d3285cec8d52ec38e3b6f045f1d2b7de4f1e43a4acaa0ce7600aee3cbe1c88765367a0b71f31b3154d364aa816cfa582ed6e006e98d1f301dcb4fc433a12881fa83717a9e5a9e03e6bcb80b99f033c3e2c2df440b962840d32f19487944781bc3c8960d4500f7e2cfa647aad0ebe7dea2d579ee7c89365366f429f8491125c8ccb9933300a6d3aa32c9ac27f8c6a51345736e8b2b0ede5f9ce982fc6f5aaad95b99af2857889732eb4ebd73437380ab89020434c2f56a359efdafd31e92a73458d3bb9312787b04db3bf0c6cae4d1c5f2bcc4d36fc8a39155f1729a9aa4fbb5b45119da54ce17a8a67186f7791698998cc65a4c4d4de445ad21f085d9dbbcff21119279e1bfb0b30bd96d22eed00ee464bc0e910d1f68c90889edd2273db5b599e552cdfa2c80ab8c3f8628157e75a56c820b6a658cde3bbaa5efe56330aea903a0a3ac2c8f18c0169a4c6ce1ab78994e11026829cf9dd5235dc63b5eb97a12b3e014558f4ac618ecc93f861571cebfcce6114084d54c3fc46783f9b8de1f55721be61376a5971460856a35fa98ecb240c9194e41915fa9052c0713ac538751cbd54ea67180f2f3bfda3e41fa3e077ab6e7d19c6cf31512db0c08349208aedf9e531ba7919970e542423720d4c0fbc7e0e42970592f1d58c891905a0875760e852a4d7a00ffd5d851e809ed3d2aeb7cbb8565091f7c93cd2528b80b66b1fd3714d33d02cd8465772032e58845dae63c5626dc1774aa256e5ce57b456a75a446dad1f194f27f681e3674f77be868a9e6f2822bf69544ba6e0b0f6404c740cea9c3443376dafc3b29d2248adf3e1ca84a11e01cffc0797f5d3c87012d03b6e8ab8bdbc41671448a373ca2abd5208a099e1876f4e94379bb49e6144c44b110713d883662a8a9c8e9a727bc5538b5dfb404507db3c0f230dfb034269975a8d87b6a6f697be8f27f4f529fdcc7d63859a2c381d9d49c06567ed5ef6b3bc5842bb0b10ec839b15283a5d90398f66072ec1811eea12fb64cf42e94118739fb918bf403d9ba70949248d347d4e5be95b11fc2fabbed54bec4b5db7c877028bc3b1dab839cbdf2e061b1966a61352880c25b009fe94a74c40352b18f520dd5f8f2a7523005034f41a6951c63b496698c66b5372d7462f3ea5b1d8c28618cbb4fde50008a530ebb13b44869b7bfe16cf71bc76a36cd9e8cab50524d3ad651f0bc8b7afc9e4d43ff89d9885cfd6fb40d0acdfd3f4e8dac8d6eab4d8e608c21b3e90b261dec0fd0791846bbdd300a6871db49da517ef81cb07c665cf26f90347cc12f23a503e5204c665b60e4c00fc7ba0b3817209befe4047dd7409dc183b554c6990d13e63bc611b84a702c6cbf047ac80fff34d85b08e26e6d0f250262c011e9e99feb0cafafad1b66a74473c7d47668d835e53e14407c4e4e01fada9b57d8388ac9cbf8ceaa3b6fd0058157adf8418c14b49dcc2d70f6b25d83bebb8668f147a345c93456d283a7f1690354e64b7d285adea303820818a2f39aa531c2fba3b3f825d71ba7ce251b16662debf6326800a10e9bfc9f6f4c10df7a13732bd04a881c0f319b6617ea22d9792319b3cc6309bb9e91cce989e296873275432dd6c39ae5451e750deae86f2d3e4f8229508130bbc62a5b1f1b915ad2eee9b938e7e66f0ac35220572a1691c0204347f9e09373f96e53e5df5b3365bd07d341c57c731f08658740659497b6b22b6c01835b14fffb724566b76e1b4aec46949b3adc693c41c41fab39ddc93991c59e7e45b74ca2f12108add2cb68847405481f6b4f407ca49c4aec7021895597198c5c0520f3d4e14865a07f0a743f282c03940ccc6be1a48ba5a8e46fe23436964444ec43df35aad2e81756ef0d8ed1b1931a2f1fe81d4d7c7c2b473155ebf5928c6a8be7cfd0c8e2bc54e1281b1c500867cb76cf37e9a771fc3d8f811cde1ff9bd1ee750491da9db6d0d66a4b1bdadd268cb8e56143d896877201901ead94c1744ef508723c7ed3c306ddf9a70f73d2fd560daa5dbf1e0de72a403a5093f55d3811733b63bea92b5b828537ca9ec3bd23736aea93c1ebb6296119eccc29df8ce93ba4027a98cd91a72fc8f8c7d930ceffc26b12b39f3cbde599ba1f93544e8bd0dadb94ab92619bea1727a98319a276bc49fc3f2ba05ff8cc28bace90885868c218769203f82b24894656dde32e1a267d77ae2c3a5172fb980a1d642ff0512956e180b1fab652a43491095b46c11c11ecbced614c804b6cdbc1bf0e866fc582a1343d355aabc39725b6a44c162eaff9ca1bc8e5c3237195dc91b1d9d9aebeea0e8d7e2d3c3d6a6f095e90ccf1cfb87eca0beceef05b974ebf7ef0ea9f27a4ae79f2128a7e379e4c25cd7f0c199d44201e4ff58f40910eb879df1170f499b96c63f6f3a9bf6629203ec672b5a498010a5e46d076f386c0300a5470eee7bd8e98c9b6124f8ee0eadad803aff25dce03fb711ae126131be30cbbde14d4bcf7b11edb6a1ea8e1ec6584b0471b79c10f2beae51d7693cefc7a8f7beacb845f19b0800477529962f78296d915a7246ec81ac43ff0cfefa02f5e1dcb8e86874c9bec9277fc4f7df52c2d5c71d50690739198487d83a10d40a2d3eab54756f59b7cc1ec2c0ee64e9caab810006c521068d13ee8408c1005abdae7fd0d1c36c83aaf9feac5bb425cda44a3bf482916b0fd836110b6b984d01aba72d16c5822a6184eba413b5fd7ea6e91a9fd69d59dc01e62e09a75e6f8924086b3471070bc34ccc36d68a05774d79d823e2c0d9e9f781f858fb39ff805758ccc6a3e5f7fd1cc62adcb03a9ad4f2b912be3c1ddb03cdcbebb0e39209dd4dcf492dd4a357432c1af50e1288f5ae1fc2916cd5ccf696cb9299af9854f0e30305e051c379d2784947efec4b079ff5fa47cd0451417844be549b67fafb6b074335026c61b76a63d05d0e89b18ba</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-wave">      <input class="hbe hbe-input-field hbe-input-field-wave" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-wave" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-wave">æ–‡ç« è¢«åŠ å¯†äº†, è¯·è¾“å…¥å¯†ç æŸ¥çœ‹.</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-wave" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">ğŸ”’è¿™å¯æ˜¯å¥½ä¸œè¥¿å•Š~</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="åŠ å¯†æ–‡ç« " scheme="https://blog.liukairui.me/tags/%E5%8A%A0%E5%AF%86%E6%96%87%E7%AB%A0/"/>
    
  </entry>
  
  <entry>
    <title>VueConf 2022 - Vue çš„è¿›åŒ–å†ç¨‹</title>
    <link href="https://blog.liukairui.me/article/VueConf2022-Vue%E7%9A%84%E8%BF%9B%E5%8C%96%E5%8E%86%E7%A8%8B/"/>
    <id>https://blog.liukairui.me/article/VueConf2022-Vue%E7%9A%84%E8%BF%9B%E5%8C%96%E5%8E%86%E7%A8%8B/</id>
    <published>2022-12-12T16:00:01.000Z</published>
    <updated>2022-12-12T16:00:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åº“é˜¶æ®µlibrary-2013-2015">åº“é˜¶æ®µ(Library) 2013-2015</h2><p><strong>åº“ä¸æ¡†æ¶</strong>: åº“æ›´åƒæ˜¯ä¸€ä¸ªå°æ¨¡å—åµŒå…¥äºåœ¨å¤§é¡¹ç›®ä¸­,è€Œæ¡†æ¶åˆ™å®šä¹‰äº†ä¸€å¥—è‡ªå·±çš„å·¥ç¨‹å®è·µä¸é…å¥—å·¥å…·</p><p>åº“é˜¶æ®µå®ç°äº†åŸºäº ES5 getter/setter çš„å“åº”å¼ç³»ç»Ÿ, MVVM, æ¨¡æ¿æ•°æ®ç»‘å®š.å¹¶æ²¡æœ‰å¯¹æ„å»ºå·¥å…·ç­‰åšå‡ºé™åˆ¶</p><p>æ­¤æ—¶ Vue çš„ç»„ä»¶ä¸å“åº”å¼ç³»ç»Ÿå¼ºè€¦åˆ, æ²¡æœ‰ç¼–è¯‘è¿‡ç¨‹, ç›´æ¥å°†æ¨¡æ¿å®ä¾‹ä¸º DOMå¹¶éå†å®ç°æ•°æ®ç»‘å®š</p><h2 id="æ¡†æ¶é˜¶æ®µframework-phase-2015-2016">æ¡†æ¶é˜¶æ®µ(Framework Phase)2015-2016</h2><p>å®ç° Vue 1.0</p><ul><li>å¼•å…¥äº† Vue Router(SPA), vue-cli, Vuex(çŠ¶æ€ç®¡ç†) æ­¤æ—¶ Vueæ›´åƒæ˜¯ä¸€ä¸ªæ¡†æ¶äº†</li><li>å¼•å…¥äº† <code>v-bind</code>, <code>v-on</code>, <code>v-for</code>åŠå…¶ç¼©å†™</li><li>å®ç°äº†çƒ­æ›´æ–°ä¸ Scoped CSS</li></ul><h2id="é€šç”¨æ¡†æ¶é˜¶æ®µuniversal-framework-phase-2016-2019">é€šç”¨æ¡†æ¶é˜¶æ®µ(UniversalFramework Phase) 2016-2019</h2><p>å®Œå…¨é‡å†™, å®ç° Vue 2.0.</p><ul><li>å¼•å…¥äº†æ¨¡æ¿ç¼–è¯‘ Virtual DOM</li><li>å¼•å…¥äº†åŸºäº Virtual DOM çš„æœåŠ¡ç«¯æ¸²æŸ“</li><li>å¼•å…¥äº†åŸºäº Virtual DOM çš„è·¨ç«¯æ¸²æŸ“</li><li>æ‰‹åŠ¨å®ç°äº† TS å®šä¹‰</li><li>æ‰©å±•äº† vue-cli, å®Œæˆäº†å·¥å…·é“¾ä¸ vue çš„è§£ç»‘</li><li>2.1 å¼•å…¥äº†ä½œç”¨åŸŸæ’æ§½</li><li>2.2 å¼•å…¥äº†åŸºäºè·¯ç”±çš„ä»£ç åˆ†å‰²(SSR)</li><li>2.3 å¼•å…¥äº†åŸºäºè·¯ç”±çš„èµ„æºé¢„åŠ è½½(SSR, åŸºäº webpack ç”Ÿæˆçš„ manifestæ–‡ä»¶åˆ†æèµ„æºå¼•ç”¨å…³ç³»)</li><li>2.4 å¼•å…¥äº†å¼‚æ­¥ç»„ä»¶æ”¯æŒä¸ç¼–è¯‘è¾“å‡º(SSR)</li></ul><h2id="ç¼–è¯‘è¿è¡Œæ—¶æ··åˆé˜¶compilerruntime-hybrid-phase-2019-now">ç¼–è¯‘/è¿è¡Œæ—¶æ··åˆé˜¶(Compiler/RuntimeHybrid Phase) 2019-now</h2><p>Vue 2 çš„ç¼–è¯‘ä¸è¿è¡Œæ¨¡å—æ˜¯å®Œå…¨è§£è€¦çš„, ä¸¤è€…äº’ä¸é€šä¿¡æ¯,è¿™å¯¼è‡´ç¼–è¯‘å™¨ä¸è¿è¡Œæ—¶æ— æ³•åä½œä¼˜åŒ–.</p><p>Vue 3</p><ul><li>å®ç°äº†åŸºäºç¼–è¯‘ä¼˜åŒ–çš„ Virtual DOM æ€§èƒ½ç­–ç•¥(Block Tree,PatchFlags)</li><li>æå‡ºäº† Composition API(å½“æ—¶ä¹Ÿæå‡ºäº†åŸºäº class çš„ API, ä½†æ˜¯å› ä¸º classçš„è£…é¥°å™¨è¯­æ³•ä¸ç¨³å®š, æœ€åé€‰æ‹©äº† Composition API). åˆ‡æ¢ Composition API å<ul><li>å¯æ‰©å±•æ€§å¾—åˆ°äº†æ˜¾è‘—æå‡, é€»è¾‘æ˜“äºé‡ç»„, æŠ½å–, å¤ç”¨</li><li>TS æ›´åŠ å‹å¥½</li></ul></li><li>å®ç°äº†å®Œå…¨ä¼˜åŒ–çš„ SSR ç¼–è¯‘è¾“å‡º</li><li>å¼€å‘äº† Vite, å°† vue-cli åŠŸèƒ½éƒ¨åˆ†å‰¥ç¦»åˆ° Vite.</li><li>å®ç°äº†åŒä¸€ä»½æ¨¡ç‰ˆ,ä¸åŒçš„ç¼–è¯‘è¾“å‡º<ul><li>æµè§ˆå™¨: é«˜åº¦ä¼˜åŒ–çš„ Virtual DOM æ¸²æŸ“å‡½æ•°</li><li>SSR: buffer + å­—ç¬¦ä¸²æ‹¼æ¥</li><li>å°†æ¥: Vapor mode (æ—  Virtual DOM çš„æ¸²æŸ“ä»£ç )</li></ul></li><li>å•æ–‡ä»¶ç»„ä»¶è¯­æ³•ç³–<ul><li><code>&lt;script setup&gt;</code></li><li>CSS v-bind()</li><li>Reactivity Transform</li></ul></li><li>3.1 å¼•å…¥äº† Migration Build</li><li>3.2 å¼•å…¥äº† <code>&lt;script setup&gt;</code></li></ul><p>ç°åœ¨çš„ Vue3</p><ul><li>core: è¿è¡Œæ—¶, ç¼–è¯‘å™¨</li><li>æ–‡æ¡£</li><li>å·¥å…·é“¾ (create-vue)</li><li>SPA è·¯ç”± (Vue Router)</li><li>çŠ¶æ€ç®¡ç† (Pinia)</li><li>æµè§ˆå™¨å¼€å‘å·¥å…· (vue-devtools)</li><li>IDE æ”¯æŒ (Volar)</li><li>TypeScript æ”¯æŒ (å°† tsc æ‰©å±•ä¸º vue-tsc ä»¥æ”¯æŒ sfc æ£€æŸ¥)</li><li>é™æ€åˆ†æ (eslint-plugin-vue)</li><li>å•å…ƒæµ‹è¯• (<span class="citation"data-cites="vue/test-utils">@vue/test-utils</span>)</li></ul><h2 id="æœªæ¥">æœªæ¥</h2><ul><li>çŸ­æœŸ<ul><li>Reactivity Transform / Suspense ç¨³å®šåŒ–</li><li>SSR æ°´åˆæ”¹è¿› (lazy / on-demand / server-only)</li></ul></li><li>ä¸­åˆ°é•¿æœŸ<ul><li>Vapor mode (å— Solid å¯å‘çš„æ¨¡ç‰ˆç¼–è¯‘ç­–ç•¥)</li></ul></li></ul>]]></content>
    
    
    <summary type="html">å°¤é›¨æºª</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="å‰ç«¯æ¡†æ¶" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/"/>
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="å‰ç«¯æ¡†æ¶" scheme="https://blog.liukairui.me/tags/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/"/>
    
    <category term="Vue" scheme="https://blog.liukairui.me/tags/Vue/"/>
    
    <category term="VueConf" scheme="https://blog.liukairui.me/tags/VueConf/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€äº›å­—ç¬¦ç¼–ç è§„åˆ™</title>
    <link href="https://blog.liukairui.me/article/Unicode%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/"/>
    <id>https://blog.liukairui.me/article/Unicode%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/</id>
    <published>2022-12-11T16:00:01.000Z</published>
    <updated>2022-12-11T16:00:01.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="unicode-ç¼–ç è§„åˆ™">Unicode ç¼–ç è§„åˆ™</h1><blockquote><p>ä»¥ä¸‹éƒ¨åˆ†è½¬è‡ª: <span class="exturl" data-url="aHR0cHM6Ly93YW5nd2wubmV0L3N0YXRpYy9wYWdlcy91bmljb2RlLmh0bWw=">ä¸€æ–‡å½»åº•ææ‡‚Unicodeç¼–ç é—®é¢˜<i class="fa fa-external-link-alt"></i></span></p></blockquote><h2 id="ascii">ASCII</h2><p>æœ€åŸºç¡€çš„ç¼–ç æ ¼å¼ï¼Œæ‰“å­—æœºæ—¶ä»£çš„äº§ç‰©ï¼Œå…±128ä¸ªå­—ç¬¦ï¼Œå…¶åŒ…å«é”®ç›˜ä¸Šæ¯ä¸€ä¸ªå¯æ˜¾å­—ç¬¦ï¼Œå¯åº”å¯¹åªæœ‰è‹±æ–‡å­—æ¯åœºæ™¯ä¸‹çš„ç¼–ç éœ€æ±‚ã€‚</p><p>ASCIIç¼–ç ï¼Œå…±128ä¸ªå­—ç¬¦ï¼Œç¼–ç èŒƒå›´ä¸º0~127ï¼Œæ¯ä¸ªå­—ç¬¦å ç”¨ä¸€ä¸ªå­—èŠ‚(8ä½)ï¼Œä½†ASCIIå®é™…7ä½å°±å¤Ÿç”¨äº†ï¼Œæ‰€ä»¥ç¬¬8ä½å¯ç”¨äºä¿å­˜é¢å¤–çš„ä¿¡æ¯ï¼Œæ—©æœŸå¤šç”¨æ¥åšå¥‡å¶æ ¡éªŒï¼Œç›®å‰éƒ½æ˜¯å¡«å……0ã€‚</p><p>å…¶ä¸­ç¬¬32åˆ°126çš„å­—ç¬¦( - 7E)ï¼Œå…±95ä¸ªï¼Œä¸ºå¯æ˜¾å­—ç¬¦(printablecharacter)ï¼Œä¸ºç©ºæ ¼ã€æ•°å­—ã€å­—æ¯ã€æ ‡ç‚¹ç¬¦å·ã€å’Œå‡ ä¸ªç‰¹æ®Šç¬¦å·(ä¾‹å¦‚è„±å­—ç¬¦^)ã€‚å…¶ä¸­ï¼š</p><ul><li>32()ï¼Œä¸ºç©ºæ ¼</li><li>48-57(-)ï¼Œæ•°å­—0-9</li><li>65-90(-5A)ï¼Œå­—æ¯A-Z</li><li>97-122(-7A)ï¼Œå­—æ¯a-z</li></ul><p>å‰32ä¸ªå­—ç¬¦å’Œæœ€å1ä¸ªå­—ç¬¦(0åˆ°32å’Œ127)ï¼Œå…±33ä¸ªå­—ç¬¦ï¼Œç§°ä¹‹ä¸ºæ§åˆ¶å­—ç¬¦(Controlcharacter)ã€‚</p><p>æ¯ä¸ªæ§åˆ¶å­—ç¬¦é™¤äº†é€šè¿‡ASCIIç¼–ç è¡¨ç¤ºï¼Œè¿˜æœ‰å¦å¤–çš„ã€Œè„±å­—ç¬¦è¡¨ç¤ºæ³•ã€(Caretnotation)ï¼Œç¬¬0ä¸ªä¸º<code>^0</code>ï¼Œåç»­26ä¸ªä¸º<code>^A</code>~<code>^Z</code>ï¼Œå‰©ä½™çš„ä¸º<code>^[</code>ï¼Œ<code>^\</code>ï¼Œ<code>^]</code>ï¼Œ<code>^^</code>ï¼Œ<code>^_</code>ï¼Œæœ€åä¸€ä¸ªä¸º<code>^?</code>ã€‚åœ¨JSä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œç”¨<code>\c</code>æ¥æ›¿ä»£è„±å­—ç¬¦åŒ¹é…æ§åˆ¶å­—ç¬¦ï¼Œä¾‹å¦‚<code>\cJ</code>ä»£è¡¨<code>^J</code>ã€‚å¦å¤–ï¼Œæœ‰å‡ ä¸ªç‰¹æ®Šçš„åœ¨ç°åœ¨ç¼–ç ä¸­ä»ç„¶æœ‰ç”¨çš„æ§åˆ¶å­—ç¬¦ï¼Œè¿˜æœ‰ã€Œè½¬ä¹‰ç¬¦è¡¨ç¤ºæ³•ã€(escapesequence)ã€‚å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><table><colgroup><col style="width: 10%" /><col style="width: 17%" /><col style="width: 17%" /><col style="width: 26%" /><col style="width: 14%" /><col style="width: 14%" /></colgroup><thead><tr class="header"><th style="text-align: center;">åè¿›åˆ¶</th><th style="text-align: center;">è„±å­—ç¬¦è¡¨ç¤º</th><th style="text-align: center;">è½¬ä¹‰ç¬¦è¡¨ç¤º</th><th style="text-align: center;">åç§°</th><th style="text-align: center;">åç§°ç®€å†™</th><th style="text-align: center;">ä½œç”¨</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">0</td><td style="text-align: center;">^@</td><td style="text-align: center;">\0</td><td style="text-align: center;">Null</td><td style="text-align: center;">NUL</td><td style="text-align: center;">ç©º</td></tr><tr class="even"><td style="text-align: center;">7</td><td style="text-align: center;">^G</td><td style="text-align: center;"></td><td style="text-align: center;">Bell</td><td style="text-align: center;">Bel</td><td style="text-align: center;">æŒ¯é“ƒ</td></tr><tr class="odd"><td style="text-align: center;">8</td><td style="text-align: center;">^H</td><td style="text-align: center;"> Backspace</td><td style="text-align: center;">BS</td><td style="text-align: center;">é€€æ ¼</td><td style="text-align: center;"></td></tr><tr class="even"><td style="text-align: center;">9</td><td style="text-align: center;">^I</td><td style="text-align: center;"> Horizontal Tab</td><td style="text-align: center;">HT</td><td style="text-align: center;">æ°´å¹³åˆ¶è¡¨</td><td style="text-align: center;"></td></tr><tr class="odd"><td style="text-align: center;">10</td><td style="text-align: center;">^J</td><td style="text-align: center;"></td><td style="text-align: center;">Line Feed</td><td style="text-align: center;">LF</td><td style="text-align: center;">æ¢è¡Œ</td></tr><tr class="even"><td style="text-align: center;">11</td><td style="text-align: center;">^K</td><td style="text-align: center;"> Vertical Tab</td><td style="text-align: center;">VT</td><td style="text-align: center;">å‚ç›´åˆ¶è¡¨</td><td style="text-align: center;"></td></tr><tr class="odd"><td style="text-align: center;">12</td><td style="text-align: center;">^L</td><td style="text-align: center;"> Form feed</td><td style="text-align: center;">FF</td><td style="text-align: center;">æ¢é¡µ</td><td style="text-align: center;"></td></tr><tr class="even"><td style="text-align: center;">13</td><td style="text-align: center;">^M</td><td style="text-align: center;"> Carriage Return</td><td style="text-align: center;">CR</td><td style="text-align: center;">å›è½¦</td><td style="text-align: center;"></td></tr><tr class="odd"><td style="text-align: center;">27</td><td style="text-align: center;">^[</td><td style="text-align: center;"></td><td style="text-align: center;">Escape</td><td style="text-align: center;">ESC</td><td style="text-align: center;">æ¢ç </td></tr></tbody></table><p>æ˜¾ç„¶128ä¸ªå­—ç¬¦å¯¹äºè‹±æ–‡è¡¨è¾¾è¶³å¤Ÿäº†ï¼Œä½†æ˜¯æ˜æ˜¾ä¸é€‚ç”¨ä¸­æ–‡ï¼Œä»¥åŠå…¶ä»–éè‹±æ–‡è¡¨è¾¾çš„è¯­è¨€ï¼Œæ‰€ä»¥ä¸­å›½åæ¥æœ‰äº†GBKç¼–ç ã€‚ASCIIç¼–ç åœ¨æ—©æœŸé‡åˆ°ç¼–ç ä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œä¹Ÿæœ‰ä¸€äº›æ‰©å±•å’Œå˜ä½“ï¼Œä¾‹å¦‚ã€Œæ‰©å±•ASCIIã€å¯è¡¨ç¤º256ä¸ªå­—ç¬¦ã€‚ä¸è¿‡ç”±äºåæ¥æœ‰äº†Unicodeç¼–ç æ ¼å¼ï¼Œè¿™äº›éƒ½æ²¡ç”¨äº†ï¼Œæ‰€ä»¥å°±æ²¡å¿…è¦å»äº†è§£äº†ã€‚</p><h2 id="unicode">Unicode</h2><p>Unicodeç¼–ç æ ‡å‡†ï¼Œå¯è¡¨ç¤ºç›®å‰å…¨ä¸–ç•Œæ‰€æœ‰è¯­è¨€çš„æ‰€æœ‰å­—ç¬¦ã€‚åŒæ—¶å…¼å®¹ASCIIç¼–ç ã€‚</p><p>Unicodeçš„å‰128ä¸ªå­—ç¬¦ç¼–ç å’ŒASCIIæ˜¯ä¸€è‡´çš„ï¼Œå³å‘åå…¼å®¹ASCIIï¼Œå¯¹äºä½¿ç”¨ASCIIç¼–ç çš„ç¨‹åºå¯ä»¥ç›´æ¥ä½¿ç”¨Unicodeè§„èŒƒã€‚åœ¨Unicodeä¸­ï¼Œå¯¹äºæ¯ä¸€ä¸ªå­—ç¬¦ç¼–ç çš„å€¼ï¼Œå«åš<code>code point</code>ã€‚ä¾‹å¦‚å°å†™å­—æ¯açš„<code>code point</code>ä¸º97ï¼Œå¯¹åº”åå…­è¿›åˆ¶ä¸º<code>\x61</code>ã€‚ä¸‹æ–‡ä¸ºäº†æ–¹ä¾¿å¯¹<code>code point</code>ç§°ä½œã€Œç ä½ã€ã€‚</p><p>åœ¨Unicodeä¸­ï¼Œç ä½çš„æ€»èŒƒå›´ä¸º<code>\x0</code>åˆ°<code>\x10FFFF</code>ï¼Œå…±1,114,112ä¸ªç ä½ã€‚2048ä¸ªç”¨äºç¼–ç ä»£ç†(UTF-16)ï¼Œ66ä¸ªéå­—ç¬¦ç ä½(ä¾‹å¦‚BOM)ï¼Œ137,468ä¸ªé¢„ç•™ç»™ç§äººä½¿ç”¨ï¼Œæœ€ç»ˆå‰©ä½™974,530ç”¨äºæ™®é€šå­—ç¬¦åˆ†é…ã€‚</p><p>ç ä½çš„æœ€å¤§å€¼ä¸º<code>\x10FFFF</code>ï¼Œå¯¹åº”äºŒè¿›åˆ¶æœ‰21ä½ï¼Œæˆ‘ä»¬å°†2<sup>16ä¸ªå€¼åˆ†ä¸ºä¸€ç»„ï¼Œåˆ™Unicodeæ€»å…±å¯ä»¥åˆ†ä¸º17ä»½ï¼Œæ¯ä¸€ä»½ç§°ä¹‹ä¸ºå¹³é¢(Plane)ï¼Œæ¯ä¸€ä¸ªå¹³é¢æœ‰65,536(2</sup>16)ä¸ªç ä½ã€‚</p><p>ä¸ºä»€ä¹ˆUnicodeçš„æœ€å¤§å€¼ä¸º<code>\x10FFFF</code>ï¼Ÿå› ä¸ºå¯¹äº<code>UTF16</code>ç¼–ç ï¼ŒåŒå­—èŠ‚æœ€å¤šå¯ç¼–ç 2<sup>20ä¸ªå­—ç¬¦ï¼Œå•å­—èŠ‚å¯ç¼–ç 2</sup>16ä¸ªå­—ç¬¦ï¼ŒåŠ èµ·æ¥å…±17ä¸ªå¹³é¢çš„å­—ç¬¦æ•°ã€‚</p><p>ä¸‹è¡¨ä¸ºæ¯ä¸ªå¹³é¢è¯¦æƒ…ï¼š</p><table><colgroup><col style="width: 12%" /><col style="width: 18%" /><col style="width: 10%" /><col style="width: 58%" /></colgroup><thead><tr class="header"><th style="text-align: center;">å¹³é¢ç¼–å·</th><th style="text-align: center;">ç ä½èŒƒå›´(åå…­è¿›åˆ¶)</th><th style="text-align: center;">åç§°ç®€å†™</th><th style="text-align: center;">åç§°</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">Plane 0</td><td style="text-align: center;">0000â€“FFFF</td><td style="text-align: center;">BMP</td><td style="text-align: center;">åŸºç¡€å¤šè¯­è¨€å¹³é¢(Basic MultilingualPlane)</td></tr><tr class="even"><td style="text-align: center;">Plane 1</td><td style="text-align: center;">10000â€“1FFFF</td><td style="text-align: center;">SMP</td><td style="text-align: center;">è¡¥å……å¤šè¯­è¨€å¹³é¢(SupplementaryMultilingual Plane)</td></tr><tr class="odd"><td style="text-align: center;">Plane 2</td><td style="text-align: center;">20000â€“2FFFF</td><td style="text-align: center;">SIP</td><td style="text-align: center;">è¡¥å……è¡¨æ„è¯­è¨€å¹³é¢(SupplementaryIdeographic Plane)</td></tr><tr class="even"><td style="text-align: center;">Plane 3</td><td style="text-align: center;">30000â€“3FFFF</td><td style="text-align: center;">TIP</td><td style="text-align: center;">ç¬¬ä¸‰è¡¨æ„è¯­è¨€å¹³é¢(Tertiary IdeographicPlane)</td></tr><tr class="odd"><td style="text-align: center;">Planes 4â€“13</td><td style="text-align: center;">40000â€“DFFFF</td><td style="text-align: center;">- (æœªåˆ†é…)</td><td style="text-align: center;">- (æœªåˆ†é…)</td></tr><tr class="even"><td style="text-align: center;">Plane 14</td><td style="text-align: center;">E0000â€“EFFFF</td><td style="text-align: center;">SSP</td><td style="text-align: center;">è¡¥å……ç‰¹æ®Šç”¨é€”å¹³é¢(SupplementarySpecial-purpose Plane)</td></tr><tr class="odd"><td style="text-align: center;">Planes 15â€“16</td><td style="text-align: center;">F0000â€“10FFFF</td><td style="text-align: center;">SPUA-A/B</td><td style="text-align: center;">è¡¥å……ç§æœ‰ä½¿ç”¨åŒºå¹³é¢(Supplementary PrivateUse Area planes)</td></tr></tbody></table><p>BMPä¸ºåŸºç¡€å¹³é¢ï¼Œç›®å‰æ”¶å½•äº†å…¨çƒèŒƒå›´å†…å¤§éƒ¨åˆ†çš„å­—ç¬¦ã€‚å‰©ä½™çš„16ä¸ªå¹³é¢å‡ä¸ºè¡¥å……å¹³é¢ï¼Œç”¨äºè¿›è¡Œæ–°çš„å­—ç¬¦çš„è¡¥å……ã€‚å…¶ä¸­ç§æœ‰å¹³é¢ï¼Œç”¨äºç»™ä¸ªäººåšç¼–ç æ‰©å±•ï¼ŒUnicodeä¸æŒ‡å®šå­—ç¬¦ç¼–ç ã€‚æ¯”å¦‚æˆ‘ç¼–å†™äº†ä¸€ä¸ªè‹±é›„è”ç›Ÿç›¸å…³çš„ç¨‹åºï¼Œç„¶åå®šä¹‰æŸä¸€ä¸ªå­—ç¬¦ä»£è¡¨ä¸€ç§æ¸¸æˆé‡Œçš„æ“ä½œï¼Œå°±å¯ä»¥ä½¿ç”¨ç§æœ‰å¹³é¢ã€‚</p><p>Unicodeä¸­è¿˜æœ‰ä¸€ä¸ªæ¦‚å¿µï¼šå¯¹äºé€»è¾‘ä¸Šå±äºä¸€ç±»çš„å­—ç¬¦ï¼Œç§°ä¹‹ä¸ºå—(block)ã€‚ä¾‹å¦‚:</p><ul><li><code>C0 Controls and Basic Latin</code>å—ï¼Œ<code>\x0000</code>-<code>\x007F</code>ï¼Œå°±æ˜¯ä»ASCIIç»§æ‰¿æ¥çš„å‰128ä¸ªå­—ç¬¦ã€‚</li><li><code>CJK Unified Ideographs</code>å—ï¼Œ<code>\x4E00</code>-<code>\x9FFC</code>ï¼ŒåŒ…å«å¤§éƒ¨åˆ†çš„ä¸­æ—¥éŸ©æ–‡å­—ï¼Œ</li><li><code>Halfwidth and Fullwidth Forms</code>ï¼Œ<code>\xFF00</code>-<code>\xFFEF</code>ï¼Œç”¨äºè‹±æ–‡å­—æ¯/æ•°å­—/æ—¥æ–‡/ä¸ªåˆ«ç¬¦å·ç­‰ä¸€äº›å­—ç¬¦çš„å…¨è§’-åŠè§’ç›¸äº’è½¬æ¢ã€‚</li><li><code>Miscellaneous Symbols and Pictographs</code>ï¼Œ<code>\x1F300</code>-<code>\x1F5FF</code>ï¼Œ<code>Supplemental Symbols and Pictographs</code>ï¼Œ<code>\1F900</code>-<code>\1F9FF</code>ï¼ŒåŒ…å«å¤§éƒ¨åˆ†emojiè¡¨æƒ…</li></ul><p>å¦å¤–è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„å—<code>General Punctuation</code>ï¼Œç ä½åœ¨<code>[2000,206F]</code>ï¼ŒåŒ…å«ä¸€äº›ç¬¦å·ä»¥åŠä¸€äº›ç‰¹æ®Šçš„åˆ†éš”ç¬¦ã€è¿æ¥ç¬¦ã€ç©ºæ ¼ç¬¦ç­‰ï¼Œè¿™äº›ç¬¦å·ä¸ä¸€å®šæ˜¯å¯æ˜¾å­—ç¬¦ï¼Œè€Œæ˜¯å‘Šè¯‰è§£é‡Šå™¨è¯¥å¦‚ä½•æ“ä½œå½“å‰å­—ç¬¦ã€‚å¯¹äºæ‰€æœ‰å—ï¼Œ<span class="exturl" data-url="aHR0cHM6Ly91bmljb2RlLm9yZy9jaGFydHMvbmFtZXNsaXN0Lw==">å¯é€šè¿‡è¯¥é“¾æ¥æŸ¥é˜…<i class="fa fa-external-link-alt"></i></span>ã€‚</p><h2 id="åŠè§’å…¨è§’">åŠè§’/å…¨è§’</h2><p>å¯¹äºå…¨è§’å­—ç¬¦ï¼Œåœ¨å±•ç¤ºä¸Šå ç”¨çš„å®½åº¦æ˜¯åŠè§’å­—ç¬¦çš„ä¸¤å€ã€‚æ¯ä¸ªå­—ç¬¦éƒ½åœ¨Unicodeæ ‡å‡†é‡Œå®šä¹‰äº†æ˜¯å…¨è§’è¿˜æ˜¯åŠè§’ï¼Œå¯¹äºä¸éœ€è¦ç²¾ç¡®è®¡ç®—çš„ç®€å•ä¸šåŠ¡åœºæ™¯ï¼Œä¹Ÿå¯ä»¥ç®€å•çš„è®¤ä¸ºç ä½å¤§äº128çš„éƒ½æ˜¯å…¨è§’å­—ç¬¦ã€‚</p><p>åŠè§’å’Œå…¨è§’ï¼Œå¯¹åº”è‹±æ–‡ä¸ºhalfwidthï¼Œfullwidthã€‚åŠè§’å…¨è§’å¯¹åº”çš„æ˜¯UIæ˜¾ç¤ºçš„æ¦‚å¿µï¼Œå¯¹äºå®šå®½çš„å­—ä½“ï¼Œå…¨è§’å­—ç¬¦å ç”¨çš„å®½åº¦æ˜¯åŠè§’å­—ç¬¦çš„ä¸¤å€ã€‚Unicodeä¸­æ¯ä¸ªå­—ç¬¦éƒ½æœ‰ä¸€ä¸ª<code>East_Asian_Width</code>å±æ€§ï¼Œç”¨äºæŒ‡ç¤ºå½“å‰æ˜¯å…¨è§’å­—ç¬¦è¿˜æ˜¯åŠè§’å­—ç¬¦ï¼Œ<span class="exturl" data-url="aHR0cHM6Ly93d3cudW5pY29kZS5vcmcvcmVwb3J0cy90cjQ0L3RyNDQtMjYuaHRtbCNWYWxpZGF0aW9uX29mX0VudW1lcmF0ZWQ=">å…·æœ‰ä»¥ä¸‹å€¼<i class="fa fa-external-link-alt"></i></span>ï¼š</p><ul><li>Aï¼Œ Ambiguousï¼Œæ ¹æ®ä¸Šä¸‹æ–‡å†³å®š</li><li>Fï¼Œ Fullwidthï¼Œå…¨è§’</li><li>Hï¼Œ Halfwidthï¼ŒåŠè§’</li><li>Nï¼Œ Neutralï¼Œä¸­ç«‹ï¼Œä½œä¸ºåŠè§’</li><li>Naï¼Œ Narrowï¼ŒåŠè§’</li><li>Wï¼Œ Wideï¼Œå…¨è§’</li></ul><p>åœ¨<span class="exturl" data-url="aHR0cHM6Ly93d3cudW5pY29kZS5vcmcvUHVibGljL1VDRC9sYXRlc3QvdWNkL0Vhc3RBc2lhbldpZHRoLnR4dA==">EastAsianWidth.txtæ–‡ä»¶<i class="fa fa-external-link-alt"></i></span>ä¸­åˆ—ä¸¾äº†å·²æ˜¾ç¤ºå£°æ˜<code>East_Asian_Width</code>å±æ€§çš„å­—ç¬¦ã€‚å¯¹äºä¸åœ¨è¯¥æ–‡ä»¶å†…çš„å­—ç¬¦ï¼Œç¬¦åˆä¸‹åˆ—è§„åˆ™çš„ä¸º<code>W</code>(å…¨è§’)ï¼š</p><ul><li>the CJK Unified Ideographs Extension A blockï¼Œ å¯¹åº”åŒºé—´ï¼š<code>\x3400</code>..<code>\x4DBF</code></li><li>the CJK Unified Ideographs blockï¼Œ å¯¹åº”åŒºé—´ï¼š<code>\x4E00</code>..<code>\x9FFF</code></li><li>the CJK Compatibility Ideographs blockï¼Œ å¯¹åº”åŒºé—´ï¼š<code>\xF900</code>..<code>\xFAFF</code></li><li>the Supplementary Ideographic Planeï¼Œ å¯¹åº”åŒºé—´ï¼š<code>\x20000</code>..<code>\x2FFFF</code></li><li>the Tertiary Ideographic Planeï¼Œ å¯¹åº”åŒºé—´ï¼š<code>\x30000</code>..<code>\x3FFFF</code></li></ul><p>å…¶ä½™æœªåˆ—å‡ºçš„ï¼Œé»˜è®¤ä¸º<code>N</code>(åŠè§’)ã€‚</p><p>åœ¨ä¸€äº›ç¼–ç é›†ä¸­ï¼Œæœ‰çš„å­—ç¬¦æ—¢æœ‰å…¨è§’å½¢å¼ä¹Ÿæœ‰åŠè§’å½¢å¼ï¼ŒUnicodeä¸ºäº†å®ç°ä¸è¿™äº›ç¼–ç é›†ä¹‹é—´çš„æ— æŸè½¬æ¢ï¼Œåœ¨ç¬¬ä¸€å¹³é¢çš„æœ€åï¼Œ<code>\xFF00</code>åˆ°<code>\xFFEF</code>åŒºæ®µï¼Œå®šä¹‰äº†ç”¨äºåŠè§’å…¨è§’è½¬æ¢çš„å­—ç¬¦ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li><code>\xFF01</code>â€“<code>\xFF5E</code>ä¸ºASCIIçš„<code>\x21</code>åˆ°<code>\x7E</code>çš„å…¨è§’å½¢å¼ã€‚å…¶ä¸­ç©ºæ ¼æ²¡æœ‰çº³å…¥è¿›æ¥ï¼Œå› ä¸ºå…¨è§’ç©ºæ ¼å·²é€šè¿‡<code>\x3000</code>å®šä¹‰ã€‚</li><li><code>\xFF65</code>â€“<code>\xFF9F</code> ä¸ºåŠè§’çš„æ—¥è¯­å­—ç¬¦ã€‚</li><li><code>\xFFA0</code>â€“<code>\xFFDC</code> ä¸ºåŠè§’çš„æ±‰è¯­å­—ç¬¦ã€‚</li><li><code>\xFFE0</code>â€“<code>\xFFEE</code>åŒ…å«äº†ä¸€äº›ç¬¦å·ï¼Œæœ‰åŠè§’æœ‰å…¨è§’ã€‚</li></ul><p>å¯¹äºåœ¨JSä¸­åˆ¤æ–­å­—ç¬¦æ˜¯å…¨è§’è¿˜æ˜¯åŠè§’ï¼Œç›®å‰ä¸‹è½½é‡æ¯”è¾ƒå¤šçš„ä¸€ä¸ªnpmåŒ…ï¼š<code>is-fullwidth-code-point</code>ã€‚<code>string-width</code>ä¾èµ–<code>is-fullwidth-code-point</code>è®¡ç®—å­—ç¬¦é•¿åº¦ã€‚ä¸è¿‡å®é™…æµ‹è¯•ï¼Œ<code>is-fullwidth-code-point</code>æ²¡æœ‰å®Œå…¨è¦†ç›–æ‰€æœ‰å…¨è§’å­—ç¬¦(<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NpbmRyZXNvcmh1cy9pcy1mdWxsd2lkdGgtY29kZS1wb2ludC9pc3N1ZXMvMTI=">issue<i class="fa fa-external-link-alt"></i></span>)ï¼Œä¸è¿‡å¯¹äºæ—¥å¸¸ä¸­æ–‡åœºæ™¯çš„å¼€å‘å¤Ÿç”¨äº†ã€‚</p><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¯¹äºUIå±•ç¤ºçš„åœºæ™¯ä¸­ï¼Œä¼šæ¯”è¾ƒå…³å¿ƒå­—ç¬¦å®½åº¦çš„é—®é¢˜ã€‚ä½†æ˜¯åœ¨æ¶‰åŠå­˜å‚¨çš„æ—¶å€™ï¼Œæ›´å…³å¿ƒçš„å…¶å®æ˜¯å­˜å‚¨è¯¥å­—ç¬¦å ç”¨äº†å‡ ä¸ªå­—èŠ‚ã€‚æ‰€ä»¥åœ¨æ¶‰åŠå­˜å‚¨çš„åœºæ™¯ä¸‹ï¼Œå…³æ³¨ç‚¹å°±ä¸åº”è¯¥æ˜¯å…¨è§’/åŠè§’çš„æ¦‚å¿µï¼Œè€Œæ˜¯å­—ç¬¦ç¼–ç æ‰€å ç”¨çš„å­—èŠ‚æ•°ã€‚å¯¹äº<code>UTF8</code>ç¼–ç ï¼Œç ä½å°äºç­‰äº128çš„ä½¿ç”¨1å­—èŠ‚å­˜å‚¨ï¼Œå¤§äº128çš„ä¼šæ ¹æ®éœ€è¦ï¼Œä½¿ç”¨åŒå­—èŠ‚ï¼Œä¸‰å­—èŠ‚æˆ–å››å­—èŠ‚å­˜å‚¨ã€‚æ‰€ä»¥å¤šæ•°åœºæ™¯ä¸‹ï¼Œä¸ºäº†ç®€ä¾¿ï¼Œå‰åç«¯éƒ½å¯ä»¥é€šè¿‡ç ä½æ˜¯å¦å¤§äº128æ¥åˆ¤æ–­å…¨è§’/åŠè§’ã€‚</p><h2 id="htmlxmlå®ä½“è½¬ä¹‰">HTML/XMLå®ä½“è½¬ä¹‰</h2><p>æˆ‘ä»¬å¸¸è¯´çš„HTMLè½¬ä¹‰ï¼Œå®é™…æ­£å¼åº”è¯¥ç§°ä¹‹ä¸ºHTMLå®ä½“å¼•ç”¨ã€‚å¯¹åº”æœ‰ä¸¤ç§å¼•ç”¨æ–¹å¼ï¼šæ•°å­—å­—ç¬¦å¼•ç”¨(numericcharacter reference) å’Œ å­—ç¬¦å®ä½“å¼•ç”¨(character entity reference)ã€‚</p><p>å…ˆè¯´å¸¸è§çš„å­—ç¬¦å®ä½“å¼•ç”¨ï¼Œè¯­æ³•ä¸ºï¼š<code>&amp;name;</code>ï¼Œnameå¿…é¡»å°å†™ã€‚ä¾‹å¦‚ï¼š<code>&lt;</code>è¡¨ç¤ºå°äºå·<code>&lt;</code>ã€‚</p><p>å¯ä»¥è¿›è¡Œå¼•ç”¨çš„å®ä½“ï¼Œç§°ä¹‹ä¸ºå‘½åå®ä½“ã€‚å‘½åå®ä½“æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯è¯­æ³•ä¸­å†…ç½®çš„ï¼Œå¦ä¸€ç§æ˜¯åœ¨DTDä¸­æ˜¾ç¤ºå£°æ˜çš„ï¼š<code>&lt;!ENTITY name "value"&gt;</code>ã€‚</p><p>æ•°å­—å­—ç¬¦å¼•ç”¨æ–¹å¼ï¼š</p><ul><li>åè¿›åˆ¶ï¼š<code>&amp;#nnnn;</code></li><li>åå…­è¿›åˆ¶ï¼š<code>&amp;#xhhhh;</code>ï¼Œxå¿…é¡»å°å†™ã€‚hhhhå¤§å°å†™å¯ä»¥æ··ç”¨ã€‚</li></ul><p>è¿˜æ˜¯åŒæ ·çš„ä¾‹å­ï¼Œå°äºå·<code>&lt;</code>å¦‚æœä½¿ç”¨æ•°å­—å­—ç¬¦å¼•ç”¨çš„æ–¹å¼ï¼Œä¸ºï¼š<code>&lt;</code>ã€‚</p><h3 id="html">HTML</h3><p><span class="exturl" data-url="aHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2UvbmFtZWQtY2hhcmFjdGVycy5odG1sI25hbWVkLWNoYXJhY3Rlci1yZWZlcmVuY2Vz">é€šè¿‡è¯¥é“¾æ¥æŸ¥çœ‹ç›®å‰HTML5ä¸­æ”¯æŒçš„å‘½åå®ä½“<i class="fa fa-external-link-alt"></i></span>ã€‚</p><h3 id="xml">XML</h3><p>XMLè§„èŒƒä¸­ï¼Œæœ‰5ä¸ªé¢„å®šä¹‰çš„å®ä½“ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå¦‚æœéœ€è¦ä½¿ç”¨æ›´å¤šçš„å®ä½“è½¬ä¹‰ï¼Œéœ€è¦åœ¨DTDä¸­å£°æ˜ã€‚</p><table><colgroup><col style="width: 5%" /><col style="width: 5%" /><col style="width: 16%" /><col style="width: 14%" /><col style="width: 9%" /><col style="width: 47%" /></colgroup><thead><tr class="header"><th style="text-align: center;">åç§°</th><th style="text-align: center;">å­—ç¬¦</th><th style="text-align: center;">ç ä½åå…­è¿›åˆ¶</th><th style="text-align: center;">ç ä½åè¿›åˆ¶</th><th style="text-align: center;">æ ‡å‡†</th><th style="text-align: center;">åç§°å…¨ç§°</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">quot</td><td style="text-align: center;">"</td><td style="text-align: center;"></td><td style="text-align: center;">34</td><td style="text-align: center;">XML 1.0</td><td style="text-align: center;">quotation mark</td></tr><tr class="even"><td style="text-align: center;">amp</td><td style="text-align: center;">&amp;</td><td style="text-align: center;"></td><td style="text-align: center;">38</td><td style="text-align: center;">XML 1.0</td><td style="text-align: center;">ampersand</td></tr><tr class="odd"><td style="text-align: center;">apos</td><td style="text-align: center;">'</td><td style="text-align: center;"></td><td style="text-align: center;">39</td><td style="text-align: center;">XML 1.0</td><td style="text-align: center;">apostrophe (1.0: apostrophe-quote)</td></tr><tr class="even"><td style="text-align: center;">lt</td><td style="text-align: center;">&lt;</td><td style="text-align: center;">003C</td><td style="text-align: center;">60</td><td style="text-align: center;">XML 1.0</td><td style="text-align: center;">less-than sign</td></tr><tr class="odd"><td style="text-align: center;">gt</td><td style="text-align: center;">&gt;</td><td style="text-align: center;">003E</td><td style="text-align: center;">62</td><td style="text-align: center;">XML 1.0</td><td style="text-align: center;">greater-than sign</td></tr></tbody></table><h2 id="unicode-encoding-forms">Unicode Encoding Forms</h2><p>Unicodeå­—ç¬¦ç¼–ç æ ¼å¼(Unicode EncodingForms)ï¼Œç®€å†™ä¸º:UTFï¼Œå³ï¼šå°†ä¸€ä¸ªUnicodeå­—ç¬¦ä¿å­˜ä¸ºå­—èŠ‚åºåˆ—çš„æ ¼å¼è§„èŒƒï¼Œç”¨äºæ–‡ä»¶å­˜å‚¨ã€æ•°æ®ä¼ è¾“ç­‰ã€‚Unicodeæ ‡å‡†æ”¯æŒ3ç§ç¼–ç æ ¼å¼ï¼Œå¦‚ä¸‹ï¼š</p><ul><li>UTF-32: ä½¿ç”¨4å­—èŠ‚è¡¨ç¤ºä¸€ä¸ªUnicodeå­—ç¬¦ã€‚</li><li>UTF-16:å˜é•¿çš„ç¼–ç æ ¼å¼ï¼Œç ä½å¤§äº<code>\xFFFF</code>çš„å­—ç¬¦ï¼Œä½¿ç”¨4å­—èŠ‚å­˜å‚¨ï¼Œå°äºç­‰äº<code>\xFFFF</code>çš„å­—ç¬¦ï¼Œä½¿ç”¨2å­—èŠ‚å­˜å‚¨ã€‚</li><li>UTF-8:å˜é•¿çš„ç¼–ç æ ¼å¼ï¼Œç ä½å¤§äº<code>\xFFFF</code>çš„å­—ç¬¦ï¼Œä½¿ç”¨4å­—èŠ‚å­˜å‚¨ï¼Œå°äºç­‰äº<code>\xFFFF</code>å¤§äº<code>\x07FF</code>çš„ä½¿ç”¨3å­—èŠ‚ï¼Œå°äºç­‰äº<code>\x07FF</code>å¤§äº<code>\x007F</code>çš„ä½¿ç”¨2å­—èŠ‚ï¼Œå°äºç­‰äº<code>\x007F</code>ä½¿ç”¨1å­—èŠ‚ã€‚</li></ul><p>Unicodeæ ‡å‡†æ”¯æŒ3ç§ç¼–ç æ ¼å¼ï¼Œ<code>UTF32</code>/<code>UTF16</code>/<code>UTF8</code>ï¼Œç”¨äºæ˜ å°„ç ä½ä¸º<code>\x0000</code>åˆ°<code>\xD7FF</code> å’Œ<code>\xE000</code>åˆ°<code>\x10FFFF</code>çš„å­—ç¬¦ï¼Œå³é™¤å»é«˜ä½ä»£ç†å’Œä½ä½ä»£ç†çš„æ‰€æœ‰å­—ç¬¦ã€‚è‡³äºä»€ä¹ˆæ˜¯é«˜ä½ä»£ç†å’Œä½ä½ä»£ç†åé¢ä¼šè®²åˆ°ã€‚</p><h3 id="utf32">UTF32</h3><p>æ˜¯ä¸€ç§å®šé•¿ç¼–ç æ ¼å¼ï¼Œä½¿ç”¨32ä½(4å­—èŠ‚)è¡¨ç¤ºUnicodeä¸­çš„ä¸€ä¸ªç ä½ã€‚ç”±äºUnicodeçš„ç ä½å®é™…åªç”¨äº†21ä½ï¼Œæ‰€ä»¥å¤šä½™éƒ¨åˆ†å‰å¯¼0ã€‚ä¾‹å¦‚å­—ç¬¦å°å†™å­—æ¯aï¼Œå¯¹åº”ç ä½ä¸º<code>\x61</code>ï¼Œå­˜å‚¨çš„å­—èŠ‚åºåˆ—ä¸ºï¼š<code>\x00000061</code>ã€‚</p><h3 id="utf16">UTF16</h3><p>å˜é•¿ç¼–ç æ ¼å¼ï¼ŒæŒ‰å¹³é¢åŒºåˆ†ï¼Œä½äºç¬¬ä¸€å¹³é¢ä¸­çš„å­—ç¬¦(<code>\x0000..\xD7FF</code>å’Œ<code>\xE000..\xFFFF</code>)ï¼Œä½¿ç”¨16ä½(2å­—èŠ‚)å­˜å‚¨ï¼Œä½¿ç”¨å’Œç ä½ç›¸åŒçš„å€¼ã€‚ä½äºå…¶ä»–å¹³é¢çš„å­—ç¬¦(<code>\x10000..\x10FFFF</code>)ï¼Œé€šè¿‡é«˜ä½å’Œä½ä½ä»£ç†ä½¿ç”¨32ä½(4å­—èŠ‚)è¡¨ç¤ºã€‚</p><p>å¯¹äºä½äºç¬¬ä¸€å¹³é¢çš„å€¼ï¼Œå³å°äºç­‰äº<code>\xFFFF</code>çš„å€¼ï¼Œä½¿ç”¨2ä¸ªå­—èŠ‚å°±è¶³å¤Ÿè¡¨ç¤ºï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºå…¶ç ä½çš„å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><table><thead><tr class="header"><th style="text-align: center;">code point</th><th style="text-align: center;">UTF16ç¼–ç åå®é™…å­˜å‚¨çš„å€¼</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">xxxx xxxx xxxx xxxx</td><td style="text-align: center;">xxxx xxxx xxxx xxxx</td></tr></tbody></table><p>ä½äºå…¶ä»–å¹³é¢å¹³é¢çš„å€¼ï¼Œå³å¤§äº<code>\xFFFF</code>çš„å€¼ï¼Œä½¿ç”¨4ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><table><colgroup><col style="width: 41%" /><col style="width: 58%" /></colgroup><thead><tr class="header"><th style="text-align: center;">code point</th><th style="text-align: center;">UTF16ç¼–ç åå®é™…å­˜å‚¨çš„å€¼(wwww = uuuuu -1)</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">000u uuuu hhhh hhxx xxxx xxxx</td><td style="text-align: center;">1101 10ww wwhh hhhh 1101 11xx xxxxxxxx</td></tr></tbody></table><p>ä½äºå…¶ä»–å¹³é¢çš„å€¼ï¼Œå³<code>\x10000</code>åˆ°<code>\x10FFFF</code>çš„å€¼ï¼ŒäºŒè¿›åˆ¶æœ€é«˜ä½¿ç”¨21ä½ã€‚å°†å…¶æ‹†åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå³å‰11ä½å’Œå10ä½ï¼Œå‰11ä¸ºç”¨<code>hhhhhh hhhh</code>è¡¨ç¤ºï¼Œå10ä½ç”¨<code>xxxxx xxxxx</code>è¡¨ç¤ºã€‚å…¶ä¸­ï¼Œå‰11ä½ä¸­ï¼Œå‰5ä½æ˜¯ç”¨æ¥è¡¨ç¤ºä½äºç¬¬å‡ ä¸ªå¹³é¢ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿç‰¹æ®Šæ ‡æ³¨å‡ºæ¥ï¼Œç”¨uè¡¨ç¤ºï¼Œå³å‰11ä½ä¸ºï¼š<code>uuuuuh hhhhh</code>ã€‚</p><p>ç”±äºè¿™é‡Œå‰äº”ä½çš„æœ‰æ•ˆå€¼ä¸º<code>\x1</code>åˆ°<code>\x10</code>ï¼Œæ‰€ä»¥å¯ä»¥å‡1ï¼Œè®©æœ‰æ•ˆå€¼ä»0å¼€å§‹ï¼Œåˆ™æœ‰æ•ˆå€¼å˜æˆäº†<code>\x00</code>åˆ°<code>\x0F</code>ï¼Œå³4ä½ï¼Œå‡1åçš„å€¼ç”¨wè¡¨ç¤ºï¼Œä»è€Œå‰11ä½å¯ä»¥è¡¨ç¤ºä¸ºï¼šwwwwh hhhhhã€‚</p><p>å°†å‰10ä½å‰å¯¼<code>110110</code>ï¼Œå10ä½å‰å¯¼<code>110111</code>ï¼Œå³<code>UTF16</code>å¯¹äºå¤§äº<code>\xFFFF</code>å­—ç¬¦çš„è¡¨ç¤ºå¦‚ä¸Šè¿°è¡¨æ ¼æ‰€ç¤ºã€‚</p><p>è¿™é‡Œ,äºŒè¿›åˆ¶<code>1101 1000 0000 0000</code>ä¸º<code>\xD800</code>ï¼ŒäºŒè¿›åˆ¶<code>1101 1100 0000 0000</code>ä¸º<code>\xDC00</code>ï¼Œä»è€Œï¼Œè¯¥è§„åˆ™ç®€å•æè¿°å¦‚ä¸‹ï¼š</p><ul><li>å‡è®¾æŸä¸ªå­—ç¬¦xä½äº<code>\x10000</code>åˆ°<code>\x10FFFF</code>ä¹‹é—´ï¼Œå°†å…¶å‡å»<code>\x10000</code>ï¼Œå¾—åˆ°x'ï¼Œx'çš„èŒƒå›´ä¸ºï¼š<code>\x00000</code>â€“<code>\xFFFFF</code>ã€‚</li><li>å°†x'åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œå‰10ä½å’Œå10ä½ï¼Œç”¨w1å’Œw2è¡¨ç¤ºï¼Œå…¶èŒƒå›´ä¸º<code>\x0000</code>â€“<code>\x03FF</code>ã€‚</li><li>å°†w1åŠ ä¸Š<code>\xD800</code>ï¼Œå¾—åˆ°w1'ï¼ŒèŒƒå›´ä¸ºï¼š<code>\xD800</code>â€“<code>\xDBFF</code>.</li><li>å°†w2åŠ ä¸Š<code>\xDC00</code>ï¼Œå¾—åˆ°w2'ï¼ŒèŒƒå›´ä¸ºï¼š<code>\xDC00</code>â€“<code>\xDFFF</code>.</li></ul><p>å°†w1'å’Œw'2è½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼Œå³<code>UTF16</code>ä¸‹xå­˜å‚¨çš„å­—èŠ‚åºåˆ—ã€‚</p><pre class="line-numbers language-none"><code class="language-none">x&#39; &#x3D; yyyyyyyyyyxxxxxxxxxx   &#x2F;&#x2F; x - 0x10000x1&#39; &#x3D; 110110yyyyyyyyyy      &#x2F;&#x2F; 0xD800 + yyyyyyyyyyx2&#39; &#x3D; 110111xxxxxxxxxx      &#x2F;&#x2F; 0xDC00 + xxxxxxxxxx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="utf8">UTF8</h3><p>å˜é•¿ç¼–ç æ ¼å¼ï¼Œæ˜¯ç›´æ¥å…¼å®¹ASCIIçš„ç¼–ç æ ¼å¼ï¼Œå¯¹äºèƒ½åœ¨1å­—èŠ‚å†…ä¿å­˜çš„ï¼Œç›´æ¥ä¿å­˜ä¸º1å­—èŠ‚ã€‚å¦åˆ™è¿›è¡Œç±»ä¼¼<code>UTF16</code>é«˜ä½ä½ä»£ç†çš„æ–¹å¼ï¼Œæœ€é«˜ä½ä½¿ç”¨4å­—èŠ‚ã€‚</p><p><code>UTF8</code>ä¸­æ²¡æœ‰å‡1çš„é€»è¾‘ï¼Œåªæ˜¯ç®€å•çš„å¢åŠ å‰ç¼€ï¼Œå…·ä½“è§„åˆ™å¦‚ä¸‹:</p><table style="width:100%;"><colgroup><col style="width: 26%" /><col style="width: 30%" /><col style="width: 10%" /><col style="width: 10%" /><col style="width: 10%" /><col style="width: 10%" /></colgroup><thead><tr class="header"><th style="text-align: center;">èŒƒå›´</th><th style="text-align: center;">ç ä½(äºŒè¿›åˆ¶)</th><th style="text-align: center;">ç¬¬1ä¸ªå­—èŠ‚</th><th style="text-align: center;">ç¬¬2ä¸ªå­—èŠ‚</th><th style="text-align: center;">ç¬¬3ä¸ªå­—èŠ‚</th><th style="text-align: center;">ç¬¬4ä¸ªå­—èŠ‚</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"> .. 007F(7ä½)</td><td style="text-align: center;">00000000 0xxxxxxx</td><td style="text-align: center;">0xxxxxxx</td><td style="text-align: center;">-</td><td style="text-align: center;">-</td><td style="text-align: center;">-</td></tr><tr class="even"><td style="text-align: center;"> .. 07FF(11ä½)</td><td style="text-align: center;">00000yyy yyxxxxxx</td><td style="text-align: center;">110yyyyy</td><td style="text-align: center;">10xxxxxx</td><td style="text-align: center;">-</td><td style="text-align: center;">-</td></tr><tr class="odd"><td style="text-align: center;"> .. </td><td style="text-align: center;">zzzzyyyy yyxxxxxx</td><td style="text-align: center;">1110zzzz</td><td style="text-align: center;">10yyyyyy</td><td style="text-align: center;">10xxxxxx</td><td style="text-align: center;">-</td></tr><tr class="even"><td style="text-align: center;"> .. 10FFFF</td><td style="text-align: center;">000uuuuu zzzzyyyy yyxxxxxx</td><td style="text-align: center;">11110uuu</td><td style="text-align: center;">10uuzzzz</td><td style="text-align: center;">10yyyyyy</td><td style="text-align: center;">10xxxxxx</td></tr></tbody></table><p>åœ¨<code>UTF8</code>ä¸­ï¼Œ</p><ul><li>å¦‚æœå­—èŠ‚åºåˆ—ä»¥<code>0</code>å¼€å¤´ï¼Œä»£è¡¨å½“å‰å­—èŠ‚æœ¬èº«è¡¨ç¤ºäº†ä¸€ä¸ªå­—ç¬¦ã€‚</li><li>å¦‚æœä¸º<code>10</code>å¼€å¤´ï¼Œåˆ™ä»£è¡¨å½“å‰å­—èŠ‚ä¸ºå¤šå­—èŠ‚å­—ç¬¦ä¸­çš„ä¸€ä¸ªå­—èŠ‚ã€‚</li><li>å¦‚æœå½“å‰å­—ç¬¦ä»¥<code>11</code>å¼€å¤´ï¼Œåˆ™å‰é¢<code>1</code>çš„ä¸ªæ•°ï¼Œä»£è¡¨å½“å‰å­—ç¬¦æ‰€ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œ2ä¸ª<code>1</code>ä»£è¡¨ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œ3ä¸ª<code>1</code>ä»£è¡¨ä½¿ç”¨3ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚</li></ul><h2 id="byte-order-mark">Byte order mark</h2><p>å­—èŠ‚é¡ºåºæ ‡è®°(Byte ordermark)ï¼ŒæŒ‡é¢„å®šä¹‰çš„ï¼Œæ”¾ç½®åœ¨æ–‡æœ¬æµå¼€å¤´çš„ï¼Œä¸€æ®µç‰¹æ®Šçš„å­—èŠ‚åºåˆ—ï¼Œç”¨äºæ ‡è®°å½“å‰æ–‡æœ¬ä½¿ç”¨çš„å“ªç§ç¼–ç æ ¼å¼(<code>UTF32</code>/<code>UTF16</code>/<code>UTF8</code>)ã€‚å…·ä½“è§„åˆ™å¦‚ä¸‹ï¼š</p><table><thead><tr class="header"><th style="text-align: center;">ç¼–ç æ ¼å¼</th><th style="text-align: center;">æ–‡æœ¬æµå¼€å¤´çš„å­—èŠ‚åºåˆ—</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">UTF-8</td><td style="text-align: center;">EF BB BF</td></tr><tr class="even"><td style="text-align: center;">UTF-16 (BE)</td><td style="text-align: center;">FE FF</td></tr><tr class="odd"><td style="text-align: center;">UTF-16 (LE)</td><td style="text-align: center;">FF FE</td></tr><tr class="even"><td style="text-align: center;">UTF-32 (BE)</td><td style="text-align: center;">00 00 FE FF</td></tr><tr class="odd"><td style="text-align: center;">UTF-32 (LE)</td><td style="text-align: center;">FF FE 00 00</td></tr></tbody></table><p>ä¾‹å¦‚Windowsçš„è®°äº‹æœ¬åº”ç”¨ï¼Œå°†æ–‡æœ¬ä¿å­˜ä¸º<code>UTF8</code>æ ¼å¼æ—¶ï¼Œä¼šåœ¨æ–‡æœ¬å†…å®¹çš„å¼€å¤´æ·»åŠ <code>\xEF</code>,<code>\xBB</code>,<code>\BF</code>3ä¸ªå­—èŠ‚ã€‚è®°äº‹æœ¬åº”ç”¨åœ¨è¯»å–ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶çš„æ—¶å€™ï¼Œå‘ç°å‰ä¸‰ä¸ªå­—èŠ‚ä¸º<code>\xEF</code>,<code>\xBB</code>,<code>\BF</code>ï¼Œåˆ™è®¤ä¸ºæ¥ä¸‹æ¥çš„å­—èŠ‚æµé€šè¿‡<code>UTF8</code>å½¢å¼è§£æã€‚</p><h3 id="endianness">endianness</h3><p>å­—èŠ‚é¡ºåº(endianness)ï¼Œè¿™é‡Œç‰¹æŒ‡å½“ä¿å­˜ä¸€ä¸ªæ•°å­—ç±»å‹æ•°æ®æ—¶ï¼Œå­˜å‚¨çš„å­—èŠ‚åºåˆ—çš„é¡ºåºã€‚åˆ†ä¸ºå¤§ç«¯åº(big-endianï¼Œç®€å†™BE)å’Œå°ç«¯åº(little-endianï¼Œç®€å†™LE)ã€‚</p><p>å‡è®¾å½“å‰è¦å°†ä¸€ä¸ª16ä½çš„æ•´å‹æ•°å­—<code>\x0A0B</code>æŒ‡å‘å†…å­˜åœ°å€ã€‚</p><p>å¯¹äºå¤§ç«¯åºçš„CPUï¼Œéšç€å†…å­˜åœ°å€çš„å¢åŠ ï¼Œè®¤ä¸ºå…¶å­˜å‚¨çš„å€¼çš„é‡è¦æ€§æ˜¯é€’å‡çš„ï¼Œæ‰€ä»¥å¤§ç«¯åºçš„CPUä¼šåœ¨100çš„ä½ç½®ä¸Šå­˜å‚¨<code>\x0A</code>ï¼Œåœ¨101çš„ä½ç½®ä¸Šå­˜å‚¨<code>\x0B</code>ã€‚</p><p>å¯¹äºå°ç«¯åºçš„CPUï¼Œéšç€å†…å­˜åœ°å€çš„å¢åŠ ï¼Œè®¤ä¸ºå…¶å­˜å‚¨çš„å€¼çš„é‡è¦æ€§æ˜¯é€’å¢çš„ï¼Œæ‰€ä»¥å°ç«¯åºçš„CPUä¼šåœ¨100çš„ä½ç½®ä¸Šå­˜å‚¨<code>\x0B</code>ï¼Œåœ¨101çš„ä½ç½®ä¸Šå­˜å‚¨<code>\x0A</code>ã€‚</p><p>æ‰€ä»¥åè¿‡æ¥ï¼Œå‡è®¾ç°åœ¨åœ¨å†…å­˜ä¸­ï¼Œåœ°å€100çš„åœ°æ–¹å­˜å‚¨äº†<code>\xAA</code>ï¼Œåœ¨101çš„åœ°æ–¹å­˜å‚¨äº†<code>\xBB</code>ï¼Œå‡è®¾æœ‰ä¸€ä¸ª<code>int16</code>å˜é‡æŒ‡å‘ï¼Œå¯¹äºå¤§ç«¯åºCPUä¼šè®¤ä¸ºè¯¥å˜é‡çš„å€¼ä¸º<code>\xAABB</code>ï¼Œå¯¹äºå°ç«¯åºCPUä¼šè®¤ä¸ºè¯¥å˜é‡çš„å€¼ä¸º<code>\xBBAA</code>ã€‚</p><h3 id="byte-order-mark-1">Byte order mark</h3><p>å› ä¸ºå„ä¸ªç³»ç»Ÿä¹‹é—´çš„å­—èŠ‚é¡ºåºä¸åŒï¼Œæ‰€ä»¥åœ¨ä¼ è¾“å’Œäº¤æ¢Unicodeæ–‡æœ¬æ—¶ï¼Œè¦å‘Šè¯‰å¯¹æ–¹å½“å‰æ˜¯ä»¥ä»€ä¹ˆé¡ºåºä¿å­˜çš„ï¼Œä»è€Œæ¥æ”¶æ–¹æ‰èƒ½æœ‰æ•ˆçš„è¿›è¡Œè§£æã€‚</p><p>å­—èŠ‚åºåˆ—æ ‡è®°(Byte ordermarkï¼Œç®€å†™BOM)ï¼Œç‰¹æŒ‡<code>\xFEFF</code>å­—ç¬¦ã€‚åœ¨æ–‡æœ¬çš„å¼€å¤´ï¼Œæ·»åŠ <code>\xFEFF</code>å­—ç¬¦ï¼Œç”¨äºæ ‡è¯†å½“å‰æ–‡æœ¬çš„å­—èŠ‚é¡ºåºã€‚</p><ul><li>å¯¹äº<code>UTF8</code>ç¼–ç æ ¼å¼ï¼Œè¯¥å­—ç¬¦ä¼šè¢«ä¿å­˜ä¸º<code>\xEFBBBF</code></li><li>å¯¹äº<code>UTF16 BE</code>ç¼–ç æ ¼å¼ï¼Œè¯¥å­—ç¬¦ä¼šè¢«ä¿å­˜ä¸º<code>\xFEFF</code></li><li>å¯¹äº<code>UTF16 LE</code>ç¼–ç æ ¼å¼ï¼Œè¯¥å­—ç¬¦ä¼šè¢«ä¿å­˜ä¸º<code>\xFFFE</code></li><li>å¯¹äº<code>UTF32 BE</code>ç¼–ç æ ¼å¼ï¼Œè¯¥å­—ç¬¦ä¼šè¢«ä¿å­˜ä¸º<code>\x0000FEFF</code></li><li>å¯¹äº<code>UTF32 LE</code>ç¼–ç æ ¼å¼ï¼Œè¯¥å­—ç¬¦ä¼šè¢«ä¿å­˜ä¸º<code>\xFFFE0000</code></li></ul><p>æ‰€ä»¥ï¼Œè§£æç¨‹åºé€šè¿‡åˆ¤æ–­BOMå³å¯ç¡®å®šæ¥ä¸‹æ¥çš„æ–‡æœ¬æ‰€ä½¿ç”¨çš„ç¼–ç æ ¼å¼ä»¥åŠå­—èŠ‚é¡ºåºã€‚åœ¨Unicodeä¸­ï¼Œ<code>\xFEFF</code>æ˜¯ä¸“é—¨ç”¨ä½œBOMçš„ï¼Œå¦‚æœè¯¥å­—ç¬¦å‡ºç°åœ¨æ–‡æœ¬ä¸­é—´ï¼Œä¼šè¢«å½“åšã€Œé›¶å®½éæ¢è¡Œç©ºæ ¼ã€(zero-widthnon-breakingspace)ï¼Œå…¶å®å°±æ˜¯è·³è¿‡çš„æ„æ€ã€‚åŒæ ·çš„ï¼Œå¯¹äºå®ƒçš„ä¸€ä¸ªé•œåƒå­—ç¬¦<code>\xFFFE</code>ï¼Œå¦‚æœå‡ºç°ä¹Ÿä¼šè¢«è·³è¿‡ã€‚</p><p>BOMå¯ä»¥çœç•¥ï¼Œä¸æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºï¼š</p><ol type="1"><li>åœ¨æŸäº›åœºæ™¯ä¸‹å·²ç»é¢„è®¾äº†ç¼–ç æ ¼å¼æˆ–å­—èŠ‚é¡ºåºï¼Œä¾‹å¦‚W3Cçš„HTML5è§„èŒƒä¸­ï¼Œå¦‚æœæŒ‡å®šcharsetä¸ºutf-8ï¼Œåˆ™ä¼šé»˜è®¤æŒ‰ç…§utf-8è§£æï¼Œè€Œå¦‚æœæ–‡ä»¶æµæŒ‡å®šäº†BOMï¼Œåˆ™ä¼šä¼˜å…ˆä½¿ç”¨BOMæŒ‡å®šçš„ç¼–ç æ ¼å¼å’Œå­—èŠ‚é¡ºåºã€‚</li><li>å½“BOMè¢«çœç•¥æ—¶ï¼Œå¤§éƒ¨åˆ†è§£æå™¨éƒ½ä¼šå¯¹æ–‡æœ¬æµè¿›è¡Œæ¨ç®—ï¼Œæ¨ç®—å‡ºç¼–ç æ ¼å¼å’Œå­—èŠ‚é¡ºåºï¼Œä½†æ˜¯è¿™ä¸ªæ¨ç®—å¹¶ä¸æ˜¯ç»å¯¹å¯é çš„ã€‚</li></ol><p>å½“ä½¿ç”¨<code>UTF8</code>æ ¼å¼ä¿å­˜æ–‡æœ¬æ—¶ï¼ŒUnicodeæ ‡å‡†å»ºè®®ï¼Œå¦‚æœåŸæ–‡æœ¬æ²¡æœ‰BOMï¼Œåˆ™ä¸è¦æ·»åŠ BOMã€‚å› ä¸ºï¼š</p><ol type="1"><li><code>UTF8</code>æ˜¯å•å­—èŠ‚å­˜å‚¨çš„ï¼Œä¸å­˜åœ¨å­—èŠ‚é¡ºåºé—®é¢˜ã€‚</li><li>è§£æå™¨ä¼šé»˜è®¤ä½¿ç”¨<code>UTF8</code>è§£ææ–‡æœ¬ã€‚</li><li>å› ä¸ºASCIIå’Œ<code>UTF8</code>æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå¦‚æœä¸æ·»åŠ BOMï¼Œåˆ™ASCIIå’ŒUnicodeå¯ä»¥ç›¸äº’å…¼å®¹ï¼Œå¦‚æœåŠ ä¸Šäº†BOMï¼Œå°±æ‰“ç ´äº†ç›¸äº’å…¼å®¹ã€‚</li></ol><p>ä¸è¿‡å½“å‰å¾ˆå¤šç³»ç»Ÿæˆ–å¹³å°å¹¶æ²¡æœ‰æŒ‰ç…§è§„èŒƒæ¥ï¼Œåœ¨è§£ææ–‡æœ¬çš„æ—¶å€™ä¼šè¦æ±‚<code>UTF8</code>è¦æœ‰BOMï¼Œä»¥åŠåœ¨ä¿å­˜æ–‡æœ¬çš„æ—¶å€™ä¼šåŠ ä¸ŠBOMï¼Œä¾‹å¦‚windowsç³»ç»Ÿçš„è®°äº‹æœ¬ã€‚</p><p>è€Œå¯¹äº<code>UTF16</code>å’Œ<code>UTF32</code>ï¼Œè¦æ·»åŠ BOMï¼Œä¸ç„¶åœ¨è§£æçš„å‡ºçš„æ–‡æœ¬å¯èƒ½å°±æ˜¯ä¹±ç ï¼Œå› ä¸ºè§£æå™¨åœ¨å¯¹å­—èŠ‚é¡ºåºçš„æ¨ç®—ä¸Šï¼Œå¹¶ä¸èƒ½ä¿è¯å®Œå…¨å¯é ã€‚</p><h1 id="ç»„åˆå­—ç¬¦">ç»„åˆå­—ç¬¦</h1><p>Unicodeæœ‰ä¸€ç±»å­—ç¬¦ç§°ä¸ºç»„åˆå­—ç¬¦ï¼Œå®ƒå¯ä»¥é™„åŠ åœ¨å‰ä¸€ä¸ªéç»„åˆå­—ç¬¦ä¸Šï¼Œä»è€Œä½¿æ•´ä½“çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªå­—ç¬¦ã€‚Unicodeç»„åˆå­—ç¬¦è®¾è®¡ä¸Šï¼Œå¹¶æ²¡æœ‰åŠ ç»„åˆæ•°é‡é™åˆ¶ï¼Œè¿™æ ·ä½¿æˆ‘ä»¬å¯ä»¥æ— é™åŠ è¿™ç±»ç»„åˆå­—ç¬¦,ä¾‹å¦‚æ±‰è¯­æ‹¼éŸ³å­—æ¯ã€ŒÃ¼ã€ä¸Šé¢çš„ä¸¤ä¸ªå°ç‚¹ï¼Œæˆ–ã€ŒÃ¡ã€ã€ã€ŒÃ ã€å­—æ¯ä¸Šé¢çš„éŸ³æ ‡ã€‚</p><p><strong>ç»„åˆå­—ç¬¦æœ‰ä¸¤ç§</strong></p><ul><li>ç»„åˆå­—ç¬¦:å°†ç»„åˆå­—ç¬¦ç½®äºéœ€è¦ä¿®é¥°çš„ç›®æ ‡å­—ç¬¦åè¾¹ï¼Œä½¿ç›®æ ‡å­—ç¬¦è¢«æ¸²æŸ“ï¼ˆæˆ–æ‰“å°ï¼‰æˆç›¸åº”ç»“æœã€‚</li><li>é¢„ç»„åˆå­—ç¬¦:äº‹å…ˆå°†å­—ç¬¦ç»„å¥½å¹¶èµ‹äºˆç ä½ã€‚å­—ç¬¦ä¸²ä¸­æœ‰å¯èƒ½åŒæ—¶ä½¿ç”¨ç»„åˆå­—ç¬¦å’Œé¢„ç»„å­—ç¬¦ã€‚è¿™å¯¼è‡´äº†è‹¥è¦æ¯”è¾ƒä¸¤ä¸ªunicodeå­—ç¬¦ä¸²æ—¶ï¼Œéœ€è¦å…ˆè¿è¡Œunicodeå­—ç¬¦çš„ç­‰ä»·æ€§ã€‚</li></ul><p><strong>ç»„åˆå­—ç¬¦åœ¨ Unicodeç»Ÿä¸€ç ä¸­å­˜åœ¨å¤šä¸ªåŒºå—ï¼Œç¼–ç èŒƒå›´ä¸»è¦æœ‰ï¼š</strong></p><ul><li><p>ç»„åˆç”¨é™„åŠ ç¬¦å·ï¼ˆ<span class="exturl" data-url="aHR0cHM6Ly91bmljb2RlLm9yZy9jaGFydHMvUERGL1UwMzAwLnBkZg==">Combining DiacriticalMarks<i class="fa fa-external-link-alt"></i></span>ï¼‰ï¼šåŒºé—´ä» <code>U+0300</code> åˆ° <code>U+036F</code> å…± 80å­—ã€‚</p><p>å®ƒå¸¸ä¸å­—æ¯ç»„åˆï¼Œä¿®é¥°å­—æ¯çš„è¯»éŸ³ã€‚ä½†å…¶å®å®ƒçš„å®šä¹‰æ¯”è¾ƒå®½æ³›ï¼Œä¸ä½†åŒ…æ‹¬äº†æ‹‰ä¸ã€å¸Œè…ŠåŠè¥¿é‡Œå°”ç³»æ–‡å­—ä¸­çš„å˜éŸ³è®°å·ï¼Œä¹ŸåŒ…æ‹¬é‚£äº›ä¸æ˜¯å˜éŸ³ä½†ä¸å æ®å®½åº¦çš„é™„åŠ æ ‡è®°ã€‚ä¾‹å¦‚<code>&amp;#x61;&amp;#3655;&amp;#3655;&amp;#3655;&amp;#3655;&amp;#3662;&amp;#3662;&amp;#3662;&amp;#3662;&amp;#3657;&amp;#3657;&amp;#3657;&amp;#3657;</code>ä¸º aà¹‡à¹‡à¹‡à¹‡à¹à¹à¹à¹à¹‰à¹‰à¹‰à¹‰</p></li><li><p>ç»„åˆç”¨é™„åŠ ç¬¦å·è¡¥é›†ï¼ˆ<span class="exturl" data-url="aHR0cHM6Ly91bmljb2RlLm9yZy9jaGFydHMvUERGL1UxREMwLnBkZg==">Combining DiacriticalMarks Supplement<i class="fa fa-external-link-alt"></i></span>ï¼‰ï¼šåŒºé—´ä» <code>U+1DC0</code> åˆ°<code>U+1DFF</code> å…± 64 å­—ã€‚</p><p>å®ƒå¸¸ä¸ä¸€äº›ç¬¦å·ç»„åˆï¼Œç”¨äºæ¸²æŸ“å’Œä¿®é¥°ç¬¦å·. ä¾‹å¦‚:<code>&amp;#x1DD0;&amp;#x1DD0;&amp;#x61;&amp;#x1DC4;&amp;#x1DC4;</code>ä¸º á·á·aá·„á·„</p></li><li><p>ç»„åˆç”¨è®°å·ï¼ˆ<span class="exturl" data-url="aHR0cHM6Ly91bmljb2RlLm9yZy9jaGFydHMvUERGL1UyMEQwLnBkZg==">Combining DiacriticalMarks for Symbols<i class="fa fa-external-link-alt"></i></span>ï¼‰ï¼šåŒºé—´ä» <code>U+20D0</code> åˆ°<code>U+20FF</code> å…± 48 å­—ã€‚ä¾‹å¦‚:<code>&amp;#x6587;&amp;#x20dd;</code> ä¸º æ–‡âƒ</p></li><li><p>ç»„åˆç”¨åŠå½¢ç¬¦å·ï¼ˆ<span class="exturl" data-url="aHR0cHM6Ly91bmljb2RlLm9yZy9jaGFydHMvUERGL1VGRTIwLnBkZg==">Combining HalfMarks<i class="fa fa-external-link-alt"></i></span>ï¼‰ï¼šåŒºé—´ä» <code>U+FE20</code> åˆ° <code>U+FE2F</code> å…± 16å­—ã€‚</p><p>å¤šä¸ªé™„åŠ å­—ç¬¦å¯ä»¥å åŠ åˆ°ä¸€ä¸ªåŸºç¡€å­—ç¬¦ä¸Š. ä¾‹å¦‚<code>&amp;#xFE20;&amp;#xFE2D;&amp;#x61;</code> ä¸º ï¸ ï¸­a</p></li></ul><p>ç»„åˆå­—ç¬¦ä¹Ÿå¯ä»¥ç”¨äº Emoji, ä¾‹å¦‚ <code>&amp;#x270B;</code> ä¸ºâœ‹,Â <code>&amp;#x270B;&amp;#x1F3FB;</code> ä¸º âœ‹ğŸ»</p><h1 id="é›¶å®½å­—ç¬¦">é›¶å®½å­—ç¬¦</h1><p>é›¶å®½å­—ç¬¦ä¸å¯è§ï¼Œä¸å¯æ‰“å°ï¼Œä¸»è¦ä½œç”¨äºè°ƒæ•´å­—ç¬¦çš„æ˜¾ç¤ºæ ¼å¼.</p><p><strong>é›¶å®½å­—ç¬¦ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç±»ï¼š</strong></p><ul><li>é›¶å®½åº¦ç©ºæ ¼ç¬¦ (zero-width space) U+200B : ç”¨äºè¾ƒé•¿å•è¯çš„æ¢è¡Œåˆ†éš”</li><li>é›¶å®½åº¦éæ–­ç©ºæ ¼ç¬¦ (zero width no-break space) U+FEFF :ç”¨äºé˜»æ­¢ç‰¹å®šä½ç½®çš„æ¢è¡Œåˆ†éš”</li><li>é›¶å®½åº¦è¿å­—ç¬¦ (zero-width joiner) U+200D :ç”¨äºé˜¿æ‹‰ä¼¯æ–‡ä¸å°åº¦è¯­ç³»ç­‰æ–‡å­—ä¸­ï¼Œä½¿ä¸ä¼šå‘ç”Ÿè¿å­—çš„å­—ç¬¦é—´äº§ç”Ÿè¿å­—æ•ˆæœ</li><li>é›¶å®½åº¦æ–­å­—ç¬¦ (zero-width non-joiner) U+200C :ç”¨äºé˜¿æ‹‰ä¼¯æ–‡ï¼Œå¾·æ–‡ï¼Œå°åº¦è¯­ç³»ç­‰æ–‡å­—ä¸­ï¼Œé˜»æ­¢ä¼šå‘ç”Ÿè¿å­—çš„å­—ç¬¦é—´çš„è¿å­—æ•ˆæœ</li><li>å·¦è‡³å³ç¬¦ (left-to-right mark) U+200E :ç”¨äºåœ¨æ··åˆæ–‡å­—æ–¹å‘çš„å¤šç§è¯­è¨€æ–‡æœ¬ä¸­ï¼ˆä¾‹ï¼šæ··åˆå·¦è‡³å³ä¹¦å†™çš„è‹±è¯­ä¸å³è‡³å·¦ä¹¦å†™çš„å¸Œä¼¯æ¥è¯­ï¼‰ï¼Œè§„å®šæ’ç‰ˆæ–‡å­—ä¹¦å†™æ–¹å‘ä¸ºå·¦è‡³å³</li><li>å³è‡³å·¦ç¬¦ (right-to-left mark) U+200F :ç”¨äºåœ¨æ··åˆæ–‡å­—æ–¹å‘çš„å¤šç§è¯­è¨€æ–‡æœ¬ä¸­ï¼Œè§„å®šæ’ç‰ˆæ–‡å­—ä¹¦å†™æ–¹å‘ä¸ºå³è‡³å·¦</li></ul><p><strong>é›¶å®½å­—ç¬¦å¯ä»¥ç”¨äº:</strong></p><ul><li>æ•°æ®é˜²çˆ¬:å°†é›¶å®½åº¦å­—ç¬¦æ’å…¥æ–‡æœ¬ä¸­ï¼Œå¹²æ‰°å…³é”®å­—åŒ¹é…ã€‚çˆ¬è™«å¾—åˆ°çš„å¸¦æœ‰é›¶å®½åº¦å­—ç¬¦çš„æ•°æ®ä¼šå½±å“ä»–ä»¬çš„åˆ†æï¼Œä½†ä¸ä¼šå½±å“ç”¨æˆ·çš„é˜…è¯»æ•°æ®ã€‚</li><li>ä¿¡æ¯ä¼ é€’:å°†è‡ªå®šä¹‰ç»„åˆçš„é›¶å®½åº¦å­—ç¬¦æ’å…¥æ–‡æœ¬ä¸­ï¼Œç”¨æˆ·å¤åˆ¶åä¼šæºå¸¦ä¸å¯è§ä¿¡æ¯ï¼Œè¾¾åˆ°ä¼ é€’ä½œç”¨ã€‚</li><li>ä¼ é€’éšå¯†ä¿¡æ¯:åˆ©ç”¨é›¶å®½åº¦å­—ç¬¦ä¸å¯è§çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨é›¶å®½åº¦å­—ç¬¦åœ¨ä»»ä½•æœªå¯¹é›¶å®½åº¦å­—ç¬¦åšè¿‡æ»¤çš„ç½‘é¡µå†…æ’å…¥ä¸å¯è§çš„éšå½¢æ–‡æœ¬ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„åˆ©ç”¨é›¶å®½åº¦å­—ç¬¦å¯¹æ–‡æœ¬è¿›è¡ŒåŠ å¯†/è§£å¯†çš„</li><li>éšå½¢æ°´å°:é€šè¿‡é›¶å®½åº¦å­—ç¬¦æˆ‘ä»¬å¯ä»¥å¯¹å†…éƒ¨æ–‡ä»¶æ·»åŠ éšå½¢æ°´å°ã€‚åœ¨æµè§ˆè€…ç™»å½•é¡µé¢å¯¹å†…éƒ¨æ–‡ä»¶è¿›è¡Œæµè§ˆæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ–‡ä»¶çš„å„å¤„æ’å…¥ä½¿ç”¨é›¶å®½åº¦å­—ç¬¦åŠ å¯†çš„æµè§ˆè€…ä¿¡æ¯ï¼Œå¦‚æœæµè§ˆè€…åˆæ°å¥½ä½¿ç”¨å¤åˆ¶ç²˜è´´çš„æ–¹å¼åœ¨å…¬å…±åª’ä½“ä¸ŠåŒ¿ååˆ†äº«äº†è¿™ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±èƒ½é€šè¿‡åµŒå…¥åœ¨æ–‡ä»¶ä¸­çš„éšå½¢æ°´å°è½»æ¾æ‰¾åˆ°åˆ†äº«è€…äº†ã€‚</li><li>åŠ å¯†ä¿¡æ¯åˆ†äº«:é€šè¿‡é›¶å®½åº¦å­—ç¬¦æˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•ç½‘ç«™ä¸Šåˆ†äº«ä»»ä½•ä¿¡æ¯ã€‚æ•æ„Ÿä¿¡æ¯çš„å®¡æ ¸ä¸è¿‡æ»¤åœ¨å½“ä»Šçš„äº’è”ç½‘ç¤¾åŒºä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ï¼Œä½†æ˜¯é›¶å®½åº¦å­—ç¬¦å´èƒ½å¦‚å…¥æ— äººä¹‹å¢ƒä¸€èˆ¬è½»æ¾åœ°ç©¿é€è¿™ä¸¤å±‚ä¿¡æ¯åˆ†äº«çš„å±éšœã€‚å¯¹æ¯”æ˜æ–‡å“ˆå¸Œè¡¨åŠ å¯†ä¿¡æ¯çš„æ–¹å¼ï¼Œé›¶å®½åº¦å­—ç¬¦åŠ å¯†åœ¨ç½‘ä¸Šçš„éšè”½æ€§å¯ä»¥è¯´æ˜¯è¾¾åˆ°äº†ä¸€ä¸ªæ–°çš„é«˜åº¦ã€‚ä»…ä»…éœ€è¦ä¸€ä¸ªç®€å•çš„è¯†åˆ«/è§£å¯†é›¶å®½åº¦å­—ç¬¦çš„æµè§ˆå™¨æ’ä»¶ï¼Œä»»ä½•ç½‘ç«™éƒ½å¯ä»¥æˆä¸ºä¿¡æ¯åˆ†äº«çš„æ¸¸ä¹åœºã€‚</li><li>é€ƒè„±æ•æ„Ÿè¯è¿‡æ»¤:é€šè¿‡é›¶å®½åº¦å­—ç¬¦æˆ‘ä»¬å¯ä»¥è½»æ¾é€ƒè„±æ•æ„Ÿè¯è¿‡æ»¤ã€‚æ•æ„Ÿè¯è‡ªåŠ¨è¿‡æ»¤æ˜¯ç»´æŒäº’è”ç½‘ç¤¾åŒºç§©åºçš„ä¸€é¡¹é‡è¦å·¥å…·ï¼Œåªéœ€å€’å…¥æ•æ„Ÿè¯åº“å’ŒåŒ¹é…ç›¸åº”æ•æ„Ÿè¯ï¼Œå³å¯å°†å¤§é‡çš„éæ³•è¯æ±‡æ‹’ä¹‹é—¨å¤–ã€‚ä½¿ç”¨è°éŸ³ä¸æ‹¼éŸ³æ¥é€ƒè„±æ•æ„Ÿè¯è¿‡æ»¤ä¼šè®©è¯­è¨€ä¼ é€’ä¿¡æ¯çš„æ•ˆç‡é™ä½ï¼Œè€Œä½¿ç”¨é›¶å®½åº¦å­—ç¬¦å¯ä»¥åœ¨é€ƒè„±æ•æ„Ÿè¯è¿‡æ»¤çš„åŒæ—¶å°†è¯ä¹‰åŸå°ä¸åŠ¨åœ°ä¼ è¾¾ç»™æ¥å—è€…ï¼Œå¤§å¤§æé«˜ä¿¡æ¯ä¼ æ’­è€…ä¸æ¥å—è€…ä¹‹é—´äº¤æµçš„æ•ˆç‡ã€‚<strong>å¼€å‘æ—¶åªè¿‡æ»¤<code>\u200b</code></strong> å°±å¤Ÿäº†</li></ul><h2 id="emoji-ä¸­çš„é›¶å®½å­—ç¬¦">Emoji ä¸­çš„é›¶å®½å­—ç¬¦</h2><p>é›¶å®½å­—ç¬¦å¯ä»¥ç”¨äº Emoji çš„ç»„åˆ, ä¾‹å¦‚</p><ul><li><p>åœ¨æ„å»º ğŸ‘¨ğŸ»â€ğŸ¦³ æ—¶</p><ul><li>ğŸ‘¨ğŸ»â€ğŸ¦³ ä¸º<code>&amp;#x1F468;&amp;#x1F3FB;&amp;#x200D;&amp;#x1F9B3;</code></li><li>ğŸ‘¨ğŸ»â€ ä¸º <code>&amp;#x1F468;&amp;#x1F3FB;&amp;#x200D;</code></li><li>ğŸ‘¨ğŸ» ä¸º <code>&amp;#x1F468;&amp;#x1F3FB;</code></li><li>ğŸ‘¨ ä¸º <code>&amp;#x1F468;</code></li></ul><p>å…¶ä¸­</p><ul><li>ğŸ‘¨ - U+1F468 - åŸºç¡€å­—ç¬¦</li><li>ğŸ» - U+1F3FB - ç»„åˆå­—ç¬¦ï¼Œè¡¨ç¤ºè‚¤è‰²</li><li><ul><li>U+200D - <strong>é›¶å®½åº¦è¿å­—ç¬¦</strong>ï¼Œè¡¨ç¤ºä¸Šä¸‹ç›¸è¿</li></ul></li><li>ğŸ¦³ - U+1F9B3 - åŸºç¡€å­—ç¬¦ï¼Œè¡¨ç¤ºå‘å‹</li></ul><p>é›¶å­—å®½å­—ç¬¦è¿æ¥äº†å‘å‹ä¸é¢œè‰²</p></li><li><p>ğŸ‘©â€â¤â€ğŸ‘¨ ä¸º<code>&amp;#x1F469;&amp;#x200D;&amp;#x2764;&amp;#x200D;&amp;#x1F468;</code>,å…¶ä¸­</p><ul><li>ğŸ‘© - U+1F469 - åŸºç¡€å­—ç¬¦</li><li><ul><li>U+200D - é›¶å®½åº¦è¿å­—ç¬¦ï¼Œè¡¨ç¤ºä¸Šä¸‹ç›¸è¿</li></ul></li><li>â¤ - U+2764 - åŸºç¡€å­—ç¬¦</li><li><ul><li>U+200D - é›¶å®½åº¦è¿å­—ç¬¦ï¼Œè¡¨ç¤ºä¸Šä¸‹ç›¸è¿</li></ul></li><li>ğŸ‘¨ - U+1F468 - åŸºç¡€å­—ç¬¦</li></ul></li><li><p>ğŸ‘©â€ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦ ä¸º<code>&amp;#x1F469;&amp;#x200D;&amp;#x1F469;&amp;#x200D;&amp;#x1F466;&amp;#x200D;&amp;#x1F466;</code>,å…¶ä¸­</p><ul><li>ğŸ‘© - U+1F469 - åŸºç¡€å­—ç¬¦</li><li><ul><li>U+200D - é›¶å®½åº¦è¿å­—ç¬¦ï¼Œè¡¨ç¤ºä¸Šä¸‹ç›¸è¿</li></ul></li><li>ğŸ‘© - U+1F469 - åŸºç¡€å­—ç¬¦</li><li><ul><li>U+200D - é›¶å®½åº¦è¿å­—ç¬¦ï¼Œè¡¨ç¤ºä¸Šä¸‹ç›¸è¿</li></ul></li><li>ğŸ‘¦ - U+1F466 - åŸºç¡€å­—ç¬¦</li><li><ul><li>U+200D - é›¶å®½åº¦è¿å­—ç¬¦ï¼Œè¡¨ç¤ºä¸Šä¸‹ç›¸è¿</li></ul></li><li>ğŸ‘¦ - U+1F466 - åŸºç¡€å­—ç¬¦</li></ul></li></ul>]]></content>
    
    
    <summary type="html">é—²æ¥æ— äº‹ä»”ç»†äº†è§£ä¸€ä¸‹ Unicode ç¼–ç è§„åˆ™, å¹¶å°è¯•å®ç°ä¸€äº› &amp;#x6709;&amp;#3655;&amp;#3655;&amp;#3655;&amp;#3655;&amp;#3662;&amp;#3662;&amp;#3662;&amp;#3662;&amp;#3657;&amp;#3657;&amp;#3657;&amp;#3657;&amp;#x8da3;&amp;#3657;&amp;#3657;&amp;#3657;&amp;#3657;&amp;#3655;&amp;#3655;&amp;#3655;&amp;#3655;&amp;#3662;&amp;#3662;&amp;#3662;&amp;#3662;çš„&amp;#x7279;&amp;#x20dd; &amp;#x0333;&amp;#x0333;&amp;#x308;&amp;#x303;&amp;#x6548;&amp;#x200b;&amp;#x0333;&amp;#x0333;&amp;#x308;&amp;#x303;</summary>
    
    
    
    <category term="çæŠ˜è…¾" scheme="https://blog.liukairui.me/categories/%E7%9E%8E%E6%8A%98%E8%85%BE/"/>
    
    <category term="ç¼–ç è§„èŒƒ" scheme="https://blog.liukairui.me/categories/%E7%9E%8E%E6%8A%98%E8%85%BE/%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/"/>
    
    
    <category term="ç¼–ç è§„èŒƒ" scheme="https://blog.liukairui.me/tags/%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/"/>
    
    <category term="Unicode" scheme="https://blog.liukairui.me/tags/Unicode/"/>
    
  </entry>
  
  <entry>
    <title>WebRTCåŸºç¡€</title>
    <link href="https://blog.liukairui.me/article/WebRTC%E5%9F%BA%E7%A1%80/"/>
    <id>https://blog.liukairui.me/article/WebRTC%E5%9F%BA%E7%A1%80/</id>
    <published>2022-12-03T16:00:01.000Z</published>
    <updated>2022-12-03T16:00:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="webrtc-æ˜¯ä»€ä¹ˆ">WebRTC æ˜¯ä»€ä¹ˆ</h2><p><strong>WebRTC æ˜¯ä»€ä¹ˆ</strong></p><ul><li>WebRTC(Web Real-Time Communication)æ˜¯ä¸€å¥—æ—¨åœ¨å®ç°äº’è”ç½‘æµè§ˆå™¨ä¹‹é—´å®æ—¶é€šè®¯çš„å…è´¹å¼€æ”¾API.</li><li>WebRTC ä¸»è¦åŒ…å«äº†ä¸¤ç§ä¸åŒçš„æŠ€æœ¯: åª’ä½“æ•è·è®¾å¤‡å’Œç‚¹å¯¹ç‚¹è¿æ¥</li></ul><p><strong>WebRTC ä¸æ˜¯ä»€ä¹ˆ</strong></p><ul><li><p>WebRTC ç”¨äºå®ç°å®æ—¶æ•°æ®åŒå‘é€šè®¯,ä½†ä¸é€‚ç”¨äºç›´æ’­ç­‰å¤§è§„æ¨¡å•å‘æ•°æ®åˆ†å‘.</p><p>ç”±äºéœ€è¦åšåˆ°åŒå‘æ•°æ®ä¼ æ’­, æ‰€æœ‰ç”¨æˆ·éœ€è¦è¿æ¥åˆ°åŒä¸€ä¸ªæœåŠ¡å™¨,å³ä½¿åƒå£°ç½‘è¿™æ ·çš„ä¼ä¸šçº§ SDK ä¹Ÿåªèƒ½åšåˆ° 32 äººå®æ—¶è¿éº¦,ç™¾ä¸‡åŒæ—¶åœ¨çº¿(å•å‘æ•°æ®åˆ†å‘).</p><p>ç›´æ’­(RTMP, Real Time Messaging Protocol)åªéœ€è¦åšåˆ°å•å‘æ•°æ®ä¼ è¾“,æˆ‘ä»¬å¯ä»¥éƒ¨ç½²å¤§é‡æœåŠ¡å™¨ä¸ CDN å®ç°å¤§è§„æ¨¡æ•°æ®åˆ†å‘.</p></li><li><p>WebRTC ä¸æ˜¯ Web åº”ç”¨ä¸“æœ‰çš„, å…¶å¯ä»¥è¿è¡Œåœ¨æµè§ˆå™¨, æ¡Œé¢åº”ç”¨,ç§»åŠ¨è®¾å¤‡ä¸ IoT è®¾å¤‡ä¸Š</p></li></ul><p><strong>WebRTC ç»„æˆ</strong></p><figure><img src="./img/1-1.png" alt="WebRTC Architecture" /><figcaption aria-hidden="true">WebRTC Architecture</figcaption></figure><p>WebRTC æ˜¯ä¸€å¥— API, å¯ä»¥æ ¹æ® API çš„ä½¿ç”¨å¯¹è±¡åˆ†ä¸º</p><ul><li>Web å¼€å‘è€…éœ€è¦ä½¿ç”¨çš„: W3C å®šä¹‰çš„ WebAPI</li><li>æµè§ˆå™¨å‚å•†éœ€è¦å®ç°çš„: WebRTC çš„ C++ å±‚, å®ç°äº† W3C å®šä¹‰çš„WebAPI</li><li>æµè§ˆå™¨å‚å•†å¯ä»¥è‡ªå®šä¹‰é‡å†™çš„: éŸ³è§†é¢‘æ•è·æ’­æ”¾ä¸ç½‘ç»œIO</li><li>WebRTC å®ç°æ ¸å¿ƒæ¨¡å—<ul><li>ä¼šè¯ç®¡ç†: ç”¨æ¥ç®¡ç†éŸ³è§†é¢‘, ééŸ³è§†é¢‘æ•°æ®ä¼ è¾“, å¤„ç†ç›¸å…³é€»è¾‘.</li><li>éŸ³é¢‘å¼•æ“: ç¼–è§£ç åŠŸèƒ½, éŸ³é¢‘ç¼“å†² buffer, å›éŸ³æ¶ˆé™¤.</li><li>è§†é¢‘å¼•æ“: è§†é¢‘ç¼–è§£ç å™¨, è§†é¢‘ç¼“å†² buffer, å›¾åƒå¢å¼º.</li><li>æ•°æ®ä¼ è¾“: SRTPä¼ è¾“åè®®, å¤šæµå¤ç”¨, P2P.</li></ul></li></ul><p>## WebRTC é€šè¯åŸç†</p><ul><li><p>åª’ä½“åå•†: åœ¨é€šä¿¡å‰éœ€è¦å…ˆä½¿ç”¨ä¼šè¯æè¿°åè®®(SDP, session descriptionprotocol)é€šæŠ¥é€šä¿¡ç»ˆç«¯æ”¯æŒçš„ç¼–è§£ç æ ¼å¼,å¹¶ç¡®å®šå‡ºä¸€ä¸ªå…±æœ‰çš„ç¼–è§£ç æ ¼å¼ç”¨äºé€šä¿¡.</p></li><li><p>ç½‘ç»œåå•†: åœ¨é€šä¿¡å‰è¦æ‰¾åˆ°ä¸€æ¡å¯ä»¥ç›¸äº’é€šè®¯çš„é“¾è·¯.å°†ç½‘ç»œåå•†æ‰€éœ€çš„ä¿¡æ¯ç§°ä¸º candidate</p><ul><li><p>åœ¨æ²¡æœ‰ NAT æ—¶, å¯ä»¥ç›´æ¥é€šè¿‡å…¬ç½‘ IP å®ç° P2P è¿æ¥</p></li><li><p>åœ¨å­˜åœ¨ NAT æ—¶, å¯ä»¥é€šè¿‡ç«¯å£æ˜ å°„è¿æ¥åˆ™ä½¿ç”¨ç«¯å£æ˜ å°„å®ç° P2P.</p><p>ç”±äºé€šä¿¡ç»ˆç«¯ä¸çŸ¥é“è‡ªå·±åœ¨ NAT è½¬æ¢åæ˜ å°„çš„ç«¯å£, é€šä¿¡ç»ˆç«¯å°†è¯·æ±‚ STUNæœåŠ¡å™¨, STUN è¿”å›è¯¥ç»ˆç«¯çš„å¤–ç½‘ IP ä¸ç«¯å£.</p></li><li><p>è‹¥ç«¯å£æ˜ å°„(æ‰“æ´)å¤±è´¥, ä¸­æ–­å°†è¿æ¥åˆ° TURN æœåŠ¡å™¨, TURNæœåŠ¡å™¨ä½œä¸ºä¸­ç»§æœåŠ¡å™¨è´Ÿè´£ä¹‹åé€šä¿¡</p></li></ul><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NvdHVybi9jb3R1cm4=">coturn<i class="fa fa-external-link-alt"></i></span> æ˜¯ä¸€ä¸ªå¼€æºçš„STUN ä¸ TURN æœåŠ¡å™¨å®ç°</p></li><li><p>ä¿¡ä»¤æœåŠ¡å™¨: ä¸€å¥—åŒ…å«åª’ä½“åå•†ä¸ç½‘ç»œåå•†çš„æœåŠ¡å™¨å®ç°,åœ¨å®ç°ä¸¤ç§åå•†çš„åŸºç¡€ä¸Šè¿˜åº”è¯¥å®ç°å…¶ä»–ç®¡ç†åŠŸèƒ½(å¦‚: æˆ¿é—´ç®¡ç†, ç”¨æˆ·ç®¡ç†,ç”¨æˆ·æ ¡éªŒ...). <strong>ä¿¡ä»¤æœåŠ¡å™¨å¹¶ééœ€è¦å®ç°ä¸€å¥—å›ºå®šçš„æ ‡å‡† /API</strong>, åªéœ€è¦æŒ‰éœ€å¼€å‘å³å¯. ä»¥ä¸€å¯¹ä¸€é€šä¿¡ä¸ºä¾‹</p><p><img src="./img/1-2.png" /></p><p><strong>è¿æ¥</strong></p><ul><li>è¿æ¥åŒæ–¹ä¸ä¿¡ä»¤æœåŠ¡å™¨å»ºç«‹è¿æ¥(ä¸æŒ‡å®šè¿æ¥åè®®),å…ˆè¿æ¥è®¾å¤‡ä½œä¸ºæˆ¿ä¸»</li><li>åŒæ–¹è·å–è‡ªå·±çš„åª’ä½“æµ</li><li>åŒæ–¹åŠ å…¥æˆ¿é—´, å…ˆåŠ å…¥è€…ä¸ºæˆ¿ä¸», åè¿›å…¥è€…åŠ å…¥åä¿¡ä»¤æœåŠ¡å™¨é€šçŸ¥æˆ¿ä¸»,åŒæ—¶å°†æˆ¿ä¸»ä¿¡æ¯è¿”å›ç»™åŠ å…¥è€…</li></ul><p><strong>åª’ä½“åå•†</strong></p><ul><li>æˆ¿ä¸»åˆ›å»º RTCPeerConnection, ç»‘å®š onXX å›è°ƒ</li><li>æˆ¿ä¸»åˆ›å»º Track (ç›¸å½“äºæœ¬åœ°åª’ä½“æµçš„å¥æŸ„ä»¥ä¾›å¯¹æ–¹å°†æ¥ä½¿ç”¨)</li><li>æˆ¿ä¸»åˆ›å»º offer, ç”Ÿæˆæµè§ˆå™¨çš„ SDP</li><li>æˆ¿ä¸»å‘é€ SDP(offer) åˆ°ä¿¡ä»¤æœåŠ¡å™¨, ä¿¡ä»¤æœåŠ¡å™¨å°† offer è½¬å‘ç»™å¯¹æ–¹</li><li>å¯¹æ–¹åˆ›å»º RTCPeerConnection, ç»‘å®š onXX å›è°ƒ</li><li>å¯¹æ–¹åˆ›å»º Track, é€šè¿‡å¯¹æ–¹ track è·å–æˆ¿ä¸»ç æµå¥æŸ„</li><li>å¯¹æ–¹è®°å½•æˆ¿ä¸»çš„ SDP, ç”Ÿæˆè‡ªå·±çš„ answer, ç”Ÿæˆè‡ªå·±çš„ SDP</li><li>å¯¹æ–¹å‘é€ answer åˆ°ä¿¡ä»¤æœåŠ¡å™¨, ä¿¡ä»¤æœåŠ¡å™¨å°† answer è½¬å‘ç»™æˆ¿ä¸»</li><li>æˆ¿ä¸»è®°å½•å¯¹æ–¹çš„ SDP</li></ul><p><strong>ç½‘ç»œåå•†</strong></p><ul><li>æˆ¿ä¸»ä¸å¯¹æ–¹åŒæ—¶å‘èµ·ç½‘ç»œåå•†, å‘èµ· ICE è¯·æ±‚åˆ° coturn æœåŠ¡å™¨, coturnæœåŠ¡å™¨è¿”å› Candidate.</li><li>åŒæ–¹å°† Candidate é€šè¿‡ä¿¡ä»¤æœåŠ¡å™¨å‘é€ç»™å¦ä¸€æ–¹</li><li>å¦ä¸€æ–¹è®°å½• Candidate å¹¶å°è¯•å‘èµ·è¿æ¥</li><li>ç”±äºæ‰“æ´åœ°å€å¯èƒ½å˜åŒ–, æ‰€ä»¥æŸä¸€æ–¹å¯èƒ½ä¼šæ”¶åˆ°å¤šä¸ª Candidate,å…¶åº”è¯¥é€ä¸ªå°è¯•ç›´åˆ°æˆåŠŸè¿æ¥</li></ul><p><strong>ç¦»å¼€æˆ¿é—´</strong></p><ul><li>ç¦»å¼€è€…å‘èµ·ç¦»å¼€æˆ¿é—´å‘½ä»¤, ä¿¡ä»¤æœåŠ¡å™¨åˆ é™¤ç”¨æˆ·å¹¶é€šçŸ¥å¯¹æ–¹</li></ul><p>ä»è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°, WebRTC åªæ˜¯æä¾›äº†ä¸€å¥— APIå¹¶æ²¡æœ‰æä¾›å®æ—¶é€šä¿¡çš„è¯¦ç»†å®ç°,è¯¦ç»†é€šä¿¡é€»è¾‘è¿˜éœ€è¦ä¿¡ä»¤æœåŠ¡å™¨è®¾è®¡è€…å®ç°</p></li></ul><h2 id="webrtc-ç›¸å…³åè®®">WebRTC ç›¸å…³åè®®</h2><h3 id="rtp-åè®®">RTP åè®®</h3><p>æˆ‘ä»¬ä¸€èˆ¬ä¸ç›´æ¥å°†éŸ³è§†é¢‘æ•°æ®æµé€šè¿‡ UDP ä¼ è¾“,è¿™æ˜¯å› ä¸ºéŸ³è§†é¢‘æ•°æ®ä¸­ä¸€å¸§æ•°æ®é‡è¿œå¤§äº UDP çš„MTU, åœ¨å‘é€æ—¶éœ€è¦æ‹†æˆå¤šä¸ªåŒ….è‹¥ç›´æ¥é€šè¿‡ UDP ä¼ è¾“, æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ç»´æŠ¤ UDP åŒ…çš„é¡ºåºå¹¶é‡å»ºå¸§. RTPåè®®å®ç°äº†éŸ³è§†é¢‘ä¼ è¾“å¯¹å¸§çš„ç»´æŠ¤.</p><p>RTP(Real-time <strong>Transport</strong> Protocol)å®æ—¶<strong>ä¼ è¾“</strong>åè®®ä¸ºç«¯åˆ°ç«¯çš„å®æ—¶ä¼ è¾“æä¾›æ—¶é—´ä¿¡æ¯å’ŒæµåŒæ­¥,RTPå¹¶ä¸ä¿è¯æœåŠ¡è´¨é‡, æœåŠ¡è´¨é‡ç”±RTCPæ¥æä¾›.</p><p>RTPåè®®æ ¼å¼:</p><pre class="line-numbers language-none"><code class="language-none"> 0                   1                   2                   3 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+|V&#x3D;2|P|X|  CC   |M|     PT      |       sequence number         |+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+|                           timestamp                           |+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+|           synchronization source (SSRC) identifier            |+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+|            contributing source (CSRC) identifiers             ||                             ....                              |+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol type="1"><li><p>V: RTPåè®®çš„ç‰ˆæœ¬å·, å 2ä½, å½“å‰åè®®ç‰ˆæœ¬å·ä¸º2.</p></li><li><p>P: å¡«å……æ ‡å¿—, å 1ä½, å¦‚æœP=1,åˆ™åœ¨è¯¥æŠ¥æ–‡çš„å°¾éƒ¨å¡«å……ä¸€ä¸ªæˆ–å¤šä¸ªé¢å¤–çš„å…«ä½ç»„,å®ƒä»¬ä¸æ˜¯æœ‰æ•ˆè½½è·çš„ä¸€éƒ¨åˆ†.</p></li><li><p>X: æ‰©å±•æ ‡å¿—, å 1ä½, å¦‚æœX=1,åˆ™åœ¨RTPæŠ¥å¤´åè·Ÿæœ‰ä¸€ä¸ªæ‰©å±•æŠ¥å¤´.</p></li><li><p>CC: CSRC è®¡æ•°å™¨, å 4ä½, æŒ‡ç¤º CSRC æ ‡è¯†ç¬¦çš„ä¸ªæ•°.</p></li><li><p>M: æ ‡è®°, å 1ä½, ä¸åŒçš„æœ‰æ•ˆè½½è·æœ‰ä¸åŒçš„å«ä¹‰, å¯¹äºè§†é¢‘,æ ‡è®°ä¸€å¸§çš„ç»“æŸï¼›å¯¹äºéŸ³é¢‘, æ ‡è®°ä¼šè¯çš„å¼€å§‹.</p></li><li><p>PT: æœ‰æ•ˆè½½è·ç±»å‹, å 7ä½, ç”¨äºè¯´æ˜RTPæŠ¥æ–‡ä¸­æœ‰æ•ˆè½½è·çš„ç±»å‹,å¦‚GSMéŸ³é¢‘ã€JPEMå›¾åƒç­‰,åœ¨æµåª’ä½“ä¸­å¤§éƒ¨åˆ†æ˜¯ç”¨æ¥åŒºåˆ†éŸ³é¢‘æµå’Œè§†é¢‘æµçš„,è¿™æ ·ä¾¿äºå®¢æˆ·ç«¯è¿›è¡Œè§£æ. å¯ä»¥é€šè¿‡payloadå€¼çŸ¥é“éŸ³é¢‘çš„ç±»å‹, è§†é¢‘çš„ç±»å‹,æœ‰äº›å…¬å¸å¯èƒ½ä¼šä½¿ç”¨PTå€¼æ‰©å±•è‡ªå·±çš„ç±»å‹ï¼›è­¬å¦‚é™„åŠ ç±»å‹(å­—å¹•, è´´çš„å°å›¾ç‰‡,ç”»çš„æ¡†æ¡†)</p></li><li><p>åºåˆ—å·: å 16ä½, ç”¨äºæ ‡è¯†å‘é€è€…æ‰€å‘é€çš„RTPæŠ¥æ–‡çš„åºåˆ—å·,æ¯å‘é€ä¸€ä¸ªæŠ¥æ–‡, åºåˆ—å·å¢1. è¿™ä¸ªå­—æ®µå½“ä¸‹å±‚çš„æ‰¿è½½åè®®ç”¨UDPçš„æ—¶å€™,ç½‘ç»œçŠ¶å†µä¸å¥½çš„æ—¶å€™å¯ä»¥ç”¨æ¥æ£€æŸ¥ä¸¢åŒ….åŒæ—¶å‡ºç°ç½‘ç»œæŠ–åŠ¨çš„æƒ…å†µå¯ä»¥ç”¨æ¥å¯¹æ•°æ®è¿›è¡Œé‡æ–°æ’åº,åœ¨helixæœåŠ¡å™¨ä¸­è¿™ä¸ªå­—æ®µæ˜¯ä»0å¼€å§‹çš„,åŒæ—¶éŸ³é¢‘åŒ…å’Œè§†é¢‘åŒ…çš„sequenceæ˜¯åˆ†åˆ«è®°æ•°çš„.</p></li><li><p>æ—¶æˆ³(Timestamp): å 32ä½,æ—¶æˆ³åæ˜ äº†è¯¥RTPæŠ¥æ–‡çš„ç¬¬ä¸€ä¸ªå…«ä½ç»„çš„é‡‡æ ·æ—¶åˆ».æ¥æ”¶è€…ä½¿ç”¨æ—¶æˆ³æ¥è®¡ç®—å»¶è¿Ÿå’Œå»¶è¿ŸæŠ–åŠ¨, å¹¶è¿›è¡ŒåŒæ­¥æ§åˆ¶.</p></li><li><p>åŒæ­¥ä¿¡æº(SSRC)æ ‡è¯†ç¬¦: å 32ä½, ç”¨äºæ ‡è¯†åŒæ­¥ä¿¡æº.è¯¥æ ‡è¯†ç¬¦æ˜¯éšæœºé€‰æ‹©çš„,å‚åŠ åŒä¸€è§†é¢‘ä¼šè®®çš„ä¸¤ä¸ªåŒæ­¥ä¿¡æºä¸èƒ½æœ‰ç›¸åŒçš„SSRC.</p></li><li><p>ç‰¹çº¦ä¿¡æº(CSRC)æ ‡è¯†ç¬¦: æ¯ä¸ªCSRCæ ‡è¯†ç¬¦å 32ä½, å¯ä»¥æœ‰0ï½15ä¸ª.æ¯ä¸ªCSRCæ ‡è¯†äº†åŒ…å«åœ¨è¯¥RTPæŠ¥æ–‡æœ‰æ•ˆè½½è·ä¸­çš„æ‰€æœ‰ç‰¹çº¦ä¿¡æº.</p><p>å¦‚æœæ‰©å±•æ ‡å¿—è¢«ç½®ä½åˆ™è¯´æ˜ç´§è·Ÿåœ¨æŠ¥å¤´åé¢æ˜¯ä¸€ä¸ªå¤´æ‰©å±•, å…¶æ ¼å¼å¦‚ä¸‹:</p><pre class="line-numbers language-none"><code class="language-none">0                   1                   2                   30 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+|      defined by profile       |           length              |+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+|                        header extension                       ||                             ....                              |<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="rtcp-åè®®">RTCP åè®®</h3><p>RTCP(RTP <strong>Control</strong>Protocol)å®æ—¶ä¼ è¾“<strong>æ§åˆ¶</strong>åè®®, åŒRTPä¸€èµ·ç”¨äºæ•°æ®ä¼ è¾“çš„ç›‘è§†,æ§åˆ¶åŠŸèƒ½.</p><p>å½“åº”ç”¨ç¨‹åºå¯åŠ¨ä¸€ä¸ª RTP ä¼šè¯æ—¶å°†åŒæ—¶å ç”¨ä¸¤ä¸ªç«¯å£, åˆ†åˆ«ä¾› RTP å’Œ RTCPä½¿ç”¨. RTP æœ¬èº«å¹¶ä¸èƒ½ä¸ºæŒ‰åºä¼ è¾“æ•°æ®åŒ…æä¾›å¯é çš„ä¿è¯,ä¹Ÿä¸æä¾›æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶, è¿™äº›éƒ½ç”± RTCP æ¥è´Ÿè´£å®Œæˆ. é€šå¸¸ RTCP ä¼šé‡‡ç”¨ä¸RTP ç›¸åŒçš„åˆ†å‘æœºåˆ¶, å‘ä¼šè¯ä¸­çš„æ‰€æœ‰æˆå‘˜å‘¨æœŸæ€§åœ°å‘é€æ§åˆ¶ä¿¡æ¯,åº”ç”¨ç¨‹åºé€šè¿‡æ¥æ”¶è¿™äº›æ•°æ®, ä»ä¸­è·å–ä¼šè¯å‚ä¸è€…çš„ç›¸å…³èµ„æ–™,ä»¥åŠç½‘ç»œçŠ¶å†µã€åˆ†ç»„ä¸¢å¤±æ¦‚ç‡ç­‰åé¦ˆä¿¡æ¯,ä»è€Œèƒ½å¤Ÿå¯¹æœåŠ¡è´¨é‡è¿›è¡Œæ§åˆ¶æˆ–è€…å¯¹ç½‘ç»œçŠ¶å†µè¿›è¡Œè¯Šæ–­.</p><p>RTCPåè®®çš„åŠŸèƒ½æ˜¯é€šè¿‡ä¸åŒçš„RTCPæ•°æ®æŠ¥æ¥å®ç°çš„, ä¸»è¦æœ‰å¦‚ä¸‹å‡ ç§ç±»å‹:</p><ol type="1"><li><strong>SR</strong>: å‘é€ç«¯æŠ¥å‘Š,æ‰€è°“å‘é€ç«¯æ˜¯æŒ‡å‘å‡ºRTPæ•°æ®æŠ¥çš„åº”ç”¨ç¨‹åºæˆ–è€…ç»ˆç«¯, å‘é€ç«¯åŒæ—¶ä¹Ÿå¯ä»¥æ˜¯æ¥æ”¶ç«¯.(SERVERå®šæ—¶é—´å‘é€ç»™CLIENT).</li><li><strong>RR</strong>: æ¥æ”¶ç«¯æŠ¥å‘Š,æ‰€è°“æ¥æ”¶ç«¯æ˜¯æŒ‡ä»…æ¥æ”¶ä½†ä¸å‘é€RTPæ•°æ®æŠ¥çš„åº”ç”¨ç¨‹åº.</li><li>SDES: æºæè¿°, ä¸»è¦åŠŸèƒ½æ˜¯ä½œä¸ºä¼šè¯æˆå‘˜æœ‰å…³æ ‡è¯†ä¿¡æ¯çš„è½½ä½“,å¦‚ç”¨æˆ·åã€é‚®ä»¶åœ°å€ã€ç”µè¯å·ç ç­‰,æ­¤å¤–è¿˜å…·æœ‰å‘ä¼šè¯æˆå‘˜ä¼ è¾¾ä¼šè¯æ§åˆ¶ä¿¡æ¯çš„åŠŸèƒ½.</li><li>BYE: é€šçŸ¥ç¦»å¼€, ä¸»è¦åŠŸèƒ½æ˜¯æŒ‡ç¤ºæŸä¸€ä¸ªæˆ–è€…å‡ ä¸ªæºä¸å†æœ‰æ•ˆ,å³é€šçŸ¥ä¼šè¯ä¸­çš„å…¶ä»–æˆå‘˜è‡ªå·±å°†é€€å‡ºä¼šè¯.</li><li>APP: ç”±åº”ç”¨ç¨‹åºè‡ªå·±å®šä¹‰, è§£å†³äº†RTCPçš„æ‰©å±•æ€§é—®é¢˜,å¹¶ä¸”ä¸ºåè®®çš„å®ç°è€…æä¾›äº†å¾ˆå¤§çš„çµæ´»æ€§.</li></ol><p>RTCP åè®®é€šè¿‡ RR å’Œ SR æŠ¥æ–‡äº¤æ¢æ¥è·å–è‡ªå·±çš„ç½‘ç»œè´¨é‡, ç»“æ„ä¸º</p><pre class="line-numbers language-none"><code class="language-none">        0                   1                   2                   3        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+header |V&#x3D;2|P|    RC   |   PT&#x3D;SR&#x3D;200   |             length            |       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+       |                         SSRC of sender                        |       +&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+sender |              NTP timestamp, most significant word             |info   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+       |             NTP timestamp, least significant word             |       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+       |                         RTP timestamp                         |       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+       |                     sender&#39;s packet count                     |       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+       |                      sender&#39;s octet count                     |       +&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+report |                 SSRC_1 (SSRC of first source)                 |block  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  1    | fraction lost |       cumulative number of packets lost       |       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+       |           extended highest sequence number received           |       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+       |                      interarrival jitter                      |       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+       |                         last SR (LSR)                         |       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+       |                   delay since last SR (DLSR)                  |       +&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+report |                 SSRC_2 (SSRC of second source)                |block  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  2    :                               ...                             :       +&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+&#x3D;+       |                  profile-specific extensions                  |       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>SR åŒ…ä½¿ç”¨äº†</p><ul><li>ç‰ˆæœ¬(V): åŒRTPåŒ…å¤´åŸŸ.</li><li>å¡«å……(P): åŒRTPåŒ…å¤´åŸŸ.</li><li>æ¥æ”¶æŠ¥å‘Šè®¡æ•°å™¨(RC): 5æ¯”ç‰¹, è¯¥SRåŒ…ä¸­çš„æ¥æ”¶æŠ¥å‘Šå—çš„æ•°ç›®,å¯ä»¥ä¸ºé›¶.</li><li>åŒ…ç±»å‹(PT): 8æ¯”ç‰¹, SRåŒ…æ˜¯200.</li><li>é•¿åº¦åŸŸ(Length): 16æ¯”ç‰¹,å…¶ä¸­å­˜æ”¾çš„æ˜¯è¯¥SRåŒ…ä»¥32æ¯”ç‰¹ä¸ºå•ä½çš„æ€»é•¿åº¦å‡ä¸€.</li><li>åŒæ­¥æº(SSRC of sender): SRåŒ…å‘é€è€…çš„åŒæ­¥æºæ ‡è¯†ç¬¦.ä¸å¯¹åº”RTPåŒ…ä¸­çš„SSRCä¸€æ ·.</li><li>NTP Timestamp(Network time protocol) SRåŒ…å‘é€æ—¶çš„ç»å¯¹æ—¶é—´å€¼.NTPçš„ä½œç”¨æ˜¯åŒæ­¥ä¸åŒçš„RTPåª’ä½“æµ.</li><li>RTP Timestamp: ä¸NTPæ—¶é—´æˆ³å¯¹åº”,ä¸RTPæ•°æ®åŒ…ä¸­çš„RTPæ—¶é—´æˆ³å…·æœ‰ç›¸åŒçš„å•ä½å’Œéšæœºåˆå§‹å€¼.</li><li>Senderâ€™s packet count: ä»å¼€å§‹å‘é€åŒ…åˆ°äº§ç”Ÿè¿™ä¸ªSRåŒ…è¿™æ®µæ—¶é—´é‡Œ,å‘é€è€…å‘é€çš„RTPæ•°æ®åŒ…çš„æ€»æ•°. SSRCæ”¹å˜æ—¶, è¿™ä¸ªåŸŸæ¸…é›¶.</li><li>Sender`s octet count: ä»å¼€å§‹å‘é€åŒ…åˆ°äº§ç”Ÿè¿™ä¸ªSRåŒ…è¿™æ®µæ—¶é—´é‡Œ,å‘é€è€…å‘é€çš„å‡€è·æ•°æ®çš„æ€»å­—èŠ‚æ•°(ä¸åŒ…æ‹¬å¤´éƒ¨å’Œå¡«å……) . å‘é€è€…æ”¹å˜å…¶SSRCæ—¶,è¿™ä¸ªåŸŸè¦æ¸…é›¶.</li><li>åŒæ­¥æºnçš„SSRCæ ‡è¯†ç¬¦:è¯¥æŠ¥å‘Šå—ä¸­åŒ…å«çš„æ˜¯ä»è¯¥æºæ¥æ”¶åˆ°çš„åŒ…çš„ç»Ÿè®¡ä¿¡æ¯.</li><li>ä¸¢å¤±ç‡(Fraction Lost):è¡¨æ˜ä»ä¸Šä¸€ä¸ªSRæˆ–RRåŒ…å‘å‡ºä»¥æ¥ä»åŒæ­¥æºn(SSRC_n)æ¥çš„RTPæ•°æ®åŒ…çš„ä¸¢å¤±ç‡.</li><li>ç´¯è®¡çš„åŒ…ä¸¢å¤±æ•°ç›®:ä»å¼€å§‹æ¥æ”¶åˆ°SSRC_nçš„åŒ…åˆ°å‘é€SR,ä»SSRC_nä¼ è¿‡æ¥çš„RTPæ•°æ®åŒ…çš„ä¸¢å¤±æ€»æ•°.</li><li>æ”¶åˆ°çš„æ‰©å±•æœ€å¤§åºåˆ—å·: ä»SSRC_næ”¶åˆ°çš„RTPæ•°æ®åŒ…ä¸­æœ€å¤§çš„åºåˆ—å·,</li><li>æ¥æ”¶æŠ–åŠ¨(Interarrival jitter): RTPæ•°æ®åŒ…æ¥å—æ—¶é—´çš„ç»Ÿè®¡æ–¹å·®ä¼°è®¡</li><li>ä¸Šæ¬¡SRæ—¶é—´æˆ³(Last SR,LSR):å–æœ€è¿‘ä»SSRC_næ”¶åˆ°çš„SRåŒ…ä¸­çš„NTPæ—¶é—´æˆ³çš„ä¸­é—´32æ¯”ç‰¹. å¦‚æœç›®å‰è¿˜æ²¡æ”¶åˆ°SRåŒ…,åˆ™è¯¥åŸŸæ¸…é›¶.</li><li>ä¸Šæ¬¡SRä»¥æ¥çš„å»¶æ—¶(Delay since last SR,DLSR):ä¸Šæ¬¡ä»SSRC_næ”¶åˆ°SRåŒ…åˆ°å‘é€æœ¬æŠ¥å‘Šçš„å»¶æ—¶.</li></ul><h3 id="æ ‡å‡†-sdp-åè®®">æ ‡å‡† SDP åè®®</h3><p>SDP æè¿°äº†</p><ol type="1"><li>éŸ³é¢‘ç¼–è§£ç å™¨æ˜¯ä»€ä¹ˆ,è¿™äº›ç¼–è§£ç å™¨è®¾å®šçš„å‚æ•°æ˜¯ä»€ä¹ˆ</li><li>ä½¿ç”¨çš„ä¼ è¾“åè®®æ˜¯ä»€ä¹ˆ</li><li>ä»¥åŠåŒ…æ‹¬çš„éŸ³è§†é¢‘åª’ä½“æ˜¯ä»€ä¹ˆ</li></ol><p>æ ‡å‡† SDP è§„èŒƒä¸»è¦åŒ…æ‹¬ <strong>SDP æè¿°æ ¼å¼å’Œ SDP ç»“æ„</strong>, è€ŒSDP ç»“æ„ç”±<strong>ä¼šè¯æè¿°å’Œåª’ä½“ä¿¡æ¯æè¿°</strong>ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆ.å…¶ä¸­,åª’ä½“ä¿¡æ¯æè¿°åŒ…æ‹¬äº†:</p><ul><li>åª’ä½“ç±»å‹</li><li>åª’ä½“æ ¼å¼</li><li>ä¼ è¾“åè®®</li><li>ä¼ è¾“çš„ IP å’Œç«¯å£</li></ul><p><strong>SDP ç”±ä¸€ä¸ªä¼šè¯çº§æè¿°(session leveldescription)å’Œå¤šä¸ªåª’ä½“çº§æè¿°(media level description)ç»„æˆ</strong></p><ul><li>ä¼šè¯çº§(session level)çš„ä½œç”¨åŸŸæ˜¯æ•´ä¸ªä¼šè¯,å…¶ä½ç½®æ˜¯ä» v=è¡Œå¼€å§‹åˆ°ç¬¬ä¸€ä¸ªåª’ä½“æè¿°ä¸ºæ­¢ã€‚<ul><li><code>v=</code> (protocol version): SDP çš„ç‰ˆæœ¬å·</li><li><code>o=&lt;username&gt; &lt;session id&gt; &lt;version&gt; &lt;network type&gt; &lt;address type&gt; &lt;address&gt;</code>è¡¨ç¤ºçš„æ˜¯å¯¹ä¼šè¯å‘èµ·è€…çš„æè¿°, æ ¼å¼ä¸º<ul><li><code>&lt;username&gt;</code>:ç”¨æˆ·å,å½“ä¸å…³å¿ƒç”¨æˆ·åæ—¶,å¯ä»¥ç”¨ â€œ-â€ä»£æ›¿</li><li><code>&lt;session id&gt;</code>:æ•°å­—ä¸²,åœ¨æ•´ä¸ªä¼šè¯ä¸­,å¿…é¡»æ˜¯å”¯ä¸€çš„,å»ºè®®ä½¿ç”¨NTP æ—¶é—´æˆ³</li><li><code>&lt;version&gt;</code>:ç‰ˆæœ¬å·,æ¯æ¬¡ä¼šè¯æ•°æ®ä¿®æ”¹å,è¯¥ç‰ˆæœ¬å€¼ä¼šé€’å¢</li><li><code>&lt;network type&gt;</code>:ç½‘ç»œç±»å‹,ä¸€èˆ¬ä¸ºâ€œINâ€,è¡¨ç¤ºâ€œinternetâ€</li><li><code>&lt;address type&gt;</code>: åœ°å€ç±»å‹,ä¸€èˆ¬ä¸º IP4</li><li><code>&lt;address&gt;</code>:IP åœ°å€</li></ul></li><li><code>s=&lt;session name&gt;</code>, è¡¨ç¤ºä¸€ä¸ªä¼šè¯, åœ¨æ•´ä¸ª SDPä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªä¼šè¯</li><li><code>t=&lt;start time&gt; &lt;stop time&gt;</code> (time thesession is active)ã€‚æè¿°äº†ä¼šè¯çš„å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ã€‚å…¶ä¸­,<code>&lt;start time&gt;</code> å’Œ <code>&lt;stop time&gt;</code> ä¸º NTPæ—¶é—´,å•ä½æ˜¯ç§’;å½“ <code>&lt;start time&gt;</code> å’Œ<code>&lt;stop time&gt;</code> å‡ä¸ºé›¶æ—¶,è¡¨ç¤ºæŒä¹…ä¼šè¯ã€‚</li></ul></li><li>åª’ä½“çº§(media level)æ˜¯å¯¹å•ä¸ªçš„åª’ä½“æµè¿›è¡Œæè¿°,å…¶ä½ç½®æ˜¯ä» m=è¡Œå¼€å§‹åˆ°ä¸‹ä¸€ä¸ªåª’ä½“æè¿°(å³ä¸‹ä¸€ä¸ª m=)ä¸ºæ­¢ã€‚<ul><li><code>m=&lt;media&gt; &lt;port&gt; &lt;transport&gt; &lt;fmt list&gt;</code>(media name and transport address): è¡¨ç¤ºä¸€ä¸ªä¼šè¯<ul><li><code>&lt;media&gt;</code>: åª’ä½“ç±»å‹,æ¯”å¦‚ audio/video ç­‰;</li><li><code>&lt;port&gt;</code>: ç«¯å£;</li><li><code>&lt;transport&gt;</code>: ä¼ è¾“åè®®,æœ‰ä¸¤ç§â€”â€”RTP/AVP å’ŒUDP;</li><li><code>&lt;fmt list&gt;</code>: åª’ä½“æ ¼å¼,å³æ•°æ®è´Ÿè½½ç±»å‹ (PayloadType) åˆ—è¡¨ã€‚</li></ul></li><li><code>a=&lt;TYPE&gt;[:&lt;VALUES&gt;]</code>(zero or more mediaattribute lines): ç”¨äºè¿›ä¸€æ­¥æè¿°åª’ä½“ä¿¡æ¯, å¸¸è§çš„æœ‰ <code>rtpmap</code>ä¸ <code>fmtp</code><ul><li><code>a=rtpmap:&lt;payload type&gt; &lt;encoding name&gt;/&lt;clock rate&gt; [/&lt;encodingparameters&gt;]</code>:RTP å‚æ•°æ˜ å°„è¡¨<ul><li><code>&lt;payload type&gt;</code> : è´Ÿè½½ç±»å‹,å¯¹åº” RTPåŒ…ä¸­çš„éŸ³è§†é¢‘æ•°æ®è´Ÿè½½ç±»å‹ã€‚</li><li><code>&lt;encoding name&gt;</code>: ç¼–ç å™¨åç§°,å¦‚ VP8ã€VP9ã€OPUSç­‰ã€‚</li><li><code>&lt;sample rate&gt;</code>: é‡‡æ ·ç‡,å¦‚éŸ³é¢‘çš„é‡‡æ ·ç‡é¢‘ç‡32000ã€48000 ç­‰ã€‚</li><li><code>&lt;encodingparameters&gt;</code>:ç¼–ç å‚æ•°,å¦‚éŸ³é¢‘æ˜¯å¦æ˜¯åŒå£°é“,é»˜è®¤ä¸ºå•å£°é“ã€‚</li></ul></li><li><code>a=fmtp:&lt;payload type&gt; &lt;format specific parameters&gt;</code>:è¡¨ç¤ºæ ¼å¼å‚æ•°<ul><li><code>&lt;payload type&gt;</code>: è´Ÿè½½ç±»å‹,åŒæ ·å¯¹åº” RTPåŒ…ä¸­çš„éŸ³è§†é¢‘æ•°æ®è´Ÿè½½ç±»å‹</li><li><code>&lt;format specific parameters&gt;</code>: æŒ‡å…·ä½“å‚æ•°ã€‚</li></ul></li></ul></li></ul></li></ul><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; ä¼šè¯çº§v&#x3D;0o&#x3D;â€ 7017624586836067756 2 IN IP4 127.0.0.1s&#x3D;â€t&#x3D;0 0&#x2F;&#x2F; åª’ä½“çº§: ä¸€ä¸ªéŸ³é¢‘,ä¸€ä¸ªè§†é¢‘ã€‚m&#x3D;audio 9 UDP&#x2F;TLS&#x2F;RTP&#x2F;SAVPF 111 103 104 9 0 8 106 105 13 126...m&#x3D;video 9 UDP&#x2F;TLS&#x2F;RTP&#x2F;SAVPF 96 97 98 99 100 101 102 122 127 121 125 107 108 109 124 120 123119 114 115 116...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="webrtc-çš„-sdp">WebRTC çš„ SDP</h3><p>WebRTC å¯¹ SDP æ ‡å‡†åšäº†è°ƒæ•´, å¯ä»¥å°† SDP æŒ‰åŠŸèƒ½åˆ†æˆå‡ å¤§å—:</p><ul><li>Session Metadata,ä¼šè¯å…ƒæ•°æ®</li><li>Network Description,ç½‘ç»œæè¿°</li><li>Stream Description,æµæè¿°</li><li>Security Descriptions,å®‰å…¨æè¿°</li><li>Qos Grouping Descriptions, æœåŠ¡è´¨é‡æè¿°</li></ul><pre class="line-numbers language-none"><code class="language-none">                                                +---------------------+                                                |        v&#x3D;           |                                                +---------------------+                +---------------------+         +---------------------+        &#x3D;&#x3D;&#x3D;&#x3D;    |   Session Metadata  |  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  |        o&#x3D;           |        |       +---------------------+         +----------------------        |                                       +---------------------+        |                                       |        t&#x3D;           |        |                                       +---------------------+        |        |        |                                       +---------------------+        |                                       |        c&#x3D;           |        |                                       +---------------------+        |       +---------------------+        &#x3D;&#x3D;&#x3D;&#x3D;    | Network Description |   &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;        |       +---------------------+        |                                       +---------------------+        |                                       |    a&#x3D;candidate      |        |                                       +---------------------+        |        |        |                                       +---------------------+        |                                       |        m&#x3D;           |        |                                       +---------------------+        |        +---------------------+        +---------------------+        &#x3D;&#x3D;&#x3D;&#x3D;     | Stream Description  |  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D; |      a&#x3D;rtpmap       |        |        +---------------------+        +----------------------        |                                       +---------------------+        |                                       |      a&#x3D;fmtp         |        |                                       +---------------------+        |                                       +---------------------+        |                                       |      a&#x3D;sendrecv..   |        |                                       +---------------------++---------------+|    SEMANTIC   || COMPONENTS OF ||     SDP       |+---------------+        |                                       +---------------------+        |                                       |      a&#x3D;crypto       |        |                                       +---------------------+        |         +---------------------+       +---------------------+        &#x3D;&#x3D;&#x3D;&#x3D;      |Security Descriptions|  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|      a&#x3D;ice-frag     |        |         +---------------------+       +----------------------        |                                       +---------------------+        |                                       |      a&#x3D;ice-pwd      |        |                                       +---------------------+        |                                       +---------------------+        |                                       |     a&#x3D;fingerprint   |        |                                       +---------------------+        |        |        |        |                                       +---------------------+        |                                       |      a&#x3D;rtcp-fb      |        |                                       +---------------------+        |         +---------------------+       +---------------------+        &#x3D;&#x3D;&#x3D;&#x3D;      |   Qos,Grouping      |       |                     |                  |   Descriptions      |  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|       a&#x3D;group       |                  +---------------------+       +----------------------                                                +---------------------+                                                |       a&#x3D;rtcpmux     |                                                +---------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®‰å…¨æè¿°ä¸æœåŠ¡è´¨é‡æè¿°æ˜¯æ–°å¢çš„å±æ€§æè¿°, ä¾‹å¦‚</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; å®‰å…¨æè¿° &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x2F;&#x2F; è¿›å…¥è¿é€šæ€§æ£€æµ‹çš„ç”¨æˆ·åa&#x3D;iceâ€ufrag:1uEe &#x2F;&#x2F; å¯†ç ,è¿™ä¸¤ä¸ªæ˜¯ç”¨äºè¿é€šæ€§æ£€æµ‹çš„å‡­è¯a&#x3D;iceâ€pwd:RQe+y7SOLQJET+duNJ+Qbk7z&#x2F;&#x2F;DTLS æŒ‡çº¹è®¤è¯,ä»¥è¯†åˆ«æ˜¯å¦æ˜¯åˆæ³•ç”¨æˆ·a&#x3D;fingerprint:shaâ€256 35:6F:40:3D:F6:9B:BA:5B:F6:2A:7F:65:59:60:6D:6B:F9:C7:AE:46:44:B4:E4:73:F8:60:67:4D:58:E2:EB:9C ...&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; æœåŠ¡è´¨é‡æè¿° &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;a&#x3D;rtcpâ€muxa&#x3D;rtcpâ€rsizea&#x3D;rtpmap:96 VP8&#x2F;90000a&#x3D;rtcpâ€fb:96 googâ€remb &#x2F;&#x2F; ä½¿ç”¨ google çš„å¸¦å®½è¯„ä¼°ç®—æ³•a&#x3D;rtcpâ€fb:96 transportâ€cc &#x2F;&#x2F; å¯åŠ¨é˜²æ‹¥å¡a&#x3D;rtcpâ€fb:96 ccm fir &#x2F;&#x2F; è§£ç å‡ºé”™,è¯·æ±‚å…³é”®å¸§a&#x3D;rtcpâ€fb:96 nack&#x2F;&#x2F; å¯ç”¨ä¸¢åŒ…é‡ä¼ åŠŸèƒ½a&#x3D;rtcpâ€fb:96 nack pli &#x2F;&#x2F; ä¸ fir ç±»ä¼¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="candidate">Candidate</h3><p>åœ¨ç½‘ç»œåå•†ä¸­ Candidate(å€™é€‰äºº) ç”¨äºä¼ é€’ç½‘ç»œä¿¡æ¯, Candidate å¹¶ä¸å”¯ä¸€(ä¾‹å¦‚: ä¸€ä¸ª peer å¯èƒ½å› ä¸ºæœ‰å¤šå¼ ç½‘å¡å¯¹å¤–æä¾›å¤šä¸ª Candidate). é¢å¯¹å¤šä¸ªCandidate å…¶ä»– peer ä¼šä¼˜å…ˆå°è¯•æœ¬åœ°åœ°å€(å†…ç½‘åœ°å€), å†å°è¯•æ˜ å°„åœ°å€,æœ€åå°è¯•ä½¿ç”¨ä¸­ç»§æœåŠ¡è¿æ¥.</p><p>åœ¨è¿›è¡Œ P2P è¿æ¥æ—¶, WebRTC å°†å°è¯• <strong>NATæ‰“æ´(P2Pç©¿è¶Š)</strong>åœ¨æ‰“æ´å‰, WebRTC ä¼šå…ˆåˆ¤æ–­ NAT ç±»å‹, ç„¶åå†æ‰“æ´. NAT ç±»å‹æœ‰</p><ul><li><p>Full Cone NATï¼ˆå®Œå…¨é”¥å‹NATï¼‰</p><p>æ‰€æœ‰ä»åŒä¸€ä¸ªç§ç½‘IPåœ°å€å’Œç«¯å£ï¼ˆIP1:Port1ï¼‰å‘é€è¿‡æ¥çš„è¯·æ±‚éƒ½ä¼šè¢«æ˜ å°„æˆåŒä¸€ä¸ªå…¬ç½‘IPåœ°å€å’Œç«¯å£ï¼ˆIP:Portï¼‰.å¹¶ä¸”, ä»»ä½•å¤–éƒ¨ä¸»æœºé€šè¿‡å‘æ˜ å°„çš„å…¬ç½‘IPåœ°å€å’Œç«¯å£å‘é€æŠ¥æ–‡,éƒ½å¯ä»¥å®ç°å’Œå†…éƒ¨ä¸»æœºè¿›è¡Œé€šä¿¡.</p><p>è¿™æ˜¯ä¸€ç§æ¯”è¾ƒå®½æ¾çš„ç­–ç•¥,åªè¦å»ºç«‹äº†ç§ç½‘IPåœ°å€å’Œç«¯å£ä¸å…¬ç½‘IPåœ°å€å’Œç«¯å£çš„æ˜ å°„å…³ç³»,æ‰€æœ‰çš„Internetä¸Šçš„ä¸»æœºéƒ½å¯ä»¥è®¿é—®è¯¥NATä¹‹åçš„ä¸»æœº.</p></li><li><p>Restricted Cone NATï¼ˆé™åˆ¶é”¥å‹NATï¼‰</p><p>æ‰€æœ‰ä»åŒä¸€ä¸ªç§ç½‘IPåœ°å€å’Œç«¯å£ï¼ˆIP1:Port1ï¼‰å‘é€è¿‡æ¥çš„è¯·æ±‚éƒ½ä¼šè¢«æ˜ å°„æˆåŒä¸€ä¸ªå…¬ç½‘IPå’Œç«¯å£å·ï¼ˆIP:Portï¼‰.ä¸å®Œå…¨é”¥å‹NATä¸åŒçš„æ˜¯, å½“ä¸”ä»…å½“å†…éƒ¨ä¸»æœºä¹‹å‰å·²ç»å‘å…¬ç½‘ä¸»æœºå‘é€è¿‡æŠ¥æ–‡,æ­¤æ—¶å…¬ç½‘ä¸»æœºæ‰èƒ½å‘ç§ç½‘ä¸»æœºå‘é€æŠ¥æ–‡.</p></li><li><p>Port Restricted Cone NATï¼ˆç«¯å£é™åˆ¶é”¥å‹NATï¼‰</p><p>ä¸é™åˆ¶é”¥å‹NATå¾ˆç›¸ä¼¼, åªä¸è¿‡å®ƒåŒ…æ‹¬ç«¯å£å·. ä¹Ÿå°±æ˜¯è¯´,ä¸€å°å…¬ç½‘ä¸»æœºï¼ˆIP2:Port2ï¼‰æƒ³ç»™ç§ç½‘ä¸»æœºå‘é€æŠ¥æ–‡,å¿…é¡»æ˜¯è¿™å°ç§ç½‘ä¸»æœºå…ˆå‰å·²ç»ç»™è¿™ä¸ªIPåœ°å€å’Œç«¯å£å‘é€è¿‡æŠ¥æ–‡.</p></li><li><p>Symmetric NATï¼ˆå¯¹ç§°NATï¼‰</p><p>æ‰€æœ‰ä»åŒä¸€ä¸ªç§ç½‘IPåœ°å€å’Œç«¯å£å‘é€åˆ°ä¸€ä¸ªç‰¹å®šçš„ç›®çš„IPåœ°å€å’Œç«¯å£çš„è¯·æ±‚,éƒ½ä¼šè¢«æ˜ å°„åˆ°åŒä¸€ä¸ªIPåœ°å€å’Œç«¯å£.å¦‚æœåŒä¸€å°ä¸»æœºä½¿ç”¨ç›¸åŒçš„æºåœ°å€å’Œç«¯å£å·å‘é€æŠ¥æ–‡, ä½†æ˜¯å‘å¾€ä¸åŒçš„ç›®çš„åœ°,NATå°†ä¼šä½¿ç”¨ä¸åŒçš„æ˜ å°„. æ­¤å¤–,åªæœ‰æ”¶åˆ°æ•°æ®çš„å…¬ç½‘ä¸»æœºæ‰å¯ä»¥åè¿‡æ¥å‘ç§ç½‘ä¸»æœºå‘é€æŠ¥æ–‡.</p><p>è¿™å’Œç«¯å£é™åˆ¶é”¥å‹NATä¸åŒ,ç«¯å£é™åˆ¶é”¥å‹NATæ˜¯æ‰€æœ‰è¯·æ±‚æ˜ å°„åˆ°ç›¸åŒçš„å…¬ç½‘IPåœ°å€å’Œç«¯å£,è€Œå¯¹ç§°NATæ˜¯ä¸åŒçš„è¯·æ±‚æœ‰ä¸åŒçš„æ˜ å°„.</p></li></ul><h2 id="è°ƒç”¨æœ¬åœ°åª’ä½“è®¾å¤‡">è°ƒç”¨æœ¬åœ°åª’ä½“è®¾å¤‡</h2><p>å¯ä»¥é€šè¿‡<code>navigator.mediaDevices.getUserMedia(constraints)</code>è·å–æœ¬åœ°åª’ä½“ä¿¡æ¯ (<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvQVBJL01lZGlhRGV2aWNlcy9nZXRVc2VyTWVkaWE=">MDN<i class="fa fa-external-link-alt"></i></span>),å…¶ä¸­</p><ul><li><p><code>constraints = &#123; audio: true, video: true &#125;</code>,åˆ†åˆ«æ§åˆ¶æ˜¯å¦è·å–è§†é¢‘ä¸éŸ³é¢‘.</p></li><li><p>æ›´å¤šç”¨æ³•</p><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">constraints <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">audio</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token literal-property property">video</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">min</span><span class="token operator">:</span> <span class="token number">1280</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">min</span><span class="token operator">:</span> <span class="token number">720</span> <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>constraints <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">audio</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token literal-property property">video</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">min</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token literal-property property">ideal</span><span class="token operator">:</span> <span class="token number">1280</span><span class="token punctuation">,</span> <span class="token literal-property property">max</span><span class="token operator">:</span> <span class="token number">1920</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">min</span><span class="token operator">:</span> <span class="token number">776</span><span class="token punctuation">,</span> <span class="token literal-property property">ideal</span><span class="token operator">:</span> <span class="token number">720</span><span class="token punctuation">,</span> <span class="token literal-property property">max</span><span class="token operator">:</span> <span class="token number">1080</span> <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>constraints <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">audio</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token literal-property property">video</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">ideal</span><span class="token operator">:</span> <span class="token number">1280</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// ç†æƒ³å€¼</span>        <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">ideal</span><span class="token operator">:</span> <span class="token number">720</span> <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>å¯ä»¥æŒ‡å®šè§†é¢‘å¤§å°, ä½†æ˜¯å¯¹æµè§ˆå™¨ç‰ˆæœ¬è¦æ±‚é«˜</p></li><li><p>è¯¥æ–¹æ³•çš„è¿”å›å€¼æ˜¯ promise, æˆåŠŸåä¼ å…¥åª’ä½“æµ, å¤±è´¥ä¼ å…¥é”™è¯¯ä¿¡æ¯,å¸¸è§çš„å¤±è´¥æœ‰ <code>NotReadableError</code> è¯¥é”™è¯¯ä¼šå‘ç”Ÿåœ¨ videoæºè¢«å ç”¨æ—¶</p></li></ul><p><strong>åœ¨æµè§ˆå™¨æ˜¾ç¤ºæœ¬åœ°å£°éŸ³ä¸è§†é¢‘</strong></p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>video<span class="token punctuation">"</span></span> <span class="token attr-name">controls</span> <span class="token attr-name">autoplay</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>å¼€å§‹æ•è·<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">function</span> <span class="token function">getLocalVideo</span><span class="token punctuation">(</span><span class="token parameter">videoElem</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      navigator<span class="token punctuation">.</span>mediaDevices        <span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token comment">// å¼€å¯éŸ³è§†é¢‘</span>          <span class="token literal-property property">video</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>          <span class="token literal-property property">audio</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">stream</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>videoElem<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> stream<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// æˆåŠŸåå°†è¿”å›æµå†™å…¥ video</span>        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¤±è´¥è¾“å‡ºåŸå› </span>    <span class="token punctuation">&#125;</span>    document      <span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>        <span class="token string">'click'</span><span class="token punctuation">,</span>        <span class="token function">getLocalVideo</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">)</span><span class="token punctuation">;</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">å› ä¸ºç–‘ä¼¼è¦è¢«è½¬å²—åˆ° WebRTC ç›¸å…³å²—ä½, ç®€å•å­¦ä¸€ä¸‹ç›¸å…³çŸ¥è¯†(é¢å‘ JD çš„ç¼–ç¨‹äº†å±äºæ˜¯)</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="WebRTC" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/WebRTC/"/>
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="WebRTC" scheme="https://blog.liukairui.me/tags/WebRTC/"/>
    
    <category term="WebSocket" scheme="https://blog.liukairui.me/tags/WebSocket/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€ç‚¹è®¾è®¡åŸåˆ™</title>
    <link href="https://blog.liukairui.me/article/%E4%B8%80%E7%82%B9%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/"/>
    <id>https://blog.liukairui.me/article/%E4%B8%80%E7%82%B9%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/</id>
    <published>2022-11-06T16:00:00.000Z</published>
    <updated>2022-11-06T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å•ä¸€èŒè´£åŸåˆ™">å•ä¸€èŒè´£åŸåˆ™</h2><blockquote><p>ä¸€ä¸ªå¯¹è±¡ / æ–¹æ³•åªåšä¸€ä»¶äº‹(åªæœ‰ä¸€ä¸ªå¼•èµ·ä»–å˜åŒ–çš„åŸå› )</p></blockquote><p>ä¸€ä»¶äº‹æ˜¯é€»è¾‘ä¸Šçš„ä¸€ä»¶äº‹, ä¸æ˜¯ä¸€ä¸ªå‡½æ•°(æ¯”å¦‚åˆ›å»º xhr ä¸å‘é€ xhrå®Œå…¨å¯ä»¥æ”¾ä¸€èµ·)</p><p><strong>åº”ç”¨</strong></p><ul><li><p>ä»£ç†æ¨¡å¼çš„å•ä¸€åŠŸèƒ½</p></li><li><p>è¿­ä»£å™¨æ¨¡å¼è¿­ä»£ä¸æ‰§è¡Œåˆ†ç¦»</p></li><li><p>å•ä¾‹æ¨¡å¼ä¸­å·¥å‚æ–¹æ³•ä¸ä¼ å…¥æ–¹æ³•åˆ†ç¦»</p></li><li><p>è£…é¥°è€…æ¨¡å¼åŠ¨æ€æ·»åŠ å•ä¸€èŒè´£</p></li><li><p>ä¼˜ç‚¹: é™ä½å¯¹è±¡ç²’åº¦, é™ä½å•ä¸ªç±» / å¯¹è±¡å¤æ‚åº¦,æå‡å¯¹è±¡å¯å¤ç”¨æ€§</p></li><li><p>ç¼ºç‚¹: å¢åŠ ä»£ç å¤æ‚åº¦</p></li></ul><h2 id="æœ€å°‘çŸ¥è¯†åŸåˆ™ç‹„ç±³ç‰¹æ³•åˆ™">æœ€å°‘çŸ¥è¯†åŸåˆ™(ç‹„ç±³ç‰¹æ³•åˆ™)</h2><blockquote><p>å°½é‡æä¾›ç®€å•çš„æ¥å£, å‡å°‘å¯¹è±¡ä¹‹é—´çš„äº¤äº’, ä»è€Œå‡å°ç±»ä¹‹é—´çš„è€¦åˆ</p></blockquote><p><strong>åº”ç”¨</strong></p><ul><li>ä¸­ä»‹è€…æ¨¡å¼</li><li>å°è£…</li></ul><h2 id="å¼€æ”¾-å°é—­åŸåˆ™">å¼€æ”¾-å°é—­åŸåˆ™</h2><blockquote><p>è½¯ä»¶å®ä½“(ç±», æ¨¡å—, å‡½æ•°)åº”è¯¥æ˜¯å¯æ‰©å±•çš„,ä½†<strong>ä¸å¯ä¿®æ”¹</strong></p></blockquote><p><strong>åº”ç”¨</strong></p><ul><li>å‘å¸ƒè®¢é˜…æ¨¡å¼</li><li>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</li><li>ç­–ç•¥æ¨¡å¼</li><li>ä»£ç†æ¨¡å¼</li><li>èŒè´£é“¾æ¨¡å¼</li></ul><p><strong>å¦‚ä½•å¼€æ”¾</strong></p><ul><li>é€šè¿‡å›è°ƒ</li><li>é€šè¿‡é’©å­æ§åˆ¶å®è§‚æµç¨‹</li><li>æ‰¾åˆ°å®¹æ˜“å˜åŒ–çš„åœ°æ–¹, é€šè¿‡å¤šæ€å°†å˜åŒ–çš„éƒ¨åˆ†å°è£…å…¥å¤šæ€</li></ul><h2 id="é‡Œæ°æ›¿æ¢åŸåˆ™">é‡Œæ°æ›¿æ¢åŸåˆ™</h2><blockquote><p>å¦‚æœå¯¹æ¯ä¸€ä¸ªç±»å‹ä¸º S çš„å¯¹è±¡ o1, éƒ½æœ‰ç±»å‹ä¸º T çš„å¯¹è±¡ o2, ä½¿å¾—ä»¥ Tå®šä¹‰çš„æ‰€æœ‰ç¨‹åº P åœ¨æ‰€æœ‰çš„å¯¹è±¡ o1 éƒ½ä»£æ›¿ o2 æ—¶, ç¨‹åº Pçš„è¡Œä¸ºæ²¡æœ‰å‘ç”Ÿå˜åŒ–, é‚£ä¹ˆç±»å‹ S æ˜¯ç±»å‹ T çš„å­ç±»å‹.</p></blockquote><blockquote><p>é€šä¿—ç‚¹è®², å°±æ˜¯åªè¦çˆ¶ç±»èƒ½å‡ºç°çš„åœ°æ–¹, å­ç±»å°±å¯ä»¥å‡ºç°,è€Œä¸”æ›¿æ¢ä¸ºå­ç±»ä¹Ÿä¸ä¼šäº§ç”Ÿä»»ä½•é”™è¯¯æˆ–å¼‚å¸¸.</p></blockquote><ul><li>å­ç±»å¿…é¡»å®Œå…¨å®ç°çˆ¶ç±»çš„æ–¹æ³•</li><li>å­ç±»å¯ä»¥æœ‰è‡ªå·±çš„ä¸ªæ€§</li><li>è¦†ç›–æˆ–å®ç°çˆ¶ç±»çš„æ–¹æ³•æ—¶, è¾“å…¥å‚æ•°å¯ä»¥è¢«æ”¾å¤§</li><li>è¦†ç›–æˆ–å®ç°çˆ¶ç±»çš„æ–¹æ³•æ—¶, è¾“å‡ºç»“æœå¯ä»¥è¢«ç¼©å°</li></ul><h2 id="ä¾èµ–å€’ç½®åŸåˆ™é¢å‘æ¥å£ç¼–ç¨‹">ä¾èµ–å€’ç½®åŸåˆ™(é¢å‘æ¥å£ç¼–ç¨‹)</h2><blockquote><p>é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½å±‚æ¨¡å—, è€Œåº”è¯¥ä¾èµ–äºæŠ½è±¡. æŠ½è±¡ä¸åº”ä¾èµ–äºç»†èŠ‚,ç»†èŠ‚åº”ä¾èµ–äºæŠ½è±¡</p></blockquote><ol type="1"><li>æ¨¡å—é—´çš„ä¾èµ–é€šè¿‡æŠ½è±¡å‘ç”Ÿ, å®ç°ç±»ä¹‹é—´ä¸ç›´æ¥å‘ç”Ÿä¾èµ–å…³ç³»,å…¶ä¾èµ–å…³ç³»æ˜¯é€šè¿‡æ¥å£æˆ–æŠ½è±¡ç±»äº§ç”Ÿçš„</li><li>æ¥å£æˆ–æŠ½è±¡ç±»ä¸ä¾èµ–äºå®ç°ç±»</li><li>å®ç°ç±»ä¾èµ–æ¥å£æˆ–æŠ½è±¡ç±»</li></ol><p>å³</p><ul><li>æ¯ä¸ªç±»å°½é‡éƒ½æœ‰æ¥å£æˆ–æŠ½è±¡ç±»ï¼Œæˆ–è€…æ¥å£å’ŒæŠ½è±¡ç±»ä¸¤è€…éƒ½å…·å¤‡ã€‚</li><li>å˜é‡çš„è¡¨é¢ç±»å‹å°½é‡æ˜¯æ¥å£æˆ–æŠ½è±¡ç±»ã€‚</li><li>ä»»ä½•ç±»éƒ½ä¸åº”è¯¥ä»å…·ä½“ç±»æ´¾ç”Ÿã€‚</li><li>å°½é‡ä¸è¦é‡å†™åŸºç±»çš„æ–¹æ³•ã€‚å¦‚æœåŸºç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè€Œä¸”è¿™ä¸ªæ–¹æ³•å·²ç»å®ç°äº†ï¼Œå­ç±»å°½é‡ä¸è¦é‡å†™ã€‚</li></ul><h2 id="æ¥å£éš”ç¦»åŸåˆ™">æ¥å£éš”ç¦»åŸåˆ™</h2><blockquote><p>ä¸è¦å¯¹å¤–æš´éœ²æ²¡æœ‰å®é™…æ„ä¹‰çš„æ¥å£</p></blockquote><h2 id="é‡æ„åŸåˆ™">é‡æ„åŸåˆ™</h2><ul><li><strong>æŠ½ç¦»å‡½æ•°åŸåˆ™</strong><ul><li>å½“å‡½æ•°è¿‡äºè‡ƒè‚¿æ—¶</li><li>ç‹¬ç«‹éƒ¨åˆ†å¯ä»¥è¢«å¤ç”¨</li><li>ç‹¬ç«‹å‡ºçš„å‡½æ•°æ‹¥æœ‰æ›´å¥½çš„å‘½å(è¯­ä¹‰)</li><li>ç‹¬ç«‹å‡ºçš„å‡½æ•°å¯ä»¥è¢«é‡è½½(é‡å†™)</li></ul></li><li>å¯¹äºæ¡ä»¶åˆ†æ”¯<ul><li>å°è¯•å°†æ¡ä»¶æŠ½ç¦»ä¸ºå‡½æ•°ä»¥æé«˜è¯­ä¹‰</li><li>æå–é‡å¤éƒ¨åˆ†è€Œä¸æ˜¯åœ¨æ¯ä¸ªåˆ†æ”¯éƒ½æ‰§è¡Œ</li></ul></li><li>å¯¹äºè¾ƒé•¿çš„ç¡¬ç¼–ç <ul><li>ä½¿ç”¨å¾ªç¯å®Œæˆç¡¬ç¼–ç </li></ul></li><li>å¯¹äºå‡½æ•°å‚æ•°<ul><li>å°½é‡å‡å°‘å‚æ•°æ•°ç›®</li><li>å‚æ•°æ•°ç›®è¿‡å¤šå¯ä»¥é‡‡ç”¨å¯¹è±¡ä¼ å…¥è€Œä¸æ˜¯ä¼ å…¥å‚æ•°åˆ—è¡¨</li></ul></li><li>é“¾å¼è°ƒç”¨ä¸åˆ©äºè°ƒè¯•, åº”è¯¥å°†å…¶åº”ç”¨äºé€»è¾‘ç¨³å®šçš„åœºæ™¯</li><li>ä½¿ç”¨å‡½æ•°ä»£æ›¿å†—é•¿çš„ <code>if-else</code></li></ul>]]></content>
    
    
    <summary type="html">éšæ‰‹è®°ä¸€äº›è®¾è®¡åŸåˆ™å§~</summary>
    
    
    
    <category term="è®¡ç®—æœºç†è®º" scheme="https://blog.liukairui.me/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%90%86%E8%AE%BA/"/>
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://blog.liukairui.me/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%90%86%E8%AE%BA/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="è®¡ç®—æœºç†è®º" scheme="https://blog.liukairui.me/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%90%86%E8%AE%BA/"/>
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://blog.liukairui.me/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="è®¾è®¡åŸåˆ™" scheme="https://blog.liukairui.me/tags/%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€äº›JavaScripté«˜é˜¶å‡½æ•°</title>
    <link href="https://blog.liukairui.me/article/%E4%B8%80%E4%BA%9BJavaScript%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/"/>
    <id>https://blog.liukairui.me/article/%E4%B8%80%E4%BA%9BJavaScript%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/</id>
    <published>2022-11-04T16:00:00.000Z</published>
    <updated>2022-11-04T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p>å‡½æ•°æŸ¯é‡ŒåŒ–</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">currying</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// æ”¶é›†ä¼ å…¥çš„å‚æ•°</span>  <span class="token keyword">const</span> <span class="token function-variable function">curred</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>arguments<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ²¡æœ‰å‚æ•°å†æŒ‡å‘</span>    <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> curred<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> curred<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">plus</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> args<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pre<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=></span> pre <span class="token operator">+</span> cur<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> plusCurred <span class="token operator">=</span> <span class="token function">currying</span><span class="token punctuation">(</span>plus<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">plusCurred</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">plusCurred</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">plusCurred</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å°†å‡½æ•°é™„åŠ åœ¨ Function ä¸Š, å®ç°ä¸€æ­¥è½¬ä¸ºæŸ¯é‡ŒåŒ–(éªšæ“ä½œ)</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">currying</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// æ”¶é›†ä¼ å…¥çš„å‚æ•°</span>  <span class="token keyword">const</span> <span class="token function-variable function">curred</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>arguments<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ²¡æœ‰å‚æ•°å†æŒ‡å‘</span>    <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> curred<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> curred<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">plus</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> args<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pre<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=></span> pre <span class="token operator">+</span> cur<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> plusCurred <span class="token operator">=</span> plus<span class="token punctuation">.</span><span class="token function">currying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">plusCurred</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">plusCurred</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">plusCurred</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åæŸ¯é‡ŒåŒ– <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">unCurrying</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> push <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>push<span class="token punctuation">.</span><span class="token function">unCurrying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> t1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">push</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 1, 2, 3, 4 ]</span><span class="token comment">// å®šä¹‰ length çš„å¯¹è±¡éƒ½å¯ä»¥ç”¨ Array.prototype.push</span><span class="token keyword">const</span> t2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>t2<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; '2': 4, length: 3 &#125;</span><span class="token comment">// unCurrying ç®€åŒ–äº†è°ƒç”¨</span><span class="token keyword">const</span> t3 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token function">push</span><span class="token punctuation">(</span>t3<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>t3<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>èŠ‚æµ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> interval <span class="token operator">=</span> <span class="token number">500</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>    first <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>first<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é¦–æ¬¡ä¸å¡</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// åœ¨ interval å†…è¿˜æœ‰å…¶ä»–å‡½æ•°åœ¨æ‰§è¡Œ</span>    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>      timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> interval<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>é˜²æŠ– <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> wait</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">,</span>      args <span class="token operator">=</span> arguments<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>      timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// test</span><span class="token keyword">var</span> debounceRun <span class="token operator">=</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> debounceRun<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>è£…é¥°å™¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">before</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">self</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">after</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">self</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> res<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">f1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">f2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> f <span class="token operator">=</span> f1<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>f2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span>f2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2 1 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul>]]></content>
    
    
    <summary type="html">æŸ¯é‡ŒåŒ–, åæŸ¯é‡ŒåŒ– ... å†å’ŒåŸå‹é“¾ç»“åˆèµ·æ¥~</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="JS" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/JS/"/>
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="JavaScript" scheme="https://blog.liukairui.me/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€äº›JavaScriptè®¾è®¡æ¨¡å¼</title>
    <link href="https://blog.liukairui.me/article/%E4%B8%80%E4%BA%9BJavaScript%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    <id>https://blog.liukairui.me/article/%E4%B8%80%E4%BA%9BJavaScript%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</id>
    <published>2022-10-25T16:00:00.000Z</published>
    <updated>2022-10-25T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>è®¾è®¡æ¨¡å¼: å¯¹ç‰¹å®šé—®é¢˜ç®€å•ä¸”ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆ.</p><p>è®¾è®¡æ¨¡å¼çš„åº”ç”¨åœºæ™¯å¹¶ä¸æ˜¯ç›¸äº’å¯¹ç«‹çš„,åŒä¸€ä¸ªé—®é¢˜è¿ç”¨ä¸åŒçš„è®¾è®¡æ¨¡å¼è§£å†³æ—¶ä»£ç ä¸Šå¯èƒ½æœ‰è¾ƒå¤§çš„é‡å¤,æˆ‘ä»¬åº”è¯¥å…³æ³¨çš„æ˜¯æŸä¸ªæ¨¡å¼å¯ä»¥åº”ç”¨äºä»€ä¹ˆåœºæ™¯, è§£å†³ä»€ä¹ˆé—®é¢˜.</p><p>è®¾è®¡æ¨¡å¼å¹¶ä¸ä¸€å®šéœ€è¦æ‰‹åŠ¨å®ç°, å¾ˆå¤šè¯­è¨€è‡ªå¸¦äº†ä¸€äº›è®¾è®¡æ¨¡å¼å®ç°çš„ç‰¹æ€§.å¯ä»¥è¯´å­¦ä¹ è®¾è®¡æ¨¡å¼å®é™…ä¸Šä½“ç°äº†ç¼–ç¨‹è¯­è¨€åœ¨æŸäº›æ–¹å‘çš„è®¾è®¡ç¼ºé™·ä¸ä¸è¶³</p><h2 id="è®¾è®¡æ¨¡å¼ä¹‹äº-javascript">è®¾è®¡æ¨¡å¼ä¹‹äº JavaScript</h2><ul><li>JavaScript æ˜¯åŠ¨æ€ç±»å‹è¯­è¨€,æˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨æŸä¸ªå¯¹è±¡ä¸Šçš„æ–¹æ³•ä¸å±æ€§è€Œä¸éœ€è¦æå‰æ£€æµ‹å¯¹è±¡çš„ç±»å‹.</li><li>JavaScript çš„ç±»å‹æ˜¯é¸­å­ç±»å‹,å³ä¸å…³æ³¨å¯¹è±¡æ˜¯ä¸æ˜¯æŸä¸ªç±»å‹çš„(IS-A)è€Œå…³æ³¨å¯¹è±¡æœ‰æ²¡æœ‰æŸäº›ç‰¹å¾(HAS-A)</li></ul><h3 id="å¤šæ€">å¤šæ€</h3><p>JavaScript é¸­å­ç±»å‹æ„å‘³ç€æ— éœ€å‘ä¸Šè½¬å‹å³å¯ç›´æ¥å®ç°å¤šæ€,æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°å®ç°ä¸Šå®ç°å¤šæ€, ä¹Ÿå¯ä»¥åœ¨ä¼ å…¥å¯¹è±¡ä¸Šå®ç°å¤šæ€</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// åœ¨å‡½æ•°å®ç°ä¸Šå®ç°å¤šæ€</span><span class="token keyword">function</span> <span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token parameter">bar</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>bar<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'duck'</span><span class="token punctuation">)</span><span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'GaGaGa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>bar<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'chicken'</span><span class="token punctuation">)</span><span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'GuGuGu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">&#125;</span><span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Duck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// GaGaGa</span><span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Chicken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// GuGuGu</span><span class="token comment">// åœ¨ä¼ å…¥å¯¹è±¡ä¸Šå®ç°å¤šæ€</span><span class="token keyword">function</span> <span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token parameter">bar</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> bar<span class="token punctuation">.</span>sound <span class="token operator">&amp;&amp;</span> bar<span class="token punctuation">.</span><span class="token function">sound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Duck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// GaGaGa</span><span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Chicken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// GuGuGu</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å¤šæ€èƒŒåçš„æ€æƒ³æ˜¯å°† "åšä»€ä¹ˆ" ä¸ "è°å»åš, å¦‚ä½•åš"åˆ†å¼€</strong>, æ˜¾ç„¶ç¬¬äºŒä»½ä»£ç æ›´ä¼˜é›…, æ›´æœ‰å¼¹æ€§.</p><p>åœ¨å®ç°å¤šæ€æ—¶æˆ‘ä»¬ä¹Ÿè¦æ³¨æ„å¦‚ä½•å°† <strong>"åšä»€ä¹ˆ"(ä¸å˜çš„,<code>makeSound</code>)</strong> ä¸ <strong>"è°å»åš, å¦‚ä½•åš"(å˜åŒ–çš„,åŠ¨ç‰©å‘å‡ºä»€ä¹ˆ)</strong> ä¸¤è€…åˆ†å¼€</p><h3 id="å°è£…">å°è£…</h3><p>å¯ä»¥å€ŸåŠ©ä½œç”¨åŸŸéšè—ç§æœ‰å˜é‡</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Chicken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> language <span class="token operator">=</span> <span class="token string">'GuGuGu'</span><span class="token punctuation">;</span> <span class="token comment">// ç§æœ‰</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">sound</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>language<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…¬æœ‰</span><span class="token punctuation">&#125;</span><span class="token keyword">new</span> <span class="token class-name">Chicken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> duck <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> language <span class="token operator">=</span> <span class="token string">'GaGaGa'</span><span class="token punctuation">;</span> <span class="token comment">// ç§æœ‰</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token function-variable function">sound</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>language<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>duck<span class="token punctuation">.</span><span class="token function">sound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åŸå‹æ¨¡å¼">åŸå‹æ¨¡å¼</h2><p>JavaScript é€‰æ‹©äº†åŸºäºåŸå‹çš„é¢å‘å¯¹è±¡ç³»ç»Ÿ, JavaScript å¹¶æ²¡æœ‰ç±»çš„æ¦‚å¿µ.åœ¨åˆ›å»ºå¯¹è±¡æ—¶, JavaScript ä¸ä¼šæ‰¾å¯¹è±¡å±äºä»€ä¹ˆç±», è€Œæ˜¯ä¼šå¯»æ‰¾å¯¹è±¡å¯¹åº”çš„åŸå‹,ç„¶åå…‹éš†è¿™ä¸ªåŸå‹å¯¹è±¡å¾—åˆ°ç›®æ ‡å¯¹è±¡.</p><p>å¯ä»¥è¿™æ ·å¯¹æ¯”, å‡è®¾æˆ‘ä»¬éœ€è¦åˆ¶é€ ä¸€æ”¯çº¢è‰²çš„ç¬”</p><ul><li>åŸºäºç±»çš„é¢å‘å¯¹è±¡ç³»ç»Ÿ: æ‰¾åˆ° <code>Pen</code> ç±»å‹, ä¸ºæ„é€ å‡½æ•°ä¼ å…¥<code>color = 'red'</code>, <strong>æ„é€ </strong>å¯¹è±¡.(ç±»æ›´åƒæ˜¯ä¸€ä¸ªæ¨¡å­, å¯¹è±¡å°±æ˜¯è¿™ä¸ªæ¨¡å­æµ‡é“¸å‡ºæ¥çš„é“¸ä»¶)</li><li>åŸºäºåŸå‹çš„é¢å‘å¯¹è±¡ç³»ç»Ÿ: æ‰¾åˆ° <code>Pen</code> å¯¹åº”çš„åŸå‹å¯¹è±¡,<strong>å…‹éš†</strong>è¿™ä¸ªå¯¹è±¡, å¾—åˆ°ä¸€æ ¹ç¬”, å°†é¢œè‰²æ”¹ä¸ºçº¢è‰².(åŸå‹å¯¹è±¡å°±åƒä¸€ä¸ªæ²¡æœ‰åˆ†åŒ–çš„ç»†èƒ (åŸºç¡€çš„, é»˜è®¤çš„å¯¹è±¡),åˆ›å»ºå¯¹è±¡å°±æ˜¯è®©ç»†èƒåˆ†è£‚ä¸€æ¬¡, åˆ†è£‚å‡ºçš„ç»†èƒå¯èƒ½ä¸ç¬¦åˆè¦æ±‚,æˆ‘ä»¬å¯ä»¥è®©æ–°ç»†èƒç»§ç»­åˆ†åŒ–, ä½¿å¾—å…¶ç¬¦åˆè¦æ±‚)</li></ul><p>JavaScript åˆ©ç”¨åŸå‹é“¾å®ç°äº†æ–¹æ³•çš„ç»§æ‰¿ä¸å§”æ‰˜</p><h3 id="javascript-åˆ›å»ºå¯¹è±¡çš„åŸç†">JavaScript åˆ›å»ºå¯¹è±¡çš„åŸç†</h3><p>JavaScript ä¸­çš„å‡½æ•°æ—¢å¯ä»¥å½“ä½œå‡½æ•°ä¹Ÿå¯ä»¥å½“ä½œæ„é€ å™¨ä½¿ç”¨, é€šè¿‡<code>new</code> åˆ›å»ºå¯¹è±¡æ—¶, å‡½æ•°ä¼šä½œä¸ºæ„é€ å™¨å‚ä¸æ„é€ .å¦‚æœæ„é€ å™¨è¿”å›çš„å¯¹è±¡, é‚£ä¹ˆè¯¥å¯¹è±¡ä¼šä½œä¸º <code>new</code>çš„ç»“æœå–ä»£å…‹éš†çš„å¯¹è±¡</p><p>JavaScript ä¼šå…ˆå…‹éš†æ„é€ å™¨å¯¹åº”çš„åŸå‹å¯¹è±¡(ç»‘å®š <code>__proto__</code>),ç„¶åå¯¹å¯¹è±¡æ‰§è¡Œæ„é€ å™¨å‡½æ•°,æœ€åæ£€æŸ¥æ„é€ å™¨å‡½æ•°çš„è¿”å›å€¼å†³å®šè¿”å›å“ªä¸ªå¯¹è±¡ä½œä¸ºæ„é€ ç»“æœ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">newOperator</span><span class="token punctuation">(</span><span class="token parameter">ctor<span class="token punctuation">,</span> <span class="token operator">...</span>params</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// æ ¡éªŒæ„é€ å‡½æ•°</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> ctor <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> ctor <span class="token operator">+</span> <span class="token string">'is not a constructor'</span><span class="token punctuation">;</span>  <span class="token comment">// è®¾ç½® new.target</span>  newOperator<span class="token punctuation">.</span>target <span class="token operator">=</span> ctor<span class="token punctuation">;</span>  <span class="token comment">// å…‹éš†åŸå‹</span>  <span class="token keyword">var</span> rtn_obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>ctor<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¼ å…¥å‚æ•°ã€ç»‘å®šthisã€è·å–æ„é€ å‡½æ•°è¿”å›çš„ç»“æœ</span>  <span class="token keyword">var</span> instance <span class="token operator">=</span> <span class="token function">ctor</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>rtn_obj<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// åˆ¤æ–­æ„é€ å‡½æ•°è¿”å›çš„ç±»å‹</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>    <span class="token punctuation">(</span><span class="token keyword">typeof</span> instance <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> instance <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span>    <span class="token keyword">typeof</span> instance <span class="token operator">===</span> <span class="token string">'function'</span>  <span class="token punctuation">)</span>    <span class="token keyword">return</span> instance<span class="token punctuation">;</span>  <span class="token keyword">return</span> rtn_obj<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å•ä¾‹æ¨¡å¼">å•ä¾‹æ¨¡å¼</h2><blockquote><p>ä¿è¯ç±»åªæœ‰ä¸€ä¸ªå®ä¾‹, è¿™ä¸ªå®ä¾‹å…¨å±€å¯è§</p></blockquote><p>åœ¨ JavaScript ä¸­å®ç°å•ä¾‹çš„ç®€å•æ–¹æ³•å°±æ˜¯å°†å¯¹è±¡é™„ç€åœ¨<code>global</code>, ä½†æ˜¯è¿™ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸ.è™½ç„¶å¯ä»¥é‡‡ç”¨è¯¸å¦‚å‘½åç©ºé—´çš„æ–¹æ³•è§„é¿æ±¡æŸ“é—®é¢˜, ä½†æ˜¯è¿™ç§å•ä¾‹æ¨¡å¼è¿‡äºç®€æ˜“</p><h3 id="javascript-çš„é€šç”¨æƒ°æ€§å•ä¾‹">JavaScript çš„é€šç”¨æƒ°æ€§å•ä¾‹</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">getSingleFn</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> instance<span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> instance <span class="token operator">||</span> <span class="token punctuation">(</span>instance <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åªæœ‰è°ƒç”¨æ—¶æ‰æ‰§è¡Œå‡½æ•°</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯• <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">getData <span class="token operator">=</span> <span class="token function">getSingleFn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="å…¶ä»–åº”ç”¨">å…¶ä»–åº”ç”¨</h3><p>æƒ°æ€§å•ä¾‹ä¸ä»…ä¿è¯äº†å…¨å±€å”¯ä¸€, è¿˜ä¿è¯äº†ä¼ å…¥å‡½æ•°åªè¿è¡Œä¸€æ¬¡, å¯ä»¥å®ç°ç±»ä¼¼<code>once</code> åŠŸèƒ½</p><h2 id="ç­–ç•¥æ¨¡å¼">ç­–ç•¥æ¨¡å¼</h2><blockquote><p>å½“å¾…è§£å†³çš„é—®é¢˜éœ€è¦é€šè¿‡å¤§é‡ "å¯æ›¿ä»£" çš„ "ç®—æ³•"å®ç°æ—¶å¯ä»¥è€ƒè™‘ç­–ç•¥æ¨¡å¼</p></blockquote><h3 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</h3><p>å‡è®¾æŸä¸ªæ’å€¼å‡½æ•° <code>lerp(time, st, ed, during, method)</code>æä¾›äº†å¾ˆå¤šæ’å€¼é€‰é¡¹ (line / ease-in / ease-out...)å¦‚æœè¦åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å®ç°æ‰€æœ‰åŠŸèƒ½, é‚£å‡½æ•°å°±å˜ä¸ºäº†</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">lerp</span><span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> st<span class="token punctuation">,</span> ed<span class="token punctuation">,</span> during<span class="token punctuation">,</span> method</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'line'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token comment">/* ... */</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'ease-in'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token comment">/* ... */</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'ease-out'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token comment">/* ... */</span><span class="token punctuation">;</span>  <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·çš„å‡½æ•°ç¼ºä¹å¼¹æ€§ä¸”è¿åäº†å¼€é—­åŸåˆ™: å½“æˆ‘ä»¬éœ€è¦æ–°å¢ä¸€ä¸ªæ’å€¼æ¨¡å¼æ—¶,æˆ‘ä»¬éœ€è¦å†å¢åŠ ä¸€ä¸ª <code>if-else</code></p><p>å¯ä»¥å‘ç°, è¿™ä¸ªå‡½æ•°çš„ä»£ç ä¸­æ¶‰åŠäº†<strong>å¾ˆå¤šå¹³è¡Œçš„<code>if-else</code>,æ¯ä¸ªåˆ†æ”¯å†…éƒ¨çš„ç®—æ³•å¾ˆç±»ä¼¼ä¸”ç›®æ ‡ç›¸åŒ(å¯æ›¿ä»£)</strong> å¯ä»¥è€ƒè™‘ç­–ç•¥æ¨¡å¼</p><h3 id="é™æ€ç±»å‹çš„ç­–ç•¥æ¨¡å¼">é™æ€ç±»å‹çš„ç­–ç•¥æ¨¡å¼</h3><p>å®šä¹‰ä¸€ä¸ªç­–ç•¥ç±»ä¸ç¯å¢ƒç±» (Context), å°†æ¯ä¸ªç®—æ³•å°è£…ä¸ºä¸€ä¸ªç­–ç•¥ç±»,å°†æ•°æ®é…ç½®åˆ°ç¯å¢ƒç±», åœ¨éœ€è¦è®¡ç®—æ—¶è°ƒç”¨ç¯å¢ƒç±»è¯·æ±‚é…ç½®æ—¶æŒ‡å®šçš„ç­–ç•¥ç±»</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ç­–ç•¥ç±»</span><span class="token keyword">class</span> <span class="token class-name">LineLerp</span> <span class="token punctuation">&#123;</span>  <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> st<span class="token punctuation">,</span> ed<span class="token punctuation">,</span> during</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/* ... */</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">EaseinLerp</span> <span class="token punctuation">&#123;</span>  <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> st<span class="token punctuation">,</span> ed<span class="token punctuation">,</span> during</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/* ... */</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">EaseoutLerp</span> <span class="token punctuation">&#123;</span>  <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> st<span class="token punctuation">,</span> ed<span class="token punctuation">,</span> during</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/* ... */</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// ç¯å¢ƒç±»</span><span class="token keyword">class</span> <span class="token class-name">Lerp</span> <span class="token punctuation">&#123;</span>  <span class="token function">setEnvs</span><span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> st<span class="token punctuation">,</span> ed<span class="token punctuation">,</span> during<span class="token punctuation">,</span> method</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> time<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>st <span class="token operator">=</span> st<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>ed <span class="token operator">=</span> ed<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>during <span class="token operator">=</span> during<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>method <span class="token operator">=</span> method<span class="token punctuation">;</span> <span class="token comment">// ç­–ç•¥ç±», è¿™é‡Œéœ€è¦å‘ä¸Šè½¬å‹ä¸€ä¸‹</span>  <span class="token punctuation">&#125;</span>  <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>method<span class="token punctuation">.</span><span class="token function">calculate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>time<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>st<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ed<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>during<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç¯å¢ƒç±»è°ƒç”¨ç­–ç•¥ç±»</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// æµ‹è¯•</span><span class="token keyword">const</span> lerp1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Lerp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºç¯å¢ƒç±»</span>lerp1<span class="token punctuation">.</span><span class="token function">setEnvs</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LineLerp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é…ç½®ç¯å¢ƒç±»</span>lerp1<span class="token punctuation">.</span><span class="token function">calculate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è®¡ç®—</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="javascript-çš„ç­–ç•¥æ¨¡å¼">JavaScript çš„ç­–ç•¥æ¨¡å¼</h3><p>å¯ä»¥å®šä¹‰ä¸€ä¸ªå¯¹è±¡å­˜å‚¨æ‰€æœ‰ç­–ç•¥</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ç­–ç•¥ç±»</span><span class="token keyword">const</span> lerps <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function-variable function">line</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> st<span class="token punctuation">,</span> ed<span class="token punctuation">,</span> during</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token comment">/* ... */</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function-variable function">easein</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> st<span class="token punctuation">,</span> ed<span class="token punctuation">,</span> during</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token comment">/* ... */</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function-variable function">easeout</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> st<span class="token punctuation">,</span> ed<span class="token punctuation">,</span> during</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token comment">/* ... */</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// ç¯å¢ƒç±»</span><span class="token keyword">class</span> <span class="token class-name">Lerp</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> st<span class="token punctuation">,</span> ed<span class="token punctuation">,</span> during<span class="token punctuation">,</span> method</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> time<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>st <span class="token operator">=</span> st<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>ed <span class="token operator">=</span> ed<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>during <span class="token operator">=</span> during<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>method <span class="token operator">=</span> method<span class="token punctuation">;</span> <span class="token comment">// ç­–ç•¥</span>  <span class="token punctuation">&#125;</span>  <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> lerps<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>method<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>time<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>st<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ed<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>during<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç¯å¢ƒç±»è°ƒç”¨ç­–ç•¥ç±»</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// æµ‹è¯•</span><span class="token keyword">const</span> lerp1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Lerp</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'line'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºç¯å¢ƒç±»</span>lerp1<span class="token punctuation">.</span><span class="token function">calculate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è®¡ç®—</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å…¶ä»–åº”ç”¨åœºæ™¯">å…¶ä»–åº”ç”¨åœºæ™¯</h3><p>å®é™…ä¸Šåªè¦æˆ‘ä»¬çš„<strong>ç®—æ³•ä¸šåŠ¡ç›®æ ‡ä¸€è‡´,å…·æœ‰å¯æ›¿ä»£æ€§</strong>å°±å¯ä»¥åˆ©ç”¨ç­–ç•¥æ¨¡å¼</p><p>ä¾‹å¦‚: è¡¨å•éªŒè¯</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// å®šä¹‰ç­–ç•¥</span><span class="token keyword">const</span> strategies <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">isNotEmpty</span><span class="token operator">:</span> <span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span> <span class="token operator">=></span> value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">''</span> <span class="token operator">&amp;&amp;</span> msg<span class="token punctuation">,</span>  <span class="token literal-property property">minLength</span><span class="token operator">:</span> <span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> minLen<span class="token punctuation">,</span> msg<span class="token punctuation">)</span> <span class="token operator">=></span> value<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> minLen <span class="token operator">&amp;&amp;</span> msg<span class="token punctuation">,</span>  <span class="token literal-property property">isMobile</span><span class="token operator">:</span> <span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">!</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^1\d&#123;10&#125;$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> msg<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// å®šä¹‰ç¯å¢ƒç±»</span><span class="token keyword">class</span> <span class="token class-name">Validator</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> rules</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// æ·»åŠ ç­–ç•¥, rule = ç­–ç•¥:å‚æ•°...</span>    rules<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> strategy<span class="token punctuation">,</span> errorMsg <span class="token punctuation">&#125;</span> <span class="token operator">=</span> d<span class="token punctuation">;</span>      <span class="token keyword">const</span> <span class="token punctuation">[</span>rule<span class="token punctuation">,</span> <span class="token operator">...</span>params<span class="token punctuation">]</span> <span class="token operator">=</span> strategy<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>strategies<span class="token punctuation">[</span>rule<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token operator">...</span>params<span class="token punctuation">,</span> errorMsg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">i</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">userName</span><span class="token operator">:</span> <span class="token string">'hihi'</span><span class="token punctuation">,</span>  <span class="token literal-property property">passWord</span><span class="token operator">:</span> <span class="token string">'hi'</span><span class="token punctuation">,</span>  <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token string">' '</span><span class="token punctuation">,</span>  <span class="token literal-property property">tel</span><span class="token operator">:</span> <span class="token string">'222'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> validator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Validator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>validator<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span>userName<span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">strategy</span><span class="token operator">:</span> <span class="token string">'minLength:2'</span><span class="token punctuation">,</span> <span class="token literal-property property">errorMsg</span><span class="token operator">:</span> <span class="token string">'Username >2!'</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>validator<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span>passWord<span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">strategy</span><span class="token operator">:</span> <span class="token string">'minLength:4'</span><span class="token punctuation">,</span> <span class="token literal-property property">errorMsg</span><span class="token operator">:</span> <span class="token string">'pwd >4!'</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>validator<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span>address<span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">strategy</span><span class="token operator">:</span> <span class="token string">'isNotEmpty'</span><span class="token punctuation">,</span> <span class="token literal-property property">errorMsg</span><span class="token operator">:</span> <span class="token string">'add nn!'</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>validator<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span>tel<span class="token punctuation">,</span> <span class="token punctuation">[</span>  <span class="token punctuation">&#123;</span> <span class="token literal-property property">strategy</span><span class="token operator">:</span> <span class="token string">'isNotEmpty'</span><span class="token punctuation">,</span> <span class="token literal-property property">errorMsg</span><span class="token operator">:</span> <span class="token string">'tel nn!'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span> <span class="token literal-property property">strategy</span><span class="token operator">:</span> <span class="token string">'isMobile'</span><span class="token punctuation">,</span> <span class="token literal-property property">errorMsg</span><span class="token operator">:</span> <span class="token string">'NOT A TEL!'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>validator<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä»£ç†æ¨¡å¼">ä»£ç†æ¨¡å¼</h2><blockquote><p>æä¾›ä¸€ä¸ªä»£ç”¨å“ä»¥æ§åˆ¶å¤–éƒ¨çš„è®¿é—®</p></blockquote><p>å®ç°ä»£ç†çš„åŸåˆ™</p><ul><li>é€æ˜ä»£ç†: ä»£ç† API è®¾è®¡çš„ä¸åŸ API ä¸€æ ·,å½“æˆ‘ä»¬ä¸éœ€è¦ä»£ç†çš„æ—¶å€™å¯ä»¥ç›´æ¥ç§»é™¤ä»£ç†ä»£ç è€Œä¸éœ€è¦å¤§æ”¹ API</li></ul><h3 id="ä¿æŠ¤ä»£ç†">ä¿æŠ¤ä»£ç†</h3><p>ç›¸å½“äºä¸€ä¸ªé˜²ç«å¢™, æ¯æ¬¡è§¦å‘æ—¶æœ‰é€‰æ‹©çš„æ‰§è¡Œæˆ–é˜»æ­¢è§¦å‘äº‹ä»¶</p><h3 id="è™šæ‹Ÿä»£ç†">è™šæ‹Ÿä»£ç†</h3><p>å°†æ€§èƒ½å¼€é”€å¤§çš„äº‹åŠ¡å»¶è¿Ÿåˆ°å¯ç”¨æ—¶æ‰§è¡Œ</p><ul><li><p>å›¾ç‰‡é¢„åŠ è½½ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">MyImage</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>imageNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>imageNode<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">setSrc</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>imageNode<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">setImageProxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> src<span class="token punctuation">,</span> srcLoad <span class="token operator">=</span> <span class="token string">'http://é¢„åŠ è½½å›¾ç‰‡åœ°å€'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸´æ—¶å›¾åƒå¯¹è±¡</span>  img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> target<span class="token punctuation">.</span><span class="token function">setSrc</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å½“ä¸´æ—¶å›¾åƒåŠ è½½å®Œæˆåä¸ºç›®æ ‡èµ‹å€¼</span>  img<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span> <span class="token comment">// è¦æ±‚ä¸´æ—¶å›¾åƒåŠ è½½</span>  target<span class="token punctuation">.</span><span class="token function">setSrc</span><span class="token punctuation">(</span>srcLoad<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç›®æ ‡å›¾åƒå…ˆæ”¾ loading å›¾</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> imgNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setImageProxy</span><span class="token punctuation">(</span>imgNode<span class="token punctuation">,</span> <span class="token string">'http://å¤§å›¾åœ°å€'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>åˆå¹¶è¯·æ±‚</p><p>å¯¹äºå°‘é‡å¤šæ¬¡çš„è¯·æ±‚å¯ä»¥åšè¯·æ±‚åˆå¹¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">getFetchProxy</span><span class="token punctuation">(</span><span class="token parameter">interval</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> timer<span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    cache<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>      timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>      <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span> <span class="token operator">+</span> cache<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      cache<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> interval<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> urlProxy <span class="token operator">=</span> <span class="token function">getFetchProxy</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">urlProxy</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token function">urlProxy</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æƒ°æ€§åŠ è½½</p><p>ç±»ä¼¼å•ä¾‹æ¨¡å¼çš„æƒ°æ€§åŠ è½½</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">getFetchProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span> <span class="token operator">+</span> cache<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  cache<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> urlProxy <span class="token operator">=</span> <span class="token function">getFetchProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">urlProxy</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">urlProxy</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">urlProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="ç¼“å­˜ä»£ç†">ç¼“å­˜ä»£ç†</h3><p>ç¼“å­˜è¯·æ±‚å‚æ•°å³å¯</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">getMultiProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// è®¡ç®—ä¹˜æ³•çš„ä»£ç†</span>  <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> k <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span>      cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>        k<span class="token punctuation">,</span>        args<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pre<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=></span> pre <span class="token operator">*</span> cur<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>      <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å…¶ä»–ä»£ç†">å…¶ä»–ä»£ç†</h3><ul><li>é˜²ç«å¢™ä»£ç†</li><li>è¿œç¨‹ä»£ç†: ä»£ç†å…¶ä»–å†…å­˜åŒºåŸŸä¸­çš„æ•°æ®</li><li>ä¿æŠ¤ä»£ç†: å®ç°æƒé™æ§åˆ¶</li><li>æ™ºèƒ½å¼•ç”¨ä»£ç†: åœ¨æŒ‡é’ˆåŸºç¡€ä¸Šæä¾›äº†ä¸€äº›å›è°ƒæ–¹æ³•</li><li>å†™æ—¶å¤åˆ¶ä»£ç†: æƒ°æ€§å¤åˆ¶, åªæœ‰è¦ä¿®æ”¹åŸå¯¹è±¡æ—¶æ‰èµ‹å€¼</li></ul><h2 id="è¿­ä»£å™¨æ¨¡å¼">è¿­ä»£å™¨æ¨¡å¼</h2><ul><li>å†…éƒ¨è¿­ä»£å™¨: è¿­ä»£å™¨ä½äºå‡½æ•°å†…éƒ¨, åªéœ€è¦ä¼ å…¥å¯¹æ¯ä¸ªå¯¹è±¡çš„è°ƒç”¨æ–¹æ³•</li><li>å¤–éƒ¨è¿­ä»£å™¨: éœ€è¦æ˜¾å¼æ“ä½œè¿­ä»£å™¨(<code>next</code>,<code>isDone</code>)</li></ul><h2 id="å‘å¸ƒè®¢é˜…æ¨¡å¼">å‘å¸ƒè®¢é˜…æ¨¡å¼</h2><blockquote><p>åˆç§°è§‚å¯Ÿè€…æ¨¡å¼, ç”¨äºç»´æŠ¤å¯¹è±¡ä¹‹é—´çš„<strong>ä¸€å¯¹å¤š</strong>å…³ç³»,ä¸€æ—¦å¯¹è±¡çŠ¶æ€å‘ç”Ÿæ”¹å˜, æ‰€æœ‰ä¾èµ–(è®¢é˜…)äºè¿™ä¸ªå¯¹è±¡çš„å¯¹è±¡éƒ½ä¼šå¾—åˆ°æ¶ˆæ¯</p></blockquote><p>å½“æŸä¸ªå¯¹è±¡éœ€è¦åœ¨å…¶ä»–å¯¹è±¡å‘ç”Ÿå˜åŒ–åå˜åŒ–, æœ€ç®€å•çš„å®ç°æ–¹å¼æ˜¯ RR,ä½†è¿™åŠ¿å¿…ä¼šé€ æˆç¡¬ç¼–ç ä¸å¼ºè€¦åˆ. æˆ‘ä»¬å¸Œæœ›é‡‡ç”¨ç±»ä¼¼ DOM ä¸­<code>addEventListener</code> çš„æ–¹æ³•å®ç°äº‹ä»¶æ³¨å†Œå¹¶åœ¨è§¦å‘åè‡ªåŠ¨æ‰§è¡Œ.æ¨¡ä»¿è¿™ä¸ªè¿‡ç¨‹å°±å¯ä»¥å¾—åˆ°å‘å¸ƒè®¢é˜…æ¨¡å¼ä¸è§‚å¯Ÿè€…æ¨¡å¼.</p><h3 id="javascript-çš„è§‚å¯Ÿè€…æ¨¡å¼">JavaScript çš„è§‚å¯Ÿè€…æ¨¡å¼</h3><p>è§‚å¯Ÿè€…æ¨¡å¼ä¸­å­˜åœ¨è§‚å¯Ÿè€…ä¸è¢«è§‚å¯Ÿè€…, è§‚å¯Ÿè€…å‘ç”Ÿå˜åŒ–åé€šçŸ¥è¢«è§‚å¯Ÿè€…</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//è§‚å¯Ÿè€…ç±»</span><span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token comment">//è§‚æµ‹åˆ°å˜åŒ–åçš„å¤„ç†</span>  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">ob</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ob<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Observed</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>observers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">//æ·»åŠ è§‚å¯Ÿè€…</span>  <span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token parameter">observer</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">//åˆ é™¤è§‚å¯Ÿè€…</span>  <span class="token function">removeObserver</span><span class="token punctuation">(</span><span class="token parameter">observer</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>observers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token operator">=></span> o <span class="token operator">!=</span> observer<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">//é€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…</span>  <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">observer</span><span class="token punctuation">)</span> <span class="token operator">=></span> observer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Teacher</span> <span class="token keyword">extends</span> <span class="token class-name">Observer</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">st</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">æäº¤äº†</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">ä½œä¸š</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token keyword">extends</span> <span class="token class-name">Observed</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">submitHomeWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> students <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> teacher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Teacher</span><span class="token punctuation">(</span><span class="token string">'t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>teacher<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>students<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2æäº¤äº†tä½œä¸š</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="javascript-å‘å¸ƒè®¢é˜…æ¨¡å¼">JavaScript å‘å¸ƒè®¢é˜…æ¨¡å¼</h3><p>åœ¨è®¢é˜…è€…æ¨¡å¼ä¸­, å½“è¢«è§‚å¯Ÿè€…å‘ç”Ÿå˜åŒ–æ—¶è¢«è§‚å¯Ÿè€…ä¼šç›´æ¥é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€….åœ¨æ¶ˆæ¯è®¢é˜…æ¨¡å¼ä¸­, æ¶ˆæ¯å‘å¸ƒè€…(è¢«è§‚å¯Ÿè€…)å¯ä»¥è‡ªå®šä¹‰å‘å¸ƒæ¶ˆæ¯ç±»å‹,åªæœ‰è®¢é˜…äº†æ­¤ç±»æ¶ˆæ¯çš„äººæ‰ä¼šæ”¶åˆ°æ¶ˆæ¯.</p><h4 id="éå…¨å±€æ¶ˆæ¯ä¸­å¿ƒ">éå…¨å±€æ¶ˆæ¯ä¸­å¿ƒ</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">installEvent</span><span class="token punctuation">(</span><span class="token parameter">sender</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  sender<span class="token punctuation">.</span>eventType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  sender<span class="token punctuation">.</span><span class="token function-variable function">listen</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sender<span class="token punctuation">.</span>eventType<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> sender<span class="token punctuation">.</span>eventType<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸èƒ½ç”¨ set ä¸‡ä¸€æœ‰é‡å¤å°±å¯„äº†</span>    <span class="token keyword">const</span> fns <span class="token operator">=</span> sender<span class="token punctuation">.</span>eventType<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>    fns<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  sender<span class="token punctuation">.</span><span class="token function-variable function">trigger</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sender<span class="token punctuation">.</span>eventType<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> fns <span class="token operator">=</span> sender<span class="token punctuation">.</span>eventType<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>    fns<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">d</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  sender<span class="token punctuation">.</span><span class="token function-variable function">cancel</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sender<span class="token punctuation">.</span>eventType<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> fns <span class="token operator">=</span> sender<span class="token punctuation">.</span>eventType<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> idx <span class="token operator">=</span> fns<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d <span class="token operator">===</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">~</span>idx <span class="token operator">&amp;&amp;</span> fns<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> sender <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token function">installEvent</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ev1 #1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sender<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'ev1'</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>sender<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'ev1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ev1 #2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sender<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'ev2'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ev2 #1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sender<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'ev1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ev1 #1 ev1 #2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'---'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sender<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'ev2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ev2 #1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'---'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sender<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token string">'ev1'</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>sender<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'ev1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ev1 #2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="æœ‰æ¶ˆæ¯ç¼“å­˜çš„å…¨å±€æ¶ˆæ¯ä¸­å¿ƒ">æœ‰æ¶ˆæ¯ç¼“å­˜çš„å…¨å±€æ¶ˆæ¯ä¸­å¿ƒ</h4><p>æˆ‘ä»¬å‘ç°è®¢é˜…è€…è€…è¦åœ¨æ³¨å†Œäº‹ä»¶æ—¶éœ€è¦æ˜¾å¼çš„æŒ‡å®šå‘å¸ƒè€…,è¿™ä¹Ÿé€ æˆäº†ä¸€å®šç¨‹åº¦çš„è€¦åˆ, æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå…¨å±€æ¶ˆæ¯ä¸­å¿ƒ,è®¢é˜…è€…å‘æ¶ˆæ¯ä¸­å¿ƒè¯·æ±‚è®¢é˜…æ¶ˆæ¯, æ¶ˆæ¯å‘å¸ƒè€…å‘å¸ƒæ¶ˆæ¯åˆ°æ¶ˆæ¯ä¸­å¿ƒ,ç”±æ¶ˆæ¯ä¸­å¿ƒé€šçŸ¥è®¢é˜…è€….</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> Event <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> eventType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">listen</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>eventType<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> eventType<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸èƒ½ç”¨ set ä¸‡ä¸€æœ‰é‡å¤å°±å¯„äº†</span>    <span class="token keyword">const</span> fns <span class="token operator">=</span> eventType<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>    fns<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">retrieveCache</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>eventType<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">addCache</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> fns <span class="token operator">=</span> eventType<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fns<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">addCache</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>    fns<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">d</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>eventType<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> fns <span class="token operator">=</span> eventType<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> idx <span class="token operator">=</span> fns<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d <span class="token operator">===</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">~</span>idx <span class="token operator">&amp;&amp;</span> fns<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">addCache</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cachedArgs <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>    cachedArgs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">retrieveCache</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>    cachedArgs <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>    cachedArgs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">trigger</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token operator">...</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> listen<span class="token punctuation">,</span> trigger<span class="token punctuation">,</span> cancel <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> sender <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ev1 #1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Event<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'ev1'</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>Event<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'ev1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ev1 #2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Event<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'ev2'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ev2 #1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Event<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'ev1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ev1 #1 ev1 #2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'---'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Event<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'ev2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ev2 #1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'---'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Event<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token string">'ev1'</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>Event<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'ev1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ev1 #2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'---'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Event<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'ev3'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Event<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'ev3'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ev3 #1, ans = '</span> <span class="token operator">+</span> args<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pre<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=></span> pre <span class="token operator">+</span> cur<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ev3 #1, ans = 10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åº”ç”¨åœºæ™¯-1">åº”ç”¨åœºæ™¯</h3><p>æŸä¸ªå¯¹è±¡æ”¹å˜, ä½¿ä¾èµ–äºå®ƒçš„å¤šä¸ªå¯¹è±¡å¾—åˆ°é€šçŸ¥, ä¸”å¸Œæœ›è§£è€¦ä¸¤è€….å‘å¸ƒ-è®¢é˜…æ¨¡å¼é€‚åˆæ›´å¤æ‚çš„åœºæ™¯(å‘å¸ƒè€…çš„æŸæ¬¡æ›´æ–°åªæƒ³é€šçŸ¥å®ƒçš„éƒ¨åˆ†è®¢é˜…è€…)</p><h2 id="å‘½ä»¤æ¨¡å¼">å‘½ä»¤æ¨¡å¼</h2><blockquote><p>å½“æˆ‘ä»¬ä¸æ¸…æ¥šè¯·æ±‚çš„æ¥å—è€…æ˜¯è°ä¹Ÿä¸çŸ¥é“è¯·æ±‚çš„å…·ä½“æ“ä½œæ˜¯ä»€ä¹ˆ.æˆ‘ä»¬å¯ä»¥å°†å‘½ä»¤å°è£…ä¸ºå¯¹è±¡, è®©å‘½ä»¤å¯¹è±¡åœ¨ç¨‹åºä¸­è¢«å››å¤„ä¼ é€’</p></blockquote><p>å‘½ä»¤æ¨¡å¼çš„ä¸‰ä¸ªç»„æˆéƒ¨åˆ†: å‘èµ·è€…(ä¸çŸ¥é“è‡ªå·±è§¦å‘çš„å‘½ä»¤æœ‰å•¥ç”¨,ä¹Ÿä¸çŸ¥é“è°æœ€ç»ˆæ¥æ”¶å‘½ä»¤) å‘½ä»¤(ä¸€ä¸ªè¢«æ‹¿æ¥æ‹¿å»çš„å¯¹è±¡)ä¼ é€’/æ¥æ”¶è€…(åªç®¡ä¼ é€’/æ¥æ”¶å‘½ä»¤)</p><p>å¯ä»¥ç±»æ¯”é¤å…ç‚¹é¤:</p><ul><li>å‘½ä»¤: ä¸€ä¸ªåŒ…å«äº†å¦‚ä½•åšèœçš„æŒ‡ä»¤å¯¹è±¡</li><li>å‘èµ·è€…: å®¢æˆ·, å®¢æˆ·å‘èµ·åšé¥­çš„å‘½ä»¤,ä½†æ˜¯å®¢æˆ·ä¹Ÿä¸çŸ¥é“åšé¥­çš„å‘½ä»¤æœ€ç»ˆæ¥å—è€…æ˜¯è°, ä»–åªæ˜¯å‘å‡ºäº†ä¸€ä¸ªåšèœå‘½ä»¤</li><li>ä¼ é€’è€…: æœåŠ¡å‘˜, æœåŠ¡å‘˜å°†å®¢æˆ·å‘å‡ºçš„åšèœæŒ‡ä»¤ä¼ é€’ç»™å¤§å¨</li><li>æ‰§è¡Œè€…: å¤§å¨, å¤§å¨åªç®¡æ‰§è¡Œå‘½ä»¤, ä»–ä¹Ÿä¸çŸ¥é“æ˜¯è°ç‚¹çš„é¤,ä»–åªè´Ÿè´£æ‰§è¡Œ</li></ul><p>å¯ä»¥çœ‹åˆ°, åœ¨è¿™é‡Œæˆ‘ä»¬å®Œå…¨åšåˆ°äº†å‘èµ·è€…, å‘½ä»¤, æ¥å—è€…çš„è§£è€¦</p><h3 id="é™æ€ç±»å‹è¯­è¨€çš„å‘½ä»¤æ¨¡å¼">é™æ€ç±»å‹è¯­è¨€çš„å‘½ä»¤æ¨¡å¼</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ä¸ºå‘èµ·è€…ç»‘å®šå‘½ä»¤çš„æ–¹æ³•</span><span class="token keyword">function</span> <span class="token function">setCommandDOM</span><span class="token punctuation">(</span><span class="token parameter">dom<span class="token punctuation">,</span> command</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  dom<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> command<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// å®é™…åŠŸèƒ½çš„å®ç°</span><span class="token keyword">const</span> showTimes <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function-variable function">showYear</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function-variable function">showMonth</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token function-variable function">showDay</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// å‘½ä»¤ç±»</span><span class="token keyword">function</span> <span class="token function">ShowCurrentYearCommand</span><span class="token punctuation">(</span><span class="token parameter">receiver</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>receiver <span class="token operator">=</span> receiver<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token class-name">ShowCurrentYearCommand</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">execute</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>receiver<span class="token punctuation">.</span>innerText <span class="token operator">=</span> showTimes<span class="token punctuation">.</span><span class="token function">showYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">ShowCurrentAllCommand</span><span class="token punctuation">(</span><span class="token parameter">receiver</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>receiver <span class="token operator">=</span> receiver<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token class-name">ShowCurrentAllCommand</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">execute</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>receiver<span class="token punctuation">.</span>innerText <span class="token operator">=</span>    <span class="token string">''</span> <span class="token operator">+</span> showTimes<span class="token punctuation">.</span><span class="token function">showYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> showTimes<span class="token punctuation">.</span><span class="token function">showMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> showTimes<span class="token punctuation">.</span><span class="token function">showDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">ClearAllCommand</span><span class="token punctuation">(</span><span class="token parameter">receiver</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>receiver <span class="token operator">=</span> receiver<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token class-name">ClearAllCommand</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">execute</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>receiver<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// æ„é€ å‘½ä»¤(å‘½ä»¤ -> æ¥æ”¶è€…, æ¥æ”¶è€…ä¸çŸ¥é“æ˜¯è°å‘èµ·çš„)</span><span class="token keyword">const</span> showCurrentYearCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShowCurrentYearCommand</span><span class="token punctuation">(</span>  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> showCurrentAllCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShowCurrentAllCommand</span><span class="token punctuation">(</span>  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> clearAllCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClearAllCommand</span><span class="token punctuation">(</span>  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å‘èµ·è€…å‘èµ·å‘½ä»¤(å‘èµ·è€… -> å‘½ä»¤, å‘èµ·è€…ä¹Ÿä¸çŸ¥é“è¿™å‘½ä»¤æ˜¯å¹²å•¥çš„)</span><span class="token function">setCommandDOM</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> showCurrentYearCommand<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setCommandDOM</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> showCurrentAllCommand<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setCommandDOM</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn3'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> clearAllCommand<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å®ç°å‘½ä»¤åŠŸèƒ½</li><li>å®ç°å‘½ä»¤ç±»ä¿å­˜ context å®ç° execute</li><li>æ„é€ å®ä¾‹å¯¹è±¡, å®Œæˆ å‘½ä»¤ -&gt; æ‰§è¡Œè€…çš„ç»‘å®š</li><li>å°†å‘½ä»¤ç»‘å®šç»™å‘èµ·è€…</li></ul><p>æ’¤é”€æ‰§è¡Œ: å°†æŒ‡ä»¤è°ƒç”¨ä¿å­˜åˆ°æ ˆ, éœ€è¦æ’¤é”€æ—¶å€™å¼¹æŒ‡ä»¤å³å¯.åŒæ—¶åœ¨æŒ‡ä»¤ä¸Šå®šä¹‰ undo æ–¹æ³•å®ç°å•æ¡æŒ‡ä»¤çš„æ’¤é”€(å› ä¸ºæ¯æ¡æŒ‡ä»¤åªéœ€è¦å®ç°execute çš„é€†, ä¸ç”¨è€ƒè™‘å…¨å±€å˜åŒ–, æ‰€ä»¥ä¸ç®—éº»çƒ¦), ä¾‹å¦‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">ClearAllCommand</span><span class="token punctuation">(</span><span class="token parameter">receiver</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>receiver <span class="token operator">=</span> receiver<span class="token punctuation">;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>last <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">ClearAllCommand</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">execute</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>last <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>receiver<span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>receiver<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token class-name">ClearAllCommand</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">undo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>receiver<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>last<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®å‘½ä»¤">å®å‘½ä»¤</h3><p>å¯ä»¥å°†å¤šä¸ªå‘½ä»¤ç»„åˆèµ·æ¥å½¢æˆä¸€ä¸ªå®å‘½ä»¤,æ‰§è¡Œå®å‘½ä»¤ç­‰äºæ‰§è¡Œå®å‘½ä»¤ä¸‹çš„æ¯ä¸ªå‘½ä»¤</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">buildMacroCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> commandList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">command</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      commandList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      commandList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token punctuation">[</span><span class="token operator">...</span>commandList<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">.</span>undo <span class="token operator">&amp;&amp;</span> d<span class="token punctuation">.</span><span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å°½é‡è®©å®å‘½ä»¤å’Œæ™®é€šå‘½ä»¤ API ä¿æŒä¸€è‡´,è¿™æ ·å¯ä»¥ä¿è¯å®å‘½ä»¤å¯¹å‘èµ·è€…é€æ˜</p><h3 id="æ™ºèƒ½å‘½ä»¤ä¸å‚»ç“œå‘½ä»¤">æ™ºèƒ½å‘½ä»¤ä¸å‚»ç“œå‘½ä»¤</h3><p>å‘½ä»¤æ‰§è¡Œä¸æ‰§è¡Œè€…æ— å…³çš„ç§°ä¸ºæ™ºèƒ½å‘½ä»¤(ä¾‹å¦‚ <code>alert()</code>),å’Œæ‰§è¡Œè€…æœ‰å…³çš„(ä¾‹å¦‚ <code>receiver.innerText</code>)</p><h3 id="åº”ç”¨åœºæ™¯-2">åº”ç”¨åœºæ™¯</h3><ul><li>ä¸æ¸…æ¥šè¯·æ±‚çš„æ¥å—è€…</li><li>ä¸çŸ¥é“è¯·æ±‚çš„å…·ä½“æ“ä½œæ˜¯ä»€ä¹ˆ</li><li>å‘½ä»¤è¦è¢«å››å¤„ä¼ é€’å››å¤„ä¼ é€’</li></ul><p>å‘½ä»¤æ¨¡å¼ä¸ç­–ç•¥æ¨¡å¼åœ¨å½¢å¼ä¸Šæœ‰ç‚¹ç±»ä¼¼, ä½†æ˜¯å‘½ä»¤æ¨¡å¼çš„å‘½ä»¤ä¼ é€’æ›´åŠ çµæ´»,ä¸”å®ç°äº†å‘½ä»¤å‘èµ·è€…ä¸å‘½ä»¤çš„è§£è€¦. åœ¨ JavaScript ä¸­, å‘½ä»¤å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°,ä½†æ˜¯å‡½æ•°åœ¨ JavaScript ä¸­æ˜¯å¯ä»¥éšæ„ä¼ é€’çš„, æ‰€ä»¥ JavaScriptå¤©ç”Ÿå°±ç›´æ¥æ”¯æŒå‘½ä»¤æ¨¡å¼</p><h2 id="ç»„åˆæ¨¡å¼">ç»„åˆæ¨¡å¼</h2><p>é‡‡ç”¨å°½å¯èƒ½ç›¸åŒçš„æ¥å£å®šä¹‰å¯¹è±¡, å¹¶ä½¿å¯¹è±¡å…·æœ‰åµŒå¥—èƒ½åŠ›.è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¯¹è±¡çš„åµŒå¥—å®ç°åŠŸèƒ½çš„ç»„åˆ.</p><p>åº”ç”¨: å®å‘½ä»¤å°±é‡‡ç”¨ç»„åˆæ¨¡å¼çš„æ€æƒ³, å®å‘½ä»¤ä¸æ™®é€šå‘½ä»¤çš„ APIç›¸åŒ(<strong>å½¢å¼ä¸€è‡´</strong>), å®å‘½ä»¤å¯ä»¥åµŒå¥—å®å‘½ä»¤ä¸æ™®é€šå‘½ä»¤,ä¹Ÿå¯ä»¥é€šè¿‡ <code>execute</code>æ‰§è¡Œè‡ªå·±åŒ…å«çš„å­å‘½ä»¤(<strong>åŠŸèƒ½ä¸€è‡´</strong>).å‘½ä»¤è°ƒç”¨è€…æ— éœ€åŒºåˆ†å®å‘½ä»¤å’Œæ™®é€šå‘½ä»¤, åªéœ€è¦æ— è„‘è°ƒç”¨ <code>execute</code>å³å¯.</p><p>åº”ç”¨åœºæ™¯:ç»„åˆæ¨¡å¼å°†å¯¹è±¡ä»¥<strong>éƒ¨åˆ†-æ•´ä½“çš„æ¨¡å¼ç»„æˆæ ‘å½¢ç»“æ„</strong>,å¹¶è¦æ±‚éƒ¨åˆ†ä¸æ•´ä½“å…·æœ‰<strong>åŠŸèƒ½ä¸å½¢å¼çš„ä¸€è‡´æ€§</strong></p><p>ç‰¹æ€§:ç§°è¿™ç§æ¨¡å¼ä¸ºç»„åˆæ¨¡å¼æ˜¯å› ä¸º<strong>ä¸åŒå¯¹è±¡ä¹‹é—´å¯ä»¥æ–¹ä¾¿ç»„åˆæ‹†åˆ†å¯¹è±¡</strong>,å¿«é€Ÿå½¢æˆä¸€ä¸ªæ ‘å½¢ç»“æ„, è€Œè°ƒç”¨è€…åªéœ€è¦å…³æ³¨æ ‘æ ¹å³å¯è°ƒç”¨æ•´ä¸ªå¯¹è±¡,ä¸”ä¸éœ€è¦å…³ç³»è°ƒç”¨çš„å¯¹è±¡æ˜¯åµŒå¥—å¯¹è±¡è¿˜æ˜¯åŸºæœ¬å¯¹è±¡</p><p>æ³¨æ„: - åµŒå¥—å¯¹è±¡ä¸åŸºæœ¬å¯¹è±¡æ¥å£è®¾è®¡ä¸å¯èƒ½å®Œå…¨ä¸€è‡´,å¦‚æœç”¨æˆ·å¯¹åŸºæœ¬å¯¹è±¡è°ƒç”¨åµŒå¥—å¯¹è±¡ä¼šé€ æˆå¼•ç”¨é”™è¯¯,å¯ä»¥å°è¯•åœ¨åŸºæœ¬å¯¹è±¡ä¸Šå®šä¹‰ç›¸åŒ API å¹¶æŠ›å‡ºé”™è¯¯ -ç»„åˆæ¨¡å¼çš„å¯¹è±¡åº”è¯¥æ˜¯ä¸¥æ ¼çš„æ ‘å½¢ç»“æ„, å¦‚æœå‡ºç°ç¯,å°±æ„å‘³ç€æˆ‘ä»¬å¯èƒ½æ— æ³•æ§åˆ¶ç¯ä¸­å¯¹è±¡è°ƒç”¨æ¬¡æ•°, å¦‚æœäº§ç”Ÿäº†ç¯å¯ä»¥è€ƒè™‘é‡‡ç”¨ç­–ç•¥ /è´£ä»»é“¾æ¨¡å¼è§£å†³é—®é¢˜</p><h2 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼">æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h2><p>åœ¨æŠ½è±¡ç±»ä¸­å®šä¹‰ç®—æ³•çš„å®è§‚è¿è¡Œæ¨¡å¼ä¸å¯å¤ç”¨çš„å­ç®—æ³•,ç”±å­ç±»å®ç°å…·ä½“æ¯ä¸€æ­¥çš„ç®—æ³•</p><h3 id="é™æ€ç±»å‹çš„æ¨¡æ¿æ–¹æ³•æ¨¡å¼">é™æ€ç±»å‹çš„æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h3><p>å®ç°åˆ¶ä½œé¥®æ–™ç®—æ³•, å…¶ä¸­</p><ul><li>åˆ¶ä½œå’–å•¡: å¼€æ°´ -&gt; æ³¡å’–å•¡ç²‰ -&gt; å€’å…¥æ¯å­ -&gt; åŠ ç³–</li><li>åˆ¶ä½œå¥¶èŒ¶: å¼€æ°´ -&gt; æ³¡èŒ¶ -&gt; å€’å…¥æ¯å­ -&gt; åŠ ç‰›å¥¶</li></ul><p>å¯ä»¥æŠ½è±¡åˆ¶ä½œé¥®æ–™çš„ç®—æ³•: å¼€æ°´ -&gt; æ³¡æ°´ -&gt; å€’å…¥æ¯å­ -&gt; åŠ æ–™</p><p>å®ç°åˆ¶ä½œå¥¶èŒ¶ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">MakeDrink</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>water <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">temp</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">consist</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>cup <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// å…¬å…±ç®—æ³•æå‰å®ç°</span>  <span class="token function">boilWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>water<span class="token punctuation">.</span>temp <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// ç§æœ‰ç®—æ³•ä¸å®ç°</span>  <span class="token function">brew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'éœ€è¦å®ç°ç®—æ³•'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">pourCup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>cup <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>water<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">addCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'éœ€è¦å®ç°ç®—æ³•'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">boilWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">brew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pourCup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cup<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">MakeMilkTea</span> <span class="token keyword">extends</span> <span class="token class-name">MakeDrink</span> <span class="token punctuation">&#123;</span>  <span class="token function">brew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>water<span class="token punctuation">.</span>consist<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'tea'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">addCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>water<span class="token punctuation">.</span>consist<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'milk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> makeMilkTea <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MakeMilkTea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>makeMilkTea<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; temp: 100, consist: [ 'tea', 'milk' ] &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>æˆ‘ä»¬è¿˜å¯ä»¥åœ¨å®ç°æŠ½è±¡ç±»çš„æ—¶å€™åŠ å…¥é’©å­å‡½æ•°, å®ç°æµç¨‹æ§åˆ¶, ä¾‹å¦‚:é»˜è®¤åŠ é…æ–™, ä½†æ˜¯æ”¯æŒä½¿ç”¨é’©å­å‡½æ•°ä¼ å…¥æ˜¯å¦åŠ æ–™</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">MakeDrink</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ...</span>  <span class="token function">needCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// é»˜è®¤åŠ æ–™</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">boilWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">brew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pourCup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">needCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cup<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">MakeCoffee</span> <span class="token keyword">extends</span> <span class="token class-name">MakeDrink</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">need</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>need <span class="token operator">=</span> need<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">brew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>water<span class="token punctuation">.</span>consist<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'coffee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">addCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>water<span class="token punctuation">.</span>consist<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'sugar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">needCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>need<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> makeCoffee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MakeCoffee</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>makeCoffee<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; temp: 100, consist: [ 'coffee' ] &#125;</span><span class="token keyword">const</span> makeCoffeeWithSugar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MakeCoffee</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>makeCoffeeWithSugar<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; temp: 100, consist: [ 'coffee', 'sugar' ] &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="javascript-çš„æ¨¡æ¿æ–¹æ³•æ¨¡å¼">JavaScript çš„æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">MakeDrink</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>water <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">temp</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">consist</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>cup <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token comment">// å…ˆå°½åŠ›å»å–</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>methods <span class="token operator">=</span> params<span class="token punctuation">;</span>    <span class="token comment">// å…¬å…±ç®—æ³•å†…éƒ¨å®ç°, å¦‚æœä»¥åŠæä¾›å°±ä¸å®ç°</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">.</span>boilWater <span class="token operator">??=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>water<span class="token punctuation">.</span>temp <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token comment">// ç§æœ‰ç®—æ³•ä¸å®ç°</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">.</span>brew <span class="token operator">??=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'éœ€è¦å®ç°ç®—æ³•'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">.</span>pourCup <span class="token operator">??=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>cup <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>water<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">.</span>addCondiments <span class="token operator">??=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'éœ€è¦å®ç°ç®—æ³•'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">.</span>needCondiments <span class="token operator">??=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> k <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function">boilWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function">brew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function">pourCup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function">needCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function">addCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cup<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> makeMilkTea <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MakeDrink</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token function">brew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>water<span class="token punctuation">.</span>consist<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'tea'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">addCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>water<span class="token punctuation">.</span>consist<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'milk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>makeMilkTea<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; temp: 100, consist: [ 'tea', 'milk' ] &#125;</span><span class="token keyword">const</span> makeCoffee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MakeDrink</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token function">brew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>water<span class="token punctuation">.</span>consist<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'coffee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">addCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>water<span class="token punctuation">.</span>consist<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'sugar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">needCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>makeCoffee<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; temp: 100, consist: [ 'coffee', 'sugar' ] &#125;</span><span class="token keyword">const</span> makeCoffeeWithSugar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MakeDrink</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token function">brew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>water<span class="token punctuation">.</span>consist<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'coffee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">addCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>water<span class="token punctuation">.</span>consist<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'sugar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>makeCoffeeWithSugar<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; temp: 100, consist: [ 'coffee', 'sugar' ] &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äº«å…ƒæ¨¡å¼">äº«å…ƒæ¨¡å¼</h2><blockquote><p>è¿ç”¨å…±äº«æŠ€æœ¯å°½å¯èƒ½çš„å¤ç”¨å¯¹è±¡</p></blockquote><p>å°†å¯¹è±¡ä¸Šçš„å±æ€§åˆ†ä¸ºå†…éƒ¨å±æ€§ä¸å¤–éƒ¨å±æ€§</p><ul><li>å†…éƒ¨å±æ€§å±äºå¯¹è±¡å†…éƒ¨, å¯ä»¥è¢«å¤–éƒ¨å…±äº«</li><li>å†…éƒ¨å±æ€§ç‹¬ç«‹äºåœºæ™¯, ä¸ä¼šéšåœºæ™¯å˜åŒ–å˜åŒ–(åœ¨å…±äº«è¿‡ç¨‹ä¸­ä¿æŒä¸å˜)</li><li>å¤–éƒ¨å±æ€§å–å†³äºåº”ç”¨åœºæ™¯, ä¸ä¼šéšåœºæ™¯å˜åŒ–è€Œå˜åŒ–</li></ul><p>å¯¹è±¡å‰¥ç¦»å¤–éƒ¨å¯¹è±¡æˆä¸ºå…±äº«å¯¹è±¡, åœ¨ä½¿ç”¨æ—¶ä¼ å…¥å¤–éƒ¨çŠ¶æ€ç»„æˆå¯¹è±¡</p><h3 id="åº”ç”¨åœºæ™¯-3">åº”ç”¨åœºæ™¯</h3><ul><li>ç›¸ä¼¼å…ƒç´ å¤šæ¬¡è°ƒç”¨</li><li>å…ƒç´ ä½“ç§¯è¾ƒå¤§, å¤šæ¬¡åˆ›å»ºä¼šé€ æˆè¾ƒå¤§å¼€é”€</li><li>å¤šæ•°çŠ¶æ€ä¸ºå¤–éƒ¨çŠ¶æ€</li><li>åŒæ—¶ä½¿ç”¨å¯¹è±¡é‡å°, å¯ä»¥ç”¨å°‘é‡å¯¹è±¡å®Œæˆå¤§å¤šæ•°åœºæ™¯</li></ul><h3 id="ä½¿ç”¨-javascript-å®ç°å¯¹è±¡æ± ">ä½¿ç”¨ JavaScript å®ç°å¯¹è±¡æ± </h3><p>äº«å…ƒæ¨¡å¼åªæ˜¯ä¸€ç§æ€æƒ³, æ²¡æœ‰å…·ä½“çš„å®ç°, å¯¹è±¡æ± æ˜¯äº«å…ƒæ¨¡å¼çš„ä¸€ç§åº”ç”¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token function-variable function">objPoolFactory</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">createObjFn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> objPool <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>objPool<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> objPool<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">return</span> <span class="token function">createObjFn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function">recover</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      objPool<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="èŒè´£é“¾æ¨¡å¼">èŒè´£é“¾æ¨¡å¼</h2><p>è¯·æ±‚è€…å‘èµ·è¯·æ±‚, å°†è¯·æ±‚ä¼ é€’ç»™ä¸­é—´äºº,ä¸­é—´äººä¸€ç›´ä¼ é€’ç›´åˆ°é‡åˆ°ä¸€ä¸ªå¯å¤„ç†è€…</p><p>å¾ˆç±»ä¼¼äºæ‹¦æˆªå™¨</p><h3 id="javascript-çš„èŒè´£é“¾æ¨¡å¼">JavaScript çš„èŒè´£é“¾æ¨¡å¼</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">processState400</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">>=</span> <span class="token number">400</span> <span class="token operator">&amp;&amp;</span> code <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error 400'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">processState500</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">>=</span> <span class="token number">500</span> <span class="token operator">&amp;&amp;</span> code <span class="token operator">&lt;</span> <span class="token number">600</span><span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server 500'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">processState200</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">>=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> code <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ok 200'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">processStateUnknown</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'unknown code'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Chain</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>fn <span class="token operator">=</span> fn<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>successor <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">setNextSuccessor</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>successor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chain</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>successor <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>successor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> processCode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chain</span><span class="token punctuation">(</span>processState200<span class="token punctuation">)</span><span class="token punctuation">;</span>processCode  <span class="token punctuation">.</span><span class="token function">setNextSuccessor</span><span class="token punctuation">(</span>processState400<span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">setNextSuccessor</span><span class="token punctuation">(</span>processState500<span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">setNextSuccessor</span><span class="token punctuation">(</span>processStateUnknown<span class="token punctuation">)</span><span class="token punctuation">;</span>processCode<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token number">210</span><span class="token punctuation">)</span><span class="token punctuation">;</span>processCode<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token number">310</span><span class="token punctuation">)</span><span class="token punctuation">;</span>processCode<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token number">410</span><span class="token punctuation">)</span><span class="token punctuation">;</span>processCode<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token number">510</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ©ç”¨-aop-å®ç°èŒè´£é“¾">åˆ©ç”¨ AOP å®ç°èŒè´£é“¾</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">after</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">self</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">===</span> <span class="token string">'nextSuccessor'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> res<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">processState400</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">>=</span> <span class="token number">400</span> <span class="token operator">&amp;&amp;</span> code <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error 400'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token string">'nextSuccessor'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">processState500</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">>=</span> <span class="token number">500</span> <span class="token operator">&amp;&amp;</span> code <span class="token operator">&lt;</span> <span class="token number">600</span><span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server 500'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token string">'nextSuccessor'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">processState200</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">>=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> code <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ok 200'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token string">'nextSuccessor'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">processStateUnknown</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'unknown code'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> processCode <span class="token operator">=</span> processState200  <span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>processState400<span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>processState500<span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>processStateUnknown<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">processCode</span><span class="token punctuation">(</span><span class="token number">210</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">processCode</span><span class="token punctuation">(</span><span class="token number">310</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">processCode</span><span class="token punctuation">(</span><span class="token number">410</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">processCode</span><span class="token punctuation">(</span><span class="token number">510</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ç»„åˆæ¨¡å¼ç›¸æ¯”, èŒè´£é“¾æ¨¡å¼å¯ä»¥æ‰‹åŠ¨æŒ‡å®šæ‰§è¡Œçš„èµ·ç‚¹, èŒè´£ä¿®æ”¹æ›´çµæ´»</p><h2 id="ä¸­ä»‹è€…æ¨¡å¼">ä¸­ä»‹è€…æ¨¡å¼</h2><p>ä¸­ä»‹è€…æ¨¡å¼ä¸å‘å¸ƒè®¢é˜…æ¨¡å¼ç±»ä¼¼,éƒ½æ˜¯å®ç°è§£å†³å†…éƒ¨çŠ¶æ€æ”¹å˜å¼•å‘å¤–éƒ¨è¡Œä¸ºæ”¹å˜.</p><ul><li>å‘å¸ƒè®¢é˜…æ¨¡å¼åªæ”¯æŒå‘å¸ƒæ¶ˆæ¯, æ¶ˆæ¯ä¸­å¿ƒè§¦å‘è®¢é˜…è€…å¯¹åº”äº‹ä»¶.æ¶ˆæ¯æ˜¯å•å‘ä¼ é€’çš„</li><li>ä¸­ä»‹è€…æ¨¡å¼çš„ä¸­ä»‹è€…åŠŸèƒ½æ›´åŠ å¼ºå¤§,ä¸­ä»‹è€…æ‹¥æœ‰<strong>æ™ºèƒ½</strong>å¤„ç†äº‹ä»¶çš„èƒ½åŠ›(ä¸ä»…å¯ä»¥ä¼ é€’æ¶ˆæ¯,è¿˜å¯ä»¥åœ¨æ”¶åˆ°æ¶ˆæ¯ååšä¸€ç³»åˆ—åŠ¨ä½œ). åŒæ—¶, ä¸­ä»‹è€…æ¨¡å¼ä¸åŒºåˆ†å‘å¸ƒè€…ä¸è®¢é˜…è€…,æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ä¸­ä»‹æœåŠ¡çš„å¯¹è±¡, å¯¹è±¡ä¹‹é—´å¹³ç­‰.</li></ul><p>åœ¨ä¸­ä»‹è€…æ¨¡å¼ä¸­, ä¸­å¿ƒçš„å·¥ä½œèƒ½åŠ›å¤§å¤§å¢å¼º,æ‰€ä»¥ä¸­ä»‹è€…æ¨¡å¼ä¹Ÿè¢«ç§°ä¸ºè°ƒåœè€…æ¨¡å¼</p><h3 id="javascript-çš„ä¸­ä»‹è€…æ¨¡å¼">JavaScript çš„ä¸­ä»‹è€…æ¨¡å¼</h3><p>å‘½ä»¤å®šä¹‰ç±»ä¼¼ç­–ç•¥æ¨¡å¼, æ¥å£å®šä¹‰ç±»ä¼¼å‘å¸ƒè®¢é˜…æ¨¡å¼. å®ç°ä¸€ä¸ªç©å®¶ä¸­ä»‹,ç©å®¶å¯ä»¥æ¢é˜Ÿä¼, åŒè‰²é˜Ÿä¼å…¨æ­»åå¯¹æ–¹é˜Ÿä¼æˆå‘˜æ”¶æ¶ˆæ¯.</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ä¸­ä»‹è€…æ¨¡å¼</span><span class="token keyword">function</span> <span class="token function">Player</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> teamColor</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'live'</span><span class="token punctuation">;</span> <span class="token comment">// ç©å®¶çŠ¶æ€</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>teamColor <span class="token operator">=</span> teamColor<span class="token punctuation">;</span> <span class="token comment">//é˜Ÿä¼é¢œè‰²</span><span class="token punctuation">&#125;</span><span class="token class-name">Player</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">win</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">': won'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token class-name">Player</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">lose</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">': lost'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// ç©å®¶æ­»äº¡</span><span class="token class-name">Player</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">die</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'dead'</span><span class="token punctuation">;</span>  <span class="token comment">//ç»™ä¸­ä»‹è€…å‘æ¶ˆæ¯ï¼Œç©å®¶æ­»äº¡</span>  playerDirector<span class="token punctuation">.</span><span class="token function">reciveMessage</span><span class="token punctuation">(</span><span class="token string">'playerDead'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// ç§»é™¤ç©å®¶</span><span class="token class-name">Player</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">remove</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  playerDirector<span class="token punctuation">.</span><span class="token function">reciveMessage</span><span class="token punctuation">(</span><span class="token string">'removePlayer'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// ç©å®¶æ¢é˜Ÿ</span><span class="token class-name">Player</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">changeTeam</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">color</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  playerDirector<span class="token punctuation">.</span><span class="token function">reciveMessage</span><span class="token punctuation">(</span><span class="token string">'changeTeam'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">let</span> <span class="token function-variable function">playerFactory</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> teamColor</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> newPlayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Player</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> teamColor<span class="token punctuation">)</span><span class="token punctuation">;</span>  playerDirector<span class="token punctuation">.</span><span class="token function">reciveMessage</span><span class="token punctuation">(</span><span class="token string">'addPlayer'</span><span class="token punctuation">,</span> newPlayer<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> newPlayer<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">let</span> playerDirector <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> players <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// ä¿å­˜æ‰€æœ‰ç©å®¶</span>    operations <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// ä¸­ä»‹è€…å¯ä»¥æ‰§è¡Œçš„æ“ä½œ</span>  operations<span class="token punctuation">.</span><span class="token function-variable function">addPlayer</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">player</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> teamColor <span class="token operator">=</span> player<span class="token punctuation">.</span>teamColor<span class="token punctuation">;</span>    players<span class="token punctuation">[</span>teamColor<span class="token punctuation">]</span> <span class="token operator">=</span> players<span class="token punctuation">[</span>teamColor<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// å¦‚æœè¿˜æ²¡æˆç«‹é˜Ÿä¼ï¼Œå°±æ–°æˆç«‹ä¸€ä¸ªé˜Ÿä¼</span>    players<span class="token punctuation">[</span>teamColor<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åŠ å…¥ä¸€ä¸ªç©å®¶</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  operations<span class="token punctuation">.</span><span class="token function-variable function">removePlayer</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">player</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> teamColor <span class="token operator">=</span> player<span class="token punctuation">.</span>teamColor<span class="token punctuation">;</span>    teamPlayers <span class="token operator">=</span> players<span class="token punctuation">[</span>teamColor<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//è¯¥é˜Ÿä¼æ‰€æœ‰ç©å®¶</span>    players<span class="token punctuation">[</span>teamColor<span class="token punctuation">]</span> <span class="token operator">=</span> teamPlayers<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> item <span class="token operator">!==</span> player<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç§»é™¤ç©å®¶</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  operations<span class="token punctuation">.</span><span class="token function-variable function">changeTeam</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">player<span class="token punctuation">,</span> newTeamColor</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    operations<span class="token punctuation">.</span><span class="token function">removePlayer</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä»åŸæ¥é˜Ÿä¼ç§»é™¤</span>    player<span class="token punctuation">.</span>teamColor <span class="token operator">=</span> newTeamColor<span class="token punctuation">;</span> <span class="token comment">// æ”¹å˜è‡ªèº«çš„é˜Ÿä¼é¢œè‰²</span>    operations<span class="token punctuation">.</span><span class="token function">addPlayer</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ·»åŠ åˆ°æ–°é˜Ÿä¼</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  operations<span class="token punctuation">.</span><span class="token function-variable function">playerDead</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">player</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> teamColor <span class="token operator">=</span> player<span class="token punctuation">.</span>teamColor<span class="token punctuation">,</span>      teamPlayers <span class="token operator">=</span> players<span class="token punctuation">[</span>teamColor<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//ç©å®¶æ‰€åœ¨é˜Ÿä¼</span>    <span class="token keyword">let</span> all_dead <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> player<span class="token punctuation">;</span> <span class="token punctuation">(</span>player <span class="token operator">=</span> teamPlayers<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">'dead'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        all_dead <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>all_dead <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å…¨éƒ¨æ­»äº¡</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> player<span class="token punctuation">;</span> <span class="token punctuation">(</span>player <span class="token operator">=</span> teamPlayers<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        player<span class="token punctuation">.</span><span class="token function">lose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‰€æœ‰ç©å®¶å¤±è´¥</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> color <span class="token keyword">in</span> players<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>color <span class="token operator">!==</span> teamColor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">let</span> teamPlayers <span class="token operator">=</span> players<span class="token punctuation">[</span>color<span class="token punctuation">]</span><span class="token punctuation">;</span>          <span class="token comment">// æ‰¾å‡ºå…¶ä»–é˜Ÿä¼ç©å®¶</span>          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> player<span class="token punctuation">;</span> <span class="token punctuation">(</span>player <span class="token operator">=</span> teamPlayers<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            player<span class="token punctuation">.</span><span class="token function">win</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…¶ä»–é˜Ÿä¼èƒœåˆ©</span>          <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> <span class="token function-variable function">reciveMessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>    operations<span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    reciveMessage<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> player1 <span class="token operator">=</span> <span class="token function">playerFactory</span><span class="token punctuation">(</span><span class="token string">'å°æ˜'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  player2 <span class="token operator">=</span> <span class="token function">playerFactory</span><span class="token punctuation">(</span><span class="token string">'å°ä¹–'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  player3 <span class="token operator">=</span> <span class="token function">playerFactory</span><span class="token punctuation">(</span><span class="token string">'å°å®'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> player4 <span class="token operator">=</span> <span class="token function">playerFactory</span><span class="token punctuation">(</span><span class="token string">'å°ç™½'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  player5 <span class="token operator">=</span> <span class="token function">playerFactory</span><span class="token punctuation">(</span><span class="token string">'å°é»‘'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  player6 <span class="token operator">=</span> <span class="token function">playerFactory</span><span class="token punctuation">(</span><span class="token string">'å°ç‰›'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// player1.die();</span><span class="token comment">// player3.die();</span><span class="token comment">// player2.die();</span><span class="token comment">// å°æ˜: lost</span><span class="token comment">// å°ä¹–: lost</span><span class="token comment">// å°å®: lost</span><span class="token comment">// å°ç™½: won</span><span class="token comment">// å°é»‘: won</span><span class="token comment">// å°ç‰›: won</span><span class="token comment">// player1.remove();</span><span class="token comment">// player3.die();</span><span class="token comment">// player2.die();</span><span class="token comment">// å°ä¹–: lost</span><span class="token comment">// å°å®: lost</span><span class="token comment">// å°ç™½: won</span><span class="token comment">// å°é»‘: won</span><span class="token comment">// å°ç‰›: won</span>player1<span class="token punctuation">.</span><span class="token function">changeTeam</span><span class="token punctuation">(</span><span class="token string">'blue'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>player2<span class="token punctuation">.</span><span class="token function">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>player3<span class="token punctuation">.</span><span class="token function">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å°ä¹–: lost</span><span class="token comment">// å°å®: lost</span><span class="token comment">// å°ç™½: won</span><span class="token comment">// å°é»‘: won</span><span class="token comment">// å°ç‰›: won</span><span class="token comment">// å°æ˜: won</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç¼ºé™·">ç¼ºé™·</h3><p>æˆ‘ä»¬å¼•å…¥æ¶ˆæ¯è®¢é˜…ä¸­å¿ƒæ˜¯ä¸ºäº†æ–¹ä¾¿å®ç°ä¿¡æ¯äº¤æµ,é¿å…ç¡¬ç¼–ç ä¸å› å®ç°é€šä¿¡å¯¼è‡´çš„å¯¹è±¡è‡ƒè‚¿. ä½†æ˜¯éšç€æ¶ˆæ¯ä¸­å¿ƒåŠŸèƒ½å˜å¼º,é€æ¸æ¼”åŒ–ä¸ºä¸­ä»‹è€…, ä¸­ä»‹è€…å¯¹è±¡ä¹Ÿä¼šå˜å¾—è¶Šæ¥è¶Šè‡ƒè‚¿</p><h2 id="è£…é¥°è€…æ¨¡å¼">è£…é¥°è€…æ¨¡å¼</h2><p>è£…é¥°è€…æ¨¡å¼åˆç§°åŒ…è£…å™¨æ¨¡å¼, å°±æ˜¯å°†ä¸€ä¸ªå‡½æ•°åŒ…è£…åœ¨å¦ä¸€ä¸ªå‡½æ•°é‡Œé¢.</p><h3 id="javascript-çš„è£…é¥°è€…æ¨¡å¼">JavaScript çš„è£…é¥°è€…æ¨¡å¼</h3><p>JavaScript æ”¯æŒé«˜é˜¶å‡½æ•°, æ‰€ä»¥å¤©ç”Ÿæ”¯æŒè£…é¥°è€…æ¨¡å¼. ä¾‹å¦‚, æˆ‘ä»¬æƒ³ä¸º<code>window.onload</code> ç»‘å®šå†…å®¹ä½†ä¸çŸ¥é“ <code>window.onload</code>æ˜¯å¦ä»¥åŠç»‘å®šäº†å‡½æ•°, æˆ‘ä»¬å¯ä»¥å†™</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> _load <span class="token operator">=</span> window<span class="token punctuation">.</span>onload<span class="token punctuation">;</span>window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  _load <span class="token operator">&amp;&amp;</span> <span class="token function">_load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æˆ‘ä»¬è‡ªå·±æƒ³ç»‘å®šçš„</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä½¿ç”¨-aop-å®ç°è£…é¥°å™¨æ¨¡å¼">ä½¿ç”¨ AOP å®ç°è£…é¥°å™¨æ¨¡å¼</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">before</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">self</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">after</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">self</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> res<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">f1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">f2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> f <span class="token operator">=</span> f1<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>f2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span>f2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2 1 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åº”ç”¨åœºæ™¯-4">åº”ç”¨åœºæ™¯</h3><p>è£…é¥°å™¨æ¨¡å¼å¯ä»¥ä¸ºå‡½æ•°<strong>åŠ¨æ€çš„</strong>åŠ å…¥æ–°çš„èŒè´£ä¸è¡Œä¸º,å½“ä¸€ä¸ªå‡½æ•°çš„å…·ä½“<strong>åŠŸèƒ½æ— æ³•åœ¨è¿è¡Œå‰ç¡®å®š</strong>æ—¶æˆ–éœ€è¦<strong>ä¸ºå‡½æ•°åŠ å…¥éä¸»çº¿ä»»åŠ¡çš„å·¥ä½œ(AOP)</strong>æ—¶å¯ä»¥è€ƒè™‘è£…é¥°è€…æ¨¡å¼.åŒæ—¶, è€ƒè™‘åˆ°å…¶å¯ä»¥å®¢è§‚å°†ä»£ç åˆ†å¼€,å½“æˆ‘ä»¬æƒ³è¦å°†ä¸åŒå±‚çº§ä»£ç ä»åŒä¸€ä¸ªå‡½æ•°ä¸­åˆ†ç¦»æ—¶ä¹Ÿå¯ä»¥è€ƒè™‘è¿™ä¸€æ¨¡å¼(ä¾‹å¦‚åœ¨è¡¨å•æäº¤ä¸­å°†åˆæ³•æ€§æ£€æŸ¥ä¸æäº¤è¯·æ±‚ä¸DOM åˆ·æ–°åˆ†å¼€, è€…ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§ AOP)</p><h2 id="çŠ¶æ€æ¨¡å¼">çŠ¶æ€æ¨¡å¼</h2><blockquote><p>å°†äº‹åŠ¡çš„<strong>æ¯ç§çŠ¶æ€</strong>éƒ½å°è£…ä¸ºç±»,ä¸å½“å‰çŠ¶æ€ç›¸å…³çš„è¡Œä¸ºè¢«ç›´æ¥å°è£…åˆ°çŠ¶æ€ç±»ä¸­, è€Œåœ¨è°ƒç”¨è€…çœ‹æ¥,å¯¹è±¡ä¼¼ä¹å¯ä»¥æ ¹æ®çŠ¶æ€çš„ä¸åŒè°ƒæ•´è¡Œä¸º</p></blockquote><p>å‡è®¾æˆ‘ä»¬è¦å®ç°ä¸€ä¸ªæ”¯æŒä¸‰æ¡£åˆ‡æ¢çš„ç”µç¯(å…³-å¼±å…‰-å¼ºå…‰)</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// å®šä¹‰çŠ¶æ€ç±»</span><span class="token keyword">class</span> <span class="token class-name">OffLight</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">light</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>light <span class="token operator">=</span> light<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// ä¸åŒçŠ¶æ€åœ¨æŒ‰å¼€å…³æ—¶è¡Œä¸ºä¸åŒ</span>  <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>light<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>light<span class="token punctuation">.</span>weakLight<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å˜ä¸ºå¼±å…‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">WeakLight</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">light</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>light <span class="token operator">=</span> light<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>light<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>light<span class="token punctuation">.</span>strongLight<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å˜ä¸ºå¼ºå…‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">StrongLight</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">light</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>light <span class="token operator">=</span> light<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>light<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>light<span class="token punctuation">.</span>offLight<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ç†„ç¯äº†'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// å®šä¹‰ä¸Šä¸‹æ–‡ç±»</span><span class="token keyword">class</span> <span class="token class-name">Light</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æ‰‹å†™æ¯ä¸€ç§çŠ¶æ€</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>offLight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OffLight</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// new è¯­å¥ä¸­ this æŒ‡å‘æ„é€ å¯¹è±¡</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>weakLight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakLight</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// new è¯­å¥ä¸­ this æŒ‡å‘æ„é€ å¯¹è±¡</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>strongLight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StrongLight</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// new è¯­å¥ä¸­ this æŒ‡å‘æ„é€ å¯¹è±¡</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>button <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>curState <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>offLight<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">setButton</span><span class="token punctuation">(</span><span class="token parameter">dom</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>button <span class="token operator">=</span> dom<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">switch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>curState <span class="token operator">=</span> state<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>curState<span class="token punctuation">.</span><span class="token function">switch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">new</span> <span class="token class-name">Light</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setButton</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'switch'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°ä¸Šä¸‹æ–‡ä¸­åŒ…å«äº†æ‰€æœ‰çŠ¶æ€, å…³è”è¡Œä¸ºç»Ÿä¸€å®šä¹‰åœ¨çŠ¶æ€ä¸­,ä¸Šä¸‹æ–‡ç±»åªè´Ÿè´£è°ƒç”¨</p><h3 id="ä½¿ç”¨æœ‰é™çŠ¶æ€æœºå®ç°çŠ¶æ€æ¨¡å¼">ä½¿ç”¨æœ‰é™çŠ¶æ€æœºå®ç°çŠ¶æ€æ¨¡å¼</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">delegate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">client<span class="token punctuation">,</span> delegation</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token function-variable function">buttonWasPressed</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å°†å®¢æˆ·çš„æ“ä½œå§”æ‰˜ç»™delegation å¯¹è±¡</span>      <span class="token keyword">return</span> delegation<span class="token punctuation">.</span><span class="token function">buttonWasPressed</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">var</span> <span class="token constant">FSM</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">off</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token function-variable function">buttonWasPressed</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å…³ç¯'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>button<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'ä¸‹ä¸€æ¬¡æŒ‰æˆ‘æ˜¯å¼€ç¯'</span><span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>currState <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onState<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token function-variable function">buttonWasPressed</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å¼€ç¯'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>button<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'ä¸‹ä¸€æ¬¡æŒ‰æˆ‘æ˜¯å…³ç¯'</span><span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>currState <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>offState<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">var</span> <span class="token function-variable function">Light</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>offState <span class="token operator">=</span> <span class="token function">delegate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">FSM</span><span class="token punctuation">.</span>off<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>onState <span class="token operator">=</span> <span class="token function">delegate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">FSM</span><span class="token punctuation">.</span>on<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>currState <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>offState<span class="token punctuation">;</span> <span class="token comment">// è®¾ç½®åˆå§‹çŠ¶æ€ä¸ºå…³é—­çŠ¶æ€</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>button <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token class-name">Light</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  button<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'å·²å…³ç¯'</span><span class="token punctuation">;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>button <span class="token operator">=</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>button<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    self<span class="token punctuation">.</span>currState<span class="token punctuation">.</span><span class="token function">buttonWasPressed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">var</span> light <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Light</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>light<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¼˜ç¼ºç‚¹">ä¼˜ç¼ºç‚¹</h3><ul><li>çŠ¶æ€åŠå…¶å¯¹åº”çš„è¡Œä¸ºè¢«å°è£…åœ¨çŠ¶æ€é‡Œ,éå¸¸æ–¹ä¾¿åæœŸæ–°å¢çŠ¶æ€ä¸çŠ¶æ€è½¬æ¢</li><li>é€šè¿‡ç‹¬ç«‹çŠ¶æ€ç±»é¿å…äº† context ç±»å˜è‡ƒè‚¿</li><li>ä½¿ç”¨å¯¹è±¡è¡¨ç¤ºçŠ¶æ€æ¯”ç”¨å­—ç¬¦ä¸²æ›´ä¸€ç›®äº†ç„¶</li><li>ä¸åŒçŠ¶æ€ä¹‹é—´çš„è¡Œä¸ºç‹¬ç«‹</li></ul><h3 id="ä¼˜åŒ–ç‚¹">ä¼˜åŒ–ç‚¹</h3><ul><li>åŠ¨æ€åˆ›é€  / é”€æ¯çŠ¶æ€è€Œä¸æ˜¯å…¨éƒ¨å®šä¹‰åœ¨ä¸Šä¸‹æ–‡ç±»ä¸­</li><li>å…±äº«çŠ¶æ€</li></ul><h2 id="é€‚é…å™¨æ¨¡å¼">é€‚é…å™¨æ¨¡å¼</h2><p>å½“ä¸¤ä¸ªéƒ¨åˆ†ä»£ç ç”±äºæ¥å£ä¸åŒä¸å…¼å®¹æ—¶å¯ä»¥é‡‡ç”¨é€‚é…å™¨æ¨¡å¼å°†ä¸å…¼å®¹çš„æ¥å£è½¬ä¸ºå…¼å®¹æ¥å£</p>]]></content>
    
    
    <summary type="html">éšæ‰‹è®°ä¸€äº›è®¾è®¡æ¨¡å¼å§~</summary>
    
    
    
    <category term="è®¡ç®—æœºç†è®º" scheme="https://blog.liukairui.me/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%90%86%E8%AE%BA/"/>
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://blog.liukairui.me/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%90%86%E8%AE%BA/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="JavaScript" scheme="https://blog.liukairui.me/tags/JavaScript/"/>
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://blog.liukairui.me/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>ç†è§£Vue</title>
    <link href="https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3Vue/"/>
    <id>https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3Vue/</id>
    <published>2022-08-15T16:00:00.000Z</published>
    <updated>2022-11-08T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ€»è§ˆ">æ€»è§ˆ</h2><h3 id="vue3-çš„åŸºæœ¬ç»“æ„">Vue3 çš„åŸºæœ¬ç»“æ„</h3><p>é‡‡ç”¨ Monorepo æ¨¡å¼(å¤šç»„ä»¶æ”¾åœ¨ä¸€ä¸ª Repo ä¸­), åœ¨<code>/packages/</code> ä¸­å­˜å‚¨æ‰€æœ‰çš„æ¨¡å—.</p><p><strong>æ¨¡å—åˆ†ä¸ºå‡ ç±»:</strong></p><ul><li>ç¼–è¯‘æ—¶(<code>/package/compiler-*</code>)<ul><li><code>compiler-core</code>: ä¸å¹³å°æ— å…³çš„ç¼–è¯‘å™¨æ ¸å¿ƒ</li><li><code>compiler-dom</code>: åŸºäº <code>compiler-core</code> è§£æ<code>&lt;template&gt;</code> æ ‡ç­¾å¹¶ç¼–è¯‘ä¸º render å‡½æ•°</li><li><code>compiler-sfc</code>: åŸºäº <code>compiler-dom</code> ä¸<code>compiler-core</code> è§£æ SFC (å•æ–‡ä»¶ç»„ä»¶, é€šä¿—ç†è§£å°±æ˜¯<code>.vue</code> æ–‡ä»¶) ç¼–è¯‘ä¸ºæµè§ˆå™¨å¯æ‰§è¡Œçš„ JavaScript</li><li><code>compiler-ssr</code>: æœåŠ¡ç«¯æ¸²æŸ“çš„ç¼–è¯‘æ¨¡å—</li></ul></li><li>è¿è¡Œæ—¶(<code>/package/runtime-*</code>)<ul><li><code>reactivity</code>: å®ç°å“åº”å¼</li><li><code>runtime-core</code>: åŸºäº <code>reactivity</code>å®ç°è¿è¡Œæ—¶æ ¸å¿ƒ</li><li><code>runtime-dom</code>: åŸºäº <code>runtime-core</code>å®ç°é’ˆå¯¹æµè§ˆå™¨çš„è¿è¡Œæ—¶. åŒ…æ‹¬DOM API, å±æ€§, äº‹ä»¶å¤„ç†ç­‰</li></ul></li><li>å…¶ä»–<ul><li><code>template-explorer</code>: ç”¨äºè°ƒè¯•ç¼–è¯‘å™¨è¾“å‡ºçš„å¼€å‘å·¥å…·</li><li><code>shared</code>: å¤šä¸ªåŒ…ä¹‹é—´å…±äº«çš„å†…å®¹</li><li><code>vue</code>: å®Œæ•´ç‰ˆæœ¬,åŒ…æ‹¬è¿è¡Œæ—¶å’Œç¼–è¯‘å™¨</li></ul></li></ul><p><strong>ä¾èµ–å…³ç³»</strong></p><pre class="line-numbers language-none"><code class="language-none">                                 +---------------------+                                 |                     |                                 |  @vue&#x2F;compiler-sfc  |                                 |                     |                                 +-----+--------+------+                                       |        |                                       v        v                   +---------------------+    +----------------------+                   |                     |    |                      |     +------------&gt;|  @vue&#x2F;compiler-dom  +---&gt;|  @vue&#x2F;compiler-core  |     |             |                     |    |                      |+----+----+        +---------------------+    +----------------------+|         ||   vue   ||         |+----+----+        +---------------------+    +----------------------+    +-------------------+     |             |                     |    |                      |    |                   |     +------------&gt;|  @vue&#x2F;runtime-dom   +---&gt;|  @vue&#x2F;runtime-core   +---&gt;|  @vue&#x2F;reactivity  |                   |                     |    |                      |    |                   |                   +---------------------+    +----------------------+    +-------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å­¦ä¹ è·¯çº¿</strong></p><p>æ ¹æ®æ¨¡å—ä¾èµ–å…³ç³», è·¯çº¿ä¸º: <code>reactivity</code> -&gt;<code>runtime-core</code> -&gt; <code>runtime-dom</code> -&gt;<code>compiler</code>. é‡ç‚¹æ˜¯ <code>runtime-*</code></p><p><strong>ä»£ç åˆ†ææ­¥éª¤</strong>:</p><ol type="1"><li>æŸ¥çœ‹å•å…ƒæµ‹è¯•(ä½äº<code>packages/**/__tests__/</code>)</li><li>æ ¹æ®å•å…ƒæµ‹è¯•äº†è§£æ¨¡å—å®ç°çš„åŠŸèƒ½</li><li>è·Ÿç€å•å…ƒæµ‹è¯•çš„äº†è§£æ¨¡å—åŠŸèƒ½, äº†è§£æ¨¡å—åŠŸèƒ½æ—¶: å…ˆçœ‹å¯¼å‡º(æ¨¡å—æ˜¯ä»€ä¹ˆ),å†çœ‹æ¨¡å—è¢«è°å¯¼å…¥(ä¸ºä»€ä¹ˆè¢«éœ€è¦),æœ€åçœ‹å¯¼å‡ºéƒ¨åˆ†å¯¹åº”çš„å®ç°(æ€ä¹ˆæ ·å®ç°)</li></ol><p><strong>å‚è€ƒ repo</strong></p><ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2N1aXhpYW9ydWkvbWluaS12dWU=">cuixiaorui/mini-vue<i class="fa fa-external-link-alt"></i></span>:ç”¨æ¥å­¦ä¹ </li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Z1ZWpzL2NvcmU=">vuejs/core<i class="fa fa-external-link-alt"></i></span>:ç”¨æ¥éªŒè¯</li></ul><h3 id="reactivity-çš„åŸºæœ¬æµç¨‹">Reactivity çš„åŸºæœ¬æµç¨‹</h3><p><code>Reactivity</code> æ¨¡å—æ˜¯è¿è¡Œæ—¶çš„æœ€åº•å±‚, è´Ÿè´£å®ç°å“åº”å¼, ä½äº:<code>mini-vue/packages/reactivity</code></p><p><strong><code>reactive</code> çš„åŸºæœ¬æµç¨‹</strong></p><p><code>reactive</code> æ˜¯ <code>Reactivity</code> çš„åŸºç¡€.è´Ÿè´£å®ç°å¯¹è±¡çš„å“åº”å¼, å¹¶å‘ä¸Šæä¾›è°ƒç”¨æ—¶æ–¹æ³•. åŸºæœ¬æ€æƒ³å°±æ˜¯å€ŸåŠ© ES6 çš„<code>Proxy</code> è‡ªå®šä¹‰ <code>get &amp; set</code></p><ol type="1"><li><p>è½¬åˆ° <code>mini-vue/../__tests__/reactive.spec.ts</code>,å‘ç°æµ‹è¯•çš„ä¸»è¦ç›®çš„æ˜¯çœ‹ <code>reactive</code> æ„é€ æ–¹æ³•.</p></li><li><p>è½¬åˆ° <code>mini-vue/../src/reactive.ts</code>, å‘ç°å®šä¹‰äº†<code>reactive</code>, <code>readonly</code> ç­‰æ–¹æ³•, è¿™äº›æ–¹æ³•éƒ½äº¤ç”±<code>createReactiveObject</code> å¤„ç†.</p><p>è§‚å¯Ÿ <code>createReactiveObject</code>, å¯ä»¥å¾—åˆ°ä¸‰ä¸ªè°ƒç”¨å‚æ•°æ„ä¹‰:</p><ul><li><p><code>target</code>: è¦è¢«ä»£ç†çš„å€¼</p></li><li><p><code>proxyMap</code>: ä¸åŒç±»å‹çš„å·¥å‚å‡½æ•°æœ‰ä¸åŒçš„å…¨å±€<code>proxyMap</code>, è¿™æ„å‘³ç€è¯¥å˜é‡å¯èƒ½ä¼šå­˜å‚¨æ‰€æœ‰ä»£ç†çš„æŸç±»å‹å˜é‡.æ ¹æ®</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> existingProxy <span class="token operator">=</span> proxyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>existingProxy<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> existingProxy<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥éªŒè¯æƒ³æ³•, å…¶åœ¨ <code>createReactiveObject</code> çš„ç›®çš„å°±æ˜¯æŒä¹…åŒ–<code>Proxy</code> é˜²æ­¢é‡å¤åˆ›å»ºä»£ç†</p></li><li><p><code>baseHandlers</code>: æ ¹æ®</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> baseHandlers<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¾—å‡ºè¯¥æ–¹æ³•å°±æ˜¯ Proxy(<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvUHJveHk=">MDN<i class="fa fa-external-link-alt"></i></span>)çš„ <code>get &amp; set</code> å¯¹è±¡. ä¸åŒç±»å‹çš„ Proxy æœ‰ä¸åŒçš„<code>baseHandlers</code></p></li></ul></li><li><p>è½¬åˆ° <code>mini-vue/../src/baseHandlers.ts</code>å‘ç°æ¨¡å—ä¸»è¦æ˜¯æä¾›ä¸åŒçš„ <code>get &amp; set</code> è€Œè¿™äº›éƒ½æ˜¯ç”±ä¸¤ä¸ª<code>create</code> å‡½æ•°å®ç°çš„, å°è¯•ç†è§£</p><ul><li><p><code>createGetter</code> åº”è¯¥è¿”å›ä¸€ä¸ª<code>handler.get</code>(<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvUHJveHkvUHJveHkvZ2V0">MDN<i class="fa fa-external-link-alt"></i></span>)å®ç°. å¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°ä¸Šæœ‰ä¸€å †ç±»å‹åˆ¤æ–­çš„æ–¹æ³•, ç„¶ååšäº†ä¸¤æ­¥</p><ul><li>é€šè¿‡ <code>Reflect.get</code>(<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvUmVmbGVjdC9nZXQ=">MDN<i class="fa fa-external-link-alt"></i></span>)è·å–å±æ€§</li><li>é€šè¿‡ <code>track</code> è¿›è¡Œ<strong>ä¾èµ–æ”¶é›†</strong>,è¿™éƒ¨åˆ†åé¢å†çœ‹</li></ul><p>æœ€åè¿”å›è·å–ç»“æœ. æ•´ä¸ª <code>get</code>æ„Ÿè§‰å’ŒåŸç”Ÿæ–¹æ³•ç›¸æ¯”å°±æ˜¯å¤šäº†ä¸ªç±»å‹åˆ¤æ–­å’Œ <code>track</code>,å¤§éƒ¨åˆ†çš„å“åº”å¼éƒ½æ˜¯ä¾èµ–è¿™ä¸ª <code>track</code> å®ç°çš„</p></li><li><p><code>createSetter</code> æ›´åŠ ç®€å•, çœ‹èµ·æ¥å°±æ˜¯åœ¨å®ç°<code>handler.set</code>(<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvUHJveHkvUHJveHkvc2V0">MDN<i class="fa fa-external-link-alt"></i></span>)çš„åŸºç¡€ä¸Šå¤šäº†ä¸ª <code>trigger</code></p></li></ul><p>åˆ°ç›®å‰ä½ç½®è¿™ä¸ªåªæœ‰ <code>track</code> å’Œ <code>trigger</code>æ˜¯ä¸æ¸…æ¥šçš„, è¿™ä¸¤ä¸ªå‡½æ•°åœ¨ <code>effect</code> ç­‰éƒ¨åˆ†åšä¾èµ–æ”¶é›†çš„,å¯ä»¥å…ˆä¸ç®¡. å…¶ä»–éƒ¨åˆ†å°±æ˜¯åŸç”ŸåŠŸèƒ½è°ƒç”¨ä¸æƒé™ç®¡ç†</p></li></ol><p><strong><code>effect</code> çš„åŸºæœ¬æµç¨‹</strong></p><p>å¦‚æœè®©æˆ‘å®ç° <code>effect</code> æˆ‘ä¼šæ€ä¹ˆå®ç°å‘¢?æˆ‘å…ˆæƒ³åˆ°çš„æ˜¯åˆ©ç”¨ç¼–è¯‘åŸç†ç­‰é­”æ³•å¯¹ä»£ç åšé™æ€åˆ†æ, æ‰¾åˆ°æ‰€ç”¨å“åº”å¼å¯¹è±¡,åœ¨å“åº”å¼å¯¹è±¡çš„ <code>set</code> ä¸ŠæŒ‚ä¸Šå‡½æ•°. ä½†æ˜¯, JavaScriptæ˜¯ä¸ªåŠ¨æ€è¯­è¨€, è¿™å®Œå…¨æ²¡æ³•æŒ‚å•Š! åªèƒ½åœ¨è¿è¡Œæ—¶åŠ¨æ€è§£æ.</p><p>Vue çš„å®ç°å°±æ¯”è¾ƒæµç•…. æ—¢ç„¶æˆ‘ <code>effect</code> è¦ç«‹å³æ‰§è¡Œä¸€éå‡½æ•°,é‚£ä¸ºå•¥ä¸åœ¨æ‰§è¡Œå‰ååšä¸‹ Flag, ä¸€æ—¦ Proxy çš„ <code>get</code> è¢«è°ƒç”¨, è®©<code>get</code> æ£€æŸ¥ä¸€ä¸‹æ˜¯ä¸æ˜¯åœ¨ <code>effect</code> æ‰§è¡Œé˜¶æ®µ,è‹¥æ˜¯å°±æŠŠå‡½æ•°æ³¨å†Œåˆ°è¿™ä¸ªå“åº”å¼å¯¹è±¡ä¸ŠğŸ˜</p><ol type="1"><li><p>è½¬åˆ° <code>mini-vue/../__tests__/reactive.spec.ts</code> çœ‹åˆ°<code>effect</code> çš„ä¸»è¦åŠŸèƒ½æ˜¯ç«‹å³æ‰§è¡Œå‡½æ•°å¹¶åœ¨å“åº”å¼æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶,å»æ‰§è¡Œ <code>effect</code> æ³¨å†Œçš„å‡½æ•°</p></li><li><p>è½¬åˆ° <code>mini-vue/../src/effect.ts</code> çœ‹<code>effect</code> å‡½æ•°çš„å®ç°. çœ‹åˆ°è¿™é‡Œæœ‰ç†Ÿæ‚‰çš„ <code>effect</code>,<code>track</code>, <code>trigger</code></p><ol type="1"><li><p><code>effect</code> å‡½æ•°å°†ä¼ å…¥å‡½æ•°åŒ…è£…ä¸º<code>ReactiveEffect</code> å¯¹è±¡, åˆå¹¶é…ç½®, æ‰§è¡Œ <code>run</code> å‡½æ•°,æ„é€  <code>runner</code> å¹¶è¿”å›(ç”¨äºåæœŸè°ƒç”¨)</p></li><li><p><code>ReactiveEffect</code> ç±»</p><ul><li><code>active</code>: æ ¹æ® <code>run</code>, <code>stop</code>å‡½æ•°å’Œæµ‹è¯•æ–‡ä»¶ä¸­çš„ <code>it("stop")</code> æ–­è¨€å¯ä»¥æ¨å‡ºå…¶æ˜¯ç”¨æ¥å¼€å…³<code>effect</code> åŠŸèƒ½çš„</li><li><code>deps</code>: æ ¹æ® <code>track</code> ä¸ <code>trigger</code>å¯¹å…¶è°ƒç”¨å¯ä»¥åˆ¤æ–­å…¶æ˜¯ç”¨æ¥è®°å½•å‡½æ•°å¯¹åº”ä¾èµ–çš„</li><li><code>run</code>: å¯¹ <code>effect</code> æ³¨å†Œå‡½æ•°çš„åŒ…è£…,åœ¨æ‰§è¡Œå‡½æ•°å‰åæ‰“å…¥ <code>shouldTrack</code> æ ‡è®°, å¹¶å°†<code>activeEffect</code> æ ‡è®°ä¸ºè¦æ‰§è¡Œçš„ <code>ReactiveEffect</code>å¥½è®© <code>get</code> çŸ¥é“å“ªä¸ª <code>effect</code> åœ¨è·‘</li></ul></li><li><p><code>track</code> å‡½æ•°: åœ¨ <code>reactive</code> çš„<code>get</code> ä¸­è°ƒç”¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">track</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token string">"get"</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>track</code> å‘ç°è‡ªå·±å¤„äº <code>effect</code>é˜¶æ®µæ—¶ä¼šå…ˆæ£€æŸ¥è‡ªå·±æ‰€åœ¨å¯¹è±¡æœ‰æ²¡æœ‰åˆ›å»º <code>attribute</code> -<code>effect</code> å‡½æ•°heap çš„ <code>map</code>, å¦‚æœæ¯å°±åˆ›å»º, ç„¶åçœ‹<code>map</code> ä¸Šæœ‰æ²¡æœ‰è®°å½•å½“å‰å±æ€§, å¦‚æœæ²¡æœ‰, å°±å»ºç«‹ä¾èµ–çš„<code>set</code> å¹¶äº¤ç”± <code>trackEffects</code> åŠ å…¥å¹¶åœ¨<code>ReactiveEffect</code> ä¸Šä¹Ÿåšè®°å½•.</p></li><li><p><code>trigger</code> å‡½æ•°: åœ¨ <code>reactive</code> çš„<code>set</code> ä¸­è°ƒç”¨</p><p>å…ˆæ‰¾åˆ°å¯¹åº” <code>attribute</code> çš„ <code>effect</code> ä¾èµ–, å»é‡,æ ¹æ®é…ç½®å»¶è¿Ÿæˆ–ç«‹å³æ”¯æŒ <code>effect</code></p></li></ol></li></ol><p><strong>æ€»ç»“</strong></p><ul><li><code>reactive</code> çš„æµç¨‹: ä¼ å…¥å¯¹è±¡, æŒä¹…åŒ–, ç»‘å®š<code>baseHandlers</code> åšæƒé™ç®¡ç†ä¸ä¾èµ–æ”¶é›†</li><li><code>effect</code> çš„æµç¨‹: å°†ä¼ å…¥å‡½æ•°åŒ…è£…ä¸ºå¯¹è±¡,ç«‹å³æ‰§è¡Œå‡½æ•°å¹¶åšå¥½æ ‡è®°, åœ¨æ‰§è¡Œæ—¶æ”¶é›†ä¾èµ–. æ¯å½“ <code>reactive</code>è¢«è°ƒç”¨æ—¶å°± <code>tigger</code> æ”¶é›†çš„ <code>effect</code>,å¹¶äºŒæ¬¡æ”¶é›†ä¾èµ–</li></ul><p><strong>é—®é¢˜</strong></p><ul><li><p>æ‰€æœ‰çš„ä¾èµ–æ”¶é›†éƒ½æ˜¯åŸºäº <code>get</code>, è¿™æ ·çš„<code>effect</code> å­˜åœ¨é—®é¢˜</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should observe basic properties'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> dummy<span class="token punctuation">,</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      dummy <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      dummy <span class="token operator">=</span> counter<span class="token punctuation">.</span>num<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>dummy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  counter<span class="token punctuation">.</span>num <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>dummy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Except 2, Received -1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸åªæ˜¯ <code>mini-vue</code>, <code>vue/core</code>çš„å•å…ƒæµ‹è¯•ä¹Ÿå­˜åœ¨è¿™ä¸ªé—®é¢˜. ä½†æ˜¯åœ¨ <code>Vue</code>ä»£ç ä¸­å¹¶ä¸ä¼šå‡ºç°æ— æ³•è¿½è¸ªä¾èµ–çš„é—®é¢˜,çœ‹æ¥è¿˜æœ‰ä¸€äº›éšè—çš„ä¼˜åŒ–æ²¡æœ‰æ‰¾åˆ°</p></li></ul><h3 id="runtime-core-çš„åŸºæœ¬æµç¨‹">Runtime-core çš„åŸºæœ¬æµç¨‹</h3><p><code>runtime-core</code> ä¾èµ– <code>Reactivity</code> ä¸º runtimeæä¾›æœåŠ¡. å¯ä»¥é€šè¿‡è§‚å¯Ÿ Vue æ–‡ä»¶çš„è¿è¡Œè§‚å¯Ÿ <code>runtime-core</code>çš„åŸºæœ¬æµç¨‹</p><p><strong>æ–‡ä»¶åŸºæœ¬ç»“æ„</strong></p><ol type="1"><li><p>è½¬åˆ° <code>mini-vue/packages/vue/example/helloWorld/</code>çš„æ–‡ä»¶å¤¹äº†è§£ vue çš„åŸºæœ¬å·¥ä½œæµç¨‹</p></li><li><p>è½¬åˆ° <code>mini-vue/../helloWorld/index.html</code>, åªæœ‰ä¸ª<code>div#root</code> å’Œ <code>script</code></p></li><li><p>è½¬åˆ° <code>mini-vue/.../helloWorld/main.js</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createApp <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../../dist/mini-vue.esm-bundler.js'</span><span class="token punctuation">;</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.js'</span><span class="token punctuation">;</span><span class="token keyword">const</span> rootContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span>rootContainer<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¼•å…¥äº†åˆ›å»ºæ ¹ç»„ä»¶çš„ <code>createApp</code> ä¸æ ¹ç»„ä»¶ <code>App</code>,æŸ¥æ‰¾äº† html æ–‡ä»¶ä¸­å£°æ˜çš„æŒ‚è½½ç‚¹, ç„¶åé€šè¿‡ <code>createApp(App)</code>æ‰“åŒ…æ ¹ç»„ä»¶å†å°†æ‰“åŒ…åç»“æœæŒ‚è½½</p></li><li><p>è½¬åˆ° <code>mini-vue/../helloWorld/App.js</code> å‘ç°å®šä¹‰äº†ä¸¤ä¸ªvue2 é£æ ¼çš„ç»„ä»¶å¯¹è±¡</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span> <span class="token comment">// ç»„ä»¶å</span>  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// setup æ–¹æ³•</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// æ¸²æŸ“æ–¹æ³•</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">tId</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'ä¸»é¡µ'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">h</span><span class="token punctuation">(</span>HelloWorld<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>å‰é¢æœ‰æåˆ°: <code>compiler-dom</code> å°†<code>&lt;template&gt;</code> æ ‡ç­¾è§£æå¹¶ç¼–è¯‘ä¸º render å‡½æ•°.åœ¨è¿™é‡Œä¸ºäº†ä¸è¿½è¸ª <code>compiler-dom</code> çš„è¡Œä¸º, æˆ‘ä»¬ç›´æ¥å°†<code>render</code> ç»™å‡º</p></li><li><p><code>h</code> ä¸ºæ¸²æŸ“å‡½æ•°, å‚æ•°åˆ†åˆ«æ˜¯: ç»„ä»¶çš„<code>ElementType</code>, é…ç½®, å­ç»„ä»¶æ•°ç»„, å¯ä»¥çœ‹åˆ°,è¿™é‡Œç¬¬ä¸€ä¸ªå­ç»„ä»¶æ˜¯ä¸€ä¸ª <code>&lt;p&gt;</code> ç¬¬äºŒä¸ªæ˜¯ä¸€ä¸ªç»„ä»¶</p></li><li><p>å¯ä»¥åœ¨å¯¹è±¡ä¸­ä½¿ç”¨ <code>render</code>, ä¹Ÿå¯ä»¥è®© <code>setup</code>è¿”å› <code>render</code> æ–¹æ³•, å³</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">tId</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'ä¸»é¡µ'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">h</span><span class="token punctuation">(</span>HelloWorld<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p><code>createApp</code> è°ƒç”¨å…³ç³»æ¯”è¾ƒå¤æ‚, ç›´æ¥ä½¿ç”¨ dev-toolsè§‚å¯Ÿæ‰§è¡Œè¿‡ç¨‹. æ‰“å¼€ä¸€ä¸ª http æœåŠ¡å™¨å¹¶è½¬åˆ° dev-toolsä¸‹, æ‰¾åˆ°<code>createApp.js</code> å¹¶æ‰“ä¸‹æ–­ç‚¹</p></li><li><p><code>createApp</code> æ–¹æ³•æ¥å—æ ¹ç»„ä»¶é…ç½®å¯¹è±¡ <code>App</code>ç›´æ¥åŒ…äº†ä¸ªå¯¹è±¡, æœ‰</p><ul><li><code>_componment = App</code></li><li><code>mount</code> æ–¹æ³•, çœ‹è¯­ä¹‰, è¿™ä¸ªæ–¹æ³•æ¥æ”¶æŒ‚è½½ç‚¹, å°†æ ¹ç»„ä»¶åˆ›å»ºä¸º<code>VNode</code> å¹¶æŒ‚è½½åˆ°æŒ‚è½½ç‚¹(<code>main.js</code> ä¸­çš„<code>rootContainer</code>), æ‰§è¡Œå®Œå <code>main.js</code> å°±ç»“æŸäº†</li></ul><p>æˆ‘ä»¬éœ€è¦ç»§ç»­åˆ†æçš„å°±æ˜¯ <code>VNode</code> çš„åˆ›å»ºè¿‡ç¨‹ä¸<code>render</code> çš„æŒ‚è½½è¿‡ç¨‹</p></li></ol><p><strong>ç»„ä»¶åˆå§‹åŒ–è¿‡ç¨‹</strong></p><ol type="1"><li><p>å•æ­¥è¿›å…¥ <code>createVNode</code> å‘ç°å…¶å£°æ˜äº†ä¸ª<code>vnode</code>.</p><p>å°†ä¼ å…¥å¯¹è±¡(<code>rootComponent / App</code>) ä½œä¸º<code>vnode.type</code></p><p>åœ¨ <code>vnode</code> ä¸Šåˆå¹¶å¯¹è±¡å¹¶é…ç½® <code>shapeFlag</code>ç”¨äºæ ‡è®°ç±»å‹</p><p>ä¹‹åè°ƒç”¨ <code>normalizeChildren</code> å¹¶è¿”å›å¯¹è±¡</p><ul><li>è¿›å…¥ <code>normalizeChildren</code> çœ‹èµ·æ¥æ˜¯ä½œäº† <code>slot</code>ç‰¹åˆ¤</li></ul></li><li><p>å•æ­¥è¿›å…¥ <code>render</code>, å…¶æ¥æ”¶äº†å¤„ç†åçš„ <code>vnode</code>ä¸æŒ‚è½½ç‚¹ <code>rootContainer</code> ç„¶åå°†å‚æ•°ç›´æ¥äº¤ç»™<code>patch</code>, å¯ä»¥çŒœåˆ° <code>patch</code> ä¼šæ˜¯ä¸€ä¸ªå¾ˆé€šç”¨çš„å‡½æ•°</p><ul><li><p>å•æ­¥è¿›å…¥ <code>patch</code>, å…¶æ¥æ”¶ <code>n1 = null</code>,<code>n2 = vnode</code>, <code>container</code>.</p><p>è§£æ„å‡ºäº†<code>n2</code> çš„ <code>type = App</code> ä¸<code>shapeFlag</code>,</p><p>é€šè¿‡é¢„å®šä¹‰çš„ <code>Symbol</code> åˆ¤æ–­å¯¹è±¡ç±»å‹, è¿›å…¥<code>default</code>,</p><p>é€šè¿‡ä½è¿ç®—åˆ¤æ–­ <code>shapeFlag</code> ç±»å‹, è¢«è¯†åˆ«ä¸ºç»„ä»¶ (è€Œä¸æ˜¯åƒ<code>h('p', &#123;&#125;, 'ä¸»é¡µ')</code> ä¸€æ ·çš„ Element) æ‰§è¡Œ<code>processComponent</code></p><ul><li><p>å•æ­¥è¿›å…¥ <code>processComponent</code>,</p><p>å‡½æ•°åšäº†ä¸€ä¸ªåˆ¤æ–­: å¦‚æœæ²¡æœ‰ <code>n1</code> å°±è®¤ä¸º <code>n2</code>è¿˜æ²¡æœ‰è¢«æŒ‚è½½å°±æŒ‚è½½ <code>n2</code> å¦åˆ™æ›´æ–° <code>n2</code></p><ul><li><p>å•æ­¥è¿›å…¥ <code>mountComponent</code>, å…¶æ¥æ”¶äº† <code>vnode</code>ä¸æŒ‚è½½ç‚¹</p><p>å°† <code>vnode</code> è½¬æ¢ä¸ºå®ä¾‹ <code>instance</code>, æ‰§è¡Œ<code>setupComponent</code> å¤„ç† <code>instance</code></p><ul><li><p>å•æ­¥è¿›å…¥ <code>setupComponent</code> å‘ç°å…¶åªæ˜¯å¤„ç†äº†<code>prop</code> ä¸ <code>slot</code> ç„¶åäº¤ç»™<code>setupStatefulComponent</code> ç»§ç»­é…ç½®</p><ul><li><p>å•æ­¥è¿›å…¥ <code>setupStatefulComponent</code>, å…¶æ¥æ”¶<code>instance</code></p><p>å°† <code>instance.ctx</code> é…ç½®äº†<code>PublicInstanceProxyHandlers</code> ä»£ç†(åé¢åˆ†æ)</p><p>æå– <code>Component = APP</code>, <code>setup = APP.setup</code></p><p>å¦‚æœ <code>setup</code> ä¸å­˜åœ¨å°±ç›´æ¥<code>finishComponentSetup</code></p><p>å¦åˆ™ç”¨ <code>setCurrentInstance</code> æ‰“æ ‡è®°, ä¸º <code>setup</code>ä¼ å…¥å‚æ•°å¹¶è·å–æ‰§è¡Œç»“æœ, æ‰§è¡Œ <code>handleSetupResult</code> å¤„ç†ç»“æœ</p><ul><li><p>å•æ­¥è¿›å…¥ <code>handleSetupResult</code> è¯¥å‡½æ•°å¯¹<code>setup</code> ç»“æœæ‰§è¡Œåˆ¤æ–­</p><p>å¦‚æœæ˜¯ <code>function</code> è¯´æ˜æ˜¯å¯¼å‡ºäº† <code>render</code> å‡½æ•°,å°† <code>render</code> èµ‹å€¼åˆ° <code>instance.render</code> ä¸Š</p><p>å¦åˆ™å¯¼å‡ºçš„å¯¹è±¡å­˜å…¥ <code>isntance.setupState</code></p><p>æœ€åæ‰§è¡Œ <code>finishComponentSetup</code> ä¸æ—  <code>setup</code>çš„æƒ…å†µæ±‡åˆ</p></li><li><p>å•æ­¥è¿›å…¥ <code>finishComponentSetup</code> å…¶æ¥æ”¶<code>instance</code></p><p>è‹¥ <code>instance</code> ä¸Šæ²¡æœ‰ <code>render</code> å°±å°è¯•ä»<code>template</code> ç¼–è¯‘ç»“æœä¸Šè·å–å¹¶å­˜å…¥<code>instrance.render</code></p></li></ul></li></ul></li><li><p>å•æ­¥è¿›å…¥ <code>setupRenderEffect</code> å‘ç°å…¶å®šä¹‰ç»‘å®šäº†ä¸€ä¸ª<code>componentUpdateFn</code> å‡½æ•°</p><ul><li><p>æ‰“æ–­ç‚¹å¹¶è¿›å…¥ <code>componentUpdateFn</code> å‡½æ•°</p><p>å¦‚æœç»„ä»¶æ²¡æœ‰è¢«æŒ‚è½½, è·å–å­èŠ‚ç‚¹, è·å– <code>instance</code> çš„ Proxy,æ„å»ºå­èŠ‚ç‚¹ <code>subTree</code> å¹¶é€’å½’ <code>patch</code>, å½“<code>patch</code> åˆ° Element æ—¶è°ƒç”¨ <code>processElement</code>æŒ‚è½½èŠ‚ç‚¹</p><p>å¦åˆ™æ›´æ–°èŠ‚ç‚¹(åé¢åˆ†æ)</p></li></ul></li></ul></li></ul></li></ul></li></ul></li></ol><p><strong>ç»„ä»¶æ›´æ–°è¿‡ç¨‹</strong></p><p>ä¸ºç»„ä»¶åˆ›å»ºå“åº”å¼å¹¶å°† <code>reavtive</code> å¯¼å‡ºåˆ°å…¨å±€</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'HelloWorld'</span><span class="token punctuation">,</span>  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    window<span class="token punctuation">.</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">tId</span><span class="token operator">:</span> <span class="token string">'helloWorld'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello world: count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ dev-tools ä¸­ä¿®æ”¹ <code>count.value</code> æ ¹æ®è¾“å‡ºæ¥è‡ª<code>effect.ts</code> è¿›å…¥æ–‡ä»¶å¹¶ä¸º <code>run</code> å‡½æ•°æ‰“ä¸Šæ–­ç‚¹,å†æ¬¡ä¿®æ”¹å€¼, å‘ç° <code>run</code> å‡½æ•°å®é™…ä¸Šå°±æ˜¯æ‰§è¡Œäº†å½“æ—¶çš„<code>componentUpdateFn</code>, ä¸º <code>componentUpdateFn</code>ä¸­å·²æŒ‚è½½çš„åˆ¤æ–­éƒ¨åˆ†æ‰“ä¸Šæ–­ç‚¹</p><ol type="1"><li><p>åœ¨æ–­ç‚¹å¤„æŸ¥çœ‹è°ƒç”¨æ ˆ, ç¡®å®šå‡½æ•°å°±æ˜¯å› ä¸º <code>ref</code>ä¿®æ”¹è€Œå¼•å‘çš„</p></li><li><p>åœ¨æ‰§è¡Œä¿®æ”¹å‰å…ˆåˆ¤æ–­æœ‰æ²¡æœ‰ <code>nextTrick</code> éœ€è¦æ‰§è¡Œ</p></li><li><p>è·å–æ–°èŠ‚ç‚¹çš„ <code>vnode</code></p></li><li><p>å°†è€èŠ‚ç‚¹å­æ ‘å¤åˆ¶åˆ°æ–°èŠ‚ç‚¹</p></li><li><p>è§¦å‘ç”Ÿå‘½å‘¨æœŸå‡½æ•°</p></li><li><p><code>patch</code> æ–°èŠ‚ç‚¹</p><p>å•æ­¥è¿›å…¥ <code>patch</code>, æ¥å—è€èŠ‚ç‚¹ <code>n1</code> æ–°èŠ‚ç‚¹<code>n2</code> è¿™æ¬¡æ›´æ–°çš„æ˜¯ä¸€ä¸ª Element äºæ˜¯è¿›å…¥<code>ShapeFlags.ELEMENT</code>, è¿›å…¥ <code>processElement</code></p><ul><li>å•æ­¥è¿›å…¥ <code>processElement</code>, è¿™æ¬¡è€èŠ‚ç‚¹å·²ç»æŒ‚è½½,ç›´æ¥èµ°æ›´æ–°ç¨‹åº<ul><li>å•æ­¥è¿›å…¥ <code>updateElement</code> è¯¥å‡½æ•°åˆ†åˆ«å¯¹æ¯”äº†<code>props</code> ä¸ å­èŠ‚ç‚¹å¹¶æ›´æ–°</li></ul></li></ul></li><li><p>è§¦å‘ç”Ÿå‘½å‘¨æœŸå‡½æ•°</p></li></ol><p><strong>æ€»ç»“</strong></p><pre class="mermaid">graph TBinit((åˆå§‹åŒ–ç»„ä»¶)) --> createAPp[å°†Appäº¤ç»™createApp, å°†AppåŒ…è£…ä¸ºvnode] --- norm1[å°†vnodeåº”ç”¨normalizeChildrené…ç½®, äº¤ç»™renderæ¸²æŸ“]  --> renderdispatch[renderç›´æ¥äº¤ç»™patch] --> check[patchæ£€æŸ¥ç±»å‹] --ä¸ºç»„ä»¶--> processComponent[äº¤ç»™processComponentåˆ¤æ–­çŠ¶æ€] --ä¸ºæ–°èŠ‚ç‚¹--> mountComponent[æ‰§è¡ŒmountComponentæŒ‚è½½vnode: æ„é€ instance, è¿è¡Œ setup, è·å– render] --> effect[æ³¨å†Œrenderçš„effect] --> run[æ‰§è¡Œeffect, æ£€æµ‹æ˜¯å¦æŒ‚è½½]  --æ²¡æœ‰--> patch2(é€’å½’patchå­èŠ‚ç‚¹)update((reactiveæ›´æ–°)) -.-> run[æ‰§è¡Œeffect, æ£€æµ‹æ˜¯å¦æŒ‚è½½] -.-æŒ‚è½½äº†-.-> newvnode[æ„é€ æ–°vnode, diffæ£€æŸ¥, å¤åˆ¶å±æ€§] -.-> patch2 ==> checkcheck ==ä¸ºElement==> mountDir(ç›´æ¥ä¿®æ”¹DOM)</pre><h2 id="å®ç°-reactivity">å®ç° Reactivity</h2><h3 id="ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º</h3><ul><li><p>ç›®å½•ç»“æ„</p><p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">.â”œâ”€â”€ jest.config.jsâ”œâ”€â”€ package.jsonâ”œâ”€â”€ packagesâ”‚Â Â  â””â”€â”€ reactivityâ”‚Â Â      â”œâ”€â”€ index.ts # å…¥å£æ–‡ä»¶â”‚Â Â      â””â”€â”€ __tests__ # æµ‹è¯•æ–‡ä»¶â”‚Â Â          â””â”€â”€ index.spec.tsâ”œâ”€â”€ README-EN.mdâ”œâ”€â”€ README.mdâ””â”€â”€ tsconfig.json # tsc --init<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>ä¾èµ–: <code>typescript</code> / <code>@types/node</code> /<code>jest</code> / <code>ts-jest</code> /<code>@types/jest</code></p></li></ul><h3 id="å®ç°åŸºæœ¬-effect-ä¸-reactive">å®ç°åŸºæœ¬ <code>effect</code> ä¸<code>reactive</code></h3><p><strong>TDD</strong></p><p>TDD(Test-Driven Development), æ˜¯æ•æ·å¼€å‘ä¸­çš„ä¸€é¡¹æ ¸å¿ƒå®è·µå’ŒæŠ€æœ¯,ä¹Ÿæ˜¯ä¸€ç§è®¾è®¡æ–¹æ³•è®º. TDDçš„åŸç†æ˜¯åœ¨å¼€å‘åŠŸèƒ½ä»£ç ä¹‹å‰,å…ˆç¼–å†™å•å…ƒæµ‹è¯•ç”¨ä¾‹ä»£ç , æµ‹è¯•ä»£ç ç¡®å®šéœ€è¦ç¼–å†™ä»€ä¹ˆäº§å“ä»£ç .TDDè™½æ˜¯æ•æ·æ–¹æ³•çš„æ ¸å¿ƒå®è·µ.</p><p><strong>å®ç°åŸºæœ¬çš„ <code>reactive</code></strong></p><p><strong>éœ€æ±‚</strong>: æœ€ç®€å•çš„ <code>reactive</code>,è¾“å…¥å¯¹è±¡å¹¶è¾“å‡ºå¯¹è±¡çš„ä»£ç†. ä»£ç†å¯¹è±¡ä¿®æ”¹æ—¶åŸå¯¹è±¡åŒæ­¥ä¿®æ”¹</p><ol type="1"><li>æµ‹è¯• <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Should different'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> origin <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> observed <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¾“å…¥å¯¹è±¡å¹¶è¿”å›ä»£ç†å¯¹è±¡</span>  <span class="token function">expect</span><span class="token punctuation">(</span>observed<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// observed å’ŒåŸæ¥çš„ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡</span>  observed<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>observed<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸¤è€…åŒæ­¥ä¿®æ”¹</span>  <span class="token function">expect</span><span class="token punctuation">(</span>origin<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å®ç° åªéœ€è¦ä¸ºå¯¹è±¡é…ç½®ä¸€ä¸ªæ™®é€šä»£ç† <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token parameter">origin</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// å°±æ˜¯ç»™ä¸€ä¸ªå¯¹è±¡, è¿”å›ä¸€ä¸ª new Proxy</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è¯­æ³•è§ https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/get</span>    <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token comment">// è¯­æ³•è§ https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/set</span>    <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> å”¯ä¸€çš„éš¾ç‚¹å°±æ˜¯<code>Proxy</code> è¯­æ³•</li><li>é‡æ„: æ— </li></ol><p><strong>å®ç°åŸºæœ¬çš„ <code>effect</code></strong></p><p><strong>éœ€æ±‚</strong>: 1. è¾“å…¥å‡½æ•°, æ‰§è¡Œå‡½æ•°, å½“å‡½æ•°ä¸­è¢«<code>[GET]</code> çš„å“åº”å¼å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°æ‰§è¡Œå‡½æ•° 2. è¿”å›ä¸€ä¸ªå‡½æ•°<code>runner</code>, å½“æ‰§è¡Œ <code>runner</code> æ—¶æ‰§è¡Œ<code>effect</code> ä¼ å…¥çš„å‡½æ•°</p><p><strong>éœ€æ±‚åˆ†æ</strong>: 1. ä¸ºä»€ä¹ˆæ˜¯å‡½æ•°ä¸­è¢« <code>[GET]</code>çš„å“åº”å¼å¯¹è±¡å˜åŒ–æ—¶é‡æ–°æ‰§è¡Œå‡½æ•°, <code>[SET]</code> ä¸è¡Œå—? ä¸è¡Œ,å“åº”å¼å¯¹è±¡è¢« <code>[SET]</code> åå¦‚æœæ‰§è¡Œäº†å‡½æ•°, å“åº”å¼å¯¹è±¡ä¼šè¢«é‡æ–°<code>[SET]</code>, é‚£ä¹ˆä¸Šä¸€æ¬¡ <code>[SET]</code> å°±æ²¡ç”¨äº†.åŒæ—¶å¦‚æœå‡½æ•°ä¸­å…¶ä»–å˜é‡ä¸å˜åªæœ‰å“åº”å¼å¯¹è±¡è¢« <code>[SET]</code>æ­¤æ—¶æ‰§è¡Œå‡½æ•°å¹¶ä¸ä¼šä½¿å¾—å‡½æ•°ä¸­å˜é‡å€¼å‘ç”Ÿå˜åŒ–(æ¯•ç«Ÿå˜åŒ–çš„å“åº”å¼å˜é‡æ²¡æœ‰è¢«<code>[GET]</code>), ä¸ä¼šäº§ç”Ÿ sideEffect. 2. æ‰§è¡Œæµç¨‹: å¼€å§‹æ‰§è¡Œå‡½æ•°-&gt; <code>[GET]</code> å“åº”å¼å¯¹è±¡ -&gt; ç»“æŸæ‰§è¡Œå‡½æ•° -&gt;å½“å“åº”å¼å¯¹è±¡è¢« <code>[SET]</code> -&gt; æ‰§è¡Œå‡½æ•°å¯ä»¥å‘ç°åªéœ€è¦è®©å“åº”å¼å¯¹è±¡çŸ¥é“å½“è‡ªå·±å˜åŒ–æ—¶å“ªäº› <code>effect</code>éœ€è¦æ‰§è¡Œå°±å¯ä»¥äº†, è‡³äº <code>effect</code>çŸ¥ä¸çŸ¥é“å“åº”å¼å¯¹è±¡æ˜¯è°é‚£æ— æ‰€è°“. å¯ä»¥åœ¨å‡½æ•°æ‰§è¡ŒæœŸé—´æ‰§è¡Œä¾èµ–æ”¶é›†, ä¸º<code>[GET]</code> çš„å“åº”å¼å¯¹è±¡æ³¨å†Œ Effect Function,åœ¨å“åº”å¼å¯¹è±¡ä¿®æ”¹æ—¶æ‰§è¡Œå…¶æ³¨å†Œçš„ Effect Function.</p><p>Â </p><ol type="1"><li>æµ‹è¯•: <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Effect test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Should sync'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> origin <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> observed <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> bar<span class="token punctuation">;</span>    <span class="token keyword">const</span> runner <span class="token operator">=</span> <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      bar <span class="token operator">=</span> observed<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">expect</span><span class="token punctuation">(</span>observed<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// origin -> observed</span>    <span class="token function">expect</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç«‹å³æ‰§è¡Œ fn</span>    observed<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// ä¿®æ”¹æœ‰ [GET] çš„å“åº”å¼å¯¹è±¡</span>    <span class="token function">expect</span><span class="token punctuation">(</span>observed<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å“åº”å¼å¯¹è±¡å˜åŒ–</span>    <span class="token function">expect</span><span class="token punctuation">(</span>origin<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åŸå¯¹è±¡å˜åŒ–</span>    <span class="token function">expect</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‰§è¡Œå‡½æ•°</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Should return runner'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> origin <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> observed <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span>info <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åŠ«æŒ console.info</span>    <span class="token keyword">let</span> bar<span class="token punctuation">;</span>    <span class="token keyword">const</span> runner <span class="token operator">=</span> <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'I RUN'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      bar <span class="token operator">=</span> observed<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">expect</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>info<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç«‹å³æ‰§è¡Œ fn, console.info è¢«è°ƒç”¨ 1 æ¬¡</span>    observed<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token function">expect</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>info<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalledTimes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å“åº”å¼å¯¹è±¡å‘ç”Ÿå˜åŒ–æ‰§è¡Œ fn, console.info è¢«è°ƒç”¨ 2 æ¬¡</span>    <span class="token function">runner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‰‹åŠ¨è°ƒç”¨ runner, console.info è¢«è°ƒç”¨ 3 æ¬¡</span>    <span class="token function">expect</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>info<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalledTimes</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å®ç° åˆ©ç”¨ <code>targetMap</code> å®ç°å“åº”å¼å¯¹è±¡ -&gt; Key -&gt;Effective Function çš„æ˜ å°„. å¯¼å‡º <code>track</code> ä¸<code>trigger</code> ç”¨äºæ”¶é›†ä¸è§¦å‘ä¾èµ– <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// target: Object => keyMap:(string=>Set)</span><span class="token comment">// keyMap: string => Set</span><span class="token keyword">const</span> <span class="token literal-property property">targetMap</span><span class="token operator">:</span> Map<span class="token operator">&lt;</span>any<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> Set<span class="token operator">&lt;</span>EffectReactive<span class="token operator">>>></span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> <span class="token literal-property property">activeEffectFn</span><span class="token operator">:</span> any <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">EffectReactive</span> <span class="token punctuation">&#123;</span>  <span class="token function-variable function">runner</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> any<span class="token punctuation">;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">public</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>runner <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    activeEffectFn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token comment">// å…¨å±€æ³¨å†Œå½“å‰æ­£åœ¨æ”¶é›†ä¾èµ–çš„ Effect</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‰§è¡Œå‡½æ•°</span>    activeEffectFn <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// å–æ¶ˆæ³¨å†Œ</span>  <span class="token punctuation">&#125;</span>  <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">effect</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è€ƒè™‘åˆ° effect ä¸ŠåŠ¨ä½œå¾ˆå¤š, æˆ‘ä»¬å°†å…¶æŠ½ç¦»ä¸º EffectFunction å‡½æ•°</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">EffectReactive</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">.</span>runner<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// ä¾èµ–æ”¶é›†å‡½æ•°, ç”± `[GET]` è§¦å‘, è¯¥å‡½æ•°æ£€æŸ¥æ˜¯å¦æœ‰ active çš„ Effect, æœ‰å°±æ”¶é›†ä¾èµ–</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">track</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>activeEffect<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>targetMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> targetMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> keyMap <span class="token operator">=</span> targetMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>keyMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> keyMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> dependenceEffect <span class="token operator">=</span> keyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span>  dependenceEffect<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>activeEffect<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// è§¦å‘å‡½æ•°, å½“å“åº”å¼å¯¹è±¡è¢« `[SET]` æ—¶å°è¯•è§¦å‘å…¶æ”¶é›†çš„æ‰€æœ‰ Effect</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> keyMap <span class="token operator">=</span> targetMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>keyMap<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> depSet <span class="token operator">=</span> keyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>depSet<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token punctuation">[</span><span class="token operator">...</span>depSet<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> åœ¨<code>Proxy</code> ä¸ŠåŒæ­¥ä¿®æ”¹ <pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">export function reactive(origin) &#123;  return new Proxy(origin, &#123;    get(target, key, receiver) &#123;+     track(target, key);      return Reflect.get(target, key, receiver);    &#125;,    set(target, key, value, receiver) &#123;+     &#x2F;&#x2F; è¿™ä¸¤è¡Œé¡ºåºåäº†å°±å¯„äº†      const res &#x3D; Reflect.set(target, key, value, receiver);+     trigger(target, key);      return res;    &#125;,  &#125;);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>é‡æ„: ä¸Šé¢è¿™ä¸ªä»£ç æœ‰ç‚¹é—®é¢˜, æˆ‘ä»¬åªåœ¨æ„é€  EffectFunctionæ—¶æ”¶é›†äº†ä¾èµ–, ä½†æ˜¯å¹¶ä¸èƒ½æ”¶é›†å…¨ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'dym track'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> origin1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> observe1 <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>origin1<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> origin2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> observe2 <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>origin2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>    ob <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cnt <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      ob <span class="token operator">=</span> observe1<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      ob <span class="token operator">=</span> observe2<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    cnt<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>ob<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  observe1<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>ob<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  observe2<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>ob<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> è¿™ä¸ªæµ‹è¯•å°±æ— æ³•é€šè¿‡, å› ä¸º<code>observe2</code> ç†è®ºä¸Šåº”è¯¥åœ¨ <code>observe1.set</code> è°ƒç”¨<code>run</code> çš„æ—¶å€™æ”¶é›†ä¾èµ–, æ‰€ä»¥åº”è¯¥ä¿®æ”¹æ„é€ å‡½æ•°å’Œ <code>run</code>ä¸º <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">public</span> fn<span class="token punctuation">,</span> <span class="token literal-property property">options</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ...</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  activeEffect <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  activeEffect <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> res<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> æˆ‘ä»¬çŸ¥é“, æ‰€æœ‰çš„ä¾èµ–æ”¶é›†éƒ½æ˜¯é€šè¿‡ fn ä¸­å¯¹ reactive çš„<code>[GET]</code> å®ç°çš„, æˆ‘å¯ä»¥ä¿è¯åªè¦æ‰§è¡Œ <code>fn</code>åœ¨å…¶å‰åéƒ½åŠ å…¥äº†ä¾èµ–æ”¶é›†çš„ flag å°±å¯ä»¥. è°ƒç”¨ <code>fn</code>åªå¯èƒ½å‘ç”Ÿåœ¨</li><li>æ„é€ å‡½æ•°</li><li>æ‰‹åŠ¨æ‰§è¡Œ <code>runner</code></li><li>reactive æ‰§è¡Œ <code>[SET]</code> è§¦å‘ trigger</li></ol><p>è¿™ä¸‰éƒ¨åˆ†è¦æ‰§è¡Œçš„éƒ½æ˜¯ <code>run</code> æˆ‘ä»¬å¯ä»¥ä¿è¯åªè¦æ‰§è¡Œ<code>run</code> å°±è§¦å‘ä¾èµ–æ”¶é›†</p><h3 id="å®ç°-effect-çš„-scheduler-é€‰é¡¹-watch">å®ç° <code>effect</code> çš„<code>scheduler</code> é€‰é¡¹ (<code>watch</code>)</h3><p><strong>éœ€æ±‚</strong>: ä¸º <code>effect</code> ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°,å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡, å…¶ä¸­åŒ…å« <code>scheduler</code> å‡½æ•°, å½“æ„é€  Effectæ—¶æ‰§è¡Œä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‡½æ•°å‚æ•°, å½“å“åº”å¼å‡½æ•°å˜åŒ–æ—¶æ‰§è¡Œ<code>scheduler</code> å‡½æ•°. è¿™ä¸ Vue 3 çš„ <code>watch</code> ç±»ä¼¼</p><p><strong>éœ€æ±‚åˆ†æ</strong>: åœ¨æ„é€  Effectçš„æ—¶å€™ä¼ å…¥é…ç½®å¹¶åœ¨è§¦å‘çš„æ—¶å€™åˆ¤æ–­æ˜¯å¦æœ‰ <code>scheduler</code> å‡½æ•°</p><ol type="1"><li>æµ‹è¯•</li></ol><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Shound run scheduler'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> origin <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> observed <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> bar<span class="token punctuation">;</span>  <span class="token function">effect</span><span class="token punctuation">(</span>    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      bar <span class="token operator">=</span> observed<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span> <span class="token comment">// ä¼ å…¥é…ç½®</span>      <span class="token function">scheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        bar <span class="token operator">=</span> <span class="token operator">-</span>observed<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç¬¬ä¸€æ¬¡è¿è¡Œ fn å‡½æ•°</span>  observed<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç¬¬äºŒæ¬¡è¿è¡Œ scheduler å‡½æ•°</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><ol start="2" type="1"><li>å®ç°</li></ol><ul><li>ä¿®æ”¹ effect å‡½æ•°, åŠ å…¥é…ç½®é¡¹ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">effect</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">EffectReactive</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">.</span>runner<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li>ä¿®æ”¹ EffectReactive çš„æ„é€ å‡½æ•°åŠ è½½é…ç½®é¡¹ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">EffectReactive</span> <span class="token punctuation">&#123;</span>  <span class="token function-variable function">runner</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> any<span class="token punctuation">;</span>  <span class="token function-variable function">scheduler</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> any <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">public</span> fn<span class="token punctuation">,</span> <span class="token literal-property property">options</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>scheduler <span class="token operator">=</span> options<span class="token punctuation">.</span>scheduler<span class="token punctuation">;</span>    <span class="token comment">// ...</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>ä¿®æ”¹è§¦å‘å‡½æ•° <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ...</span>  <span class="token punctuation">[</span><span class="token operator">...</span>depSet<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>d<span class="token punctuation">.</span>scheduler <span class="token operator">?</span> d<span class="token punctuation">.</span><span class="token function">scheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> d<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li>é‡æ„: æ— </li></ul><p><strong>ä»€ä¹ˆæ—¶å€™å°è¯•æŠ½ç¦»å‡½æ•° / å¯¹è±¡</strong></p><ol type="1"><li>å‡½æ•°ä¸Šæœ‰å¾ˆå¤šåŠ¨ä½œ</li><li>å‡½æ•°ä½œç”¨èŒƒå›´å¹¿, è¯­ä¹‰å·®</li></ol><h3 id="å®ç°-effect-çš„-stop-ä¸-onstop-é€‰é¡¹">å®ç° <code>effect</code> çš„<code>stop</code> ä¸ <code>onStop</code> é€‰é¡¹</h3><p><strong>éœ€æ±‚</strong>: 1. å®šä¹‰ä¸€ä¸ªå¤–éƒ¨å‡½æ•° <code>stop</code>. ä¼ å…¥<code>runner</code> è®© <code>runner</code> ä¸å†è¢«å“åº”å¼å¯¹è±¡ trigger 2.<code>effect</code> ä¸­åŠ å…¥ <code>onStop</code> é…ç½®, åœ¨<code>stop</code> æ—¶è°ƒç”¨</p><p><strong>éœ€æ±‚åˆ†æ</strong>: åªéœ€è¦å°† EffectFunctionä»å“åº”å¼å¯¹è±¡çš„ä¾èµ–è¡¨ä¸­åˆ é™¤å³å¯. ä½†æ˜¯æˆ‘ä»¬ä¹‹å‰å°±æ²¡è®°å½•æœ‰å“ªäº›å“åº”å¼å¯¹è±¡å°†EffectFunction ä½œä¸ºä¾èµ–..., æ‰€ä»¥éœ€è¦å¼€ä¸€ä¸ª Set è®°å½•è¿™äº›å“åº”å¼å¯¹è±¡. åŒæ—¶,æˆ‘ä»¬ä¸éœ€è¦è®°å½•ä¾èµ–çš„å¯¹è±¡æ˜¯ä»€ä¹ˆ, åªéœ€è¦è®°å½• KeyMap å¯¹åº”çš„ Set.</p><ol type="1"><li>æµ‹è¯• <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Should stop trigger'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> origin <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> observed <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> bar<span class="token punctuation">;</span>  <span class="token keyword">const</span> runner <span class="token operator">=</span> <span class="token function">effect</span><span class="token punctuation">(</span>    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      bar <span class="token operator">=</span> observed<span class="token punctuation">.</span>foo<span class="token punctuation">;</span> <span class="token comment">// ç«‹å³æ‰§è¡Œ</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span>      <span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>bar <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> bar <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// å¦‚æœé¦–æ¬¡è°ƒç”¨ç½® 0</span>        bar<span class="token operator">--</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç«‹å³æ‰§è¡Œ</span>  <span class="token function">stop</span><span class="token punctuation">(</span>runner<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åœæ­¢åç¬¬ä¸€æ¬¡æ‰§è¡Œä¸º -1</span>  observed<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// reactive å˜åŒ–ä¹Ÿä¸è°ƒç”¨ fn</span>  <span class="token function">stop</span><span class="token punctuation">(</span>runner<span class="token punctuation">)</span>  <span class="token function">expect</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åå¤ stop ä¸åå¤æ‰§è¡Œ onStop</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å®ç° ä¿®æ­£ EffectReactive <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">EffectReactive</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">runner</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token comment">// effect åªè¿”å› runner, stop å‡½æ•°éœ€è¦æ ¹æ® runner æ‰¾åˆ° EffectReactive, æ‰€ä»¥è¦åœ¨å‡½æ•°ä¸ŠåŠ ä¸€ä¸ªå±æ€§è®°å½•ä¸€ä¸‹</span>    <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> any<span class="token punctuation">;</span>    effect<span class="token operator">?</span><span class="token operator">:</span> EffectReactive<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token function-variable function">onStop</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> any <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// stop å›è°ƒ</span>  <span class="token literal-property property">deps</span><span class="token operator">:</span> Set<span class="token operator">&lt;</span>Set<span class="token operator">&lt;</span>EffectReactive<span class="token operator">>></span><span class="token punctuation">;</span> <span class="token comment">// æ”¶é›†äº†è¿™ä¸ªå‡½æ•°ä¾èµ–çš„å˜é‡çš„ä¾èµ–è¡¨é›†åˆ</span>  <span class="token literal-property property">active</span><span class="token operator">:</span> boolean<span class="token punctuation">;</span> <span class="token comment">// EffectReactive æ˜¯å¦è¿è¡Œ (stop æ—¶ç½® 0)</span>  <span class="token comment">// ...</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">public</span> fn<span class="token punctuation">,</span> <span class="token literal-property property">options</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>runner <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>runner<span class="token punctuation">.</span>effect <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>onStop <span class="token operator">=</span> options<span class="token punctuation">.</span>onStop<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token comment">// ...</span>  <span class="token punctuation">&#125;</span>  <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å¦‚æœç”¨æˆ·æ‰‹åŠ¨æ‰§è¡Œ runner é‚£ä¹ˆåªæ‰§è¡Œ fn, ä¸è¿½è¸ªä¾èµ–, æ”¾ç½®ä¾èµ–è¿½è¸ªç»™å·²ç»è§£é™¤ä¾èµ–çš„å…ƒç´ å†ç»‘å®šä¸Šä¾èµ–</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>active<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    activeEffect <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    activeEffect <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> res<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> ä¿®æ­£ä¾èµ–æ”¶é›†å‡½æ•°<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">track</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//</span>  dependenceEffect<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>activeEffect<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¸ºå½“å‰æ­£åœ¨ä¾èµ–æ”¶é›†çš„ effect çš„ä¾èµ–ä¸ŠåŠ å…¥è¿™ä¸ª key çš„ä¾èµ–è¡¨</span>  activeEffect<span class="token punctuation">.</span>deps<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>dependenceEffect<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> å®ç° <code>stop</code> å‡½æ•° <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token parameter">runner</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ä¸åå¤æ‰§è¡Œ</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>runner<span class="token punctuation">.</span>effect<span class="token punctuation">.</span>active<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>  runner<span class="token punctuation">.</span>effect<span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token comment">// æ‰¾åˆ°æ‰€æœ‰æ”¶é›†è¿‡ effect çš„å˜é‡, å°† effect ä»ä¾èµ–è¡¨ä¸­åˆ é™¤</span>  <span class="token punctuation">[</span><span class="token operator">...</span>runner<span class="token punctuation">.</span>effect<span class="token punctuation">.</span>deps<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>runner<span class="token punctuation">.</span>effect<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æ‰§è¡Œ onStop</span>  runner<span class="token punctuation">.</span>effect<span class="token punctuation">.</span>onStop <span class="token operator">&amp;&amp;</span> runner<span class="token punctuation">.</span>effect<span class="token punctuation">.</span><span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>é‡æ„: æ— </li></ol><h3 id="å®ç°-proxy-çš„-readonly">å®ç° <code>Proxy</code> çš„<code>Readonly</code></h3><p><strong>éœ€æ±‚</strong>: <code>readonly</code> ä¸ <code>reactive</code>ç±»ä¼¼, ä¸è¿‡ä¸æ”¯æŒ <code>set</code></p><p><strong>éœ€æ±‚åˆ†æ</strong>: ä¸€ä¸ªå…ƒç´ ä¸æ”¯æŒ <code>set</code>ä¹Ÿå°±ä¸å¯èƒ½è§¦å‘ä¾èµ–, æ‰€ä»¥ä¹Ÿæ²¡æœ‰å¿…è¦åšä¾èµ–æ”¶é›†. æ‰€ä»¥åªéœ€è¦ç²¾ç®€ä¸€ä¸‹<code>reactive</code>. å¯ä»¥å‘ç°,ä¸åŒæƒé™çš„å˜é‡åªæ˜¯åœ¨æ„é€ çš„æ—¶å€™é‡‡ç”¨ä¸åŒçš„ <code>[GET]</code> ä¸<code>[SET]</code> ç­–ç•¥. å¯ä»¥å°† <code>[GET]</code> ä¸ <code>[SET]</code>æŠ½ç¦»å‡ºæ¥</p><ol type="1"><li>æµ‹è¯• <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Happy path'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> origin <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> observed <span class="token operator">=</span> <span class="token function">readonly</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span>warn <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>observed<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†åŸå§‹å¯¹è±¡åŒ…è£…ä¸ºåªè¯»å¯¹è±¡</span>  <span class="token function">expect</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>warn<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æœ€å¼€å§‹ä¸æŠ¥é”™</span>  observed<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// ä¿®æ”¹, é™é»˜å¤±æ•ˆ, æŠ¥ warning</span>  <span class="token function">expect</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>warn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// warning è¢«è°ƒç”¨ä¸€æ¬¡</span>  <span class="token function">expect</span><span class="token punctuation">(</span>observed<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// readOnly é™é»˜å¤±æ•ˆ</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å®ç° æŠ½ç¦» <code>[GET]</code> ä¸ <code>[SET]</code> <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// reactive çš„ [GET]</span><span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">track</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// reactive çš„ [SET]</span><span class="token keyword">function</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">trigger</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> res<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">getReadonly</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">setReadonly</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Can not set readonly'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è¦è¿”å›ä¸€ä¸‹è®¾ç½®ç»“æœ, å¦‚æœè¿”å› false ä¼šæŠ›å‡ºå¼‚å¸¸, è€Œæˆ‘ä»¬åªå¸Œæœ›é™é»˜å¤±æ•ˆ</span>  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">const</span> proxyConfig <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  get<span class="token punctuation">,</span>  set<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> proxyReadonlyConfig <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">get</span><span class="token operator">:</span> getReadonly<span class="token punctuation">,</span>  <span class="token literal-property property">set</span><span class="token operator">:</span> setReadonly<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>æŠ½ç¦»å¯¹è±¡åˆ›å»ºå‡½æ•° <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">createReactiveObject</span><span class="token punctuation">(</span><span class="token parameter">origin<span class="token punctuation">,</span> readonly <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>readonly<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> proxyReadonlyConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> proxyConfig<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre> é‡å†™ <code>reactive</code> å®ç°<code>readonly</code> <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token parameter">origin</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token function">createReactiveObject</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">readonly</span><span class="token punctuation">(</span><span class="token parameter">origin</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token function">createReactiveObject</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>é‡æ„: ä¸Šé¢çš„å°±æ˜¯é‡æ„åçš„ä»£ç </li></ol><h3 id="å®ç°å·¥å…·å‡½æ•°-isreadonly-isreactive-isproxy">å®ç°å·¥å…·å‡½æ•°<code>isReadonly</code>, <code>isReactive</code>,<code>isProxy</code></h3><p><strong>éœ€æ±‚</strong>: å®ç°å·¥å…·å‡½æ•°, <code>isReadonly</code>,<code>isReactive</code>, <code>isProxy</code>(å‰ä¸¤ä¸ªå‡½æ•°äºŒé€‰ä¸€).</p><p><strong>éœ€æ±‚åˆ†æ</strong>: åªéœ€è¦åœ¨ <code>[GET]</code> ä¸Šç‰¹åˆ¤å³å¯</p><ol type="1"><li>æµ‹è¯• <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'isReadonly test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> origin <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> observed <span class="token operator">=</span> <span class="token function">readonly</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isReadonly</span><span class="token punctuation">(</span>observed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isReactive</span><span class="token punctuation">(</span>observed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'isReactive test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> origin <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> observed <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isReadonly</span><span class="token punctuation">(</span>observed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isReactive</span><span class="token punctuation">(</span>observed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'isProxy test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> origin <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> observed <span class="token operator">=</span> <span class="token function">readonly</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isProxy</span><span class="token punctuation">(</span>observed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å®ç° æ„é€ ä¸ªæšä¸¾ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token keyword">enum</span> ReactiveFlag <span class="token punctuation">&#123;</span>  <span class="token constant">IS_REACTIVE</span> <span class="token operator">=</span> <span class="token string">'__v_isReactive'</span><span class="token punctuation">,</span>  <span class="token constant">IS_READONLY</span> <span class="token operator">=</span> <span class="token string">'__v_isReadonly'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre> å®ç°å‡½æ•° <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isReactive</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è¦è½¬ä¸€ä¸‹ Boolean å› ä¸ºé reactive å¯¹è±¡ä¼šè¿”å› undefined</span>  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span>value<span class="token punctuation">[</span>ReactiveFlag<span class="token punctuation">.</span><span class="token constant">IS_REACTIVE</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isReadonly</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span>value<span class="token punctuation">[</span>ReactiveFlag<span class="token punctuation">.</span><span class="token constant">IS_READONLY</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isProxy</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token function">isReactive</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isReadonly</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> ä¿®æ”¹<code>[GET]</code> <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> reactiveFlags <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token punctuation">[</span>ReactiveFlag<span class="token punctuation">.</span><span class="token constant">IS_REACTIVE</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token punctuation">[</span>ReactiveFlag<span class="token punctuation">.</span><span class="token constant">IS_READONLY</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> readonlyFlags <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token punctuation">[</span>ReactiveFlag<span class="token punctuation">.</span><span class="token constant">IS_REACTIVE</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token punctuation">[</span>ReactiveFlag<span class="token punctuation">.</span><span class="token constant">IS_READONLY</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>reactiveFlags<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token operator">=></span>d<span class="token operator">===</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> reactiveFlags<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">getReadonly</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>readonlyFlags<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token operator">=></span>d<span class="token operator">===</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> readonlyFlags<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>é‡æ„: æ— </li></ol><h3 id="å®ç°-reactive-readonly-åµŒå¥—">å®ç° <code>reactive</code> /<code>readonly</code> åµŒå¥—</h3><p><strong>éœ€æ±‚:</strong> è‹¥ <code>reactive</code> /<code>readonly</code> å†…éƒ¨ value ä¸ºå¯¹è±¡, é‚£ä¹ˆè¯¥å¯¹è±¡ä¹Ÿåº”è¯¥æ˜¯<code>reactive</code> / <code>readonly</code></p><p><strong>éœ€æ±‚åˆ†æ:</strong> æˆ‘æœ€å¼€å§‹çš„æƒ³æ³•æ˜¯åœ¨æ„é€ <code>reactive</code> çš„æ—¶å€™éå†æ‰€æœ‰å±æ€§, ç„¶åä¸ºè¿™äº›å±æ€§é…ç½®<code>reactive</code>. ç„¶è€Œ, è¿™æ— æ³•å°†åŠ¨æ€æ·»åŠ çš„å¯¹è±¡è½¬ä¸º<code>reactive</code>. è€ƒè™‘éœ€æ±‚, æˆ‘ä»¬å¸Œæœ›è®©å†…å±‚å¯¹è±¡æ”¯æŒ reactive,å®é™…ä¸Šæ˜¯å¸Œæœ›è®©å†…å±‚å¯¹è±¡ä¹Ÿæ”¯æŒä¾èµ–æ”¶é›†ç­‰ <code>reactive</code> åŠŸèƒ½,è€Œè¿™äº›åŠŸèƒ½éƒ½æ˜¯åœ¨å¯¹è±¡è¢« <code>[GET]</code> çš„æ—¶å€™è¢«æ¿€æ´»çš„.ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æœ€æ™šå¯ä»¥åœ¨é¦–æ¬¡è®¿é—®å±æ€§çš„å°†å†…å±‚å¯¹è±¡è½¬æ¢ä¸º<code>reactive</code>.</p><ol type="1"><li>æµ‹è¯•(åªå†™äº† <code>reactive</code> çš„) <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Should nested track'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> origin <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token literal-property property">bar</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> observe <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isReactive</span><span class="token punctuation">(</span>observe<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isReactive</span><span class="token punctuation">(</span>observe<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isReactive</span><span class="token punctuation">(</span>observe<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isReactive</span><span class="token punctuation">(</span>observe<span class="token punctuation">.</span>bar<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å®ç° åªéœ€è¦åœ¨ <code>[GET]</code> çš„æ—¶å€™åˆ¤æ–­å±æ€§æ˜¯å¦æ˜¯å¯¹è±¡,å¦‚æœæ˜¯å¯¹è±¡é‚£ä¹ˆè¿”å›åŒ…è£…åçš„ <code>reactive</code></li></ol><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>reactiveFlags<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d <span class="token operator">===</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> reactiveFlags<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–ç»“æœ</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">reactive</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¦‚æœç»“æœæ˜¯å¯¹è±¡, å°†å…¶åŒ…è£…ä¸º reactive</span>  <span class="token function">track</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> res<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">getReadonly</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>readonlyFlags<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d <span class="token operator">===</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> readonlyFlags<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–ç»“æœ</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">readonly</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¦‚æœç»“æœæ˜¯å¯¹è±¡, å°†å…¶åŒ…è£…ä¸º readonly</span>  <span class="token keyword">return</span> res<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> åœ¨ <code>packages/share/index.ts</code>ä¸­æ„é€ å·¥å…·å‡½æ•°åˆ¤æ–­è¾“å…¥æ˜¯å¦æ˜¯å¯¹è±¡ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isObject</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> v <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> v <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre> 3. æ”¹è¿›:æˆ‘ä»¬å¹¶æ²¡æœ‰å®ç°å†…å±‚ reactive çš„æŒä¹…åŒ–, ä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡ reactiveçš„ç»“æœæ˜¯ä¸åŒçš„... å®ç°å†…å±‚å¯¹è±¡æŒä¹…åŒ– <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> reactiveMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> readonlyMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token parameter">origin</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>reactiveMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">)</span>    reactiveMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> <span class="token function">createReactiveObject</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> reactiveMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">readonly</span><span class="token punctuation">(</span><span class="token parameter">origin</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>readonlyMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">)</span>    readonlyMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> <span class="token function">createReactiveObject</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> readonlyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>æ³¨æ„</strong></p><ol type="1"><li><strong>JSæ˜¯åŠ¨æ€è¯­è¨€, ä¸è¦å°è¯•åšé™æ€ä»£ç åˆ†æ</strong>:æˆ‘ä»¬åœ¨å®ç°åŠŸèƒ½çš„æ—¶å€™åº”è¯¥è€ƒè™‘ä»€ä¹ˆæ—¶å€™å®Œæˆå·¥ä½œä¸æ™š,ä¸é—æ¼è€Œä¸æ˜¯ç›¸é™æ€è¯­è¨€ä¸€æ ·æƒ³ä»€ä¹ˆæ—¶å€™å¯ä»¥æ“ä½œæ•°æ®</li><li><strong>å®ç°åŠŸèƒ½æ—¶æƒ³æƒ³è¿™ä¸ªåŠŸèƒ½å¸Œæœ›æˆ‘ä»¬å¯¹å¤–è¡¨ç°ä¸ºä»€ä¹ˆæ ·å­</strong>:æ€è€ƒæ˜¯ä»€ä¹ˆè€Œä¸æ˜¯æ€ä¹ˆåš, æ¯”å¦‚å†…å±‚ reactiveçš„ç¬¬ä¸€ç‰ˆä»£ç å¹¶æ²¡æœ‰å®ç°å°†å¯¹è±¡è½¬ä¸º reactive å¹¶é™„ç€åœ¨å¯¹è±¡ä¸Š,è€Œæ˜¯è€ƒè™‘å¦‚æœä¸€ä¸ªå†…å±‚å¯¹è±¡æ˜¯ reactive, é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥åœ¨ <code>[GET]</code>çš„æ—¶å€™è¡¨ç°çš„ä¸åŸå§‹å¯¹è±¡ä¸åŒ. è¿™å°±å¯å‘æˆ‘ä»¬åªéœ€è¦åœ¨ <code>[GET]</code>çš„æ—¶å€™å¤„ç†æ•°æ®å°±å¯ä»¥è€Œä¸éœ€è¦åœ¨æ„é€ å¯¹è±¡çš„æ—¶å€™å®ç°è¿™ä¸€åŠŸèƒ½.</li></ol><h3 id="å®ç°-shadowreadonly">å®ç° <code>shadowReadonly</code></h3><p><strong>éœ€æ±‚:</strong> <code>shadowReadonly</code>å°±æ˜¯åªå¯¹å¯¹è±¡å¤–å±‚å®ç° readonly, å†…éƒ¨å¯¹è±¡ä¸ç®¡, ä¸ Proxy</p><p><strong>éœ€æ±‚åˆ†æ:</strong> å®é™…ä¸Šå°±æ˜¯ä¸æ”¯æŒåµŒå¥—çš„ readonly</p><ol type="1"><li>æµ‹è¯• <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Happy path'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> origin <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">bar</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> observed <span class="token operator">=</span> <span class="token function">shadowReadonly</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span>warn <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>warn<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  observed<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// å¤–å±‚ç¦æ­¢ä¿®æ”¹</span>  <span class="token function">expect</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>warn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>observed<span class="token punctuation">.</span>foo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  observed<span class="token punctuation">.</span>foo<span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// å†…éƒ¨ä¸ç®¡</span>  <span class="token function">expect</span><span class="token punctuation">(</span>observed<span class="token punctuation">.</span>foo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>warn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isProxy</span><span class="token punctuation">(</span>observed<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å®ç° <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">getShadowReadonly</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>readonlyFlags<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d <span class="token operator">===</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> readonlyFlags<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// å…¶å®å°±æ˜¯ä¸æ”¯æŒåµŒå¥—è¿½è¸ªçš„ readonly. shadowReadonly çš„å…ƒç´ ä¸€å®šæ˜¯é reactive å¯¹è±¡, æ‰€ä»¥ç›´æ¥è¿”å›</span>  <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">const</span> proxyShadowReadonlyConfig <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">get</span><span class="token operator">:</span> getShadowReadonly<span class="token punctuation">,</span>  <span class="token literal-property property">set</span><span class="token operator">:</span> setReadonly<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> å®ç° shadowReadonly <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> shadowReadonlyMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">createReactiveObject</span><span class="token punctuation">(</span><span class="token parameter">origin<span class="token punctuation">,</span> readonly <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> shadow <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>shadow <span class="token operator">&amp;&amp;</span> readonly<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> proxyShadowReadonlyConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>readonly<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> proxyReadonlyConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> proxyConfig<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">shadowReadonly</span><span class="token punctuation">(</span><span class="token parameter">origin</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>shadowReadonlyMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">)</span>    shadowReadonlyMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> <span class="token function">createReactiveObject</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> shadowReadonlyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>é‡æ„</li></ol><h3 id="å®ç°-ref">å®ç° <code>ref</code></h3><p><strong>éœ€æ±‚</strong>: å®ç° <code>ref</code> - å¦‚æœ<code>ref(value)</code> è¾“å…¥çš„æ˜¯ä¸æ˜¯å¯¹è±¡, é‚£ä¹ˆå¯ä»¥ - é€šè¿‡<code>.value</code> è®¿é—®å€¼ - é€šè¿‡ <code>.value</code> æ›´æ–°å€¼,å¦‚æœèµ‹å€¼æ—¶æ–°å€¼ä¸æ—§å€¼ä¸€æ ·åˆ™ä»€ä¹ˆéƒ½ä¸åš - æ”¯æŒç±»ä¼¼ <code>reactive</code>çš„ä¾èµ–æ”¶é›†ä¸è§¦å‘ - å¦‚æœ <code>ref(value)</code> è¾“å…¥çš„æ˜¯å¯¹è±¡, é‚£ä¹ˆå¯ä»¥ -åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šå¯¹è¦æ±‚å¯¹è±¡æ”¯æŒ <code>reactive</code></p><p><strong>éœ€æ±‚åˆ†æ</strong>:</p><ul><li>æˆ‘æœ€å¼€å§‹æƒ³åˆ°çš„æ˜¯ <code>ref = (value) =&gt; reactive(&#123;value&#125;)</code>ä½†æ˜¯å¦‚æœåªæ˜¯è¿™ä¹ˆç®€å•å®ç°, é‚£ä¹ˆ <code>ref</code> çš„é <code>value</code>å±æ€§ä¹Ÿå°†å˜ä¸º <code>reactive</code>. åŒæ—¶å¯ä»¥é¢„è§è¿™æ ·å®ç°çš„<code>ref</code> æ€§èƒ½ä¸åŠæ ‡å‡† <code>ref</code>.</li><li><code>ref</code> çš„ç‰¹ç‚¹æ˜¯<strong>å¤–å±‚æœ‰ä¸”åªæœ‰</strong><code>value</code> ä¸€ä¸ª <code>key</code>, è¿™æ„å‘³æˆ‘ä»¬åœ¨å®ç°æ—¶<ul><li>ä¸ç”¨ä½¿ç”¨å…¨å±€ <code>targetMap</code> (åªæœ‰ä¸€ä¸ªdepSet)</li><li>ä¸ç”¨åƒ <code>reactive</code> ä¸€æ ·å®ç°ä¸€ä¸ª Proxy, å¯ä»¥åªå®ç°ä¸€ä¸ª<code>[GET]</code> &amp; <code>[SET]</code>.</li></ul></li><li>è€ƒè™‘åˆ° <code>ref</code> çš„<strong>è¾“å…¥å¯èƒ½æ˜¯å¯¹è±¡æˆ–éå¯¹è±¡</strong><ul><li>æˆ‘ä»¬èƒ½ä¸ä½¿ç”¨å…¨å±€çš„ <code>targetMap</code>, å¦åˆ™ä¸¤ä¸ªå€¼ç›¸åŒçš„<code>ref</code> ä¼šè¢«åˆ¤å®šä¸ºåŒä¸€ä¸ª <code>keyMap</code></li><li>è‹¥è¾“å…¥ä¸ºå¯¹è±¡, åœ¨å¯¹æ¯”èµ‹å€¼æ—¶æ–°å€¼ä¸æ—§å€¼ä¸€æ ·ä¸èƒ½ç®€å•çš„æ¯”è¾ƒ<code>_value === newValue</code>. è‹¥è¾“å…¥ä¸ºå¯¹è±¡, é‚£ä¹ˆ<code>reactive(obj) !== obj</code>. æˆ‘ä»¬è¿˜éœ€è¦ä¿å­˜è¾“å…¥çš„åŸå§‹å€¼</li></ul></li></ul><ol type="1"><li><p>æµ‹è¯• <code>ref</code> éå¯¹è±¡æ—¶ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should be reactive'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> dummy<span class="token punctuation">;</span>  <span class="token keyword">let</span> calls <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    calls<span class="token operator">++</span><span class="token punctuation">;</span>    dummy <span class="token operator">=</span> a<span class="token punctuation">.</span>value<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>calls<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ„é€  EffectFunction æ‰§è¡Œä¸€æ¬¡</span>  <span class="token function">expect</span><span class="token punctuation">(</span>dummy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  a<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// ref ä¹Ÿæ”¯æŒä¾èµ–æ”¶é›†ä¸è§¦å‘</span>  <span class="token function">expect</span><span class="token punctuation">(</span>calls<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>dummy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  a<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// åŒå€¼ä¸è§¦å‘</span>  <span class="token function">expect</span><span class="token punctuation">(</span>calls<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>dummy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> <code>ref</code>å¯¹è±¡æ—¶è¦æŠŠå†…å±‚å¯¹è±¡å˜ä¸º <code>reactive</code>, å¯¹è±¡ä¹Ÿå¯ä»¥å˜ä¸ºéå¯¹è±¡<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should convert to reactive'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> origin <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> dummy<span class="token punctuation">;</span>  <span class="token keyword">let</span> calls <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    calls<span class="token operator">++</span><span class="token punctuation">;</span>    dummy <span class="token operator">=</span> a<span class="token punctuation">.</span>value<span class="token punctuation">.</span>foo <span class="token operator">?</span> a<span class="token punctuation">.</span>value<span class="token punctuation">.</span>foo <span class="token operator">:</span> a<span class="token punctuation">.</span>value<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>calls<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ„é€  EffectFunction æ‰§è¡Œä¸€æ¬¡</span>  <span class="token function">expect</span><span class="token punctuation">(</span>dummy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  a<span class="token punctuation">.</span>value<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// ref ä¹Ÿæ”¯æŒä¾èµ–æ”¶é›†ä¸è§¦å‘</span>  <span class="token function">expect</span><span class="token punctuation">(</span>calls<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>dummy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  a<span class="token punctuation">.</span>value <span class="token operator">=</span> origin<span class="token punctuation">;</span> <span class="token comment">// åŒå€¼ä¸è§¦å‘</span>  <span class="token function">expect</span><span class="token punctuation">(</span>calls<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>dummy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  a<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// åŒå€¼ä¸è§¦å‘</span>  <span class="token function">expect</span><span class="token punctuation">(</span>calls<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>dummy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  a<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// å˜ä¸ºéå¯¹è±¡</span>  <span class="token function">expect</span><span class="token punctuation">(</span>calls<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>dummy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>å®ç°</p></li></ol><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ä¸ reactive ç›´æ¥è¿”å›ä¸€ä¸ª Proxy ä¸åŒ, æˆ‘ä»¬åªæœ‰ value ä¸€ä¸ªå±æ€§, æ‰€ä»¥è¦æ‰‹åŠ¨å®ç°ä¸€ä¸ªå¯¹è±¡</span><span class="token keyword">class</span> <span class="token class-name">RefImpl</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è¿™é‡Œæˆ‘ä»¬ä¸ä½¿ç”¨å…¨å±€çš„ targetMap åŸå› æ˜¯</span>  <span class="token comment">//   - æˆ‘ä»¬è¿™é‡Œçš„ Key å¯ä»¥ä¸æ˜¯å¯¹è±¡, ä¸¤ä¸ªå€¼ç›¸åŒçš„ ref ä¼šè¢«åˆ¤å®šä¸ºåŒä¸€ä¸ª key</span>  <span class="token comment">//   - åªå­˜åœ¨ä¸€ä¸ª Key: value, æ‰€ä»¥æ²¡æœ‰å¿…è¦ä½¿ç”¨ä¸¤ä¸ª Map, åªéœ€è¦ä¸€ä¸ª Set å°±å¯ä»¥å­˜å‚¨æ‰€æœ‰çš„ EffectReactive</span>  <span class="token keyword">private</span> <span class="token literal-property property">deps</span><span class="token operator">:</span> Set<span class="token operator">&lt;</span>EffectReactive<span class="token operator">></span><span class="token punctuation">;</span>  <span class="token keyword">private</span> _value<span class="token punctuation">;</span>  <span class="token keyword">private</span> rawValue<span class="token punctuation">;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> <span class="token function">isObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">reactive</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">:</span> value<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>rawValue <span class="token operator">=</span> value<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// åªéœ€è¦ value çš„ [SET] [GET] å°±å¯ä»¥å®ç°</span>  <span class="token keyword">get</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">trackEffect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¾èµ–è¿½è¸ª</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">set</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// é‡å¤èµ‹å€¼ä¸è§¦å‘, è€ƒè™‘ä¸¤ç§æƒ…å†µ</span>    <span class="token comment">//   - this._value ä¸æ˜¯ Object, ç›´æ¥æ¯”è¾ƒ</span>    <span class="token comment">//   - this._value æ˜¯ Object, æ­¤æ—¶ this._value æ˜¯ä¸€ä¸ª reactive, reactive(obj) !== obj, å¿…é¡»ä½¿ç”¨åŸå§‹å€¼æ¯”è¾ƒ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rawValue <span class="token operator">===</span> newValue<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>rawValue <span class="token operator">=</span> newValue<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> <span class="token function">isObject</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">reactive</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token operator">:</span> newValue<span class="token punctuation">;</span>    <span class="token function">triggerEffect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è§¦å‘ä¾èµ–</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RefImpl</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> åœ¨è¿™é‡Œ, <code>trackEffect</code> ä¸<code>triggerEffect</code> ç›¸å½“äºä¸éœ€è¦æŸ¥ <code>Set</code> çš„<code>track</code> ä¸ <code>trigger</code>(å› ä¸ºåªæœ‰ä¸€ä¸ª<code>Set</code>). æˆ‘ä»¬å¯ä»¥å°†åŸæ¥çš„ <code>track</code> ä¸<code>trigger</code> æ‹†å¼€</p><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">track</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>activeEffect<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>targetMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> targetMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> keyMap <span class="token operator">=</span> targetMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>keyMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> keyMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æŠ½æˆä¸€ä¸ªå‡½æ•°</span>  <span class="token function">trackEffect</span><span class="token punctuation">(</span>keyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">trackEffect</span><span class="token punctuation">(</span><span class="token parameter">dependenceEffect</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// æœ¬æ¥åªéœ€è¦åœ¨ track ä¸Šåˆ¤æ–­ activeEffect ä½†æ˜¯è¿™ä¸ªå‡½æ•°å¯èƒ½è¢« track æˆ–è€… RefImpl è°ƒç”¨, æ‰€ä»¥è¿˜éœ€è¦åœ¨åˆ¤æ–­ä¸€æ¬¡</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>activeEffect<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>  dependenceEffect<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>activeEffect<span class="token punctuation">)</span><span class="token punctuation">;</span>  activeEffect<span class="token punctuation">.</span>deps<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>dependenceEffect<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> keyMap <span class="token operator">=</span> targetMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>keyMap<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> depSet <span class="token operator">=</span> keyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>depSet<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token comment">// æŠ½æˆä¸€ä¸ªå‡½æ•°</span>  <span class="token function">triggerEffect</span><span class="token punctuation">(</span>depSet<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">triggerEffect</span><span class="token punctuation">(</span><span class="token parameter">depSet</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token punctuation">[</span><span class="token operator">...</span>depSet<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>d<span class="token punctuation">.</span>scheduler <span class="token operator">?</span> d<span class="token punctuation">.</span><span class="token function">scheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> d<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="å®ç°å·¥å…·å‡½æ•°-isref-unref-proxyrefs">å®ç°å·¥å…·å‡½æ•°<code>isRef</code> &amp; <code>unRef</code> &amp;<code>proxyRefs</code></h3><p><strong>éœ€æ±‚</strong>: - <code>isRef</code>: åˆ¤æ–­è¾“å…¥æ˜¯ä¸æ˜¯<code>ref</code> - <code>unRef</code>: è¿”å› <code>ref</code> çš„<code>value</code> - <code>proxyRefs</code>: æ¨¡æ‹Ÿ Vue3 çš„ setup å‡½æ•°,é€šè¿‡è¯¥å‡½æ•°è¿”å›çš„å¯¹è±¡ä¸­çš„ <code>ref</code> åœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¸­æ— éœ€<code>.value</code> å³å¯è®¿é—®ä¸èµ‹å€¼. ç®€å•æ¥è¯´å°±æ˜¯è¾“å…¥å¯¹è±¡,åœ¨è®¿é—®å¯¹è±¡ä¸­æµ…å±‚ <code>ref</code> çš„ <code>Key</code> æ—¶æ— éœ€<code>.value</code> å³å¯è®¿é—®</p><p><strong>éœ€æ±‚åˆ†æ</strong>: - <code>isRef</code>: åŠ ä¸€ä¸ª flag å³å¯ -<code>unRef</code>: åˆ¤æ–­æ˜¯ä¸æ˜¯ <code>ref</code>, æ˜¯å°±è¿”å›<code>ref.value</code> - <code>proxyRefs</code>: æ„é€ ä¸€ä¸ªä»£ç†,åœ¨è¯»å†™æ˜¯åˆ¤æ–­è¯»å†™ç›®æ ‡æ˜¯ä¸æ˜¯ <code>ref</code> å¦‚æœæ˜¯å°±è¿”å›<code>ref.value</code>. åŒæ—¶, åœ¨ <code>[SET]</code> æ—¶, å¦‚æœæ–°æ—§å€¼éƒ½æ˜¯<code>ref</code> é‚£ä¹ˆç›´æ¥æ›¿æ¢æ‰æ—§ <code>ref</code></p><ol type="1"><li><p>æµ‹è¯• <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'isRef'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> origin1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> origin2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> observed1 <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span>origin1<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> observed2 <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span>origin2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isRef</span><span class="token punctuation">(</span>origin1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isRef</span><span class="token punctuation">(</span>origin2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isRef</span><span class="token punctuation">(</span>observed1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isRef</span><span class="token punctuation">(</span>observed2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'unRef'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> origin1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> origin2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> observed1 <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span>origin1<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> observed2 <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span>origin2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">unRef</span><span class="token punctuation">(</span>observed1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>origin1<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">unRef</span><span class="token punctuation">(</span>observed2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>origin2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">unRef</span><span class="token punctuation">(</span>observed2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toStrictEqual</span><span class="token punctuation">(</span>origin2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">unRef</span><span class="token punctuation">(</span>observed2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token function">reactive</span><span class="token punctuation">(</span>origin2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'proxyRefs'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">sampleRef</span><span class="token operator">:</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token literal-property property">sampleStr</span><span class="token operator">:</span> <span class="token string">'demo'</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> proxyUser <span class="token operator">=</span> <span class="token function">proxyRefs</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>sampleRef<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>proxyUser<span class="token punctuation">.</span>sampleRef<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>proxyUser<span class="token punctuation">.</span>sampleStr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'demo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">(</span>proxyUser <span class="token keyword">as</span> any<span class="token punctuation">)</span><span class="token punctuation">.</span>sampleRef <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>proxyUser<span class="token punctuation">.</span>sampleRef<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>sampleRef<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  proxyUser<span class="token punctuation">.</span>sampleRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>proxyUser<span class="token punctuation">.</span>sampleRef<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>sampleRef<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>å®ç°</p></li></ol><p>æ‰“flag <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">RefImpl</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">public</span> __v_isRef <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre> å®ç° <code>isRef</code> ä¸ <code>unRef</code><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">unRef</span><span class="token punctuation">(</span><span class="token parameter">ref</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token function">isRef</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span> <span class="token operator">?</span> ref<span class="token punctuation">.</span>value <span class="token operator">:</span> ref<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isRef</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span>value<span class="token operator">?.</span>__v_isRef<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> å®ç° <code>proxyRef</code> <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">proxyRefs</span><span class="token punctuation">(</span><span class="token parameter">origin</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> proxyProxyRefConfig<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">getProxyRef</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ä¸ç”¨è¿™ä¹ˆéº»çƒ¦</span>  <span class="token comment">// if (isRef(target[key])) return target[key].value;</span>  <span class="token comment">// return target[key];</span>  <span class="token keyword">return</span> <span class="token function">unRef</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">setProxyRef</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// åªç‰¹åˆ¤ ref &lt;- æ™®é€šå€¼</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isRef</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isRef</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">const</span> proxyProxyRefConfig <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">get</span><span class="token operator">:</span> getProxyRef<span class="token punctuation">,</span>  <span class="token literal-property property">set</span><span class="token operator">:</span> setProxyRef<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> 3. é‡æ„: æ— </p><h3 id="å®ç°-computed">å®ç° <code>computed</code></h3><p><strong>éœ€æ±‚:</strong> 1. è¾“å…¥ä¸€ä¸ªå‡½æ•°, è¿”å›ä¸€ä¸ªå¯¹è±¡, å¯ä»¥é€šè¿‡<code>.value</code> è·å–å‡½æ•°è¿”å›å€¼, å½“å‡½æ•°å†…éƒ¨ <code>reactive</code>å˜åŒ–æ—¶, è¿”å›å€¼ä¹Ÿè¦å˜åŒ–. 2. æ”¯æŒ Lazy, å³: 1. åœ¨ <code>computed</code>å†…éƒ¨ <code>reactive</code> å˜åŒ–æ—¶ä¸è§¦å‘ <code>computed</code> ä¼ å…¥å‡½æ•°2. åœ¨ <code>[GET]</code> æ—¶æ‰è§¦å‘ <code>computed</code> ä¼ å…¥å‡½æ•° 3.è‹¥å†…éƒ¨ <code>reactive</code> ä¸å˜, é‡å¤è§¦å‘ <code>[GET]</code>ä¸é‡å¤è§¦å‘ä¼ å…¥å‡½æ•° 3. è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ª <code>reactive</code> å¯¹è±¡, å³<code>.value</code> å˜åŒ–æ—¶è¦è§¦å‘ä¾èµ–</p><p><strong>éœ€æ±‚åˆ†æ:</strong></p><ol type="1"><li>æµ‹è¯• <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should reactive'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> observed <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    cnt<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> observed<span class="token punctuation">.</span>foo <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>cnt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Lazy</span>  <span class="token function">expect</span><span class="token punctuation">(</span>bar<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>cnt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  observed<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>cnt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Lazy</span>  <span class="token function">expect</span><span class="token punctuation">(</span>bar<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>cnt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>bar<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>bar<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Lazy</span>  <span class="token function">expect</span><span class="token punctuation">(</span>cnt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è¿”å›å€¼ä¹Ÿå¯ä»¥æ”¶é›†ä¾èµ–</span><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should trigger effect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> cValue <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> value<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> dummy<span class="token punctuation">;</span>  <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    dummy <span class="token operator">=</span> cValue<span class="token punctuation">.</span>value<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>dummy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  value<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token function">expect</span><span class="token punctuation">(</span>dummy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å®ç°</li></ol><ul><li>æ„é€ ä¸€ä¸ª <code>old</code>, å½“å†…éƒ¨ reactive å˜åŒ–æ—¶ä¿®æ”¹,å¦‚æœå†…éƒ¨ä¸å˜å°±ç›´æ¥ä½¿ç”¨åŸ <code>_value</code></li><li>ç±»ä¼¼æ„é€  <code>ref</code> çš„ <code>dep</code> æ”¶é›†<code>.value</code> çš„ä¾èµ–</li><li>æˆ‘ä»¬å¸Œæœ›åœ¨ç¬¬ä¸€æ¬¡ <code>[GET]</code> çš„æ—¶å€™æ”¶é›†ä¾èµ–, è¿™å¯ä»¥ä½¿ç”¨<code>EffectReactive</code> å®ç°, ä½†æ˜¯ä¸ºäº†å®ç° Lazy æˆ‘ä»¬åˆä¸å¸Œæœ›æ¯æ¬¡å†…éƒ¨<code>reactive</code> å˜åŒ–éƒ½è§¦å‘ä¾èµ–. æˆ‘ä»¬å¯ä»¥é‡‡ç”¨<code>scheduler</code> è§£å†³, æ¯æ¬¡å†…éƒ¨ <code>reactive</code>å˜åŒ–æ—¶å€™æ‰“ä¸‹æ ‡è®°(<code>old</code>), å¹¶é€šçŸ¥ <code>computed</code>è¦è§¦å‘ä¾èµ–äº†. å¦‚æœ <code>computed</code> æ²¡æœ‰ä¾èµ–é‚£è¿™æ¬¡å°± Lazy è¿‡å»äº†,å¦‚æœæœ‰é‚£åœ¨è§¦å‘ä¾èµ–æ—¶å…¶ä»–å‡½æ•°ä¼šè°ƒç”¨è®¡ç®—å±æ€§çš„ <code>[GET]</code>æ­¤æ—¶å®Œæˆåˆ·æ–°</li></ul><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>  effect<span class="token punctuation">,</span>  EffectReactive<span class="token punctuation">,</span>  trackEffect<span class="token punctuation">,</span>  triggerEffect<span class="token punctuation">,</span><span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./effect'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">ComputedImpl</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">old</span><span class="token operator">:</span> boolean<span class="token punctuation">;</span>  <span class="token literal-property property">fst</span><span class="token operator">:</span> boolean<span class="token punctuation">;</span>  <span class="token literal-property property">_value</span><span class="token operator">:</span> any<span class="token punctuation">;</span>  <span class="token literal-property property">dep</span><span class="token operator">:</span> Set<span class="token operator">&lt;</span>EffectReactive<span class="token operator">></span><span class="token punctuation">;</span>  effect<span class="token operator">!</span><span class="token operator">:</span> EffectReactive<span class="token punctuation">;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">public</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>old <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>fst <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">get</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">trackEffect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dep<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ä¸ºå•¥äººå®¶çš„ä»£ç æ²¡ fst å‘¢? å› ä¸ºäººå®¶çš„ EffectReactive æ¯åœ¨æ„é€ å‡½æ•°çš„æ—¶å€™ run. äººå®¶å¯ä»¥åœ¨æ„é€ å‡½æ•°é‡Œé¢æ³¨å†Œè¿™ä¸ª effect</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fst<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>fst <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>effect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EffectReactive</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        <span class="token function-variable function">scheduler</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>old <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>          <span class="token function">triggerEffect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dep<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>old<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>old <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>effect<span class="token punctuation">.</span><span class="token function">runner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">triggerEffect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dep<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">set</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Can not set computed value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token parameter">origin</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ComputedImpl</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> - é‡æ„: è€ƒè™‘ä¿®æ”¹ <code>EffectReactive</code>æ„é€ å‡½æ•°</p><h3 id="å°ç»“">å°ç»“</h3><ul><li>å®ç° <code>Reactivity</code> çš„æ ¸å¿ƒå°±æ˜¯ä¸€ä¸ª <code>Proxy</code>.é€šè¿‡ä¿®æ”¹ <code>[GET]</code> &amp; <code>[SET]</code> å®ç°ä¸åŒæƒé™</li><li>æ—¶åˆ»è°¨è®° JavaScript æ˜¯åŠ¨æ€è¯­è¨€, å¯¹è±¡ä¸Šçš„å±æ€§éšæ—¶åœ¨å˜åŒ–,ä¸è¦æƒ³åœ¨æŸä¸€ä¸ªå¯¹å¯¹è±¡ä¸Šçš„å±æ€§åšç‰¹æ®Šå¤„ç†, å¾ˆå®¹æ˜“é—æ¼,æˆ‘ä»¬å¯ä»¥æƒ³æƒ³ä»€ä¹ˆæ—¶å€™å¤–éƒ¨éœ€è¦æˆ‘ä»¬ç‰¹æ®Šå¤„ç†çš„ç‰¹æ€§, åœ¨å‡ºå£å¤„"å›´è¿½å µæˆª"</li><li>æ³¨æ„æˆ‘ä»¬åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™æŠ½è±¡å‡½æ•°<ul><li>è¯­ä¹‰ä¸Šå¯ä»¥æŠ½è±¡æ—¶å€™</li><li>åŠŸèƒ½é‡å¤æ—¶</li></ul></li><li>å½“å‡½æ•°åŠŸèƒ½éƒ¨åˆ†é‡å æ—¶è¦æ•¢äºæ‹†åˆ†å‡½æ•°</li><li><code>ref</code> ç›¸å½“äºæ˜¯ä¸€ä¸ªæ•´ä½“åŠŸèƒ½å¼±åŒ–çš„ <code>reactive</code>,æ‰€ä»¥æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨å…¨å±€ <code>targetMap</code></li><li><code>computed</code> çš„å®ç°æ¯”è¾ƒå·§å¦™, è¿ç”¨äº†ä¸€ä¸ª effect çš„é…ç½®é¡¹,æˆ‘ä»¬åœ¨å®ç°å·¥å…·å‡½æ•°çš„æ—¶å€™ä¹Ÿå¯ä»¥æƒ³æƒ³æ˜¯å¦å¯ä»¥é€šè¿‡é…ç½®é¡¹å°†ä¸¤ä¸ªåŠŸèƒ½ç±»ä¼¼çš„ç±»åˆå¹¶æˆä¸€ä¸ªç±».</li></ul><h2 id="å®ç°-runtime-core-çš„-mount-éƒ¨åˆ†">å®ç° runtime-core çš„ mountéƒ¨åˆ†</h2><h3 id="æ­å»ºç¯å¢ƒ">æ­å»ºç¯å¢ƒ</h3><p>runtime-core ç›´æ¥å‚ä¸é¡µé¢å®ç°, æˆ‘ä»¬éœ€è¦åˆ©ç”¨æ‰“åŒ…å·¥å…·æ‰“åŒ…ä»£ç .åœ¨æ‰“åŒ…ç½‘é¡µæ—¶ä¸€èˆ¬ä½¿ç”¨ webpack, è€Œåœ¨æ‰“åŒ…æ¨¡å—æ—¶ä¸€èˆ¬ä½¿ç”¨ rollup.js. å®‰è£…rollup åŠå…¶ TypeScript ä¾èµ–</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pnpm i -D rollup @rollup&#x2F;plugin-typescript tslib rollup-plugin-sourcemaps#         ^ æœ¬ä½“  ^ typescript æ”¯æŒ          ^ TS æ”¯æŒä¾èµ–<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>é…ç½® rollup</p><ul><li>åˆ›å»º <code>/package/index.ts</code> ä½œä¸ºæ•´ä¸ªé¡¹ç›®çš„å‡ºå£</li><li>åˆ›å»º rollup é…ç½®æ–‡ä»¶ <code>/package/rollup.config.js</code><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> typescript <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-typescript'</span><span class="token punctuation">;</span><span class="token keyword">import</span> sourceMaps <span class="token keyword">from</span> <span class="token string">'rollup-plugin-sourcemaps'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">'./packages/index.ts'</span><span class="token punctuation">,</span> <span class="token comment">// å…¥å£æ–‡ä»¶</span>  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token comment">// 2ç§è¾“å‡ºæ ¼å¼</span>    <span class="token punctuation">&#123;</span>      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span> <span class="token comment">// è¾“å‡ºæ ¼å¼</span>      <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">'./lib/micro-vue.cjs.js'</span><span class="token punctuation">,</span> <span class="token comment">// è¾“å‡ºè·¯å¾„</span>      <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span>      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'es'</span><span class="token punctuation">,</span>      <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">'./lib/micro-vue.esm.js'</span><span class="token punctuation">,</span>      <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">typescript</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sourceMaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>æ‰§è¡Œ <code>rollup -c ./rollup.config.js</code> æ‰“åŒ…</li><li>æ ¹æ®æç¤ºå°† <code>tsconfig.json</code> ä¸­<code>"module": "commonjs"</code> æ”¹ä¸º<code>"module": "ESNext"</code></li><li>åœ¨ <code>package.json</code> ä¸­æ³¨å†ŒåŒ…çš„å…¥å£æ–‡ä»¶, <code>main</code>å¯¹åº” commonjs åŒ…, <code>module</code> å¯¹åº” ESM åŒ… <pre class="line-numbers language-json" data-language="json"><code class="language-json">&quot;main&quot;: &quot;lib&#x2F;micro-vue.cjs.js&quot;,&quot;module&quot;: &quot;lib&#x2F;micro-vue.esm.js&quot;,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul><h3 id="æ„é€ æµ‹è¯•ç”¨ä¾‹">æ„é€ æµ‹è¯•ç”¨ä¾‹</h3><p>æˆ‘ä»¬æ„é€ ä¸€ä¸ªç®€å•çš„ Vue demo å¹¶å°è¯•å®ç° vue-runtimeä¸»æµç¨‹ä½¿å…¶å¯ä»¥å°†æˆ‘ä»¬çš„ demo æ¸²æŸ“å‡ºæ¥, Vue é¡¹ç›®ä¸€èˆ¬åŒ…å«å¦‚ä¸‹æ–‡ä»¶</p><ul><li><code>index.html</code>: è‡³å°‘åŒ…å«ä¸€ä¸ªæŒ‚è½½ç‚¹</li><li><code>index.js</code>: å¼•å…¥æ ¹ç»„ä»¶, å°†æ ¹ç»„ä»¶æŒ‚è½½åˆ°æŒ‚è½½ç‚¹</li><li><code>App.vue</code>: å®šä¹‰æ ¹ç»„ä»¶</li></ul><p>SFC éœ€è¦ vue-loader ç¼–è¯‘æ‰èƒ½å®ç°. è€Œ vue-loader çš„ä½œç”¨æ˜¯å°† SFC å¤„ç†ä¸º<code>render</code> å‡½æ•°, åœ¨æ­¤æˆ‘ä»¬åªèƒ½å…ˆå°† <code>App.vue</code> å¤„ç†ä¸ºvue-loader ç¼–è¯‘åå‡½æ•°. å®šä¹‰</p><ul><li><code>index.html</code>: åªæ„é€ ä¸€ä¸ªæŒ‚è½½ç‚¹å¹¶å¼•å…¥ JS<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>micro-vue runtime-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./index.js<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>model<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><code>index.js</code>: å…ˆä¸ç®¡æœ‰æ²¡æœ‰è¿™äº›å‡½æ•°, å¹³æ—¶å’‹å†™å°±å’‹å†™<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createApp <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../../lib/micro-vue.esm'</span><span class="token punctuation">;</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span><span class="token punctuation">;</span><span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><code>App.js</code>: <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> h <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../../lib/micro-vue.esm.js'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'title'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">"111"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">"222"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><code>App.js</code> é»˜è®¤å¯¼å‡ºäº†ä¸€ä¸ªé…ç½®å¯¹è±¡, è¯¥å¯¹è±¡åº”è¯¥åŒ…å« SFCä¸­å¯¼å‡ºçš„ <code>setup</code> ä¸ vue-loader ç¼–è¯‘å¾—åˆ°çš„ <code>render</code>å‡½æ•°. å…¶ä¸­</p><ul><li><code>setup</code> å‡½æ•°çš„è¿”å›å€¼å¯ä»¥æ˜¯å¯¹è±¡, ä¹Ÿå¯ä»¥æ˜¯æ¸²æŸ“å‡½æ•°</li><li>åœ¨è§£æ SFC æ–‡ä»¶æ—¶, å¦‚æœç”¨æˆ·æ‰‹åŠ¨é€šè¿‡ <code>setup</code>è¿”å›äº†æ¸²æŸ“å‡½æ•°é‚£ä¹ˆ vue-loader å°±ä¸ç¼–è¯‘æ¨¡æ¿,å¦‚æœæ²¡æœ‰è¿”å›åˆ™ç¼–è¯‘æ¨¡æ¿å¹¶æ„é€ æ¸²æŸ“å‡½æ•° <code>render</code>.<code>render</code>å‡½æ•°æè¿°äº†<strong>è¿™ä¸ªç»„ä»¶é‡Œé¢</strong>åº”è¯¥å¦‚ä½•æ¸²æŸ“</li><li><code>render</code> ä¸­çš„ <code>h</code> ç”¨äºè¡¨è¿°ä¸€ä¸ªç»„ä»¶/å…ƒç´ ,è¯­æ³•ä¸º: <code>h(type, attr, children)</code>.<ul><li><code>type</code>: æè¿°å…ƒç´ æˆ–ç»„ä»¶ç±»å‹, å¦‚æœå¸Œæœ›å°†ç›®æ ‡æ¸²æŸ“ä¸º Elementé‚£ä¹ˆ <code>type</code> ä¸ºæ ‡ç­¾å, å¦‚æœå¸Œæœ›æ¸²æŸ“ä¸ºç»„ä»¶é‚£ä¹ˆ<code>type</code> ä¸º ç»„ä»¶é…ç½®å¯¹è±¡</li><li><code>attr</code>: æè¿°å…ƒç´ æˆ–ç»„ä»¶ä¸Šçš„å±æ€§(ä¾‹å¦‚:<code>class</code>)</li><li><code>children</code>:<ul><li>å¦‚æœå¾…æ¸²æŸ“çš„æ˜¯ä¸€ä¸ªå…ƒç´ , å¦‚æœè¿™ä¸ªå…ƒç´ ä¸‹é¢æ²¡æœ‰å­å…ƒç´ æˆ–è€…å­ç»„ä»¶, é‚£ä¹ˆ<code>children</code> ä¸ºå…ƒç´ çš„ <code>innerText</code>,å¦‚æœä¸‹é¢è¿˜æœ‰å­ç»„ä»¶æˆ–å­å…ƒç´ , é‚£ä¹ˆ <code>children</code> åº”è¯¥æ˜¯ä¸€ä¸ª<code>h</code> å‡½æ•°è¿”å›å€¼æ•°ç»„</li><li><strong>å¦‚æœå¾…æ¸²æŸ“çš„æ˜¯ä¸€ä¸ªç»„ä»¶, <code>children</code>å±æ€§å°†ä¼ å…¥æ’æ§½è€Œä¸æ˜¯å­å…ƒç´ , è¿™ä¸€ç‚¹ä¸æ¨¡æ¿è®¾è®¡æ˜¯ç±»ä¼¼çš„</strong><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>111<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>222<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> çš„ <code>h</code> å‡½æ•° <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'111'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'222'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre> å¯¹äºç»„ä»¶<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Comp</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>111<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>222<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Comp</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> çš„ <code>h</code> å‡½æ•° <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">h</span><span class="token punctuation">(</span>Comp<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'111'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'222'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>è®¾è®¡ä¸Šæ˜¯ç»Ÿä¸€çš„.</li></ul></li></ul></li></ul><p>ä¸Šé¢è¿™ä¸ªä¾‹å­æè¿°äº†è¿™æ ·ä¸€ä¸ªç»„ä»¶:</p><ul><li><p>é¦–å…ˆé»˜è®¤å¯¼å‡ºçš„æ˜¯ä¸€ä¸ªç»„ä»¶é…ç½®å¯¹è±¡</p></li><li><p>è¿™ä¸ªç»„ä»¶è¢«ç¼–è¯‘ä¸ºäº† <code>render</code> å‡½æ•°, <code>render</code>å‡½æ•°è¿”å›äº†ä¸€ä¸ª <code>h</code>.</p><ul><li><p><strong>è¯¶, æˆ‘è¦æ¸²æŸ“ä¸€ä¸ªç»„ä»¶, ä¸ºå•¥ <code>h</code> çš„<code>type</code> æ˜¯ <code>div</code> è€Œä¸æ˜¯é…ç½®å¯¹è±¡å‘¢?</strong>ä¸€å®šæ³¨æ„, <code>render</code>æè¿°çš„æ˜¯ç»„ä»¶<strong>é‡Œé¢</strong>åº”è¯¥å¦‚ä½•æ¸²æŸ“, è¿™é‡Œçš„ <code>h</code>æ˜¯è¯´, App ç»„ä»¶é‡Œé¢æœ‰ä¸€ä¸ª <code>div</code>, å¦‚æœæˆ‘ä»¬è¿™é‡Œå†™çš„æ˜¯<code>h(demoObj, &#123;&#125;, '111')</code> è¿™ä¸ªæ„æ€æ˜¯ App ç»„ä»¶é‡Œé¢æœ‰ä¸€ä¸ª demoç»„ä»¶, è¿™ä¸ª demo ç»„ä»¶é‡Œé¢å•¥ä¹Ÿæ²¡æœ‰, ä»–çš„ innerText æ˜¯ '111'</p></li><li><p><strong>è¯¶, é‚£æˆ‘ä»¬åœ¨å“ªé‡Œå®šä¹‰äº† App çš„ h å‡½æ•°å‘¢?</strong>æˆ‘ä»¬æ²¡æœ‰ç”¨ <code>h</code> å‡½æ•°å®šä¹‰ App (æ˜¯åˆ©ç”¨ createApp å®šä¹‰çš„)è‡³äºè¿™ä¿©å‡½æ•°æœ‰ä»€ä¹ˆè”ç³»åé¢å†è¯´</p></li><li><p><strong>è¯¶, é‚£éš¾é“ç»„ä»¶å†…éƒ¨åªèƒ½æœ‰ä¸€ä¸ªä¸€çº§å­å…ƒç´ ?</strong> æ˜¯çš„, åœ¨Vue2 ä¸­æˆ‘ä»¬å°±è§„å®š <code>template</code> ä¸‹æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªä¸€çº§å­å…ƒç´ , åœ¨Vue3 ä¸­æˆ‘ä»¬ç”¨è¯­æ³•ç³–è§£é™¤äº†è¿™ä¸ªé™åˆ¶. ä½ å¯èƒ½ä¼šæƒ³åˆ°å¯¹äº App ä¸‹çš„æŸä¸ªç»„ä»¶(å¦‚demo), æˆ‘ä»¬é€šè¿‡è¿™æ ·çš„æ–¹å¼è®©è¿™ä¸ªç»„ä»¶æœ‰å¤šä¸ªå­å…ƒç´ </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// App.js çš„ render</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>demoConfig<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'title'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">"111"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">"222"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ˜¯é”™çš„, æ•°ç»„å°†ä½œä¸ºæ’æ§½ä¼ å…¥ demo ç»„ä»¶, ç»„ä»¶çš„å­å…ƒç´ æ˜¯åœ¨ç»„ä»¶è‡ªå·±çš„<code>render</code> ä¸­å®šä¹‰çš„.</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">demoConfig <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">"111"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">"222"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// App.js çš„ render</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>demoConfig<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'title'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶å®æˆ‘ä»¬çš„ç–‘é—®å°±æ˜¯åˆ°åº•æ˜¯ä»–å¦ˆçš„è°æ„é€ äº†æ ¹ç»„ä»¶ <code>App</code> çš„<code>h</code> å‡½æ•°</p></li></ul></li><li><p>App æ˜¯ä¸€ä¸ªç»„ä»¶, è¿™ä¸ªç»„ä»¶å†…éƒ¨æœ‰ä¸€ä¸ª <code>div</code> è¿™ä¸ª<code>div</code> åˆæœ‰ä¸¤ä¸ªå­<code>span</code>, å†…å®¹åˆ†åˆ«æ˜¯<code>111</code> å’Œ <code>222</code></p></li></ul><h3 id="æ„é€ ä¸»æµç¨‹">æ„é€ ä¸»æµç¨‹</h3><ul><li><p><code>vue-runtime</code> çš„ä¸»æµç¨‹</p><pre class="mermaid">  graph TBæ ¹ç»„ä»¶é…ç½®å¯¹è±¡ --createApp--> ä¸€ç§ç‰¹æ®Šçš„vNode --æŒ‚è½½æ ¹ç»„ä»¶--> æ ¹ç»„ä»¶ç‰¹æ®Šä½¿å‘½ç»“æŸ,æˆä¸ºæ™®é€šçš„ç»„ä»¶ --æ¸²æŸ“--> è¿›å…¥patchå‡½æ•° --ç›®æ ‡æ˜¯Element--> Elementå¤„ç†å‡½æ•° --æ–°Element--> æŒ‚è½½Element --æ²¡æœ‰å­Element --> å†™å…¥innerTextæŒ‚è½½Element --æœ‰å­Element--> æ¯ä¸ªå­Element --æ¸²æŸ“--> è¿›å…¥patchå‡½æ•°Elementå¤„ç†å‡½æ•° --è€Element--> æ›´æ–°Elementè¿›å…¥patchå‡½æ•° --ç›®æ ‡æ˜¯ç»„ä»¶--> ç»„ä»¶å¤„ç†å‡½æ•° --æ–°ç»„ä»¶--> æ–°å»ºç»„ä»¶ --> åº”ç”¨é…ç½® --> è¿è¡Œrender --> æ¯ä¸ªå­ç»„ä»¶ --æ¸²æŸ“--> è¿›å…¥patchå‡½æ•°ç»„ä»¶å¤„ç†å‡½æ•° --è€ç»„ä»¶--> æ›´æ–°ç»„ä»¶</pre></li><li><p>å¯ä»¥çœ‹åˆ° <code>createApp</code> è¾“å…¥é…ç½®å¯¹è±¡, <code>h</code>å‡½æ•°è¾“å…¥ <code>type</code>(å¯ä»¥æ˜¯stringå¯ä»¥æ˜¯é…ç½®å¯¹è±¡),<code>props</code>, <code>children</code>. è™½ç„¶ä¸¤è€…è¾“å…¥ä¸åŒ,ä½†æ˜¯ä»–ä»¬éƒ½è¿”å›äº† vNode. <code>createApp</code> çš„è¾“å…¥å¯ä»¥çœ‹ä½œæ˜¯æ²¡æœ‰<code>props</code>, <code>children</code> çš„ <code>h</code>å‡½æ•°çš„ç»„ä»¶è¾“å…¥, è€Œ <code>createApp</code> çš„è¾“å‡ºå¯ä»¥çœ‹ä½œæ˜¯å…·æœ‰ç‰¹æ®ŠåŠŸèƒ½çš„<code>h</code> è¾“å‡º. å®é™…ä¸Š <code>createApp</code> ä¸ <code>h</code>åœ¨åº•å±‚éƒ½ä¾èµ–äº† <code>createVNode</code> å‡½æ•°.</p></li><li><p>vue æ¸²æŸ“ä¸­å¯¹è±¡å‘ç”Ÿäº†å¦‚ä¸‹å˜åŒ–:</p><pre class="mermaid">  graph LRç»„ä»¶/å…ƒç´ é…ç½®å¯¹è±¡ --> è™šæ‹ŸèŠ‚ç‚¹vNode --> å®ä¾‹å¯¹è±¡ --> DOM</pre><ul><li>ç»„ä»¶é…ç½®å¯¹è±¡åŒ…å«äº† <code>render</code>, <code>setup</code></li><li><code>vNode</code> åœ¨é…ç½®å¯¹è±¡çš„åŸºç¡€ä¸ŠåŠ å…¥äº†éƒ¨åˆ†å±æ€§</li><li>å®ä¾‹å¯¹è±¡åˆåœ¨ <code>vNode</code> çš„åŸºç¡€ä¸ŠåŠ å…¥äº†å±æ€§</li><li>æœ€åæŒ‚è½½ä¸º DOM</li></ul></li></ul><p><code>vue-runtime</code> å¯¹å¤–æš´éœ²å‡½æ•°åªæœ‰ <code>createApp</code>æˆ‘ä»¬ä»è¿™ä¸ªå‡½æ•°å…¥æ‰‹</p><ul><li><p><code>createApp</code> åˆ›å»ºäº† app ç»„ä»¶ <code>vNode</code>,åŒæ—¶è¿™ä¸ªçš„ <code>vNode</code> è¿˜åº”è¯¥æœ‰ <code>mount</code>å‡½æ•°(å”¯ä¸€ç‰¹æ®Šçš„åœ°æ–¹)</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/createApp.ts</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createVNode <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./vnode'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> render <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./render'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token parameter">rootComponent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">_component</span><span class="token operator">:</span> rootComponent<span class="token punctuation">,</span>    <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> vNode <span class="token operator">=</span> <span class="token function">createVNode</span><span class="token punctuation">(</span>rootComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">render</span><span class="token punctuation">(</span>vNode<span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>createVnode</code>: æ”¶åˆ°é…ç½®å¯¹è±¡, <code>props</code>,<code>children</code> å°†ä»–ä»¬ä½œä¸ºä¸€ä¸ªå¯¹è±¡å­˜èµ·æ¥(API ä¸ <code>h</code>å‡½æ•°ä¸€æ ·)</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/vnode.ts</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createVNode</span><span class="token punctuation">(</span><span class="token parameter">component<span class="token punctuation">,</span> props <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">type</span><span class="token operator">:</span> component<span class="token punctuation">,</span>    props<span class="token punctuation">,</span>    children<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>render</code> è´Ÿè´£æ¸²æŸ“ <code>vNode</code>, ä½†æ˜¯<code>render</code> ä»€ä¹ˆéƒ½æ²¡åš, åªæ˜¯è°ƒç”¨äº† <code>patch</code>.è¿™é‡Œå¤šæ­¤ä¸€ä¸¾æ˜¯ä¸ºäº†æ–¹ä¾¿ä¹‹åéƒ¨ç½²å­å…ƒç´ æ—¶é€’å½’æ–¹ä¾¿</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/render.ts</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">vNode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> vNode<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç¬¬ä¸€æ¬¡åˆ›å»ºæ²¡æœ‰è€å…ƒç´ </span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>patch</code>å‡½æ•°æ”¶å…¥æ›´æ–°å‰åèŠ‚ç‚¹ä¸æŒ‚è½½ç‚¹(æ–°èŠ‚ç‚¹çš„æŒ‚è½½å‰èŠ‚ç‚¹ä¸º <code>null</code>),é’ˆå¯¹ä¸åŒèŠ‚ç‚¹ç±»å‹è°ƒç”¨ä¸åŒå¤„ç†å‡½æ•°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/render.ts</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token parameter">vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>vNode2<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">processComponent</span><span class="token punctuation">(</span>vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">processElement</span><span class="token punctuation">(</span>vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>processComponent</code> å¤„ç†ç»„ä»¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/render.ts</span><span class="token keyword">function</span> <span class="token function">processComponent</span><span class="token punctuation">(</span><span class="token parameter">vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode1<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">updateComponent</span><span class="token punctuation">(</span>vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è€å…ƒç´ å°± update</span>  <span class="token keyword">return</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span>vNode2<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  æ–°å…ƒç´ å°±æŒ‚è½½</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>updateComponent</code> æš‚æ—¶æ²¡æœ‰å¿…è¦å®ç°</p></li><li><p><code>mountComponent</code> æŒ‚è½½ç»„ä»¶. é¦–å…ˆæ˜ç¡®ç»„ä»¶è‡ªå·±æ˜¯æ²¡æœ‰ HTMLæ ‡ç­¾çš„, æŒ‚è½½ç»„ä»¶å®é™…ä¸Šæ˜¯æŒ‚è½½ç»„ä»¶ä¸­çš„å­å…ƒç´ . è€Œç»„ä»¶å­˜åœ¨çš„å¿…è¦æ˜¯å…¶å¯¼å‡ºçš„setup å‡½æ•°ä¸­å­˜åœ¨å­å…ƒç´ éœ€è¦çš„å˜é‡ä¸å‡½æ•°.</p><p>æˆ‘ä»¬å®ç°ç»„ä»¶å®ä¾‹åœ¨ä¸Šé¢è®°å½•ç»„ä»¶éœ€è¦çš„ä¸Šä¸‹æ–‡</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/render.ts</span><span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vNode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token function">createComponent</span><span class="token punctuation">(</span>vNode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºå®ä¾‹</span>  <span class="token function">setupComponent</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é…ç½®å®ä¾‹</span>  <span class="token function">setupRenderEffect</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>render<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// éƒ¨ç½²å®ä¾‹</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>createComponent</code> ç”¨äºåˆ›å»ºç»„ä»¶å®ä¾‹,ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬å°†ç»„ä»¶çš„ type æåˆ°å®ä¾‹ä¸Š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/componment.ts</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createComponent</span><span class="token punctuation">(</span><span class="token parameter">vNode</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    vNode<span class="token punctuation">,</span>    <span class="token literal-property property">type</span><span class="token operator">:</span> vNode<span class="token punctuation">.</span>type<span class="token punctuation">,</span> <span class="token comment">// å›¾æ–¹ä¾¿</span>    <span class="token literal-property property">render</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>setupComponent</code> ç”¨äºåˆ›å»ºå®ä¾‹, é…ç½®å®ä¾‹, åŒ…æ‹¬åˆå§‹åŒ–props, slots, å¤„ç† setup å¯¼å‡ºçš„å˜é‡ç­‰. è¿™é‡Œæˆ‘ä»¬å…ˆä¸å¤„ç† props, slot,å¿½ç•¥ setup å¯¼å‡ºçš„å˜é‡åçš„å½’å±é—®é¢˜, åªè§£å†³</p><ul><li>å¦‚æœæœ‰ <code>setup</code> å°±æ‰§è¡Œ <code>setup</code>,å¦‚æœæ‰§è¡Œç»“æœæ˜¯å¯¹è±¡å°±å°†å¯¼å‡ºå¯¹è±¡ç»‘å®šåˆ° instance ä¸Š, å¦‚æœæ˜¯å‡½æ•°å°±æŠŠä»–å½“æˆ<code>render</code> å‡½æ•°</li><li>å¦‚æœæ²¡ <code>render</code> å°±ä» <code>vNode</code> çš„<code>type</code> ä¸Šè¯»å– <code>render</code></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/componment.ts</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setupComponent</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// initProp</span>  <span class="token comment">// initSlot</span>  <span class="token function">setupStatefulComponent</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">finishComponentSetup</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// å¦‚æœæœ‰ setup å°±å¤„ç† setup å‡½æ•°è¿è¡Œç»“æœ</span><span class="token keyword">function</span> <span class="token function">setupStatefulComponent</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>instance<span class="token punctuation">.</span>type<span class="token punctuation">.</span>setup<span class="token punctuation">)</span>    <span class="token function">handleSetupResult</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> instance<span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  finishComponentSetup<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// å¤„ç† setup å‡½æ•°è¿è¡Œç»“æœ</span><span class="token keyword">function</span> <span class="token function">handleSetupResult</span><span class="token punctuation">(</span><span class="token parameter">instance<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span> instance<span class="token punctuation">.</span>render <span class="token operator">=</span> res<span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    instance<span class="token punctuation">.</span>setupResult <span class="token operator">=</span> res<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">finishComponentSetup</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// æœ€åå…œåº•è·å– render</span><span class="token keyword">function</span> <span class="token function">finishComponentSetup</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  instance<span class="token punctuation">.</span>render <span class="token operator">=</span> instance<span class="token punctuation">.</span>render <span class="token operator">||</span> instance<span class="token punctuation">.</span>type<span class="token punctuation">.</span>render<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å®ç° <code>instance</code> ä¹‹åéœ€è¦å°†ä¸­çš„å­å…ƒç´ æŒ‚è½½å‡ºå», é€’å½’<code>patch</code> å³å¯</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/componment.ts</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setupRenderEffect</span><span class="token punctuation">(</span><span class="token parameter">render<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> subTree <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// render åªèƒ½è¿”å› h å‡½æ•°çš„ç»“æœ, æ‰€ä»¥ä¸€å®šæ˜¯ä¸€ä¸ª vNode, ç›´æ¥ patch å°±è¡Œ</span>  <span class="token comment">// !</span>  <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> subTree<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç±»ä¼¼çš„å®ç° Element å¤„ç†åŠŸèƒ½</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/render.ts</span><span class="token keyword">function</span> <span class="token function">processElement</span><span class="token punctuation">(</span><span class="token parameter">vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode1<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">updateElement</span><span class="token punctuation">(</span>vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token function">mountElement</span><span class="token punctuation">(</span>vNode2<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å®ç°æŒ‚è½½ Element</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/render.ts</span><span class="token keyword">function</span> <span class="token function">mountElement</span><span class="token punctuation">(</span><span class="token parameter">vNode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>vNode<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLElement<span class="token punctuation">;</span> <span class="token comment">// æ„é€  DOM å…ƒç´ </span>  <span class="token comment">// æ·»åŠ å±æ€§</span>  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>vNode<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">k</span><span class="token punctuation">)</span> <span class="token operator">=></span> el<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> vNode<span class="token punctuation">.</span>props<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æœ‰å­å…ƒç´ </span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>vNode<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    vNode<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> d<span class="token punctuation">,</span> el<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é€’å½’æŒ‚è½½</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> el<span class="token punctuation">.</span>textContent <span class="token operator">=</span> vNode<span class="token punctuation">.</span>children<span class="token punctuation">;</span> <span class="token comment">// æ²¡å­å…ƒç´ </span>  container<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æœ€åå†™ä¸‹ <code>h</code> å‡½æ•°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/h.ts</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createVNode <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./vnode"</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> h <span class="token operator">=</span> createVNode<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="å®ç°ç»„ä»¶å®ä¾‹-proxy">å®ç°ç»„ä»¶å®ä¾‹ <code>Proxy</code></h3><p>æˆ‘ä»¬æƒ³è¦è®©ç»„ä»¶å¯ä»¥å¼•ç”¨è‡ªå·±å¯¼å‡ºçš„å˜é‡</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'micro-vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'title'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'hi '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯å› ä¸ºæˆ‘ä»¬ç›´æ¥è°ƒç”¨äº† <code>render</code> å‡½æ•°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/component.ts</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setupRenderEffect</span><span class="token punctuation">(</span><span class="token parameter">render<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> subTree <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰€ä»¥ <code>render</code> çš„ <code>this</code> æ˜¯ <code>global</code>,æˆ‘ä»¬å¸Œæœ› <code>render</code> çš„ <code>this</code> åŒ…æ‹¬<code>setup</code> å¯¼å‡ºçš„å¯¹è±¡ä¸ Vue 3 æ–‡æ¡£ä¸­çš„<span class="exturl" data-url="aHR0cHM6Ly9jbi52dWVqcy5vcmcvYXBpL2NvbXBvbmVudC1pbnN0YW5jZS5odG1s">ç»„ä»¶å®ä¾‹<i class="fa fa-external-link-alt"></i></span>,æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ„é€ ä¸€ä¸ª Proxy åŒæ—¶å®ç°è®¿é—® setup ç»“æœä¸ç»„ä»¶å¯¹è±¡</p><ol type="1"><li>å¤„ç† setup å¯¼å‡º</li></ol><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/component.ts</span><span class="token keyword">function</span> <span class="token function">handleSetupResult</span><span class="token punctuation">(</span><span class="token parameter">instance<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ...</span>  instance<span class="token punctuation">.</span>setupResult <span class="token operator">=</span> <span class="token function">proxyRefs</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><ol start="2" type="1"><li>åœ¨ç»“æŸç»„ä»¶åˆå§‹åŒ–æ—¶æ„é€ ä»£ç†å¯¹è±¡, å°†ä»£ç†å¯¹è±¡ä½œä¸ºä¸€ä¸ªå±æ€§æ’å…¥å®ä¾‹<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/component.ts</span><span class="token keyword">function</span> <span class="token function">finishComponentSetup</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// å£°æ˜ä»£ç†å¯¹è±¡</span>  instance<span class="token punctuation">.</span>proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> instance <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> publicInstanceProxy<span class="token punctuation">)</span><span class="token punctuation">;</span>  instance<span class="token punctuation">.</span>render <span class="token operator">=</span> instance<span class="token punctuation">.</span>render <span class="token operator">||</span> instance<span class="token punctuation">.</span>type<span class="token punctuation">.</span>render<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> å°† <code>target</code> å®šä¹‰ä¸º <code>&#123; instance &#125;</code>çœ‹èµ·æ¥å¾ˆæ€ª, ä¸ºå•¥ä¸ç›´æ¥ç”¨ <code>instance</code> å‘¢? å› ä¸ºåœ¨ DEVæ¨¡å¼ä¸‹è¿™ä¸ªå¯¹è±¡å†…éƒ¨åº”è¯¥è¿˜æœ‰å¾ˆå¤šå±æ€§, åªä¸è¿‡æˆ‘ä»¬æ²¡æœ‰è€ƒè™‘</li><li>å®šä¹‰ä»£ç† <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/publicInstanceProxy.ts</span><span class="token keyword">const</span> specialInstanceKeyMap <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function-variable function">$el</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token operator">=></span> instance<span class="token punctuation">.</span>vNode<span class="token punctuation">.</span>el<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> publicInstanceProxy <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å¦‚æœ setup å¯¼å‡ºçš„å¯¹è±¡ä¸Šæœ‰å°±è¿”å›</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Reflect<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>setupResult<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>setupResult<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ä»ç»„ä»¶å±æ€§ä¸Šå¯¼å‡ºå±æ€§</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> specialInstanceKeyMap<span class="token punctuation">)</span>      <span class="token keyword">return</span> specialInstanceKeyMap<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> target<span class="token punctuation">.</span>instance<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å®ç° <code>$el</code></li></ol><p>æœ‰å¾ˆå¤šç»„ä»¶å®ä¾‹, æˆ‘ä»¬æš‚æ—¶åªå®ç° <code>$el</code>. æŒ‚è½½ç‚¹åº”è¯¥æ˜¯<code>vNode</code> çš„å±æ€§, æ‰€ä»¥æˆ‘ä»¬å°†æŒ‚è½½ç‚¹è®°å½•åœ¨ <code>vNode</code>ä¸Š</p><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/vnode.ts</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createVNode</span><span class="token punctuation">(</span><span class="token parameter">component<span class="token punctuation">,</span> props <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ...</span>    <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> <code>el</code> ä½œä¸ºç»„ä»¶å®ä¾‹åœ¨ç»„ä»¶æŒ‚è½½ååœ¨ vNodeä¸Šæ›´æ–°å³å¯</p><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/publicInstanceProxy.ts</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setupRenderEffect</span><span class="token punctuation">(</span><span class="token parameter">instance<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ...</span>  instance<span class="token punctuation">.</span>vNode<span class="token punctuation">.</span>el <span class="token operator">=</span> container<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="å®ç°-shapeflags">å®ç° <code>shapeFlags</code></h3><p>å¯ä»¥å°†ç»„ä»¶ç±»å‹åˆ¤æ–­æŠ½å‡ºä¸ºä¸€ä¸ªå˜é‡, é€šè¿‡ä½è¿ç®—åˆ¤æ–­ç»„ä»¶ç±»å‹.æˆ‘ä»¬ç›®å‰éœ€è¦åˆ¤æ–­çš„æœ‰:</p><ul><li>æ˜¯å¦æ˜¯ <code>Element</code></li><li>æ˜¯å¦æ˜¯æœ‰ <code>setup</code> çš„ç»„ä»¶(ä¹Ÿå« stateful component)</li><li>å­èŠ‚ç‚¹æ˜¯ string è¿˜æ˜¯æ•°ç»„</li></ul><p>å®ç°</p><ul><li>ä¿®æ”¹ <code>vNode</code> å®šä¹‰ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createVNode</span><span class="token punctuation">(</span><span class="token parameter">component<span class="token punctuation">,</span> props <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">shapeFlags</span><span class="token operator">:</span> <span class="token function">getShapeFlags</span><span class="token punctuation">(</span>component<span class="token punctuation">,</span> children<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">// ...</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>åˆ¤æ–­å‡½æ•° <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> isObject <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../../share/index'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token keyword">enum</span> ShapeFlags <span class="token punctuation">&#123;</span>  <span class="token constant">ELEMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token constant">STATEFUL_COMPONENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token constant">TEXT_CHILDREN</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token constant">ARRAY_CHILDREN</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getShapeFlags</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> children</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// æ³¨æ„, è¿™ä¿©ä¸æ˜¯äº’æ–¥çš„...</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> res <span class="token operator">|=</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">ELEMENT</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span>setup<span class="token punctuation">)</span> res <span class="token operator">|=</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">STATEFUL_COMPONENT</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> res <span class="token operator">|=</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">ARRAY_CHILDREN</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> res <span class="token operator">|=</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">TEXT_CHILDREN</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> res<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>åŒæ­¥åˆ¤æ–­ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">setupStatefulComponent</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>instance<span class="token punctuation">.</span>vNode<span class="token punctuation">.</span>shapeFlags <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">STATEFUL_COMPONENT</span><span class="token punctuation">)</span>  <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">mountElement</span><span class="token punctuation">(</span><span class="token parameter">vNode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>vNode<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLElement<span class="token punctuation">;</span>  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>vNode<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">k</span><span class="token punctuation">)</span> <span class="token operator">=></span> el<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> vNode<span class="token punctuation">.</span>props<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode<span class="token punctuation">.</span>shapeFlags <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">ARRAY_CHILDREN</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ...</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token parameter">vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode2<span class="token punctuation">.</span>shapeFlags <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">ELEMENT</span><span class="token punctuation">)</span>    <span class="token function">processElement</span><span class="token punctuation">(</span>vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="å®ç°äº‹ä»¶æ³¨å†Œ">å®ç°äº‹ä»¶æ³¨å†Œ</h3><p>æˆ‘ä»¬å¯ä»¥ä¸º Element ä¼ å…¥ attribute, ä½†æ˜¯æ— æ³•ä¼ å…¥ç»‘å®šäº‹ä»¶, ä¾‹å¦‚ä¼ å…¥<code>&#123; onClick: ()=&gt;&#123;&#125; &#125;</code> åœ¨æ¸²æŸ“åˆ° DOMæ—¶å¯ä»¥å‘ç°æ¸²æŸ“ç»“æœä¸º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>div onclick<span class="token operator">=</span><span class="token string">"()=>&#123;&#125;"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>onClick</code> çš„å°é©¼å³°å‘½åæ²¡äº†</li><li>value åº”è¯¥æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨, è€Œè¿™é‡Œåªå†™äº†ä¸€ä¸ªå‡½æ•°,è¿™æ ·ç‚¹å‡»æ—¶å€™å¹¶ä¸ä¼šæ‰§è¡Œå‡½æ•°åªä¼šå³æŸ¥è¯¢ä¸€ä¸‹è¿™ä¸ªå‡½æ•°</li></ul><p>æ‰€ä»¥æˆ‘ä»¬è¦æ‰‹åŠ¨å®ç°è¿™æ ·çš„åŠŸèƒ½: åœ¨æŒ‚è½½ Element æ—¶, è‹¥ä¼ å…¥çš„æ˜¯äº‹ä»¶,æ‰‹åŠ¨ç»‘å®šè¿™ä¸ªäº‹ä»¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">mountElement</span><span class="token punctuation">(</span><span class="token parameter">vNode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>vNode<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLElement<span class="token punctuation">;</span>  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>vNode<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">k</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// é€šè¿‡æ­£åˆ™åˆ¤æ–­æ˜¯å¦ä¸ºäº‹ä»¶ç»‘å®š</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^on[A-Z]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span>      el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>        k<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^on([A-Z].*)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> e</span><span class="token punctuation">)</span> <span class="token operator">=></span> e<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        vNode<span class="token punctuation">.</span>props<span class="token punctuation">[</span>k<span class="token punctuation">]</span>      <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> el<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> vNode<span class="token punctuation">.</span>props<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®ç°-props">å®ç° <code>props</code></h3><p><strong>éœ€æ±‚:</strong></p><ol type="1"><li>å°† props è¾“å…¥ <code>setup</code>, ä½¿å¾—å¯ä»¥åœ¨ <code>setup</code>ä¸­é€šè¿‡ <code>props.å±æ€§å</code> è°ƒç”¨, åŒæ—¶ <code>props</code> ä¸ºshadowReadonly</li><li>åœ¨ <code>render</code> å¯ä»¥é€šè¿‡ <code>this.å±æ€§å</code> è°ƒç”¨</li></ol><p><strong>å®ç°:</strong></p><ul><li><p>åœ¨ setup æ—¶æ„é€ </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setupComponent</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ...</span>  <span class="token function">initProps</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>é€šè¿‡ç¬¬äºŒç‚¹æˆ‘ä»¬å°±çŸ¥é“æˆ‘ä»¬éœ€è¦å°† props åŠ å…¥componentPublicProxy</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> publicInstanceProxy <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ...</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> target<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token keyword">return</span> target<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>props<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// ...</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å‚è€ƒ Vue çš„API, å¯¹äºç¬¬ä¸€ç‚¹éœ€æ±‚æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹<code>handleSetupResult</code> çš„è°ƒç”¨, ä¼ å…¥æ—¶åŠ å…¥ shadowReadonly</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">handleSetupResult</span><span class="token punctuation">(</span> instance<span class="token punctuation">,</span>      instance<span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> <span class="token function">shadowReadonly</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¸º setup ä¼ å…¥å‚æ•°å³å¯</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> emit <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    props<span class="token punctuation">.</span>foo<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// warn: readonly value</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>æˆ‘ä»¬ä¸ºå•¥ä¸æŠŠ shadowReadonly å†™å…¥ componentPublicProxy å‘¢?è¿™æ ·å²‚ä¸æ˜¯å¯ä»¥ä¿æŠ¤ <code>render</code> ä¸­è°ƒç”¨ä¸ä¼šä¿®æ”¹åŸå€¼? æ²¡æœ‰å¿…è¦,æˆ‘ä»¬åªéœ€è¦ä¿è¯æµ…å±‚ readOnly, è€Œ render æ˜¯ç›´æ¥æ‹¿å±æ€§åçš„, ä¸ä¼šä¿®æ”¹ propsä¸Šçš„å±æ€§å®šä¹‰.</p></li></ul><h3 id="å®ç°-emits">å®ç° <code>emits</code></h3><p><strong>éœ€æ±‚:</strong></p><p>é€šè¿‡ props ä¼ å…¥ä¸€å † <code>onXxxXxx</code> å‡½æ•°åœ¨ <code>setup</code>ä¸­å¯ä»¥é€šè¿‡ <code>emit(xxxXxx)</code> è°ƒç”¨å‡½æ•°. å…¶ä¸­<code>emit</code>é€šè¿‡ <code>setup(props, &#123;emit&#125;)</code> çš„æ–¹å¼ä¼ å…¥.</p><p><strong>æ³¨æ„, è¿™é‡Œå°±æ˜¯å·®ä¸€ä¸ª <code>on</code></strong>.ä½ è¯´ä¸ºå•¥ä»–å¦ˆçš„ä½ è¦å·®ä¸ª <code>on</code> å•Š, æˆ‘å†™ Vue çš„æ—¶å€™ä¹Ÿæ²¡æœ‰å·®å¼‚å•Š,è¿™ä¸ªåº”è¯¥æ˜¯ vue-loader ä¸ºä¼ å…¥çš„ <code>emit</code> ååŠ ä¸Šçš„ (å¦‚:<code>&lt;comp v-on:doSth='xxx'&gt;</code>, å¯èƒ½ä¼šè¢« vue-loader è½¬ä¸º<code>&#123; onDoSth: xxx &#125;</code>)</p><p><strong>é‚£ä¹ˆ, éš¾é“ <code>props</code> ä¸Šçš„ <code>onDoSth</code>ä¸ä¼šè¢«æ³¨å†Œæˆäº‹ä»¶ç›‘å¬å—?</strong> æ€ä¹ˆä¼š, æˆ‘ä»¬çš„äº‹ä»¶ç›‘å¬æ˜¯ä¸º Elementç»‘å®šçš„!</p><p><strong>å®ç°:</strong></p><ul><li><p>å®ç° emit å‡½æ•°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">instance<span class="token punctuation">,</span> event<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> eventName <span class="token operator">=</span> event<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">-([a-z])</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>eventName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// å¦‚æœæ˜¯ xxx-xxx å‘½åæ³•, å°†å…¶è½¬æ¢ä¸ºå°é©¼å³°</span>    eventName <span class="token operator">=</span> eventName<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">-([a-z])</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> lc</span><span class="token punctuation">)</span> <span class="token operator">=></span> lc<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[a-z].*</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>eventName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// å¦‚æœæ˜¯å°é©¼å³°å‘½åæ³•, å°†å…¶è½¬æ¢ä¸ºå¤§é©¼å³°</span>    eventName <span class="token operator">=</span> eventName<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> eventName<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  eventName <span class="token operator">=</span> <span class="token string">'on'</span> <span class="token operator">+</span> eventName<span class="token punctuation">;</span> <span class="token comment">// åŠ å…¥ on</span>  instance<span class="token punctuation">.</span>vNode<span class="token punctuation">.</span>props<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> instance<span class="token punctuation">.</span>vNode<span class="token punctuation">.</span>props<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å°†å‡½æ•°åŠ å…¥å®ä¾‹å¯¹è±¡ <code>$emit</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> specialInstanceKeyMap <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function-variable function">$el</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token operator">=></span> instance<span class="token punctuation">.</span>vNode<span class="token punctuation">.</span>el<span class="token punctuation">,</span>  <span class="token function-variable function">$emit</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">emit</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> instance<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> publicInstanceProxy <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token comment">/*...*/</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæœ‰ä¸ªæ¯”è¾ƒç»•çš„ç‚¹, Vue è¦æ±‚ <code>emit</code> è°ƒç”¨æ–¹æ³•ä¸º<code>emit(åå­—, å‡½æ•°è°ƒç”¨å‚æ•°)</code>, æˆ‘ä»¬è¿™è¾¹å¤šäº†ä¸€ä¸ª<code>instance</code>, æ‰€ä»¥æˆ‘ä»¬åœ¨å®šä¹‰ <code>$emit</code> æ—¶ä¸ºå‡½æ•° bindç¬¬ä¸€ä¸ªå‚æ•°</p></li><li><p>ä¼ å…¥ <code>setup</code> çš„è°ƒç”¨å‚æ•°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">handleSetupResult</span><span class="token punctuation">(</span>    instance<span class="token punctuation">,</span>    instance<span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> <span class="token function">shadowReadonly</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">emit</span><span class="token operator">:</span> instance<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>$emit<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="å®ç°-slot">å®ç° <code>slot</code></h3><p>ä¹‹å‰å·²ç»æ¢³ç†è¿‡ç»„ä»¶çš„ children å­˜å‚¨çš„æ˜¯ slot. Vue æœ‰ä¸‰ç§ slot</p><ul><li>é»˜è®¤ slot: ç›´æ¥ä½œä¸ºå­å…ƒç´ å†™å…¥, åœ¨å­ç»„ä»¶ä¸­ä¼šæŒ‰é¡ºåºå†™å…¥</li><li>å…·å slot: æŒ‡å®šå…ƒç´ æ’å…¥ä»€ä¹ˆåœ°æ–¹</li><li>ä½œç”¨åŸŸ slot: ä¸ºå…·å slot ä¼ å…¥å‚æ•°</li></ul><p>å…ˆè€ƒè™‘ç»„ä»¶çš„ children åº”è¯¥ä¼ å…¥ä»€ä¹ˆæ ·çš„æ•°æ®ç±»å‹(<code>h(comp, &#123;&#125;, children)</code>)</p><ul><li><p>å¦‚æœåªæ”¯æŒé»˜è®¤ slot, æˆ‘ä»¬å¤§å¯å°†æ•°ç»„ä¼ å…¥ children å¹¶å°† renderå‡½æ•°å†™æˆä¸‹é¢è¿™æ ·</p><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> HelloWorld <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å‡è®¾ $slot è¡¨ç¤ºçˆ¶ç»„ä»¶ä¼ å…¥çš„æ’æ§½æ•°ç»„, è®©å­ç»„ä»¶åœ¨æ¸²æŸ“æ—¶ç›´æ¥è§£æ„ä¸Šå»</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>$slot<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'title'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'APP'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function">h</span><span class="token punctuation">(</span>HelloWorld<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">'hi'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'IM LEFT'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'IM RIGHT'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>å¦‚æœéœ€è¦æ”¯æŒå…·åæ’æ§½, æˆ‘ä»¬å¯ä»¥ä¼ å…¥æ•°ç»„, å¹¶åœ¨æ¯ä¸ªå…ƒç´ ä¸Šæ‰“ä¸Š<code>name</code>. ä½†æ˜¯è¿™æ ·æ¯æ¬¡æ”¾å…¥å…ƒç´ éƒ½éœ€è¦ <spanclass="math inline">\(O(n)\)</span> æŸ¥æ‰¾. å¯ä»¥è€ƒè™‘å°†ä¼ å…¥çš„<code>children</code> åšæˆå¯¹è±¡, Key ä¸ºå…·åæ’æ§½åå­—, Value å¯ä»¥æ˜¯ vNodeæ•°ç»„ä¹Ÿå¯ä»¥æ˜¯ vNode.</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> h<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> renderSlots <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../../lib/micro-vue.esm.js'</span><span class="token punctuation">;</span><span class="token keyword">const</span> HelloWorld <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>      <span class="token comment">// ç”±äº this.$slots[key] ä¸çŸ¥é“æ˜¯æ•°ç»„è¿˜æ˜¯å¯¹è±¡, æˆ‘ä»¬ç”¨ä¸€ä¸ªå‡½æ•°è¾…åŠ©å¤„ç†</span>      <span class="token function">renderSlots</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">,</span> <span class="token string">'left'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function">renderSlots</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">,</span> <span class="token string">'right'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'OK'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function">renderSlots</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// è°ƒç”¨é»˜è®¤æ’æ§½</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'title'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'APP'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function">h</span><span class="token punctuation">(</span>HelloWorld<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">'hi'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'IM LEFT'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// left æ’æ§½</span>        <span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'IM RIGHT'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// right æ’æ§½</span>        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'IM D1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'IM D2'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// é»˜è®¤æ’æ§½</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œ Vue å¼•å…¥äº† <code>renderSlots</code> å‡½æ•°,æˆ‘ä»¥ä¸ºå…¶ä½œç”¨å°±æ˜¯æ‰¾åˆ°æ’æ§½å¹¶è½¬æ¢ä¸ºæ•°ç»„, å°±åƒä¸‹é¢è¿™æ ·</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">renderSlots</span><span class="token punctuation">(</span>slots<span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">'default'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> rSlots <span class="token operator">=</span> slots<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">?</span> slots<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token function">isObject</span><span class="token punctuation">(</span>slots<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span>rSlots<span class="token punctuation">]</span> <span class="token operator">:</span> rSlots<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯å®é™…ä¸Šè¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª vNode, Vue ä¼šç›´æ¥å°†ä¸€ä¸ªæˆ–å¤šä¸ª vNodeæ‰“åŒ…æˆä¸€ä¸ª vNode è¿”å›ä»è€Œè§„é¿æ•°ç»„è§£æ„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/componentSlots.ts</span><span class="token keyword">function</span> <span class="token function">renderSlots</span><span class="token punctuation">(</span>slots<span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">'default'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> rSlots <span class="token operator">=</span> name <span class="token keyword">in</span> slots <span class="token operator">?</span> slots<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    rSlots <span class="token operator">=</span> <span class="token function">testAndTransArray</span><span class="token punctuation">(</span>rSlots<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> rSlots<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšğŸ˜Ÿ</p></li><li><p>ç»§ç»­è€ƒè™‘ä½œç”¨åŸŸæ’æ§½, ä¸ºäº†å®ç°ä½œç”¨åŸŸå˜é‡ä¼ é€’,æˆ‘ä»¬éœ€è¦å°†æ’æ§½å®šä¹‰ä¸ºå‡½æ•°, å¹¶åœ¨è°ƒç”¨ <code>renderSolts</code>æ—¶ä¼ å…¥å‚æ•°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> HelloWorld <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>      <span class="token function">renderSlots</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">,</span> <span class="token string">'left'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function">renderSlots</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">,</span> <span class="token string">'right'</span><span class="token punctuation">,</span> <span class="token string">'wuhu'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// ä½œç”¨åŸŸ slot ä¼ å…¥å‚æ•°</span>      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'OK'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function">renderSlots</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">,</span> <span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token string">'wula'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'title'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'APP'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function">h</span><span class="token punctuation">(</span>        HelloWorld<span class="token punctuation">,</span>        <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">'hi'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#123;</span>          <span class="token function-variable function">left</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'IM LEFT'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function-variable function">right</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">foo</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> foo<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">foo</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'IM '</span> <span class="token operator">+</span> foo<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'IM D2'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åªéœ€è¦åœ¨ <code>renderSlots</code> ä¸­åˆ¤æ–­ valueæ˜¯å¯¹è±¡è¿˜æ˜¯å‡½æ•°å¹¶åˆ†ç±»è®¨è®ºå³å¯.</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/componentSlots.ts</span><span class="token keyword">function</span> <span class="token function">renderSlots</span><span class="token punctuation">(</span>slots<span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> rSlots <span class="token operator">=</span> name <span class="token keyword">in</span> slots <span class="token operator">?</span> slots<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// é˜²æ­¢ç»™æ— æ•ˆ Key</span>    <span class="token comment">// å¦‚æœæ˜¯å¯¹è±¡ / æ•°ç»„å°±ä¸ç®¡, å‡½æ•°å°±è°ƒç”¨</span>    rSlots <span class="token operator">=</span> <span class="token function">isObject</span><span class="token punctuation">(</span>rSlots<span class="token punctuation">)</span> <span class="token operator">?</span> rSlots <span class="token operator">:</span> <span class="token function">rSlots</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å°è¯•è½¬ä¸ºæ•°ç»„</span>    rSlots <span class="token operator">=</span> <span class="token function">testAndTransArray</span><span class="token punctuation">(</span>rSlots<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>typeSymbol<span class="token punctuation">.</span>FragmentNode<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> rSlots<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// @packages/share/index.ts</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">testAndTransArray</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">?</span> v <span class="token operator">:</span> <span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>è‡³æ­¤, æˆ‘ä»¬å®ç°äº†æ’æ§½çš„æ¸²æŸ“, å†å®ç°ä¸€äº›å¤–å›´æ–¹æ³•</p><ul><li><p>å®ç° <code>initSlot</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/componentSlots.ts</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initSlot</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  instance<span class="token punctuation">.</span>slots <span class="token operator">=</span> instance<span class="token punctuation">.</span>vNode<span class="token punctuation">.</span>children <span class="token operator">||</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ·»åŠ  <code>$slot</code> å®šä¹‰</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/componentPublicInstance.ts</span><span class="token keyword">const</span> specialInstanceKeyMap <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function-variable function">$el</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token operator">=></span> instance<span class="token punctuation">.</span>vNode<span class="token punctuation">.</span>el<span class="token punctuation">,</span>  <span class="token function-variable function">$emit</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">emit</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> instance<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function-variable function">$slots</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token operator">=></span> instance<span class="token punctuation">.</span>slots<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="å®ç°-fragmentnode">å®ç° <code>FragmentNode</code></h3><p>åœ¨å®ç° <code>renderSolts</code> æ—¶æˆ‘ä»¬ä¸ºå°†å¤šä¸ª vNode æ‰“åŒ…æˆä¸€ä¸ª vNodeé‡‡ç”¨ <code>h('div', &#123;&#125;, rSlots)</code> å°†å¤šä¸ªæ’æ§½æ”¾å…¥äº†ä¸€ä¸ª<code>div</code> ä¸‹. ç„¶è€Œæˆ‘ä»¬å¸Œæœ›åœ¨ HTML ä¸­ä¸ç°å®è¿™ä¸ªå¤šä½™çš„<code>div</code>, æ­¤æ—¶å°±éœ€è¦ <code>Fragment</code> æ ‡ç­¾, å®ƒç›¸å½“äº Vueæ’æ§½ä¸­çš„ <code>&lt;template&gt;&lt;/template&gt;</code> æ ‡ç­¾,æ°¸ä¸ä¼šè¢«æ¸²æŸ“. å…¶å®ç°çš„åŸç†å°±æ˜¯åœ¨ mount æ—¶ä¸æŒ‚è½½çˆ¶èŠ‚ç‚¹,ç›´æ¥å°†å­èŠ‚ç‚¹æŒ‚è½½åˆ° container ä¸Š</p><ul><li><p>å…ˆç”¨ Symbol å®šä¹‰æ ‡ç­¾å</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/vnode.ts</span><span class="token keyword">export</span> <span class="token keyword">const</span> typeSymbol <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">FragmentNode</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'FragmentNode'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åœ¨ <code>patch</code> æ—¶ç‰¹åˆ¤ <code>Fragment</code> (å› ä¸º<code>Fragment</code> ä¸ component, Element åˆ¤æ–­æ¡ä»¶ä¸åŒ,æˆ‘ä»¬æ²¡æ³•æŠŠä»–ä»¬æ”¾å…¥ç”¨ä¸‰ä¸ª <code>case</code> ä¸­)</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/render.ts</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token parameter">vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">switch</span> <span class="token punctuation">(</span>vNode2<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">case</span> typeSymbol<span class="token punctuation">.</span>FragmentNode<span class="token operator">:</span>      <span class="token function">processFragmentNode</span><span class="token punctuation">(</span>vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç‰¹åˆ¤ Fragment</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">default</span><span class="token operator">:</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode2<span class="token punctuation">.</span>shapeFlags <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">ELEMENT</span><span class="token punctuation">)</span>        <span class="token function">processElement</span><span class="token punctuation">(</span>vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">else</span> <span class="token function">processComponent</span><span class="token punctuation">(</span>vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">processFragmentNode</span><span class="token punctuation">(</span><span class="token parameter">vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode1<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token function">mountFragmentNode</span><span class="token punctuation">(</span>vNode2<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">mountFragmentNode</span><span class="token punctuation">(</span><span class="token parameter">vNode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ä¸æŒ‚è½½çˆ¶èŠ‚ç‚¹ç›´æ¥å°†å­èŠ‚ç‚¹æŒ‚è½½åˆ° container ä¸Š</span>  vNode<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> d<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ä¿®æ”¹ <code>renderSlots</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/componentSlots.ts</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">renderSlots</span><span class="token punctuation">(</span>slots<span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> rSlots <span class="token operator">=</span> name <span class="token keyword">in</span> slots <span class="token operator">?</span> slots<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  rSlots <span class="token operator">=</span> <span class="token function">testAndTransArray</span><span class="token punctuation">(</span>rSlots<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>typeSymbol<span class="token punctuation">.</span>FragmentNode<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> rSlots<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//       ^ å°æ”¹ä¸€ä¸‹</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="å®ç°-textnode">å®ç° <code>TextNode</code></h3><p>æˆ‘ä»¬è¿˜å¸Œæœ›åœ¨ HTML ä¸­ä¸ä½¿ç”¨ <code>span</code> å°±å†™å…¥æ–‡å­—, å°±åƒ</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>æˆ‘æƒ³å†™ span å°±å†™ span<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  æƒ³ç›´æ¥å†™å°±ç›´æ¥å†™<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>é™¤éä½¿ç”¨ <code>FragmentNode</code> æˆ‘ä»¬æ— æ³•ä¸æ¸²æŸ“ä¸€æ®µå†…å®¹çš„æ ‡ç­¾, ä½†æ˜¯<code>FragmentNode</code> æ ‡ç­¾çš„ <code>children</code> ä¹Ÿå¿…é¡»æ˜¯ vNode,æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å®šä¹‰ä¸€ä¸ªç‰¹æ®Šæ ‡ç­¾, å®ƒæœ¬èº«ä¼šæ¸²æŸ“ä¸º TextNode</p><ul><li><p>å®šä¹‰ç±»å‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/vnode.ts</span><span class="token keyword">export</span> <span class="token keyword">const</span> typeSymbol <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">FragmentNode</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'FragmentNode'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token literal-property property">TextNode</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'TextNode'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç‰¹åˆ¤ç±»å‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/render.ts</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token parameter">vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">switch</span> <span class="token punctuation">(</span>vNode2<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">case</span> typeSymbol<span class="token punctuation">.</span>FragmentNode<span class="token operator">:</span>      <span class="token function">processFragmentNode</span><span class="token punctuation">(</span>vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> typeSymbol<span class="token punctuation">.</span>TextNode<span class="token operator">:</span> <span class="token comment">// ç‰¹åˆ¤ TextNode</span>      <span class="token function">processTextNode</span><span class="token punctuation">(</span>vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">default</span><span class="token operator">:</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode2<span class="token punctuation">.</span>shapeFlags <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">ELEMENT</span><span class="token punctuation">)</span>        <span class="token function">processElement</span><span class="token punctuation">(</span>vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">else</span> <span class="token function">processComponent</span><span class="token punctuation">(</span>vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">processTextNode</span><span class="token punctuation">(</span><span class="token parameter">vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode1<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token function">mountTextNode</span><span class="token punctuation">(</span>vNode2<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">mountTextNode</span><span class="token punctuation">(</span><span class="token parameter">vNode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>vNode<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é€šè¿‡ createTextNode åˆ›å»º</span>  container<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å‘å¤–éƒ¨æš´éœ²æ¥å£</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/vnode.ts</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createTextVNode</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token function">createVNode</span><span class="token punctuation">(</span>typeSymbol<span class="token punctuation">.</span>TextNode<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ä½¿ç”¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'title'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>        <span class="token function">createTextVNode</span><span class="token punctuation">(</span><span class="token string">'im text'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="å®ç°å·¥å…·å‡½æ•°-getcurrentinstance">å®ç°å·¥å…·å‡½æ•°<code>getCurrentInstance</code></h3><p>è¯¥å‡½æ•°ç”¨äºåœ¨ setup ä¸­è·å–å½“å‰ setup æ‰€åœ¨çš„ instance.åªé¡»åœ¨å…¨å±€å˜é‡ä¸Šæ‰“ä¸ªæ ‡è®°å°±å¯ä»¥å®ç°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/component.ts</span><span class="token keyword">let</span> currentInstance <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">setupStatefulComponent</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>instance<span class="token punctuation">.</span>vNode<span class="token punctuation">.</span>shapeFlags <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">STATEFUL_COMPONENT</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    currentInstance <span class="token operator">=</span> instance<span class="token punctuation">;</span> <span class="token comment">// æ‰“ä¸ªæ ‡è®°å†æ‰§è¡Œ</span>    <span class="token function">handleSetupResult</span><span class="token punctuation">(</span>      instance<span class="token punctuation">,</span>      instance<span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token function">shadowReadonly</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">emit</span><span class="token operator">:</span> instance<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>$emit<span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    currentInstance <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// åˆ é™¤æ ‡è®°</span>  <span class="token punctuation">&#125;</span>  <span class="token function">finishComponentSetup</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> currentInstance<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®ç°-provide-inject">å®ç° <code>provide-inject</code></h3><p><code>provide-inject</code> æœºåˆ¶å…è®¸ç»„ä»¶åœ¨ <code>setup</code>å‡½æ•°ä¸­è°ƒç”¨ <code>provide(key, value)</code> è®¾ç½®ä¸€ä¸ªå˜é‡.åœ¨è‹¥å¹²çº§å„¿ç»„ä»¶ä¸­é€šè¿‡ <code>inject(key)</code> è·å–å€¼çš„ä¿¡æ¯ä¼ é€’æœºåˆ¶.åŒæ—¶è¯¥æœºåˆ¶éµå®ˆç±»ä¼¼å†…å¤–å±‚ä½œç”¨åŸŸåŒåæ—¶çš„å†…å±‚å˜é‡ä¿æŠ¤æœºåˆ¶, ä¾‹å¦‚æœ‰å¦‚ä¸‹provide å…³ç³»</p><pre class="mermaid">graph TBA:provide-a=1  -->  B:provide-a=2  --> C:inject-a=2A:provide-a=1  -->  D:provide-b=1A:provide-a=1  -->  E:inject-a=1 -->  F:inject-b=undefined</pre><p>ä¹Ÿå°±æ˜¯è¯´å½“ç»„ä»¶åœ¨çˆ¶ç»„ä»¶ä¸Šæ— æ³• inject å±æ€§æ—¶ä¼šå‘æ›´ä¸Šå±‚ inject å±æ€§.</p><p>æˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶å®ä¾‹ä¸Šå®šä¹‰ç»„ä»¶çš„ provideä¸è¯¥ç»„ä»¶çš„çˆ¶ç»„ä»¶ç„¶åå®ç°é€’å½’æŸ¥æ‰¾çš„ inject å‡½æ•°. ä½†æ˜¯ JavaScriptçš„åŸå‹é“¾æœ¬èº«å°±æ”¯æŒé€’å½’æŸ¥æ‰¾, æˆ‘ä»¬å¯ä»¥æŒ‡å®šé€šè¿‡æŒ‡å®šæŸä¸ªç»„ä»¶ provide çš„<code>__proto__</code> ä¸ºçˆ¶ç»„ä»¶çš„ provide å®ç°.</p><ul><li><p>åœ¨ instance ä¸ŠåŠ å…¥ provide å±æ€§è®°å½•è¯¥ç»„ä»¶æ‰€ provideçš„æ‰€æœ‰é”®å€¼å¯¹å¹¶è®¾ç½® <code>provide.__proto__ = parent.provide</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createComponent</span><span class="token punctuation">(</span><span class="token parameter">vNode<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ...</span>    parent<span class="token punctuation">,</span> <span class="token comment">// çˆ¶ç»„ä»¶</span>    <span class="token literal-property property">provides</span><span class="token operator">:</span> parent <span class="token operator">?</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>provides<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// ç»„ä»¶çš„ provide</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬è¦æ±‚åœ¨ <code>createComponent</code> çš„æ—¶å€™æä¾›<code>parent</code> å±æ€§, é‚£ä¹ˆæˆ‘ä»¬ä¹Ÿè¦åœ¨è°ƒç”¨è¯¥å‡½æ•°æ—¶åŠ å…¥è¯¥å‚æ•°,è¯¥å‡½æ•°ä¾èµ–å…³ç³»å¦‚ä¸‹</p><pre class="mermaid">  graph TBrender -.-> patch --> processComponent --> mountComponent --> createComponent((createComponent)) -.-> renderEffect -.-> patchpatch --> processElement --> mountElement --> patch</pre><p>ä¸ºäº†è®© <code>createComponent</code> æœ‰å‚æ•°æˆ‘ä»¬éœ€è¦è®©å…¶å‰ç½®å‡½æ•°éƒ½å¸¦parent å‚æ•°, æ‰€æœ‰å¯èƒ½è°ƒç”¨å…¶å‰ç½®å‡½æ•°çš„å‡½æ•°ä¹Ÿè¦å¸¦å‚æ•°.å…¶ä¸­å­˜åœ¨ä¸¤ä¸ªç‰¹æ®Šå‡½æ•°.</p><ul><li><code>render</code>: è¯¥å‡½æ•°ç”¨æ¥æ¸²æŸ“æ ¹èŠ‚ç‚¹, æ ¹èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯<code>null</code></li><li><code>renderEffect</code>: è¯¥å‡½æ•°æ˜¯ç”¨æ¥æ¸²æŸ“ç»„ä»¶<code>instance</code> çš„å­ç»„ä»¶ <code>subTree</code> æ‰€ä»¥ parent å‚æ•°å°±æ˜¯<code>instance</code></li></ul></li><li><p>å®ç° API</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/apiInject.ts</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> getCurrentInstance <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./component'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">provide</span><span class="token punctuation">(</span><span class="token parameter">k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> currentInstance <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> any<span class="token punctuation">;</span>  currentInstance<span class="token punctuation">.</span>provides<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> defaultValue</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> currentInstance <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> any<span class="token punctuation">;</span>  <span class="token keyword">return</span> currentInstance <span class="token operator">&amp;&amp;</span> key <span class="token keyword">in</span> currentInstance<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>provides    <span class="token operator">?</span> currentInstance<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>provides<span class="token punctuation">[</span>key<span class="token punctuation">]</span>    <span class="token operator">:</span> defaultValue<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>æµ‹è¯•å¤–å±‚å±è”½ä¸è·¨ç»„ä»¶ä¼ é€’</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @App.js</span><span class="token keyword">const</span> ProviderOne <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'F1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'B1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">h</span><span class="token punctuation">(</span>ProviderTwo<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> ProviderTwo <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'F2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">'baz'</span><span class="token punctuation">,</span> <span class="token string">'Z2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> i_foo <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> i_bar <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'@ provide 2:'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'foo: '</span> <span class="token operator">+</span> i_foo<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'bar: '</span> <span class="token operator">+</span> i_bar<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">h</span><span class="token punctuation">(</span>Consumer<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> Consumer <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> t <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> i_foo <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> i_bar <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> i_baz <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'baz'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'@ consumer:'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'foo: '</span> <span class="token operator">+</span> i_foo<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'bar: '</span> <span class="token operator">+</span> i_bar<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'baz: '</span> <span class="token operator">+</span> i_baz<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'apiInject'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">h</span><span class="token punctuation">(</span>ProviderOne<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»“æœ</p><pre class="line-numbers language-none"><code class="language-none">apiInject@ provide 2:foo: F1bar: B1@ consumer:foo: F2bar: B1baz: Z2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å°ç»“-1">å°ç»“</h3><p>åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å®Œæˆäº†ç»„ä»¶æŒ‚è½½éƒ¨åˆ†. é‚£æˆ‘ä»¬æŠ˜è…¾äº†ç‚¹ä»€ä¹ˆå‘¢?æˆ‘ä»¬å°±æ˜¯å®ç°äº† <code>h</code> å‡½æ•°çš„ä¸åŒåŠŸèƒ½. åœ¨å®ç° APIçš„æ—¶å€™æˆ‘ä»¬ä¹Ÿè¦ç‰¢è®° API æ˜¯ä¸ºè°å®ç°çš„.</p><table><thead><tr class="header"><th>å‚æ•°</th><th>å¯¹äºç»„ä»¶</th><th>å¯¹äºElement</th></tr></thead><tbody><tr class="odd"><td><code>type</code></td><td>åŒ…å« <code>render</code> ä¸ <code>setup</code> çš„å¯¹è±¡</td><td>æ ‡ç­¾å</td></tr><tr class="even"><td><code>props</code></td><td>ç»„ä»¶å®ä¾‹çš„ <code>props</code></td><td>åŒ…å«å±æ€§ä¸äº‹ä»¶çš„å¯¹è±¡</td></tr><tr class="odd"><td><code>children</code></td><td>slots</td><td>å­å…ƒç´  / å­ç»„ä»¶</td></tr></tbody></table><p>å¯ä»¥å‘ç°, è¿™ä¸ª API è®¾è®¡çš„éå¸¸å¯¹ä»—å·¥æ•´.</p><ul><li><p>å¯¹äº <code>type</code>: åˆ†åˆ«ä¼ å…¥å¯¹è±¡ä¸æ ‡ç­¾å, æ— è¯å¯è¯´</p></li><li><p>å¯¹äº <code>props</code>:</p><ul><li>å¯¹äº Element: ä¼ å…¥ä¸€å † attribute. Element æ˜¯ä¼šè¢«ç›´æ¥æ¸²æŸ“çš„,æˆ‘ä»¬ç›´æ¥å°† Key-Value å†™å…¥æ ‡ç­¾å³å¯. åœ¨å®è·µä¸­æˆ‘ä»¬å‘ç°åšäº‹ä»¶ç»‘å®šæ—¶, ç”±äºvalue æ˜¯å‡½æ•°å, æˆ‘ä»¬æ— æ³•ç›´æ¥å°† <code>onXxx</code> å†™å…¥æ ‡ç­¾.æ‰€ä»¥éœ€è¦æ‰‹åŠ¨å¤„ç†äº‹ä»¶è°ƒç”¨</li><li>å¯¹äºç»„ä»¶: ä¼ å…¥ä¸€å † props ä¸ emits. <strong>éš¾é“å°±æ²¡æœ‰ç±»ä¼¼<code>onClick</code> çš„äº‹ä»¶ç›‘å¬æˆ–è€…ç±»ä¼¼ <code>style</code> çš„å±æ€§å—?æ²¡æœ‰! ç»„ä»¶æœ¬èº«æ˜¯ä¸ä¼šè¢«æ¸²æŸ“çš„! ä¸å¯èƒ½å‘ç»„ä»¶æ ‡ç­¾ä¸Šç»‘å®šä»€ä¹ˆä¸œè¥¿.ç»„ä»¶èƒ½ä¼ å…¥çš„åªæœ‰ç”¨äº setup / render çš„å±æ€§ä¸ emits äº‹ä»¶</strong></li></ul></li><li><p>å¯¹äº <code>children</code>:</p><ul><li><p>å¯¹äº Element: ä¼ å…¥ä¸€å †å­å…ƒç´  / å­ç»„ä»¶, æŒ¨ä¸ª patch å°±è¡Œ</p></li><li><p>å¯¹äºç»„ä»¶: ä¼ å…¥ slots, å°† slots åœ¨æ·»åŠ åˆ°å…ƒç´ ä¸Š</p></li><li><p><strong>ä¸ºå•¥ä¸è®©ç»„ä»¶çš„å­å…ƒç´ ä¹Ÿå†™å…¥ children å‘¢?è¿™æ ·çœ‹çš„å¤šå·¥æ•´!</strong></p><p>ç»„ä»¶çš„å­å…ƒç´ åœ¨ç»„ä»¶çš„ render é‡Œé¢, ä¸åœ¨ <code>children</code></p></li><li><p><strong>ä¸ºå•¥ä¸è®©Elementçš„å­å…ƒç´ ä¹Ÿå†™å…¥ render å‘¢? </strong></p><p>äººå®¶ Element å‹æ ¹å°±æ²¡å¯¹è±¡å­˜å­å…ƒç´ çš„</p></li><li><p><strong>è¿™å°¤é›¨æºªæ‡‚ä¸ªé”¤å­ Vue, è®¾è®¡çš„ APIå’‹è¿˜è¦åˆ†ç±»è®¨è®ºå•Š!</strong></p><p>å®é™…ä¸Šè¿™ä¸ª API è®¾è®¡çš„å¾ˆæœ‰è¶£, çœ‹çœ‹æˆ‘ä»¬åœ¨ templateä¸­æ˜¯æ€ä¹ˆä¹¦å†™çš„(ä»å‰é¢å†æŠ„ä¸€é)</p><p>å¯¹äº Element</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>111<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>222<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>h</code> å‡½æ•°å†™æ³•</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'111'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'222'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯¹äºç»„ä»¶ <pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Comp</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>111<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>222<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Comp</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> <code>h</code> å‡½æ•°å†™æ³•</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">h</span><span class="token punctuation">(</span>Comp<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'111'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'222'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨ç»“æ„ä¸Šæ˜¯å¯¹ä»—çš„. è¿™ API è®¾è®¡çš„å¤ªä¼Ÿå¤§äº†</p></li></ul></li></ul><p>æ­¤å¤–æˆ‘ä»¬è¿˜å®ç°äº†ç‰¹æ®Šçš„ <code>Fragment</code> ä¸ <code>TextNode</code>è¿™ä¿©éƒ½æ˜¯é­”æ”¹ patch å®ç°çš„. æˆ‘ä»¬è¿˜å®ç°äº† <code>provide-inject</code> API,è¿™é‡Œå€ŸåŠ©åŸå‹é“¾å®ç°åŠŸèƒ½ä¹Ÿå¾ˆæœ‰è¶£</p><h2 id="å®ç°-runtime-core-çš„-update-éƒ¨åˆ†">å®ç° runtime-core çš„ updateéƒ¨åˆ†</h2><p>åœ¨å®ç°æ›´æ–°é€»è¾‘æ—¶æˆ‘ä»¬ä¹Ÿè¦å¯¹ç»„ä»¶ä¸ Elementåˆ†ç±»è®¨è®ºå¹¶è°¨è®°å½“å‰å®ç°çš„æ˜¯ç»„ä»¶è¿˜æ˜¯ Element</p><h3 id="åŸºæœ¬æ€æƒ³">åŸºæœ¬æ€æƒ³</h3><ul><li><p>update äº‹ä»¶çš„è§¦å‘è€…æ˜¯<strong>ç»„ä»¶</strong>.å“åº”å¼å¯¹è±¡ä¿®æ”¹åä¼šè§¦å‘å‡½æ•°, è¿™ä¸ªå‡½æ•°ä¸€å®šæ˜¯ç»„ä»¶ä¸Šçš„å‡½æ•°, Elementä¸Šå­˜ä¸äº†å‡½æ•°</p></li><li><p>å“åº”å¼å¯¹è±¡å˜åŒ–åæœ€ååº”è¯¥è§¦å‘çš„æ˜¯ä¾èµ–ç»„ä»¶çš„ <code>render</code>å‡½æ•°, <code>render</code> å‡½æ•°é‡æ–°æ‰§è¡Œå¹¶ç”Ÿæˆæ–°çš„ subTree.</p></li><li><p>æˆ‘ä»¬ä¸èƒ½ç›´æ¥å°†è€çš„ subTree åˆ é™¤æ‰æ›¿æ¢ä¸ºæ–°çš„ subTree,è¿™æ ·æ€§èƒ½æŸè€—å¤ªå¤§, <strong>æˆ‘ä»¬å¸Œæœ›å°½å¯èƒ½å¯¹æ¯”æ–°è€ subTree, æ ¹æ®ä¸¤ä¸ªsubTree ä¹‹é—´çš„å˜åŒ–åˆ·æ–° DOM</strong></p></li><li><p>æˆ‘ä»¬å¯¹æ¯”çš„æ˜¯ vNode, å­˜åœ¨ Element ä¸ç»„ä»¶ä¸¤ç§ vNode,æˆ‘ä»¬è¦åˆ†åˆ«å¯¹ä¸åŒç±»å‹ vNode è®¨è®ºæ›´æ–°æ–¹æ³•</p></li><li><p><strong>å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ª vNode æ˜¯ "åŒç±»å‹" çš„</strong></p><p>è¿™é‡Œçš„ "åŒç±»å‹" æ˜¯æŒ‡ä¸¤ä¸ª vNode å¯ä»¥é€šè¿‡ä¿®æ”¹å¯¹åº” DOM çš„å­å…ƒç´ , ä¿®æ”¹props å®ç°æ›´æ–°, è€Œä¸éœ€è¦å¸è½½DOM.</p><ul><li><p><code>type</code> ä¸åŒçš„ vNode ä¸€å®šä¸æ˜¯åŒç±»å‹çš„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">oldVnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'å‘€å“ˆå“ˆ'</span><span class="token punctuation">)</span>newVnode1 <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'å…‹æ´›æ´›'</span><span class="token punctuation">)</span>newVnode2 <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span>HelloWorld<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¸‰ä¸ª vNode çš„ <code>type</code> ä¸åŒè¿™å¯¼è‡´ DOM æ ‡ç­¾åä¸åŒ,é“å®šæ— æ³•ä¸å¸è½½å…ƒç´ æ›´æ–°</p></li><li><p><code>props.key</code> ä¸åŒä¸€å®šä¸æ˜¯åŒç±»å‹çš„</p><p>åœ¨ Vue ä¸­æˆ‘ä»¬å¯ä»¥æŒ‡å®šå…ƒç´ çš„ key ä½œä¸ºå…ƒç´ çš„ id, ä¸åŒ idçš„å…ƒç´ ä¸€å®šæ˜¯ä¸åŒå‹çš„</p></li></ul><p>ç»¼ä¸Šæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>vNode1.type === vNode2.type &amp;&amp; vNode1.props.key === vNode2.props.key</code>åˆ¤æ–­ä¸¤ä¸ª vNode æ˜¯ä¸æ˜¯åŒç±»å‹çš„</p></li><li><p><strong>å¦‚æœä¸¤ä¸ª vNode æ˜¯ "åŒç±»å‹" çš„å¦‚ä½•æ›´æ–°</strong></p><ul><li><p><strong>vNode æ˜¯ Element å‹çš„</strong></p><p>Element å‹ vNode è¢«å®å®åœ¨åœ¨çš„æ¸²æŸ“åˆ°äº† DOM æ ‘ä¸Š,æˆ‘ä»¬å¸Œæœ›å°½é‡ä¸å¸è½½æŒ‚è½½ DOM å…ƒç´ , è€Œå¸Œæœ›åœ¨åŸ Element ä¸Šåšæ›´æ–°.æˆ‘ä»¬éœ€è¦æ›´æ–° DOM çš„å±æ€§ä¸ children</p><ul><li><p>æ›´æ–° props</p></li><li><p>æ›´æ–° children</p><p>children å¯ä»¥æ˜¯å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥æ˜¯ vNode æ•°ç»„, æˆ‘ä»¬éœ€è¦åˆ†ç±»è®¨è®º</p><ul><li><p>Text å‹åˆ° Text å‹:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">oldVnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'å‘€å“ˆå“ˆ'</span><span class="token punctuation">)</span>newVnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'å…‹æ´›æ´›'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç›´æ¥æ›´æ–° textCont</p></li><li><p>Text å‹åˆ° Array å‹:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">oldVnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'å‘€å“ˆå“ˆ'</span><span class="token punctuation">)</span>newVnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'å…‹æ´›æ´›'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'å“'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åˆ æ‰ DOM çš„ textCont, patch æ–° vNode è¿›å»</p></li><li><p>Array å‹åˆ° Text å‹:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">oldVnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'å…‹æ´›æ´›'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'å“'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>newVnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'å‘€å“ˆå“ˆ'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åˆ æ‰ DOM çš„æ‰€æœ‰ children, å†™å…¥ textContent</p></li><li><p>Array å‹åˆ° Array å‹: æœ€éº»çƒ¦çš„, é‡‡ç”¨åŒç«¯å¯¹æ¯”æ³•,æ‰¾åˆ°èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–çš„åŒºé—´, åˆ é™¤æ–° vNode ä¸­ä¸å­˜åœ¨çš„èŠ‚ç‚¹, åŠ å…¥æ–° vNodeä¸­ç‹¬æœ‰èŠ‚ç‚¹, è°ƒæ•´èŠ‚ç‚¹é¡ºåº</p></li></ul></li></ul></li><li><p><strong>æ–° vNode æ˜¯ç»„ä»¶å‹çš„</strong></p><p>??</p></li></ul></li><li><p><strong>å¦‚æœä¸¤ä¸ª vNode ä¸æ˜¯ "åŒç±»å‹" çš„å¦‚ä½•æ›´æ–°</strong></p><p>å¦‚æœæ˜¯è¿™ç§æƒ…å†µæˆ‘ä»¬å°±æŸæ‰‹æ— ç­–äº†</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">oldVnode1 <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'å‘€å“ˆå“ˆ'</span><span class="token punctuation">)</span>newVnode1 <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'å…‹æ´›æ´›'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä½†æ˜¯è¿™ç§æƒ…å†µæ˜¯ä¸å­˜åœ¨çš„. è‹¥ä¸¤ä¸ªä¸åŒç±»å‹ vNode è¦æ±‚æ›´æ–°,é‚£ä¹ˆå‰é¢ä¸€å®šè°ƒç”¨è¿‡ <code>patch(vNode1, vNode2, ...)</code>,åœ¨æ›´æ–°æ—¶å“ªäº›æƒ…å†µä¼šè°ƒç”¨ <code>vNode1 !== null</code> çš„ patch å‘¢?ç»„ä»¶æ›´æ–°, åŒç±»å‹ Element çš„ Array to Array.ä¸åŒç±»å‹çš„èŠ‚ç‚¹ä¼šè¢«åŒç«¯å¯¹æ¯”ç®—æ³•è§†ä¸ºä¸åŒèŠ‚ç‚¹è€Œè¢«åˆ é™¤ / å¢åŠ æ‰.æ‰€ä»¥ä¸å¯èƒ½è®©ä¸åŒç±»å‹èŠ‚ç‚¹ <code>patch</code> åœ¨ä¸€èµ·.</p></li></ul><h3 id="æ›´æ–°-pipeline">æ›´æ–° pipeline</h3><p>è®©å“åº”å¼å¯¹è±¡æ”¯æŒä¾èµ–æ”¶é›†ä¸è§¦å‘ä¾èµ–. å°†æ•´ä¸ª renderEffect è£…å…¥ effect,è¿™æ„å‘³ç€æ¯æ¬¡å“åº”å¼å¯¹è±¡å‘ç”Ÿå˜åŒ–éƒ½ä¼šé‡å¤è°ƒç”¨ renderEffect.åŒæ—¶æˆ‘ä»¬è¦åŒºåˆ†æ˜¯ mount è¿˜æ˜¯ update, æˆ‘ä»¬å¯ä»¥è®© instance è®°å½•æ›´æ–°å‰çš„subTree å¹¶é»˜è®¤ä¸º null å®ç°è¿™ä¸€åŠŸèƒ½</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/component.ts</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setupRenderEffect</span><span class="token punctuation">(</span><span class="token parameter">instance<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> subTree <span class="token operator">=</span> instance<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>proxy<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">patch</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>subTree<span class="token punctuation">,</span> subTree<span class="token punctuation">,</span> container<span class="token punctuation">,</span> instance<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//    ^ ç¬¬ä¸€æ¬¡æ˜¯ null</span>    instance<span class="token punctuation">.</span>vNode<span class="token punctuation">.</span>el <span class="token operator">=</span> container<span class="token punctuation">;</span>    instance<span class="token punctuation">.</span>subTree <span class="token operator">=</span> subTree<span class="token punctuation">;</span> <span class="token comment">// è®°å½•å½“å‰ subTree</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŒæ­¥ä¿®æ­£ä¸€ä¸‹ <code>createComponent</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createComponent</span><span class="token punctuation">(</span><span class="token parameter">vNode<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ...</span>    <span class="token literal-property property">subTree</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹‹åéœ€è¦å®ç°:</p><ul><li>Element:<ul><li>æ›´æ–° props</li><li>æ›´æ–° children</li></ul></li><li>ç»„ä»¶<ul><li>æ›´æ–°??</li></ul></li></ul><h3 id="element-æ›´æ–°-props">Element æ›´æ–° props</h3><p>ç»™å®šæ›´æ–°å‰åçš„ vNode ä¸ç›®æ ‡ DOM å¯¹è±¡, å®ç° props æ›´æ–°.</p><ul><li><p>å®ç°æµ‹è¯•ç”¨ä¾‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> cnt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> attrValue <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attrValue</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>cnt<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>    window<span class="token punctuation">.</span><span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      attrValue<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attrValue</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token operator">++</span>cnt<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> attrValue<span class="token punctuation">,</span> htmlValue <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">attrValue</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>attrValue<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å…ˆå®ç° <code>updateElement</code> å‡½æ•°</p><p>ç”±äº <code>vNode2</code> æ²¡æœ‰è¢« mount æ‰€ä»¥ <code>vNode2.el</code>ä¸å­˜åœ¨, ä½†æ˜¯ä¸¤ä¸ª vNode å¯¹åº”çš„æ˜¯åŒä¸€ä¸ª DOM å¯¹è±¡, æˆ‘ä»¬å¯ä»¥å°†<code>vNode1.el</code> ç›´æ¥ç»™åˆ° <code>vNode2.el</code>. åŒæ—¶æˆ‘ä»¬å®šä¹‰<code>patchProps</code> ç”¨äºå®ç°åŠŸèƒ½</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">updateElement</span><span class="token punctuation">(</span><span class="token parameter">vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> elem <span class="token operator">=</span> <span class="token punctuation">(</span>vNode2<span class="token punctuation">.</span>el <span class="token operator">=</span> vNode1<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">patchProps</span><span class="token punctuation">(</span>elem<span class="token punctuation">,</span> vNode1<span class="token operator">?.</span>props<span class="token punctuation">,</span> vNode2<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å®ç° <code>patchProps</code></p><p>é¦–å…ˆè¦æ˜ç¡®æˆ‘ä»¬éœ€è¦ patch ä»€ä¹ˆæ ·çš„ props.</p><ul><li>ç©ºå€¼å½“ä¸å­˜åœ¨: å¦‚æœ props æ˜¯ <code>&#123;key: undefined / null&#125;</code>æˆ‘ä»¬å°±ä¸ patch è¿™ä¸ª key</li><li>value å¯èƒ½æ˜¯äº‹ä»¶ç›‘å¬: æˆ‘ä»¬å¯ä»¥å€ŸåŠ© mountElement ä¸­çš„ props å®ç°</li></ul><p>å…ˆå®ç°è¾…åŠ©å‡½æ•°åˆ¤æ–­ key æ˜¯å¦åœ¨ props ä¸Š. å¦‚æœ value æ˜¯ null /undefined / NaN ä¹Ÿå½“ key ä¸å­˜åœ¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/share/index.ts</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isUNKey</span><span class="token punctuation">(</span><span class="token parameter">k<span class="token punctuation">,</span> obj</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> k <span class="token keyword">in</span> obj <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Number<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å®ç° <code>patchProps</code> å‡½æ•°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">patchProps</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">elem</span><span class="token operator">:</span> HTMLElement<span class="token punctuation">,</span> oldProps <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> newProps <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è·å–æ‰€æœ‰ props</span>  <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>oldProps<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>newProps<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  props<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">k</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å‡è®¾ key æ˜¯äº‹ä»¶ç›‘å¬, å°è¯•å°†å…¶è½¬åŒ–ä¸ºå°é©¼å³°</span>    <span class="token keyword">let</span> ek <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^on[A-Z]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span>      <span class="token operator">?</span> k<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^on([A-Z].*)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> e</span><span class="token punctuation">)</span> <span class="token operator">=></span> e<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>    <span class="token comment">// å¦‚æœ key åœ¨è€ vNode ä¸­å­˜åœ¨, åœ¨æ–° vNode ä¸­ä¸å­˜åœ¨: removeAttribute</span>    <span class="token comment">// å¦‚æœ key åœ¨è€ vNode ä¸­å­˜åœ¨, æ˜¯äº‹ä»¶ç›‘å¬: è§£é™¤ é˜²æ­¢ç›‘å¬å‡½æ•°å˜åŒ–</span>    <span class="token comment">// å¦‚æœ key åœ¨è€ vNode ä¸­å­˜åœ¨, ä¸æ˜¯äº‹ä»¶ç›‘å¬, åœ¨æ–° vNode ä¹Ÿæœ‰: ä¸ç®¡</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUNKey</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> oldProps<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isUNKey</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> newProps<span class="token punctuation">)</span> <span class="token operator">||</span> ek<span class="token punctuation">)</span><span class="token punctuation">)</span>      ek <span class="token operator">?</span> elem<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>ek<span class="token punctuation">,</span> oldProps<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span> elem<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ä¸ç®¡è€èŠ‚ç‚¹æœ‰æ²¡æœ‰, æ–°èŠ‚ç‚¹æœ‰: setAttribute / addEventListener</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUNKey</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> newProps<span class="token punctuation">)</span><span class="token punctuation">)</span>      ek        <span class="token operator">?</span> elem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>ek<span class="token punctuation">,</span> newProps<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token operator">:</span> elem<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> newProps<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ä¸ºä»€ä¹ˆå« <code>patchProps</code> ä¸å«<code>updateProps</code>?</p><p>å®é™…ä¸Šè¿™ä¸ªå‡½æ•°ä¹Ÿå¯ä»¥ç”¨äº <code>mountElement</code> ä¸­ props å¤„ç†(ä»¤<code>oldProps = &#123;&#125;</code>), å¹¶ä¸æ˜¯ <code>updateElement</code> ä¸“ç”¨çš„.ä¿®æ”¹</p><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">function mountElement(vNode, container, parent) &#123;  const el &#x3D; (vNode.el &#x3D; document.createElement(vNode.type) as HTMLElement);- Object.keys(vNode.props).forEach((k) &#x3D;&gt; &#123;-   if (&#x2F;^on[A-Z]&#x2F;.test(k))-     el.addEventListener(-       k.replace(&#x2F;^on([A-Z].*)&#x2F;, (_, e) &#x3D;&gt; e[0].toLowerCase() + e.slice(1)),-       vNode.props[k]-     );-   else el.setAttribute(k, vNode.props[k]);- &#125;);+ patchProps(el, &#123;&#125;, vNode.props);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="element-æ›´æ–°-children-å‰ä¸‰ç§æƒ…å†µ">Element æ›´æ–° childrenå‰ä¸‰ç§æƒ…å†µ</h3><ul><li><p>Text to Text</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">T2T</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> ot <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    window<span class="token punctuation">.</span><span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      ot<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> ot <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ot <span class="token operator">?</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'after'</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'before'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token constant">T2T</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åªéœ€ä¿®æ”¹ DOM å†…éƒ¨ textContent, å¦‚æœå†…å®¹ä¸å˜å°±ä¸ä¿®æ”¹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token parameter">vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode2<span class="token punctuation">.</span>shapeFlags <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">TEXT_CHILDREN</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode1<span class="token punctuation">.</span>shapeFlags <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">TEXT_CHILDREN</span><span class="token punctuation">)</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode2<span class="token punctuation">.</span>children <span class="token operator">!==</span> vNode1<span class="token punctuation">.</span>children<span class="token punctuation">)</span>     container<span class="token punctuation">.</span>textContent <span class="token operator">=</span> vNode2<span class="token punctuation">.</span>children<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>Array to Text</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">A2T</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> ot <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    window<span class="token punctuation">.</span><span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      ot<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> ot <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ot      <span class="token operator">?</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'after'</span><span class="token punctuation">)</span>      <span class="token operator">:</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'before'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'before'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°† DOM ä¸­æ‰€æœ‰ Element éƒ½åˆ é™¤, å†™å…¥ conteneText</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token parameter">vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode2<span class="token punctuation">.</span>shapeFlags <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">TEXT_CHILDREN</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode1<span class="token punctuation">.</span>shapeFlags <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">ARRAY_CHILDREN</span><span class="token punctuation">)</span>      <span class="token punctuation">[</span><span class="token operator">...</span>container<span class="token punctuation">.</span>children<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è¿™é‡Œåˆå¹¶äº†ä¸‹ä»£ç , å¦‚æœæ˜¯ Array to Text, é‚£ä¹ˆ Array !== string ä¸€å®šæˆç«‹</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode2<span class="token punctuation">.</span>children <span class="token operator">!==</span> vNode1<span class="token punctuation">.</span>children<span class="token punctuation">)</span>      container<span class="token punctuation">.</span>textContent <span class="token operator">=</span> vNode2<span class="token punctuation">.</span>children<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>Text to Array</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">T2A</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> ot <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    window<span class="token punctuation">.</span><span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      ot<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> ot <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ot      <span class="token operator">?</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'after'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'after'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token operator">:</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'before'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ é™¤å†…éƒ¨ textContent æ’å…¥ vNode æ•°ç»„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token parameter">vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode2<span class="token punctuation">.</span>shapeFlags <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">TEXT_CHILDREN</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode1<span class="token punctuation">.</span>shapeFlags <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">ARRAY_CHILDREN</span><span class="token punctuation">)</span>      <span class="token punctuation">[</span><span class="token operator">...</span>container<span class="token punctuation">.</span>children<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode2<span class="token punctuation">.</span>children <span class="token operator">!==</span> vNode1<span class="token punctuation">.</span>children<span class="token punctuation">)</span>      container<span class="token punctuation">.</span>textContent <span class="token operator">=</span> vNode2<span class="token punctuation">.</span>children<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode1<span class="token punctuation">.</span>shapeFlags <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">TEXT_CHILDREN</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      container<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>      vNode2<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> element<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ä¸º Array to Array é¢„ç•™å‡½æ•°è°ƒç”¨<code>patchKeyedChildren</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token parameter">vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode2<span class="token punctuation">.</span>shapeFlags <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">TEXT_CHILDREN</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode1<span class="token punctuation">.</span>shapeFlags <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">ARRAY_CHILDREN</span><span class="token punctuation">)</span>      <span class="token punctuation">[</span><span class="token operator">...</span>container<span class="token punctuation">.</span>children<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode2<span class="token punctuation">.</span>children <span class="token operator">!==</span> vNode1<span class="token punctuation">.</span>children<span class="token punctuation">)</span>      container<span class="token punctuation">.</span>textContent <span class="token operator">=</span> vNode2<span class="token punctuation">.</span>children<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>vNode1<span class="token punctuation">.</span>shapeFlags <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">TEXT_CHILDREN</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      container<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>      vNode2<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> element<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token function">patchKeyedChildren</span><span class="token punctuation">(</span>vNode1<span class="token punctuation">.</span>children<span class="token punctuation">,</span> vNode2<span class="token punctuation">.</span>children<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="element-æ›´æ–°-children-çš„åŒç«¯å¯¹æ¯”æ³•">Element æ›´æ–° childrençš„åŒç«¯å¯¹æ¯”æ³•</h3><p><strong>åŸºæœ¬æ€æƒ³</strong></p><p>åˆ†åˆ«ä»å·¦è¾¹å³è¾¹å¯¹æ¯”å…ƒç´ , æ‰¾åˆ°å‘ç”Ÿå˜åŒ–çš„åŒºé—´, ä¾‹å¦‚å‰åä¸¤ä¸ª Arrayåˆ†åˆ«ä¸º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span> a b c d e f g h <span class="token punctuation">]</span><span class="token punctuation">[</span> a b e d i g h <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä»å·¦è¾¹æ‰¾æ‰¾åˆ°åªæœ‰ <code>a b</code> æ˜¯ç›¸åŒçš„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span> a b <span class="token operator">|</span> c d e f g h <span class="token punctuation">]</span><span class="token punctuation">[</span> a b <span class="token operator">|</span> e d i g h <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä»å³è¾¹æ‰¾æ‰¾åˆ°åªæœ‰ <code>g h</code> æ˜¯ç›¸åŒçš„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span> a b <span class="token operator">|</span> c d e f <span class="token operator">|</span> g h <span class="token punctuation">]</span><span class="token punctuation">[</span> a b <span class="token operator">|</span> e d i <span class="token operator">|</span> g h <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æœ€åæˆ‘ä»¬æ‰¾åˆ°å˜åŒ–åŒºé—´(<code>[c d e f] -&gt; [e d i]</code>)</p><p>å°†è€ vNode ç‹¬æœ‰çš„å­ vNode ç§»é™¤(<code>[c f]</code>), å°†æ–° vNodeç‹¬æœ‰çš„å­ vNode patchä¸Š(<code>[i]</code>), è°ƒæ•´å­ vNode çš„é¡ºåº. å¯ä»¥ä½¿ç”¨<code>insertBefore</code> è°ƒæ•´é¡ºåº.</p><ul><li><p>åˆ é™¤è€ vNode ç‹¬æœ‰å­å…ƒç´ </p><p>ä¸ºæ–° vNode å˜åŒ–åŒºé—´ä¸Šçš„å…ƒç´ ç¼–å·, å»ºç«‹ <code>key -&gt; index</code>çš„æ˜ å°„. éå†è€èŠ‚ç‚¹, å¦‚æœæ²¡æœ‰æŸ¥åˆ° key å°±åˆ é™¤èŠ‚ç‚¹</p></li><li><p>åˆ›å»ºæ–° vNode ç‹¬æœ‰çš„å­å…ƒç´ : åœ¨è°ƒæ•´ä½ç½®æ—¶ä¸€å¹¶å¤„ç†</p></li><li><p>è°ƒæ•´ä½ç½®</p><p>å¯ä»¥é€šè¿‡ä¹‹å‰å»ºç«‹çš„ <code>key -&gt; index</code> æ˜ å°„ä¸€è‚¡è„‘çš„å°† DOMè°ƒæ•´åˆ°æ­£å¸¸ä½ç½®, ä½†æ˜¯è°ƒæ•´ DOM çš„ä»£ä»·å¤ªé«˜äº†, æˆ‘ä»¬å¸Œæœ›å°½å¯èƒ½å°‘çš„å‡å°‘<code>insertBefore</code> æ“ä½œ.</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span>l1 l2 <span class="token function">l3</span> <span class="token punctuation">(</span> a b c d e f g h i <span class="token punctuation">)</span> r1 r2 r3<span class="token punctuation">]</span><span class="token punctuation">[</span>l1 l2 <span class="token function">l3</span> <span class="token punctuation">(</span> i a b c d e f g h <span class="token punctuation">)</span> r1 r2 r3<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¦‚æœé‡‡ç”¨ä¸€èˆ¬æ–¹æ³•, æˆ‘ä»¬éœ€è¦åˆ†åˆ«å°† <code>a - h</code> ç§»åŠ¨åˆ°<code>r1</code> å‰é¢. è¿™æ˜æ˜¾ä¸å¦‚å°† <code>i</code> ç§»åŠ¨åˆ° <code>a</code>å‰é¢åˆ’ç®—.</p><p>æˆ‘ä»¬å¯ä»¥åœ¨åŸ vNode çš„å­ vNode æ•°ç»„ä¸­å®šä¹‰ä¸€ä¸ªç¨³å®šä¸²,ä¿è¯ç¨³å®šä¸²ä¸­çš„å…ƒç´ ç›¸å¯¹ä½ç½®ç¬¦åˆæ–° vNode è®¾å®š, æˆ‘ä»¬åªéœ€è¦éå†æ–° vNodeçš„å­å…ƒç´ , å¦‚æœè¯¥å…ƒç´ æ²¡æœ‰åœ¨è€ vNode ä¸­å‡ºç°å°±åˆ›å»ºå¹¶å°†å…¶ patch åˆ°æŒ‡å®šä½ç½®,å¦‚æœåœ¨éç¨³å®šä¸²ä¸­å‡ºç°æˆ‘ä»¬å°±å°†å…¶ <code>insetBefore</code> åˆ°æŒ‡å®šä½ç½®.è€ƒè™‘åˆ°æˆ‘ä»¬åªæœ‰ <code>insertBefore</code> æ²¡æœ‰ <code>insertAfter</code>å‡½æ•°, æˆ‘ä»¬è¿˜éœ€è¦ä¿è¯ä¸€ä¸ªå…ƒç´ åœ¨ <code>insertBefore</code>å‰ä»–åä¸€ä¸ªçš„å…ƒç´ å·²ç»å°±ä½äº†. æ‰€ä»¥æˆ‘ä»¬éœ€è¦å€’ç€éå†æ–° vNode.</p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, å¯ä»¥å°† <code>a b c d e f g h</code> è§†ä½œç¨³å®šä¸², è°ƒæ•´<code>i</code> åˆ° <code>a</code> å‰å³å¯</p></li><li><p>å°† vNode patch åˆ°æŒ‡å®šä½ç½®</p><p>æƒ³è¦å°† Element è°ƒæ•´åˆ°æŒ‡å®š Element å‰é¢, æˆ‘ä»¬å¯ä»¥é‡‡ç”¨<code>container.insertBefore(elem, target)</code>, å¦‚æœ<code>target == null</code> å°±å°†å…ƒç´ è°ƒæ•´åˆ° container å°¾éƒ¨.</p><p>ä½†æ˜¯å¦‚æœæƒ³å°†æ–° vNode è°ƒæ•´åˆ°æŒ‡å®š Element å‰é¢å°±éœ€è¦è°ƒç”¨ patch äº†,æˆ‘ä»¬éœ€è¦ä¸º patch åŠ å…¥ä¸€ä¸ªé”šç‚¹å‚æ•°æŒ‡å®šå°† vNode patch åˆ°å“ªé‡Œ:<code>patch(vNode1, vNode2, container, parent = null, anchor = null)</code></p></li><li><p>å¯»æ‰¾ç¨³å®šä¸²</p><p>å¯»æ‰¾ç¨³å®šä¸²å…¶å®å°±æ˜¯å¯»æ‰¾ç›¸å¯¹ä½ç½®æ­£ç¡®çš„å°½å¯èƒ½é•¿çš„å­ä¸²,æˆ‘ä»¬åˆå·²çŸ¥é“è€èŠ‚ç‚¹å¯¹åº”çš„æ–°èŠ‚ç‚¹æœ‰ä¸€ä¸ª <code>key -&gt; index</code>çš„æ˜ å°„, åœ¨æ–°èŠ‚ç‚¹ä¸­, index ä¸¥æ ¼é€’å¢, æ‰€ä»¥å¯ä»¥è·å–æ¯ä¸ªè€èŠ‚ç‚¹å¯¹åº”çš„ indexå¹¶æŸ¥æ‰¾ LIS. ä¾‹å¦‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">oldIndex</span><span class="token operator">:</span>  <span class="token number">0</span>  <span class="token number">1</span>  <span class="token number">2</span>    <span class="token number">4</span> <span class="token number">5</span> <span class="token number">6</span> <span class="token number">7</span> <span class="token number">8</span> <span class="token number">9</span> <span class="token number">10</span> <span class="token number">11</span> <span class="token number">3</span>   <span class="token number">12</span> <span class="token number">13</span> <span class="token number">14</span><span class="token literal-property property">oldVNode</span><span class="token operator">:</span> <span class="token punctuation">[</span>l1 l2 <span class="token function">l3</span> <span class="token punctuation">(</span> a b c d e f g  h  i <span class="token punctuation">)</span> r1 r2 r3<span class="token punctuation">]</span><span class="token literal-property property">newVNode</span><span class="token operator">:</span> <span class="token punctuation">[</span>l1 l2 <span class="token function">l3</span> <span class="token punctuation">(</span> i a b c d e f  g  h <span class="token punctuation">)</span> r1 r2 r3<span class="token punctuation">]</span><span class="token literal-property property">newIndex</span><span class="token operator">:</span>  <span class="token number">0</span>  <span class="token number">1</span>  <span class="token number">2</span>    <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token number">6</span> <span class="token number">7</span> <span class="token number">8</span> <span class="token number">9</span>  <span class="token number">10</span> <span class="token number">11</span>  <span class="token number">12</span> <span class="token number">13</span> <span class="token number">14</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥å¾—åˆ° <code>lis = [a b c d e f g h]</code></p></li></ul><p><strong>ç‰¹æ®Šæƒ…å†µ</strong></p><p>å¯ä»¥é’ˆå¯¹éƒ¨åˆ†ç‰¹æ®Šæƒ…å†µç‰¹æ®Šå¤„ç†é¿å…è®¡ç®— LIS</p><ul><li><p>æ–° vNode åªåœ¨æœ€å³è¾¹åŠ äº†ä¸€å †å…ƒç´ : åªéœ€è¦ patch å¤šå‡ºæ¥çš„éƒ¨åˆ†</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">old</span><span class="token operator">:</span> <span class="token punctuation">[</span>a b c<span class="token punctuation">]</span><span class="token keyword">new</span><span class="token operator">:</span> <span class="token punctuation">[</span>a b c d e f<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>æ–° vNode åªåœ¨æœ€å·¦è¾¹åŠ äº†ä¸€å †å…ƒç´ : åªéœ€è¦ patch å¤šå‡ºæ¥çš„éƒ¨åˆ†</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">old</span><span class="token operator">:</span> <span class="token punctuation">[</span>      d e f<span class="token punctuation">]</span><span class="token keyword">new</span><span class="token operator">:</span> <span class="token punctuation">[</span>a b c d e f<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>æ–° vNode åªæœ€å³è¾¹å°‘äº†ä¸€å †å…ƒç´ : remove å¤šä½™ vNode çš„ DOM å…ƒç´ .æ³¨æ„è¿™é‡Œ remove çš„ä¸èƒ½æ˜¯ vNode, è¿™æ ·ä¸ç®¡å­ vNode æ˜¯ Elementè¿˜æ˜¯ç»„ä»¶ç±»å‹çš„éƒ½å¯ä»¥ä¸€é”®å¸è½½(å› ä¸º ELement æˆ– ç»„ä»¶ç±»å‹çš„ vNode å¯¹åº”çš„ DOMæ ‘éƒ½ä¸€å®šåªæœ‰ä¸€ä¸ªæ ¹ Element)</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">old</span><span class="token operator">:</span> <span class="token punctuation">[</span>a b c d e f<span class="token punctuation">]</span><span class="token keyword">new</span><span class="token operator">:</span> <span class="token punctuation">[</span>a b c<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>æ–° vNode åªæœ€å·¦è¾¹å°‘äº†ä¸€å †å…ƒç´ : remove å¤šä½™ vNode çš„ DOM å…ƒç´ </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">old</span><span class="token operator">:</span> <span class="token punctuation">[</span>a b c d e f<span class="token punctuation">]</span><span class="token keyword">new</span><span class="token operator">:</span> <span class="token punctuation">[</span>      d e f<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul><p><strong>æˆ‘çš„éƒ¨åˆ†å®ç°</strong></p><p>å®šä¹‰</p><ul><li><code>c1, c2</code>: æ›´æ–°å‰å vNode çš„ children æ•°ç»„</li><li><code>anchor</code>: é”šç‚¹</li><li><code>i</code>: å˜åŒ–åŒºé—´çš„å·¦è¾¹ç•Œ(åŒ…æ‹¬)</li><li><code>e1, e2</code>: å˜åŒ–åŒºé—´å¯¹åº” <code>c1, c2</code>çš„å³è¾¹ç•Œ(åŒ…æ‹¬)</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">patchKeyedChildren</span><span class="token punctuation">(</span><span class="token parameter">c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>    e1 <span class="token operator">=</span> c1<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span>    e2 <span class="token operator">=</span> c2<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// ä»å·¦å¾€å³çœ‹, å¦‚æœç±»å‹ä¸åŒæˆ–è€… key ä¸åŒå°±é€€å‡º, å¦åˆ™é€’å½’æ›´æ–°å­èŠ‚ç‚¹</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>c1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">!==</span> c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">||</span> c1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>key <span class="token operator">!==</span> c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">patch</span><span class="token punctuation">(</span>c1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> container<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// ä»å³å¾€å·¦çœ‹, å¦‚æœç±»å‹ä¸åŒæˆ–è€… key ä¸åŒå°±é€€å‡º, å¦åˆ™é€’å½’æ›´æ–°å­èŠ‚ç‚¹</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> e1 <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> e2 <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> e1 <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">,</span> e2 <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>c1<span class="token punctuation">[</span>e1<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">!==</span> c2<span class="token punctuation">[</span>e2<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">||</span> c1<span class="token punctuation">[</span>e1<span class="token punctuation">]</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>key <span class="token operator">!==</span> c2<span class="token punctuation">[</span>e2<span class="token punctuation">]</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>key<span class="token punctuation">)</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">patch</span><span class="token punctuation">(</span>c1<span class="token punctuation">[</span>e1<span class="token punctuation">]</span><span class="token punctuation">,</span> c2<span class="token punctuation">[</span>e2<span class="token punctuation">]</span><span class="token punctuation">,</span> container<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å³ä¾§æœ‰æ–°èŠ‚ç‚¹</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> c1<span class="token punctuation">.</span>length<span class="token punctuation">)</span>    c2<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span>      <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> d<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> i <span class="token operator">>=</span> c2<span class="token punctuation">.</span>length <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>el<span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å³ä¾§æœ‰è€èŠ‚ç‚¹</span>  <span class="token comment">//     ä¼ å…¥çš„æ˜¯ vNode è¦åŠ ä¸Š el æ‰¾åˆ° DOM å¯¹è±¡</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> c2<span class="token punctuation">.</span>length<span class="token punctuation">)</span> c1<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å·¦ä¾§æœ‰æ–°èŠ‚ç‚¹</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>e1 <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> e2 <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>    c2<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> e2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span>      <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> d<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> c1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>el<span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å·¦ä¾§æœ‰è€èŠ‚ç‚¹</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>e2 <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> e1 <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> c1<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> e1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¸­é—´</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> newRange <span class="token operator">=</span> c2<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> e2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> oldRange <span class="token operator">=</span> c1<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> e1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> k2iNew <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span>newRange<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span>d<span class="token punctuation">.</span>props<span class="token punctuation">.</span>key<span class="token punctuation">,</span> i <span class="token operator">+</span> idx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> k2iOld <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>oldRange<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">.</span>props<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    oldRange<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>       <span class="token comment">// æ–°çš„æœ‰, è€çš„æœ‰ ç›´æ¥æ›´æ–°</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>k2iNew<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>props<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">patch</span><span class="token punctuation">(</span>          d<span class="token punctuation">,</span>          c2<span class="token punctuation">[</span>k2iNew<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>props<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token keyword">as</span> number<span class="token punctuation">]</span><span class="token punctuation">,</span>          container<span class="token punctuation">,</span>          parent<span class="token punctuation">,</span>          anchor        <span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// æ–°çš„æ²¡æœ‰, è€çš„æœ‰ ç›´æ¥åˆ é™¤</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>k2iNew<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>props<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        d<span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        k2iOld<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>props<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ–°çš„æœ‰è€çš„æ²¡æœ‰ æ–°å»ºåˆ°é—®é¢˜åŒºé—´çš„å°¾éƒ¨</span>    newRange<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>k2iOld<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>props<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">patch</span><span class="token punctuation">(</span>          <span class="token keyword">null</span><span class="token punctuation">,</span>          c2<span class="token punctuation">[</span>k2iNew<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>props<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token keyword">as</span> number<span class="token punctuation">]</span><span class="token punctuation">,</span>          container<span class="token punctuation">,</span>          parent<span class="token punctuation">,</span>          e2 <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> c2<span class="token punctuation">.</span>length <span class="token operator">?</span> c2<span class="token punctuation">[</span>e2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>el <span class="token operator">:</span> <span class="token keyword">null</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        k2iOld<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>props<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ... è°ƒæ•´ä½ç½®</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å­˜åœ¨çš„é—®é¢˜</strong></p><ul><li><p>åœ¨ä¸­é—´å¯¹æ¯”æ—¶: æ–°çš„æœ‰è€çš„æ²¡æœ‰çš„æƒ…å†µå¯ä»¥åˆå¹¶åˆ°è°ƒæ•´ä½ç½®ä¸Š</p></li><li><p>ä¸ºåªç”¨å››ä¸ª if è€ƒè™‘äº†ç‰¹æ®Šæƒ…å†µ, æ²¡æœ‰è€ƒè™‘ç‰¹æ®Šæƒ…å†µçš„çš„æ‰©å±•</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">old <span class="token operator">=</span> <span class="token punctuation">[</span>a b c d e f<span class="token punctuation">]</span><span class="token keyword">new</span> <span class="token operator">=</span> <span class="token punctuation">[</span>a b     e f<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ—¢ç„¶ä»å·¦å¾€å³çœ‹ <code>[a b]</code> ä¸€æ ·, æˆ‘ä»¬å¯ä»¥å‡è£…æ¶ˆæ‰<code>[a b]</code> æŠŠ <code>[c d]</code>çœ‹æˆåªæœ‰å·¦ä¾§æœ‰å¤šäºå…ƒç´ çš„æƒ…å†µæ­¤æ—¶ç›´æ¥æ¶ˆé™¤ <code>[c d]</code> å³å¯,ç±»ä¼¼çš„è¿˜æœ‰</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">old <span class="token operator">=</span> <span class="token punctuation">[</span>a b     e f<span class="token punctuation">]</span><span class="token keyword">new</span> <span class="token operator">=</span> <span class="token punctuation">[</span>a b c d e f<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¦‚æœå¯ä»¥ç‰¹åˆ¤è¿™ç§æƒ…å†µå°±çˆ½æ­»äº†</p></li></ul><p><strong>åˆ«ä¸ªçš„å®ç°</strong></p><p>mini-vue çš„å®ç°å’ŒåŸç‰ˆçš„å·®ä¸å¤š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">patchKeyedChildren</span><span class="token punctuation">(</span> <span class="token parameter">c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parentAnchor<span class="token punctuation">,</span> parentComponent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> l2 <span class="token operator">=</span> c2<span class="token punctuation">.</span>length<span class="token punctuation">;</span>  <span class="token keyword">let</span> e1 <span class="token operator">=</span> c1<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> e2 <span class="token operator">=</span> l2 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> <span class="token function-variable function">isSameVNodeType</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> n1<span class="token punctuation">.</span>type <span class="token operator">===</span> n2<span class="token punctuation">.</span>type <span class="token operator">&amp;&amp;</span> n1<span class="token punctuation">.</span>key <span class="token operator">===</span> n2<span class="token punctuation">.</span>key<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token comment">// ... æ±‚ i e1 e2</span>  <span class="token comment">// äººå®¶åœ¨è¿™é‡Œæ˜¯æ¯”è¾ƒäº† e1 e2 i çš„å…³ç³», è¿™æ ·å˜ç›¸çš„ "æ¶ˆé™¤" æ‰äº†å‰åç½®å…ƒç´ </span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">></span> e1 <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;=</span> e2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> nextPos <span class="token operator">=</span> e2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> anchor <span class="token operator">=</span> nextPos <span class="token operator">&lt;</span> l2 <span class="token operator">?</span> c2<span class="token punctuation">[</span>nextPos<span class="token punctuation">]</span><span class="token punctuation">.</span>el <span class="token operator">:</span> parentAnchor<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> e2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">,</span> parentComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>      i<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">></span> e2 <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;=</span> e1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> e1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">hostRemove</span><span class="token punctuation">(</span>c1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>      i<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ... ä¸­é—´å¯¹æ¯”</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªæ˜æ˜¾ä¸å¦‚å››ä¸ª if æ¥çš„ç›´è§‚, ä½†æ˜¯é¡ºé“å¤„ç†äº†ç‰¹æ®Šæƒ…å†µçš„æ‰©å±•æƒ…å†µ.æœ‰ä¸€è¯´ä¸€ vuejs/core åœ¨è¿™ä¸€æ®µä¸­ä»£ç çš„æ³¨é‡Šä¸­ä¹Ÿæ²¡æœ‰æèµ·è¿™ç§æƒ…å†µ,ä½†æ˜¯é€šè¿‡è¿™ä¸ªæ³›æ³›çš„åˆ¤æ–­æ¡ä»¶æˆ‘ä»¬ç¡®å®æ•è·åˆ°äº†è¿™ç§æƒ…å†µ.çœ‹èµ·æ¥è¿™æ˜¯ä¸€ä¸ªæ— æ„ä¸ºä¹‹çš„ä¼˜åŒ–?</p><p><strong>æœ€ç»ˆå®ç°</strong></p><ul><li><p>å®ç° diff</p><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/render.ts</span><span class="token keyword">function</span> <span class="token function">patchKeyedChildren</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">c1</span><span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">c2</span><span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> container<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>    e1 <span class="token operator">=</span> c1<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span>    e2 <span class="token operator">=</span> c2<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> <span class="token function-variable function">isSameType</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">v1<span class="token punctuation">,</span> v2</span><span class="token punctuation">)</span> <span class="token operator">=></span>    v1<span class="token punctuation">.</span>type <span class="token operator">===</span> v2<span class="token punctuation">.</span>type <span class="token operator">&amp;&amp;</span> v1<span class="token punctuation">.</span>props<span class="token punctuation">.</span>key <span class="token operator">===</span> v2<span class="token punctuation">.</span>props<span class="token punctuation">.</span>key<span class="token punctuation">;</span>  <span class="token comment">// æ‰¾åˆ°åŒºé—´</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isSameType</span><span class="token punctuation">(</span>c1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">patch</span><span class="token punctuation">(</span>c1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> container<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> e1 <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> e2 <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> e1 <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">,</span> e2 <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isSameType</span><span class="token punctuation">(</span>c1<span class="token punctuation">[</span>e1<span class="token punctuation">]</span><span class="token punctuation">,</span> c2<span class="token punctuation">[</span>e2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">patch</span><span class="token punctuation">(</span>c1<span class="token punctuation">[</span>e1<span class="token punctuation">]</span><span class="token punctuation">,</span> c2<span class="token punctuation">[</span>e2<span class="token punctuation">]</span><span class="token punctuation">,</span> container<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ç‰¹åˆ¤</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>e2 <span class="token operator">&lt;</span> i <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;=</span> e1<span class="token punctuation">)</span> c1<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> e1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e1 <span class="token operator">&lt;</span> i <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;=</span> e2<span class="token punctuation">)</span>    c2<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> e2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span>      <span class="token function">patch</span><span class="token punctuation">(</span>        <span class="token keyword">null</span><span class="token punctuation">,</span>        d<span class="token punctuation">,</span>        container<span class="token punctuation">,</span>        parent<span class="token punctuation">,</span>        e1 <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">>=</span> c1<span class="token punctuation">.</span>length <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> c1<span class="token punctuation">[</span>e1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>el      <span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¸­é—´</span>  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> newRange <span class="token operator">=</span> c2<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> e2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> oldRange <span class="token operator">=</span> c1<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> e1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> new2oldIndex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–°èŠ‚ç‚¹ index -> è€èŠ‚ç‚¹ index</span>    <span class="token keyword">const</span> key2indexNew <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span> <span class="token comment">// æ–°èŠ‚ç‚¹ key -> æ–°èŠ‚ç‚¹ index</span>      newRange<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span>d<span class="token punctuation">.</span>props<span class="token punctuation">.</span>key<span class="token punctuation">,</span> i <span class="token operator">+</span> idx<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å¦‚æœè€èŠ‚ç‚¹åœ¨æ–°èŠ‚ç‚¹ä¸­å­˜åœ¨ æ„é€  æ–°èŠ‚ç‚¹ index -> è€èŠ‚ç‚¹ index</span>    <span class="token comment">//                     ä¸å­˜åœ¨ åˆ é™¤è€èŠ‚ç‚¹</span>    oldRange<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>key2indexNew<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>props<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        new2oldIndex<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key2indexNew<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>props<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> idx<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> vnode<span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> lis <span class="token operator">=</span> <span class="token constant">LIS</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>new2oldIndex<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ„å»ºç¨³å®šåºåˆ—</span>    newRange<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span>      <span class="token punctuation">(</span><span class="token parameter">prev<span class="token punctuation">,</span> cur<span class="token punctuation">,</span> curIndex</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> oldVnode <span class="token operator">=</span> oldRange<span class="token punctuation">[</span>new2oldIndex<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>curIndex <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// å¯¹åº”è€èŠ‚ç‚¹(å¦‚æœå­˜åœ¨)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>lis<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>curIndex <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// å¤„äºç¨³å®šåºåˆ—å°±åªæ›´æ–°</span>          <span class="token keyword">return</span> <span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> cur<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> prev<span class="token operator">?.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>new2oldIndex<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>curIndex <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// ä¸åœ¨å°±ç§»åŠ¨èŠ‚ç‚¹</span>          container<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> prev<span class="token operator">?.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> cur<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> prev<span class="token operator">?.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> cur<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> prev<span class="token operator">?.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ²¡æœ‰è€èŠ‚ç‚¹å°±åŠ å…¥</span>        <span class="token keyword">return</span> cur<span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      e2 <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">>=</span> c2<span class="token punctuation">.</span>length <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> c2<span class="token punctuation">[</span>e2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>å®ç° LIS</p><p>å®šä¹‰ <code>low</code> æ•°ç»„, <code>low[i]</code> è¡¨ç¤ºé•¿åº¦ä¸º<code>i</code> çš„LISç»“å°¾å…ƒç´ çš„æœ€å°å€¼.å¯¹äºä¸€ä¸ªä¸Šå‡å­åºåˆ—ï¼Œæ˜¾ç„¶å…¶ç»“å°¾å…ƒç´ è¶Šå°, è¶Šæœ‰åˆ©äºåœ¨åé¢æ¥å…¶ä»–çš„å…ƒç´ ,ä¹Ÿå°±è¶Šå¯èƒ½å˜å¾—æ›´é•¿. å› æ­¤, æˆ‘ä»¬åªéœ€è¦ç»´æŠ¤ <code>low</code>æ•°ç»„ï¼Œå¯¹äºæ¯ä¸€ä¸ª <code>s[i]</code>ï¼Œå¦‚æœ<code>s[i] &gt; low[å½“å‰æœ€é•¿çš„LISé•¿åº¦]</code>ï¼Œå°±æŠŠ <code>a[i]</code>æ¥åˆ°å½“å‰æœ€é•¿çš„ LIS åé¢ï¼Œå³ <code>low[++å½“å‰æœ€é•¿çš„LISé•¿åº¦] = a[i]</code>å¯¹äºæ¯ä¸€ä¸ª <code>s[i]</code> ï¼Œå¦‚æœ <code>s[i]</code> èƒ½æ¥åˆ° LISåé¢ï¼Œå°±æ¥ä¸Šå». å¦åˆ™ï¼Œå°±ç”¨ <code>s[i]</code> å–æ›´æ–° <code>low</code>æ•°ç»„ã€‚å…·ä½“æ–¹æ³•æ˜¯, åœ¨ <code>low</code> æ•°ç»„ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºç­‰äº<code>s[i]</code> çš„å…ƒç´  <code>low[j]</code>, ç”¨ <code>s[i]</code>å»æ›´æ–° <code>low[j]</code>. å¦‚æœä»å¤´åˆ°å°¾æ‰«ä¸€é <code>low</code>æ•°ç»„çš„è¯ï¼Œæ—¶é—´å¤æ‚åº¦ä»æ˜¯ <span class="math inline">\(O(n^2)\)</span>.æˆ‘ä»¬æ³¨æ„åˆ° <code>low</code> æ•°ç»„å†…éƒ¨ä¸€å®šæ˜¯å•è°ƒä¸é™çš„. æ‰€æœ‰æˆ‘ä»¬å¯ä»¥äºŒåˆ†<code>low</code> æ•°ç»„ï¼Œæ‰¾å‡ºç¬¬ä¸€ä¸ªå¤§äºç­‰äº <code>s[i]</code> çš„å…ƒç´ .æ€»æ—¶é—´å¤æ‚åº¦ä¸º <span class="math inline">\(O(n \log n)\)</span></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/share/index.ts</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token constant">LIS</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> low <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>s<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> s<span class="token punctuation">.</span>length<span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> cur <span class="token operator">=</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      j <span class="token operator">=</span> res<span class="token punctuation">[</span>res<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> cur<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        low<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> j<span class="token punctuation">;</span>        res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">continue</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">let</span> u <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token keyword">let</span> v <span class="token operator">=</span> res<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>u <span class="token operator">&lt;</span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token punctuation">(</span>u <span class="token operator">+</span> v<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">[</span>res<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> cur<span class="token punctuation">)</span> u <span class="token operator">=</span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">else</span> v <span class="token operator">=</span> c<span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">&lt;</span> s<span class="token punctuation">[</span>res<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>u <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> low<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">[</span>u <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        res<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">let</span> u <span class="token operator">=</span> res<span class="token punctuation">.</span>length<span class="token punctuation">;</span>  <span class="token keyword">let</span> v <span class="token operator">=</span> res<span class="token punctuation">[</span>u <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>u<span class="token operator">--</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span>    v <span class="token operator">=</span> low<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> res<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>ä¸ºä»€ä¹ˆè¦ç”¨åŒç«¯å¯¹æ¯”æ³•</strong></p><ul><li>åŒç«¯å¯¹æ¯”æ³•çš„ç†è®ºæ€§èƒ½å¯èƒ½å¹¶ä¸æ˜¯æœ€ä¼˜ç§€çš„, ä½†æ˜¯å…¶ç”¨äºå‰ç«¯ vNode listçš„å¯¹æ¯”å¾ˆä¼˜ç§€, å› ä¸ºå‰ç«¯ DOM çš„ä¿®æ”¹å¾ˆå°‘æ¶‰åŠå…¨å±€ä¿®æ”¹,ä¸€èˆ¬éƒ½æ˜¯ä¸€ä¸¤ä¸ªå…ƒç´ çš„å¢å‡è°ƒæ¢, åŒç«¯å¯¹æ¯”æ³•å¯ä»¥å¿«é€Ÿé”å®šä¿®æ”¹åŒºé—´,å¿½ç•¥ä¸å˜éƒ¨åˆ†, LIS å¯ä»¥ä¿è¯åœ¨è¾ƒå°‘æ’å…¥æ¬¡æ•°ä¸‹å®ç°ä½ç½®è°ƒæ•´</li><li>ä¸ºä»€ä¹ˆè¦è®¨è®ºç‰¹æ®Šæƒ…å†µ, æ˜æ˜å¯ä»¥ç›´æ¥åˆ©ç”¨æœ€åçš„é€šç”¨ç®—æ³•æ±‚è§£.é¦–å…ˆè¿™ä¸ªç‰¹åˆ¤ä¼šè®©å•æ¬¡ update å¿«å¾ˆå¤š, åŒæ—¶è€ƒè™‘å‰ç«¯åº”ç”¨åœºæ™¯, updateå•ä¸ªå¤´å°¾ / ä¸­éƒ¨å…ƒç´ æ¯”è¾ƒé¢‘ç¹, è¿™ä¸ªç‰¹åˆ¤ä¼šè¢«ç‰¹åˆ«å¤šæ¬¡è°ƒç”¨</li></ul><h3 id="ç»„ä»¶æ›´æ–°">ç»„ä»¶æ›´æ–°</h3><p>ç»„ä»¶ vNode æ›´æ–°æ—¶ <code>setupRenderEffect</code> ä¼šè§¦å‘<code>patch(ç»„ä»¶vNode, ...)</code> æœ€å <code>updateComponent</code></p><p>ä¸ç®¡ç»„ä»¶æœ‰å¤šå¤æ‚æˆ‘ä»¬æ›´æ–°çš„éƒ½æ˜¯ç»„ä»¶æŒ‚è½½çš„ DOM, ç»„ä»¶çš„ renderè¿”å›çš„æ˜¯ä¸€ä¸ª <code>h</code> ä¹Ÿå°±æ˜¯è¯´ç»„ä»¶æœ€å¤šæœ‰ä¸€ä¸ªæ ¹ DOM,æˆ‘ä»¬å¯ä»¥ç›´æ¥æ›´æ–°è¿™ä¸ª DOM.</p><p>æˆ‘ä»¬æ›´æ–°çš„æ—¶å€™æ‹¿åˆ°çš„æ˜¯ vNode, ä½†æ˜¯ä¸ºç»„ä»¶ä¼ å…¥çš„ props è¿˜åœ¨ instanceä¸Š, æˆ‘ä»¬éœ€è¦ä¸º vNode ç»‘å®š instance (ä½¿ç”¨ <code>.component</code>å±æ€§)</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/render.ts</span><span class="token keyword">function</span> <span class="token function">updateComponent</span><span class="token punctuation">(</span><span class="token parameter">vNode1<span class="token punctuation">,</span> vNode2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  vNode2<span class="token punctuation">.</span>el <span class="token operator">=</span> vNode1<span class="token punctuation">.</span>el<span class="token punctuation">;</span> <span class="token comment">// ç»‘å®š DOM</span>  vNode2<span class="token punctuation">.</span>component <span class="token operator">=</span> vNode1<span class="token punctuation">.</span>component<span class="token punctuation">;</span> <span class="token comment">// ç»‘å®š instance</span>  <span class="token comment">// åˆ¤æ–­ props ä¸€ä¸ä¸€æ ·: ä¸€æ ·å°±ä¸æ›´æ–° (è¯´æ˜æ˜¯çˆ¶èŠ‚ç‚¹è§¦å‘äº†, é€’å½’åˆ°å­èŠ‚ç‚¹)</span>  <span class="token comment">//                      ä¸ä¸€æ ·å°±é‡æ–°æ¸²æŸ“è¿™ä¸ªç»„ä»¶ä¸‹çš„ vNode</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSameProps</span><span class="token punctuation">(</span>vNode1<span class="token punctuation">.</span>props<span class="token punctuation">,</span> vNode2<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    vNode1<span class="token punctuation">.</span>component<span class="token punctuation">.</span>vNode <span class="token operator">=</span> vNode2<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æˆ‘ä»¬è¦æ‰‹åŠ¨è§¦å‘è¿™ä¸ªå”¯ä¸€çš„å­ vNode çš„render, æ‰€ä»¥è¿˜éœ€è¦ä¿å­˜æ¯ä¸ª vNode çš„ render å‡½æ•°</span>    <span class="token comment">// ä¿å­˜åœ¨ `.runner`</span>    <span class="token comment">// åŒæ—¶è®°å½• .next ä¸ºæ–° vNode</span>    vNode1<span class="token punctuation">.</span>component<span class="token punctuation">.</span>next <span class="token operator">=</span> vNode2<span class="token punctuation">;</span>    <span class="token comment">// è°ƒç”¨è€ vNode çš„æ¸²æŸ“å‡½æ•°</span>    vNode1<span class="token punctuation">.</span>component<span class="token operator">?.</span>runner <span class="token operator">&amp;&amp;</span> vNode1<span class="token punctuation">.</span>component<span class="token punctuation">.</span><span class="token function">runner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ¤æ–­ç»„ä»¶æ˜¯å¦æœ‰å¿…è¦æ›´æ–°(<code>props</code> ä¸€ä¸ä¸€æ ·)</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/runtime-core/src/component.ts</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isSameProps</span><span class="token punctuation">(</span><span class="token parameter">props1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> props2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>props1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>props2<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  props<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">k</span><span class="token punctuation">)</span> <span class="token operator">=></span> props1<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">!==</span> props2<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>res <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> res<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨æŒ‚è½½ç»„ä»¶æ—¶åŒæ­¥è®°å½• instance</p><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">&#x2F;&#x2F; @packages&#x2F;runtime-core&#x2F;src&#x2F;render.tsfunction mountComponent(vNode, container, parent, anchor) &#123;  const instance &#x3D; createComponent(vNode, parent);+ vNode.component &#x3D; instance;  setupComponent(instance);  setupRenderEffect(instance, container, anchor);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨é‡æ–°æ¸²æŸ“ç»„ä»¶æ—¶è¿ç§» props</p><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">&#x2F;&#x2F; @packages&#x2F;runtime-core&#x2F;src&#x2F;component.tsexport function setupRenderEffect(instance, container, anchor) &#123;+ instance.runner &#x3D; effect(() &#x3D;&gt; &#123;    const subTree &#x3D; instance.render.call(instance.proxy);+   if (instance.next) &#123;+     instance.vNode &#x3D; instance.next;+     instance.props &#x3D; instance.next.props;+     instance.next &#x3D; null;+   &#125;    patch(instance.subTree, subTree, container, instance, anchor);    instance.vNode.el &#x3D; container;    instance.subTree &#x3D; subTree;  &#125;);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®ç°-nexttrick">å®ç° <code>nextTrick</code></h3><p>æˆ‘ä»¬å¸Œæœ›å½“ Reactivity å‘ç”Ÿå˜åŒ–æ—¶ç»„ä»¶ä¸ DOM æ˜¯åŒæ­¥æ›´æ–°çš„,è¿™å¯èƒ½ä¼šå¸¦æ¥ä¸å¿…è¦çš„èµ„æºæ¶ˆè€—, æˆ‘ä»¬å¸Œæœ›ç»„ä»¶æ›´æ–°å¯ä»¥å˜æˆå¼‚æ­¥çš„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> cnt <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    window<span class="token punctuation">.</span><span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> cnt<span class="token punctuation">.</span>value <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> cnt<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™é‡Œä¼šè§¦å‘100æ¬¡ç»„ä»¶æ›´æ–°</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> cnt <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'HTML Context:'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cnt<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚ä½•å®Œæˆå¼‚æ­¥æ›´æ–°å‘¢?æˆ‘ä»¬å¯ä»¥å°†æ›´æ–°ä»»åŠ¡æ”¾å…¥å¾®ä»»åŠ¡è¿™æ ·åªæœ‰åœ¨åŒæ­¥ä»£ç æ‰§è¡Œå®Œæˆåå¾®ä»»åŠ¡æ‰ä¼šæ‰§è¡Œ.è¿™ä¹Ÿæ˜¯ Vue ä¸­ <code>nextTrick</code> çš„å®ç°åŸç†</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ›´æ–°å®é™…ä¸Šå°±æ˜¯æ‰§è¡Œ renderEffect çš„ä¸­ effect çš„ runner. å¯ä»¥åˆ©ç”¨effect-scheduler å®ç°é¦–æ¬¡è§¦å‘æ‰§è¡Œ runner ä¹‹åè§¦å‘æ‰§è¡Œ scheduler. åœ¨scheduler ä¸­æˆ‘ä»¬å¯ä»¥å°†æ›´æ–°äº‹ä»¶åŠ å…¥é˜Ÿåˆ—. å¹¶æ³¨å†Œæ›´æ–°é˜Ÿåˆ—çš„å¾®äº‹ä»¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token literal-property property">jobs</span><span class="token operator">:</span> Set<span class="token operator">&lt;</span>any<span class="token operator">></span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä»»åŠ¡é˜Ÿåˆ—</span><span class="token keyword">function</span> <span class="token function">insertJob</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  jobs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸é‡å¤æ·»åŠ </span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>jobs<span class="token punctuation">.</span>size <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// ç¡®ä¿ä¹‹æ³¨å†Œä¸€ä¸ªå¾®ä»»åŠ¡, é˜²æ­¢åˆ›å»ºä¸å¿…è¦çš„ Promise.resolve()</span>    <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token operator">...</span>jobs<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> jobs<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">d</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setupRenderEffect</span><span class="token punctuation">(</span><span class="token parameter">instance<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  instance<span class="token punctuation">.</span>runner <span class="token operator">=</span> <span class="token function">effect</span><span class="token punctuation">(</span>    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">componentUpdateFn</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// å°†æ›´æ–°å†…å®¹æå‡ºä¸ºå‡½æ•°</span>    <span class="token punctuation">&#123;</span>      <span class="token function-variable function">scheduler</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token function">insertJob</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>runner<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“ Reactivity å‘ç”Ÿå˜åŒ–æ—¶, åŒæ­¥æ‰§è¡Œ insertJob åŒæ­¥ add Set,æ³¨å†Œä¸€ä¸ªå¾®ä»»åŠ¡ç”¨äºåœ¨åŒæ­¥ä»£ç éƒ½æ‰§è¡Œå®Œæˆåæ‰§è¡Œæ‰€æœ‰åˆ·æ–°å‡½æ•°</p><p><strong>æµ‹è¯•</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> cnt <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    window<span class="token punctuation">.</span><span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> cnt<span class="token punctuation">.</span>value <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> cnt<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>vNode<span class="token punctuation">.</span>el<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ­¤æ—¶è¿˜æ²¡ä¿®æ”¹ è¿˜æ˜¯ 1</span>        <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>vNode<span class="token punctuation">.</span>el<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ­¤æ—¶å˜ä¸º 100</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> cnt <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¹Ÿå‘Šè¯‰æˆ‘ä»¬, å¦‚æœåœ¨ Vue ä¸­è§¦å‘äº†ç»„ä»¶å˜åŒ–,å¦‚æœè¿˜éœ€è¦åŒæ—¶è·å–ç»„ä»¶çš„çŠ¶æ€åº”è¯¥ä½¿ç”¨ <code>nextTrick</code></p><h2 id="å®ç°-runtime-dom">å®ç° runtime-dom</h2><p>æˆ‘ä»¬çš„ Vue é»˜è®¤æ˜¯æ¸²æŸ“åœ¨ HTML ä¸Šé¢çš„, å¦‚æœæˆ‘ä»¬å‘å°†ç»„ä»¶æ¸²æŸ“åœ¨ canvasä¸Š(DOM æ ‡ç­¾å˜ä¸º canvas ä¸Šçš„ä¸€ä¸ªå…ƒç´ )å°±éœ€è¦é‡å†™æ‰€æœ‰ DOM APIç›¸å…³çš„å‡½æ•°è°ƒç”¨.</p><p>æˆ‘ä»¬å¸Œæœ›å°†è¿™äº› API æŠ½è±¡å‡ºæ¥ (ä¾‹å¦‚ <code>document.createElement</code>æŠ½è±¡ä¸º <code>create</code> å‡½æ•°). å½“æˆ‘ä»¬éœ€è¦å°† Vue ç»„ä»¶æ¸²æŸ“åœ¨ HTMLæ—¶åªéœ€è¦ä¸º runtime-core ä¼ å…¥ <code>create</code> å‡½æ•°å³å¯.</p><p>è‡³æ­¤æˆ‘ä»¬çš„ç»„ä»¶ä¾èµ–å…³ç³»ç”±<code>vue &gt; runtime-core &gt; reactivity</code> å˜ä¸º<code>vue &gt; runtime-dom &gt; runtime-core &gt; reactivity</code>,runtime-dom å°±æ˜¯ä¸º Vue æä¾› HTML æ¸²æŸ“èƒ½åŠ›çš„ç»„ä»¶</p><p>å®ç° runtime-dom API (å°† runtime-core ä¸­è°ƒç”¨ DOM APIçš„åœ°æ–¹å…¨å†™å‡ºæ¥)</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createRenderer <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../../runtime-core/src/render'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> isUNKey <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../../share'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">createElement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=></span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">createText</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=></span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">remove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>parent <span class="token operator">&amp;&amp;</span> el<span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">insert</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token operator">=></span> parent<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">setText</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> text</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>nodeValue <span class="token operator">=</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">setElementText</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> text</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>textContent <span class="token operator">=</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">patchProps</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">elem</span><span class="token operator">:</span> HTMLElement<span class="token punctuation">,</span> oldProps <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> newProps <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>oldProps<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>newProps<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  props<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">k</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> ek <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^on[A-Z]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span>      <span class="token operator">?</span> k<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^on([A-Z].*)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> e</span><span class="token punctuation">)</span> <span class="token operator">=></span> e<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUNKey</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> oldProps<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isUNKey</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> newProps<span class="token punctuation">)</span> <span class="token operator">||</span> ek<span class="token punctuation">)</span><span class="token punctuation">)</span>      ek <span class="token operator">?</span> elem<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>ek<span class="token punctuation">,</span> oldProps<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span> elem<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUNKey</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> newProps<span class="token punctuation">)</span><span class="token punctuation">)</span>      ek        <span class="token operator">?</span> elem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>ek<span class="token punctuation">,</span> newProps<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token operator">:</span> elem<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> newProps<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬è¿˜éœ€è¦å°† runtime-core æ¥å…¥ runtime-dom, å› ä¸ºæˆ‘ä»¬è¦ä¸º runtime-coreä¼ å…¥åˆšåˆšå®šä¹‰çš„æ¸²æŸ“å‡½æ•°, è°ƒç”¨è¿™äº›æ¸²æŸ“å‡½æ•°çš„æ–‡ä»¶åªæœ‰<code>render.ts</code>. ä¹‹å‰ <code>render.ts</code>æ˜¯é€šè¿‡å¯¼å‡ºå‡½æ•°å‘å¤–æš´éœ² API çš„, ä½†æ˜¯å› ä¸ºæˆ‘ä»¬ä¹Ÿè¦ä¼ å…¥å‡½æ•°, æˆ‘ä»¬åªèƒ½å°†<code>render.ts</code> å¤–éƒ¨åŒ…è£¹ä¸€ä¸ªå‡½æ•°, è®©è¯¥å‡½æ•°ä¼ å…¥ runtime-domå®šä¹‰çš„æ¸²æŸ“å‡½æ•°æœ€åè¿”å›åŸæœ¬éœ€è¦å¯¼å‡ºçš„å‡½æ•°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> renderer<span class="token punctuation">;</span><span class="token comment">// åˆ›å»ºå¯ç”¨ DOM API çš„ render</span><span class="token keyword">function</span> <span class="token function">ensureRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    renderer <span class="token operator">||</span> <span class="token comment">// å¦‚æœåˆ›å»ºè¿‡äº†å°±ä¸é‡å¤åˆ›å»º</span>    <span class="token punctuation">(</span>renderer <span class="token operator">=</span> <span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      createElement<span class="token punctuation">,</span>      createText<span class="token punctuation">,</span>      setText<span class="token punctuation">,</span>      setElementText<span class="token punctuation">,</span>      patchProps<span class="token punctuation">,</span>      insert<span class="token punctuation">,</span>      remove<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// åˆ›å»ºå¯ç”¨ DOM API çš„ createApp</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">createApp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token function">ensureRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'../../runtime-core/src'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®æ”¹ <code>render.ts</code> çš„æ„é€ æ–¹å¼</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span>  createElement<span class="token punctuation">,</span>  createText<span class="token punctuation">,</span>  remove<span class="token punctuation">,</span>  insert<span class="token punctuation">,</span>  setText<span class="token punctuation">,</span>  setElementText<span class="token punctuation">,</span>  patchProps<span class="token punctuation">,</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">vNode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ... å°†è°ƒç”¨ DOM API çš„åœ°æ–¹æ”¹ä¸ºè°ƒç”¨ä¼ å…¥çš„æ¸²æŸ“å‡½æ•°</span>  <span class="token comment">// ... å°†åŸæœ¬æ‰€æœ‰ export çš„å‡½æ•°æ”¹ä¸º return &#123;è¯¥å‡½æ•°&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    render<span class="token punctuation">,</span>    <span class="token literal-property property">createApp</span><span class="token operator">:</span> <span class="token function">createApp</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> render<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>createApp</code> å‡½æ•°éœ€è¦ render, ä½†æ˜¯æˆ‘ä»¬çš„ renderä¹Ÿæ˜¯åŠ¨æ€æ„å»ºçš„, æ‰€ä»¥æˆ‘ä»¬åªèƒ½ä¸º createApp ä¼ å…¥ render, å¹¶åœ¨<code>render.ts</code> ä¸­å…ˆä¼ å…¥è¿™ä¸€å‚æ•°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token parameter">render<span class="token punctuation">,</span> rootComponent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">_component</span><span class="token operator">:</span> rootComponent<span class="token punctuation">,</span>    <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> vNode <span class="token operator">=</span> <span class="token function">createVNode</span><span class="token punctuation">(</span>rootComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">render</span><span class="token punctuation">(</span>        vNode<span class="token punctuation">,</span>        <span class="token function">isObject</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span>          <span class="token operator">?</span> container          <span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span>      <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€åä¿®æ”¹å¯¼å‡º</p><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">export * from &#39;.&#x2F;reactivity&#x2F;src&#x2F;index&#39;;- export * from &#39;.&#x2F;runtime-core&#x2F;src&#x2F;index&#39;;+ export * from &#39;.&#x2F;runtime-dom&#x2F;src&#x2F;index&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>æµ‹è¯•</strong></p><p>å®ç°ä¸€ä¸ª <code>runtime-PIXI</code>, PIXI.js æ˜¯ä¸€ä¸ªåŸºäº canvasçš„æ¸¸æˆåº“, å®Œæˆäº†å¯¹ canvas çš„å°è£…. æˆ‘ä»¬å¸Œæœ›é€šè¿‡å¯¹ PIXI.js APIçš„äºŒæ¬¡å°è£…å®ç°åˆ©ç”¨ Vue æ“ä½œ canvas</p><p>æˆ‘ä»¬å¸Œæœ›å®ç°æ‰§è¡Œ <code>test</code> ä¿®æ”¹æ­£æ–¹å½¢ä½ç½®</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    window<span class="token punctuation">.</span><span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x1<span class="token punctuation">,</span> y1</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      x<span class="token punctuation">.</span>value <span class="token operator">=</span> x1<span class="token punctuation">;</span>      y<span class="token punctuation">.</span>value <span class="token operator">=</span> y1<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">,</span> y <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ºäº†å°†æµ‹è¯•ä»£ç å†™åœ¨ä¸€èµ·, æˆ‘ä»¬å°† runtime-dom å®Œå…¨å¼•å…¥äº†æµ‹è¯•ç”¨ä¾‹å¹¶é‡å†™runtime-dom. è¿™æ ·åšå¯ä»¥å…å»å°†é‡æ–°ç¼–è¯‘ Vue</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// modify to export createRenderer (cause the export level is different from vue runtime-dom)</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createRenderer <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../../lib/micro-vue.esm.js'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'../../lib/micro-vue.esm.js'</span><span class="token punctuation">;</span><span class="token comment">// åˆ›å»ºå…ƒç´ </span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">createElement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> rect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>Graphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  rect<span class="token punctuation">.</span><span class="token function">beginFill</span><span class="token punctuation">(</span><span class="token number">0xff0000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  rect<span class="token punctuation">.</span><span class="token function">drawRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  rect<span class="token punctuation">.</span><span class="token function">endFill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> rect<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// æ’å…¥</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">insert</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token operator">=></span> parent<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ä¿®æ”¹å±æ€§</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">patchProps</span><span class="token punctuation">(</span><span class="token parameter">elem<span class="token punctuation">,</span> oldProps <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> newProps <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>oldProps<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>newProps<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  props<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">k</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    elem<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> newProps<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> renderer<span class="token punctuation">;</span><span class="token comment">// ä¸æµ‹è¯•æ— å…³çš„ API ç›´æ¥ç»™ NULL</span><span class="token keyword">function</span> <span class="token function">ensureRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    renderer <span class="token operator">||</span>    <span class="token punctuation">(</span>renderer <span class="token operator">=</span> <span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      createElement<span class="token punctuation">,</span>      <span class="token literal-property property">createText</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>      <span class="token literal-property property">setText</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>      <span class="token literal-property property">setElementText</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>      patchProps<span class="token punctuation">,</span>      insert<span class="token punctuation">,</span>      <span class="token literal-property property">remove</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">createApp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token function">ensureRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// åˆ›å»º game</span><span class="token keyword">const</span> game <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>Application</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">640</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">360</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æŒ‚è½½ canvas</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span>view<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åœ¨ PIXI ä¸­ canvas DOM ä¸ç”¨äºæŒ‚è½½å…ƒç´ , æ–°å…ƒç´ æ˜¯æŒ‚è½½åˆ° game.stage ä¸Šçš„</span><span class="token keyword">export</span> <span class="token keyword">const</span> el <span class="token operator">=</span> game<span class="token punctuation">.</span>stage<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®ç°-compiler-core">å®ç° compiler-core</h2><pre class="mermaid">graph LRstring(è¾“å…¥string) --> parse(parseæ¨¡å—) --> ast1(è¾“å‡ºASTæ ‘) --> transform(transformæ¨¡å—å¯¹æ ‘CRUD) --> ast2(è¾“å‡ºASTæ ‘) --> CodeGen(CodeGenæ¨¡å—) --> render(è¾“å‡ºrender)</pre><p>æ„å»ºç›¸å…³æ¨¡å—</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">@packages<span class="token operator">/</span>compiler<span class="token operator">-</span>coreâ”œâ”€â”€ srcâ”‚   â””â”€â”€ index<span class="token punctuation">.</span>tsâ””â”€â”€ __tests__<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¹¶å¯¼å‡ºæ¨¡å—</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./reactivity/src/index'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./runtime-dom/src/index'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./compiler-core/src/index'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="å®ç°-parse-æ¨¡å—çš„æ’å€¼è§£æ">å®ç° parse æ¨¡å—çš„æ’å€¼è§£æ</h3><p><strong>éœ€æ±‚</strong></p><p>æˆ‘ä»¬å¸Œæœ›å¯ä»¥è§£æ <code>&#123;&#123;message&#125;&#125;</code> ä¸º AST æ ‘,æ’å€¼è¯­æ³•çš„ AST ä¸º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>  <span class="token literal-property property">type</span><span class="token operator">:</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">INTERPOLATION</span><span class="token punctuation">,</span>  <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">type</span><span class="token operator">:</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">SIMPLE_EXPRESSION</span><span class="token punctuation">,</span>    <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'message'</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å®ç°</strong></p><ul><li>å®šä¹‰æšä¸¾ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">@packages<span class="token operator">/</span>compiler<span class="token operator">-</span>core<span class="token operator">/</span>src<span class="token operator">/</span>ast<span class="token punctuation">.</span>ts<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token keyword">enum</span> NodeTypes <span class="token punctuation">&#123;</span>  <span class="token constant">INTERPOLATION</span><span class="token punctuation">,</span>  <span class="token constant">SIMPLE_EXPRESSION</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å®ç°ç¼–è¯‘ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">@packages<span class="token operator">/</span>compiler<span class="token operator">-</span>core<span class="token operator">/</span>src<span class="token operator">/</span>parse<span class="token punctuation">.</span>ts<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> NodeTypes <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./ast'</span><span class="token punctuation">;</span><span class="token comment">// æ„é€ ä¸Šä¸‹æ–‡, ä¹‹åæºç éƒ½ä» source é‡Œé¢å–</span><span class="token keyword">function</span> <span class="token function">createParserContext</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">source</span><span class="token operator">:</span> content<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// æ„é€  Root èŠ‚ç‚¹, å…¶åªåŒ…å«å­èŠ‚ç‚¹å±æ€§</span><span class="token keyword">function</span> <span class="token function">createRoot</span><span class="token punctuation">(</span><span class="token parameter">children</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    children<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// å¦‚æœä»£ç ä¸­åŒ…å« '&#123;&#123;' å°±æ‰§è¡Œè§£æ</span><span class="token keyword">function</span> <span class="token function">parseChildren</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> nodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">as</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token keyword">as</span> any<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'&#123;&#123;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> node <span class="token operator">=</span> <span class="token function">parseInterpolation</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>  node <span class="token operator">&amp;&amp;</span> nodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> nodes<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// æ‰¾åˆ°ä¸€å¯¹æœ€è¿‘çš„ &#123;&#123; &#125;&#125;, æå–æ’å€¼, åˆ é™¤è¿™ä¸ªæ’å€¼ä»£ç </span><span class="token keyword">function</span> <span class="token function">parseInterpolation</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> closeDelimiter <span class="token operator">=</span> <span class="token string">'&#125;&#125;'</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> openDelimiter <span class="token operator">=</span> <span class="token string">'&#123;&#123;'</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> closeIndex <span class="token operator">=</span> context<span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>    closeDelimiter<span class="token punctuation">,</span>    openDelimiter<span class="token punctuation">.</span>length  <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">adviceBy</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> openDelimiter<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> content <span class="token operator">=</span> context<span class="token punctuation">.</span>source    <span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> closeIndex <span class="token operator">-</span> openDelimiter<span class="token punctuation">.</span>length<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">adviceBy</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> closeIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">type</span><span class="token operator">:</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">INTERPOLATION</span><span class="token punctuation">,</span>    <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">type</span><span class="token operator">:</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">SIMPLE_EXPRESSION</span><span class="token punctuation">,</span>      content<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// æ¨è¿›æ“ä½œ(åˆ é™¤å·²è§£æä»£ç )</span><span class="token keyword">function</span> <span class="token function">adviceBy</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> length</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  context<span class="token punctuation">.</span>source <span class="token operator">=</span> context<span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// è§£æå™¨å…¥å£</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">baseParse</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">content</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token function">createParserContext</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token function">createRoot</span><span class="token punctuation">(</span><span class="token function">parseChildren</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="å®ç°-parse-æ¨¡å—çš„-element-è§£æ">å®ç° parse æ¨¡å—çš„ Elementè§£æ</h3><p><strong>éœ€æ±‚</strong></p><p>è¯†åˆ« <code>&lt;xx&gt;&lt;/xx&gt;</code> çš„ä»£ç å¹¶è§£æä¸º AST æ ‘,å…¶ç»“æ„ä¸º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>  <span class="token literal-property property">type</span><span class="token operator">:</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">ELEMENT</span><span class="token punctuation">,</span>  <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å®ç°</strong></p><ul><li>å®šä¹‰æšä¸¾ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token keyword">enum</span> NodeTypes <span class="token punctuation">&#123;</span>  <span class="token constant">INTERPOLATION</span><span class="token punctuation">,</span>  <span class="token constant">SIMPLE_EXPRESSION</span><span class="token punctuation">,</span>  <span class="token constant">ELEMENT</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å®ç°è§£æå‡½æ•° <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @packages/compiler-core/src/parse.ts</span><span class="token comment">// è¯†åˆ«æ¡ä»¶ &lt;å­—æ¯æ¨¡å¼, è¿™ä¸ªå®šä¹‰çœ‹èµ·æ¥å¾ˆå®½æ¾, ä½†æ˜¯å´æ˜¯æ ‡å‡†å®šä¹‰</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^&lt;[a-zA-Z]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span> node <span class="token operator">=</span> <span class="token function">parseElement</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">parseElement</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> tagMatch <span class="token operator">=</span> context<span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^&lt;([a-zA-Z]*)>.*&lt;\/\1></span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> tag <span class="token operator">=</span> tagMatch<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token function">adviceBy</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> tagMatch<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">type</span><span class="token operator">:</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">ELEMENT</span><span class="token punctuation">,</span>    tag<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="å®ç°-parse-æ¨¡å—çš„-text-è§£æ">å®ç° parse æ¨¡å—çš„ Text è§£æ</h3><p><strong>éœ€æ±‚</strong></p><p>å°†ä¸æ»¡è¶³ä¸¤ç§è§„èŒƒçš„ä»£ç è¯†åˆ«ä¸º Text å¹¶è§£æä¸º AST æ ‘, å…¶ç»“æ„ä¸º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>  <span class="token literal-property property">type</span><span class="token operator">:</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">TEXT</span><span class="token punctuation">,</span>  <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'bulabula'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å®ç°</strong></p><ul><li>å®šä¹‰æšä¸¾: ç•¥</li><li>è¿”å› AST <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">parseText</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> content <span class="token operator">=</span> context<span class="token punctuation">.</span>source<span class="token punctuation">;</span>  <span class="token function">adviceBy</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> content<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">type</span><span class="token operator">:</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">TEXT</span><span class="token punctuation">,</span>    content<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="åŒæ—¶è§£æä¸‰ç§ç±»å‹">åŒæ—¶è§£æä¸‰ç§ç±»å‹</h3><p><strong>éœ€æ±‚</strong></p><p>å°† <code>&lt;div&gt;hi, &#123;&#123;message&#125;&#125;&lt;/div&gt;</code>è§£æä¸º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>  <span class="token literal-property property">type</span><span class="token operator">:</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">ELEMENT</span><span class="token punctuation">,</span>  <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">&#123;</span>      <span class="token literal-property property">type</span><span class="token operator">:</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">TEXT</span><span class="token punctuation">,</span>      <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'hi, '</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span>      <span class="token literal-property property">type</span><span class="token operator">:</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">INTERPOLATION</span><span class="token punctuation">,</span>      <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">type</span><span class="token operator">:</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">SIMPLE_EXPRESSION</span><span class="token punctuation">,</span>        <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'message'</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å®ç°</strong></p><ul><li><p>ä¿®æ­£ Element ä½¿ä¹‹å¯ä»¥è§£æ Element æ ‡ç­¾å†…éƒ¨æ–‡æœ¬</p><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">function parseElement(context) &#123;- const tagMatch &#x3D; context.source.match(&#x2F;^&lt;([a-zA-Z]*)&gt;.*&lt;\&#x2F;\1&gt;&#x2F;);+ const tagMatch &#x3D; context.source.match(&#x2F;^&lt;([a-zA-Z]*)&gt;(.*)&lt;\&#x2F;\1&gt;&#x2F;);  const tag &#x3D; tagMatch[1];  adviceBy(context, tagMatch[0].length);  return &#123;    type: NodeTypes.ELEMENT,    tag,+   children: parseChildren(createParserContext(tagMatch[2])),  &#125;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ä¿®æ­£ Text è§£æä½¿ä¹‹å¯ä»¥åœ¨é‡åˆ°æ’å€¼ / Element å‰å¯¼æ—¶åœæ­¢è§£æ</p><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">function parseText(context) &#123;+ let content &#x3D; context.source;+ if (~content.indexOf(&#39;&#123;&#123;&#39;)) &#123;+   content &#x3D; content.slice(0, content.indexOf(&#39;&#123;&#123;&#39;) );+ &#125; else if (&#x2F;&lt;\&#x2F;?[a-zA-Z].+&#x2F;.test(content)) &#123;+   content &#x3D; content.slice(+     0,+     content.length - content.match(&#x2F;&lt;\&#x2F;?[a-zA-Z].+&#x2F;).length+   );+ &#125;  adviceBy(context, content.length);  return &#123;    type: NodeTypes.TEXT,    content,  &#125;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åœ¨ä¸€æ¬¡è§£æå¹¶æ¨è¿›å®Œæˆåç»§ç»­è§£æå‰©ä½™ä»£ç  <pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">function parseChildren(context) &#123;  const nodes &#x3D; [] as any[];  let node &#x3D; null as any;+ while (context.source) &#123;    if (context.source.startsWith(&#39;&#123;&#123;&#39;)) node &#x3D; parseInterpolation(context);    else if (&#x2F;^&lt;[a-zA-Z]&#x2F;.test(context.source)) node &#x3D; parseElement(context);    else node &#x3D; parseText(context);    nodes.push(node);+ &#125;  return nodes;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="å®ç°-transform-æ¨¡å—">å®ç° Transform æ¨¡å—</h3><p>å¸Œæœ›ä¸º transform ä¼ å…¥ä¸€ä¸ªå‡½æ•°ç»„, å¯¹æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œè¿™äº›å‡½æ•°.æˆ‘ä»¬åªéœ€è¦åšä¸€ä¸ª DFS å³å¯</p><ul><li>DFS <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> NodeTypes <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./ast'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> <span class="token constant">TO_DISPLAY_STRING</span> <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./runtimeHelpers'</span><span class="token punctuation">;</span><span class="token comment">// åˆ›å»ºä¸Šä¸‹æ–‡å¹¶éå†</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token function">createTransformContext</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">traverseNode</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>  root<span class="token punctuation">.</span>helpers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>context<span class="token punctuation">.</span>helpers<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// åˆ›å»ºä¸Šä¸‹æ–‡</span><span class="token keyword">function</span> <span class="token function">createTransformContext</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">root</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">options</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span><span class="token operator">:</span> any <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    root<span class="token punctuation">,</span>    <span class="token literal-property property">nodeTransforms</span><span class="token operator">:</span> options<span class="token punctuation">.</span>nodeTransforms <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token literal-property property">helpers</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">helper</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      context<span class="token punctuation">.</span>helpers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> context<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// éå†èŠ‚ç‚¹, å¦‚æœæ˜¯æ’å€¼èŠ‚ç‚¹å°±è°ƒç”¨ helper, ROOT ä¸ Element å°±éå†å­èŠ‚ç‚¹</span><span class="token keyword">function</span> <span class="token function">traverseNode</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">node</span><span class="token operator">:</span> any<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token literal-property property">exitFns</span><span class="token operator">:</span> any <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">of</span> context<span class="token punctuation">.</span>nodeTransforms<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> onExit <span class="token operator">=</span> <span class="token function">i</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>    onExit <span class="token operator">&amp;&amp;</span> exitFns<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onExit<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">switch</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">case</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">INTERPOLATION</span><span class="token operator">:</span>      context<span class="token punctuation">.</span><span class="token function">helper</span><span class="token punctuation">(</span><span class="token constant">TO_DISPLAY_STRING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">ROOT</span><span class="token operator">:</span>    <span class="token keyword">case</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">ELEMENT</span><span class="token operator">:</span>      <span class="token function">traverseChildren</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">default</span><span class="token operator">:</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> exitFns<span class="token punctuation">.</span>length<span class="token punctuation">;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> exitFns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// éå†å­èŠ‚ç‚¹</span><span class="token keyword">function</span> <span class="token function">traverseChildren</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">node</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">context</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> child <span class="token keyword">of</span> node<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token function">traverseNode</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å®šä¹‰æšä¸¾ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">TO_DISPLAY_STRING</span> <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">toDisplayString</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">CREATE_ELEMENT_VNODE</span> <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">"createElementVNode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> helperNameMap <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token punctuation">[</span><span class="token constant">TO_DISPLAY_STRING</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">"toDisplayString"</span><span class="token punctuation">,</span>  <span class="token punctuation">[</span><span class="token constant">CREATE_ELEMENT_VNODE</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">"createElementVNode"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>ä¸º ROOT æ‰“ä¸Š tag <pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">function createRoot(children) &#123;  return &#123;+   type: NodeTypes.ROOT,    children,  &#125;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="å®ç°-compile-æ¨¡å—">å®ç° compile æ¨¡å—</h3><p>éœ€è¦å°† AST è½¬æ¢ä¸ºä»£ç å­—ç¬¦ä¸². å¯ä»¥å°† AST åˆ†ä¸ºå››ç±»</p><ul><li>Text</li><li>æ’å€¼</li><li>Element: children åªæœ‰ä¸€ä¸ªå…ƒç´  (e.g.<code>&lt;div&gt;as&lt;/div&gt;</code> =&gt;<code>h('div', &#123;&#125;, 'as')</code>)</li><li>Element: children æœ‰å¤šä¸ªå…ƒç´  (e.g.<code>&lt;div&gt;as &#123;&#123;her&#125;&#125;&lt;/div&gt;</code> =&gt;<code>h('div', &#123;&#125;, 'as' + her)</code>), ç§°ä¹‹ä¸ºå¤æ‚ç±»å‹</li></ul><p>å¤„ç†æœ€åä¸€ç§ AST éœ€è¦åœ¨å†…å®¹ä¸­è§£æå‡ºçš„æ¯ä¸ªå…ƒç´ ä¹‹é—´ç”¨ <code>+</code>è¿æ¥</p><ul><li><p>åŠ å…¥æšä¸¾ç±»å‹ <pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">export const enum NodeTypes &#123;  INTERPOLATION,  SIMPLE_EXPRESSION,  ELEMENT,  TEXT,  ROOT,+ COMPOUND_EXPRESSION,&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>ä»£ç ç”Ÿæˆ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> isString <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../../share'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> NodeTypes <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./ast'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>  <span class="token constant">CREATE_ELEMENT_VNODE</span><span class="token punctuation">,</span>  helperNameMap<span class="token punctuation">,</span>  <span class="token constant">TO_DISPLAY_STRING</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./runtimeHelpers'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token parameter">ast</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token function">createCodegenContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºä¸Šä¸‹æ–‡</span>  <span class="token function">genFunctionPreamble</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºä¾èµ–å¼•å…¥</span>  <span class="token keyword">const</span> functionName <span class="token operator">=</span> <span class="token string">'render'</span><span class="token punctuation">;</span> <span class="token comment">// å‡½æ•°å</span>  <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'_ctx'</span><span class="token punctuation">,</span> <span class="token string">'_cache'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// å‡½æ•°å‚æ•°</span>  <span class="token keyword">const</span> signature <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å‡½æ•°å‚æ•°å­—ç¬¦ä¸²</span>  context<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">function </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>functionName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>signature<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">)&#123;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿æ¥å‡½æ•°å¤´</span>  context<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'return '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">genNode</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>codegenNode<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç”Ÿæˆ AST å¯¹åº”çš„å†…æ¨</span>  context<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'&#125;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">code</span><span class="token operator">:</span> context<span class="token punctuation">.</span>code<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">genFunctionPreamble</span><span class="token punctuation">(</span><span class="token parameter">ast<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> VueBinging <span class="token operator">=</span> <span class="token string">'Vue'</span><span class="token punctuation">;</span> <span class="token comment">// å¼•ç”¨è‡ªçš„å˜é‡ `import &#123;...&#125; from Vue`</span>  <span class="token keyword">const</span> <span class="token function-variable function">aliasHelper</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>helperNameMap<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">:_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>helperNameMap<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// å¼•ç”¨ä»£ç ç”Ÿæˆå‡½æ•°</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>ast<span class="token punctuation">.</span>helpers<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// ç”Ÿæˆä»£ç </span>    context<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">const &#123; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>ast<span class="token punctuation">.</span>helpers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>aliasHelper<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> &#125; = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>VueBinging<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  context<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  context<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'return '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">createCodegenContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> any <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>    <span class="token function">push</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// å°†æ‹¼æ¥ä»£ç åŠŸèƒ½å†™å…¥ context</span>      context<span class="token punctuation">.</span>code <span class="token operator">+=</span> source<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function">helper</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>helperNameMap<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> context<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">genNode</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">node</span><span class="token operator">:</span> any<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// åˆ†ç±»ç”Ÿæˆä¸åŒ AST å¯¹åº”çš„ä»£ç </span>  <span class="token keyword">switch</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">case</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">TEXT</span><span class="token operator">:</span>      <span class="token function">genText</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">INTERPOLATION</span><span class="token operator">:</span>      <span class="token function">genInterpolation</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">SIMPLE_EXPRESSION</span><span class="token operator">:</span>      <span class="token function">genExpression</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">ELEMENT</span><span class="token operator">:</span>      <span class="token function">genElement</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">COMPOUND_EXPRESSION</span><span class="token operator">:</span>      <span class="token function">genCompoundExpression</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">default</span><span class="token operator">:</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">genCompoundExpression</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">node</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">context</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> child <span class="token keyword">of</span> node<span class="token punctuation">.</span>children<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isString</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">genNode</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">genElement</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">node</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">context</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  context<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>context<span class="token punctuation">.</span><span class="token function">helper</span><span class="token punctuation">(</span><span class="token constant">CREATE_ELEMENT_VNODE</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">(</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">genNodeList</span><span class="token punctuation">(</span><span class="token function">genNullable</span><span class="token punctuation">(</span><span class="token punctuation">[</span>node<span class="token punctuation">.</span>tag<span class="token punctuation">,</span> node<span class="token punctuation">.</span>props<span class="token punctuation">,</span> node<span class="token punctuation">.</span>children<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>  context<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">')'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">genNodeList</span><span class="token punctuation">(</span><span class="token parameter">nodes<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> node <span class="token operator">=</span> nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isString</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">genNode</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> nodes<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">genNullable</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">args</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> args<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=></span> arg <span class="token operator">||</span> <span class="token string">'null'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">genExpression</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">node</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">context</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  context<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>node<span class="token punctuation">.</span>content<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">genInterpolation</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">node</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">context</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  context<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>context<span class="token punctuation">.</span><span class="token function">helper</span><span class="token punctuation">(</span><span class="token constant">TO_DISPLAY_STRING</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">(</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">genNode</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>content<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>  context<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">')'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">genText</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">node</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">context</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  context<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>node<span class="token punctuation">.</span>content<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>åˆ›å»ºæ ¹èŠ‚ç‚¹çš„å…¥å£èŠ‚ç‚¹ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">createRootCodegen</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">root</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">context</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> children <span class="token punctuation">&#125;</span> <span class="token operator">=</span> root<span class="token punctuation">;</span>  <span class="token keyword">const</span> child <span class="token operator">=</span> children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>type <span class="token operator">===</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">ELEMENT</span> <span class="token operator">&amp;&amp;</span> child<span class="token punctuation">.</span>codegenNode<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> codegenNode <span class="token operator">=</span> child<span class="token punctuation">.</span>codegenNode<span class="token punctuation">;</span>    root<span class="token punctuation">.</span>codegenNode <span class="token operator">=</span> codegenNode<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    root<span class="token punctuation">.</span>codegenNode <span class="token operator">=</span> child<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>Element ç”Ÿæˆå‡½æ•° <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createVNodeCall<span class="token punctuation">,</span> NodeTypes <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"../ast"</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">transformElement</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">ELEMENT</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token comment">// tag</span>      <span class="token keyword">const</span> vnodeTag <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>node<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>      <span class="token comment">// props</span>      <span class="token keyword">let</span> vnodeProps<span class="token punctuation">;</span>      <span class="token comment">// children</span>      <span class="token keyword">const</span> children <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">;</span>      <span class="token keyword">let</span> vnodeChildren <span class="token operator">=</span> children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      node<span class="token punctuation">.</span>codegenNode <span class="token operator">=</span> <span class="token function">createVNodeCall</span><span class="token punctuation">(</span>        context<span class="token punctuation">,</span>        vnodeTag<span class="token punctuation">,</span>        vnodeProps<span class="token punctuation">,</span>        vnodeChildren      <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>ç”Ÿæˆè¡¨è¾¾å¼ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> NodeTypes <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"../ast"</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">transformExpression</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">INTERPOLATION</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    node<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token function">processExpression</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">processExpression</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">node</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  node<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_ctx.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>node<span class="token punctuation">.</span>content<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>  <span class="token keyword">return</span> node<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>ç”Ÿæˆæ–‡æœ¬èŠ‚ç‚¹ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> NodeTypes <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../ast'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> isText <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../utils'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">transformText</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">ELEMENT</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> children <span class="token punctuation">&#125;</span> <span class="token operator">=</span> node<span class="token punctuation">;</span>      <span class="token keyword">let</span> currentContainer<span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> child <span class="token operator">=</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isText</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">const</span> next <span class="token operator">=</span> children<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isText</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>currentContainer<span class="token punctuation">)</span>                currentContainer <span class="token operator">=</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>                  <span class="token literal-property property">type</span><span class="token operator">:</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">COMPOUND_EXPRESSION</span><span class="token punctuation">,</span>                  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>child<span class="token punctuation">]</span><span class="token punctuation">,</span>                <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>              currentContainer<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">' + '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              currentContainer<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>              children<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              j<span class="token operator">--</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>              currentContainer <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>              <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>          <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>Text èŠ‚ç‚¹ä¸ string åˆ¤æ–­å‡½æ•° <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">isString</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isText</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> node<span class="token punctuation">.</span>type <span class="token operator">===</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">INTERPOLATION</span> <span class="token operator">||</span> node<span class="token punctuation">.</span>type <span class="token operator">===</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">TEXT</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="è®©-runtime-core-è°ƒç”¨-compiler-core">è®© runtime-core è°ƒç”¨compiler-core</h3><p>runtime-core ä¼šåœ¨ç¡®å®š instance.render æ—¶è°ƒç”¨ compiler-core. å¦‚æœsetup ä¸è¿”å›å‡½æ•°, ç»„ä»¶æ²¡æœ‰è‡ªå¸¦ render å‡½æ•°, runtime-core ä¼šåœ¨æœ‰ templateæ—¶è°ƒç”¨ compiler-core. compiler-core ä¼šè¿”å›å‡½æ•°ä»£ç , æˆ‘ä»¬éœ€è¦æ ¹æ®ä»£ç è·å¾—render å‡½æ•°</p><p><strong>æµ‹è¯•ä»£ç </strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> h<span class="token punctuation">,</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../../lib/micro-vue.esm.js'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'micro-vue'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    window<span class="token punctuation">.</span><span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'hihi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> message <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div>hi, &#123;&#123;message&#125;&#125;&lt;/div></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å®ç°</strong></p><ul><li><p>æ„é€  compiler-core å‘å¤–æš´éœ²çš„å‡½æ•°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> generate <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./codegen'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> baseParse <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./parse'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> transform <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./transform'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> transformExpression <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./transforms/transformExpression'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> transformElement <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./transforms/transformElement'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> transformText <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./transforms/transformText'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">baseCompile</span><span class="token punctuation">(</span><span class="token parameter">template<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token function">baseParse</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">transform</span><span class="token punctuation">(</span>    ast<span class="token punctuation">,</span>    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">nodeTransforms</span><span class="token operator">:</span> <span class="token punctuation">[</span>transformElement<span class="token punctuation">,</span> transformText<span class="token punctuation">,</span> transformExpression<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åœ¨ runtime-core ä¸­åŠ å…¥ç¼–è¯‘ template åŠŸèƒ½ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">finishComponentSetup</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  instance<span class="token punctuation">.</span>render <span class="token operator">=</span> instance<span class="token punctuation">.</span>render <span class="token operator">||</span> instance<span class="token punctuation">.</span>type<span class="token punctuation">.</span>render <span class="token operator">||</span> <span class="token function">compiler</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>type<span class="token punctuation">.</span>template<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p></li><li><p>ä¸º patchProps åŠ å…¥å…œåº•åŠŸèƒ½ <pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">export function patchProps(elem: HTMLElement, oldProps &#x3D; &#123;&#125;, newProps &#x3D; &#123;&#125;) &#123;+ oldProps ??&#x3D; &#123;&#125;;+ newProps ??&#x3D; &#123;&#125;;  &#x2F;&#x2F; ...&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>å¯¼å‡º createElementNode <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token punctuation">&#123;</span> createVNode <span class="token keyword">as</span> createElementVNode <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜: runtime-core éœ€è¦ä» Vue è·å–ç¼–è¯‘å‡½æ•°è€Œ Vueéœ€è¦å¼•ç”¨ runtime-core. ä¸ºäº†è§£å†³å¾ªç¯ä¾èµ–, å¯ä»¥è®© runtime-core æš´éœ²ä¸€ä¸ªSET å‡½æ•°, å½“æ–‡ä»¶åŠ è½½å®Œæ¯•åè°ƒç”¨ç¥–å†Œå‡½æ•°ä¸º runtime-core æ³¨å†Œæ¥è‡ªcompiler-core çš„ç¼–è¯‘å‡½æ•°.</p><ul><li>åœ¨ runtime-core ä¸­æš´éœ²æ³¨å†Œå‡½æ•° <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> compiler<span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">registerRuntimeCompiler</span><span class="token punctuation">(</span><span class="token parameter">_compiler</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  compiler <span class="token operator">=</span> _compiler<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>åœ¨æœ€å¤–å±‚å¼•å…¥ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./reactivity/src/index'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./runtime-dom/src/index'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> baseCompile <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./compiler-core/src'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> runtimeDom <span class="token keyword">from</span> <span class="token string">'./runtime-dom/src'</span><span class="token punctuation">;</span><span class="token comment">// å°†æ–‡æœ¬è½¬æ¢ä¸ºå‡½æ•°çš„å‡½æ•°</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">compileToFunction</span><span class="token punctuation">(</span><span class="token parameter">template</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ä»£ç </span>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> code <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">baseCompile</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// compiler-core ç¼–è¯‘çš„å‡½æ•°å½¢å¦‚</span>  <span class="token comment">//   import &#123; createElementNode as _createElementNode &#125; from Vue</span>  <span class="token comment">//   return _createElementVNode(...)</span>  <span class="token comment">// æˆ‘ä»¬å¸Œæœ›è·å– return ç»“æœ, å°†è¿™ä¸ªä»£ç æ®µæ„é€ ä¸ºå‡½æ•°</span>  <span class="token comment">//   function ff(Vue)&#123;</span>  <span class="token comment">//     import &#123; createElementNode as _createElementNode &#125; from Vue</span>  <span class="token comment">//     return _createElementVNode(...)</span>  <span class="token comment">//   &#125;</span>  <span class="token comment">// åªéœ€è¦ä¼ å…¥ Vue ä½œä¸ºå‚æ•°å¹¶è·å–å‡½æ•°è¿è¡Œç»“æœå³å¯</span>  <span class="token comment">// æ— éœ€ eval, ç”¨ Function å³å¯æ„é€ å‡½æ•°. å¹¶ä¼ å…¥ Vue å³å¯</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">'Vue'</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">(</span>runtimeDom<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// å°†è¿™ä¸ªç¼–è¯‘å‡½æ•°æ³¨å…¥ runtime-core, runtime-core å³å¯æ‹¥æœ‰ç¼–è¯‘å‡½æ•°</span>runtimeDom<span class="token punctuation">.</span><span class="token function">registerRuntimeCompiler</span><span class="token punctuation">(</span>compileToFunction<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>ç¼–è¯‘åçš„å‡½æ•°éœ€è¦ä¸¤ä¸ªå‚æ•°, ä¼ å…¥ç›¸åŒå€¼ <pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">function componentUpdateFn(instance, container, anchor, patch) &#123;- const subTree &#x3D; instance.render.call(instance.proxy);+ const subTree &#x3D; instance.render.call(instance.proxy, instance.proxy);  if (instance.next) &#123;    instance.vNode &#x3D; instance.next;    instance.props &#x3D; instance.next.props;    &#x2F;&#x2F; ...&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul>]]></content>
    
    
    <summary type="html">å°è¯•ç†è§£ Vue çš„è®¾è®¡æ€æƒ³ä¸å®ç°, å‚è€ƒè‡ª: mini-vue, Vue.js è®¾è®¡ä¸å®ç°</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="å‰ç«¯æ¡†æ¶" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/"/>
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="ç¬”è®°" scheme="https://blog.liukairui.me/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="å‰ç«¯æ¡†æ¶" scheme="https://blog.liukairui.me/tags/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/"/>
    
    <category term="Vue" scheme="https://blog.liukairui.me/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šä½ ä¸çŸ¥é“çš„JavaScriptã€‹å­¦ä¹ </title>
    <link href="https://blog.liukairui.me/article/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84JavaScript%E5%AD%A6%E4%B9%A0/"/>
    <id>https://blog.liukairui.me/article/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84JavaScript%E5%AD%A6%E4%B9%A0/</id>
    <published>2022-07-02T16:00:01.000Z</published>
    <updated>2022-07-02T16:00:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä½œç”¨åŸŸä¸é—­åŒ…">ä½œç”¨åŸŸä¸é—­åŒ…</h2><p>ä½œç”¨åŸŸæ˜¯ä¸€å¥—æ ¹æ®åå­—æŸ¥æ‰¾å˜é‡çš„è§„åˆ™,ä½œç”¨åŸŸç»´æŠ¤äº†æ‰€æœ‰å£°æ˜çš„å˜é‡å¹¶ç¡®å®šå˜é‡çš„è®¿é—®æƒé™.</p><h3 id="ä½œç”¨åŸŸåœ¨ç¼–è¯‘ä¸­çš„äº¤äº’">ä½œç”¨åŸŸåœ¨ç¼–è¯‘ä¸­çš„äº¤äº’</h3><p>JavaScript æ˜¯ä¸€é—¨è§£é‡Šå‹è¯­è¨€, è§£é‡Šå™¨æœ‰ä¸‰éƒ¨åˆ†æ„æˆ</p><ul><li>å¼•æ“: è´Ÿè´£æ•´ä¸ªè§£é‡Šè¿‡ç¨‹</li><li>ç¼–è¯‘å™¨: è¿›è¡Œè¯æ³•è¯­æ³•åˆ†æä¸ä»£ç ç”Ÿæˆ</li><li>ä½œç”¨åŸŸ: ç»´æŠ¤äº†æ‰€æœ‰å£°æ˜çš„å˜é‡ç¡®å®šå˜é‡çš„è®¿é—®æƒé™</li></ul><p><strong>å¼•æ“è¯·æ±‚</strong></p><p>åœ¨è§£é‡Šè¿‡ç¨‹ä¸­, å¼•æ“ä¼šä¸æ–­çš„å‘ä½œç”¨åŸŸå‘å‡º <code>LHS</code> ä¸<code>RHS</code> æŸ¥è¯¢. å¯ä»¥è®¤ä¸º <code>LHS</code> æŸ¥è¯¢æ˜¯åœ¨æŸ¥è¯¢å·¦å€¼,<code>RHS</code> æ˜¯åœ¨æŸ¥è¯¢å³å€¼(æˆ–è€…ç†è§£ä¸ºéå·¦å€¼). æ¢è€Œè¨€ä¹‹,å½“å˜é‡è¦è¿›è¡Œèµ‹å€¼æ“ä½œæ—¶, å¼•æ“ä¼šæ‰§è¡Œ <code>LHS</code> æŸ¥è¯¢,è¿™æ—¶å¼•æ“ä¸å…³å¿ƒå˜é‡çš„å€¼, è€Œå…³å¿ƒå˜é‡çš„ä½ç½®. å…¶ä»–æƒ…å†µä¸‹å¼•æ“æ‰§è¡Œ<code>RHS</code> æŸ¥è¯¢, è¿™æ—¶å¼•æ“åªå…³å¿ƒå˜é‡çš„å€¼.ä½œç”¨åŸŸæ”¶åˆ°è¯·æ±‚åæ ¹æ®è¯·æ±‚æ ‡è¯†ç¬¦è¿”å›å€¼. ä¾‹å¦‚,åœ¨ä¸‹é¢è¿™æ®µä»£ç æ‰§è¡Œæ—¶å‘ç”Ÿäº†å¦‚ä¸‹æŸ¥è¯¢:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol type="1"><li>å°† <code>function foo(a)&#123;&#125;</code> çœ‹ä½œ<code>var foo = function()&#123;&#125;</code>, å¼•æ“æ‰§è¡Œ <code>var foo</code>æ—¶å‘å‡º <code>RHS</code> è¯·æ±‚æŸ¥è¯¢ <code>foo</code>, æŸ¥è¯¢ä¸åˆ°, é‚åˆ›å»º<code>foo</code> å˜é‡</li><li>å¼•æ“æ‰§è¡Œ <code>foo = ...</code> æ—¶å‘å‡º <code>LHS</code> è¯·æ±‚æŸ¥è¯¢<code>foo</code>, æŸ¥è¯¢åˆ°ååˆ†é…å˜é‡</li><li>å¼•æ“æ‰§è¡Œ <code>var b</code> æ—¶å‘å‡º <code>RHS</code> è¯·æ±‚æŸ¥è¯¢<code>b</code>, æŸ¥è¯¢ä¸åˆ°, é‚åˆ›å»º <code>b</code> å˜é‡</li><li>å¼•æ“æ‰§è¡Œ <code>b = 2</code> æ—¶å‘å‡º <code>LHS</code> è¯·æ±‚æŸ¥è¯¢<code>b</code>, æŸ¥è¯¢åˆ°ååˆ†é…å˜é‡</li><li>å¼•æ“æ‰§è¡Œ <code>foo(2)</code> æ—¶å‘å‡º <code>RHS</code> è¯·æ±‚æŸ¥è¯¢<code>foo</code></li><li>å¼•æ“æ‰§è¡Œ <code>foo(2)</code> æ—¶å‘å‡º <code>LHS</code> è¯·æ±‚æŸ¥è¯¢<code>a</code>, æŸ¥è¯¢åˆ°åéšå¼åˆ†é…å˜é‡</li><li>å¼•æ“æ‰§è¡Œ <code>console</code> æ—¶å‘å‡º <code>RHS</code> è¯·æ±‚æŸ¥è¯¢<code>console</code></li><li>å¼•æ“æ‰§è¡Œ <code>console.log</code> æ—¶å‘å‡º <code>RHS</code> è¯·æ±‚æŸ¥è¯¢<code>console</code> ä¸‹çš„ <code>log</code></li><li>å¼•æ“æ‰§è¡Œ <code>console.log(a)</code> æ—¶å‘å‡º <code>RHS</code>è¯·æ±‚æŸ¥è¯¢ <code>a</code></li></ol><p><strong>ä½œç”¨åŸŸå›åº”</strong></p><p>ä½œç”¨åŸŸåœ¨æ”¶åˆ°å¼•æ“çš„ <code>LHS/RHS</code>è¯·æ±‚åä¼šåœ¨æœ¬ä½œç”¨åŸŸä¸‹æŸ¥æ‰¾å¹¶è¿”å›å¯¹æ ‡è¯†ç¬¦çš„å¼•ç”¨</p><p><strong>å¼•æ“çš„å¤„ç†</strong></p><ul><li><p>è‹¥ä½œç”¨åŸŸæ²¡æ‰¾åˆ°æ ‡è¯†ç¬¦:</p><p>å¼•æ“ä¼šè¯·æ±‚ä¸Šä¸€å±‚ä½œç”¨åŸŸç›´åˆ°å…¨å±€ä½œç”¨åŸŸ.è‹¥åœ¨å…¨å±€ä½œç”¨åŸŸä¸­è¿˜æ˜¯æ²¡æ‰¾åˆ°æ ‡è¯†ç¬¦</p><ul><li>è‹¥å‘èµ·çš„æ˜¯ <code>RHS</code> è¯·æ±‚: ç›´æ¥æŠ›å‡º<code>ReferenceError</code></li><li>è‹¥å‘èµ·çš„æ˜¯ <code>LHS</code> è¯·æ±‚: åœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šç›´æ¥åˆ›å»ºå˜é‡,åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæŠ›å‡º <code>ReferenceError</code> å¼‚å¸¸. <strong>æ³¨æ„,è¿™ç§æƒ…å†µé’ˆå¯¹çš„æ˜¯è¯¸å¦‚ <code>b = a</code> çš„æƒ…å†µ, å¦‚æœæ˜¯<code>var b = a</code>, é‚£ä¹ˆå¼•æ“ä¼šå…ˆæ‰§è¡Œ <code>RHS</code> åˆ›å»º<code>b</code> å†æ‰§è¡Œ <code>LHS</code> èµ‹å€¼</strong>.</li></ul></li><li><p>è‹¥ä½œç”¨åŸŸæ‰¾åˆ°æ ‡è¯†ç¬¦</p><ul><li>è‹¥æ˜¯ <code>LHS</code> è¯·æ±‚åˆ™è¿›è¡Œèµ‹å€¼æ“ä½œ</li><li>è‹¥æ˜¯ <code>RHS</code>è¯·æ±‚åˆ™ç»§ç»­åˆ¤æ–­æ˜¯å¦å¯¹å³å€¼è¿›è¡Œéæ³•æ“ä½œ(å¦‚å¯¹éå‡½æ•°å˜é‡æ‰§è¡Œå‡½æ•°è°ƒç”¨)</li></ul></li></ul><h3 id="è¯æ³•ä½œç”¨åŸŸ">è¯æ³•ä½œç”¨åŸŸ</h3><p>ä½œç”¨åŸŸæœ‰ä¸¤ç§å¸¸è§çš„æ¨¡å¼</p><ul><li>è¯æ³•ä½œç”¨åŸŸ: å¤§å¤šæ•°è¯­è¨€(åŒ…æ‹¬JS)é‡‡ç”¨çš„</li><li>åŠ¨æ€ä½œç”¨åŸŸ: Bash/Perlè¯­è¨€é‡‡ç”¨</li></ul><p>ç®€å•çš„è¯´,è¯æ³•ä½œç”¨åŸŸå°±æ˜¯åœ¨<strong>ç¨‹åºæ‰§è¡Œä¹‹å‰çš„è¯æ³•åˆ†æé˜¶æ®µ</strong>ç¡®å®šçš„é™æ€ä½œç”¨åŸŸ.ç¼–è¯‘å™¨ä¼šåœ¨è¯æ³•åˆ†æé˜¶æ®µæ ¹æ®<strong>å˜é‡çš„ä½ç½®å…³ç³»</strong>ç¡®å®šç›´æ¥ç¡®å®šä½œç”¨åŸŸ.</p><p>å¼•æ“è¯·æ±‚ä½œç”¨åŸŸæŸ¥æ‰¾æ—¶, ä½œç”¨åŸŸåªä¼šæŸ¥æ‰¾ä¸€çº§æ ‡è¯†ç¬¦, ä¾‹å¦‚: æŸ¥è¯¢<code>console.log</code> æ—¶, ä½œç”¨åŸŸåªæŸ¥è¯¢ <code>console</code>,åœ¨ä¸‹ä¸€æ¬¡æŸ¥è¯¢æ—¶å€™æ‰åœ¨ <code>console</code> ä¸­æŸ¥è¯¢ <code>log</code></p><p><strong>é®è”½æ•ˆåº”</strong></p><p>å¯¹äºå­˜åœ¨åµŒå¥—å…³ç³»çš„ä½œç”¨åŸŸ,å¼•æ“åœ¨æŸ¥è¯¢æ—¶ä¼šä¼˜å…ˆæŸ¥æ‰¾å†…éƒ¨ä½œç”¨åŸŸè€Œå¿½ç•¥å¤–éƒ¨ä½œç”¨åŸŸä¸­çš„åŒåæ ‡è¯†ç¬¦.å…¨å±€ä½œç”¨åŸŸä¸­çš„å˜é‡ä¼šè¢«è‡ªåŠ¨åŠ å…¥å…¨å±€å¯¹è±¡(<code>window/global</code>),å¯ä»¥ç›´æ¥é€šè¿‡ <code>global</code> è®¿é—®å…¨å±€ä½œç”¨åŸŸå˜é‡,è¿™ä¹Ÿæ˜¯å¿½ç•¥å†…å±‚ä½œç”¨åŸŸçš„å”¯ä¸€æ–¹æ³•.</p><p><strong>æ¬ºéª—è¯æ³•ä½œç”¨åŸŸ</strong></p><p>è¯æ³•ä½œç”¨åŸŸæ˜¯åœ¨è¯æ³•åˆ†æè¿›è¡Œçš„, è¿™æ„å‘³ç€ç¨‹åºå‘˜æ— æ³•åœ¨è¿è¡Œæ—¶ä¿®æ”¹ä½œç”¨åŸŸ,ä½†æ˜¯å­˜åœ¨å‡ ç§æ–¹æ³•å¯ä»¥åŠ¨æ€å¹²é¢„ä½œç”¨åŸŸ</p><ul><li><code>eval</code> å‡½æ•°: åŠ¨æ€çš„ä¸º <code>eval</code>ä¼ å…¥å‚æ•°å¯ä»¥å¯¹å½“å‰ä½œç”¨åŸŸåšåŠ¨æ€ä¿®æ”¹</li><li><code>with</code> å‡½æ•°: ç›¸å½“äºæ‰‹åŠ¨åˆ›å»ºäº†ä¸€ä¸ªä½œç”¨åŸŸ,<code>with</code> çš„å‚æ•°ä¼šè¢«"è§£æ„"ä½œä¸ºä½œç”¨åŸŸä¸­çš„å˜é‡</li><li><code>apply/call/bind</code>å‡½æ•°.</li></ul><p>åŠ¨æ€å¹²é¢„æ–¹æ³•å­˜åœ¨è¯¸å¤šå¼Šç«¯</p><ul><li><p>æ€§èƒ½ä¸‹é™: JavaScript åœ¨æ‰§è¡Œå‰ä¼šæ‰§è¡Œé™æ€åˆ†æä¸æ€§èƒ½ä¼˜åŒ–,ä½†æ˜¯æ— æ³•åˆ†æ <code>eval/with</code> ä¸­çš„åŠ¨æ€ä½œç”¨åŸŸ,äº¦æ— æ³•è¿›è¡Œæ€§èƒ½ä¼˜åŒ–.</p></li><li><p>ä¸¥æ ¼æ¨¡å¼ä¸å¯ç”¨:</p><ul><li>åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ <code>eval</code> å‡½æ•°å†…éƒ¨æœ‰è‡ªå·±çš„ä½œç”¨åŸŸ, æ­¤æ—¶<code>eval</code> å‡½æ•°æ— æ³•å¹²é¢„åŸä½œç”¨åŸŸ</li><li>ä¸¥æ ¼æ¨¡å¼ä¸‹ <code>with</code> ä¸å¯ç”¨</li></ul></li><li><p>æ±¡æŸ“å…¨å±€å˜é‡: ä¾‹å¦‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">t<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">with</span> <span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    a <span class="token operator">=</span> v<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token function">foo</span><span class="token punctuation">(</span>obj1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">foo</span><span class="token punctuation">(</span>obj2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// &#123; a: 1 &#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// &#123; b: 2 &#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>global<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 2 å‘ç”Ÿæ³„æ¼</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>åŠ¨æ€ä½œç”¨åŸŸ</strong></p><p>JavaScript ä½¿ç”¨çš„æ˜¯è¯æ³•ä½œç”¨åŸŸæ¨¡å‹, ä½†æ˜¯éƒ¨åˆ†è¯­è¨€åœ¨é‡‡ç”¨åŠ¨æ€ä½œç”¨åŸŸ</p><ul><li>è¯æ³•ä½œç”¨åŸŸ:è¯æ³•åˆ†æé˜¶æ®µæ ¹æ®<strong>å˜é‡çš„ä½ç½®å…³ç³»</strong>ç¡®å®šç›´æ¥ç¡®å®šä½œç”¨åŸŸ.</li><li>åŠ¨æ€ä½œç”¨åŸŸ: ä½œç”¨åŸŸåœ¨è¿è¡Œæ—¶<strong>åŠ¨æ€å˜åŒ–</strong>,åŠ¨æ€ä½œç”¨åŸŸçš„ä½œç”¨åŸŸé“¾ä¸€èˆ¬æ˜¯åŸºäºè°ƒç”¨æ ˆçš„(è¿™ä¸ <code>JavaScript</code> çš„<code>this</code> ç‰¹æ€§å¾ˆåƒ)</li></ul><p>ä¾‹å¦‚, å¯¹äºä»£ç :</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>é™æ€ä½œç”¨åŸŸ: åœ¨æ‰§è¡Œ <code>foo</code> æ—¶, å¼•æ“å‘èµ· <code>RHS</code>è¯·æ±‚ <code>a</code>, æ‰¾ä¸åˆ°, å‘å¤–ç›´æ¥æŸ¥æ‰¾å…¨å±€<code>a = 2</code></p></li><li><p>åŠ¨æ€ä½œç”¨åŸŸ: åœ¨æ‰§è¡Œ <code>foo</code> æ—¶, å¼•æ“å‘èµ· <code>RHS</code>è¯·æ±‚ <code>a</code>, æ‰¾ä¸åˆ°, é¡ºç€ä½œç”¨åŸŸé“¾(è°ƒç”¨æ ˆ)ç›´æ¥æŸ¥æ‰¾<code>bar</code> ä¸­çš„ <code>a = 3</code>, çœ‹èµ·æ¥å¾ˆåƒ JavaScript çš„<code>this</code> æœºåˆ¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>  <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="å‡½æ•°ä¸å—ä½œç”¨åŸŸ">å‡½æ•°ä¸å—ä½œç”¨åŸŸ</h3><p><strong>å‡½æ•°ä½œç”¨åŸŸ</strong></p><p>å‡½æ•°å†…éƒ¨çš„å˜é‡ä¸æ–¹æ³•ä½äºå‡½æ•°ä½œç”¨åŸŸä¸­, æ— æ³•è¢«å¤–éƒ¨è®¿é—®.</p><p>åˆ©ç”¨å‡½æ•°ä½œç”¨åŸŸå¯ä»¥éšè—ä»£ç çš„éƒ¨åˆ†å†…éƒ¨å®ç°, ä»è€Œå®ç°</p><ul><li>æœ€å°ç‰¹æƒåŸåˆ™</li><li>è§„é¿å˜é‡å†²çª(å…¶ä»–å®ç°è§„é¿å†²çªçš„æ–¹æ³•æœ‰é…ç½®å‘½åç©ºé—´, æ¨¡å—åŒ–ç®¡ç†)</li></ul><p>åœ¨å®è·µä¸­, å®ç°å‡½æ•°ä½œç”¨åŸŸçš„æ–¹æ³•æœ‰</p><ul><li><p>ç›´æ¥åœ¨ä»£ç å†…éƒ¨å®šä¹‰å‡½æ•°, å¹¶åœ¨å®šä¹‰åè°ƒç”¨å‡½æ•°</p><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">&#x2F;&#x2F; ä¸Šæ–‡+ function foo()&#123;    &#x2F;&#x2F; ä¿æŠ¤èµ·æ¥çš„éƒ¨åˆ†+ &#125;+ foo()&#x2F;&#x2F; ä¸‹æ–‡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ç§æ–¹æ³•å¿…é¡»å£°æ˜ä¸€ä¸ªå…·åå‡½æ•°, ç„¶ååœ¨è°ƒç”¨, ä¸ä»…ç¹ç,å…·åå‡½æ•°è¿˜æ— å½¢ä¸­æ±¡æŸ“äº†å¤–å±‚ä½œç”¨åŸŸ</p></li><li><p>ä½¿ç”¨å‡½æ•°è¡¨è¾¾å¼ä»£æ›¿å‡½æ•°</p><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">&#x2F;&#x2F; ä¸Šæ–‡+ (function foo()&#123;    &#x2F;&#x2F; ä¿æŠ¤èµ·æ¥çš„éƒ¨åˆ†+ &#125;)()&#x2F;&#x2F; ä¸‹æ–‡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>JavaScript åœ¨è§£æå¥å­æ—¶, è‹¥å‘ç°ç¬¬ä¸€ä¸ªå…³é”®å­—æ˜¯ <code>function</code>åˆ™ä¼šå°†è¿™å¥è¯åˆ¤å®šä¸º<strong>å‡½æ•°å®šä¹‰</strong>,é‡åˆ°å…¶ä»–ç¬¦å·(ä¾‹å¦‚è¿™é‡Œçš„<code>(</code>),åˆ™ä¼šå°†è¿™å¥è¯å½“ä½œ<strong>è¡¨è¾¾å¼</strong>. å¯ä»¥é€šè¿‡<code>(function foo()&#123;&#125;)()</code> çš„æ–¹æ³•å®šä¹‰å‡½æ•°. æ­¤æ—¶,ä¸ä»…ä¸ç”¨æ˜¾å¼è°ƒç”¨å‡½æ•°, <code>foo</code>æ ‡è¯†ç¬¦ä¹Ÿ<strong>ä¸èƒ½è¢«å¤–éƒ¨è®¿é—®</strong>, ä¸ä¼šæ±¡æŸ“å¤–å±‚ä½œç”¨åŸŸ</p></li><li><p>åŒ¿åå‡½æ•°</p><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">&#x2F;&#x2F; ä¸Šæ–‡+ (function()&#123;    &#x2F;&#x2F; ä¿æŠ¤èµ·æ¥çš„éƒ¨åˆ†+ &#125;)()&#x2F;&#x2F; ä¸‹æ–‡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¼ºç‚¹: éš¾ä»¥å¾—çŸ¥å‡½æ•°è¯­ä¹‰, è°ƒè¯•å›°éš¾.å‡½æ•°å†…éƒ¨æ— æ³•é€šè¿‡å‡½æ•°åè°ƒç”¨å‡½æ•°åä¸Šçš„å˜é‡(å¦‚:<code>callee</code>)</p></li><li><p>IIFT</p><p>å®é™…ä¸Šæœ‰ä¸¤ç§IIFTçš„å†™æ³•</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸¤è€…åœ¨åŠŸèƒ½ä¸Šå®Œå…¨ä¸€è‡´, ä»»é€‰å…¶ä¸€å³å¯</p></li></ul><p><strong>ES6çš„å—ä½œç”¨åŸŸ</strong></p><p><code>ES6</code> ä¸­çš„å…³é”®å­— <code>let</code>, <code>const</code>éƒ½æ”¯æŒå˜é‡å—ä½œç”¨åŸŸ, å…¶å®ç°çš„åŸç†æ˜¯:åœ¨å£°æ˜å˜é‡æ—¶<strong>éšå¼</strong>çš„å°†å˜é‡åŠ«æŒåœ¨æ‰€åœ¨çš„å—ä½œç”¨åŸŸä¸Š.ä½†è¿™ä¸¤ä¸ªå…³é”®å­—ä¸æ”¯æŒå˜é‡æå‡, åœ¨å®è·µæ—¶æœ€å¥½å°†å˜é‡å£°æ˜åœ¨ä½œç”¨åŸŸé¦–éƒ¨.</p><p><strong>ES6ä¹‹å‰çš„å—ä½œç”¨åŸŸå®ç°</strong></p><p>åœ¨ <code>ES6</code> å‰çš„æ—¶ä»£, <code>JavaScript</code>åªæœ‰å…¨å±€ä½œç”¨åŸŸä¸å‡½æ•°ä½œç”¨åŸŸ,ä¼Ÿå¤§çš„ç¨‹åºå‘˜ä»¬åˆ©ç”¨éƒ¨åˆ†ç‰¹æ€§å®ç°äº†éƒ¨åˆ†å—ä½œç”¨åŸŸ</p><p>å®é™…ä¸Šåœ¨ <code>ES6</code> å‰æœ‰éƒ¨åˆ†è¯­æ³•"æ”¯æŒ"å—ä½œç”¨åŸŸ</p><ul><li><p><code>with</code> ä¸ºå†…éƒ¨ä»£ç æ‰‹åŠ¨åˆ›å»ºäº†ä¸€ä¸ªä½œç”¨åŸŸ,å†…éƒ¨ä»£ç å¯ä»¥è®¤ä¸ºæ˜¯åŒ…åœ¨ <code>with()&#123;&#125;</code> äº§ç”Ÿçš„å—ä½œç”¨åŸŸä¸­</p></li><li><p><code>try-catch</code> æ–¹æ³•çš„ <code>catch</code>åˆ†å¥ä¼šåˆ›é€ å—ä½œç”¨åŸŸ. åˆ©ç”¨è¿™ä¸ªç‰¹æ€§, éƒ¨åˆ† JavaScript çš„ polyfillè½¬è¯‘å·¥å…·ä¼šå°† <code>ES6</code> çš„å—ä½œç”¨åŸŸç¿»è¯‘ä¸º <code>try-catch</code>è¯­å¥, ä¾‹å¦‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç¿»è¯‘ä¸º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span><span class="token keyword">throw</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>æ³¨æ„</strong>:</p><blockquote><p>æ—©æœŸ JavaScript è¦æ±‚ç»Ÿä¸€ä½œç”¨åŸŸä¸‹çš„ä¸åŒ <code>try-catch</code> è¯­å¥çš„<code>catch</code> åˆ†å¥ä¸­ä¸èƒ½ä½¿ç”¨ç›¸åŒçš„æ ‡è¯†ç¬¦å£°æ˜é”™è¯¯, å³<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">throw</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">throw</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>æ˜¯é”™çš„, éœ€è¦å°† <code>error</code> æ”¹ä¸º <code>error1</code>,<code>error2</code>...</p></blockquote></li></ul><h3 id="å‡½æ•°ä¸å˜é‡æå‡">å‡½æ•°ä¸å˜é‡æå‡</h3><p>å¯¹äº <code>var</code> ä¸ <code>function</code> å£°æ˜çš„æ ‡è¯†ç¬¦,å­˜åœ¨å˜é‡æå‡. JavaScript å¼•æ“ä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¿›è¡Œé™æ€ä»£ç åˆ†æ,è·å¾—è¯æ³•ä½œç”¨åŸŸ, å®Œæˆå£°æ˜.</p><ul><li><p>å¯¹äº <code>var</code> å£°æ˜çš„å˜é‡æˆ–å‡½æ•°: JavaScriptåªä¼šæå‡å˜é‡å®šä¹‰, åœ¨æ­£å¼å®šä¹‰å‰, å˜é‡æ˜¯ <code>undefined</code></p></li><li><p>å¯¹äº <code>function</code> å£°æ˜çš„å‡½æ•°: JavaScriptä¼šæå‡å‡½æ•°å‡½æ•°å£°æ˜ä¸å®šä¹‰.</p></li><li><p>è‹¥ä½œç”¨åŸŸä¸­åŒæ—¶å­˜åœ¨ <code>var</code> ä¸ <code>function</code>å£°æ˜. <code>function</code> ä¼˜å…ˆ, ä¾‹å¦‚:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 1</span><span class="token keyword">var</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›¸å½“äº</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// funciton ä¼˜å…ˆ</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> foo<span class="token punctuation">;</span>         <span class="token comment">// varæ»å, äºæ˜¯è¿™ä¸ªå°±åºŸæ‰äº†</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="é—­åŒ…">é—­åŒ…</h3><p>å½“å‡½æ•°åœ¨è‡ªå·±å®šä¹‰ä½œç”¨åŸŸä»¥å¤–çš„éƒ¨åˆ†æ‰§è¡Œæ—¶, å‡½æ•°ä¼šä¿ç•™å¯¹åŸä½œç”¨åŸŸçš„å¼•ç”¨,è¿™ä¸ªå¼•ç”¨å°±æ˜¯é—­åŒ…. æ¢è€Œè¨€ä¹‹, ä¸€æ—¦ä½¿ç”¨äº†åŒæ­¥/å¼‚æ­¥çš„å›è°ƒå‡½æ•°,å°±äº§ç”Ÿäº†é—­åŒ….</p><p>å‡½æ•°å¯ä»¥ä¿æŒå¯¹é—­åŒ…çš„å¼•ç”¨, ä½†æ˜¯æ— æ³•ä¿è¯é—­åŒ…å†…çš„å€¼å¹¶ä¸å˜. åŒæ—¶,é—­åŒ…å¯ä»¥é˜»æ­¢æ‰€åœ¨å‡½æ•°ä½œç”¨åŸŸçš„åƒåœ¾å›æ”¶.</p><p><strong>å®ç°æ¨¡å—åŒ–</strong></p><p>JavaScript çš„æ¨¡å—åŒ–å°±å€Ÿç”¨äº†é—­åŒ…å®ç°, ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ¨¡å—åŒ–çš„åŸºæœ¬æ¨¡å¼</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">onemod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> attr1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// do sth</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>        method1    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰å˜é‡ä¸æ–¹æ³•, é€šè¿‡ <code>return</code>å°†éœ€è¦æš´éœ²çš„å˜é‡å¯¼å‡º.</p><p>å‡½æ•°æ¯æ¬¡è°ƒç”¨å°±ä¼šå¯¼å‡ºä¸€ä¸ªå…¨æ–°æ¨¡å—. ä½†æ˜¯, ä¹Ÿå› ä¸ºå‡½æ•°å¯ä»¥ä¼ å…¥å‚æ•°,ç¼–è¯‘å™¨æ— æ³•å¯¹æ­¤ç±»æ¨¡å—åšå‡ºé™æ€åˆ†æä¸ä¼˜åŒ–. åœ¨ <code>ES6</code> ä¸­,æ¯ä¸ªæ¨¡å—è¢«å®šä¹‰ä¸ºæ–‡ä»¶é€šè¿‡ <code>import/export</code> å¯¼å…¥å¯¼å‡º,æ­¤æ—¶ç¼–è¯‘å™¨å¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µå¯¹æ¨¡å—è¿›è¡Œé™æ€åˆ†æ.</p><h2 id="this-å’Œå¯¹è±¡åŸå‹"><code>this</code> å’Œå¯¹è±¡åŸå‹</h2><h3 id="å…³äº-this">å…³äº <code>this</code></h3><p><strong><code>this</code> ä¸æ˜¯ä»€ä¹ˆ</strong></p><ul><li><p><code>this</code> ä¸æ˜¯å‡½æ•°è‡ªèº«</p><p>æ— æ³•é€šè¿‡ <code>this</code> è·å–å‡½æ•°ä½œä¸ºå¯¹è±¡çš„å±æ€§.è‹¥æƒ³å¯¹å‡½æ•°å¯¹è±¡æ“ä½œè¿˜æ˜¯éœ€è¦ä½¿ç”¨<strong>å‡½æ•°æ ‡è¯†ç¬¦</strong>æˆ–åœ¨å‡½æ•°å†…ä½¿ç”¨<strong><code>arguments.callee</code></strong> (å·²å¼ƒç”¨)</p></li><li><p><code>this</code> ä¸æ˜¯å‡½æ•°ä½œç”¨åŸŸ</p><p><code>this</code> ä¸æŒ‡å‘å‡½æ•°ä½œç”¨åŸŸ, ä½œç”¨åŸŸåœ¨ç¼–è¯‘é˜¶æ®µå°±ç”Ÿæˆäº†, ä½†<code>this</code> æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€å˜æ¢çš„. ä½œç”¨åŸŸæ˜¯å­˜åœ¨äº JavaScriptå¼•æ“ä¸­çš„"å¯¹è±¡", æ— æ³•åœ¨ä»£ç ä¸­è¢«å¼•ç”¨</p></li></ul><p><strong><code>this</code> æ˜¯ä»€ä¹ˆ</strong></p><p>thisæ˜¯å‡½æ•°è°ƒç”¨æ—¶è¢«è°ƒç”¨å‡½æ•°ä¸Šä¸‹æ–‡ä¸­çš„ä¸€ä¸ªå±æ€§,å…¶å…·ä½“çš„æŒ‡å‘å–å†³äºå‡½æ•°çš„è°ƒç”¨æ–¹å¼</p><p><strong>ä¸ºä»€ä¹ˆéœ€è¦<code>this</code></strong></p><p><code>this</code> æä¾›äº†ä¸€ç§è®©å‡½æ•°è°ƒç”¨éšå¼ä¼ é€’å…¶å¯¹è±¡å¼•ç”¨çš„æ¨¡å¼,åœ¨å‡½æ•°è¢«è°ƒç”¨æ—¶, <code>this</code> ä½œä¸ºå‡½æ•°ä¸Šä¸‹æ–‡ä¸­çš„ä¸€é¡¹è¢«ä¼ å…¥å‡½æ•°</p><h3 id="this-çš„æŒ‡å‘"><code>this</code> çš„æŒ‡å‘</h3><p>åˆ†æ <code>this</code> çš„æŒ‡å‘é¦–å…ˆè¦åˆ†æå‡½æ•°çš„è°ƒç”¨ä½ç½®,ä¹Ÿå°±æ˜¯åˆ†æè°ƒç”¨æ ˆçš„ç¬¬äºŒé¡¹</p><p>æˆ‘ä»¬å°†å…ˆä»æ˜“åˆ°éš¾çš„ä»‹ç»å„ç§è§„åˆ™, ç„¶åè§„å®šè§„åˆ™çš„ä¼˜å…ˆçº§</p><p><strong>è§„åˆ™</strong></p><ul><li><p>é»˜è®¤ç»‘å®š</p><p>å½“å‡½æ•°è¢«ç›´æ¥è°ƒç”¨(å¦‚: <code>foo()</code>)æ—¶, <code>this</code>ä¼šè¢«ç»‘å®šåˆ° <code>global/window</code> å¯¹è±¡. åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹,<code>this</code> æ— æ³•æŒ‡å‘å…¨å±€å¯¹è±¡, å…¶ä¼šæŒ‡å‘<code>undefined</code></p></li><li><p>éšå¼ç»‘å®š</p><p>è‹¥è¢«è°ƒç”¨å¯¹è±¡è¢«å…¶ä»–å¯¹è±¡åœ¨<strong>å½¢å¼ä¸Š</strong>åŒ…å«,<code>this</code> å°†æŒ‡å‘è¢«åŒ…å«å¯¹è±¡.å¯ä»¥ä»ä¸‹é¢å‡ ä¸ªä¾‹å­ä¸­ç†è§£å½¢å¼ä¸Šçš„åŒ…å›´</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">// SITUATION 1: åŒ…å›´</span><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>foo<span class="token punctuation">.</span><span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1, æ²¡é—®é¢˜, è°ƒç”¨æ—¶æ˜¯ foo.demo(), demoè¢«fooåŒ…å›´äº†</span><span class="token comment">// SITUATION 2: å½¢å¼ä¸ŠåŒ…å›´</span><span class="token keyword">function</span> <span class="token function">demoGlobal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">demo</span><span class="token operator">:</span> demoGlobal<span class="token punctuation">,</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>bar<span class="token punctuation">.</span><span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2, è™½ç„¶ bar.demo å¼•ç”¨è‡ªå…¨å±€å‡½æ•°, ä½†æ˜¯åœ¨bar.demoä¸­demoè¢«baråŒ…å›´äº†</span><span class="token comment">// SITUATION 3: å½¢å¼ä¸ŠåŒ…å›´</span><span class="token keyword">const</span> demoFromFoo <span class="token operator">=</span> foo<span class="token punctuation">.</span>demo<span class="token punctuation">;</span><span class="token function">demoFromFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0, è™½ç„¶ demoFromFoo å¼•ç”¨è‡ª foo.demo , ä½†æ˜¯åœ¨è¿™é‡Œå¹¶æ²¡æœ‰è¢«åŒ…å›´</span><span class="token comment">// SITUATION 4: å›è°ƒå‡½æ•°</span><span class="token function">setTimeout</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>demo<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0, å¯ä»¥ç®€åŒ–è°ƒç”¨è¿‡ç¨‹ä¸º</span><span class="token comment">// function setTimeout(fn, delay) &#123; // è¿™é‡Œå…¶å®è¿›è¡Œäº†ä¸€æ¬¡å‡½æ•°çš„èµ‹å€¼, ä¸SITUATION 3 ç±»ä¼¼, äºæ˜¯å¤±å»äº†åŒ…å›´å¯¹è±¡</span><span class="token comment">//   sleep(delay);</span><span class="token comment">//   fn();</span><span class="token comment">// &#125;</span><span class="token comment">// SITUATION 5: åŒ…å›´é™·é˜±</span><span class="token keyword">const</span> baz <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">(</span>baz<span class="token punctuation">.</span>demo <span class="token operator">=</span> foo<span class="token punctuation">.</span>demo<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0, èµ‹å€¼è¯­å¥è¿”å›çš„æ˜¯ç›®æ ‡å‡½æ•°çš„å¼•ç”¨, ç›¸å½“äºå°±æ˜¯ä¸€ä¸ª function()&#123;...&#125; , ä½†æ˜¯åœ¨è¿™é‡Œå¹¶æ²¡æœ‰è¢«åŒ…å›´</span><span class="token comment">// SITUATION 6: åªå…³æ³¨å‰ä¸€å±‚åŒ…å›´</span><span class="token keyword">const</span> outer <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">inner</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>    <span class="token literal-property property">demo</span><span class="token operator">:</span> demoGlobal<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>outer<span class="token punctuation">.</span>inner<span class="token punctuation">.</span><span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3, åªå…³å¿ƒåŒ…å›´çš„ç¬¬ä¸€çš„å¤–å±‚å…ƒç´ (inner)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå°† SITUATION 3&amp;4 çš„æƒ…å†µç§°ä¸º<strong>éšå¼ä¸¢å¤±</strong></p></li><li><p>æ˜¾å¼ç»‘å®š</p><p>JavaScript ä¸­æ”¹å˜ <code>this</code> æŒ‡å‘çš„æ–¹æ³•æœ‰<code>call / apply / bind</code>, å¯¹äº <code>call / apply</code>,è¿™ä¸¤ä¸ªå‡½æ•°å¯ä»¥ç›´æ¥ä¿®æ”¹ <code>this</code> çš„æŒ‡å‘. <code>bind</code>å‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªä¿®æ”¹ <code>this</code> åçš„å‡½æ•°,å¯ä»¥å°†å…¶å®ç°<strong>ç®€å•çš„</strong>ç†è§£ä¸º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>éƒ¨åˆ† API è‡ªèº«å°±æ”¯æŒæ”¹å˜ <code>this</code> æŒ‡å‘, å¦‚<code>Array.prototype.forEach()</code> æ”¯æŒä¿®æ”¹å›è°ƒçš„<code>this</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>array<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>d<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined undefined undefined</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>array<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>d<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 2 3</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è‹¥ä¼ å…¥ <code>this = null</code> é‚£ä¹ˆ <code>this</code> å°†å˜ä¸º<code>global</code></strong></p></li><li><p><code>new</code> ç»‘å®š</p><p>ä½¿ç”¨ <code>new</code> æ–°å»ºå®ä¾‹æ—¶, æ„é€ å‡½æ•°çš„ <code>this</code>å°†ç»‘å®šåˆ°åˆ›å»ºçš„å®ä¾‹</p></li><li><p>ç®­å¤´å‡½æ•°: ç›´æ¥ç»‘å®šéå¤–å±‚éç®­å¤´å‡½æ•°çš„ <code>this</code></p></li></ul><p><strong>ä¼˜å…ˆçº§</strong></p><ol start="0" type="1"><li>ç®­å¤´å‡½æ•°</li><li><code>new</code> ç»‘å®š</li><li>æ˜¾å¼ç»‘å®š: æ³¨æ„, <code>new</code> çš„ä¼˜å…ˆçº§é«˜äº <code>ES6</code>å®ç°çš„ <code>bind</code>, é‚£ä¸ª <code>bind</code> ä¸å‰é¢ç®€åŒ–çš„<code>bind</code> ä¸åŒ</li><li>éšå¼ç»‘å®š</li><li>é»˜è®¤ç»‘å®š</li></ol><p>è®¨è®º <code>new</code> ç»‘å®šä¸ <code>bind</code>ç»‘å®šçš„ä¼˜å…ˆçº§æ˜¯æœ‰æ„ä¹‰çš„, å¦‚ä¸‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//...</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> initAs12X <span class="token operator">=</span> <span class="token function">Foo</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">new</span> <span class="token class-name">initAs123</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">new</span> <span class="token class-name">initAs123</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬ç¡®å®šäº†æ„é€ å‡½æ•°çš„å‰ä¸¤é¡¹ä¸º <code>1, 2</code>, å¸Œæœ›åœ¨<code>new</code> çš„æ—¶å€™åªæŒ‡å®šç¬¬ä¸‰é¡¹, å°±å¯ä»¥è¿™ä¹ˆå†™, å…ˆç”¨<code>bind</code> ä¸ºå‡½æ•°ä¼ å…¥å‰ä¸¤ä¸ªå‚æ•°, å¹¶ç»‘å®š <code>null</code> ä½œä¸º<code>this</code>, ç„¶ååˆç”¨ <code>new</code> è¦†ç›– <code>this</code>.</p><p>åœ¨ JavaScript ä¸­, <code>bind</code> å‡½æ•°å¯ä»¥ç”¨æ¥å®ç°å‡½æ•°æŸ¯é‡ŒåŒ–.</p><p>æœ€å, å¼•ç”¨æ¥è‡ªæ˜é‡‘å°å†Œçš„æµç¨‹å›¾</p><pre class="mermaid">graph TBwhereisthis(å¯»æ‰¾å‡½æ•°ä¸­çš„this) --ç®­å¤´å‡½æ•°--> outerthis(åŒ…è£¹ç®­å¤´å‡½æ•°çš„éç®­å¤´å‡½æ•°çš„this)whereisthis(å¯»æ‰¾å‡½æ•°ä¸­çš„this) --æ™®é€šå‡½æ•°--> ways(å‡½æ•°è°ƒç”¨æ–¹å¼)whereisthis(å¯»æ‰¾å‡½æ•°ä¸­çš„this) --bind/call/apply--> fstparam(ç¬¬ä¸€ä¸ªå‚æ•°)ways --new--> instance(thisè¢«å›ºåŒ–åœ¨å®ä¾‹ä¸Š)ways --å…¶ä»–æ–¹å¼--> form(å‡½æ•°è¢«è°ƒç”¨çš„æ–¹å¼)form --foo--> window(thisä¸ºwindow/ä¸¥æ ¼æ¨¡å¼ä¸‹çš„undefined)form --bar.foo--> obj(thisä¸ºbar)</pre><p><strong>é™·é˜±</strong></p><ul><li><p>æ— ç”¨ <code>this</code>:</p><p>æœ‰æ—¶å‡½æ•°çš„ <code>this</code> å¹¶ä¸é‡è¦, ä½†æ˜¯éƒ¨åˆ†å›è°ƒå‡½æ•°éœ€è¦æŒ‡å®š<code>this</code>(å¦‚é€šè¿‡ <code>bind</code> å®ç°æŸ¯é‡ŒåŒ–,<code>forEach</code>å‡½æ•°). æˆ‘ä»¬å¯ä»¥ä¼ å…¥ <code>null</code> å ä½,ä½†æ˜¯è‹¥å‡½æ•°çš„ <code>this</code> ä¸ºå¯é€‰å‚æ•°ä¸”é»˜è®¤å€¼ä¸º <code>global</code>,å¡«å…¥ <code>null</code> ä¼šè®© <code>this</code> æŒ‡å‘ <code>global</code>,è¿™å¯èƒ½ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸ. è§£å†³æ–¹æ³•æ˜¯å®ç°ä¸€ä¸ªäººç•œæ— å®³çš„å¯¹è±¡, å°†å…¶ç§°ä¹‹ä¸º<code>DMZ</code>(Demilitarized zone, éå†›äº‹åŒº) å¯¹è±¡, å¯ä»¥ä½¿ç”¨<code>Object.create(null)</code> å®ç°, è¿™ä¸ªå¯¹è±¡æ¯” <code>&#123;&#125;</code>æ›´"ç©º",</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> empty <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>empty<span class="token punctuation">,</span> <span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>éšå¼ä¸¢å¤±é—®é¢˜</p><p>åœ¨å®ç° vue çš„ runtime-dom æ—¶æˆ‘æ›¾å†™è¿‡</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> create <span class="token operator">=</span> document<span class="token punctuation">.</span>createElement<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½†æ˜¯åœ¨æ‰§è¡Œ <code>create('div')</code> æ—¶å‡ºé”™äº†</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token constant">VM67</span><span class="token operator">:</span><span class="token number">1</span> Uncaught TypeError<span class="token operator">:</span> Illegal invocation    at <span class="token operator">&lt;</span>anonymous<span class="token operator">></span><span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™æ˜¯å› ä¸º <code>document.createElement('div')</code> æ—¶<code>this</code> æŒ‡å‘ <code>document</code> ä½†æ˜¯è°ƒç”¨<code>create</code> æ—¶ <code>this</code> æŒ‡å‘ <code>global</code>.è§£å†³æ–¹æ¡ˆå°±æ˜¯</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> create <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h3 id="å¯¹è±¡">å¯¹è±¡</h3><p><strong>æ„é€ </strong></p><p>å¯ä»¥é€šè¿‡<strong>å­—é¢é‡</strong>ä¸<strong>æ„é€ å‡½æ•°</strong>ä¸¤ç§æ–¹å¼æ„é€ å¯¹è±¡,åœ¨å­—é¢é‡æ„é€ å¯¹è±¡æ—¶, <code>Key</code> æœ‰å¤šé‡å†™æ³•</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> pre <span class="token operator">=</span> <span class="token string">'C-'</span><span class="token punctuation">;</span><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// ä¸€èˆ¬æ¨¡å¼</span>  <span class="token string-property property">'A-1'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// A-1 ä¼šè¢«ç†è§£ä¸ºAå‡1, æ”¾å¼ƒç®€å†™, å°†Keyç”¨å¼•å·å¼•èµ·æ¥</span>  <span class="token punctuation">[</span>pre <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// å¯ä»¥ç”¨[]å®ç°è®¡ç®—å±æ€§, ç»“æœç›¸å½“äº 'C-1': 1</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ JavaScript çš„åŸºæœ¬ç±»å‹ä¸­, åªæœ‰ Object æ˜¯å¯¹è±¡.<code>typeof null === 'object'</code>, è¿™æ˜¯å› ä¸º</p><blockquote><p>åœ¨ JavaScript ä¸­äºŒè¿›åˆ¶å‰ä¸‰ä½éƒ½ä¸º 0 çš„è¯ä¼šè¢«åˆ¤æ–­ä¸º <code>object</code>ç±»å‹, <code>null</code> çš„äºŒè¿›åˆ¶è¡¨ç¤ºå…¨æ˜¯ <code>0</code>, è‡ªç„¶å‰ä¸‰ä½ä¹Ÿæ˜¯<code>0</code>, æ‰€ä»¥æ‰§è¡Œ <code>typeof</code> æ—¶è¿”å›<code>object</code></p></blockquote><p><strong>è®¿é—®</strong></p><p>å¯ä»¥é€šè¿‡<strong>å±æ€§è®¿é—®</strong>(<code>obj.a</code>)ä¸<strong>å€¼è®¿é—®</strong><code>obj['a']</code>è®¿é—®å…ƒç´ ,ä¸¤è€…æ•ˆæœç›¸åŒ</p><p>å½“å±æ€§è®¿é—®çš„ <code>Key</code> è¿å JavaScriptè¯­æ³•æ—¶(å¦‚<code>a.1</code>)å¯ä»¥ç”¨å€¼è®¿é—®æ›¿ä»£. å€¼è®¿é—®ä¸­,<code>[]</code>åŒ…è£¹çš„è¡¨è¾¾å¼å¯ä»¥æ˜¯é <code>string</code>,ä½†æ˜¯åœ¨æœ€åéƒ½ä¼šè½¬æ¢ä¸º <code>string</code>, ä¾‹å¦‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>obj<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>obj<span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>obj<span class="token punctuation">[</span>obj<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span><span class="token string">'2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span><span class="token string">'true'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span><span class="token string">'[object Object]'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è™½ç„¶åä¸‰é¡¹éƒ½ä¸æ˜¯åŒä¸€ä¸ª <code>object</code>, ä½†æ˜¯ä»–ä»¬è½¬æ¢ä¸º<code>string</code> åéƒ½æ˜¯ <code>'[object Object]'</code>,åº”æ­¤æ˜ å°„å€¼ä¸€æ ·</p><p><strong>å¤åˆ¶</strong></p><ul><li><p>æµ…æ‹·è´</p><ul><li>å¯¹äº<code>JSON</code> å®‰å…¨çš„å¯¹è±¡:<code>JSON.parse(JSON.stringify(obj));</code></li><li><code>ES6</code> ä¸‹: <code>Object.assign(obj);</code></li></ul><p>è¿™ä¸¤ä¸ªæ–¹æ³•ä¼šå°†æ‰€æœ‰<strong>å¯æšä¸¾å¯¹è±¡</strong>æ‹·è´å‡ºæ¥, ä½†æ˜¯<code>JSON</code> æ–¹æ³•æ‹·æ¥çš„å¯¹è±¡çš„å±æ€§æè¿°ç¬¦(å¦‚: writable)ä¼šè¢«æŠ¹å»,<code>Object.assign</code> æ¥çš„å¯¹è±¡çš„å±æ€§æè¿°ç¬¦ä¼šä¿ç•™</p></li><li><p>æ·±æ‹·è´</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// æ·±æ‹·è´</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">deepCopy</span><span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> target</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> copyedObjs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// æ­¤æ•°ç»„è§£å†³äº†å¾ªç¯å¼•ç”¨å’Œç›¸åŒå¼•ç”¨çš„é—®é¢˜ï¼Œå®ƒå­˜æ”¾å·²ç»é€’å½’åˆ°çš„ç›®æ ‡å¯¹è±¡</span>  copyedObjs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">fromTarget</span><span class="token operator">:</span> source<span class="token punctuation">,</span> <span class="token literal-property property">toTarget</span><span class="token operator">:</span> target <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">deepCopyFunction</span><span class="token punctuation">(</span><span class="token parameter">sourceItem<span class="token punctuation">,</span> targetItem</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>sourceItem<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>        <span class="token keyword">typeof</span> sourceItem<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">'object'</span> <span class="token operator">||</span>        sourceItem<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span>        sourceItem<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span>      <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        targetItem<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> sourceItem<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> copyedObjs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>copyedObjs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>fromTarget <span class="token operator">===</span> sourceItem<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            targetItem<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> copyedObjs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>toTarget<span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        targetItem<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>sourceItem<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> targetItem<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        copyedObjs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>          <span class="token literal-property property">fromTarget</span><span class="token operator">:</span> sourceItem<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token literal-property property">toTarget</span><span class="token operator">:</span> targetItem<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">deepCopyFunction</span><span class="token punctuation">(</span>sourceItem<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> targetItem<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token function">deepCopyFunction</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>å±æ€§æè¿°ç¬¦</strong></p><p>å¯ä»¥ç”¨ <code>Object.defineProperty(obj, attr, config)</code>å®šä¹‰å¯¹è±¡çš„å±æ€§ä¸å±æ€§æ ‡è¯†, <code>config</code> ç»“æ„ä¸º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>    configurable<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span> <span class="token comment">// æ˜¯å¦å…è®¸ä¿®æ”¹å±æ€§æè¿°ç¬¦, é»˜è®¤ false</span>    enumerable<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span> <span class="token comment">// æ˜¯å¦å¯ä»¥æšä¸¾, é»˜è®¤ false</span>    value<span class="token operator">?</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token comment">// å€¼, é»˜è®¤ undefined</span>    writable<span class="token operator">?</span><span class="token operator">:</span>  <span class="token comment">// å€¼æ˜¯å¦å¯ä¿®æ”¹, é»˜è®¤ false</span>    <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ˜¾è€Œæ˜“è§çš„æ˜¯: å°† <code>configurable</code> æ”¹ä¸º <code>false</code>åæ— æ³•æ”¹å›, ä½†æ˜¯, å³ä½¿ <code>configurable: false</code>, ä»ç„¶å¯ä»¥å°†<code>writable</code> ä» <code>true</code> æ”¹ä¸º <code>false</code>,ä¸”æ— æ³•æ”¹å›.</li><li>å¯ä»¥ä½¿ç”¨ <code>delete</code> åˆ é™¤å±æ€§(ä½†å¹¶ä¸æ„å‘³ç€ä¼šè¢«åƒåœ¾å›æ”¶,å› ä¸ºè¢«åˆ é™¤å¯¹è±¡å¯èƒ½ä¼šè¢«å…¶ä»–å¯¹è±¡å¼•ç”¨)</li></ul><p><strong>å±æ€§ä¸å˜æ€§</strong></p><ul><li>é…ç½® <code>&#123;configurable: false, writable: false&#125;</code>å³å¯åˆ›å»ºå¸¸é‡å±æ€§</li><li>è°ƒç”¨ <code>Object.preventExtensions()</code>å¯ä»¥è®©å¯¹è±¡æ— æ³•å†æ·»åŠ æ–°çš„å±æ€§(æ·»åŠ ä¼šé€ æˆé™é»˜å¤±è´¥, åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šé€ æˆ<code>typeError</code> )</li><li>è°ƒç”¨ <code>Object.seal()</code> å¯ä»¥è®©å¯¹è±¡æ— æ³•å†æ·»åŠ /åˆ é™¤å±æ€§,æ— æ³•é‡å†™å±æ€§æè¿°ç¬¦</li><li>è°ƒç”¨ <code>Object.freeze()</code> å¯ä»¥è®©å¯¹è±¡åœ¨ <code>seal</code>çš„åŸºç¡€ä¸Š <code>writable: false</code>. å¦‚éœ€å†»ç»“æ•´ä¸ªå¯¹è±¡,è¯¥éœ€è¦é€’å½’å†»ç»“æ¯ä¸ªå±æ€§, åŒæ—¶,å¼•ç”¨è¿™ä¸ªå±æ€§çš„æ‰€æœ‰å¯¹è±¡çš„è¯¥å±æ€§éƒ½ä¼šè¢«å†»ç»“</li></ul><p><strong>getterä¸setter</strong></p><ul><li>è®¿é—®å¯¹è±¡çš„å±æ€§å®é™…ä¸Šæ˜¯åœ¨å¯¹è±¡ä¸Šçš„ <code>[[Get]]</code> æ–¹æ³•, é»˜è®¤çš„<code>[[Get]]</code> æ–¹æ³•ä¼šå…ˆæŸ¥æ‰¾å¯¹è±¡ä¸Šæ˜¯å¦æœ‰è¯¥å±æ€§,è‹¥æ˜¯å¯¹è±¡ä¸Šæ²¡æœ‰è¯¥å±æ€§, <code>[[Get]]</code>å°±ä¼šé¡ºç€<strong>åŸå‹é“¾</strong>å‘ä¸ŠæŸ¥æ‰¾, éƒ½æ‰¾ä¸åˆ°åˆ™è¿”å›<code>undefined</code>. <strong>è¿™ä¸ä½œç”¨åŸŸçš„æŸ¥æ‰¾ä¸åŒ,ä½œç”¨åŸŸæŸ¥æ‰¾å¤±è´¥åä¼šå‘å¤–å±‚ä½œç”¨åŸŸæŸ¥æ‰¾, éƒ½æ‰¾ä¸åˆ°åˆ™æŠ›å‡º<code>Reference Error</code></strong></li><li>ä¸ºå¯¹è±¡è®¾ç½®å±æ€§ç­‰æ“ä½œä¼šå‡ºå‘ <code>[[put]]</code>,<code>[[put]]</code> ä¼šå…ˆæ£€æŸ¥å±æ€§æ˜¯å¦å­˜åœ¨, åœ¨æ£€æŸ¥æ˜¯å¦å®šä¹‰äº†å±æ€§æ ‡è¯†ç¬¦,è‹¥æ˜¯åˆ™ç›´æ¥è°ƒç”¨ <code>setter</code>, å†æ£€æŸ¥å±æ€§æ˜¯å¦æ˜¯<code>writebale</code> çš„, å¦‚æœæ˜¯åˆ™ä¼šé€ æˆé™é»˜å¤±è´¥æˆ–<code>TypeError</code>, è‹¥ä¸æ˜¯åˆ™ä¼šè®¾ç½®å€¼</li><li>å¯ä»¥åœ¨ <code>defineProperty</code> æ—¶æŒ‡å®š <code>getter</code> ä¸<code>setter</code> æ¥æ›¿é»˜è®¤ <code>[[Get]]</code> ä¸<code>[[Put]]</code>, <strong>è‹¥å®šä¹‰äº† <code>getter</code> æ²¡æœ‰çš„å®šä¹‰<code>setter</code>, åœ¨è®¾ç½®å±æ€§æ—¶ <code>[[Put]]</code> ä¸ä¼šèµ‹å€¼,è€Œæ˜¯ç›´æ¥å¿½ç•¥èµ‹å€¼ä¸”ä¸æŠ›å‡ºé”™è¯¯. æ‰€ä»¥æœ€é«˜æˆå¯¹å®šä¹‰<code>getter/setter</code></strong></li></ul><p><strong>æŸ¥æ‰¾</strong></p><ul><li><code>in</code> å¯ä»¥åˆ¤æ–­ <code>key</code>æ˜¯å¦åœ¨å¯¹è±¡æˆ–å…¶åŸå‹é“¾ä¸Š(åŒ…æ‹¬ä¸å¯æšä¸¾çš„å±æ€§)</li><li><code>hasOwnProperty</code> å¯ä»¥åˆ¤æ–­ <code>key</code> æ˜¯å¦åœ¨å¯¹è±¡ä¸Š,ä½†ä¸æ£€æŸ¥åŸå‹é“¾</li><li><code>for-in</code> å¯ä»¥éå†å¯¹è±¡ä¸Šçš„å¯æšä¸¾å…ƒç´ çš„<code>key</code></li><li><code>for-of</code> å¯ä»¥éå†æœ‰è¿­ä»£å™¨å¯¹è±¡ä¸Šçš„æ‰€æœ‰å€¼</li><li><code>Object.keys()</code> å¯ä»¥è¿”å›å¯¹è±¡ä¸Šçš„å¯æšä¸¾å…ƒç´ </li><li><code>Object.getOwnPropertyNames()</code>å¯ä»¥è¿”å›å¯¹è±¡ä¸Šçš„æ‰€æœ‰å…ƒç´ </li></ul><h3 id="æ··å…¥">æ··å…¥</h3><ul><li><p>æ˜¾å¼æ··å…¥</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">mixin</span><span class="token punctuation">(</span> <span class="token parameter">sourceObj<span class="token punctuation">,</span> targetObj</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> sourceObj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ä»…æ‹·è´éæ—¢å­˜å†…å®¹</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> targetObj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   targetObj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> sourceObj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">return</span> targetObj<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¯„ç”Ÿç»§æ‰¿</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// â€œä¼ ç»Ÿçš„ JS ç±»â€ `Vehicle`</span><span class="token keyword">function</span> <span class="token function">Vehicle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>engines <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">Vehicle</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">ignition</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">"Turning on my engine."</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token class-name">Vehicle</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">drive</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ignition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">"Steering and moving forward!"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// â€œå¯„ç”Ÿç±»â€ `Car`</span><span class="token keyword">function</span> <span class="token function">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// é¦–å…ˆ, `car` æ˜¯ä¸€ä¸ª `Vehicle`</span> <span class="token keyword">var</span> car <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vehicle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç°åœ¨, æˆ‘ä»¬ä¿®æ”¹ `car` ä½¿å®ƒç‰¹åŒ–</span> car<span class="token punctuation">.</span>wheels <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// ä¿å­˜ä¸€ä¸ª `Vehicle::drive()` çš„å¼•ç”¨</span> <span class="token keyword">var</span> vehDrive <span class="token operator">=</span> car<span class="token punctuation">.</span>drive<span class="token punctuation">;</span> <span class="token comment">// è¦†ç›– `Vehicle::drive()`</span> car<span class="token punctuation">.</span><span class="token function-variable function">drive</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">vehDrive</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span> <span class="token keyword">this</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">"Rolling on all "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>wheels <span class="token operator">+</span> <span class="token string">" wheels!"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token keyword">return</span> car<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> myCar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>myCar<span class="token punctuation">.</span><span class="token function">drive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Turning on my engine.</span><span class="token comment">// Steering and moving forward!</span><span class="token comment">// Rolling on all 4 wheels!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>éšå¼æ··å…¥</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> Something <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token function-variable function">cool</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>greeting <span class="token operator">=</span> <span class="token string">"Hello World"</span><span class="token punctuation">;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>Something<span class="token punctuation">.</span><span class="token function">cool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Something<span class="token punctuation">.</span>greeting<span class="token punctuation">;</span> <span class="token comment">// "Hello World"</span>Something<span class="token punctuation">.</span>count<span class="token punctuation">;</span> <span class="token comment">// 1</span><span class="token keyword">var</span> Another <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token function-variable function">cool</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// éšå¼åœ°å°† `Something` æ··å…¥ `Another`</span>  Something<span class="token punctuation">.</span><span class="token function">cool</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span> <span class="token keyword">this</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>Another<span class="token punctuation">.</span><span class="token function">cool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Another<span class="token punctuation">.</span>greeting<span class="token punctuation">;</span> <span class="token comment">// "Hello World"</span>Another<span class="token punctuation">.</span>count<span class="token punctuation">;</span> <span class="token comment">// 1 (ä¸ä¼šå’Œ `Something` å…±äº«çŠ¶æ€)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="åŸå‹">åŸå‹</h3><p><strong>å°è¯•ç†è§£åŸå‹é“¾</strong></p><p>é¦–å…ˆè¦æ˜ç¡®, è™½ç„¶äººä»¬è‡´åŠ›äºé€šè¿‡è¯­æ³•ç³–è®©ç¨‹åºå‘˜åƒå†™ç±»ä¸€æ ·å†™ JavaScriptçš„"ç±»"ä¸"ç»§æ‰¿". ä½†æ˜¯, å®é™…ä¸Š JavaScript çš„ç»§æ‰¿æ˜¯åŸºäºåŸå‹é“¾çš„.</p><p>åŸå‹æ˜¯ä¸ºå®ç°ç»§æ‰¿è€Œæå‡ºçš„,å¯ä»¥å°è¯•å°†å¯¹è±¡çš„åŸå‹ç†è§£æˆ<strong>è¿™ä¸ªå¯¹è±¡æ˜¯åŸºäºä»€ä¹ˆæ ·å­çš„ç©æ„é­”æ”¹å‡ºæ¥çš„</strong>.æ³¨æ„, åŸºäºä»€ä¹ˆ<strong>æ ·å­çš„</strong>ç©æ„,ä¸æ˜¯åŸºäº<strong>ä»€ä¹ˆç©æ„</strong>. ä»¥ä¸‹é¢è¿™ä¸ªç»§æ‰¿å…³ç³»ä¸ºä¾‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>f <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">Father</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€å¼€å§‹, æˆ‘ä»¥ä¸º, åŸå‹å°±æ˜¯å‘Šè¯‰å®ä¾‹å¯¹è±¡,ä»–æ˜¯åŸºäº<strong>ä»€ä¹ˆç©æ„</strong>æ„é€ å‡ºæ¥çš„.</p><p>å¦‚æœä¸è€ƒè™‘ç»§æ‰¿å…³ç³», å¯ä»¥è¿™ä¹ˆæƒ³è±¡ <code>Father</code> ä¸<code>Son</code></p><p><img src="./ä½ ä¸çŸ¥é“çš„JavaScriptå­¦ä¹ /2-2.png" /></p><p>æœ‰ä¸¤ä¸ªç‹¬ç«‹çš„æ¡†æ¡†, æ¡†ä¸­, å·¦è¾¹çš„åœ†æ˜¯æ„é€ å‡½æ•°, ä¸­é—´åŸå‹,å³è¾¹æ˜¯å…¶æ„é€ å‡ºçš„å®ä¾‹. æŒ‰ç…§åˆšåˆšçš„ç†è§£, åŸå‹æ˜¯ä¸€ä¸ªç¥ç§˜çš„<code>object</code>, å½“æˆ‘ä»¬è¦æ„é€ å‡½æ•°çš„æ—¶å€™, åªéœ€è¦å°†æ‰§è¡Œ<code>æ„é€ å‡½æ•°.apply(åŸå‹)</code>, ç„¶åæˆ‘ä»¬å°±å¾—åˆ°äº†å®ä¾‹, çœ‹èµ·æ¥ä¸é”™.è¦æ˜¯çŸ¥é“åŸå‹æ˜¯ä»€ä¹ˆå°±å¥½äº†.</p><p>é‚£, å¦‚æœ <code>Son</code> çš„åŸå‹æ˜¯ <code>Father</code>çš„å®ä¾‹ä¼šæ€ä¹ˆæ ·å‘¢? ä¸é”™è¯¶! <code>Sonæ„é€ å‡½æ•°.apply(father)</code> å¾—åˆ°<code>son</code> çœ‹èµ·æ¥åˆæƒ…åˆç†!</p><p><img src="./ä½ ä¸çŸ¥é“çš„JavaScriptå­¦ä¹ /2-3.png" /></p><p>å°†åŸå‹é“¾æ‰©å±•å®Œ. è¿˜æ˜¯å¾ˆæ£’! <code>Fatheræ„é€ å‡½æ•°.apply(&#123;&#125;)</code> å¾—åˆ°<code>father</code> çœ‹èµ·æ¥ä¹Ÿåˆæƒ…åˆç†!<code>Object.apply(ä¸€ä¸ªå¥‡æ€ªçš„ä¸œè¥¿)</code> å¾—åˆ° <code>&#123;&#125;</code>çœ‹èµ·æ¥ä¹Ÿåˆæƒ…åˆç†! è‡³äºè¿™ä¸ªå¥‡æ€ªçš„ä¸œè¥¿, æˆ‘ä»¬åªçŸ¥é“ä»–çš„<code>__proto__</code> æ˜¯ <code>null</code></p><p><img src="./ä½ ä¸çŸ¥é“çš„JavaScriptå­¦ä¹ /2-4.png" /></p><p>ä¸–ç•Œçº¿æ”¶æŸäº†? ä¸å¯¹åŠ², è¿™ä¹ˆæˆ‘ä»¬åœ¨ç›´æ¥æ“ä½œåŸå‹å‘¢? è¿™ä¹ˆä¸€ä¸²æä¸‹æ¥,æˆ‘ä»¬ç›´æ¥é­”æ”¹äº† <code>Object</code> çš„åŸå‹ :(</p><p>å®é™…ä¸Šä¸æ˜¯è¿™æ ·çš„, åŸå‹æ˜¯ä¸€ä¸ªå¯¹è±¡,ä»–å°±åƒä¸€ä¸ªæŒ‡è·¯ç‰Œä¸€æ ·æè¿°äº†æ„é€ å‡½æ•°(<code>.constructor</code>)æ˜¯è°,åŸå‹é“¾çš„ä¸Šä¸€å±‚æ˜¯è°<code>.__proto__</code>, è¿™ä¸ªç±»ä¸Šæœ‰ä»€ä¹ˆæ–¹æ³•.</p><p>çœ‹çœ‹ <code>Son.prototype</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">constructor</span><span class="token operator">:</span> <span class="token keyword">class</span> <span class="token class-name">Son</span>         <span class="token comment">// æ„é€ å‡½æ•°</span><span class="token punctuation">[</span><span class="token punctuation">[</span>Prototype<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">:</span> Object          <span class="token comment">// åŸå‹é“¾ä¸Šä¸€çº§</span>    <span class="token literal-property property">constructor</span><span class="token operator">:</span> <span class="token keyword">class</span> <span class="token class-name">Father</span>    <span class="token punctuation">[</span><span class="token punctuation">[</span>Prototype<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">:</span> Object<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./ä½ ä¸çŸ¥é“çš„JavaScriptå­¦ä¹ /2-5.png" /></p><p>ä½†æ˜¯, å¯¹äºåˆ›å»ºå¯¹è±¡æ¥è®², è¿™è¶³å¤Ÿäº†! ä¸€æ—¦æˆ‘æ‹¥æœ‰äº†åŸå‹å¯¹è±¡,æˆ‘å°±çŸ¥é“äº†å…¶æ„é€ å‡½æ•°ä¸åŸå‹é“¾çš„å‰ä¸€çº§, åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™,æˆ‘é€’å½’è®©ä¸Šä¸€çº§å¸®æˆ‘åˆ›å»ºçˆ¶ç±»çš„å®ä¾‹, ç„¶åå°†å“ªä¸ªå®ä¾‹å–‚ç»™è¿™ä¸€çº§çš„æ„é€ å‡½æ•°,å¯¹è±¡åˆ›å»ºæˆåŠŸ</p><p><img src="./ä½ ä¸çŸ¥é“çš„JavaScriptå­¦ä¹ /2-6.png" /></p><p>è¿™å°±è§£é‡Šäº† <code>Son.prototype.__proto__ === Father.prototyp</code>,åŸå‹é“¾å³ä½¿è¿™æ¡è“è‰²çš„é“¾è¡¨, çº¢è‰²çš„å°±æ˜¯å…¶æ„é€ çš„è¿‡ç¨‹:)</p><p>çœ‹èµ·æ¥æ²¡é—®é¢˜. ä½†æ˜¯, ä¸ºå•¥è¦æŠŠç±»ä¸Šçš„æ–¹æ³•å­˜å‚¨åœ¨åŸå‹ä¸Šå‘¢?å› ä¸ºè¿™æ ·æ‰€æœ‰çš„å­ç±»å°±è®¿é—®çˆ¶ç±»çš„åŒä¸€ä¸ªæ–¹æ³•.è¿™ä¸åŸºäºç±»çš„ç»§æ‰¿çš„å®ç°æ–¹æ³•ä¸å¤ªç›¸åŒ, ä½†æ˜¯ JavaScriptæœ¬èº«å°±æ˜¯åŸºäºåŸå‹é“¾ç»§æ‰¿çš„è€Œä¸æ˜¯åŸºäºç±»ç»§æ‰¿çš„.</p><p>äºæ˜¯, è¿™ä¸ªç»å…¸çš„å›¾å°±å¯ä»¥ç†è§£äº†. æ— éå°±æ˜¯åŠ å…¥äº†<strong>Object&amp;Function æ—¢æ˜¯å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡</strong> çš„æƒ³æ³•</p><p><img src="./ä½ ä¸çŸ¥é“çš„JavaScriptå­¦ä¹ /2-8.jpg" /></p><p><strong>åŸºäºåŸå‹é“¾çš„ç»§æ‰¿</strong></p><ul><li><p>å·®å¼‚ç»§æ‰¿</p><p>å›æƒ³ Java ç­‰åŸºäºç±»ç»§æ‰¿çš„è¯­è¨€. å­ç±»åœ¨å®ä¾‹åŒ–æ—¶åªä¼šæ‰§è¡Œçˆ¶ç±»çš„æ„é€ å‡½æ•°,å¹¶ä¸ä¼šå®ä¾‹åŒ–çˆ¶ç±», çˆ¶ç±»çš„å±æ€§å‡ä¼šå®ä¾‹åŒ–åœ¨å­ç±»ä¸Š.</p><p>ä½†æ˜¯ JavaScript æ˜¯åŸºäºåŸå‹é“¾ç»§æ‰¿çš„,æ„é€ çš„è¿‡ç¨‹å®é™…ä¸Šæ˜¯ä¸€å±‚ä¸€å±‚çš„çš„è°ƒç”¨æ„é€ å‡½æ•°å¹¶ä¸€å±‚ä¸€å±‚çš„æ„é€ å®ä¾‹.è¿™æ„å‘³ç€åœ¨æ„å»ºå­ç±»æ—¶çˆ¶å­ç±»å®ä¾‹éƒ½ä¼šè¢«åˆ›å»º, ç»§æ‰¿å…³ç³»åªæ˜¯åœ¨åŸå‹ä¸Šé€šè¿‡<code>__proto__</code> ç»´æŠ¤å­å¯¹è±¡ä¸çˆ¶å¯¹è±¡çš„å…³è”,å­ç±»å®ä¾‹ä¸Šåªç»´æŠ¤å…¶ä¸çˆ¶ç±»çš„å·®å¼‚. ä¹Ÿç§°è¿™ç§ç»§æ‰¿ä¸ºå·®å¼‚ç»§æ‰¿.</p></li><li><p><code>prototype</code> ä¸å±è”½</p><p>å¯¹è±¡çš„<strong>èµ‹å€¼</strong>ä¼šè§¦å‘ <code>[[Put]]</code> æ“ä½œ.<code>[[put]]</code> æŸ¥æ‰¾å¯¹è±¡å¤±è´¥åä¼šé¡ºç€å¯¹è±¡çš„åŸå‹é“¾æŸ¥æ‰¾æ ‡è¯†ç¬¦,äºæ˜¯äº§ç”Ÿäº†ä¸€äº›å¥‡æ€ªçš„è§„åˆ™.</p><p>å‡è®¾æ‰§è¡Œ <code>foo.bar = 1</code>, ä¸” <code>foo</code> ä¸Šæ²¡æœ‰<code>bar</code></p><ul><li><p>åŸå‹é“¾ä¸Šæ‰¾åˆ°äº†æ ‡è¯†ç¬¦ä¸”æ ‡è¯†ç¬¦ <code>writable: true</code>,<strong>ä¼šç›´æ¥åœ¨ <code>foo</code> ä¸Šåˆ›å»º <code>bar</code>, ç„¶åèµ‹å€¼.ç§°å…¶ä¸ºå±è”½å±æ€§</strong>(WTF!!)</p></li><li><p>åŸå‹é“¾ä¸Šæ‰¾åˆ°äº†æ ‡è¯†ç¬¦ä¸”æ ‡è¯†ç¬¦ <code>writable: false</code>,<strong>ä¼šé™é»˜å¤±æ•ˆ, åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæŠ›å‡ºé”™è¯¯</strong></p></li><li><p>åŸå‹é“¾ä¸Šæ‰¾åˆ°äº†æ ‡è¯†ç¬¦ä¸”æ ‡è¯†ç¬¦æœ‰ <code>setter</code>, ç›´æ¥åº”ç”¨<code>setter</code></p></li></ul><p><strong>ä¸Šé¢çš„è§„åˆ™éƒ½æ˜¯é’ˆå¯¹ <code>=</code> èµ‹å€¼çš„, ä½¿ç”¨<code>Object.defineProperty()</code>å°±ä¸ä¼šäº§ç”Ÿè¿™äº›ç ´ç©æ„</strong></p></li><li><p>ä»€ä¹ˆæ˜¯æ‰€è°“çš„æ„é€ å‡½æ•°</p><p>å®é™…ä¸Š, æ„é€ å‡½æ•°å°±æ˜¯æ™®é€šå‡½æ•°, æ„é€ å‡½æ•°ä¹Ÿå¯ä»¥åƒæ™®é€šå‡½æ•°ä¸€æ ·è°ƒç”¨.ä½†æ˜¯ä¸€æ—¦å‡½æ•°å‰é¢åŠ ä¸Šäº† <code>new</code>, <code>new</code>ä¼šåŠ«æŒæ™®é€šå‡½æ•°å¹¶å°†å…¶å½“ä½œæ„é€ å‡½æ•°è°ƒç”¨</p></li><li><p>åŸå‹ä¸Šçš„ <code>constructor</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token constant">C1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>v <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token constant">C2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>v <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">C2</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token class-name">C1</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span><span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">C2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// C1 &#123; v: 2 &#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>constructor <span class="token operator">===</span> <span class="token constant">C2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>constructor <span class="token operator">===</span> <span class="token constant">C1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹è±¡ä¸Šçš„ <code>constructor</code> å¹¶ä¸æ˜¯å¯¹è±¡çš„æ„é€ è€…, å› ä¸º<code>constructor</code> æ˜¯åœ¨å¯¹è±¡çš„åŸå‹ä¸Š, <code>constructor</code>åŸå‹çš„æ„é€ å‡½æ•°</p></li><li><p>æ‰‹åŠ¨åŸå‹ç»§æ‰¿</p><p>è¿™æ˜¯ä¸€äº›ç»§æ‰¿æ–¹æ¡ˆ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token constant">C1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">C1</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayC1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'IM C1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token constant">C2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token constant">C1</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†C1çš„å˜é‡å®šä¹‰ç»§æ‰¿åˆ°äº†C2</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">C2</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">C1</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ‘ å°†C1çš„æ–¹æ³•ç»§æ‰¿åˆ°C2å¯è¡Œæ–¹æ¡ˆ1(ES6å‰)</span><span class="token comment">// Object.setPrototypeOf(C2.prototype, C1.prototype); // ğŸ‘ å°†C1çš„æ–¹æ³•ç»§æ‰¿åˆ°C2å¯è¡Œæ–¹æ¡ˆ2(ES6)</span><span class="token comment">// C2.prototype = C1.prototype; // ğŸ‘é”™è¯¯æ–¹æ¡ˆ1</span><span class="token comment">// C2.prototype = new C1(); // ğŸ‘é”™è¯¯æ–¹æ¡ˆ2</span><span class="token class-name">C2</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayC2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'IM C2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">C2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// C1 &#123; x: 1, y: 2 &#125;</span>c<span class="token punctuation">.</span><span class="token function">sayC1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// IM C1</span>c<span class="token punctuation">.</span><span class="token function">sayC2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// IM C2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»§æ‰¿å˜é‡æ²¡å¾—è¯´, ç›´æ¥ <code>apply()</code> å°±è¡Œ,ä½†æ˜¯æœ‰å››ä¸ªç»§æ‰¿æ–¹æ³•çš„æ–¹æ¡ˆ</p><ul><li><p><code>C2.prototype = Object.create(C1.prototype);</code>è¿™æ˜¯åœ¨ES6ä¹‹å‰çš„æ–¹æ¡ˆ</p><p><code>Object.create()</code> æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡,å¹¶ä½¿ç”¨å‚æ•°å¯¹è±¡æ¥ä½œä¸ºæ–°åˆ›å»ºå¯¹è±¡çš„åŸå‹</p><p>ä¸€ä¸ªç®€æ˜“çš„ <code>create</code> å®ç°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token class-name">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> o<span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>Object.setPrototypeOf(C2.prototype, C1.prototype);</code>:<code>ES6</code> æ–°å¢çš„è§£å†³æ–¹æ¡ˆ</p></li><li><p><code>C2.prototype = C1.prototype;</code> ä¼šé€ æˆä¿®æ”¹<code>C2.prototype</code> æ—¶ç›´æ¥ä¿®æ”¹äº† <code>C1.prototyoe</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token constant">C1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">C1</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'IM C1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token constant">C2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token constant">C1</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†C1çš„å˜é‡å®šä¹‰ç»§æ‰¿åˆ°äº†C2</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">C2</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token class-name">C1</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span><span class="token class-name">C2</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'IM C2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> c1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">C1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> c2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">C2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c1<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// IM C2</span>c2<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// IM C2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>C2.prototype = new C1();</code> ä¸æ¨èè¿™ä¸ªæ–¹æ³•, åŸå› æ˜¯</p><ul><li><code>C2</code> çš„åŸå‹ä¸Šä¼šæœ‰ <code>C1</code> çš„å˜é‡</li><li>è°ƒç”¨ <code>new C1()</code>æ„é€ å‡½æ•°å¯èƒ½äº§ç”Ÿå‰¯ä½œç”¨(å¦‚ä¿®æ”¹å…¨å±€å˜é‡)</li></ul><p>å¦‚ä¸‹æ˜¯ä¸¤è€…å¯¹æ¯”</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token constant">C1</span> <span class="token punctuation">(</span><span class="token class-name">C2</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">C1</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>ç‰ˆ<span class="token punctuation">)</span>  <span class="token punctuation">[</span><span class="token punctuation">[</span>Prototype<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">:</span> Object    <span class="token function-variable function">sayC1</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'IM C1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>    <span class="token literal-property property">constructor</span><span class="token operator">:</span> Æ’ <span class="token constant">C1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">[</span><span class="token punctuation">[</span>Prototype<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">:</span> Object<span class="token constant">C1</span> <span class="token punctuation">(</span><span class="token class-name">C2</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">C1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ç‰ˆ<span class="token punctuation">)</span>  <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">1</span>  <span class="token punctuation">[</span><span class="token punctuation">[</span>Prototype<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">:</span> Object    <span class="token function-variable function">sayC1</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'IM C1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>    <span class="token literal-property property">constructor</span><span class="token operator">:</span> Æ’ <span class="token constant">C1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">[</span><span class="token punctuation">[</span>Prototype<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">:</span> Object<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><p><strong>å¯¹è±¡å…³è”</strong></p><p>é€šè¿‡ç»§æ‰¿å¯ä»¥è®©ä¸¤ä¸ªå¯¹è±¡å…³è”èµ·æ¥. å¦‚æœåªæ˜¯æƒ³å®ç°è·¨å¯¹è±¡è°ƒç”¨æ–¹æ³•,è¿™å°±æ˜¾å¾—æ¯”è¾ƒéº»çƒ¦äº†(å› ä¸ºè¦ç»´æŠ¤ <code>constructor/__proto__</code>),æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>Object.create()</code> å®ç°ä¸¤ä¸ªå¯¹è±¡çš„å…³è”.å®ç°å…³è”åæœ€å¥½ä¸è¦ä½¿ç”¨å¤–éƒ¨å§”æ‰˜çš„è°ƒç”¨æ¨¡å¼, å³</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token function">sayF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> bar <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span>bar<span class="token punctuation">.</span><span class="token function">sayF</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å¤–éƒ¨å§”æ‰˜</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è€Œæ˜¯é‡‡ç”¨å†…éƒ¨å§”æ‰˜</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token function">sayF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> bar <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span>bar<span class="token punctuation">.</span><span class="token function-variable function">doSayF</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sayF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å†…éƒ¨å§”æ‰˜</span><span class="token punctuation">&#125;</span>bar<span class="token punctuation">.</span><span class="token function">doSayF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·å¯ä»¥æé«˜ä»£ç å¯è¯»æ€§ä¸å®‰å…¨æ€§</p><h3 id="é¢å‘å§”æ‰˜ä¸é¢å‘å¯¹è±¡çš„è®¾è®¡">é¢å‘å§”æ‰˜ä¸é¢å‘å¯¹è±¡çš„è®¾è®¡</h3><ul><li><p>ä¼ ç»Ÿçš„OOPç¼–ç¨‹:é¼“åŠ±åœ¨ç»§æ‰¿æ—¶ä½¿ç”¨æ–¹æ³•é‡å†™(å’Œå¤šæ€)è¦†ç›–çˆ¶ç±»æ›´åŠ æŠ½è±¡çš„æ–¹æ³•</p></li><li><p>å§”æ‰˜ç¼–ç¨‹: è¦æ±‚å°†ä¸¤ä¸ªå¯¹è±¡å½“ä½œåä½œçš„å…„å¼Ÿ,å½“æŸä¸ªå¯¹è±¡ä¸Šæ²¡æœ‰æ–¹æ³•æ—¶ä¼šè¦æ±‚å¦ä¸€ä¸ªå¯¹è±¡å¸®å¿™å®ç°,æ­¤å¤–å§”æ‰˜ç¼–ç¨‹è¿˜æœ‰ä¸€äº›ç‰¹ç‚¹</p><ul><li>å˜é‡ç›´æ¥å­˜å‚¨åœ¨å§”æ‰˜ä¸Š: å› ä¸ºè¢«å§”æ‰˜è€…åªæ˜¯å°†åŸå‹ä¸Šçš„å±æ€§è¿æ¥åˆ°äº†å§”æ‰˜è€…,ä¸ä¼šå¸¦è¢«å§”æ‰˜è€…çš„å±æ€§</li><li>è¢«å§”æ‰˜è€…æ–¹æ³•åˆ›å»ºçš„å˜é‡ä¼šç›´æ¥å­˜åœ¨å§”æ‰˜è€…ä¸Š: è°ƒç”¨æ—¶å€™ä¸€èˆ¬æ˜¯<code>å§”æ‰˜è€….æ–¹æ³•()</code>, æ­¤æ—¶ <code>this</code>è¢«éšå¼ç»‘å®šåœ¨äº†å§”æ‰˜è€…ä¸Š</li><li>ä¸é¼“åŠ±é‡å†™æ–¹æ³•, é¼“åŠ±åœ¨å§”æ‰˜è€…èº«ä¸Šå®šä¹‰æ›´åŠ å…·æœ‰æè¿°æ€§çš„æ–¹æ³•å:JavaScript çš„åŸå‹é“¾<code>[[put]]</code> æœºåˆ¶è®©é‡å†™å¾ˆéº»çƒ¦</li><li>ä¸å…³æ³¨ç±»ä¸ç±»ä¹‹é—´çš„å±‚æ¬¡å…³ç³»è€Œæ˜¯å…³å¿ƒå¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„ç›¸äº’å€Ÿç”¨å…³ç³»(æ‹¿æ¥å§ä½ ğŸ–)</li><li>ä¸å¾—å¾ªç¯å§”æ‰˜</li></ul><p><strong>åç±»åŒ–</strong></p><p>æœ‰çš„æ—¶å€™, æˆ‘ä»¬ä¸éœ€è¦ç±», åªæ˜¯éœ€è¦ç±»ä¸Šçš„æ–¹æ³•,æ­¤æ—¶æˆ‘ä»¬å¯ä»¥åœ¨ç”¨å§”æ‰˜æœºåˆ¶åœ¨ä¸å®ä¾‹åŒ–çˆ¶ç±»çš„æƒ…å†µä¸‹ä½¿ç”¨ç±»ä¸Šçš„æ–¹æ³•</p><p><strong>å†…çœ</strong></p><p>æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°çš„å®ä¾‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">/*...*/</span><span class="token punctuation">&#125;</span><span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token operator">...</span><span class="token keyword">function</span> <span class="token function">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">/*...*/</span><span class="token punctuation">&#125;</span><span class="token class-name">Bar</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> b1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token string">"b1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è®©Fooå’ŒBaräº’ç›¸å…³è”</span><span class="token class-name">Bar</span><span class="token punctuation">.</span>prototype <span class="token keyword">instanceof</span> <span class="token class-name">Foo</span><span class="token punctuation">;</span><span class="token comment">// true</span>Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span><span class="token class-name">Bar</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span> <span class="token comment">//true</span><span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">isPrototypeOf</span><span class="token punctuation">(</span><span class="token class-name">Bar</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true</span><span class="token comment">// è®©b1å…³è”åˆ°Fooå’ŒBar</span>b1 <span class="token keyword">instanceof</span> <span class="token class-name">Foo</span><span class="token punctuation">;</span><span class="token comment">// true</span>b1 <span class="token keyword">instanceof</span> <span class="token class-name">Bar</span><span class="token punctuation">;</span><span class="token comment">// true</span>Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>b1<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token class-name">Bar</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span> <span class="token comment">//true</span>Foo<span class="token punctuation">.</span><span class="token function">isPrototypeOf</span><span class="token punctuation">(</span>b1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true</span>Bar<span class="token punctuation">.</span><span class="token function">isPrototypeOf</span><span class="token punctuation">(</span>b1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿˜æœ‰ä¸€ç§æ›´åŠ è„†å¼±çš„å†…çœæ¨¡å¼ï¼Œä½†æ˜¯åœ¨å¼€å‘è€…ä¸Šé¢ç”¨çš„å¾ˆå¤š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">if</span><span class="token punctuation">(</span>a1<span class="token punctuation">.</span>something<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> a1<span class="token punctuation">.</span><span class="token function">somethinf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="åˆ©ç”¨åŸå‹é“¾çš„æœ‰è¶£å†™æ³•">åˆ©ç”¨åŸå‹é“¾çš„æœ‰è¶£å†™æ³•</h3><h3 id="es6-çš„-class-è¯­æ³•"><code>ES6</code> çš„ <code>class</code>è¯­æ³•</h3><p><strong>ä¼˜ç‚¹</strong>:</p><ul><li>é€šè¿‡ <code>supper</code> åŸºæœ¬æœç»äº† <code>prototype</code>,å¹¶å®ç°äº†å¤šæ€</li><li>ç®€æ´çš„ç»§æ‰¿å®šä¹‰</li><li>ä¸èƒ½å£°æ˜å±æ€§, åªèƒ½å£°æ˜æ–¹æ³•</li></ul><p><strong>ç¼ºç‚¹</strong></p><ul><li><p>åè¯æ³•</p><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> LoginController <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">errors</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// æ— éœ€function</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>è¿™æ˜¯ä¸ªè¯­æ³•ç³–, ç¼–è¯‘åå˜ä¸º</p><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> AuthController <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">errors</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token function-variable function">getUser</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>ç¼–è¯‘å <code>getUser</code> å¼•ç”¨äº†ä¸€ä¸ªåŒ¿åå‡½æ•°, è¿™æ„å‘³ç€</p><ol type="1"><li>ä½¿è°ƒè¯•æ—¶çš„æ ˆè¿½è¸ªå˜å¾—å›°éš¾</li><li>ä½¿è‡ªå¼•ç”¨ï¼ˆé€’å½’ï¼Œäº‹ä»¶ç»‘å®šç­‰ï¼‰å˜å¾—å›°éš¾</li><li>ä½¿ä»£ç ï¼ˆç¨ç¨ï¼‰å˜å¾—éš¾äºç†è§£</li></ol></li><li><p>å­˜åœ¨å˜é‡åä¸æ–¹æ³•åä¹‹é—´çš„å±è”½, <code>supper</code>é€ æˆçš„éšå¼å±è”½</p></li><li><p>å¯ä»¥é€šè¿‡ä¿®æ”¹ <code>prototype</code> çš„æ–¹æ³•åœ¨ <code>class</code>å®šä¹‰åä¿®æ”¹ <code>class</code> å®šä¹‰</p></li></ul><h2 id="ç±»å‹ä¸è¯­æ³•">ç±»å‹ä¸è¯­æ³•</h2><h3 id="ç±»å‹">ç±»å‹</h3><p>JavaScript æ˜¯æœ‰ç±»çš„, ä½†æ˜¯ JavaScript æ˜¯ä¸€ä¸ªåŠ¨æ€è‹¥ç±»å‹è¯­è¨€,æˆ‘ä»¬æ²¡æ³•è¯´å˜é‡å±äºä»€ä¹ˆç±»å‹, åªèƒ½è¯´å˜é‡å¯¹åº”çš„å€¼æ˜¯ä»€ä¹ˆç±»å‹çš„.</p><p>å†…ç½®ç±»å‹æœ‰<code>null, undefined, boolean, number, string, object, symbol</code>,å¯ä»¥ç”¨ <code>typeof</code> åˆ¤æ–­å€¼çš„ç±»å‹</p><p><code>typeof</code> åˆ¤æ–­ç±»å‹æ˜¯å­˜åœ¨éƒ¨åˆ†ç‰¹ä¾‹</p><ul><li><p><code>typeof null === 'object'</code>, è¿™æ˜¯ JavaScript çš„ä¸€ä¸ªå°bug. è‹¥ç¡®å®éœ€è¦æ£€æµ‹ <code>null</code> å¯ä»¥ä½¿ç”¨<code>!foo &amp;&amp; typeof foo === 'object'</code> åˆ¤å®š</p></li><li><p><code>typeof function () &#123;&#125; === 'function'</code>, è™½ç„¶å‡½æ•°æ˜¯<code>Object</code> çš„å­ç±», ä½†æ˜¯ <code>typeof</code>ä¼šç‰¹æ®Šçš„è¿”å›<code>function</code> è€Œä¸æ˜¯ <code>object</code>. åŒæ—¶,å‡½æ•°çš„ <code>length</code> æ˜¯å…¶å½¢å‚çš„æ•°é‡,å½¢å‚çš„æ•°é‡ä¸åŒ…æ‹¬å‰©ä½™å‚æ•°ä¸ªæ•°ï¼Œä»…åŒ…æ‹¬ç¬¬ä¸€ä¸ªå…·æœ‰é»˜è®¤å€¼ä¹‹å‰çš„å‚æ•°ä¸ªæ•°ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// fun1.length = 1</span><span class="token keyword">function</span> <span class="token function">fun2</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// fun2.length = 2</span><span class="token keyword">function</span> <span class="token function">fun3</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// fun3.length = 3</span><span class="token keyword">function</span> <span class="token function">fun4</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// fun4.length = 3</span><span class="token keyword">function</span> <span class="token function">fun5</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// fun5.length = 0</span><span class="token keyword">function</span> <span class="token function">fun6</span><span class="token punctuation">(</span><span class="token parameter">a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// fun6.length = 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>typeof æœªå®šä¹‰å€¼ === 'undefined'</code></p></li></ul><p><strong><code>undefined</code> ä¸<code>undeclared</code></strong></p><ul><li>å½“æˆ‘ä»¬è®¿é—®ä¸€ä¸ªå·²å®šä¹‰ä½†æ˜¯æ²¡æœ‰èµ‹å€¼çš„å˜é‡æ—¶, ä¼šè¿”å›<code>undefined</code></li><li>å½“æˆ‘ä»¬è¿”å›ä¸€ä¸ªæ²¡æœ‰å®šä¹‰çš„(undeclared) å€¼æ—¶,<ul><li>è‹¥åœ¨æ˜¯è®¿é—®å¯¹è±¡ä¸Šçš„æ ‡è¯†ç¬¦, ä¼šè¿”å› <code>undefined</code>, (å¯¹è±¡ä¸Š<code>[[Get]]</code> çš„ä¿æŠ¤æœºåˆ¶)</li><li>å¦åˆ™æŠ›å‡º <code>ReferenceError</code></li></ul></li></ul><p>ä½†æ˜¯ <code>typeof</code> çš„ä¿æŠ¤æœºåˆ¶ä¼šè®© <code>undefined</code> ä¸<code>undeclared</code> å‡è¿”å› <code>undefined</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> a<span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™ç§ä¿æŠ¤æœºåˆ¶å¯ä»¥è®©æˆ‘ä»¬è½»æ¾çš„åˆ¤æ–­å…¨å±€ä½œç”¨åŸŸä¸Šæ˜¯å¦æœ‰æŸä¸ªå±æ€§, æ–¹ä¾¿å¤–éƒ¨JavaScript æ¨¡å—åŠ è½½æ—¶æ£€æµ‹å…¨å±€ç¯å¢ƒ, å®ç°é€‰æ‹©æ€§åŠ è½½</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> foo<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong><code>void</code>å…³é”®å­—</strong></p><p><code>void</code> è¡¨è¾¾å¼æ°¸è¿œè¿”å› <code>undefined</code> å€¼, ä¾‹å¦‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong><code>undefined</code> ä¸ <code>null</code></strong></p><p>ä¸€èˆ¬ç”¨ <code>null</code> è¡¨ç¤ºç©ºå€¼, ç”¨ <code>undefined</code>è¡¨ç¤ºæ²¡æœ‰å€¼.</p><p>æ¯”è¾ƒç‰¹æ®Šçš„æ˜¯: <strong><code>null</code> æ˜¯ä¸€ä¸ªå…³é”®å­—, ä½†æ˜¯<code>undefined</code> åªæ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦, ä»–çš„å€¼é»˜è®¤ä¸ºundefined</strong>,æ‰€ä»¥ä»¥ä¸‹ä»£ç æ˜¯æˆç«‹çš„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token keyword">undefined</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">const</span> demo <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>demo<span class="token punctuation">.</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>demo<span class="token punctuation">.</span>t <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false, å› ä¸º undefined æ ‡è¯†ç¬¦å¯¹åº”çš„ä¸æ˜¯ undefined å€¼</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>demo<span class="token punctuation">.</span>t <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true, å› ä¸º void 0 è¿”å›çš„æ˜¯ undefined å€¼</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å€¼">å€¼</h3><ul><li><p>æ•°ç»„</p><ul><li><p>åˆ é™¤å…ƒç´ :<code>delete a[1] / a.splice(1,1);</code>ä¼ªæ•°ç»„è½¬æ•°ç»„</p><p>å¸¸è§çš„ä¼ªæ•°ç»„æœ‰ <code>DOMList</code>, <code>arguments</code>,ä¼ªæ•°ç»„æ²¡æœ‰æ•°ç»„ä¸Šçš„éƒ¨åˆ†æ–¹æ³•, è½¬æ¢æ–¹æ³•ä¸º(å‡è®¾<code>foo -&gt; bar</code>)</p><ul><li>éå†ä¼ªæ•°ç»„å…ƒç´ </li><li><code>bar = Array.prototype.slice.call(foo);</code></li><li><code>bar = Array.from(foo);</code></li><li><code>bar = [...foo];</code></li></ul></li></ul></li><li><p>å­—ç¬¦ä¸²</p><p>å­—ç¬¦ä¸²ä¸æ˜¯å­—ç¬¦æ•°ç»„, ä¸¤è€…èº«ä¸Šçš„æ–¹æ³•æœ‰å·®å¼‚</p><ul><li><p>å­—ç¬¦ä¸²ä¸å¯å˜</p><ul><li><p>å­—ç¬¦ä¸²çš„å€¼ä¸å¯è¢«å¤–éƒ¨ä¿®æ”¹</p><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">'123'</span><span class="token punctuation">;</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '123'</span><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token string">'123'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['1', '0', '3']</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>å­—ç¬¦ä¸²ä¸Šçš„æ–¹æ³•ä¸å¾—ä¿®æ”¹å­—ç¬¦ä¸²çš„å€¼(æ¢è€Œè¨€ä¹‹,è°ƒç”¨å­—ç¬¦ä¸²çš„æ–¹æ³•åªä¼šè¿”å›æ–°å€¼, è€Œä¸ä¼šä¿®æ”¹å­—ç¬¦ä¸²åŸå€¼)</p></li></ul></li><li><p>å­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨éƒ¨åˆ†å­—ç¬¦æ•°ç»„çš„æ–¹æ³•:</p><ul><li><p>å­—ç¬¦ä¸²å¯ä»¥é€šè¿‡ <code>Array</code> åŸå‹æ–¹æ³•è®¿é—®<code>Array.prototype.reverse.call(s)</code></p></li><li><p>è‹¥è®¿é—®çš„æ–¹æ³•ä¼šä¿®æ”¹åŸå­—ç¬¦ä¸², é‚£ä¹ˆè¯¥æ–¹æ³•å°†æ— æ³•è°ƒç”¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token string">'123'</span><span class="token punctuation">;</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError: Cannot assign to read only property '0' of object '[object String]'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¯ä»¥å…ˆå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°ç»„åœ¨è°ƒç”¨æ–¹æ³•æœ€åè½¬å›</p></li></ul></li></ul></li><li><p>æ•°å­—</p><p>JavaScript åªæœ‰æ•°å­—ä¸€ä¸ªç±»å‹, æ²¡æœ‰æ‰€è°“æ•´æ•°å°æ•°ä¹‹åˆ†. æ•°å­—å…¨éƒ¨ä½¿ç”¨ IEEE754 çš„ 64 ä½ç‰ˆæœ¬å®ç°</p><ul><li><p>ç®€å†™è§„åˆ™</p><p>åœ¨ä¹¦å†™å­—é¢é‡æ—¶, å¯ä»¥çœç•¥å‰å¯¼ä¸åç»§ <code>0</code>, ä¾‹å¦‚<code>0.12 === .12</code>, <code>12.0 === 12.</code></p><p>å—ç®€å†™è§„åˆ™å½±å“, éƒ¨åˆ†æ–¹æ³•è°ƒç”¨æ˜¯æ— æ•ˆçš„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ‘ æœ‰æ•ˆ</span><span class="token number">0.12</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ‘ æœ‰æ•ˆ, ç¬¬äºŒä¸ªç‚¹ä¸å¯èƒ½æ˜¯å°æ•°ç‚¹</span><span class="token number">12.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ‘ æ— æ•ˆ, JSä¼šå…¶ä¸º (12.)toFixed</span><span class="token number">12.</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ‘ æœ‰æ•ˆ, ç¬¬ä¸€ä¸ªç‚¹æ˜¯ç®€å†™, ç¬¬äºŒä¸ªç‚¹æ˜¯é“¾å¼è°ƒç”¨</span><span class="token number">12</span> <span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ‘ æœ‰æ•ˆ, æ³¨æ„æ•°å­—ä¸ç‚¹ä¹‹é—´æœ‰ç©ºæ ¼</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ ¼å¼åŒ–æ–¹æ³•</p><ul><li><p><code>toFixed</code> æŒ‡å®šå°æ•°ä½æ•°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">42.59</span><span class="token punctuation">;</span>a<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "43"</span>a<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "42.6"</span>a<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span> <span class="token number">2</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "42.59"</span>a<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span> <span class="token number">3</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "42.590</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>toPrecision</code> æŒ‡å®šæœ‰æ•ˆä½æ•°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">42.59</span><span class="token punctuation">;</span>a<span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "4e+1"</span>a<span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span> <span class="token number">2</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "43"</span>a<span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span> <span class="token number">3</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "42.6"</span>a<span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span> <span class="token number">4</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "42.59"</span>a<span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span> <span class="token number">5</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "42.590"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>è¿ç®—è¯¯å·®: JavaScript è‡ªå¸¦ <code>Number.EPSILON</code>ä½œä¸ºè¿ç®—è¯¯å·®, è¿™ä¸ªå€¼ä¸€èˆ¬ä¸º <spanclass="math inline">\(2^{-52}-1\)</span></p></li><li><p>æ•´æ•°æ£€æµ‹: <code>Number.isInteger / Number.isSafeInteger</code>å¯åˆ†åˆ«ç”¨äºæ•´æ•°, å®‰å…¨æ•´æ•°æ£€æµ‹</p></li><li><p>å‚ä¸ä½è¿ç®—: è™½ç„¶ IEEE 754 å…è®¸æœ€å¤§å®‰å…¨æ•´æ•°ä¸º <spanclass="math inline">\(2^{53}-1\)</span>, ä½†æ˜¯, åœ¨æ‰§è¡Œä½è¿ç®—æ—¶, åªæœ‰å 32ä½æ•°ä¼šå‚ä¸è¿ç®—, å…¶ä½™ä½å°†è¢«å¿½ç•¥. å€ŸåŠ©æ­¤ç‰¹æ€§, å¯ä»¥é€šè¿‡ <code>a | 0</code>å°† <code>a</code> è½¬ä¸º 32 ä½æ•´æ•°</p></li><li><p><code>NaN</code>: <code>NaN</code> æ˜¯ä¸€ä¸ªæ•°å€¼ç±»å‹, ä½†ä¸æ˜¯æ•°å­—.å½“å‡ºç° Number è¿ç®—ç»“æœæ— æ³•è¿”å›æ•°å­—æ—¶å°±ä¼šè¿”å› <code>NaN</code>. æ‰€ä»¥,<code>NaN</code> å¯ä»¥ç”¨æ¥æç¤ºæ•°å€¼è¿ç®—å‡ºé”™</p><p><code>NaN !== NaN</code>, è¿™æ˜¯ JavaScript å”¯ä¸€è‡ªå·±ä¸è‡ªå·±ä¸ç­‰çš„å…ƒç´ .åˆ¤æ–­ <code>NaN</code> å¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹æ³•</p><ul><li><code>Number.isNaN(a)</code>: åˆ©ç”¨ ES6 çš„æ–°æ–¹æ³•åˆ¤æ–­ <code>a</code>æ˜¯ä¸æ˜¯ <code>NaN</code></li><li><code>a !== a;</code>: åå‘åˆ©ç”¨å…¶åè‡ªåçš„ç‰¹æ€§åˆ¤æ–­ <code>a</code>æ˜¯ä¸æ˜¯ <code>NaN</code></li><li><code>Object.is(NaN, a)</code>: åˆ©ç”¨æ–°æ–¹æ³•åˆ¤æ–­ <code>a</code> æ˜¯ä¸æ˜¯<code>NaN</code> (åé¢è§£é‡Šå®ç°)</li></ul></li><li><p><code>0 &amp; -0</code></p><p>éƒ¨åˆ†åœºæ™¯éœ€è¦ä½¿ç”¨è´Ÿå·è¡¨ç¤ºæ–¹å‘, JavaScript ä¸­æœ‰ <code>0</code> ä¸<code>-0</code>.</p><ul><li><p><code>-0 === 0</code></p></li><li><p>å¯ä»¥é€šè¿‡å­—é¢é‡, éåŠ å‡çš„è¡¨è¾¾å¼, ç±»å‹è½¬æ¢äº§ç”Ÿ<code>-0</code></p></li><li><p><code>-0</code> è½¬ä¸ºå­—ç¬¦ä¸²åä¼šå¤±å»è´Ÿå·</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0</span> <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p><code>'-0'</code> å­—ç¬¦ä¸²è½¬ä¸ºéå­—ç¬¦ä¸²æ—¶ä¼šä¿ç•™è´Ÿå·</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token string">'-0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">'-0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'-0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>åˆ¤å®š <code>-0</code></p><ul><li><p>æ‰‹åŠ¨å®ç°æ–¹æ³•</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">isNegZero</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> n <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> v <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token number">1</span> <span class="token operator">/</span> v <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">Infinity</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>Object.is(-0, a)</code>: åˆ©ç”¨æ–°æ–¹æ³•åˆ¤æ–­ <code>a</code>æ˜¯ä¸æ˜¯ <code>-0</code></p><p>è¿™ä¸ª <code>is</code> æ–¹æ³•çœ‹èµ·æ¥å¾ˆç¥å¥‡, å…¶å®å°±æ˜¯ç‰¹åˆ¤äº†<code>NaN</code> ä¸ <code>-0</code> çš„ <code>===</code></p></li></ul></li></ul></li><li><p><code>Infinity</code></p><p>è®¾æœ‰é™æ­£æ•° <code>a</code></p><ul><li>ä¸æœ‰é™æ•°åŠ å‡æ³•: <code>Infinity (+/-) a === Infinity</code></li><li>ä¸ <code>Infinity</code> åŠ å‡æ³•:<code>Infinity - Infinity === NaN</code>,<code>Infinity - -Infinity === Infinity</code></li><li>ä¸æœ‰é™é0æ•°ä¹˜é™¤æ³•: <code>Infinity (*//) a === Infinity</code>,<code>Infinity (*//) -a === -Infinity</code></li><li>ä¸0ä¹˜é™¤æ³•: <code>a/0 === Infinity</code>,<code>-a/0 === -Infinity</code>, <code>Infinity / 0 === Infinity</code>,<code>Infinity * 0 = NaN</code>,</li><li>ä¸ <code>Infinity</code> ä¹˜é™¤æ³•:<code>Infinity * Infinity === Infinity</code>,<code>Infinity / Infinity === NaN</code></li></ul></li></ul></li></ul><h3 id="åŸç”Ÿå‡½æ•°">åŸç”Ÿå‡½æ•°</h3><p>åœ¨å†™ TS æ—¶ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜, æè¿°ç±»å‹çš„æ—¶å€™åº”è¯¥ç”¨å°å†™(å¦‚:<code>string</code>), è€Œä¸èƒ½ç”¨å¤§å†™(å¦‚: <code>String</code>),å› ä¸ºå¤§å†™çš„æ˜¯æ„é€ å‡½æ•°.</p><p>JavaScript å†…å»ºçš„å‡½æ•°(åŸç”Ÿå‡½æ•°)æœ‰:<code>String, Number, Boolean, Array, Object, Function, RegExp, Date, Error, Symbol</code>.</p><p><strong>å°è£…</strong></p><ul><li><p>å¯¹äºåŸºæœ¬ç±»å‹é <code>Object</code>ç±»å‹(<code>String, Number, Boolean, Symbol</code>)çš„å€¼</p><p>åŸºæœ¬ç±»å‹å€¼ä¸é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºçš„å€¼ä¸åŒ.é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºçš„å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> s1 <span class="token operator">=</span> <span class="token string">'aaa'</span><span class="token punctuation">;</span><span class="token keyword">const</span> s2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">'aaa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// aaa</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [String: 'aaa']</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s1 <span class="token operator">===</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŒæ—¶å¯¹è±¡æ°¸è¿œä¸º <code>true</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> b1 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token keyword">const</span> b2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span>b1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span>b2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b1 <span class="token operator">===</span> b2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b1 <span class="token operator">==</span> b2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹èµ·æ¥åŸºæœ¬ç±»å‹å€¼ä¸å¯¹è±¡è¿˜æ˜¯æœ‰åŒºåˆ«çš„, å¯¹è±¡ä¸­å°è£…äº†åŸºæœ¬ç±»å‹å€¼.åŸºæœ¬ç±»å‹å€¼æœ¬èº«åªæ˜¯ä¸€ä¸ªåŸºæœ¬ç±»å‹å€¼, ä¸Šé¢æ²¡æœ‰æ–¹æ³•(å¦‚:<code>s.length</code>),ä½†æ˜¯å½“åŸºæœ¬ç±»å‹å€¼è¦è®¿é—®å…¶å¯¹åº”åŸç”Ÿå‡½æ•°å¯¹è±¡ä¸Šçš„æ–¹æ³•æ—¶, <strong>JavaScriptä¼šè‡ªåŠ¨å°†åŸºæœ¬ç±»å‹å€¼å°è£…ä¸ºå¯¹è±¡</strong>. å°è£…ä¸ºå¯¹è±¡å½“ç„¶è¦è€—è´¹æ—¶é—´,ä½†æ˜¯<strong>ä¸è¦ä¸ºæ­¤æ•…æ„å°†å­—é¢é‡å£°æ˜ä¸ºå¯¹è±¡</strong>, JavaScriptå¼•æ“ä¼šå¯¹ä»£ç åšæ€§èƒ½è°ƒä¼˜å¹¶å†³å®šåœ¨ä»€ä¹ˆæ—¶å€™å°è£…å¯¹è±¡.</p></li><li><p>å¯¹äºåŸºæœ¬ç±»å‹ä¸º <code>Object</code>ç±»å‹(<code>Array, Object, Function, RegExp, Date, Error</code>)çš„å€¼</p><p>ä½¿ç”¨å­—é¢é‡åˆ›å»º(å¦‚æœå¯ä»¥)ä¸ä½¿ç”¨å‡½æ•°åˆ›å»ºæ˜¯å®Œå…¨ä¸€æ ·çš„</p><ul><li><p><code>Array</code></p><ul><li><p>åˆ›å»º <code>Array</code> æ—¶å¯ä»¥ä¸å¸¦ <code>new</code></p></li><li><p>é€šè¿‡ <code>Array(n)</code> å¯ä»¥åˆ›å»ºåŒ…å« <code>n</code>ä¸ªç©ºå€¼(<code>empty item</code>)çš„æ•°ç»„</p></li><li><p>ç›´æ¥æ”¹å¤§æ•°ç»„çš„ <code>length</code> ä¼šå¯¼è‡´äº§ç”Ÿç©ºå€¼</p></li><li><p>ç©ºå€¼ä¸æ˜¯ <code>undefined</code>, ä¸åŒå‡½æ•°å¯¹ç©ºå€¼ä¸<code>undefined</code> çš„å¤„ç†ä¸åŒ <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// --</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// --</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ &lt;3 empty items> ]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 0, 1, 2 ]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><code>join</code> ä¸è€ƒè™‘ç©ºå€¼çš„å­˜åœ¨, ç›´æ¥é€šè¿‡ <code>arr.length</code>éå†æ¯ä¸ªå…ƒç´ . è€Œ <code>map</code> åœ¨å¤„ç†ç©ºå€¼æ—¶ä¼šç›´æ¥è·³è¿‡ç©ºå€¼</p><p>åº”æ­¤, <code>Array(n)</code> åˆ›å»ºçš„ç©ºå€¼æ•°ç»„æ˜¯å±é™©çš„, å¯ä»¥ä½¿ç”¨<code>Array.apply(null, &#123; length: n &#125;)</code> åˆ›å»ºé•¿åº¦ä¸º <code>n</code>çš„ <code>[undefined...]</code> æ•°ç»„</p></li></ul></li><li><p><code>Object, Function, RegExp</code></p><ul><li>ä¸å»ºè®®ä½¿ç”¨æ„é€ å‡½æ•°æ„é€ è¿™äº›å¯¹è±¡,å¯ä»¥ç›´æ¥ä½¿ç”¨<code>&#123;&#125;, function, //</code> æ„å»º</li><li>å¯¹äºéœ€è¦ä¿®æ”¹çš„æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨ <code>RegExp</code> æ„å»º(ä½†æ˜¯<code>RegExp</code> çš„æ•ˆç‡ä¸åŠ <code>//</code>)</li></ul></li><li><p><code>Date, Error</code></p><ul><li>æ— æ³•ç”¨å­—é¢é‡åˆ›å»ºè¿™äº›å€¼</li><li><code>new Date()</code> ä¸å¸¦å‚æ•°é»˜è®¤ä½¿ç”¨å½“å‰æ—¶é—´</li><li>ä¸å¸¦ <code>new</code> çš„ <code>Date()</code> æ— è®ºå‚æ•°å¦‚ä½•,éƒ½è¿”å›æ—¥æœŸå­—ç¬¦ä¸²</li><li>è‹¥åªæ˜¯æƒ³è·å¾—å½“å‰æ—¶é—´æˆ³å¯ä»¥ä½¿ç”¨é™æ€æ–¹æ³• <code>Date.now()</code></li><li>åˆ›å»º <code>Error</code> æ—¶å¯ä»¥ä¸å¸¦ <code>new</code></li></ul></li></ul></li><li><p>å°è£…å¯¹è±¡çš„ <code>[[class]]</code>: æ‰€æœ‰ <code>typeof</code> è¿”å›<code>object</code> çš„å˜é‡ä¸Šé¢éƒ½æœ‰ä¸€ä¸ª <code>[[class]]</code>,è¡¨ç¤ºå¯¹è±¡çš„"å­ç±»å‹"</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//...</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Number]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Boolean]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Array]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>æ‹†å°</strong></p><p>å¯ä»¥ä½¿ç”¨ <code>obj.valueof()</code> è·å–å¯¹è±¡å°è£…çš„å€¼</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">'aaa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// aaa</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1, 2, 3]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¼ºåˆ¶ç±»å‹è½¬æ¢">å¼ºåˆ¶ç±»å‹è½¬æ¢</h3><p>JavaScript å¼ºåˆ¶ç±»å‹è½¬æ¢åªæ”¯æŒè½¬åŒ–ä¸ºåŸºæœ¬ç±»å‹å€¼</p><p><strong>æŠ½è±¡å€¼æ“ä½œ</strong></p><p>æŠ½è±¡ç±»å‹å‡½æ•°æ˜¯ç±»å‹ä¸­å†…ç½®çš„ä¸€äº›ä¸ªæ€ªæ–¹æ³•, åœ¨ç±»å‹è½¬æ¢æ—¶ JavaScriptä¼šè°ƒç”¨è¿™äº›å‡½æ•°å®ç°å¯¹åº”ç±»å‹è½¬æ¢</p><ul><li><p><code>ToString</code> è½¬æ¢ä¸º <code>String</code></p><ul><li><p>æ™®é€šå¯¹è±¡: å¯¹è±¡çš„ <code>toString</code> é»˜è®¤è¿”å›å¯¹è±¡çš„<code>[[class]]</code> å€¼</p></li><li><p>æ•°ç»„: <code>Array</code> çš„ <code>toString</code> è¢«é‡æ–°å®šä¹‰è¿‡,ç­‰ä»·äº <code>return this.join(',')</code>, æ³¨æ„: æ²¡æœ‰<code>[]</code></p></li><li><p>JSONå¯¹è±¡:</p><ul><li><p><code>JSON.stringify</code></p><p><code>JSON.stringify(value[, replacer [, space]])</code>æœ‰ä¸¤ä¸ªå¯é€‰å‚æ•°</p><ul><li><p><code>replacer</code> è‹¥æ˜¯å‡½æ•°, æ¯ä¸ªå±æ€§éƒ½ä¼šç»è¿‡è¯¥å‡½æ•°çš„è½¬æ¢,è‹¥æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ™åªæœ‰åŒ…å«åœ¨è¿™ä¸ªæ•°ç»„ä¸­çš„å±æ€§åæ‰ä¼šè¢«è½¬æ¢, è‹¥æ˜¯<code>null</code> æˆ–è€…æœªæä¾›ï¼Œåˆ™å¯¹è±¡æ‰€æœ‰çš„å±æ€§éƒ½ä¼šè¢«åºåˆ—åŒ–.</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> unSafe <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">'2'</span><span class="token punctuation">,</span>  <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// &#123;"a":1,"c":[1,3,null]&#125;</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>unSafe<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>k <span class="token operator">===</span> <span class="token string">'b'</span> <span class="token operator">||</span> k <span class="token operator">===</span> <span class="token string">'2'</span> <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>space</code>: è‹¥ä¸ºæ•°å­—åˆ™ä¸ºæ¯çº§ç¼©è¿›æŒ‡å®šå­—ç¬¦, è‹¥ä¸ºå­—ç¬¦ä¸²,åˆ™å°†å­—ç¬¦ä¸²å‰<strong>å</strong>ä½ä½œä¸ºç¼©è¿›å­—ç¬¦ä¸²</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &#123;</span><span class="token comment">//   "a": 1,</span><span class="token comment">//   "c": [</span><span class="token comment">//     1,</span><span class="token comment">//     3,</span><span class="token comment">//     4</span><span class="token comment">//   ]</span><span class="token comment">// &#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'123'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &#123;</span><span class="token comment">// 123"a": 1,</span><span class="token comment">// 123"c": [</span><span class="token comment">// 1231231,</span><span class="token comment">// 1231233,</span><span class="token comment">// 1231234</span><span class="token comment">// 123]</span><span class="token comment">// &#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'1234567890-='</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &#123;</span><span class="token comment">// 1234567890"a": 1,</span><span class="token comment">// 1234567890"c": [</span><span class="token comment">// 123456789012345678901,</span><span class="token comment">// 123456789012345678903,</span><span class="token comment">// 123456789012345678904</span><span class="token comment">// 1234567890]</span><span class="token comment">// &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p><code>toJSON</code></p><p>åœ¨ <code>stringify</code> æ—¶, è‹¥å¯¹è±¡ä¸­å­˜åœ¨é JSONå®‰å…¨å€¼(<code>undefined / function / symbol / å¾ªç¯å¼•ç”¨</code>)ä¼šå¿½ç•¥æˆ–æŠ¥é”™,è‹¥å¿½ç•¥å€¼åœ¨æ•°ç»„ä¸­åˆ™ä¼šé‡‡ç”¨ <code>null</code> ä»£æ›¿</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token literal-property property">norm</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token comment">// æ­£å¸¸</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token comment">// è·³è¿‡</span>  <span class="token function-variable function">b</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// è·³è¿‡</span>    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'12'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// è·³è¿‡</span>  <span class="token literal-property property">d</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// æ­£å¸¸</span>    <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token comment">// null</span>    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">//null</span>    <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// null</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token literal-property property">e</span><span class="token operator">:</span> t<span class="token punctuation">,</span> <span class="token comment">// æŠ¥é”™</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ºäº†è®©è°ƒç”¨è€…å¯ä»¥è‡ªå®šä¹‰é JSON å®‰å…¨å€¼çš„è½¬æ¢è¡Œä¸º,<code>JSON.stringify</code> å®é™…è¿›è¡Œäº†å‡ ä¸ªè¿‡ç¨‹,å…ˆæ‰§è¡Œ<code>replacer</code>, å†æ‰§è¡Œå¯¹è±¡çš„ <code>toJSON</code> æ–¹æ³•,å†å¯¹è¿”å›å€¼çš„ <code>toString</code></p><p>å¯¹è±¡çš„ <code>toJSON</code> æ–¹æ³•åº”è¯¥è¿”å›ä¸€ä¸ª JSON å®‰å…¨çš„å¯¹è±¡æ–¹ä¾¿<code>toString</code> è°ƒç”¨. è¯¥å‡½æ•°åªä¼šè°ƒç”¨ä¸€æ¬¡, å¹¶ä¸”æ²¡æœ‰å‚æ•°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> unSafe <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>  <span class="token function-variable function">b</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">'UNDEFINED'</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">'FUNCTION'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>unSafe<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123;"a":"UNDEFINED","b":"FUNCTION","c":1&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul></li><li><p><code>toNumber</code> è½¬æ¢ä¸º <code>Number</code></p><ul><li><p>ç‰¹æ®Šçš„:<code>true =&gt; 1, false =&gt; 0, undefined =&gt; NaN, null =&gt; 0</code></p></li><li><p>å­—ç¬¦ä¸²</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">'12'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 12, 10è¿›åˆ¶</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">'012'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 12, å¿½ç•¥8è¿›åˆ¶</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">'0x12'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 18, æ¥å—16è¿›åˆ¶</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">'0b111'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 7, æ¥å—2è¿›åˆ¶</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">'0b121'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// NaN, å‡ºç°éæ³•å­—ç¬¦è¿”å›NaN</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">'1a2b3c4'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// NaN, å‡ºç°éæ³•å­—ç¬¦è¿”å›NaN</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¯¹è±¡ / æ•°ç»„ / åŸºæœ¬ç±»å‹å°è£…å¯¹è±¡:</p><ul><li>å¯¹äºåŸºæœ¬ç±»å‹å°è£…çš„å¯¹è±¡, ç›´æ¥æå–åŸºæœ¬ç±»å‹.è‹¥è½¬æ¢åéæ•°å€¼åˆ™åœ¨è½¬æ¢ä¸ºæ•°å­—.</li><li>å¯¹äºå…¶ä»–å¯¹è±¡, è‹¥å¯¹è±¡å®šä¹‰äº† <code>valueOf</code> å‡½æ•°åˆ™ä½¿ç”¨<code>valueOf</code> å‡½æ•°è½¬æ¢, å¦åˆ™ä½¿ç”¨ <code>toString</code> è½¬æ¢.è‹¥è½¬æ¢åéæ•°å€¼åˆ™åœ¨è½¬æ¢ä¸ºæ•°å­—.</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token function-variable function">valueOf</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token string">"42"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token function-variable function">toString</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token string">"42"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>c<span class="token punctuation">.</span><span class="token function-variable function">toString</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span> <span class="token string">""</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// "42"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token function">Number</span><span class="token punctuation">(</span> a <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 42</span><span class="token function">Number</span><span class="token punctuation">(</span> b <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 42</span><span class="token function">Number</span><span class="token punctuation">(</span> c <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 42</span><span class="token function">Number</span><span class="token punctuation">(</span> <span class="token string">""</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0</span><span class="token function">Number</span><span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0</span><span class="token function">Number</span><span class="token punctuation">(</span> <span class="token punctuation">[</span> <span class="token string">"abc"</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// NaN</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p><code>toBoolean</code> è½¬æ¢ä¸º <code>Boolean</code></p><p>è§„å®šå‡å€¼: <code>undefined</code>, <code>null</code>,<code>false</code>, <code>+0 / -0 / NaN</code>, <code>''</code>,å…¶ä»–éƒ½æ˜¯çœŸå€¼ éƒ¨åˆ†è¢«åºŸå¼ƒ / éæ ‡å‡†çš„ JavaScript ä¹Ÿä¼šè¢«æ ‡è®°ä¸º<code>false</code> (ä¾‹å¦‚ <code>document.all</code> å·²ç»è¢«åºŸå¼ƒ,åœ¨è€ç‰ˆæµè§ˆå™¨ä¸­ä¾ç„¶å­˜åœ¨ <code>!!document.all === true</code>,åœ¨æ–°ç‰ˆæµè§ˆå™¨ä¸­ä¸º <code>!!document.all === true</code>,è¿™å¯ä»¥ç”¨äºæµè§ˆå™¨ç‰ˆæœ¬åˆ¤å®š)</p></li></ul><p><strong>å¼ºåˆ¶ç±»å‹è½¬æ¢</strong></p><ul><li><p><code>String &amp; Number</code></p><ul><li><p><code>+var</code> å¯ä»¥å®ç° <code>String</code> åˆ°<code>Number</code></p></li><li><p><code>~~var</code> å¯ä»¥å®ç°å°†å€¼æŒ‰ä½åè½¬å†ç¿»å›æ¥ä»è€Œå®ç°å°æ•°è½¬ 32ä½æ•´æ•°.</p><p>ä¸ <code>floor / cell</code> ä¸åŒ, ä¸Šè¿°å‡½æ•°ä¼šåšå‘ä¸Šæˆ–ä¸‹å–æ•´, ä½†æ˜¯<code>~~</code> ä¼šç›´æ¥å»å°¾</p><p>åŒæ—¶ <code>~</code> ç›¸å½“äºå–åç , <code>-1</code> çš„åç ä¸º<code>0</code>. è€Œ <code>-1</code> ç»å¸¸è¢«ç”¨ä½œé”™è¯¯æ ‡è®°(å¦‚<code>indexof</code>). æ‰€ä»¥, æ‰€ä»¥ç»å¸¸ç”¨äºåˆ¤æ–­å€¼æ˜¯å¦ä¸º<code>-1</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token string">'asdfghjkl'</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">~</span>s<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'f'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'find it'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">else</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'not find  f'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p><code>Number &amp; parseInt</code>: <code>Number</code>æ„é€ å‡½æ•°å¯ä»¥è¯»å…¥çº¯æ•°å­—çš„å­—ç¬¦ä¸²å¹¶è¿”å› <code>Number</code> åŒ…è£…å¯¹è±¡. è€Œ<code>parseInt</code> è¯»å…¥å­—ç¬¦ä¸²å¹¶è§£ææ•°å­—ç›´åˆ°é‡åˆ°éæ•°å­—åœæ­¢.</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token string">'42'</span><span class="token punctuation">;</span><span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token string">'42px'</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// NaN</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœä¸æŒ‡å®šè¿›åˆ¶, <code>parseInt</code> çš„è¡Œä¸ºä¹Ÿä¸ä¸€æ ·</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'0x10'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 16 è‡ªåŠ¨è¯†åˆ« 16 è¿›åˆ¶</span>Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'0b10'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0 è‡ªåŠ¨è¯†åˆ« 2 è¿›åˆ¶</span>Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'010'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10 ä¸è¯†åˆ« 8 è¿›åˆ¶</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>åŒæ—¶, ä¸¤å‡½æ•°åœ¨é‡åˆ°éå­—ç¬¦ä¸²è¾“å…¥æ—¶ä¼šå…ˆè½¬æ¢ä¸º <code>String</code>åœ¨è½¬æ¢</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function-variable function">toString</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'42px'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function-variable function">toString</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'42'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// NaN</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>obj1<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>obj2<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ç§è½¬æ¢ä¼šå¸¦æ¥ä¸€äº›"åŠéšå¼"çš„è½¬æ¢é—®é¢˜</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 18 ( Infinity ä¼šè¢«è½¬æ¢ä¸º 'Infinity', 'I' åœ¨ 19 è¿›åˆ¶ä¸­æ˜¯ 18)</span>Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token number">0.000008</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0 (è¿™ä¸ªæ•°ä¼šè¢«è½¬æ¢ä¸º '0.000008')</span>Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token number">0.0000008</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 8 (è¿™ä¸ªæ•°ä¼šè¢«è½¬æ¢ä¸º '8e-7')</span>Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 250 (ä¼šè¢«è½¬æ¢ä¸º 'false', 'fa' éƒ½æ˜¯ 16 è¿›åˆ¶æ•°)</span>Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>parseInt<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 15  (ä¼šè¢«è½¬æ¢ä¸º 'function..', 'f' æ˜¯ 16 è¿›åˆ¶æ•° )</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>+</code> äºŒå…ƒåŠ æ³•é€ æˆçš„ç±»å‹è½¬æ¢:è‹¥åŠ æ³•ä¸¤è¾¹æœ‰å­—ç¬¦ä¸²å°±å°†ä¸¤è¾¹è½¬æ¢ä¸ºå­—ç¬¦ä¸²(ä¸ç›´æ¥è½¬å­—ç¬¦ä¸²ä¸åŒ, æµç¨‹æ˜¯å…ˆ<code>toValue</code> å† <code>toString</code> )æ‰§è¡Œå­—ç¬¦ä¸²æ‹¼æ¥,å¦åˆ™å…ˆè½¬æ¢ä¸º <code>Number</code> å†æ‰§è¡Œæ•°å€¼ç›¸åŠ .</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function-variable function">valueOf</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token function-variable function">toString</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'42'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42: ç›´æ¥ toString = '42'</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4: å…ˆ valueOf = 4 ç„¶å toString = '4'</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5: valueOf = 4, 4 + 1 = 5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>true =&gt; 1, false =&gt; 0</code></p></li></ul></li><li><p><code>Boolean</code></p><ul><li><p><code>!!</code> å¯ä»¥ç”¨äºè½¬æ¢ç±»å‹ä¸º <code>Boolean</code></p></li><li><p><code>if / for / while / do...while / ?:</code> è¡¨è¾¾å¼ä¼šè‡ªåŠ¨è½¬æ¢<code>Boolean</code></p></li><li><p><code>|| / &amp;&amp;</code>çš„<strong>å·¦</strong>æ“ä½œæ•°åœ¨ä½œæ¡ä»¶åˆ¤æ–­æ—¶ä¼šè‡ªåŠ¨è½¬æ¢.è¿™ä¸¤ä¸ªé€»è¾‘è¿ç®—ç¬¦çš„è¿”å›å€¼å¹¶ä¸ä¸€å®šæ˜¯ <code>Boolean</code>è€Œæ˜¯æ ¹æ®çŸ­è·¯åŸåˆ™ç›´æ¥è¿”å›ç¬¬ä¸€æˆ–ç¬¬äºŒä¸ªå…ƒç´ </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">||</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a è½¬ä¸º false, ç›´æ¥è¿”å› b</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b <span class="token operator">||</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// b è½¬ä¸º true, ç›´æ¥è¿”å› b</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a è½¬ä¸º false, ç›´æ¥è¿”å› a</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// b è½¬ä¸º true, ç›´æ¥è¿”å› a</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><p><strong><code>==</code> ç±»å‹è½¬æ¢</strong></p><p><code>===</code> æ˜¯ä¸è¿›è¡Œç±»å‹è½¬æ¢çš„ç›¸ç­‰, ä¸å¯èƒ½äº§ç”Ÿç±»å‹è½¬æ¢,ç±»å‹è½¬æ¢åªä¼šå‘ç”Ÿåœ¨ <code>==</code></p><ul><li><p>ç‰¹æ®Šæƒ…å†µ: <code>NaN != NaN</code>, <code>-0 == 0</code></p></li><li><p><code>String == Number</code>: å°† <code>string</code> è½¬ä¸º<code>toNumber(string)</code> åæ¯”è¾ƒ</p></li><li><p><code>Boolean == *</code>: å°† <code>boolean</code> è½¬ä¸º<code>toNumber(boolean)</code> åæ¯”è¾ƒ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">"0"</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// false</span><span class="token string">"0"</span> <span class="token operator">==</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span><span class="token comment">// false</span><span class="token string">"0"</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">// true -- å™¢ï¼</span><span class="token string">"0"</span> <span class="token operator">==</span> <span class="token number">NaN</span><span class="token punctuation">;</span><span class="token comment">// false</span><span class="token string">"0"</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">// true</span><span class="token string">"0"</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token comment">// false</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// false</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span><span class="token comment">// false</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token number">NaN</span><span class="token punctuation">;</span><span class="token comment">// false</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">// true -- å™¢ï¼</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token comment">// true -- å™¢ï¼</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// true -- å™¢ï¼</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// false</span><span class="token string">""</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// false</span><span class="token string">""</span> <span class="token operator">==</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span><span class="token comment">// false</span><span class="token string">""</span> <span class="token operator">==</span> <span class="token number">NaN</span><span class="token punctuation">;</span><span class="token comment">// false</span><span class="token string">""</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">// true -- å™¢ï¼</span><span class="token string">""</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// true -- å™¢ï¼</span><span class="token string">""</span> <span class="token operator">==</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// false</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// false</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span><span class="token comment">// false</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token number">NaN</span><span class="token punctuation">;</span><span class="token comment">// false</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// true -- å™¢ï¼</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>undefined == null</code></p></li><li><p>å¯¹è±¡ä¸éå¯¹è±¡: å°†å¯¹è±¡è½¬ä¸ºåŸºæœ¬ç±»å‹å€¼å†æ¯”è¾ƒ. ä»¥ä¸‹æ˜¯æ€ªæƒ…å†µ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token class-name">Number</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">valueOf</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span> <span class="token number">2</span> <span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token class-name">Number</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">valueOf</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> i<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span> <span class="token number">42</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> a <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">"Yep, this happened."</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¥‡è‘©æƒ…å†µ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// true, å³ä¾§ ![] => false, [] => '' => false</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true, '\n' / '' / å„ç§unicodeç©ºæ ¼ => 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">"0"</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">// true -- å™¢ï¼</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">// true -- å™¢ï¼</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token comment">// true -- å™¢ï¼</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// true -- å™¢ï¼</span><span class="token string">""</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">// true -- å™¢ï¼</span><span class="token string">""</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// true -- å™¢ï¼</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// true -- å™¢ï¼</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ€»ä¹‹, <code>==</code> ä¸¤è¾¹ä¸è¦å†™ <code>true / false</code>, é¿å…ä½¿ç”¨<code>[], '', 0</code></p></li><li><p>å„ç§æƒ…å†µæ¯”è¾ƒè¡¨: <ahref="dorey/JavaScript-Equality-Table">dorey/JavaScript-Equality-Table</a></p><p><img src="./ä½ ä¸çŸ¥é“çš„JavaScriptå­¦ä¹ /3-1.png" /></p></li></ul><p><strong>æ¯”è¾ƒç¬¦</strong></p><p>JavaScript åªå®šä¹‰äº† <code>&lt;</code>. <code>a &gt; b</code>ä¼šè¢«è‡ªåŠ¨è½¬ä¸º <code>b &lt; a</code>, <code>a &lt;= b</code> ä¼šè¢«è½¬æ¢ä¸º<code>!(b &lt; a)</code>.</p><p>åœ¨æ¯”è¾ƒæ—¶, åŒæ–¹ä¼šå…ˆè½¬æ¢ä¸ºåŸºæœ¬æ•°å€¼ç±»å‹å†æ¯”è¾ƒ</p><h3 id="è¯­æ³•">è¯­æ³•</h3><p><strong>ç»“æœå€¼</strong></p><p>åœ¨ DevTools ä¸­, åœ¨è¾“å…¥è¯­å¥åå³ä½¿æ²¡æœ‰ <code>Console</code> è¯­å¥,DevTool ä¹Ÿä¼šè¾“å‡ºä¸€ä¸ªç»“æœ, è¿™é‡Œæ˜¾ç¤ºçš„æ˜¯è¯­å¥çš„ç»“æœå€¼.</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">></span> <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">&lt;</span> <span class="token keyword">undefined</span><span class="token operator">></span> a<span class="token operator">&lt;</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨æ­£å¸¸ä»£ç ä¸­, å¦‚æœä¸€ä¸ªè¯­å¥ä¸­åªæœ‰ <code>a</code>, JavaScriptæ˜¯ä¸ä¼šè¾“å‡ºç»“æœçš„, ä½†æ˜¯ DevTool ä¼šè¾“å‡ºè¿™ä¸ªè¯­å¥çš„ç»“æœå€¼</p><ul><li><p>å£°æ˜è¯­å¥ <code>let a = 1</code> æœ‰ç»“æœå€¼, ä½†æ˜¯ä¼šè¢«JavaScriptå¼•æ“å±è”½, æœ€ç»ˆæ˜¾ç¤º <code>undefined</code></p></li><li><p>èµ‹å€¼è¯­å¥ <code>a = b</code> çš„ç»“æœå€¼ä¸ºèµ‹çš„å€¼(ä½†æ˜¯ä¸æ˜¯<code>a</code> ! åªæ˜¯ <code>a</code> å¯¹åº”çš„å³å€¼!)</p><p>ç”±äºèµ‹å€¼è¯­å¥çš„ç»“æœå€¼æ˜¯èµ‹çš„å³å€¼, å¯ä»¥å€ŸåŠ©è¿™ä¸ªç‰¹æ€§å®ç°é“¾å¼èµ‹å€¼</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">a <span class="token operator">=</span> b <span class="token operator">=</span> c <span class="token operator">=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å€¼å¾—æ³¨æ„çš„æ˜¯, å£°æ˜è¯­å¥çš„ç»“æœå€¼è¢«å±è”½ä¸ºäº† <code>undefined</code>.æ‰€ä»¥, ä¸èƒ½é“¾å¼å£°æ˜</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> a <span class="token operator">=</span> b <span class="token operator">=</span> c <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">// ğŸ‘ é™é»˜å¤±æ•ˆ</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>ä»£ç å— <code>&#123;&#125;</code> çš„ç»“æœå€¼æ˜¯ä»£ç å—çš„æœ€åä¸€ä¸ªè¯­å¥ /è¡¨è¾¾å¼</p></li></ul><p>åœ¨ç¼–ç¨‹ä¸­, å¯ä»¥ä½¿ç”¨ <code>eval</code> è·å–ç»“æœå€¼(ä½†æ˜¯ä¸å»ºè®®),æœªæ¥å¯èƒ½å¯ä»¥é€šè¿‡ <code>do</code> è·å–ç»“æœå€¼</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    b <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¡¨è¾¾å¼çš„ç»“æœæ˜¯å³å€¼</strong></p><p>è¡¨è¾¾å¼çš„ç»“æœå€¼æ˜¯å³å€¼, è¿™å°±æ„å‘³ç€è¿™æ ·çš„å†™æ³•æ˜¯éæ³•çš„</p><ul><li><code>++a++</code>: ç›¸å½“äº <code>++(a++)</code>, è€Œ <code>a++</code>è¿”å›çš„æ˜¯å³å€¼, æ— æ³•å¯¹å³å€¼åš <code>++</code></li><li><code>(a || b) = 1</code>: <code>||</code> æ˜¯é€‰æ‹©ç¬¦å·,çœ‹èµ·æ¥çš„æ„æ€æ˜¯è‹¥ <code>a</code> æ˜¯å‡å€¼åˆ™æ‰§è¡Œ <code>b = 1</code> å¦åˆ™<code>a=1</code>. ä½†æ˜¯ <code>(a || b)</code> è¿”å›çš„æ˜¯å³å€¼</li></ul><p><strong>å¤šé‡è¯­æ³•</strong></p><ul><li><p><code>&#123;&#125;</code>: å¯ä»¥æ˜¯å¯¹è±¡ä¹Ÿå¯ä»¥æ˜¯ä»£ç å¿«, è¿™å°±å¯¼è‡´äº†</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// ç»“æœå€¼: "[Obejct Obejct]" (&#123;&#125; å‰æœ‰ +, æ‰€ä»¥&#123;&#125;æ˜¯ä¸€ä¸ªå¯¹è±¡)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// ç»“æœå€¼: 0 (&#123;&#125;å‰å•¥ä¹Ÿæ²¡æœ‰, æ‰€ä»¥æ˜¯ä¸ªä»£ç å—, å…¶ç­‰ä»·äº +[], æ ¼å¼è½¬æ¢ä¸º 0)</span>a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// a == "[Obejct Obejct]" (&#123;&#125; å‰æœ‰ +, æ‰€ä»¥&#123;&#125;æ˜¯ä¸€ä¸ªå¯¹è±¡)</span>b <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// b == [Obejct Obejct]" (&#123;&#125; å‰æœ‰ =, æ‰€ä»¥&#123;&#125;æ˜¯ä¸€ä¸ªå¯¹è±¡)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åŒæ—¶, ä»£ç å—å†…å±æ€§çš„å«ä¹‰ä¹Ÿå˜äº†</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// æ­¤æ—¶æ˜¯ä¸€ä¸ªå¯¹è±¡</span>a <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token comment">// å¯¹è±¡ä¸­çš„ä¸€ä¸ªå±æ€§</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// æ­¤æ—¶æ˜¯ä¸€ä¸ªç®€å•çš„ä»£ç å—</span><span class="token punctuation">&#123;</span>  <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token comment">// ä»£ç å¿«ä¸­çš„æ ‡ç­¾</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ ‡ç­¾(<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvU3RhdGVtZW50cy9sYWJlbA==">MDN<i class="fa fa-external-link-alt"></i></span>)ç±»ä¼¼äºC è¯­è¨€ä¸­ <code>goto</code> çš„ label, ä¸ä¹‹ä¸åŒçš„æ˜¯ JavaScript ä¸­æ²¡æœ‰<code>goto</code>, åªèƒ½é€šè¿‡ <code>continue / break</code> è·³è½¬,åŒæ—¶ä¸èƒ½å¯¹éå¾ªç¯çš„å—ä»£ç æ‰§è¡Œ <code>continue</code></p><p>åŒæ—¶æ³¨æ„, æ ‡ç­¾åå‰åä¸èƒ½æœ‰åŒå¼•å·, å³</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">&#123;  &quot;foo&quot;: 1&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ˜¯ä¸åˆæ³•çš„(éœ‡æƒŠ JavaScript ç«Ÿç„¶ä¸å®Œç¾å…¼å®¹ JSON!)</p></li></ul><p><strong>ä¼˜å…ˆçº§ä¸ç»“åˆæ€§</strong></p><ul><li>ä¼˜å…ˆçº§: <code>! &gt; &amp;&amp; &gt; || ?:</code> (<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvT3BlcmF0b3JzL09wZXJhdG9yX1ByZWNlZGVuY2UjJUU2JUIxJTg3JUU2JTgwJUJCJUU4JUExJUE4">è¯¦è§MDN<i class="fa fa-external-link-alt"></i></span>)</li><li>ç»“åˆæ€§: <code>?:</code> æ˜¯å³ç»“åˆçš„ (<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvT3BlcmF0b3JzL09wZXJhdG9yX1ByZWNlZGVuY2UjJUU2JUIxJTg3JUU2JTgwJUJCJUU4JUExJUE4">è¯¦è§MDN<i class="fa fa-external-link-alt"></i></span>)</li></ul><p><strong>è‡ªåŠ¨åˆ†å·(ASI)</strong></p><p>JavaScript ä¼šè‡ªåŠ¨åœ¨è¡Œæœ«åŠ  <code>;</code>,è¿™å¯ä»¥é˜²æ­¢å¾ˆå¤šä¸ç»æ„é—´é€ æˆçš„é—®é¢˜</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">do</span><span class="token punctuation">&#123;</span>    <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™é‡Œåœ¨è¯­æ³•ä¸­å¿…é¡»åŠ  ; å¾—ç›Šäº ASI, ç¨‹åºå‘˜å¯ä»¥ä¸ç”¨åŠ </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>æš‚æ—¶æ€§æ­»åŒº</strong></p><p>å°±æ˜¯åœ¨å˜é‡å£°æ˜å‰ä½¿ç”¨å˜é‡(é’ˆå¯¹ <code>let</code>, <code>var</code>æœ‰å£°æ˜æå‡ä¸ä¼šå‡ºäº‹). æå‰ä½¿ç”¨ä¼šé€ æˆ <code>Reference Error</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// å•¥äº‹æ²¡æœ‰</span>b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span><span class="token keyword">let</span> b<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿˜æœ‰ä¸ªå°ä¾‹å¤–</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined, æ²¡æœ‰æŠ¥é”™!</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span><span class="token keyword">let</span> b<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>å‡½æ•°å‚æ•°</strong></p><p>åœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹å‡½æ•°å‚æ•°åˆ—è¡¨ä¸­æ ‡è¯†ç¬¦ä¼šä¸ <code>arguments</code>å˜é‡å»ºç«‹"è¿æ¥"å…³ç³»</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>  b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åªä¿®æ”¹äº† a , ä½†æ˜¯ arguments[0] è¿æ¥åˆ°äº† a, æ‰€ä»¥ä¾ç„¶è¢«ä¿®æ”¹äº†...</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2,2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ— éœ€è€ƒè™‘å‡½æ•°é»˜è®¤å€¼é—®é¢˜, å¯ç”¨é»˜è®¤å€¼ä¼šè‡ªåŠ¨å¯ç”¨å‡½æ•°ä¸¥æ ¼æ¨¡å¼</p><p><strong>try...finally</strong></p><p><code>finally</code>å—åŒ…å«çš„è¯­å¥åœ¨<code>try</code>å—å’Œ<code>catch</code>ä¹‹å,æ— è®º <code>try</code> æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ <code>finally</code> å­å¥éƒ½ä¼šæ‰§è¡Œ.è¿™é‡Œçš„ <code>finally</code> å°±åƒä¸€ä¸ªå›è°ƒä¸€æ ·, æ‰§è¡Œé¡ºåºä¸º<code>try -&gt; (catch) -&gt; finally -&gt; å‡½æ•°çš„æ­£å¸¸åŠŸèƒ½</code></p><ul><li><p>å½“ <code>try</code> ä¸­å‡ºç° <code>return</code> æ—¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è™½ç„¶ try return äº†, ä½†æ˜¯ç”±äº finally çš„å­˜åœ¨, return ä¼šè¢«"æš‚å­˜" åˆ°finall ç»“æŸ</span>  <span class="token punctuation">&#125;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å½“ <code>try / catch &amp; finally</code> ä¸­å‡ºç°<code>return</code> æ—¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// finally çš„ return ä¼šè¦†ç›– try çš„</span>  <span class="token punctuation">&#125;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// console => 0, 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">throw</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// finally çš„ return ä¼šè¦†ç›– catch çš„</span>  <span class="token punctuation">&#125;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// console => 0, 1, 2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>è¯¥è§„åˆ™åŒæ ·é€‚ç”¨äº <code>continue</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">continue</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 0, 1, 2, 3, 4, 5(æ²¡æœ‰*)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æœ€è¿·æƒ‘çš„æ˜¯ä¸ <code>break</code> ä¸€èµ·ä½¿ç”¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">lab</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">break</span> lab<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>switch</strong></p><ul><li><p>æœ€ç®€å½¢å¼: <code>case</code> æ¥ä¸€ä¸ªå€¼, JavaScript ä¼šå°†<code>a</code> ä¸ case å€¼åš <code>===</code> æ¯”è¾ƒ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">a <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token keyword">switch</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token comment">// a == 1 æˆç«‹, ä½†æ˜¯ a === 1 ä¸æˆç«‹</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">break</span><span class="token punctuation">;</span>  <span class="token keyword">case</span> <span class="token boolean">true</span><span class="token operator">:</span> <span class="token comment">// èµ°è¿™é‡Œäº†</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¦‚æœåƒåšä¸€äº›ç±»å‹è½¬æ¢, å¯ä»¥å°† <code>switch</code> çš„å€¼æ¢æˆ<code>true</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">a <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">case</span> a <span class="token operator">==</span> <span class="token number">1</span><span class="token operator">:</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// èµ°è¿™é‡Œäº†</span>    <span class="token keyword">break</span><span class="token punctuation">;</span>  <span class="token keyword">case</span> a <span class="token operator">==</span> <span class="token boolean">true</span><span class="token operator">:</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¦‚æœè¦ç”¨ <code>switch (true)</code> çš„å†™æ³•çš„è¯, éœ€è¦ä¿è¯è®¡ç®—<code>case</code> çš„è®¡ç®—ç»“æœä¸€å®šæ˜¯ <code>true</code> è€Œä¸æ˜¯å¯ä»¥è½¬æ¢ä¸º<code>true</code>, <code>switch</code> åšçš„æ˜¯ <code>===</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">a <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>s <span class="token operator">=</span> <span class="token string">'demo'</span><span class="token punctuation">;</span><span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">case</span> a <span class="token operator">&amp;&amp;</span> s<span class="token operator">:</span> <span class="token comment">// &amp;&amp; è¿”å› b è€Œ b !== true</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">break</span><span class="token punctuation">;</span>  <span class="token keyword">default</span><span class="token operator">:</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// èµ°è¿™é‡Œäº†</span>    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="å¼‚æ­¥">å¼‚æ­¥</h2><h3 id="å¼‚æ­¥-1">å¼‚æ­¥</h3><p><strong>æ§åˆ¶å°å¼‚æ­¥</strong></p><p>å®é™…ä¸Š <code>console.*</code> ç³»åˆ—å‡½æ•°å¹¶ä¸æ˜¯ ES æ ‡å‡†è¯­æ³•,å…¶æ˜¯ç”±å®¿ä¸»ç¯å¢ƒå†³å®šçš„. è€Œå®¿ä¸»ç¯å¢ƒç»å¸¸ä¼šä¸ºé™ä½ I/O å¼€é”€è€Œå»¶è¿Ÿè¾“å‡º, è¿™ç§I/O å¼‚æ­¥çš„ç­–ç•¥ä¼šé€ æˆè¾“å‡º"å‡ºé”™"</p><p><strong>ç¨‹åºæ‰§è¡Œæ—¶æœº</strong></p><p>JavaScript ä¸­çš„ä»£ç æ˜¯åˆ†å—çš„(å¦‚ä¸€ä¸ªä¸ªå‡½æ•°),æˆ‘ä»¬å¸Œæœ›å¯ä»¥å¹²é¢„å‡½æ•°æ‰§è¡Œçš„é¡ºåºä¸æ—¶æœº(å¦‚ Ajax è¯·æ±‚æˆåŠŸåå†æ‰§è¡ŒæŸä¸ªå‡½æ•°,å…ˆæ‰§è¡Œåˆ«çš„å‡½æ•°ç­‰ä¸€ä¼šå„¿å†æ‰§è¡ŒæŸä¸ªå‡½æ•°), æœ‰ä¸¤ç§å¸¸è§æ–¹æ³•</p><ul><li>å›è°ƒå‡½æ•°</li><li><code>setTimeout</code> ç­‰å¼‚æ­¥API</li></ul><p><strong>è°ƒç”¨æ ˆ, äº‹ä»¶å¾ªç¯ä¸ä»»åŠ¡é˜Ÿåˆ—</strong></p><p>JavaScript æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„å¼‚æ­¥ç¼–ç¨‹è¯­è¨€,è®©ä¸€ä¸ªå•çº¿ç¨‹çš„è¯­è¨€å®ç°å¤šä»»åŠ¡å¼‚æ­¥æ˜¯æœ‰ç‚¹éº»çƒ¦çš„. JavaScriptæäº†äº‹ä»¶å¾ªç¯æœºåˆ¶, åŒ…æ‹¬äº†è°ƒç”¨æ ˆ, ä»»åŠ¡é˜Ÿåˆ—, äº‹ä»¶å¾ªç¯</p><ul><li><p>è°ƒç”¨æ ˆ(Call Stack): å­˜æ¡£ä»£ç æ‰§è¡Œæ—¶çš„ ConText(å¦‚å‡½æ•°åµŒå¥—)</p></li><li><p>äº‹ä»¶å¾ªç¯: æ¯å½“è°ƒç”¨æ ˆæ¸…ç©º(å½“å‰å·¥ä½œç»“æŸ)æ—¶,äº‹ä»¶å¾ªç¯ä¼šå‘ä»»åŠ¡é˜Ÿåˆ—é¦–éƒ¨å–ä»»åŠ¡, æ”¾è°ƒç”¨æ ˆæ‰§è¡Œ</p></li><li><p>ä»»åŠ¡é˜Ÿåˆ—: å½“æœ‰å¼‚æ­¥ä»»åŠ¡éœ€è¦æ‰§è¡Œ(å¦‚:å®šæ—¶å™¨<strong>åˆ°æœŸ</strong>)æ—¶, JavaScript ä¼šå‘ä»»åŠ¡é˜Ÿåˆ—ä¸­å‹å…¥ä»»åŠ¡.ä»»åŠ¡é˜Ÿåˆ—åˆåˆ†å®é˜Ÿåˆ—ä¸å¾®é˜Ÿåˆ—, ä¸åŒçš„ä»»åŠ¡ä¼šæ”¾å…¥ä¸åŒçš„é˜Ÿåˆ—</p><p>å®é˜Ÿåˆ—</p><table><colgroup><col style="width: 83%" /><col style="width: 9%" /><col style="width: 6%" /></colgroup><thead><tr class="header"><th></th><th>æµè§ˆå™¨</th><th>Node</th></tr></thead><tbody><tr class="odd"><td>æ•´ä½“ä»£ç (script)</td><td>âœ…</td><td>âœ…</td></tr><tr class="even"><td>UIäº¤äº’äº‹ä»¶</td><td>âœ…</td><td>âŒ</td></tr><tr class="odd"><td>I/O</td><td>âœ…</td><td>âœ…</td></tr><tr class="even"><td>setTimeout<br />(setTimeout(,0)æ˜¯å¸¸ç”¨çš„æ”¾é˜Ÿå°¾çš„æ–¹æ³•)</td><td>âœ…</td><td>âœ…</td></tr><tr class="odd"><td>setInterval</td><td>âœ…</td><td>âœ…</td></tr><tr class="even"><td>setImmediate</td><td>âŒ</td><td>âœ…</td></tr><tr class="odd"><td>requestAnimationFrame</td><td>âœ…</td><td>âŒ</td></tr></tbody></table><p>å¾®é˜Ÿåˆ—</p><table><thead><tr class="header"><th></th><th>æµè§ˆå™¨</th><th>Node</th></tr></thead><tbody><tr class="odd"><td>process.nextTick</td><td>âŒ</td><td>âœ…</td></tr><tr class="even"><td>MutationObserver</td><td>âœ…</td><td>âŒ</td></tr><tr class="odd"><td>Promise.then catch finally</td><td>âœ…</td><td>âœ…</td></tr></tbody></table></li></ul><p>æ€»æµç¨‹å¦‚ä¸‹</p><ol type="1"><li>ä»å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼ŒæŒ‰ç…§<strong>å…¥é˜Ÿé¡ºåº</strong>ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ‰§è¡Œçš„å®ä»»åŠ¡ï¼Œæ”¾å…¥è°ƒç”¨æ ˆï¼Œå¼€å§‹æ‰§è¡Œï¼›</li><li>æ‰§è¡Œå®Œ<strong>è¯¥å®ä»»åŠ¡</strong>ä¸‹æ‰€æœ‰åŒæ­¥ä»»åŠ¡åï¼Œå³è°ƒç”¨æ ˆæ¸…ç©ºåï¼Œè¯¥å®ä»»åŠ¡è¢«æ¨å‡ºå®ä»»åŠ¡é˜Ÿåˆ—ï¼Œç„¶åå¾®ä»»åŠ¡é˜Ÿåˆ—å¼€å§‹æŒ‰ç…§å…¥é˜Ÿé¡ºåºï¼Œä¾æ¬¡æ‰§è¡Œå…¶ä¸­çš„å¾®ä»»åŠ¡ï¼Œ<strong>ç›´è‡³å¾®ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©ºä¸ºæ­¢</strong>ï¼›</li><li>å½“å¾®ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©ºåï¼Œä¸€ä¸ªäº‹ä»¶å¾ªç¯ç»“æŸï¼›</li><li>æ¥ç€ä»å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œæ‰¾åˆ°ä¸‹ä¸€ä¸ªæ‰§è¡Œçš„å®ä»»åŠ¡ï¼Œå¼€å§‹ç¬¬äºŒä¸ªäº‹ä»¶å¾ªç¯ï¼Œç›´è‡³å®ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©ºä¸ºæ­¢ã€‚</li></ol><p>è¿™é‡Œæœ‰å‡ ä¸ªé‡ç‚¹ï¼š</p><ul><li>å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œè§£é‡Šå™¨ä¼šå°†æ•´ä½“ä»£ç <code>script</code>æ”¾å…¥å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå› æ­¤äº‹ä»¶å¾ªç¯æ˜¯ä»ç¬¬ä¸€ä¸ªå®ä»»åŠ¡å¼€å§‹çš„ï¼›</li><li>å¦‚æœåœ¨æ‰§è¡Œå¾®ä»»åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œäº§ç”Ÿæ–°çš„å¾®ä»»åŠ¡æ·»åŠ åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œä¹Ÿéœ€è¦ä¸€èµ·æ¸…ç©ºï¼›å¾®ä»»åŠ¡é˜Ÿåˆ—æ²¡æ¸…ç©ºä¹‹å‰ï¼Œæ˜¯ä¸ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡çš„ã€‚</li></ul><p><strong>å¼‚æ­¥å¹¶è¡Œ</strong></p><p>å¼‚æ­¥ä¸å¹¶è¡Œä¸ä¸€æ ·, å¼‚æ­¥æ˜¯å…è®¸æŒ‡å®šä»£ç å—çš„è¿è¡Œæ—¶æœº,å¹¶è¡Œæ˜¯å¤šä¸ªä»£ç å—åŒæ—¶è¿è¡Œ. æ›´åŠ å½¢è±¡çš„è¯´, å¼‚æ­¥å°±æ˜¯ç»´æŠ¤ä¸€ä¸ªäº‹ä»¶å¾ªç¯,å¹¶è¡Œå°±æ˜¯ç»´æŠ¤ä¸€å †äº‹ä»¶å¾ªç¯.</p><p>å¼‚æ­¥ä¸å¹¶è¡Œéƒ½ä¼šå¸¦æ¥ä¸ç¡®å®šæ€§,å¼‚æ­¥çš„ä¸ç¡®å®šæ€§æ˜¯ä¸çŸ¥é“ä»»åŠ¡ä¼šåœ¨ä»€ä¹ˆæ—¶å€™è¢«å¡åˆ°é˜Ÿåˆ—å°¾éƒ¨,è€Œå¹¶è¡Œçš„ä¸ç¡®å®šæ€§æ˜¯ä¸ç¡®å®šæŒ‡ä»¤ä¹‹é—´çš„æ‰§è¡Œé¡ºåº</p><p>æ‰€å¹¸, JavaScript æ˜¯å•çº¿ç¨‹çš„å¼‚æ­¥è¯­è¨€, è¿™æ„å‘³ç€ JavaScriptè°ƒåº¦æœ€å°å•ä½æ˜¯å•ä¸ªä»»åŠ¡(å‡½æ•°è¦ä¹ˆå…¨è¿è¡Œè¦ä¹ˆä¸è¿è¡Œ,æˆ‘ä»¬å°†å…¶æˆä¸º<strong>å®Œæ•´è¿è¡Œ</strong>), ä¸ä¼šå‡ºç°æŠ¢å å¼è°ƒåº¦</p><p><strong>å¹¶å‘</strong></p><p>å°†å¸¸è§çš„å¹¶å‘æ¨¡å¼åˆ†ä¸ºä¸‰ç§</p><ul><li><p>éäº’åŠ¨å¼: è¿›ç¨‹é—´ä¸å…±äº«å†…å­˜</p></li><li><p>äº’åŠ¨å¼: è¿›ç¨‹é—´å…±äº«å†…å­˜</p><p>è¿™ä¼šå¯¼è‡´ç”±äºæœªçŸ¥æ‰§è¡Œé¡ºåºé€ æˆçš„èµ„æºç«äº‰</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span> data <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// ajax(..) æ˜¯æŸä¸ªåŒ…ä¸­ä»»æ„çš„Ajaxå‡½æ•°</span><span class="token function">ajax</span><span class="token punctuation">(</span> <span class="token string">"http://some.url.1"</span><span class="token punctuation">,</span> response <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ajax</span><span class="token punctuation">(</span> <span class="token string">"http://some.url.2"</span><span class="token punctuation">,</span> response <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸€èˆ¬è§£å†³æ–¹æ¡ˆæœ‰</p><ul><li><p>ç¼–å·</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>url <span class="token operator">==</span> <span class="token string">"http://some.url.1"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>url <span class="token operator">==</span> <span class="token string">"http://some.url.2"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// ajax(..) æ˜¯æŸä¸ªåŒ…ä¸­ä»»æ„çš„Ajaxå‡½æ•°</span><span class="token function">ajax</span><span class="token punctuation">(</span> <span class="token string">"http://some.url.1"</span><span class="token punctuation">,</span> response <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ajax</span><span class="token punctuation">(</span> <span class="token string">"http://some.url.2"</span><span class="token punctuation">,</span> response <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>è®¾ç½®å¤§é—¨(åªæœ‰ä¸¤ä¸ªè¿›ç¨‹éƒ½å®Œæˆæ‰èƒ½ç»§ç»­)</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> a <span class="token operator">=</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> b <span class="token operator">=</span> y <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> a <span class="token operator">+</span> b <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// ajax(..) æ˜¯æŸä¸ªåŒ…ä¸­ä»»æ„çš„Ajaxå‡½æ•°</span><span class="token function">ajax</span><span class="token punctuation">(</span> <span class="token string">"http://some.url.1"</span><span class="token punctuation">,</span> foo <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ajax</span><span class="token punctuation">(</span> <span class="token string">"http://some.url.2"</span><span class="token punctuation">,</span> bar <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>è®¾ç½®"é—¨é—©"(å³å‡½æ•°åªç»™ç‰¹å®šæ¬¡è°ƒç”¨è€…ç”¨)</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a<span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> a <span class="token operator">=</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> a <span class="token operator">=</span> x <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> a <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// ajax(..) æ˜¯æŸä¸ªåŒ…ä¸­ä»»æ„çš„Ajaxå‡½æ•°</span><span class="token function">ajax</span><span class="token punctuation">(</span> <span class="token string">"http://some.url.1"</span><span class="token punctuation">,</span> foo <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ajax</span><span class="token punctuation">(</span> <span class="token string">"http://some.url.2"</span><span class="token punctuation">,</span> bar <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>åä½œå¼</p><p>å¯¹äºè®¡ç®—é‡å¾ˆå¤§çš„åŒæ­¥ä»»åŠ¡, ç»å¸¸å°†å…¶æ‹†è§£ä¸ºå¼‚æ­¥çš„å¤šä¸ªä¸å†²çªä»»åŠ¡ä»¥æ”¾ç½®JavaScript è¿è¡Œé˜»å¡</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// `response(..)`ä»Ajaxè°ƒç”¨æ”¶åˆ°ä¸€ä¸ª10000000000çš„æ•°ç»„, è¦åŒæ­¥æ‰§è¡Œä¸€å®šä¼šèŠ±å¾ˆå¤šæ—¶é—´</span><span class="token keyword">function</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> res <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>  data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token keyword">return</span> val <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// ajax(..) æ˜¯æŸä¸ªåŒ…ä¸­ä»»æ„çš„Ajaxå‡½æ•°</span><span class="token function">ajax</span><span class="token punctuation">(</span> <span class="token string">"http://some.url.1"</span><span class="token punctuation">,</span> response <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ajax</span><span class="token punctuation">(</span> <span class="token string">"http://some.url.2"</span><span class="token punctuation">,</span> response <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°†å…¶åˆ†è§£</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// ä¸€æ¬¡åªå¤„ç†1000ä»¶</span> <span class="token keyword">var</span> chunk <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    res <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>  <span class="token comment">// åˆ¶é€ ä¸€ä¸ªæ–°çš„å˜å½¢è¿‡çš„æ•°ç»„ï¼Œæ‰€æœ‰çš„`data`å€¼éƒ½ç¿»å€</span>  chunk<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token keyword">return</span> val <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// å¼‚æ­¥è§„åˆ’ä¸‹ä¸€ä¸ªæ‰¹å¤„ç†</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">// é€šè¿‡ setTImeout å°†ä»»åŠ¡å†æ¬¡æ”¾å…¥é˜Ÿå°¾</span>   <span class="token function">response</span><span class="token punctuation">(</span> data <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// ajax(..) æ˜¯æŸä¸ªåŒ…ä¸­ä»»æ„çš„Ajaxå‡½æ•°</span><span class="token function">ajax</span><span class="token punctuation">(</span> <span class="token string">"http://some.url.1"</span><span class="token punctuation">,</span> response <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ajax</span><span class="token punctuation">(</span> <span class="token string">"http://some.url.2"</span><span class="token punctuation">,</span> response <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>è¯­å¥é¡ºåº</strong></p><p>JavaScript ç¼–è¯‘å™¨åœ¨æ‰§è¡Œä»£ç å‰ä¼šåšä»£ç ä¼˜åŒ–, è¿™å¯èƒ½æ”¹å˜è¯­å¥æ‰§è¡Œé¡ºåº,ä½†æ˜¯è¿™äº›æ”¹å˜éƒ½æ˜¯å®‰å…¨çš„, ä¸å¿…æ‹…å¿ƒ</p><h3 id="å›è°ƒ">å›è°ƒ</h3><p>JavaScript æ˜¯å•çº¿ç¨‹çš„,å…¶å®ç°å¼‚æ­¥çš„æœ€åŸºæœ¬æ¨¡å¼å°±æ˜¯è®©ä¸»çº¿ç¨‹åœ¨ä¸åŒä»»åŠ¡ä¸Šä¸‹æ–‡ä¹‹é—´å¿«é€Ÿåˆ‡æ¢.åŸºç¡€çš„å¼‚æ­¥æ¨¡å¼æœ‰å›è°ƒä¸ <code>Promise</code>.</p><p><strong>å›è°ƒçš„é—®é¢˜</strong></p><p>å›è°ƒä¼šè®©ä»£ç å˜å¾—éš¾ä»¥é¢„æµ‹, è·Ÿè¸ª, è°ƒè¯•. å…¶å­˜åœ¨å¤šç§é—®é¢˜</p><ul><li><p>å›è°ƒåœ°ç‹±</p><p>ç§°å¤šå±‚åµŒå¥—å›è°ƒå‡½æ•°çš„ä»£ç ä¸ºå›è°ƒåœ°ç‹±.å›è°ƒåœ°ç‹±ä¸ä»…ä¼šé€ æˆä»£ç å½¢å¼ä¸Šçš„éš¾ä»¥ç†è§£,æ›´é‡è¦çš„æ˜¯åœ¨åŒæ­¥å¼‚æ­¥å‡½æ•°æ··æ‚çš„å›è°ƒåµŒå¥—ä»£ç ä¸­,ä»£ç çš„è¡Œä¸ºä¸å¼‚æ­¥å‡½æ•°çš„æ‰§è¡Œæ—¶æœºå¾€å¾€æ˜¯å¤šæ ·åŒ–çš„ä¸”å®¹æ˜“è¢«æé”™.</p></li><li><p>ä¿¡ä»»é—®é¢˜</p><p>å½“ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å¼‚æ­¥å‡½æ•°æ—¶, æˆ‘ä»¬éœ€è¦ä¸ºç¬¬ä¸‰æ–¹å‡½æ•°ä¼ å…¥å›è°ƒ.è€Œæˆ‘ä»¬å®Œå…¨ä¸æ¸…æ¥šç¬¬ä¸‰æ–¹åº“è§¦å‘å›è°ƒçš„æ—¶æœº, æ¬¡æ•°, ä¸‰æ–¹å‡½æ•°å‡ºé”™åè¡Œä¸º.è¿‡æ—©è¿‡æ™šè¿‡å¤šæˆ–å‡ºé”™åè§¦å‘å›è°ƒå°†ä¼šå¸¦æ¥æœªçŸ¥çš„é—®é¢˜.ä½¿ç”¨è€…åœ¨è®¾è®¡å›è°ƒæ—¶éœ€è¦è€ƒè™‘å›è°ƒåœ¨ä¸åŒæ—¶æœºè°ƒç”¨çš„å¤„ç†é—®é¢˜. åŒæ—¶,ç§°è¿™ç§å°†å‡½æ•°æ‰§è¡Œæ—¶æœºäº¤ç»™ä¸‰æ–¹å‡½æ•°çš„è¡Œä¸ºç§°ä¸º: æ§åˆ¶æƒåè½¬</p></li></ul><p><strong>è§£å†³</strong></p><ul><li><p>è§£å†³å›è°ƒåœ°ç‹±: é“¾å¼å›è°ƒ</p><p>å°†åµŒå¥—å¼å›è°ƒ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">doA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è½¬ä¸ºé“¾å¼å›è°ƒ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">doA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// do something</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span>doB<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">doB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// do something</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span>doC<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">doC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// do something</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™è®©ä»£ç åœ¨å½¢å¼ä¸Šçœ‹èµ·æ¥æ¸…æ™°äº†ä¸€ç‚¹, ä½†æ˜¯æ²¡æœ‰æ ¹æœ¬è§£å†³é—®é¢˜.å‡½æ•°çš„æ‰§è¡Œè¿˜æ˜¯éš¾ä»¥è¿½è¸ªçš„.</p></li><li><p>è§£å†³ä¿¡ä»»é—®é¢˜: <code>Error-Else</code> é£æ ¼</p><p>ä¹Ÿç§° Node.JS åˆ†æ ¼. åœ¨è®¾è®¡å›è°ƒå‡½æ•°æ—¶, ä¼ å…¥ç¬¬ä¸€ä¸ªå‚æ•°ä¸º Error ä¿¡æ¯.è‹¥å‡½æ•°å‡ºé”™, åœ¨æ‰§è¡Œå›è°ƒæ—¶å€™å°†ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸º Error ä¿¡æ¯,å›è°ƒä¸€æ—¦çœ‹åˆ°ç¬¬ä¸€ä¸ªå‡½æ•°éå‡å°±çŸ¥é“ä¸Šå±‚å‡½æ•°å‡ºé”™äº†, è‹¥ Error ä¸ºå‡,åˆ™ä»ç¬¬äºŒä¸ªå‚æ•°å¼€å§‹è·å–ä¼ å…¥ä¿¡æ¯.</p></li><li><p>è§£å†³ä¿¡ä»»é—®é¢˜: å€Ÿç”¨å¹¶å‘è§£å†³æ–¹æ¡ˆ</p><p>ä¸ºè§£å†³å›è°ƒæ—¶æœºé—®é¢˜, å¯ä»¥å€ŸåŠ©å¹¶å‘æ€è·¯, é€šè¿‡è®¾ç½® flag è¯†åˆ«è¿è¡Œæ—¶æœº,è§£å†³è¿è¡Œæ—¶æœºé—®é¢˜</p></li></ul><h3 id="promise">Promise</h3><p>å›è°ƒå­˜åœ¨çš„ä¸¤ä¸ªé—®é¢˜: ä¿¡ä»»é—®é¢˜ &amp; å›è°ƒåœ°ç‹±(å¼‚æ­¥ä»£ç éš¾ä»¥ç†è§£). åœ¨ ES6ä¸­, Promise &amp; ç”Ÿæˆå™¨åˆ†åˆ«è§£å†³äº†è¿™ä¸¤ä¸ªé—®é¢˜.</p><p><strong>é¸­å­ç±»å‹</strong></p><p>å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯ Promise å¯¹è±¡å‘¢? JavaScriptçš„åˆ¤æ–­æ–¹å¼æ˜¯æ£€æŸ¥å¯¹è±¡æ˜¯å¦æ˜¯ "thenable" çš„, å³: å¯¹è±¡æ˜¯å¦å…·æœ‰<code>then</code> æ–¹æ³•. <strong>ä»»ä½•æœ‰ <code>then</code> æ–¹æ³•çš„å¯¹è±¡éƒ½æ˜¯Promise</strong></p><p>æ˜¾ç„¶, è¿™ä¼šé€ æˆä¸¥é‡çš„å…¼å®¹é—®é¢˜, è€ä»£ç ä¸­å®šä¹‰ <code>then</code>çš„å¯¹è±¡éƒ½è«åå…¶å¦™å˜æˆäº† Promise</p><p><code>Promise.resolve</code> å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šè§£å†³è¿™ä¸€é—®é¢˜.è¯¥å‡½æ•°ä¸ä»…å¯ä»¥è¿”å›ä¸€ä¸ª Promise, æ›´é‡è¦çš„æ˜¯å…¶å¯ä»¥å°†å‚æ•°ä¸­çš„<code>thenable</code> è½¬æ¢ä¸ºé <code>thenable</code></p><p><strong>Promise è§£å†³äº†ä¿¡ä»»é—®é¢˜</strong></p><ul><li><p>æ§åˆ¶æƒåè½¬: åœ¨å›è°ƒä¸­, æˆ‘ä»¬å°†å›è°ƒäº¤ç»™ä¸‰æ–¹å‡½æ•°.ä¸‰æ–¹å‡½æ•°çš„æ‰§è¡Œæ˜¯ä¸å¯é¢„æµ‹çš„. è€Œåœ¨ Promise ä¸­,ä¸‰æ–¹å¼‚æ­¥å‡½æ•°åªåœ¨ç»“æŸæ—¶å‘æˆ‘ä»¬è¿”å›æ‰§è¡Œç»“æœ / é”™è¯¯ä¿¡æ¯.</p></li><li><p>è°ƒç”¨è¿‡æ—©: åœ¨å›è°ƒä¸­, å¯èƒ½å‡ºç°å¼‚æ­¥å‡½æ•°ç»“æŸå‰è°ƒç”¨å›è°ƒçš„é—®é¢˜, åœ¨Promise ä¸­, å³ä½¿åç»§å‡½æ•°è¢«æ³¨å†Œ, ä¹Ÿè¦ç­‰åˆ° Promise è¢«å†³è®®åçš„ä¸‹ä¸€ä¸ª trickå†æ‰§è¡Œ</p></li><li><p>è°ƒç”¨è¿‡æ™š: åœ¨å›è°ƒä¸­, å¯èƒ½ä¼šå‡ºç°åæ³¨å†Œçš„å›è°ƒå…ˆæ‰§è¡Œçš„é—®é¢˜</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'TEST1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'TEST2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hook'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// TEST1</span><span class="token comment">// Hook         // ğŸ‘</span><span class="token comment">// TEST2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ Promise ä¸­, åç»§å‡½æ•°çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸¥æ ¼æŒ‰ç…§æ³¨å†Œé¡ºåºæ¥åˆ°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'THEN 1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hook'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'THEN 2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// THEN 1</span><span class="token comment">// THEN 2</span><span class="token comment">// Hook        // ğŸ‘</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>è¶…æ—¶ä¸è°ƒç”¨: åœ¨å›è°ƒä¸­, å¦‚æœä¸‰æ–¹å‡½æ•°ä¸è°ƒç”¨, æˆ‘ä»¬ä¹Ÿæ²¡åŠæ³•, ä½†æ˜¯åœ¨Promise ä¸­, å¯ä»¥é€šè¿‡ <code>Promise.race()</code> çš„æ–¹å¼è§£å†³è¿™ä¸€é—®é¢˜</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">timeOutError</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'TIME OUT'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'OK'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">timeOutError</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>  <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'T1 FUL: '</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'T1 REJ: '</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'OK'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">timeOutError</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>  <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'T2 FUL: '</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'T2 REJ: '</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// T2 FUL:  OK</span><span class="token comment">// T1 REJ:  TIME OUT</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>è°ƒç”¨æ¬¡æ•°ä¸æ­£ç¡®: Promise ä¸€æ—¦ç¡®å®šå°±æ— æ³•æ›´æ”¹(ä¹‹åçš„<code>resolve</code> / <code>reject</code> é™é»˜å¤±æ•ˆ), é€šè¿‡<code>then</code> æ³¨å†Œçš„å‡½æ•°ä¹Ÿåªèƒ½æ‰§è¡Œä¸€æ¬¡</p></li><li><p>ä¼ å‚å¼‚å¸¸: åœ¨å›è°ƒä¸­å¯èƒ½å‡ºç°å‚æ•°é•¿åº¦ä¸æ­£ç¡®, ä½†æ˜¯ Promiseåªå…è®¸ä¼ å…¥ä¸€ä¸ªå‚æ•°, å¤šä¼ çš„å‚æ•°é™é»˜å¤±æ•ˆ</p></li><li><p>å¼‚å¸¸å¤„ç†: åœ¨å›è°ƒä¸­, å¦‚æœä¸‰æ–¹å‡½æ•°å‡ºç°å¼‚å¸¸, å›è°ƒå‡½æ•°å¯èƒ½ä¸æ‰§è¡Œ.ä½†æ˜¯åœ¨ Promise ä¸­, è‹¥æ‰§è¡Œå‡ºç°å¼‚å¸¸, Promise ä¼šè‡ªåŠ¨æ‰§è¡Œ reject,æ•è·å¼‚å¸¸å¹¶ä¼ é€’åˆ°åç»§å‡½æ•°.</p></li></ul><p><strong>ä¸ºä»€ä¹ˆæ˜¯ <code>resolve</code> è€Œä¸æ˜¯<code>fulfill</code></strong></p><p>Promise çš„çŠ¶æ€æœ‰ <code>pending</code> &amp; <code>fulfilled</code>&amp; <code>rejected</code>, ä½†æ˜¯æˆ‘ä»¬åœ¨æ„é€  Promiseå›è°ƒçš„æ—¶å€™ä¹ æƒ¯ä¸Šå†™çš„å´æ˜¯ <code>resolve</code> &amp; <code>reject</code>.ä¸ºä»€ä¹ˆè¿™é‡Œä¸ç”¨ <code>fulfill</code> &amp; <code>reject</code> å‘¢?</p><p><code>fulfilled</code> è¡¨ç¤º Promise è¢«æ¥å—, è€Œ <code>rejected</code>è¡¨ç¤ºè¢«æ‹’ç». ç„¶è€Œ Promise æ„é€ å‡½æ•°ä¸Šçš„ <code>resolve &amp; reject</code>åŠŸèƒ½å´ä¸æ˜¯è¿™æ ·çš„</p><ul><li><p><code>reject</code> è°ƒç”¨ä¼šè®© Promise æ— æ¡ä»¶å˜ä¸º<code>rejected</code>, ä¸”åŸå› ä¸ºä¼ å…¥çš„å‚æ•°</p></li><li><p><code>resolve</code> è°ƒç”¨ä¼šè®© Promise å˜ä¸ºè°ƒç”¨<code>Promise.resolve</code> åçš„ç»“æœ. å¦‚æœä¼ å…¥çš„æ˜¯ä¸€ä¸ª Error, Promiseå°†å˜ä¸º <code>rejected</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token function">resolve</span><span class="token punctuation">(</span>Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'FLU'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'REJ'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// REJ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå°±æ˜¯è¯´ <code>resolve</code> ä¸ä¼šè®© Promise æ— æ¡ä»¶å˜ä¸º<code>fulfilled</code>, è¿™ä¹Ÿå°±æ˜¯ä¸ç”¨ <code>fulfill</code>çš„åŸå› </p></li></ul><p><strong>é“¾å¼è°ƒç”¨</strong></p><ul><li>Promise æ¯æ¬¡è°ƒç”¨ <code>then</code> éƒ½ä¼šåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª Promise æ›¿ä»£åŸPromise</li><li>è‹¥ <code>then</code> ä¸­å‡½æ•°è¿”å›é Promise, åˆ™è‡ªåŠ¨ä¸ºå…¶åŒ…ä¸Š<code>Promise.resolve</code>. ä¸è¿”å›åˆ™ç›¸å½“äºè¿”å› <code>undefined</code>å³è¿”å› <code>Promise.resolve(undefined)</code></li><li><code>then</code> ä¸­å‡½æ•°çš„è¿”å›å€¼å°†è¢«ç”¨ä½œä¸‹ä¸€ä¸ª <code>then</code>ä¸­å‡½æ•°çš„å‚æ•°.</li><li><code>then</code> ä¸­çš„å‡½æ•°æŠ›å‡ºé”™è¯¯, å¹¶ä¸ä¼šå¼•å…¨å±€é”™è¯¯, è€Œæ˜¯ä¼šè¿”å›<code>Promise.reject</code> äº¤ç”±ä¸‹ä¸€ä¸ª <code>then</code> å¤„ç†.</li><li><code>then</code> å‡½æ•°æœ‰ä¸¤ä¸ªé»˜è®¤å€¼, ç¬¬ä¸€ä¸ªä¼šå°†æ”¶åˆ°çš„å‚æ•°é‡æ–°<code>resolve</code> ä¼ ç»™ä¸‹ä¸€çº§,ç¬¬äºŒä¸ªä¼šå°†ä¼ å…¥çš„å‚æ•°é‡æ–°ä½œä¸ºé”™è¯¯æŠ›å‡º</li><li><code>catch(fn)</code> ç›¸å½“äº <code>then(undefined, fn)</code></li></ul><p><strong>ä¸ºä»€ä¹ˆä¸æ˜¯ <code>try...catch</code></strong></p><p>Promise ä¸­ä½¿ç”¨ <code>reject</code> è€Œä¸æ˜¯ <code>try...catch</code>çš„åŸå› æ˜¯ <code>reject</code> å¯ä»¥å¼‚æ­¥çš„å¤„ç†é”™è¯¯.</p><p><strong>å¹¶å‘</strong></p><ul><li><code>Promise.all</code> å¯ä»¥å®ç°å¹¶å‘æ‰§è¡Œ, ä¼ å…¥<code>Promise.all</code> æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ åœ¨æ‰§è¡Œå‰éƒ½ä¼šè¢«<code>Promise.resolve</code> è¿‡æ»¤ä¸€é. è‹¥æ‰§è¡Œæ—¶å‡ºç°äº†ä¸€ä¸ª<code>reject</code> åˆ™ç›´æ¥è¿”å› <code>reject</code>,å¦åˆ™å…¨éƒ¨æ‰§è¡Œå¹¶è¿”å›ç»“æœæ•°ç»„</li><li><code>Promise.race</code> æ— è®ºç»“æœå¦‚ä½•, åªè¿”å›ç¬¬ä¸€ä¸ª. (ä¸º<code>Promise.race</code> ä¼ å…¥ç©ºæ•°ç»„ä¼šå¯¼è‡´ Promise æ°¸è¿œå¤„äº<code>pedding</code> çŠ¶æ€)</li><li><code>Promise.none</code>: <code>Promise.all</code> çš„åé¢, åªæœ‰å…¨<code>rejected</code> æ‰è¿”å›æ•°ç»„</li><li><code>Promise.any</code>: å¿½ç•¥æ‹’ç», è¿”å›ç¬¬ä¸€ä¸ª<code>fulfilled</code>, è‹¥éƒ½å¤±è´¥åˆ™è¿”å›å¤±è´¥</li><li><code>Promise.first</code>: <del>å’Œ any ä¸€æ ·</del></li><li><code>Promise.last</code>: è¿”å›æœ€åä¸€ä¸ªæˆåŠŸ</li></ul><p><strong>ç¼ºé™·</strong></p><p><del>å…¶å®æˆ‘è§‰å¾—è¿™éƒ½ä¸æ˜¯ç¼ºé™·</del></p><ol type="1"><li>æ— æ³•å¯é æ•è· <code>Promise</code> æœ€ç»ˆçš„ç»“æœ: æˆ‘ä»¬ä¸çŸ¥é“ Promiseä»€ä¹ˆæ—¶å€™æ‰§è¡Œå®Œ, ä¹Ÿæ— æ³•çŸ¥é“ Promise æ˜¯å¦å‡ºç°é”™è¯¯. æœ€ç®€å•çš„æƒ³æ³•æ˜¯åœ¨Promise æœ€åæ³¨å†Œä¸€ä¸ª <code>then</code> ç”¨äºé€šçŸ¥ Promise æ‰§è¡Œå®Œæˆ. ä½†æ˜¯,å¦‚æœè¿™ä¸ªè¿™ä¸ªå‡½æ•°å‡ºé”™äº†, æˆ‘ä»¬å°†æ— æ³•å¾—çŸ¥ Promise æœ€åæ˜¯<code>fulfilled</code> è¿˜æ˜¯ <code>rejected</code>.å”¯ä¸€çš„å¯è¡Œæ–¹æ³•æ˜¯åˆ©ç”¨æµè§ˆå™¨çš„åƒåœ¾å›æ”¶æœºåˆ¶, è‹¥ä¸€ä¸ª Promise å¤„äºå¾…å›æ”¶çŠ¶æ€,é‚£ä¹ˆè¿™ä¸ª Promise è‚¯å®šæ˜¯æ‰§è¡Œå®Œäº†, è¿™ä¸ªæ—¶å€™å¯ä»¥æ£€æµ‹ Promise çš„çŠ¶æ€</li><li>ä¸€æ—¦ç¡®å®šæ— æ³•ä¿®æ­£: Promise ä¸€æ—¦åšå‡ºå†³å®šå°±æ— æ³•å˜åŒ–, è¿™æ„å‘³ç€å¾ˆéš¾è®©Promise åšé‡å¤æ€§å·¥ä½œ(ä¸€æ—¦ç›‘å¬åˆ°é¼ æ ‡æŒ‰ä¸‹å°±æ‰§è¡Œå‡½æ•°),æˆ‘ä»¬åªèƒ½å€ŸåŠ©è¾…åŠ©å‡½æ•°ä¸æ–­çš„ç”Ÿæˆæ–°çš„ Promise</li><li>æ— æ³•å–æ¶ˆ. æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>Promise.race</code> å®ç°è¶…æ—¶æŠ¥é”™,ä½†æ˜¯æŠ¥é”™å¹¶ä¸ä¼šå½±å“è¶…æ—¶çš„ Promise ç»§ç»­æ‰§è¡Œ.</li></ol><h3 id="ç”Ÿæˆå™¨">ç”Ÿæˆå™¨</h3><p>Promise è§£å†³äº†å¼‚æ­¥çš„ä¿¡ä»»é—®é¢˜, è€Œç”Ÿæˆå™¨è§£å†³äº†å›è°ƒåœ°ç‹±é—®é¢˜.å°†å¼‚æ­¥ä»£ç è½¬æ¢ä¸ºçœ‹ä¼¼åŒæ­¥çš„é¡ºåºä»£ç é£æ ¼.</p><p><strong>å¼‚æ­¥æ‰§è¡Œ</strong></p><p>ç”Ÿæˆå™¨è¿”å›ä¸€ä¸ªè¿­ä»£å™¨,è°ƒç”¨è€…å¯ä»¥åœ¨ä»»ä½•æ—¶æœºè°ƒç”¨è¿­ä»£å™¨ä»¥å®ç°çœ‹ä¼¼åŒæ­¥çš„å¼‚æ­¥è°ƒç”¨.ä¸€ä¸ªç”Ÿæˆå™¨å¯ä»¥ç”Ÿæˆå¤šä¸ªè¿­ä»£å™¨. è¿™äº›è¿­ä»£å™¨ä¹‹é—´å¯ä»¥äº¤æ›¿æ‰§è¡Œ,è¿­ä»£å™¨ä¹‹é—´ç‹¬ç«‹æ— æ³•ç›´æ¥é€šä¿¡, ä½†æ˜¯å¯ä»¥é€šè¿‡å¤–éƒ¨å˜é‡é—­åŒ…é€šä¿¡.</p><p><strong>åŒå‘æ•°æ®ä¼ é€’</strong></p><p>æˆ‘ä»¬å¸Œæœ›åœ¨æ¯æ¬¡è°ƒç”¨è¿­ä»£å™¨æ—¶å€™éƒ½èƒ½ä¸ºç”Ÿæˆå™¨ä¼ å…¥å‚æ•°, å¹¶è·å¾—è¿­ä»£å™¨çš„ç›¸åº”.å¯ä»¥é€šè¿‡ <code>yield X</code> æˆ– <code>return X</code> çš„æ–¹å¼è·å–è¿”å›å€¼,é€šè¿‡ <code>yield</code> ä¼ å…¥å‚æ•°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> y <span class="token operator">=</span> x <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">yield</span> <span class="token string">'C'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 3.      ^ æ‰§è¡Œåˆ°è¿™é‡Œå°±åœä¸‹, è¿”å› C</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'D'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> y<span class="token punctuation">;</span> <span class="token comment">// &lt;- 5. æ‰§è¡Œåˆ°è¿™é‡Œ, è¿”å› y</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1. åªæ˜¯è¿”å›ç”Ÿæˆå™¨, ä½†æ˜¯ä¸€ç‚¹éƒ½ä¸æ‰§è¡Œ</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2. å¼€å§‹æ‰§è¡Œç”Ÿæˆå™¨</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4. ä¼ å…¥ 3 ç»§ç»­æ‰§è¡Œ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ„é€ è¿­ä»£å™¨</strong></p><p>ä¸ºå¯¹è±¡åŠ å…¥ <code>[Symbol.iterator]</code> &amp; <code>next</code>æ–¹æ³•, å³å¯å°†å¯¹è±¡å˜ä¸ºè¿­ä»£å™¨.</p><ul><li><code>[Symbol.iterator]</code> æ–¹æ³•æ˜¯ä¸€ä¸ªè®¡ç®—å±æ€§, ä¸ TypeScriptçš„è®¡ç®—å±æ€§ä¸€æ ·, <code>Symbol.iterator</code> å°±æ˜¯ <code>Symbol</code>çš„é™æ€æˆå‘˜. è¯¥æ–¹æ³•åº”è¯¥è¿”å›ä¸€ä¸ªè¿­ä»£å™¨è‡ªèº«.</li><li><code>next</code> æ–¹æ³•è¿”å› <code>&#123;done: boolean, value: &#125;</code>å¯¹è±¡.</li></ul><p><code>for...of</code>å¯ä»¥å®ç°éå†è¿­ä»£å™¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> it <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è¿”å›ä¸€ä¸ªéšæœºæ•°</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">of</span> it<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// æ°¸è¿œä¸ done å°±ä¼šé™·å…¥æ­»å¾ªç¯</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç”Ÿæˆå™¨ä¸è¿­ä»£å™¨</strong></p><p>ä¸ºç”Ÿæˆå™¨äº§ç”Ÿçš„è¿­ä»£å™¨åšä¸€äº›æ”¹é€ å¯ä»¥å®ç°ç‰¹æ®ŠåŠŸèƒ½</p><ul><li><p>å®ç°ä¸€ä¸ªè®¡æ•°å™¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">yield</span> <span class="token operator">++</span>cnt<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> counter1 <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> counter2 <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å®ç°å…³é—­è¿­ä»£å™¨é’©å­</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">yield</span> <span class="token operator">++</span>cnt<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ç›¸å½“äºå®ç°äº†ä¸€ä¸ªæ‰§è¡Œç»“æŸçš„é’©å­, å¯ä»¥ç”¨æ¥åšåƒåœ¾å›æ”¶</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'OK I will clean all the code'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> counter1 <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> counter2 <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span><span class="token comment">// å…³é—­ç”Ÿæˆå™¨, æ‰§è¡Œ finally</span>counter2<span class="token punctuation">.</span><span class="token function">return</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>åŒæ­¥é£æ ¼çš„å¼‚æ­¥ä»£ç </strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">ajax</span><span class="token punctuation">(</span>  <span class="token string">"http://some.url.1/?x="</span> <span class="token operator">+</span> x <span class="token operator">+</span> <span class="token string">"&amp;y="</span> <span class="token operator">+</span> y<span class="token punctuation">,</span>  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å‘`*main()`ä¸­æ‰”è¿›ä¸€ä¸ªé”™è¯¯</span>    it<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span> err <span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ä½¿ç”¨æ”¶åˆ°çš„`data`æ¥ç»§ç»­`*main()`</span>    it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span> data <span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> text <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">foo</span><span class="token punctuation">(</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">31</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿”å›å¹¶æ‰§è¡Œå¼‚æ­¥, å¼‚æ­¥æ‰§è¡Œåä¼šè°ƒç”¨ç”Ÿæˆå™¨ä¸‹ä¸€æ­¥. åŒæ—¶æ”¯æŒé”™è¯¯å¤„ç†</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> text <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span> err <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ä½¿ä¸€åˆ‡å¼€å§‹è¿è¡Œï¼</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç”Ÿæˆå™¨ä¸Promise</strong></p><p>è¿­ä»£å™¨å¯ä»¥ç”¨æ¥å†™å¼‚æ­¥ä»£ç ä¸”ä¸äº§ç”Ÿå›è°ƒåœ°ç‹±.ä½†æ˜¯ç”Ÿæˆå™¨éœ€è¦å¤–ç•Œä¸æ–­æ§åˆ¶è‡ªå·±æ‰§è¡Œä¸‹ä¸€å—ä»£ç . è¿™ä¸ªå·¥ä½œå¦‚æœç”± Promiseå®Œæˆé‚£å°±ä¼šå˜å¾—ååˆ†ä¼˜é›…</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'demo.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// request ä¼šè¿”å›ä¸€ä¸ª Promise</span>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ERROR'</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> p <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// p ç°åœ¨æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡</span>it<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>  <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> it<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è®© Promise æ‰§è¡Œæµç¨‹æ§åˆ¶</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™é‡Œ, Promiseçš„å¼‚æ­¥æ§åˆ¶åªæ˜¯åœ¨ç¨‹åºæ‰§è¡ŒæˆåŠŸä¸å‡ºé”™çš„æ—¶å€™è¿”å›ä¸æŠ›å‡ºæ¶ˆæ¯.å®Œå…¨å¯ä»¥ç”¨ä¸€ä¸ªå‡½æ•°å®ç°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// æ„Ÿè°¢Benjamin Gruenbaum (@benjamingråœ¨GitHub)åœ¨æ­¤åšå‡ºçš„å·¨å¤§æ”¹è¿›ï¼</span><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">gen</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span> arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> it<span class="token punctuation">;</span> <span class="token comment">// åœ¨å½“å‰çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­åˆå§‹åŒ–generator</span> it <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">,</span> args <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸ºgeneratorçš„å®Œæˆè¿”å›ä¸€ä¸ªpromise</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token keyword">function</span> <span class="token function">handleNext</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token comment">// è¿è¡Œè‡³ä¸‹ä¸€ä¸ªè®©å‡ºçš„å€¼</span>   <span class="token keyword">var</span> next <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span> value <span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">handleResult</span><span class="token punctuation">(</span><span class="token parameter">next</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// generatorå·²ç»å®Œæˆè¿è¡Œäº†ï¼Ÿ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>next<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">return</span> next<span class="token punctuation">.</span>value<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å¦åˆ™ç»§ç»­æ‰§è¡Œ</span>    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span> next<span class="token punctuation">.</span>value <span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>       <span class="token comment">// åœ¨æˆåŠŸçš„æƒ…å†µä¸‹ç»§ç»­å¼‚æ­¥å¾ªç¯ï¼Œå°†è§£æçš„å€¼é€å›generator</span>       handleNext<span class="token punctuation">,</span>       <span class="token comment">// å¦‚æœ`value`æ˜¯ä¸€ä¸ªæ‹’ç»çš„promiseï¼Œå°±å°†é”™è¯¯ä¼ æ’­å›generatorè‡ªå·±çš„é”™è¯¯å¤„ç†g</span>       <span class="token keyword">function</span> <span class="token function">handleErr</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>         it<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span> err <span class="token punctuation">)</span>        <span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> handleResult <span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>      <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ ES7 ä¸­, è¿˜å¯ä»¥ä½¿ç”¨ <code>async</code> &amp; <code>await</code>å®ç°ä¸Šè¿°åŠŸèƒ½</p><p><strong>å¹¶å‘</strong></p><p>å¯ä»¥å€ŸåŠ© Promise API å®ç°å¹¶å‘(è¿™ä¹Ÿå¯ç¤ºäº†æˆ‘ä»¬åº”è¯¥åœ¨å“ªé‡Œä½¿ç”¨<code>async</code> &amp; <code>await</code>)</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">yield</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>    <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'demo-partA.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'demo-partB.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">demo-full.com?a=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>a<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&amp;b=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>b<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> p <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// p ç°åœ¨æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡</span>it<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è®© Promise æ‰§è¡Œæµç¨‹æ§åˆ¶</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç”Ÿæˆå™¨å§”æ‰˜</strong></p><p>å¯ä»¥å°†ç”Ÿæˆå™¨åµŒå¥—ç”Ÿæˆå™¨ç›´æ¥æ‰å¹³åŒ–ä¸ºä¸€ç»´ç”Ÿæˆå™¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">yield</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">yield</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">yield</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">yield</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">yield</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">yield</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> it <span class="token operator">=</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å˜ä¸º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">yield</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">yield</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">yield</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">yield</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// åœ¨è°ƒç”¨çš„æ—¶å€™å¸¦ä¸Š * è¿™æ ·ç›¸å½“äºå®ç°äº†ç”Ÿæˆå™¨"è½¬ç§»"</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">yield</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> it <span class="token operator">=</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1 2 3 4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”Ÿæˆå™¨å§”æ‰˜çš„å¯¹è±¡å¯ä»¥æ˜¯ä»»ä½•å¯è¿­ä»£çš„å€¼</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">yield</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">yield</span><span class="token operator">*</span> foo<span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">yield</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> it <span class="token operator">=</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1 9 8 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥å§”æ‰˜å¼‚å¸¸</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">yield</span> <span class="token string">"B"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">"error caught inside `*foo()`:"</span><span class="token punctuation">,</span> err <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">yield</span> <span class="token string">"C"</span><span class="token punctuation">;</span> <span class="token keyword">throw</span> <span class="token string">"D"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">yield</span> <span class="token string">"A"</span><span class="token punctuation">;</span> <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">yield</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">"error caught inside `*bar()`:"</span><span class="token punctuation">,</span> err <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">yield</span> <span class="token string">"E"</span><span class="token punctuation">;</span> <span class="token keyword">yield</span> <span class="token operator">*</span><span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// note: can't get here!</span> <span class="token keyword">yield</span> <span class="token string">"G"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">throw</span> <span class="token string">"F"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">"outside:"</span><span class="token punctuation">,</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// outside: A</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">"outside:"</span><span class="token punctuation">,</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// outside: B</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">"outside:"</span><span class="token punctuation">,</span> it<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span> <span class="token number">2</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// error caught inside `*foo()`: 2</span><span class="token comment">// outside: C</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">"outside:"</span><span class="token punctuation">,</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span> <span class="token number">3</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// error caught inside `*bar()`: D</span><span class="token comment">// outside: E</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">"outside:"</span><span class="token punctuation">,</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span> <span class="token number">4</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">"error caught outside:"</span><span class="token punctuation">,</span> err <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// error caught outside: F</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å½¢å®è½¬æ¢(Thunk)</strong></p><p>ä¸€ç§å¤è€çš„æ¨¡å¼: æ‰§è¡ŒæŸä¸ªæ— å‚å‡½æ•°, ç›¸å½“äºè¿™ä¸ªå¦ä¸€ä¸ªå‡½æ•°. ä¾‹å¦‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">fooThunk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token function">foo</span><span class="token punctuation">(</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// ç¨å</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token function">fooThunk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 7</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®é™…ä¸Š, è¿™ç§æ¨¡å¼ä¹Ÿå®ç°äº†å¼‚æ­¥. ä½†æ˜¯ Thunk çš„æ— å‚æ„å‘³ç€ç¡¬ç¼–ç .å¯ä»¥é€šè¿‡å·¥å‚å‡½æ•°è§£å†³è¿™ä¸ªé—®é¢˜.</p><p><strong>polyfill</strong></p><p>æˆ‘ä»¬å¯ä»¥è½»æ¾å®ç° Promise çš„å…¼å®¹ä»£ç , å› ä¸º Promise æ˜¯ä¸€ä¸ªAPI,ä½†æ˜¯ç”Ÿæˆå™¨æ˜¯ä¸€ç§è¯­æ³•. æˆ‘ä»¬æ²¡æ³•å®ç°å…¼å®¹. å¯ä»¥å…ˆçœ‹çœ‹ç”Ÿæˆå™¨çš„å®ç°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// ç®¡ç† generator çŠ¶æ€</span> <span class="token keyword">var</span> state<span class="token punctuation">;</span> <span class="token comment">// generator-èŒƒå›´çš„å˜é‡å£°æ˜</span> <span class="token keyword">var</span> val<span class="token punctuation">;</span> <span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">"requesting:"</span><span class="token punctuation">,</span> url <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span> url <span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>    val <span class="token operator">=</span> v<span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> val <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span><span class="token punctuation">;</span>   <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>    <span class="token keyword">var</span> err <span class="token operator">=</span> v<span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">"Oops:"</span><span class="token punctuation">,</span> err <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token comment">// åˆ¶é€ å¹¶è¿”å› iterator</span> <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>  <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token comment">// åˆå§‹çŠ¶æ€</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>state<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    state <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>     <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>     <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token comment">// æˆåŠŸåœ°è®©å‡ºç»§ç»­å€¼</span>   <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    state <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>     <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>     <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token function">process</span><span class="token punctuation">(</span> v <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token comment">// generator å·²ç»å®Œæˆäº†</span>   <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>     <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>     <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">undefined</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token string-property property">"throw"</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token comment">// åœ¨çŠ¶æ€ *1* ä¸­ï¼Œæœ‰å”¯ä¸€æ˜ç¡®çš„é”™è¯¯å¤„ç†</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    state <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>     <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>     <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token function">process</span><span class="token punctuation">(</span> e <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token comment">// å¦åˆ™ï¼Œæ˜¯ä¸€ä¸ªä¸ä¼šè¢«å¤„ç†çš„é”™è¯¯ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»…ä»…æŠŠå®ƒæ‰”å›å»</span>   <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">throw</span> e<span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœçœŸçš„éœ€è¦åœ¨ä¸æ”¯æŒ ES6 çš„ç¯å¢ƒä¸‹å®ç°ç”Ÿæˆå™¨.å¯ä»¥è€ƒè™‘ä»£ç è½¬è¯‘å·¥å…·.</p><h2 id="æ€§èƒ½">æ€§èƒ½</h2><h3 id="æ€§èƒ½æå‡">æ€§èƒ½æå‡</h3><p>å¼‚æ­¥å¯ä»¥å®ç°å¤šä»»åŠ¡å¹¶å‘å¹¶æ˜¾è‘—æé«˜æ€§èƒ½. JavaScriptä¸­å…¶ä»–æ€§èƒ½æå‡ç‰¹æ€§æœ‰</p><p><strong>Web Worker(<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvQVBJL1dlYl9Xb3JrZXJzX0FQSS9Vc2luZ193ZWJfd29ya2Vycw==">MDN<i class="fa fa-external-link-alt"></i></span>)</strong></p><p>Web Worker å¹¶ä¸æ˜¯ ES æ ‡å‡†è¯­æ³•, åªæ˜¯å®¿ä¸»ç¯å¢ƒçš„åŠŸèƒ½.å…¶å¯ä»¥æä¾›ä¸€ä¸ªå¹¶è¡Œçš„, ä¸å…±äº«ä½œç”¨åŸŸä¸èµ„æºçš„æ–°çº¿ç¨‹. é€šè¿‡ä¸ä¸»çº¿ç¨‹<code>post</code> &amp; <code>listen</code> æ¶ˆæ¯å®ç°é€šä¿¡.æ¶ˆæ¯ä¼ é€’æœ‰å¦‚ä¸‹æ–¹å¼</p><ul><li>è½¬æ¢ä¸º String</li><li><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvQVBJL1dlYl9Xb3JrZXJzX0FQSS9TdHJ1Y3R1cmVkX2Nsb25lX2FsZ29yaXRobQ==">ç»“æ„åŒ–æ‹·è´<i class="fa fa-external-link-alt"></i></span>:é«˜çº§çš„å…‹éš†ç®—æ³•, æ”¯æŒå¾ªç¯å¼•ç”¨ç­‰ç‰¹æ®Šå¯¹è±¡çš„æ‹·è´</li><li><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvQVBJL1dlYl9Xb3JrZXJzX0FQSS9Vc2luZ193ZWJfd29ya2VycyMlRTklODAlOUElRTglQkYlODclRTglQkQlQUMlRTglQUUlQTklRTYlODklODAlRTYlOUMlODklRTYlOUQlODMlRTUlOEYlQUYlRTglQkQlQUMlRTglQUUlQTklRTUlQUYlQjklRTglQjElQTElRTYlOUQlQTUlRTQlQkMlQTAlRTklODAlOTIlRTYlOTUlQjAlRTYlOEQlQUU=">æ‰€æœ‰æƒè½¬ç§»<i class="fa fa-external-link-alt"></i></span>:ç›´æ¥å°†å¯¹è±¡çš„å¼•ç”¨ä¸æ‰€æœ‰æƒå‘ç»™ Worker, æ­¤æ—¶å®¿ä¸»å‡½æ•°æ— æ³•è®¿é—®å¯¹è±¡</li></ul><p>Web Worker ä¹Ÿæ”¯æŒåˆ›å»ºå…±äº« Worker(å¹¶ä¸æ˜¯èµ„æºå…±äº«, è€Œæ˜¯ä¸€ä¸ª Workerå¯ä»¥ä¸å¤šä¸ªå®¿ä¸»é€šè¡Œ). åœ¨å®ç°å…±äº« Worker æ—¶, éœ€è¦ä¸ºæ¯æ¬¡é€šè¡Œå»ºç«‹æ–°çš„port</p><p><strong>SIMD</strong></p><p>å•æŒ‡ä»¤å¤šæ•°æ®(SIMD)æ˜¯ä¸€ç§æ•°æ®å¹¶è¡Œæ–¹æ³•.å…¶åŸç†æ˜¯å°†å¤šä¸ªå°æ•°æ®æ‹¼æˆä¸€ä¸ªå¤§æ•°æ®ä¸€èµ·è¿ç®—. CPU å°†å…¶åº•å±‚ API æš´éœ²ç»™JavaScript ä»¥å®ç°é«˜æ•ˆè®¡ç®—</p><p><strong>asm.js</strong></p><p>æ˜¯ä¸€ä¸ª JavaScript å­é›†(åªä¿ç•™å¯ä¼˜åŒ–çš„è¯­æ³•), å¯ä»¥å°† JavaScriptç¼–è¯‘ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶</p><h3 id="æ€§èƒ½æµ‹è¯•">æ€§èƒ½æµ‹è¯•</h3><p>é”™è¯¯çš„æµ‹è¯•æ–¹æ³•: å¤šæ¬¡å¾ªç¯æµ‹æ‰§è¡Œæ—¶é—´</p><p><strong>é—®é¢˜</strong></p><ul><li>è®¡æ—¶å™¨æœ¬èº«æœ‰ä¸å¯å¿½è§†çš„è¯¯å·®</li><li>ä¸èƒ½é€šè¿‡ç®€å•çš„é™¤ä»¥æµ‹è¯•æ¬¡æ•°çš„æ–¹æ³•è®¡ç®—å•æ¬¡æ‰§è¡Œæ—¶é—´(è€ƒè™‘åˆ°æç«¯æ•°æ®,æ‰§è¡Œäº‹ä»¶æ–¹å·®ç­‰). åº”è¯¥ç”¨ä¸€ç³»åˆ—ç»Ÿè®¡å­¦æ–¹æ³•è¡¡é‡æ‰§è¡Œæ—¶é—´</li><li>æŒ‡ä»¤é€šè¿‡å¾ªç¯æµ‹å¾—çš„æ‰§è¡Œæ•ˆç‡ä¸çœŸå®ç¯å¢ƒçš„æ‰§è¡Œæ•ˆç‡å¯èƒ½ä¸åŒ</li></ul><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><ul><li><span class="exturl" data-url="aHR0cHM6Ly9iZW5jaG1hcmtqcy5jb20v">Benchmark.js<i class="fa fa-external-link-alt"></i></span>:æä¾›äº†ä¸€å¥—æ€§èƒ½æ£€æµ‹æ¡†æ¶, æä¾›è¯¦ç»†çš„æµ‹è¯•ç»“æœ</li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2pzcGVyZi9qc3BlcmYuY29t">jsPerf.com<i class="fa fa-external-link-alt"></i></span>:è¯¥ç½‘ç«™æä¾›ä¸åŒ JavaScript è¿è¡Œæ—¶æ€§èƒ½æµ‹è¯•</li></ul><p><strong>ä¼˜åŒ–å“ªäº›</strong></p><ul><li><p>å…¨å±€è§†è§’: ä¸“æ³¨ä¼˜åŒ–æ‰§è¡Œé¢‘ç‡æé«˜çš„éƒ¨åˆ†</p><blockquote><p>éå…³é”®è·¯å¾„çš„ä¼˜åŒ–éƒ½æ˜¯ä¸‡æ¶ä¹‹æº</p></blockquote></li><li><p>å¾®ä¼˜åŒ–: ä¸å…³æ³¨å¾®ä¼˜åŒ–(å¦‚: <code>++a</code> ä¸ <code>a++</code>çš„åŒºåˆ«, <code>x &gt;&gt;&gt; 1</code> ä¸ <code>x/2</code> çš„åŒºåˆ«),ç¼–è¯‘å™¨ä¼šåœ¨æ‰§è¡Œå‰è‡ªåŠ¨ä¼˜åŒ–. è™½ç„¶ä¸åŒå¼•æ“ä¼˜åŒ–ä¸å°½ç›¸åŒ, ä½†æ˜¯</p><blockquote><p>æ°¸è¿œä¸è¦è§‰å¾—è‡ªå·±æ¯”å¼•æ“èªæ˜</p></blockquote><p>è¿™äº›å¾®ä¼˜åŒ–å¾ˆå¯èƒ½éšç€å¼•æ“ç§ç±»çš„ä¸åŒ, å¼•æ“ç‰ˆæœ¬çš„ä¸åŒè€Œå¤±æ•ˆ.</p></li><li><p>å°¾è°ƒç”¨ä¼˜åŒ–(TCO): ES6 çš„ä¸€ä¸ªç‰¹æ®Šä¼˜åŒ–.</p><p>å½“ä¸€ä¸ªå‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°æ—¶,å¼•æ“éœ€è¦å¼€è¾Ÿä¸€ä¸ªè€Œå¤–çš„ç©ºé—´(æ ˆå¸§)ç®¡ç†è°ƒç”¨æ ˆ.ä½†æ˜¯å¦‚æœå‡½æ•°è°ƒç”¨å‘ç”Ÿåœ¨å‡½æ•°æœ€å, é‚£ä¹ˆå¼•æ“å°±æ— éœ€å¼€è¾Ÿæ–°æ ˆå¸§,ç›´æ¥è¦†ç›–ä½¿ç”¨è€æ ˆå¸§å³å¯.</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> x<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token function">foo</span><span class="token punctuation">(</span> y <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å°¾éƒ¨è°ƒç”¨</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token function">bar</span><span class="token punctuation">(</span> <span class="token number">40</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ä¸æ˜¯å°¾éƒ¨è°ƒç”¨, å› ä¸ºè°ƒç”¨åè¿˜è¦æ‰§è¡ŒåŠ æ³•</span><span class="token punctuation">&#125;</span><span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 42</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="å›é¡¾-javascript">å›é¡¾ JavaScript</h2><ul><li><p>åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­é€šè¿‡ JavaScript è¾“å…¥å­—ç¬¦ä¸²</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> v <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">'Please input a string'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>åœ¨æ³¨é‡Šä¸­åº”è¯¥å†™çš„æ˜¯ç¨‹åºä¸ºä»€ä¹ˆæ˜¯è¿™æ ·è¿è¡Œçš„,è€Œä¸æ˜¯ç¨‹åºæ˜¯ä»€ä¹ˆ(æš´è®º)</p></li><li><p>JavaScript ä¸­é€šå¸¸ä½¿ç”¨å…¨å¤§å†™ä¹¦å†™å˜é‡å¹¶ä½¿ç”¨ <code>_</code>è¿æ¥å•è¯(æŒ‡çš„æ˜¯å¸¸é‡è€Œä¸æ˜¯ä¸å˜çš„const)</p></li><li><p><code>?:</code> è¿ç®—ç¬¦ä¸ä¸€å®šç”¨åœ¨èµ‹å€¼ä¸Š,ä½†æ˜¯è¿™è‚¯å®šæ˜¯æœ€å¸¸è§çš„</p></li><li><p>åŸºäºåŸå‹é“¾çš„ç»§æ‰¿æ–¹æ¡ˆä¸ç±»ç»§æ‰¿æ–¹æ¡ˆæ˜¯ä¸¤å¥—å®Œå…¨ä¸åŒçš„è®¾è®¡æ¨¡å¼.åŸå‹é“¾ç»§æ‰¿çš„ä¸»è¦æ€æƒ³æ˜¯å§”æ‰˜.</p></li><li><p>å…¼å®¹æ–¹æ¡ˆ</p><ul><li>polufilling: ç›´æ¥å®ç°æŸä¸ªæ–°åŠŸèƒ½API</li><li>transpliling: é€šè¿‡è½¬è¯‘å®ç°æ–°è¯­æ³•</li></ul></li></ul><h2 id="es6">ES6</h2><h3 id="è¯­æ³•-1">è¯­æ³•</h3><p><strong>Let &amp; Const</strong></p><ul><li><p>æ–°å¢ <code>let &amp; const</code> å£°æ˜,è¿™ä¿©éƒ½å…·æœ‰å—ä½œç”¨åŸŸå…¶ä¸ä¼šå‘ç”Ÿæå‡. <code>let</code>å£°æ˜ä¼šäº§ç”Ÿæš‚æ—¶æ€§æ­»åŒº(TDZ)é—®é¢˜, å»ºè®®åœ¨å—é¦–ç¬¬ä¸€è¡Œå°±ä¸€èµ·å£°æ˜<code>let</code> å˜é‡</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">;</span> <span class="token comment">//æœ€å¥½æ”¾ä¸€è¡Œ, æ–¹ä¾¿çœ‹. æš‚æ—¶æ— æ³•èµ‹å€¼çš„å°±åªå£°æ˜ä»¥è§„é¿ TDZ</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>  c <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>  d <span class="token operator">=</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åœ¨ <code>for</code> çš„æ‹¬å·ä¸­ä½¿ç”¨ <code>let</code>å£°æ˜è¿­ä»£å˜é‡ç›¸å½“äºä¸ºæ¯ä¸ªå¾ªç¯å—ä¸­å£°æ˜äº†ä¸€æ¬¡å˜é‡(è£¸ç€å¯ä»¥ç†è§£ä¸ºæ¡ä»¶éƒ¨åˆ†ä¸å¾ªç¯ä½“ä¹‹é—´æœ‰ä¸€å±‚ä½œç”¨åŸŸ)</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// ç›¸å½“äºä¸ºæ¯ä¸ªå¾ªç¯ä½“å£°æ˜äº†ä¸€ä¸ª i</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>å‡½æ•°</strong></p><ul><li><p>å‡½æ•°å®å‚éƒ¨åˆ†æœ‰è‡ªå·±çš„å—ä½œç”¨åŸŸ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> w <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> z <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token comment">// åœ¨ä½œç”¨åŸŸå†…æ‰¾ä¸åˆ° w å°±å»å…¨å±€æ‰¾</span><span class="token comment">// åœ¨ä½œç”¨åŸŸå†…æ‰¾åˆ°äº† x ä¸” x å·²ç»å£°æ˜, ä¸å­˜åœ¨ TDZ, æå®š</span><span class="token comment">// åœ¨ä½œç”¨åŸŸå†…æ‰¾åˆ°äº† z ä½†æ˜¯ z è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–, æŠ›å‡ºå¼‚å¸¸</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span> <span class="token parameter">x <span class="token operator">=</span> w <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> y <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> z <span class="token operator">=</span> z <span class="token operator">+</span> <span class="token number">1</span></span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ReferenceError</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åªæœ‰å‘å‡½æ•°å®å‚ä¼ å…¥ <code>undefined</code>(æˆ–è€…ä¸ä¼ å‚)æ‰ä¼šè§¦å‘é»˜è®¤å€¼</p></li><li><p>é»˜è®¤å€¼æ˜¯æƒ°æ€§æ±‚å€¼çš„(å¦‚æœæœ‰å‚æ•°ä¼ å…¥å°±ä¸è®¡ç®—é»˜è®¤å€¼çš„è¡¨è¾¾å¼äº†)</p></li><li><p>å¦‚æœå¸Œæœ›é»˜è®¤å€¼æ˜¯ä¸€ä¸ªç©ºå‡½æ•°å¯ä»¥ä½¿ç”¨<code>Function.prototype</code> è€Œä¸æ˜¯<code>function() &#123;&#125;</code></p></li></ul><p><strong>è§£æ„ä¸èµ‹å€¼</strong></p><ul><li><p>å¯¹è±¡è§£æ„:</p><ul><li><p>å¯¹è±¡è§£æ„ä¸å¯¹è±¡çš„è¡¨è¿°ä¸å¤ªç›¸åŒ, å¯¹è±¡çš„è¡¨è¿°æ˜¯ <code>æ ‡è¯†ç¬¦-å€¼</code>æ¨¡å¼, ä½†æ˜¯å¯¹è±¡çš„è§£æ„æ˜¯ <code>å¯¹åº”å±æ€§-ç›®æ ‡æ ‡è¯†ç¬¦</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> aa <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> bb <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">x</span><span class="token operator">:</span> aa<span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> bb <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// æ ‡è¯†ç¬¦: å€¼</span><span class="token keyword">var</span>     <span class="token punctuation">&#123;</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token constant">AA</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token constant">BB</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> o<span class="token punctuation">;</span> <span class="token comment">// å¯¹åº”å±æ€§: ç›®æ ‡æ ‡è¯†ç¬¦</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token constant">AA</span><span class="token punctuation">,</span> <span class="token constant">BB</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 10 20</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åœ¨å¯¹è±¡è§£æ„ä¸­å¦‚æœå¯¹åº”å±æ€§å’Œç›®æ ‡æ ‡è¯†ç¬¦åŒå, å¯ä»¥åªå†™ç›®æ ‡æ ‡è¯†ç¬¦</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> a<span class="token punctuation">,</span> b <span class="token punctuation">&#125;</span> <span class="token operator">=</span> o<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å®é™…ä¸Šæ˜¯</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> a<span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> b <span class="token punctuation">&#125;</span> <span class="token operator">=</span> o<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸­çœå» <code>a:</code> çš„ç»“æœ</p></li><li><p>åœ¨å¯¹è±¡è§£æ„ä¸­å¦‚æœå¯¹è±¡å‰æ²¡æœ‰å…³é”®å­—(å¦‚<code>let / var / const</code>)å°±éœ€è¦ä¸ºåŠ ä¸€å±‚<code>()</code>é˜²æ­¢å°†å¯¹è±¡è§£æä¸ºä»£ç å—</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> a<span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> b <span class="token punctuation">&#125;</span> <span class="token operator">=</span> o<span class="token punctuation">;</span> <span class="token comment">// æ­£å¸¸ç‰ˆæœ¬</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> a<span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> b <span class="token punctuation">&#125;</span> <span class="token operator">=</span> o<span class="token punctuation">;</span> <span class="token comment">// &#123;&#125; ä¼šè¢«è§£æä¸ºä»£ç å¿«</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> a<span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> b <span class="token punctuation">&#125;</span> <span class="token operator">=</span> o<span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token comment">// ok</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¯¹è±¡è§£æ„æ—¶å…è®¸å‡ºç°è®¡ç®—å±æ€§</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> t <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> k <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token operator">:</span> t<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å‰è€…æ˜¯è®¡ç®—å±æ€§, åè€…åªæ˜¯å±æ€§è®¿é—®</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; a: 1, b: 2, c: 3 &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ”¯æŒé‡å¤èµ‹å€¼</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> na<span class="token punctuation">,</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">b</span><span class="token operator">:</span> nb<span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> nc <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span> <span class="token operator">=</span> o<span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>na<span class="token punctuation">,</span> nb<span class="token punctuation">,</span> nc<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; b: 1, c: 2 &#125; 1 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ”¯æŒè¿ç¯èµ‹å€¼, ç”±äºèµ‹å€¼çš„ç»“æœå€¼æ˜¯åŸå€¼,æ‰€ä»¥æ”¯æŒåœ¨é“¾ä¸Šä¸å®Œå…¨è§£æ„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> a1<span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> b1 <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> a2<span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> c2 <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">b</span><span class="token operator">:</span> b3<span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> c3 <span class="token punctuation">&#125;</span> <span class="token operator">=</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> b1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> b3<span class="token punctuation">,</span> c3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0 1 0 2 1 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¯¹è±¡è§£æ„é»˜è®¤å€¼</p><p>å°±æ˜¯åœ¨ç›®æ ‡æ ‡è¯†ç¬¦åé¢åŠ ä¸Š <code>= x</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token literal-property property">w</span><span class="token operator">:</span> <span class="token constant">WW</span> <span class="token operator">=</span> <span class="token number">20</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> z <span class="token operator">=</span> <span class="token number">6</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token constant">WW</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 4 5 6 20</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åŒæ—¶ç”±äºç®€åŒ–å¯¹è±¡è§£æ„æ˜¯ç®€åŒ–äº†å‰åŠéƒ¨åˆ† <code>x:</code> æ‰€ä»¥æ”¯æŒç®€å†™</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token punctuation">[</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">,</span> d <span class="token operator">=</span> <span class="token number">12</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token keyword">var</span> <span class="token punctuation">&#123;</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> z <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">,</span> w <span class="token operator">=</span> <span class="token number">20</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> z <span class="token operator">=</span> <span class="token number">6</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä½†æ˜¯ä¸è¦è¿‡åº¦ä¾èµ–, ä¼šä¸¥é‡é™ä½å¯è¯»æ€§</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">,</span> z <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span><span class="token keyword">var</span> o1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token literal-property property">z</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">y</span><span class="token operator">:</span> z <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">(</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">y</span><span class="token operator">:</span> x <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">y</span><span class="token operator">:</span> y <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> o1 <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">(</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">z</span><span class="token operator">:</span> y <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">y</span><span class="token operator">:</span> z <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> o1 <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">(</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">x</span><span class="token operator">:</span> z <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">y</span><span class="token operator">:</span> x <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> o1 <span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> x<span class="token punctuation">.</span>y<span class="token punctuation">,</span> y<span class="token punctuation">.</span>y<span class="token punctuation">,</span> z<span class="token punctuation">.</span>y <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 300 100 42</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>æ•°ç»„è§£æ„</p><ul><li><p>æ”¯æŒéƒ¨åˆ†èµ‹å€¼</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> <span class="token punctuation">,</span> b<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>æ•°ç»„ / å¯¹è±¡è§£æ„æ”¯æŒåµŒå¥—</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> o1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">z</span><span class="token operator">:</span> <span class="token number">6</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">var</span> <span class="token punctuation">[</span> a<span class="token punctuation">,</span> <span class="token punctuation">[</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d <span class="token punctuation">]</span><span class="token punctuation">,</span> e <span class="token punctuation">]</span> <span class="token operator">=</span> a1<span class="token punctuation">;</span><span class="token keyword">var</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">z</span><span class="token operator">:</span> w <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> o1<span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 2 3 4 5</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> w <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>å¯¹è±¡</strong></p><ul><li><p>ç®€æ´å±æ€§(å½“å±æ€§ä¸å˜é‡åŒå)</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    x<span class="token punctuation">,</span>    y<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç®€æ´æ–¹æ³•</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ..</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token operator">*</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// ç”Ÿæˆå™¨</span>    <span class="token comment">// ..</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ç§ç®€æ´æ–¹æ³•ç›¸å½“äºæ˜¯</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function-variable function">x</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ..</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function-variable function">y</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ..</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¸¦æ¥çš„åæœå°±æ˜¯å¯¹è±¡ä¸­çš„æ–¹æ³•å˜æˆäº†åŒ¿åå‡½æ•°, è¿™ä¸åˆ©äºå†…éƒ¨å¯¹æ–¹æ³•å¼•ç”¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">runSomething</span><span class="token punctuation">(</span> <span class="token punctuation">&#123;</span> <span class="token function">something</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">></span> y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token keyword">return</span> <span class="token function">something</span><span class="token punctuation">(</span> y<span class="token punctuation">,</span> x <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> y <span class="token operator">-</span> x<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">runSomething</span><span class="token punctuation">(</span> <span class="token punctuation">&#123;</span> <span class="token function-variable function">something</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">something</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">></span> y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token keyword">return</span> <span class="token function">something</span><span class="token punctuation">(</span> y<span class="token punctuation">,</span> x <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok, å› ä¸ºæœ‰å—ä½œç”¨åŸŸ</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> y <span class="token operator">-</span> x<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç®€æ´ <code>getter &amp; setter</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">__id</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">get</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__id<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">set</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__id <span class="token operator">=</span> v<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>supper</code></p><p>ä¸æ­¢ <code>class</code> æ”¯æŒ <code>supper</code>, å¯¹è±¡ä¹Ÿå¯ä»¥ä½¿ç”¨<code>supper</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> o1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">'FA'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> o2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">'SON'</span><span class="token punctuation">,</span>  <span class="token comment">// na: super.a // ğŸ‘, supper ä¸èƒ½ç”¨äºå±æ€§å£°æ˜æ—¶</span>  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span>o2<span class="token punctuation">,</span> o1<span class="token punctuation">)</span><span class="token punctuation">;</span>o2<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SON FA</span><span class="token comment">// console.log(o2.super.a); // ğŸ‘, supper ä¸èƒ½ç”¨äºå±æ€§è®¿é—®</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>æ¨¡æ¿å­—ç¬¦ä¸²</strong></p><ul><li><p>åœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¸­, é™¤éå‡ºç°è½¬ä¹‰, <code>\n, \r, \r\n</code>éƒ½ä¼šè¢«è½¬ä¸º <code>\n</code></p></li><li><p>æ¨¡æ¿å­—ç¬¦ä¸²æ²¡æœ‰è‡ªå·±çš„åŠ¨æ€ä½œç”¨åŸŸ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hi, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token punctuation">(</span>a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>æ¨¡æ¿å­—ç¬¦ä¸²çš„æ ‡ç­¾å‡½æ•°(<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvVGVtcGxhdGVfbGl0ZXJhbHMjJUU1JUI4JUE2JUU2JUEwJTg3JUU3JUFEJUJFJUU3JTlBJTg0JUU2JUE4JUExJUU2JTlEJUJGJUU1JUFEJTk3JUU3JUFDJUE2JUU0JUI4JUIy">MDN<i class="fa fa-external-link-alt"></i></span>)</p><p>å¯ä»¥åœ¨æ¨¡æ¿å­—ç¬¦ä¸²å‰é¢åŠ ä¸€ä¸ªå‡½æ•°å, è¿™æ ·æ¨¡æ¿å­—ç¬¦ä¸²ä¼šä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°,å‡½æ•°çš„è¿”å›ç»“æœä½œä¸ºæ¨¡æ¿å­—ç¬¦ä¸²çš„ç»“æœ. å‚æ•°ä¼ å…¥çš„å½¢å¼æ¯”è¾ƒç‰¹æ®Š.ä¼ å…¥ä¸¤ä¸ªæ•°ç»„, ç¬¬ä¸€ä¸ªæ•°ç»„åŒ…å«ä¸º <code>$&#123;&#125;</code> çš„å†…å®¹, å°†<code>$&#123;&#125;</code> ä½œä¸ºåˆ†éš”ç¬¦å°†å­—ç¬¦ä¸²åˆ†å¼€, ç¬¬äºŒä¸ªæ•°ç»„åŒ…å«æ‰€æœ‰<code>$&#123;&#125;</code> ä¼ å…¥çš„å†…å®¹</p><p>ç®€å•çš„å®ç°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">tag</span><span class="token punctuation">(</span><span class="token parameter">strings<span class="token punctuation">,</span> <span class="token operator">...</span>values</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> strings<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">s<span class="token punctuation">,</span> v<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> s <span class="token operator">+</span> <span class="token punctuation">(</span>idx <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> values<span class="token punctuation">[</span>idx <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span> v<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> desc <span class="token operator">=</span> <span class="token string">'awesome'</span><span class="token punctuation">;</span><span class="token keyword">var</span> text <span class="token operator">=</span> tag<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Everything is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>desc<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Everything is awesome!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°†æ¨¡æ¿å­—ç¬¦ä¸²ä¸­æ’å…¥çš„æ‰€æœ‰æ•°å­—å‰åŠ ä¸Š <code>$</code> å¹¶ä¿ç•™ä¸¤ä½å°æ•°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">dollabillsyall</span><span class="token punctuation">(</span><span class="token parameter">strings<span class="token punctuation">,</span> <span class="token operator">...</span>values</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> strings<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">s<span class="token punctuation">,</span>v<span class="token punctuation">,</span>idx</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>idx <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> values<span class="token punctuation">[</span>idx<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"number"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// çœ‹ï¼Œä¹Ÿä½¿ç”¨æ’å€¼æ€§å­—ç¬¦ä¸²å­—é¢é‡ï¼</span>    s <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>values<span class="token punctuation">[</span>idx<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span> <span class="token number">2</span> <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    s <span class="token operator">+=</span> values<span class="token punctuation">[</span>idx<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> s <span class="token operator">+</span> v<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">""</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> amt1 <span class="token operator">=</span> <span class="token number">11.99</span><span class="token punctuation">,</span> amt2 <span class="token operator">=</span> amt1 <span class="token operator">*</span> <span class="token number">1.08</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"Kyle"</span><span class="token punctuation">;</span><span class="token keyword">var</span> text <span class="token operator">=</span> dollabillsyall<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Thanks for your purchase, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">! Yourproduct cost was </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>amt1<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">, which with taxcomes out to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>amt2<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> text <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Thanks for your purchase, Kyle! Your</span><span class="token comment">// product cost was $11.99, which with tax</span><span class="token comment">// comes out to $12.95.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ¨¡æ¿å­—ç¬¦ä¸²å‡½æ•°ä¸­çš„ <code>raw</code></p><p>ç±»ä¼¼äº HTML ä¸­çš„ <code>pre</code> æ ‡ç­¾</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">showraw</span><span class="token punctuation">(</span><span class="token parameter">strings<span class="token punctuation">,</span> <span class="token operator">...</span>values</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>strings<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span>raw<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>showraw<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello\nWorld</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><span class="token comment">// [ "Hello</span><span class="token comment">// World" ]</span><span class="token comment">// [ "Hello\nWorld" ]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>ç®­å¤´å‡½æ•°</strong></p><ul><li>ç®­å¤´å‡½æ•°: ä¸€èˆ¬ç”¨äºçŸ­å°çš„, ä¸éœ€è¦è‡ªå·±ä½œç”¨åŸŸçš„åŒ¿åå‡½æ•°(æ— éœ€ç»‘å®š, ç›‘å¬,é€’å½’).</li><li>ç®­å¤´å‡½æ•°æœ‰è‡ªå·±çš„ä½œç”¨åŸŸ, ä½†æ˜¯çˆ¶ä½œç”¨åŸŸä¸å£°æ˜æ—¶çš„ä½œç”¨åŸŸç»‘å®š.ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ <code>this</code>, <code>arguments</code>,<code>super</code>, <code>new.target</code> å‡ä»çˆ¶ä½œç”¨åŸŸç»§æ‰¿</li></ul><p><strong>è¿­ä»£å™¨</strong></p><ul><li><p>JavaScript ä¸­é»˜è®¤å¯è¿­ä»£çš„å¯¹è±¡æœ‰</p><ul><li>Array</li><li>String</li><li>ç”Ÿæˆå™¨</li><li>Collections &amp; TypedArrays</li></ul></li><li><p><code>for...of</code> å¯ä»¥è¿­ä»£å¯è¿­ä»£å¯¹è±¡</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span>a <span class="token keyword">of</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> o<span class="token punctuation">.</span>a <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 1 2 3</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">x</span><span class="token operator">:</span> o<span class="token punctuation">.</span>a<span class="token punctuation">&#125;</span> <span class="token keyword">of</span> <span class="token punctuation">[</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">&#125;</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> o<span class="token punctuation">.</span>a <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 1 2 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>æ­£åˆ™è¡¨è¾¾å¼</strong></p><ul><li><p>Unicode</p><p>Unicode å­—ç¬¦å¯ä»¥åˆ†ä¸ºBMP(åŸºæœ¬å¤šè¯­è¨€å¹³é¢)éƒ¨åˆ†(0x000000-0x00ffff)ä¸å…¶ä»–éƒ¨åˆ†(0x00ffff-0x10ffff).åœ¨ ES6 ä¹‹å‰, æ­£åˆ™åªèƒ½åŒ¹é… BMP éƒ¨åˆ†çš„å†…å®¹, é BMPéƒ¨åˆ†çš„å­—ç¬¦ä¼šè¢«åŒ¹é…ä¸ºå¤šä¸ª BMP å­—ç¬¦</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token string">'ğŸ‘ğŸ‘ğŸ‘'</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^ğŸ‘.ğŸ‘$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false å°†ä¸€ä¸ª ğŸ‘ è§£æä¸ºä¸¤ä¸ªå­—ç¬¦æ‰€ä»¥ . å¤±æ•ˆäº†</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^ğŸ‘.&#123;2&#125;ğŸ‘$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^ğŸ‘.ğŸ‘$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true åŠ ä¸Š u åæ”¯æŒè§£æ Unicode é BMP éƒ¨åˆ†</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^ğŸ‘.&#123;2&#125;ğŸ‘$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ”¯æŒ Unicode åè¿˜å¯ä»¥ç”¨è¿™ç§æ“ä½œ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token string">'ğŸ‘ğŸ»'</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[ğŸ‘-ğŸ‘ğŸ¼]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>å®šç‚¹æ ‡è¯†(é»æ»æ ‡è¯†)</p><p>å®šç‚¹æ ‡è¯†(<code>lastIndex</code>)å¯ä»¥æŒ‡å®šä»å“ªä¸€ä½å¼€å§‹æ­£åˆ™åŒ¹é…(å¿…é¡»ä»è¿™ä¸€ä½å¼€å§‹).</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> re <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">foo</span><span class="token regex-delimiter">/</span><span class="token regex-flags">y</span></span><span class="token punctuation">;</span> <span class="token comment">// ä½¿ç”¨ y å¼€å¯å®šç‚¹æ ‡è¯†</span>str <span class="token operator">=</span> <span class="token string">'abcfooabc'</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é»˜è®¤æ˜¯0</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false: è®©ç¬¬0ä½ a ä½œä¸ºå¼€å¤´åŒ¹é…å¤±è´¥</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç”±äºåŒ¹é…å¤±è´¥å˜ä¸º0</span>re<span class="token punctuation">.</span>lastIndex <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true: è®©ç¬¬3ä½ f ä½œä¸ºå¼€å¤´åŒ¹é…æˆåŠŸ</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åŒ¹é…æˆåŠŸå lastIndex åŒ¹é…éƒ¨åˆ†æœ€åä¸€ä½çš„ä¸‹ä¸€ä½ 6</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false: è®©ç¬¬6ä½ a ä½œä¸ºå¼€å¤´åŒ¹é…å¤±è´¥</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç”±äºåŒ¹é…å¤±è´¥å˜ä¸º0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨å°† <code>lastIndex</code> è®¾ç½®åˆ°æŒ‡å®šçš„ä½ç½®,æˆ–åœ¨æ¯æ¬¡åŒ¹é…æˆåŠŸåè‡ªåŠ¨ä¿®æ”¹ä½ç½®. è¿™ç©æ„çœ‹èµ·æ¥æ²¡ä»€ä¹ˆç”¨.å¸¸è§„çš„ä½¿ç”¨åœºæ™¯æœ‰</p><ul><li><p>è¦æ±‚æ¯è‹¥å¹²ä½ç½®å‡ºç°ä¸€æ¬¡åŒ¹é…ä¸²</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> re <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[0-9]+\.[^ ]+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">y</span></span><span class="token punctuation">;</span> <span class="token comment">// ä½¿ç”¨ y å¼€å¯å®šç‚¹æ ‡è¯†</span>str <span class="token operator">=</span> <span class="token string">'1.ä½ å¥½, æˆ‘æ˜¯ABC    2.Hello, IM A  3.HI'</span><span class="token punctuation">;</span><span class="token comment">// æµ‹è¯•æ¯15ä½å‡ºç°ä¸€æ¬¡ x.ä¸€æ®µæ–‡å­—</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">15</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  re<span class="token punctuation">.</span>lastIndex <span class="token operator">=</span> i<span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å·²çŸ¥åŒ¹é…ä¸²çš„å›ºå®šæ¨¡å¼ç”± JavaScript è‡ªåŠ¨æ›´æ–°<code>lastIndex</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> re <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[0-9]+\.[^0-9]+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">y</span></span><span class="token punctuation">;</span> <span class="token comment">// ä½¿ç”¨ y å¼€å¯å®šç‚¹æ ‡è¯†</span>str <span class="token operator">=</span> <span class="token string">'1.ä½ å¥½, æˆ‘æ˜¯ABC          2.Hello, IM A     3.HI'</span><span class="token punctuation">;</span><span class="token comment">// æµ‹è¯•æ–‡æœ¬ç¬¦åˆ x.ä¸€æ®µæ–‡å­— çš„æ¨¡å¼å¹¶è·å¾—æ¯æ¬¡æ¨¡å¼å¼€å¤´çš„ä¸‹æ ‡</span><span class="token keyword">while</span> <span class="token punctuation">(</span>re<span class="token punctuation">.</span>lastIndex <span class="token operator">&lt;</span> str<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// true 21 true 39 true 43</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>æ³¨æ„</strong>: è‹¥æ­£åˆ™ä½¿ç”¨äº† <code>^</code> è€Œå®šç‚¹æ ‡è¯†çš„<code>lastIndex !== 0</code> é‚£å¿…å®šåŒ¹é…å¤±è´¥</p></li><li><p>flags</p><ul><li><code>g</code>: å…¨å±€åŒ¹é…</li><li><code>i</code>: å¿½ç•¥å¤§å°å†™</li><li><code>m</code>: æ”¯æŒå¤šè¡Œæ¨¡å¼(æ­¤æ—¶ <code>^</code> ä¸ <code>$</code>æ—¢è¡¨ç¤ºè¡Œå§‹æœ«ä¹Ÿè¡¨ç¤ºæ–‡æœ¬å§‹æœ«)</li><li><code>u</code>: æ”¯æŒ Unicode é BMP åŒºåŸŸå­—ç¬¦</li><li><code>y</code>: æ”¯æŒå®šç‚¹æ ‡è¯†</li></ul></li></ul><p><strong>Unicode</strong></p><ul><li>Unicode çš„è¡¨ç¤º<ul><li>ES6 ä¹‹å‰: ä½¿ç”¨ <code>"\uxxxx"</code> ä½†æ˜¯åªæ”¯æŒ BMP éƒ¨åˆ†å­—ç¬¦</li><li>ES6 çš„ Unicode è½¬ä¹‰: <code>"\u&#123;1-ffff&#125;"</code> æ”¯æŒå…¨éƒ¨ Unicodeå­—ç¬¦</li></ul></li></ul><p><strong>Symbol</strong></p><ul><li><p>ä½¿ç”¨ <code>symbol(string)</code> å³å¯å£°æ˜ Symbol(æ— éœ€<code>new</code>)</p></li><li><p><code>Symbol.toString</code> çš„ç»“æœä¸º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'hihi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Symbol(hihi)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>å¯ä»¥é€šè¿‡ <code>Symbol.for</code> å°†ä¸€ä¸ª Symbol æ³¨å†Œä¸ºå…¨å±€ç¬¦å·.<code>Symbol.for</code> ç›¸å½“äºä¸€ä¸ªå•ä¾‹æ„é€ å‡½æ•° API.è‹¥æ„é€ ç”¨å­—ç¬¦ä¸²ä»æœªè¢«æ³¨å†Œåˆ™ä¼šæ„é€ å¹¶è¿”å› Symbol. è‹¥å·²ç»æ³¨å†Œ, åˆ™ç›´æ¥è¿”å›Symbol(å‰ææ˜¯å¿…é¡»ç”¨ <code>Symbol.for</code> åˆ›å»º)</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> s1 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'ruru'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> s2 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'ruru'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s1 <span class="token operator">===</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><span class="token keyword">const</span> s3 <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'hihi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> s4 <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'hihi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s3 <span class="token operator">===</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>Symbol.keyfor</code> å¯ä»¥è·å– <code>Symbol.for</code> æ³¨å†ŒSymbol çš„æè¿°å­—ç¬¦ä¸²</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> s1 <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'ruru'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">.</span><span class="token function">keyFor</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ruru</span><span class="token keyword">const</span> s2 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'hihi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">.</span><span class="token function">keyFor</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å½“ Symbol ä½œä¸ºå¯¹è±¡å±æ€§æ—¶, æ— æ³•é€šè¿‡<code>Object.key / Object.getOwnPropertyNames</code> è·å–, å¯ä»¥é€šè¿‡<code>Object.getOwnPropertySymbols</code> è·å–</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">a1</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token punctuation">[</span><span class="token string">'c'</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token punctuation">[</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'hihi'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; a1: 1, c1: 2, [Symbol(hihi)]: 3 &#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 'a1', 'c1' ]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 'a1', 'c1' ]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertySymbols</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ Symbol(hihi) ]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="ä»£ç ç»„ç»‡">ä»£ç ç»„ç»‡</h3><p><strong>è¿­ä»£å™¨</strong></p><ul><li><p>æ¥å£</p><ul><li><p><code>next</code> å‡½æ•°[å¿…é¡»å®ç°]: è¿”å›ä¸€ä¸ª<code>&#123;value:, done: boolean&#125;</code></p></li><li><p><code>return</code> å‡½æ•°[å¯é€‰å®ç°]: è¿”å›ä¸€ä¸ª<code>&#123;value:, done: boolean&#125;</code>, ç”¨æ¥ç»“æŸè¿­ä»£å™¨,å¹¶å®Œæˆä»£ç æ¸…ç†å·¥ä½œ</p></li><li><p><code>throw</code> å‡½æ•°[å¯é€‰å®ç°]: è¿”å›ä¸€ä¸ª<code>&#123;value:, done: boolean&#125;</code>,ç”¨æ¥é€šè¿‡å¼‚å¸¸çš„æ–¹å¼ç»“æŸè¿­ä»£å™¨å¹¶è°ƒç”¨å¹¶å®Œæˆä»£ç æ¸…ç†å·¥ä½œ</p><p>è‹¥æ˜¯è°ƒç”¨ç”Ÿæˆå™¨çš„ <code>throw</code>ç›¸å½“äºæ˜¯åœ¨ç”Ÿæˆå™¨å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸Šæ’å…¥ä¸€ä¸ªé”™è¯¯, ç»“æŸè¿­ä»£å™¨.</p></li><li><p><code>[Symbol.iterator]</code> å‡½æ•°[å¯é€‰å®ç°]:è¿”å›ä¸€ä¸ªè¿­ä»£å™¨</p></li></ul></li><li><p>è‡ªå®šä¹‰è¿­ä»£å™¨: åªéœ€è¦è¿”å›ä¸€ä¸ª <code>thenable</code> çš„å¯¹è±¡å³å¯</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> Fib <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> n1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> n2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>   <span class="token comment">// ä½¿è¿­ä»£å™¨æˆä¸ºä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡</span>   <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>   <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> current <span class="token operator">=</span> n2<span class="token punctuation">;</span>    n2 <span class="token operator">=</span> n1<span class="token punctuation">;</span>    n1 <span class="token operator">=</span> n1 <span class="token operator">+</span> current<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> current<span class="token punctuation">,</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>   <span class="token keyword">return</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>     <span class="token string">"Fibonacci sequence abandoned."</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> v<span class="token punctuation">,</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> v <span class="token keyword">of</span> Fib<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> v <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">></span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 1 1 2 3 5 8 13 21 34 55</span><span class="token comment">// Fibonacci sequence abandoned.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>è¿­ä»£å™¨ç›¸å…³ API</p><p><code>...</code> &amp; <code>for...of</code> &amp;æ•°ç»„è§£æ„(ä¸èƒ½æ˜¯æ™®é€šå¯¹è±¡) éƒ½éœ€è¦æ¶ˆè€—è¿­ä»£å™¨ç”Ÿæˆåºåˆ—</p></li></ul><p><strong>ç”Ÿæˆå™¨</strong></p><ul><li><p>yield çš„ä¼˜å…ˆçº§ä¸ <code>=</code> åŸºæœ¬ç›¸åŒ, <code>yield</code>æ—¶æ³¨æ„åŠ  <code>()</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// åˆæ³•</span>b <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">+</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// ä¸åˆæ³•</span>b <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span>a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆæ³•</span><span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// åˆæ³•</span>a <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// ä¸åˆæ³•</span>a <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆæ³•</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>yield</code> å§”æ‰˜è¿”å›åä¼šè‡ªåŠ¨ <code>next</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    x <span class="token operator">=</span> <span class="token keyword">yield</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: 24, done: true &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>yield</code> ä¸ <code>next</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1. å…ˆæ„é€ ç”Ÿæˆå™¨, ä½†æ˜¯ä¸æ‰§è¡Œ</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2. ä¼ å…¥ 'A' å¯æƒœæ²¡ä¸œè¥¿æ¥æ”¶, æ‰§è¡Œåˆ° yield æš‚åœ, è¿”å› 1, è¾“å‡º 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3. è½¬å…¥ 'B' è¢« console.log æ¥æ”¶, æ‰§è¡Œåˆ°ç¬¬2ä¸ª yield æš‚åœ, è¿”å› 2, è¾“å‡º 2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3. è½¬å…¥ 'C' è¢« console.log æ¥æ”¶, æ‰§è¡Œåˆ°ç¬¬3ä¸ª yield æš‚åœ, è¿”å› 3, è¾“å‡º 3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'D'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3. è½¬å…¥ 'D' è¢« console.log æ¥æ”¶, æ‰§è¡Œç»“æŸ, è¿”å› done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨æ‰§è¡Œ <code>next</code> æ—¶: å…ˆä¼ å…¥, å†æš‚åœ, æœ€åè¿”å›.<strong>å¯¹äºåŒä¸€ä¸ª <code>yield</code>, ä¼ å…¥å‚æ•°çš„ <code>next</code>ä¸è¿”å›å‚æ•°çš„ <code>next</code> ä¸åŒ!</strong>.</p><p>åŒæ—¶æ³¨æ„: åœ¨ç¬¬ä¸‰ä¸ª <code>next</code> æ‰§è¡Œç»“æŸåè™½ç„¶æ²¡æœ‰<code>yield</code> äº†, ä½†æ˜¯ä»ç„¶ä¸è¿”å› <code>&#123;done: true&#125;</code>,è¿™æ˜¯å› ä¸º <code>for...of</code> è¯­å¥åœ¨é‡åˆ° <code>&#123;done: true&#125;</code>åä¼šç«‹é©¬åœæ­¢(è¿™æ˜¯ä¹¦ä¸Šçš„è¯´æ³•, æˆ‘è§‰å¾—ä¸å¯¹, ä¸ºäº†ç¢Ÿé†‹åŒ…é¥ºå­è¡Œä¸º)</p></li><li><p>è°ƒç”¨ç”Ÿæˆå™¨ä¸Šè¿­ä»£å™¨çš„ <code>throw</code> ç›¸å½“äºä¸ºä¸Šä¸‹æ–‡åŠ å…¥ Error,ç”¨ <code>try...catch</code> å¯ä»¥æ•è·</p></li></ul><p><strong>æ¨¡å—</strong></p><ul><li><p>ES6 ä¹‹å‰çš„æ¨¡å—: é€šè¿‡å‡½æ•°ä¸é—­åŒ…å®ç°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Hello</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">function</span> <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello '</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">greeting</span><span class="token operator">:</span> greeting<span class="token punctuation">,</span> <span class="token comment">// éœ€è¦æš´éœ²çš„API</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> me <span class="token operator">=</span> <span class="token function">Hello</span><span class="token punctuation">(</span><span class="token string">'Kyle'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>me<span class="token punctuation">.</span><span class="token function">greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hello Kyle!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿˜æœ‰ AMD, CMD ç­‰å„ç§å…¼å®¹æ–¹æ¡ˆ</p></li><li><p>ES6 æ¨¡å—ç‰¹æ€§</p><ul><li><p>æ¨¡å—åŸºäºæ–‡ä»¶: ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªæ¨¡å—,æš‚æ—¶æ— æ³•åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­æ”¾å¤šæ¨¡å—</p></li><li><p>æ¨¡å—æ˜¯å•ä¾‹çš„: å®ä¾‹åªæœ‰ä¸€ä¸ª, å¤šä¸ªæ¨¡å—å¯¼å…¥åŒä¸€ä¸ªæ¨¡å—,è¯¥æ¨¡å—è¢«å¤šæ¨¡å—å…±äº«(å¦‚æœä¸æƒ³å…±äº«, å¯ä»¥è€ƒè™‘æä¸€ä¸ªå·¥å‚å‡½æ•°)</p><ul><li><p><code>/index.js</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token string">'./mod1.js'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'./mod2.js'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> o <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./mod3.js'</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123;a: 2&#125;, æ‰€æœ‰æ¨¡å—å¼•å…¥çš„éƒ½æ˜¯ä¸€ä¸ªå®ä¾‹</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>/mod1.js</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> o <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./mod3.js'</span><span class="token punctuation">;</span>o<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>/mod2.js</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> o <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./mod3.js'</span><span class="token punctuation">;</span>o<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>/mod3.js</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>æ¨¡å—æ˜¯é™æ€å®šä¹‰çš„: è¿™æ„å‘³ç€åœ¨ç½‘ç»œè¯·æ±‚æ¨¡å—æ—¶å¯ä»¥é¢„åŠ è½½</p></li><li><p>å¯¼å…¥å£°æ˜åªèƒ½åœ¨æ¨¡å—çš„é¡¶å±‚ä½¿ç”¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> o <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./mod3'</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ‘</span><span class="token keyword">function</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> o <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./mod3'</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ‘</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>è‡ªåŠ¨æå‡: æ‰€æœ‰å¯¼å…¥çš„å¯¹è±¡ä¼šè‡ªåŠ¨æå‡åˆ°é¡¶å±‚ä½œç”¨åŸŸæœ€å‰é¢</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [Function: foo]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> foo<span class="token punctuation">,</span> bar <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./mod3.js'</span><span class="token punctuation">;</span> <span class="token comment">// ä¸è®ºæ˜¯å¯¼å…¥çš„å‡½æ•°è¿˜æ˜¯å˜é‡, éƒ½ä¼šæå‡</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>æ”¯æŒå¾ªç¯ä¾èµ–</p><p>JavaScript æ‰§è¡Œæ¨¡å—çš„è¿‡ç¨‹: æ‰“å¼€æ–‡ä»¶ - æ‰«ææ–‡ä»¶çš„æ‰€æœ‰å¯¼å‡ºå¹¶è®°å½•å¯¼å‡ºé¡¹- æ‰«ææ–‡ä»¶çš„æ‰€æœ‰å¯¼å…¥ - å¯¹äºæ¯ä¸ªå¯¼å…¥, ä»¥åŒæ ·çš„æ¨¡å¼æ‰«ææ¯ä¸ªå¯¼å…¥æ–‡ä»¶</p><p>å¯¹äºå¾ªç¯ä¾èµ–: è®¾æ¨¡å— A è¢«é¦–å…ˆåŠ è½½, ç»è¿‡ä¸Šè¿°æ‰«æ, æ›´å…·åŠ è½½æŒ‡ä»¤åŠ è½½æ¨¡å—B å¹¶åšåŒæ ·çš„æ‰«æåˆ†æ. çœ‹åˆ° B åŠ è½½ A æ—¶å‘ç° A ä»¥åŠæ‰«æè¿‡,ç›´æ¥æ ‡æ³¨è¿™ä¸ªå¯¼å…¥åˆæ³•</p><ul><li><p><code>mod1.js</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> foo <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./mod2.js'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'IM MOD 1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>mod2.js</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> bar <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./mod1.js'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'IM MOD 2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul></li><li><p>å¯¼å‡ºæ¨¡å—</p><p>æœ‰ä¸¤ç§å¯¼å‡ºæ–¹å¼</p><ul><li><p>å‘½åå¯¼å‡º: å°†æ¨¡å—ä¸<strong>å˜é‡æœ¬èº«</strong>ç»‘å®š,å¯¼å‡ºçš„æ˜¯å˜é‡çš„å¼•ç”¨(æˆ–æŒ‡é’ˆ). <strong>è¿™æ„å‘³ç€åœ¨å¯¼å‡ºåè‹¥ä¿®æ”¹å˜é‡çš„å€¼,å¯¼å‡ºçš„å˜é‡ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–</strong></p><ul><li><p>ä¸€ä¸ªä¸€ä¸ªå¯¼å‡º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token comment">// éœ€è¦å¯¼å‡º o å°±åœ¨å‰é¢åŠ ä¸ª export</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ‰¹é‡å¯¼å‡º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token punctuation">&#123;</span> o<span class="token punctuation">,</span> a <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// å°†éœ€è¦å¯¼å‡ºçš„å†…å®¹å†™å…¥ä¸€ä¸ªæ‹¬å·å†….</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„: è¿™ä¸ªæ‹¬å·åªæ˜¯è¯­æ³•, ä¸æ˜¯å¯¹è±¡,<strong>ä¸æ˜¯å¯¼å‡ºäº†ä¸€ä¸ªåŒ¿åå¯¹è±¡</strong></p></li><li><p>å¯¼å‡ºå¹¶é‡å‘½å</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token punctuation">&#123;</span>  o <span class="token keyword">as</span> q<span class="token punctuation">,</span> <span class="token comment">// å¯¼å‡ºçš„å°±åªæœ‰ q æ²¡æœ‰ o äº†, ä½†æ˜¯ q å°±æ˜¯ o çš„æŒ‡é’ˆ</span>  a<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>é»˜è®¤å¯¼å‡º: å°†æ¨¡å—ä¸<strong>å€¼</strong>ç»‘å®š, å¯¼å‡ºçš„æ˜¯å€¼,ä¸å¯¼å‡ºå˜é‡å. <strong>è¿™æ„å‘³ç€åœ¨å¯¼å‡ºåè‹¥ä¿®æ”¹å˜é‡çš„å€¼,å¯¼å‡ºçš„å€¼ä¹Ÿä¸ä¼šå˜åŒ–</strong>. é»˜è®¤å¯¼å‡ºåªèƒ½ç»‘å®šä¸€ä¸ªå€¼</p><ul><li><p>ä¸€èˆ¬å†™æ³•</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> o<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å‘½åå¯¼å‡ºä¸é»˜è®¤å¯¼å‡ºåŒæ—¶å¯¼å‡º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åœ¨æ‰¹é‡å‘½åå¯¼å‡ºæ—¶æŒ‡å®šä¸€ä¸ªå€¼é»˜è®¤å¯¼å‡º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token punctuation">&#123;</span>  o<span class="token punctuation">,</span>  a <span class="token keyword">as</span> <span class="token keyword">default</span> <span class="token comment">// ç›¸å½“äºé»˜è®¤å¯¼å‡ºå€¼ 1, å‘½åå¯¼å‡º o</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ä¸è¦å›¾æ–¹ä¾¿å°†æ‰€æœ‰éœ€è¦å¯¼å‡ºçš„å˜é‡é»˜è®¤å¯¼å‡º, è¿™ä¼šå¯¼è‡´ JavaScriptæ— æ³•åšé™æ€åˆ†æ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span> <span class="token comment">// ğŸ‘</span>  <span class="token literal-property property">s</span><span class="token operator">:</span> a<span class="token punctuation">,</span>  b<span class="token punctuation">,</span>  c<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¯¼å…¥åŒæ—¶å¯¼å‡º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./mod.js'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç›¸å½“äºä» <code>/mod.js</code> å¯¼å…¥æ‰€æœ‰å‘½åå¯¼å‡º, ç„¶åå†å¯¼å‡º. æ­¤æ—¶<code>/mod.js</code> ä¸­çš„å‘½åå¯¼å‡ºä¸ä¼šè¢«å¯¼å…¥, ä¼šç›´æ¥å¯¼å‡º</p></li></ul></li></ul></li><li><p>å¯¼å…¥æ¨¡å—</p><p>ä¸¤ç§å¯¼å‡ºæ–¹å¼å¯¹åº”ä¸¤ç§å¯¼å…¥æ–¹å¼</p><ul><li><p>å¯¼å…¥é»˜è®¤å¯¼å‡ºçš„å€¼</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> s <span class="token keyword">from</span> <span class="token string">'./mod.js'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é»˜è®¤å¯¼å…¥çš„æ˜¯å€¼, éœ€è¦è‡ªå·±å‘½å, åŒæ—¶å¯¼å‡ºçš„æ˜¯å€¼, å¯¼å…¥åé»˜è®¤ä¸ºå¸¸é‡,ä¸å¯ä¿®æ”¹å€¼.</p></li><li><p>å¯¼å…¥å‘½åå¯¼å‡ºçš„å˜é‡</p><ul><li><p>æŒ‰éœ€å¯¼å…¥</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// mod.js</span><span class="token comment">//   export &#123;a,b,c&#125; // æ³¨æ„, è¿™ä¸æ˜¯å¯¼å‡ºåŒ¿åå¯¹è±¡! åªæ˜¯è¯­æ³•</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> a<span class="token punctuation">,</span> b <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./mod.js'</span><span class="token punctuation">;</span> <span class="token comment">// æ³¨æ„, è¿™ä¸æ˜¯å¯¹è±¡è§£æ„! åªæ˜¯è¯­æ³•!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™ç§æ–¹æ³•æœ€å¥½, ä½†æ˜¯æ¯æ¬¡éœ€è¦å˜é‡éƒ½è¦ä¿®æ”¹å¯¼å…¥å‘½ä»¤</p></li><li><p>å…¨éƒ¨å¯¼å…¥</p><p>å°†å…¨éƒ¨å‘½åå¯¼å‡ºçš„å˜é‡å¯¼å…¥å›ºç„¶æ–¹ä¾¿, ä½†æ˜¯ä¼šæ±¡æŸ“å‘½åç©ºé—´.è§£å†³æ–¹æ¡ˆæ˜¯å…¨éƒ¨å¯¼å…¥å¹¶é‡å‘½å</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> s <span class="token keyword">from</span> <span class="token string">'./mod.js'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul></li><li><p>æ··åˆå¯¼å…¥é»˜è®¤ä¸å‘½åå¯¼å‡º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// mod.js</span><span class="token comment">//   export default function foo() &#123;&#125;</span><span class="token comment">//   export function bar() &#123;&#125;</span><span class="token comment">//   export function baz() &#123;&#125;</span><span class="token comment">//   export function yoo() &#123;&#125;</span><span class="token keyword">import</span> s<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> bar<span class="token punctuation">,</span> baz <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./mod'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><p><strong>ç±»(ES6)</strong></p><ul><li><p><code>class</code> è¯­æ³•ç³–</p><ul><li><p><code>constructor</code> ç›¸å½“äºåŸæ¥çš„å‡½æ•°å</p></li><li><p>ç±»ä¸Šçš„æ–¹æ³•(åŒ…æ‹¬ <code>getter</code> &amp;<code>setter</code>)éƒ½æ”¯æŒç®€æ´æ¨¡å¼</p></li><li><p>ç±»ä¸Šçš„æ–¹æ³•ç›¸å½“äº <code>ç±».prototype.æ–¹æ³•</code></p></li></ul></li><li><p>ä¸ ES5 çš„åŒºåˆ«</p><ul><li><p>åœ¨ ES6 ä¹‹å‰å¯ä»¥ç”¨ <code>Foo.call(obj)</code> åˆ›å»ºå¯¹è±¡, ä½¿ç”¨<code>class</code> ååªèƒ½ç”¨ <code>new</code></p></li><li><p><code>class</code> ä¸åƒ <code>function</code>ä¸€æ ·æ”¯æŒæå‡</p></li><li><p><code>class</code> å£°æ˜çš„ç±»ä¼šåˆ›å»ºä½œç”¨åŸŸè¯æ³•åˆ†æç¬¦</p></li></ul></li><li><p><code>supper</code></p><ul><li><p><code>supper</code> åœ¨ä¸åŒä½ç½®è¡¨æ„ä¸åŒ</p><ul><li><p>åœ¨æ„é€ å‡½æ•°ä¸­: çˆ¶ç±»çš„æ„é€ å‡½æ•°</p></li><li><p>åœ¨ç±»çš„éæ„é€ å‡½æ•°ä¸­: æŒ‡å‘çˆ¶ç±», å¯ä»¥è°ƒç”¨çˆ¶ç±»çš„é™æ€æ–¹æ³•,æ„é€ å‡½æ•°(åªèƒ½å¸¦ <code>new</code> ç”¨:<code>new super.constructor</code>)</p></li><li><p>åœ¨å¯¹è±¡ä¸­: æŒ‡å‘å¯¹è±¡çš„ <code>__protp__</code></p></li></ul></li><li><p>å­ç±»æ„é€ å‡½æ•°å¿…é¡»å…ˆè°ƒç”¨ <code>this</code> åœ¨è®¿é—®<code>this</code>(JavaScript çš„å§”æ‰˜ç»§æ‰¿)</p></li><li><p>ç±»ä¸Šçš„ <code>supper</code> æ˜¯é™æ€ç»‘å®šçš„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">ParentA</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ParentA:'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">ParentB</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">'b'</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ParentB:'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">ChildA</span> <span class="token keyword">extends</span> <span class="token class-name">ParentA</span> <span class="token punctuation">&#123;</span>  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ChildA:'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">ChildB</span> <span class="token keyword">extends</span> <span class="token class-name">ParentB</span> <span class="token punctuation">&#123;</span>  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ChildB:'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// å¸¸è§„æ“ä½œ</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChildA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>a<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ParentA: a</span>         <span class="token comment">// ChildA: a</span><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChildB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>b<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ParentB: b</span>         <span class="token comment">// ChildB: b</span><span class="token comment">// ä¿®æ”¹ this</span>b<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ParentB: a (supperä¸å˜, ä¾ç„¶æŒ‡å‘ B, this å˜äº†)</span>               <span class="token comment">// ChildB: a</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p><code>extends</code></p><p>ç›¸å½“äº ES6 ä¹‹å‰ç”¨ <code>prototype</code> å°†ä¸¤ä¸ªç±»è¿èµ·æ¥. é™¤æ­¤ä¹‹å¤–,<code>extends</code> è¿˜å®Œç¾æ”¯æŒäº†åŸç”Ÿç±»å‹çš„æ‰©å±•. ä¾‹å¦‚: åœ¨ ES6 ä¹‹å‰,æ‰‹åŠ¨åˆ›å»ºçš„ <code>Array</code> å­ç±»å¹¶ä¸ä¼šåƒ <code>Array</code>ä¸€æ ·å®ç°è‡ªåŠ¨æ›´æ–° <code>.length</code> ä½†æ˜¯ <code>extends</code>æ”¯æŒ</p></li><li><p><code>new.target</code></p><p>åœ¨æ„é€ å‡½æ•°ä¸­æŸ¥çœ‹æ­¤å±æ€§å¯ä»¥è¿”å›ç±»å, åœ¨å…¶ä»–å‡½æ•°ä¸­æ˜¯<code>undefined</code>.å¯ä»¥é€šè¿‡æ­¤å±æ€§åˆ¤æ–­æ„é€ å‡½æ•°æ˜¯ä½œä¸ºè¢«ç»§æ‰¿ç±»æ„é€ è¿˜æ˜¯ç›´æ¥æ„é€ </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Foo: '</span><span class="token punctuation">,</span> <span class="token keyword">new</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Bar</span> <span class="token keyword">extends</span> <span class="token class-name">Foo</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Bar: '</span><span class="token punctuation">,</span> <span class="token keyword">new</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'baz: '</span><span class="token punctuation">,</span> <span class="token keyword">new</span><span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Foo: Foo</span><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Foo: Bar   &lt;-- è™½ç„¶è°ƒç”¨çš„æ˜¯ Foo çš„æ„é€ å‡½æ•°, ä½†æ˜¯ new çš„æ˜¯ Bar</span><span class="token comment">// Bar: Bar</span>b<span class="token punctuation">.</span><span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// baz: undefined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>static</code></p><p>ç”¨äºå£°æ˜ç±»ä¸Šçš„é™æ€å¯¹è±¡, ç›¸å½“äºåœ¨ ES5 çš„æ„é€ å‡½æ•°ä¸Šç›´æ¥ç»‘å®šå¯¹è±¡.å­ç±»å¯ä»¥é€šè¿‡ <code>supper</code> ç›´æ¥è°ƒç”¨</p></li></ul><h3 id="é›†åˆ">é›†åˆ</h3><p>ä¸»è¦åŒ…å« <code>TypedArray</code>, <code>Map</code>,<code>WeakMap</code>, <code>Set</code>, <code>WeakSet</code></p><p><strong><code>TypedArray</code></strong></p><ul><li><p>é™æ€é•¿åº¦ä¸ç±»å‹çš„ <code>Array</code>,ä¸€èˆ¬ç”¨äºè¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®.</p></li><li><p><code>TypedArray</code>å­˜åœ¨å¤§å°ç«¯é—®é¢˜(ä½ä½å­˜å·¦è¾¹è¿˜æ˜¯å³è¾¹)</p></li><li><p>é€šè¿‡ <code>ArrayBuffer</code> ç”³è¯·ç©ºé—´(Buffer), é€šè¿‡<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvVHlwZWRBcnJheQ==">ç±»å‹æ•°ç»„æ„é€ å‡½æ•°<i class="fa fa-external-link-alt"></i></span>åˆ›å»ºæŒ‡å®šç±»å‹ä¸å¤§å°çš„è§†å›¾,å¹¶ç»‘å®šçš„ Buffer. Buffer ä¸è§†å›¾å¯ä»¥æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»</p></li></ul><p><strong><code>Map</code> &amp; <code>WeakMap</code></strong></p><ul><li><p>æ„é€ å‡½æ•°æ¥å— <ahref="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/entries"><code>Object.entire()</code>æ¨¡å¼</a>çš„æ•°ç»„</p></li><li><p>é€šè¿‡ <code>get</code> / <code>set</code> / <code>delete</code>æ–¹æ³•æŸ¥è¯¢ / å¢åŠ  / åˆ é™¤Map</p></li><li><p>é€šè¿‡ <code>has</code> æ–¹æ³•æŸ¥è¯¢æ˜¯å¦æœ‰é”®å</p></li><li><p>é€šè¿‡ <code>clear</code> æ–¹æ³•æ¸…ç©º Map</p></li><li><p>Map æœ¬èº«æ˜¯å¯è¿­ä»£çš„</p><ul><li>è¿­ä»£å™¨æ¯æ¬¡è¿­ä»£ä¸€ä¸ªæ•°ç»„, ç¬¬ä¸€ä¸ªæ˜¯ Key, ç¬¬äºŒä¸ªæ˜¯ Value</li><li>å¯ä»¥é€šè¿‡ <code>entries</code> è·å–é”®å€¼å¯¹æ•°ç»„</li><li>å¯ä»¥é€šè¿‡ <code>keys</code> è·å–é”®å€¼å¯¹æ•°ç»„</li><li>å¯ä»¥é€šè¿‡ <code>values</code> è·å–é”®å€¼å¯¹æ•°ç»„</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>  <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [Map Entries] &#123; [ 'a', 1 ], [ 'b', 2 ], [ 'c', 3 ] &#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [Map Iterator] &#123; 1, 2, 3 &#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [Map Iterator] &#123; 'a', 'b', 'c' &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¦‚æœå°†å¯¹è±¡ä½œä¸º <code>Map</code> çš„ Key, å¯¹è±¡çš„å¼•ç”¨æ¬¡æ•°å°†<code>+1</code>, è¿™æ„å‘³ç€ä¸å°† Key åˆ é™¤, å¯¹è±¡å°†æ— æ³•è¢« GC.<code>WeakMap</code> è§£å†³äº†è¿™ä¸€é—®é¢˜</p><ul><li><code>WeakMap</code> çš„ Keyåªèƒ½æ˜¯å¯¹è±¡ä½†æ˜¯å¯¹è±¡å¼•ç”¨æ¬¡æ•°ä¸ä¼šè¢«å½±å“</li><li>å½“å¯¹è±¡è¢« GC æ—¶, æ˜ å°„ä¼šè‡ªåŠ¨åˆ é™¤</li><li><code>WeakMap</code> æ²¡æœ‰ <code>size</code>, <code>clear</code>æ–¹æ³•</li></ul></li></ul><p><strong><code>Set</code> &amp; <code>WeakSet</code></strong></p><ul><li><p>ç›¸å½“äº <code>set</code> æ¢ä¸º <code>add</code> ä¸”<code>Vaule === Key</code> çš„ <code>Map</code> &amp;<code>WeakMap</code></p></li><li><p>ä¸æ”¯æŒå¼ºåˆ¶ç±»å‹è½¬æ¢(<code>1 !== '1'</code>)</p></li><li><p>åŒæ ·æ”¯æŒè¿­ä»£å™¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [Set Entries] &#123; [ 1, 1 ], [ 2, 2 ], [ 3, 3 ] &#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [Set Iterator] &#123; 1, 2, 3 &#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [Set Iterator] &#123; 1, 2, 3 &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>WeakSet</code> çš„ Key åªèƒ½æ˜¯å¯¹è±¡</p></li></ul><h3 id="es6æ–°api">ES6æ–°API</h3><p><strong>Array</strong></p><ul><li><p><code>Array.of</code> æ–¹æ³•</p><p>ç±»ä¼¼ <code>Array</code> æ„é€ å‡½æ•°,åŒºåˆ«æ˜¯è‹¥ä¼ å…¥å•ä¸ªæ•°å­—ä¼šåˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º 1 çš„æ•°ç»„, è€Œä¸æ˜¯é‚£ä¹ˆé•¿çš„æ•°ç»„.ä¸ä»…è§„é¿çš„ <code>Array</code> çš„é™·é˜±, è¿˜é˜²æ­¢äº†<code>&lt;empty items&gt;</code> çš„å‡ºç°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ &lt;5 empty items> ]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 5 ]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 5, 6, 7 ]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 5, 6, 7 ]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>Array.from</code> æ–¹æ³•</p><p>å°†ä¸€ä¸ª <code>Object</code> ä¸­çš„æ­£æ•´æ•° Key æå–å‡ºæ¥æ„é€ æ•°ç»„. é•¿åº¦ä¸º<code>object.length</code>, æ‰¾ä¸åˆ°çš„ä¸‹æ ‡ç›´æ¥è®¾ä¸º<code>undefined</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">fakeArr <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span>arr <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>fakeArr<span class="token punctuation">)</span> <span class="token comment">// [body]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç›¸å¯¹äº <code>Array.prototype.slice</code> ä¸ä¼šäº§ç”Ÿç©ºå€¼</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token number">0</span><span class="token operator">:</span> <span class="token string">'HIHI'</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token operator">:</span> <span class="token string">'RURU'</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token operator">:</span> <span class="token string">'LALA'</span><span class="token punctuation">,</span>  <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 'HIHI', 'RURU', undefined, 'LALA' ]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 'HIHI', 'RURU', &lt;1 empty item>, 'LALA' ]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>Array.prototype.copyWithin</code> æ–¹æ³•</p><p>æµ…å¤åˆ¶æ•°ç»„çš„ä¸€éƒ¨åˆ†åˆ°åŒä¸€æ•°ç»„ä¸­çš„å¦ä¸€ä¸ªä½ç½®.</p><p>ç”¨æ³•: <code>arr.copyWithin(target[, start[, end]])</code>,åŒºé—´å‰å–åä¸å–, èµ·æ­¢ä½ç½®æ¥å—è´Ÿæ•°(å€’æ•°ç¬¬å‡ ä¸ª)</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">copyWithin</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1,2,3,1,2]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">copyWithin</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1,2,3,1,5]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">copyWithin</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [4,5,3,4,5]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">copyWithin</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [4,2,3,4,5]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ‹·è´çš„é¡ºåºæ˜¯è‡ªå³å‘å·¦çš„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">copyWithin</span><span class="token punctuation">(</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è‡ªå·¦å‘å³æ‹·è´çš„è¯æ˜¯</span><span class="token comment">// [1,2,3,4,5] -> [1,2,2,4,5] -> [1,2,2,2,5] -> [1,2,2,2,5] -> [1,2,2,2,2]</span><span class="token comment">// è‡ªå³å‘å·¦æ‹·è´çš„è¯æ˜¯</span><span class="token comment">// [1,2,3,4,5] -> [1,2,3,4,4] -> [1,2,3,3,4] -> [1,2,2,3,4]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>Array.prototype.find</code>æ–¹æ³•: ä½¿ç”¨ <code>===</code>æŸ¥æ‰¾å…ƒç´ è¿”å› <code>boolean</code>. å¦‚æœéœ€è¦è‡ªå®šä¹‰æ¯”è¾ƒè§„åˆ™, å¯ä»¥ä½¿ç”¨<code>Array.prototype.some</code>(<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvQXJyYXkvc29tZQ==">MDN<i class="fa fa-external-link-alt"></i></span>).å¦‚æœæƒ³è¦æ‰¾åˆ°ä¸‹æ ‡å¯ä»¥ç”¨ <code>Array.prototype.findIndex</code>(<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvQXJyYXkvZmluZEluZGV4">MDN<i class="fa fa-external-link-alt"></i></span>)</p></li></ul><p><strong>Object</strong></p><ul><li><p><code>Object.is(..)</code> æ–¹æ³•</p><p>æ¯” <code>===</code> æ›´ä¸¥æ ¼çš„æ¯”è¾ƒ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">NaN</span><span class="token punctuation">,</span>  y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>  z <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">;</span>x <span class="token operator">===</span> x<span class="token punctuation">;</span> <span class="token comment">// false</span>y <span class="token operator">===</span> z<span class="token punctuation">;</span> <span class="token comment">// true</span>Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>Object.assign</code> æ–¹æ³•</p><p>ç”¨æ¥åˆå¹¶å¯¹è±¡, åªä¿ç•™åŸå¯¹è±¡ä¸­è‡ªæœ‰(éç»§æ‰¿)çš„, å¯æšä¸¾çš„å±æ€§</p></li></ul><p><strong>Number</strong></p><ul><li><p><code>Number.isNaN()</code></p></li><li><p><code>Number.isFinite()</code>:ä¸è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢åˆ¤æ–­æ˜¯ä¸æ˜¯æœ‰ç©·çš„(NaN, Infinityéƒ½ä¸ç®—). å¦‚éœ€ç±»å‹è½¬æ¢,å¯ä»¥ä½¿ç”¨å…¨å±€çš„ <code>isFinite</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">a <span class="token operator">=</span> <span class="token string">'10'</span><span class="token punctuation">;</span>b <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token function">isFinite</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>Number<span class="token punctuation">.</span><span class="token function">isFinite</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><span class="token function">isFinite</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>Number<span class="token punctuation">.</span><span class="token function">isFinite</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>Number.isInteger()</code>: åˆ¤æ–­æ˜¯ä¸æ˜¯æ•´æ•°, è™½ç„¶ JavaScriptçš„æ•°éƒ½æ˜¯åŸºäº IEEE 754 çš„, ä½†æ˜¯è¿˜æ˜¯å¯ä»¥é€šè¿‡åˆ¤æ–­å°æ•°ä½æ˜¯å¦å…¨ 0åˆ¤æ–­æ˜¯ä¸æ˜¯æ•´æ•°</p></li></ul><p><strong>String</strong></p><ul><li><p><code>String.prototype.repeat</code> æ–¹æ³•</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">"foo"</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span> <span class="token number">3</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'foofoofoo'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h3 id="å…ƒç¼–ç¨‹">å…ƒç¼–ç¨‹</h3><p>é€šè¿‡æ“ä½œç¨‹åºå®ä½“, åœ¨ç¼–è¯‘æ—¶è®¡ç®—å‡ºè¿è¡Œæ—¶éœ€è¦çš„å¸¸æ•°, ç±»å‹,ä»£ç çš„æ–¹æ³•(è¯´ç™½äº†å°±æ˜¯æ“ä½œä»£ç å®ä½“)</p><p><strong>è·å–å‡½æ•°å</strong></p><p>é€šè¿‡ <code>.name</code> å¯ä»¥è·å–å‡½æ•°å</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name:</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name:</span>window<span class="token punctuation">.</span><span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// name:</span><span class="token keyword">class</span> <span class="token class-name">Awesome</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// name: Awesome</span>  <span class="token function">funny</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// name: funny</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">Awesome</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// name: Awesome</span><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// name: foo</span>  <span class="token operator">*</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// name: bar</span>  <span class="token function-variable function">baz</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// name: baz</span>  <span class="token function-variable function">bam</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// name: bam</span>  <span class="token keyword">get</span> <span class="token function">qux</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// name: get qux</span>  <span class="token keyword">set</span> <span class="token function">fuz</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// name: set fuz</span>  <span class="token punctuation">[</span><span class="token string">'b'</span> <span class="token operator">+</span> <span class="token string">'iz'</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// name: biz</span>  <span class="token punctuation">[</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'buz'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// name: [buz]</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">var</span> x <span class="token operator">=</span> o<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name: bound foo</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name: bound</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// name: default</span><span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name: anonymous</span><span class="token keyword">var</span> <span class="token function-variable function">GeneratorFunction</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">.</span><span class="token class-name">__proto__</span><span class="token punctuation">.</span>constructor<span class="token punctuation">;</span><span class="token keyword">var</span> z <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeneratorFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name: anonymous</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Symbol</strong></p><ul><li><p><code>Symbol.iterator</code>: è¿”å›å¯¹è±¡çš„è¿­ä»£å™¨</p></li><li><p><code>Symbol.toStringTag</code>: toStringçš„è¿”å›ç»“æœ</p></li><li><p><code>Symbol.hasInstance</code>: åˆ¤æ–­å¯¹è±¡æ˜¯ä¸æ˜¯è¯¥ç±»å‹çš„å®ä¾‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token parameter">greeting</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>greeting <span class="token operator">=</span> greeting<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Foo'</span><span class="token punctuation">;</span>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>Foo<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>hasInstance<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>  <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">inst</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> inst<span class="token punctuation">.</span>greeting <span class="token operator">==</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>b<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'cool'</span><span class="token punctuation">;</span>a<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Foo]</span><span class="token function">String</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object cool]</span>a <span class="token keyword">instanceof</span> <span class="token class-name">Foo</span><span class="token punctuation">;</span> <span class="token comment">// true</span>b <span class="token keyword">instanceof</span> <span class="token class-name">Foo</span><span class="token punctuation">;</span> <span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>Symbol.species</code></p></li><li><p><code>Symbol.toPrimitive</code></p></li><li><p>æ­£åˆ™ç›¸å…³:</p><ul><li><code>Symbol.match</code></li><li><code>Symbol.replace</code></li><li><code>Symbol.search</code></li><li><code>String.prototype.split</code> å¯¹åº”å››ä¸ªæ­£åˆ™æ–¹æ³•, ä¸€èˆ¬ä¸è¦æ”¹,å¼•æ“å®ç°çš„ç‰ˆæœ¬æ€§èƒ½å¾ˆå¥½</li></ul></li><li><p><code>Symbol.isConcatSpreadable</code>:å¯¹è±¡åœ¨åˆå¹¶æ—¶æ˜¯å¦å¯ä»¥å±•å¼€</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>b<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>isConcatSpreadable<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span> a<span class="token punctuation">,</span> b <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1,2,3,[4,5,6]]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p><code>Symbol.unscopables</code> å±æ€§æ˜¯å¦å¯ä»¥åœ¨ <code>with</code>ä¸­æš´éœ²</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>  b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>  c <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>o<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>unscopables<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">with</span> <span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// o.b ä¸æš´éœ², æ‰€ä»¥åªèƒ½è¯·æ±‚å¤–éƒ¨çš„ b</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 20 3</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="es6-1">ES6+</h3><ul><li><p><code>async &amp; await</code> å¼‚æ­¥æ”¯æŒ: ç›¸å½“äºç”Ÿæˆå™¨ + Promiseè¯­æ³•ç³–</p></li><li><p>å¯¹è±¡çš„ <code>...</code>: <strong>è¿™ä¸æ˜¯ Spread è¡¨è¾¾å¼,å¯¹è±¡é»˜è®¤æ˜¯ä¸å¯è¿­ä»£çš„</strong>.</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">...</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError: Found non-callable @@iterator</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªåŠŸèƒ½å¯ä»¥å°†å¯¹è±¡è§£æ„æˆå¹¶å¹¶å…¥å…¶ä»–å¯¹è±¡</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> o2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token operator">...</span>o<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; c: 3, a: 1, b: 2 &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>Array.prototype.includes</code>:æŸ¥æ‰¾æ•°ç»„å¹¶è¿”å›æ•°ç»„ä¸­æ˜¯å¦æœ‰å…ƒç´ . æ”¯æŒæŸ¥æ‰¾ <code>NaN</code>, æ— æ³•åŒºåˆ†<code>+0 &amp; -0</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">NaN</span><span class="token punctuation">,</span> <span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">~</span>arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0, æ‰¾ä¸åˆ°</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true, æ‰¾çš„åˆ°</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true, æ— æ³•åŒºåˆ†</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>Object.observe()</code> (æ²¡æœ‰æ”¯æŒä½†æ˜¯å¾ˆä¼Ÿå¤§çš„ API)</p><ul><li><p>ç›¸å½“äºä¸€ä¸ªé’©å­å‡½æ•°, æ”¯æŒå¯¹è±¡åœ¨å¦‚ä¸‹å˜åŒ–åè°ƒç”¨å‡½æ•°</p><ul><li><p>add</p></li><li><p>update</p></li><li><p>delete</p></li><li><p>reconfigure(é€šè¿‡ <code>Object.defineProperty(..)</code>è€Œé‡æ–°é…ç½®æ—¶è§¦å‘)</p></li><li><p>setPrototype(ä¸è®ºæ˜¯ä½¿ç”¨<code>__proto__.setter</code>,è¿˜æ˜¯ä½¿ç”¨<code>Object.setPrototypeOf(..)</code>éƒ½ä¼šè§¦å‘)</p></li><li><p>preventExtensions(çŠ¶æ€æ”¹å˜, <code>Object.seal(..)</code> å’Œ<code>Object.freeze(..)</code> ä¹Ÿä¼šè§¦å‘)</p></li></ul></li><li><p>ä¹Ÿæ”¯æŒè‡ªå®šä¹‰äº‹ä»¶å¹¶è§¦å‘(è¿™ä¸å°±ç›¸å½“äºæ˜¯ä¸ªå…¨å±€äº‹ä»¶æ€»çº¿??)</p></li><li><p>å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥åŠŸèƒ½å®ç° MVVM</p></li><li><p>è™½ç„¶ç›®å‰æ²¡æœ‰å®ç°, ä½†æ˜¯å®ç°äº†å¯¹ DOM æ ‘ç›‘æ§çš„ <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvQVBJL011dGF0aW9uT2JzZXJ2ZXI=">MutationObserver<i class="fa fa-external-link-alt"></i></span></p></li></ul></li></ul>]]></content>
    
    
    <summary type="html">JSé»„å®ä¹¦ç¬¬ä¸€ç‰ˆ</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="JS" scheme="https://blog.liukairui.me/categories/%E5%89%8D%E7%AB%AF/JS/"/>
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="JavaScript" scheme="https://blog.liukairui.me/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>ç†è§£æŸæ—å™ªå£°</title>
    <link href="https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/"/>
    <id>https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/</id>
    <published>2022-06-26T16:00:01.000Z</published>
    <updated>2022-06-26T16:00:01.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><ul><li><strong>ç¿»è¯‘è‡ª</strong>: Understanding Perlin Noise</li><li><strong>åŸæ–‡ä½œè€…ï¼š</strong> Adrian Biagioli</li><li><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>http://adrianb.io/2014/08/09/perlinnoise.html</li><li><strong>ç‰ˆæƒå£°æ˜ï¼š</strong> åŸæ–‡é‡‡ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9pLmNyZWF0aXZlY29tbW9ucy5vcmcvbC9ieS80LjAvZGVlZC56aA==">CC BY 4.0<i class="fa fa-external-link-alt"></i></span>è®¸å¯åè®®ï¼Œæœ¬æ–‡é‡‡ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo">CCBY-NC-SA 4.0<i class="fa fa-external-link-alt"></i></span> è®¸å¯åè®®</li></ul></blockquote><p>æœ¬æ–‡çš„ç›®çš„æ˜¯å¯¹ Ken Perlin æ‰€è‘— <span class="exturl" data-url="aHR0cDovL21ybC5ueXUuZWR1L35wZXJsaW4vbm9pc2Uv">Improved Perlin Noise<i class="fa fa-external-link-alt"></i></span>é€šä¿—æ˜“æ‡‚çš„è§£é‡Šï¼Œè¿™ç¯‡æ–‡ç« çš„ä»£ç ä½¿ç”¨ C#å®ç°å¹¶å¯è‡ªç”±ä½¿ç”¨ã€‚å¦‚æœä½ åªæ˜¯æƒ³çœ‹æœ€ç»ˆçš„ç»“æœï¼Œ<span class="exturl" data-url="aHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vRmxhZmxhMi9mMDI2MGE4NjFiZTBlYmRlZWY3Ng==">ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹æœ€ç»ˆä»£ç <i class="fa fa-external-link-alt"></i></span>ã€‚</p><p>æŸæ—å™ªå£°æ˜¯ä¸€ç§åœ¨ç¨‹åºåŒ–å†…å®¹ç”Ÿæˆé¢†åŸŸå¼ºæœ‰åŠ›çš„ç®—æ³•ã€‚å…¶é€šå¸¸åº”ç”¨åœ¨æ¸¸æˆä¸è¯¸å¦‚ç”µå½±çš„è§†è§‰åª’ä½“æ–¹å‘ã€‚ä½œä¸ºè¯¥ç®—æ³•çš„å‘æ˜è€…ï¼ŒKen Perlin ï¼Œ<span class="exturl" data-url="aHR0cHM6Ly9tcmwuY3Mubnl1LmVkdS9+cGVybGluL2RvYy9vc2Nhci5odG1s">å› å…¶æ—©æœŸçš„å®éªŒè·å¾—äº†å¥¥æ–¯å¡é‡‘åƒå¥–<i class="fa fa-external-link-alt"></i></span>ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†æ¢ç´¢ä»–2022å¹´å‘å¸ƒçš„<span class="exturl" data-url="aHR0cDovL21ybC5ueXUuZWR1L35wZXJsaW4vbm9pc2Uv">æ”¹è¿›æŸæ—å™ªå£°ï¼ˆ Improved PerlinNoiseï¼‰<i class="fa fa-external-link-alt"></i></span>ã€‚åœ¨æ¸¸æˆå¼€å‘é¢†åŸŸï¼ŒæŸæ—å™ªå£°å¯ç”¨äºä»»ä½•ç±»å‹çš„æ³¢çŠ¶å‹ææ–™æˆ–æè´¨ã€‚å®ƒå¯ä»¥ç”¨äºç”Ÿæˆåœ°å½¢ï¼ˆä¾‹å¦‚ç±»ä¼¼æˆ‘çš„ä¸–ç•Œæ¸¸æˆçš„åœ°å½¢ï¼‰ï¼Œç«ç„°çš„æ•ˆæœï¼Œæ°´å’Œäº‘ã€‚è¿™äº›æ•ˆæœé€šå¸¸å¯ä»¥ç”¨äºŒç»´æˆ–è€…ä¸‰ç»´çš„æŸæ—å™ªå£°å®ç°ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥è½»æ¾åœ°æ‰©å±•åˆ°å››ç»´å®ç°ã€‚å¦å¤–ä»…ä¸€ç»´çš„æŸæ—å™ªå£°å¯ä»¥ç”¨äºç”Ÿæˆæ¨ªå‘æ»šåŠ¨çš„åœ°å½¢ï¼ˆå¦‚æ¸¸æˆï¼šæ³°æ‹‰ç‘äºšï¼ˆTerraria ï¼‰ã€æ˜Ÿç•Œè¾¹å¢ƒï¼ˆStarboundï¼‰ï¼‰æˆ–åˆ›é€ æ‰‹ç»˜çº¿æ¡çš„æ•ˆæœã€‚</p><p>æ­¤å¤–ï¼Œå¦‚æœä½ å°†æŸæ—å™ªå£°æ‰©å±•ä¸€ä¸ªç»´åº¦ï¼Œå¹¶å°†è¿™ä¸ªç»´åº¦ä½œä¸ºæ—¶é—´ï¼Œä½ å°†å¯ä»¥å®ç°æ•ˆæœçš„åŠ¨ç”»åŒ–ã€‚ä¾‹å¦‚ï¼ŒäºŒç»´æŸæ—å™ªå£°å¯ä»¥ç”¨äºæç»˜åœ°å½¢ï¼Œä½†æ˜¯ä¸‰ç»´çš„æŸæ—å™ªå£°å¯ä»¥æç»˜æµ·æ´‹ä¸­çš„æ°´æ³¢å˜åŒ–ã€‚ä¸‹é¢æ˜¯ä¸åŒç»´åº¦æŸæ—å™ªå£°çš„å›¾åƒåŠå…¶å®é™…åº”ç”¨</p><table><colgroup><col style="width: 3%" /><col style="width: 23%" /><col style="width: 73%" /></colgroup><thead><tr class="header"><th>ç»´åº¦</th><th>å™ªå£°ç°åº¦å›¾</th><th>åº”ç”¨</th></tr></thead><tbody><tr class="odd"><td>1</td><td><img src="./ç†è§£æŸæ—å™ªå£°/raw1d.png" /></td><td><imgsrc="./ç†è§£æŸæ—å™ªå£°/use1d.png" /><br />ç”¨äºåˆ›é€ æ‰‹ç»˜çº¿æ¡æ•ˆæœ</td></tr><tr class="even"><td>2</td><td><img src="./ç†è§£æŸæ—å™ªå£°/raw2d.png" /></td><td><imgsrc="./ç†è§£æŸæ—å™ªå£°/use2d.png" /><br />é€šè¿‡åº”ç”¨æ¸å˜å¯ä»¥åˆ›é€ å‡ºç«ç„°çš„æ•ˆæœ</td></tr><tr class="odd"><td>3</td><td><img src="./ç†è§£æŸæ—å™ªå£°/raw3d.png" /></td><td><imgsrc="./ç†è§£æŸæ—å™ªå£°/use3d.png" /><br />ä½¿ç”¨æŸæ—å™ªå£°åˆ›å»ºæ‹¥æœ‰<strong>æ´ç©´</strong>çš„åœ°å½¢ï¼ˆä¹Ÿè®¸æ˜¯æœ€å¹¿æ³›çš„ç”¨é€”)</td></tr></tbody></table><p>ç”±æ­¤å¯è§ï¼ŒæŸæ—å™ªå£°å¯ä»¥ç”¨äºå¾ˆå¤šè‡ªç„¶ç°è±¡çš„æ¨¡æ‹Ÿï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹çœ‹æŸæ—å™ªå£°ç®—æ³•çš„åŸç†</p><h2 id="åŸç†">åŸç†</h2><p><em>æ³¨æ„ï¼šå¾ˆå¤šå†…å®¹æ¥è‡ª<span class="exturl" data-url="aHR0cDovL3dlYnN0YWZmLml0bi5saXUuc2UvfnN0ZWd1L1ROTTAyMi0yMDA1L3Blcmxpbm5vaXNlbGlua3MvcGVybGluLW5vaXNlLW1hdGgtZmFxLmh0bWw=">MattZucker å†™çš„è¿™ç¯‡æ–‡ç« <i class="fa fa-external-link-alt"></i></span>ã€‚ä½†æ˜¯ï¼Œé‚£ç¯‡æ–‡ç« æ˜¯åŸºäº 1980å¹´ä»£åˆç¼–å†™çš„åŸå§‹æŸæ—å™ªå£°ç®—æ³•ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†ä½¿ç”¨ 2022å¹´å‘è¡¨çš„æ”¹è¿›æŸæ—å™ªå£°ç®—æ³•ï¼Œå› æ­¤æˆ‘çš„ç‰ˆæœ¬ä¸ Zuckerçš„ç‰ˆæœ¬æœ‰ä¸€äº›å…³é”®æ€§çš„ä¸åŒ</em></p><p>è®©æˆ‘ä»¬çœ‹çœ‹æœ€åŸºæœ¬çš„æŸæ—å™ªå£°å‡½æ•°</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">public double perlin(double x, double y, double z);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™ä¸ªå‡½æ•°ä½¿ç”¨ <code>x, y, z</code> ä½œä¸ºè¾“å…¥ï¼Œè¿”å›ä¸€ä¸ªä»‹äº 0.0 åˆ° 1.0ä¹‹é—´çš„ <code>double</code>ç±»å‹æ•°å­—ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥å¯¹è¾“å…¥åšäº›ä»€ä¹ˆæ“ä½œå‘¢ï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬å°†<code>x, y, z</code> æ”¾å…¥ä¸€ä¸ªç«‹æ–¹ä½“ä¸­ã€‚æ¢å¥è¯è¯´å°±æ˜¯æ‰¾åˆ° `[x, y, z] % 1.åœ¨åæ ‡ç³»ä¸­çš„ä½ç½®ã€‚ä¸‹å›¾æ˜¯å…¶åœ¨äºŒç»´åæ ‡ä¸­çš„è¡¨ç¤ºã€‚ï¼ˆè“ç‚¹è¡¨è¿°è¾“å…¥åæ ‡ï¼Œå‘¨å›´å››ä¸ªç‚¹æ˜¯å•ä½åæ ‡ï¼‰</p><p><img src="./ç†è§£æŸæ—å™ªå£°/logic01.png" /></p><p>å¯¹äº4ä¸ªå•ä½åæ ‡ç‚¹ï¼ˆåœ¨ä¸‰ç»´ä¸­æœ‰8ä¸ªï¼‰ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ª<em>ä¼ªéšæœºæ¢¯åº¦å‘é‡</em>ï¼Œè¿™ä¸ªæ¢¯åº¦å‘é‡å®šä¹‰äº†ä¸€ä¸ªæ­£æ–¹å‘ä¸ä¸€ä¸ªè´Ÿæ–¹å‘ï¼ˆä¸æ­£æ–¹å‘åå‘ï¼‰ã€‚ä¼ªéšæœºçš„æ„æ€æ˜¯å¯¹äºä»»ä½•ä¸€ç»„è¾“å…¥åˆ°æ¢¯åº¦å‘é‡æ–¹ç¨‹ä¸­çš„æ•´æ•°é›†åˆï¼ˆç´¢å¼•ï¼‰æ€»æ˜¯ä¼šå¾—åˆ°ç›¸åŒçš„å‘é‡ã€‚å› æ­¤ï¼Œä»–åªæ˜¯çœ‹ä¸Šå»æ˜¯éšæœºçš„ã€‚æ­¤å¤–ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªå•ä½åæ ‡éƒ½æœ‰â€è‡ªå·±çš„â€œæ¢¯åº¦ï¼Œå¦‚æœæ¢¯åº¦å‡½æ•°ï¼ˆæ¢¯åº¦å‘é‡æ–¹ç¨‹ï¼‰ä¸å˜ï¼Œæ¢¯åº¦æ°¸è¿œä¸ä¼šæ”¹å˜ã€‚</p><p><img src="./ç†è§£æŸæ—å™ªå£°/logic02.png" /></p><p>ç„¶è€Œä¸Šå›¾å¹¶ä¸æ˜¯å‡†ç¡®ï¼Œåœ¨ Ken Perlinçš„æ”¹è¿›å™ªå£°ä¸­ï¼Œè¿™äº›å•ä½åæ ‡ä¸Šçš„ç‚¹å¹¶ä¸æ˜¯å®Œå…¨éšæœºçš„ï¼Œæ¯ä¸ªå•ä½ç‚¹ä¸Šå¯¹åº”çš„ä¼ªéšæœºæ¢¯åº¦å‘é‡æ˜¯é€šè¿‡ç‚¹åˆ°å•ä½ç‚¹å‘é‡å†³å®šçš„</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">(1,1,0),(-1,1,0),(1,-1,0),(-1,-1,0),(1,0,1),(-1,0,1),(1,0,-1),(-1,0,-1),(0,1,1),(0,-1,1),(0,1,-1),(0,-1,-1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>é€‰æ‹©è¿™äº›æ¢¯åº¦å‘é‡èƒŒåçš„åŸå› è§ï¼šKen Perlin's åœ¨ 2022 å‘è¡¨çš„ SIGGRAPHè®ºæ–‡ <span class="exturl" data-url="aHR0cDovL21ybC5ueXUuZWR1L35wZXJsaW4vcGFwZXI0NDUucGRm">ImprovingNoise<i class="fa fa-external-link-alt"></i></span></p><p><em>æ³¨æ„ï¼šå¾ˆå¤šå…³äºæŸæ—å™ªå£°çš„æ–‡ç« ä½¿ç”¨äº†ä¸ä½¿ç”¨è¿™äº›å‘é‡çš„åŸå§‹æŸæ—å™ªå£°ç®—æ³•ï¼Œä¾‹å¦‚ä¸Šå›¾å°±æè¿°çš„åŸå§‹æŸæ—å™ªå£°ç®—æ³•ï¼Œå› ä¸ºå›¾ç‰‡æ˜¯åœ¨Improving Noise å‘è¡¨å‰åˆ¶ä½œçš„ï¼Œä½†æ˜¯æ ¸å¿ƒæ€æƒ³æ˜¯ç›¸åŒçš„</em></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—å››ä¸ªè·ç¦»å‘é‡ï¼ˆä¸‰ç»´ä¸‹æ˜¯å…«ä¸ªï¼‰ï¼Œå³ç‚¹å‘¨å›´å››ï¼ˆå…«ï¼‰ä¸ªå•ä½ç‚¹åˆ°é€‰å–ç‚¹çš„å‘é‡ï¼Œè¿™äº›è·ç¦»å‘é‡äºŒç»´è¡¨ç¤ºå¦‚å›¾</p><p><img src="./ç†è§£æŸæ—å™ªå£°/logic03.png" /></p><p>ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦<span class="exturl" data-url="aHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Eb3RfcHJvZHVjdA==">ç‚¹ç§¯<i class="fa fa-external-link-alt"></i></span>æ¢¯åº¦å‘é‡ä¸è·ç¦»å‘é‡ä»è€Œè®¡ç®—å‡ºå•ä½ç‚¹çš„æƒå€¼</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">grad.x * dist.x + grad.y * dist.y + grad.z * dist.z<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ ·åšçš„åŸå› æ˜¯ä¸¤ä¸ªå‘é‡çš„<span class="exturl" data-url="aHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Eb3RfcHJvZHVjdA==">ç‚¹ç§¯<i class="fa fa-external-link-alt"></i></span>ç›¸å½“äºæ˜¯ä¸¤ä¸ªå‘é‡å¤¹è§’ä½™å¼¦ä¹˜ä»¥è¿™äº›å‘é‡çš„å¤§å°ï¼š</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">dot(vec1,vec2) &#x3D; cos(angle(vec1,vec2)) * vec1.length * vec2.length<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ¢å¥è¯è¯´ï¼Œä¸¤ä¸ªåŒå‘å‘é‡ç‚¹ç§¯ç›¸å½“äº</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">1 * vec1.length * vec2.length<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åŒæ—¶ï¼Œå¦‚æœä¸¤ä¸ªå‘é‡æ–¹å‘ç›¸åï¼Œä»–ä»¬çš„ç‚¹ç§¯ä¸º</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">-1 * vec1.length * vec2.length<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚æœä¸¤ä¸ªå‘é‡æ˜¯å‚ç›´çš„ï¼Œä»–ä»¬çš„ç‚¹ç§¯ä¸º0</p><p>å› æ­¤ï¼Œå½“è·ç¦»å‘é‡ä¸æ¢¯åº¦å‘é‡åŒå‘ï¼ˆå¤¹è§’å°äº<spanclass="math inline">\(90^\circ\)</span>ï¼‰ï¼Œç‚¹ç§¯ä¸ºæ­£,åå‘ï¼Œç‚¹ç§¯ä¸ºè´Ÿã€‚è¿™å°±æ¢¯åº¦å‘é‡å¦‚ä½•åˆ†æ­£æ–¹å‘ä¸è´Ÿæ–¹å‘çš„ï¼Œå¦‚å›¾è¡¨ç¤ºäº†æ­£æ–¹å‘ä¸è´Ÿæ–¹å‘çš„å½±å“</p><p><img src="./ç†è§£æŸæ—å™ªå£°/logic04.png" /></p><p>æ‰€ä»¥ç°åœ¨æˆ‘ä»¬éœ€è¦åœ¨è¿™ 4ä¸ªå€¼ä¹‹é—´è¿›è¡Œæ’å€¼ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨å››ä¸ªå•ä½ç‚¹ï¼ˆä¸‰ç»´å…«ä¸ªï¼‰ä¸­è·å¾—æƒå€¼ã€‚è§£å†³æ–¹æ¡ˆå¾ˆç®€å•ï¼šå¹³å‡å‡å€¼ï¼ˆåŒçº¿æ€§æ’å€¼ï¼‰ï¼Œä»¥äºŒç»´ä¸ºä¾‹</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">&#x2F;&#x2F; å››ä¸ªå•ä½ç‚¹çš„æƒå€¼å®šä¹‰å¦‚ä¸‹:&#x2F;&#x2F; [g1] | [g2]&#x2F;&#x2F; -----------&#x2F;&#x2F; [g3] | [g4]int g1, g2, g3, g4;int u, v;   &#x2F;&#x2F; uï¼Œv æ˜¯è¾“å…¥ç‚¹åœ¨å•ä½ç‚¹ä¸­çš„åæ ‡ä½ç½®            &#x2F;&#x2F; ä¾‹å¦‚ (u,v) &#x3D; (0.5,0.5) è¡¨ç¤ºè¾“å…¥ç‚¹åœ¨å•ä½ç‚¹å›´æˆæ–¹å½¢ä¸­å¿ƒint x1 &#x3D; lerp(g1,g2,u);int x2 &#x3D; lerp(g3,h4,u);int average &#x3D; lerp(x1,x2,v);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€åä¸€ä¸ªé—®é¢˜æ˜¯ï¼šä½¿ç”¨ä¸Šé¢çš„å¹³å‡å‡å€¼ï¼ˆåŒçº¿æ€§æ’å€¼ï¼‰çš„æ–¹æ³•æ•ˆæœå¹¶ä¸å¥½ï¼Œè¿™ç§æ–¹æ³•è™½ç„¶è®¡ç®—å¾ˆç®€å•ï¼Œä½†æ˜¯çœ‹èµ·æ¥å¹¶ä¸è‡ªç„¶ã€‚æˆ‘ä»¬éœ€è¦ä¸€äº›å¹³æ»‘è¿‡æ¸¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†æ·¡å…¥æ·¡å‡ºå‡½æ•°ï¼Œæœ‰åç¼“åŠ¨æ›²çº¿ï¼Œå¦‚å›¾æ˜¯ä¸€ç§ç¼“åŠ¨æ›²çº¿</p><p><img src="./ç†è§£æŸæ—å™ªå£°/logic05.png" /></p><p>è¿™ä¸ªç¼“åŠ¨æ›²çº¿å°†åº”ç”¨äº<code>u</code>ï¼Œ<code>v</code>çš„è®¡ç®—ï¼Œè¿™æ ·çš„å¤„ç†ä¼šä½¿æ¥è¿‘è¾¹ç¼˜çš„è¾“å…¥ç‚¹æ›´åŠ æ¥è¿‘è¾¹ç¼˜ã€‚æ”¹è¿›æŸæ—å™ªå£°ä½¿ç”¨äº†è¿™æ ·çš„ç¼“åŠ¨æ›²çº¿æ–¹ç¨‹<span class="math display">\[6t^5-15t^4+10t^3\]</span>è¿™å°±æ˜¯æŸæ—å™ªå£°çš„åŸç†ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»ç†è§£äº†æŸæ—å™ªå£°çš„æ¯ä¸€éƒ¨åˆ†ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€äº›ä»£ç å®ç°</p><h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2><p>ä»£ç æ˜¯ä½¿ç”¨ C# å®ç°çš„ï¼Œè¿™ä»½ä»£ç æ˜¯ <span class="exturl" data-url="aHR0cDovL21ybC5ueXUuZWR1L35wZXJsaW4vbm9pc2Uv">Ken Perlin's JavaImplementation<i class="fa fa-external-link-alt"></i></span>çš„è½»å¾®ä¿®æ”¹ç‰ˆæœ¬ã€‚è¿™ä»½ä»£ç æ¯”åŸç‰ˆæ›´åŠ æ¸…æ™°å¹¶æ·»åŠ äº†ä¸€äº›é‡å¤å™ªå£°çš„èƒ½åŠ›ã€‚è¿™äº›ä»£ç æ˜¯å¯ä»¥è‡ªç”±ä½¿ç”¨çš„ï¼ˆæ¯•ç«Ÿæˆ‘æ²¡æœ‰çœŸæ­£çš„å®ç°- ä½†æ˜¯ Ken Perlin åšåˆ°äº†ï¼‰</p><h3 id="é…ç½®">é…ç½®</h3><p>ç¬¬ä¸€æ­¥éœ€è¦è®¾ç½®ä¸€ä¸ªæ’åˆ—è¡¨ï¼Œç®€ç§° <code>p[]</code>æ•°ç»„ã€‚ä»–é€šå¸¸æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º 256 å€¼ä»‹äº 0 åˆ° 255çš„æ•°ç»„ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é‡å¤è¿™ä¸ªæ•°ç»„ï¼ˆé€šå¸¸æ€»å¤§å°ä¸º 512 ï¼‰ä»¥é¿å…æ•°ç»„è¶Šç•Œï¼š</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">private static readonly int[] permutation &#x3D; &#123; 151,160,137,91,90,15,                 &#x2F;&#x2F; Ken Perlin å®ç°çš„æŸ¥æ‰¾è¡¨ï¼Œè¿™æ˜¯éšæœºé€‰å–çš„    131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,    &#x2F;&#x2F; å…ƒç´ å€¼ä»‹äº 0 - 255    190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,    88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166,    77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,    102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196,    135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123,    5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,    223,183,170,213,119,248,152, 2,44,154,163, 70,221,153,101,155,167, 43,172,9,    129,22,39,253, 19,98,108,110,79,113,224,232,178,185, 112,104,218,246,97,228,    251,34,242,193,238,210,144,12,191,179,162,241, 81,51,145,235,249,14,239,107,    49,192,214, 31,181,199,106,157,184, 84,204,176,115,121,50,45,127, 4,150,254,    138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180&#125;;private static readonly int[] p;                                &#x2F;&#x2F; é‡å¤ä¸€ä¸ªæ’åˆ—è¡¨é¿å…ä¸‹æ ‡è¶Šç•Œstatic Perlin() &#123;    p &#x3D; new int[512];    for(int x&#x3D;0;x&lt;512;x++) &#123;        p[x] &#x3D; permutation[x%256];    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>p[]</code> æ’åˆ—è¡¨å°†ç”¨äº hashå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†å†³å®šä¹‹åä½¿ç”¨å“ªä¸ªæ¢¯åº¦å‘é‡ï¼Œæˆ‘ä»¬å°†åœ¨åé¢è¯¦ç»†æè¿°å‡½æ•°å®ç°ç»†èŠ‚</p><p>æ¥ä¸‹æ¥æ˜¯å™ªå£°å‡½æ•°</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">public double perlin(double x, double y, double z) &#123;    if(repeat &gt; 0) &#123;                                    &#x2F;&#x2F; å¦‚æœå¼€å¯äº†é‡å¤ï¼Œå°±æ±‚ä½™è·å¾—é˜²æ­¢è¶Šç•Œ        x &#x3D; x%repeat;        y &#x3D; y%repeat;        z &#x3D; z%repeat;    &#125;    int xi &#x3D; (int)x &amp; 255;                              &#x2F;&#x2F; è®¡ç®—å•ä½ç‚¹ä½ç½®    int yi &#x3D; (int)y &amp; 255;                              &#x2F;&#x2F; å·¦ä¸‹è§’æ˜¯( |_x_|,|_y_|,|_z_| )    int zi &#x3D; (int)z &amp; 255;    double xf &#x3D; x-(int)x;                               &#x2F;&#x2F; è®¡ç®—ç‚¹åœ¨å•ä½ç‚¹åœ¨ä¸­çš„å±€éƒ¨ä½ç½®    double yf &#x3D; y-(int)y;    double zf &#x3D; z-(int)z;    &#x2F;&#x2F; ...&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä»½ä»£ç å¾ˆå®¹æ˜“ç†è§£ï¼Œé¦–å…ˆå¦‚æœä»£ç ä½¿ç”¨äº†é‡å¤æ’åˆ—è¡¨æ–¹æ³•ï¼Œä½¿ç”¨æ±‚ä½™è¿ç®—è®¡ç®—ä¸‹æ ‡ä»¥é¿å…è¶Šç•Œã€‚æ¥ä¸‹æ¥åˆ›å»ºå˜é‡<code>xi, yi, zi</code>ï¼Œå…¶ä»£è¡¨äº†è¾“å…¥ç‚¹å¯¹åº”å•ä½ç‚¹åŠå…¶æ‰€åœ¨ç«‹æ–¹ä½“ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†åæ ‡å½’ä¸€åŒ–åˆ°<span class="math inline">\([0,255]\)</span> è¿™å¯ä»¥é¿å…åœ¨è®¿é—®<code>p[]</code> æ—¶ä¸‹æ ‡è¶Šç•Œã€‚ä½†æ˜¯è¿™ä¹Ÿä¼šé€ æˆå‰¯ä½œç”¨ï¼šæŸæ—å™ªå£°ç»“æœä¼šæ¯ 256é‡å¤ä¸€æ¬¡ã€‚ä½†è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ç”¨æ˜¯åè¿›åˆ¶åæ ‡å®ç°æŸæ—å™ªå£°ã€‚æœ€åæœ€åæˆ‘ä»¬è¦æ‰¾åˆ°ç‚¹åœ¨å•ä½ç«‹æ–¹ä½“ä¸­çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯<span class="math inline">\(n = n \% 1.0\)</span> ï¼Œå…¶ä¸­ <spanclass="math inline">\(n\)</span> æ˜¯ä¸€ä¸ªåæ ‡ã€‚</p><h3 id="ç¼“åŠ¨æ›²çº¿">ç¼“åŠ¨æ›²çº¿</h3><p>ç°åœ¨æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸Šå›¾ä¸­çš„ç¼“åŠ¨æ›²çº¿ï¼Œæ­£å¦‚ä¸Šé¢æåˆ°çš„ï¼Œç¼“åŠ¨æ›²çº¿æ–¹ç¨‹æ˜¯<span class="math display">\[6t^5-15t^4+10t^3\]</span> ä»£ç å®ç°ä¸º</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">public static double fade(double t) &#123;           &#x2F;&#x2F; Ken Perlin å®šä¹‰çš„å‡½æ•°. è¿™ç¼“åŠ¨äº†åæ ‡å€¼ï¼Œ                                                &#x2F;&#x2F; è®©åæ ‡å€¼è¶‹å‘è¾¹ç•Œ    return t * t * t * (t * (t * 6 - 15) + 10); &#x2F;&#x2F; 6t^5 - 15t^4 + 10t^3&#125;public double perlin(double x, double y, double z) &#123;    &#x2F;&#x2F; ...    double u &#x3D; fade(xf);    double v &#x3D; fade(yf);    double w &#x3D; fade(zf);    &#x2F;&#x2F; ...&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­ <code>u / v / w</code> å°†åœ¨ä¹‹åæ’å€¼æ—¶ä½¿ç”¨</p><h3 id="hash-å‡½æ•°">Hash å‡½æ•°</h3><p>æŸæ—å™ªå£°çš„ hash å‡½æ•°è¾“å…¥ä¸€ç»„åæ ‡å¹¶è¿”å›ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å€¼ï¼Œ hashå‡½æ•°çš„ç»´åŸºç™¾ç§‘å®šä¹‰å¦‚ä¸‹</p><blockquote><p>ä¸€ç§å‡½æ•°å¯ä»¥å°†ä»»æ„èŒƒå›´çš„æ•°æ®æ˜ å°„åˆ°å›ºå®šèŒƒå›´ï¼Œè¾“å…¥æ•°æ®å¾®å°çš„å·®å¼‚ä¼šå¯¼è‡´ç»“æœå·¨å¤§çš„å·®å¼‚</p></blockquote><p>å¦‚ä¸‹æ˜¯æŸæ—å™ªå£°ä¸­çš„ hash å‡½æ•°ï¼Œå®ƒä½¿ç”¨äº†æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„æ’åˆ—è¡¨<code>p[]</code></p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">public double perlin(double x, double y, double z) &#123;    &#x2F;&#x2F; ...    int aaa, aba, aab, abb, baa, bba, bab, bbb;    aaa &#x3D; p[p[p[    xi ]+    yi ]+    zi ];    aba &#x3D; p[p[p[    xi ]+inc(yi)]+    zi ];    aab &#x3D; p[p[p[    xi ]+    yi ]+inc(zi)];    abb &#x3D; p[p[p[    xi ]+inc(yi)]+inc(zi)];    baa &#x3D; p[p[p[inc(xi)]+    yi ]+    zi ];    bba &#x3D; p[p[p[inc(xi)]+inc(yi)]+    zi ];    bab &#x3D; p[p[p[inc(xi)]+    yi ]+inc(zi)];    bbb &#x3D; p[p[p[inc(xi)]+inc(yi)]+inc(zi)];    &#x2F;&#x2F; ...&#125;public int inc(int num) &#123;    num++;    if (repeat &gt; 0) num %&#x3D; repeat;    return num;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ä¸Šé¢çš„ hash å‡½æ•°å“ˆå¸Œè¾“å…¥ç‚¹å‘¨å›´çš„å…«ä¸ªå•ä½ç‚¹ï¼Œ<code>inc()</code>å‡½æ•°ç”¨äºè·å–åæ ‡å€¼çš„åç»§å¹¶ä¿è¯ä¸ä¼šè¶Šç•Œã€‚å¦‚æœä½ æ²¡æœ‰è®¾ç½®<code>repeat</code> ï¼Œé‚£ä¹ˆ <code>inc(xi) = xi + 1</code>ã€‚ç”±äºæˆ‘ä»¬ä½¿ç”¨äº†<code>p[]</code> æ•°ç»„ï¼Œç»“æœå°†ä»‹äº 0 - 255</p><h3 id="æ¢¯åº¦å‡½æ•°">æ¢¯åº¦å‡½æ•°</h3><p>æˆ‘ä¸€ç›´è®¤ä¸º Ken Perlin åŸå§‹çš„æ¢¯åº¦å‡½æ•° <code>grad()</code>æ˜¯æ‚ä¹±ä¸”ä¸å¿…è¦çš„ã€‚è®°ä½ï¼Œ <code>grad()</code>çš„ç›®æ ‡æ˜¯è®¡ç®—éšæœºé€‰å–çš„ä¼ªæ¢¯åº¦å‘é‡ä¸å…«ä¸ªè·ç¦»å‘é‡çš„ç‚¹ç§¯ã€‚Ken Perlinä½¿ç”¨äº†ä¸€äº›èŠ±å“¨çš„ä½è¿ç®—æ–¹æ³•å®ç°äº†è¿™ä¸ªå‡½æ•°</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">public static double grad(int hash, double x, double y, double z) &#123;    int h &#x3D; hash &amp; 15;                                    &#x2F;&#x2F; å– hash çš„åå››ä½    double u &#x3D; h &lt; 8 &#x2F;* 0b1000 *&#x2F; ? x : y;                &#x2F;&#x2F; å¦‚æœæœ€é«˜ä¸ºä¸º0å°±è®¾ç½® u &#x3D; xï¼Œå¦åˆ™y    double v;                                             &#x2F;&#x2F; åŸç‰ˆä¸­æ˜¯ç”¨çš„?:è¿ç®—    if(h &lt; 4 &#x2F;* 0b0100 *&#x2F;)                                &#x2F;&#x2F; åˆ¤æ–­ç¬¬äºŒä½ä¸º0        v &#x3D; y;    else if(h &#x3D;&#x3D; 12 &#x2F;* 0b1100 *&#x2F; || h &#x3D;&#x3D; 14 &#x2F;* 0b1110*&#x2F;)  &#x2F;&#x2F; åˆ¤æ–­æœ€é«˜ä½ä¸ç¬¬äºŒä½ä¸º1        v &#x3D; x;    else                                                  &#x2F;&#x2F; åˆ¤æ–­ä¸€äºŒä½ä¸åŒ        v &#x3D; z;    return ((h&amp;1) &#x3D;&#x3D; 0 ? u : -u)+((h&amp;2) &#x3D;&#x3D; 0 ? v : -v);   &#x2F;&#x2F; åˆ¤æ–­åä¸¤ä½&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸‹é¢çš„ä»£ç æ˜¯ä¸Šé¢ä»£ç çš„å¦ä¸€ç§å®ç°ï¼Œè¿™ç§æ–¹æ³•æ›´åŠ æ˜“æ‡‚ï¼ˆåœ¨éƒ¨åˆ†è¯­è¨€ä¸­æ›´å¿«ï¼‰</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">&#x2F;&#x2F; æ¥æº: http:&#x2F;&#x2F;riven8192.blogspot.com&#x2F;2010&#x2F;08&#x2F;calculate-perlinnoise-twice-as-fast.htmlpublic static double grad(int hash, double x, double y, double z)&#123;    switch(hash &amp; 0xF)    &#123;        case 0x0: return  x + y;        case 0x1: return -x + y;        case 0x2: return  x - y;        case 0x3: return -x - y;        case 0x4: return  x + z;        case 0x5: return -x + z;        case 0x6: return  x - z;        case 0x7: return -x - z;        case 0x8: return  y + z;        case 0x9: return -y + z;        case 0xA: return  y - z;        case 0xB: return -y - z;        case 0xC: return  y + x;        case 0xD: return -y + z;        case 0xE: return  y - x;        case 0xF: return -y - z;        default: return 0; &#x2F;&#x2F; æ°¸ä¸åˆ°è¾¾    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢çš„ä»£ç å¯ä»¥åœ¨<span class="exturl" data-url="aHR0cDovL3JpdmVuODE5Mi5ibG9nc3BvdC5jb20vMjAxMC8wOC9jYWxjdWxhdGUtcGVybGlubm9pc2UtdHdpY2UtYXMtZmFzdC5odG1s">è¿™é‡Œ<i class="fa fa-external-link-alt"></i></span>æ‰¾åˆ°ï¼Œè¿™ä¸¤ç§ä»£ç ç»“æœå®Œå…¨ç›¸åŒï¼Œä»–ä»¬éšæœºä»ä¸‹é¢å‡ ä¸ªå‘é‡ä¸­é€‰å–ç»“æœ</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">(1,1,0),(-1,1,0),(1,-1,0),(-1,-1,0),(1,0,1),(-1,0,1),(1,0,-1),(-1,0,-1),(0,1,1),(0,-1,1),(0,1,-1),(0,-1,-1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>é€‰å–ç»“æœç”± hash å‡½æ•°ç»“æœåå››ä½å†³å®šï¼ˆé€šè¿‡ <code>grad()</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°è¾“å…¥ï¼‰å¦å¤–ä¸‰ä¸ªå‚æ•°ç”¨æ¥è¡¨è¿°è·ç¦»å‘é‡ï¼ˆä»–ä»¬å°†ç”¨äºè®¡ç®—ç‚¹ç§¯ï¼‰</p><h3 id="å°†å‡½æ•°è¿èµ·æ¥">å°†å‡½æ•°è¿èµ·æ¥</h3><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">public double perlin(double x, double y, double z) &#123;    &#x2F;&#x2F; ...    double x1, x2, y1, y2;    x1 &#x3D; lerp(    grad (aaa, xf  , yf  , zf),           &#x2F;&#x2F; grad å‡½æ•°è®¡ç®—ç‚¹ç§¯                grad (baa, xf-1, yf  , zf),             &#x2F;&#x2F; æ¢¯åº¦å‘é‡ä¸è¾“å…¥å‘¨å›´å•ä½ç‚¹                u);    x2 &#x3D; lerp(    grad (aba, xf  , yf-1, zf),           &#x2F;&#x2F; å°†è¿™äº›ç‚¹åšçº¿æ€§æ’å€¼                grad (bba, xf-1, yf-1, zf),                  u);    y1 &#x3D; lerp(x1, x2, v);    x1 &#x3D; lerp(    grad (aab, xf  , yf  , zf-1),                grad (bab, xf-1, yf  , zf-1),                u);    x2 &#x3D; lerp(    grad (abb, xf  , yf-1, zf-1),                  grad (bbb, xf-1, yf-1, zf-1),                  u);    y2 &#x3D; lerp (x1, x2, v);    return (lerp (y1, y2, w)+1)&#x2F;2;                      &#x2F;&#x2F; å°†æ’å€¼ç»“æœä» [0, 1] è½¬ä¸º [-1, 1]&#125;&#x2F;&#x2F; çº¿æ€§æ’å€¼public static double lerp(double a, double b, double x) &#123;    return a + x * (b - a);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¤„ç†éœ‡å¹…">å¤„ç†éœ‡å¹…</h2><p>æˆ‘ä»¬è¦è®¨è®ºçš„æœ€åä¸€ä»¶äº‹æ˜¯å¦‚ä½•å¤„ç†æŸæ—å™ªå£°è®©ä»–çœ‹èµ·æ¥å¼€æ›´åŠ è‡ªç„¶ã€‚è™½ç„¶æŸæ—å™ªå£°ä¸€å®šç¨‹åº¦ä¸Šæ¨¡æ‹Ÿäº†è‡ªç„¶ç°è±¡ï¼Œä½†æ˜¯ä»–ä¸èƒ½å®Œå…¨æè¿°è‡ªç„¶ç•Œä¸­äººä»¬æœŸæœ›çš„æ‰€æœ‰è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåœ°å½¢å¯ä»¥åƒå±±ä¸€æ ·å¤§è€Œå®½å¹¿ï¼Œä¹Ÿå¯ä»¥åƒå°å±±ï¼Œç›†åœ°ä¸€æ ·å°ï¼Œè¿˜å¯ä»¥åƒå·¨çŸ³ä¸€æ ·å°ï¼Œç”šè‡³åƒé¹…åµçŸ³ä¸€æ ·å°ã€‚ï¼ˆè·å¾—ä¸åŒå°ºåº¦éœ‡å¹…ï¼‰æ–¹æ³•å¾ˆç®€å•ï¼šå¯ä»¥ç”Ÿæˆå„ç§å„æ ·çš„ä¸åŒéœ‡å¹…ä¸é¢‘ç‡çš„æŸæ—å™ªå£°å¹¶å°†ä»–ä»¬å åŠ åœ¨ä¸€èµ·ã€‚å½“ç„¶ï¼Œé¢‘ç‡æ˜¯é‡‡æ ·çš„å‘¨æœŸï¼Œéœ‡å¹…æ˜¯å˜åŒ–çš„èŒƒå›´ã€‚</p><p><img src="./ç†è§£æŸæ—å™ªå£°/octave01.png" /></p><p>æŠŠä¸Šå›¾å åŠ åœ¨ä¸€èµ·å°±å¾—åˆ°</p><p><img src="./ç†è§£æŸæ—å™ªå£°/octave02.png" /></p><p>æ˜¾ç„¶è¿™ä¸ªç»“æœå¾ˆæœ‰è¯´æœåŠ›ã€‚ä¸Šé¢å…­ç»„å™ªå£°æˆä¸ºä¸åŒæŒ¯å¹…çš„å™ªå£°ã€‚æ¯ä¸ªæŒ¯å¹…çš„å€¼å¯¹ç»“æœå½±å“å¾ˆå°ã€‚å½“ç„¶æ¯ä¸€ä¸ªæŒ¯å¹…ç”Ÿæˆéƒ½éœ€è¦çº¿æ€§æ—¶é—´å¤æ‚åº¦ï¼Œå› æ­¤åœ¨è¿è¡Œçš„æ—¶å€™ä¸è¦ç”¨å¤ªå¤šç»„æŒ¯å¹…å‡½æ•°ï¼ˆä¾‹å¦‚åœ¨ç”Ÿæˆ60FPSçš„ç«ç„°æ•ˆæœæ—¶ï¼‰ã€‚ç„¶è€Œï¼Œå¤šç»„éœ‡å¹…åœ¨é¢„å¤„ç†æ•°æ®ï¼ˆä¾‹å¦‚åœ¨ç”Ÿæˆåœ°å½¢æ—¶ï¼‰å¾ˆæœ‰æ•ˆã€‚</p><p>ä½†æ˜¯å¤šéœ‡å¹…å™ªå£°ä¼šåœ¨å¤šå¤§ç¨‹åº¦ä¸Šå½±å“æ•ˆç‡å‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨å¦ä¸€ä¸ªå«åš<strong>æŒä¹…æ€§</strong>çš„å˜é‡åº¦é‡ã€‚<span class="exturl" data-url="aHR0cDovL2ZyZWVzcGFjZS52aXJnaW4ubmV0L2h1Z28uZWxpYXMvbW9kZWxzL21fcGVybGluLmh0bQ==">HugoElias<i class="fa fa-external-link-alt"></i></span> æ˜¯è¿™æ ·å®šä¹‰æŒä¹…æ€§çš„ï¼š</p><blockquote><p><span class="math inline">\(é¢‘ç‡ = 2^i\)</span> <spanclass="math inline">\(éœ‡å¹… = æŒä¹…æ€§^i\)</span></p></blockquote><p><span class="math inline">\(i\)</span> å°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„éœ‡å¹…</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">public double OctavePerlin(double x, double y, double z, int octaves, double persistence) &#123;    double total &#x3D; 0;    double frequency &#x3D; 1;    double amplitude &#x3D; 1;    double maxValue &#x3D; 0;  &#x2F;&#x2F; é€šå¸¸èŒƒå›´åœ¨ 0.0 - 1.0    for(int i&#x3D;0;i&lt;octaves;i++) &#123;        total +&#x3D; perlin(x * frequency, y * frequency, z * frequency) * amplitude;        maxValue +&#x3D; amplitude;        amplitude *&#x3D; persistence;        frequency *&#x3D; 2;    &#125;    return total&#x2F;maxValue;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç»“è®º">ç»“è®º</h2><p>å°±æ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“å¦‚ä½•ç”Ÿæˆå™ªå£°äº†ã€‚æ­¤å¤–ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ‰€æœ‰æºç ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·åœ¨<span class="exturl" data-url="aHR0cHM6Ly9hZHJpYW5iLmlvLzIwMTQvMDgvMDkvcGVybGlubm9pc2UjZGlzcXVzX3RocmVhZA==">ä¸‹é¢è¯„è®ºåŒº<i class="fa fa-external-link-alt"></i></span>è¯„è®ºã€‚</p><h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3><p>è¿™æ˜¯ä¸€äº›å‚è€ƒèµ„æ–™ï¼Œå¦‚æœæ‚¨æœ‰å…´è¶£ï¼Œå¯ä»¥æŸ¥çœ‹ï¼š</p><ul><li><span class="exturl" data-url="aHR0cDovL21ybC5ueXUuZWR1L35wZXJsaW4vbm9pc2Uv">Ken Perlinçš„â€œå®˜æ–¹â€æ”¹è¿›æŸæ—å™ªå£°<i class="fa fa-external-link-alt"></i></span> - è¿™æ˜¯ Ken Perlin å†™çš„åŸå§‹ç®—æ³•.</li><li><span class="exturl" data-url="aHR0cDovL3dlYnN0YWZmLml0bi5saXUuc2UvfnN0ZWd1L1ROTTAyMi0yMDA1L3Blcmxpbm5vaXNlbGlua3MvcGVybGluLW5vaXNlLW1hdGgtZmFxLmh0bWw=">â€æŸæ—å™ªå£°å¸¸è§æ•°å­¦é—®é¢˜è§£ç­”â€œ<i class="fa fa-external-link-alt"></i></span>- è¿™æ˜¯å…³äºè¯¥ç®—æ³•éå¸¸æ£’çš„å‚è€ƒã€‚ç„¶è€Œï¼Œè®°ä½ä»–ä½¿ç”¨çš„ 1980å¹´ä»£çš„<em>åŸå§‹çš„</em>æŸæ—å™ªå£°ç®—æ³•ï¼Œå¹¶ä¸æ˜¯æœ¬æ–‡è®¨è®ºçš„ã€‚</li><li><span class="exturl" data-url="aHR0cDovL2ZyZWVzcGFjZS52aXJnaW4ubmV0L2h1Z28uZWxpYXMvbW9kZWxzL21fcGVybGluLmh0bQ==">HugoElias çš„è®ºæ–‡<i class="fa fa-external-link-alt"></i></span> -æœ€å—æ¬¢è¿çš„æŸæ—å™ªå£°æ–‡ç« ä¹‹ä¸€ã€‚è¿™æ˜¯ä¸€ä¸ªå…³äºéœ‡å¹…ä¸å®é™…åº”ç”¨æœ€å¥½çš„å‚è€ƒ.ç„¶è€Œ<strong>è¿™ä¸æ˜¯çœŸæ­£çš„æŸæ—å™ªå£°</strong>! Hugoçš„ç®—æ³•å¹¶<em>ä¸æ˜¯</em>åŸºäºæŸæ—å™ªå£°æ¢¯åº¦çš„ã€‚ç›¸åï¼Œå®ƒä½¿ç”¨çš„æ˜¯<em>å€¼å™ªå£°</em>ï¼Œæœ¬è´¨ä¸Šæ˜¯æ¨¡ç³Šçš„ç™½å™ªå£°ã€‚ä¸è¦æ··æ·†ä¸¤è€…ï¼</li><li><span class="exturl" data-url="aHR0cDovL2Rldm1hZy5vcmcuemEvMjAwOS8wNC8yNS9wZXJsaW4tbm9pc2Uv">"å¦‚ä½•åœ¨ä½ çš„æ¸¸æˆä¸­ä½¿ç”¨æŸæ—å™ªå£°"- Devmag<i class="fa fa-external-link-alt"></i></span> -ä¸€ç¯‡éå¸¸æ£’çš„å…³äºæŸæ—å™ªå£°çš„æ½œåœ¨ä½¿ç”¨çš„æ–‡ç« ã€‚è¿™æ˜¯éå¸¸æ£’çš„è¯»ç‰©ï¼Œä½†æ˜¯<strong>å†æ¬¡æ³¨æ„ï¼Œè¿™ä¸æ˜¯çœŸæ­£çš„æŸæ—å™ªå£°ï¼</strong>Devmag ä½¿ç”¨çš„æ˜¯å€¼å™ªå£°ã€‚</li><li><span class="exturl" data-url="aHR0cDovL2h0dHAuZGV2ZWxvcGVyLm52aWRpYS5jb20vR1BVR2VtczIvZ3B1Z2VtczJfY2hhcHRlcjI2Lmh0bWw=">GPUGems - "æ”¹è¿›æŸæ—å™ªå£°å®è·µ"<i class="fa fa-external-link-alt"></i></span> - æœ¬æ–‡åˆ©ç”¨ GPUçš„å¼ºå¤§åŠŸèƒ½ï¼Œä½¿ç”¨æŸæ—å™ªå£°<em>å®æ—¶</em>æ¸²æŸ“ä»¤äººæƒŠå¹çš„æµ·æ´‹ã€‚ç€è‰²å™¨å¾ˆé…·ï¼</li></ul><p>æ„Ÿè°¢ä½ çš„é˜…è¯»ï¼</p><h3 id="æ›´æ–°">æ›´æ–°</h3><p>8/9/14 - æˆ‘æ›´æ–°äº†æ›´å¤šå…³äºç‚¹ç§¯çš„è¡¨ç¤º, å¹¶ä¸”æˆ‘æ›´æ–°äº†ä¸€äº›é”™åˆ«å­—.éå¸¸æ„Ÿè°¢è¯¶ Reddit ç»™æˆ‘æä¾›çš„å»ºè®® <span class="exturl" data-url="aHR0cDovL3d3dy5yZWRkaXQuY29tL3IvcHJvZ3JhbW1pbmcvY29tbWVudHMvMmQyOHA2L3VuZGVyc3RhbmRpbmdfcGVybGluX25vaXNlX2FuX2luZGVwdGhfbG9va19hdF90aGUv">/r/programming<i class="fa fa-external-link-alt"></i></span>,<span class="exturl" data-url="aHR0cDovL3d3dy5yZWRkaXQuY29tL3IvZ2FtZWRldi9jb21tZW50cy8yZDI4NG4vdW5kZXJzdGFuZGluZ19wZXJsaW5fbm9pc2VfYW5faW5kZXB0aF9sb29rX2F0X3RoZS8=">/r/gamedev<i class="fa fa-external-link-alt"></i></span>,ä¸ <span class="exturl" data-url="aHR0cDovL3d3dy5yZWRkaXQuY29tL3IvVW5pdHkzRC9jb21tZW50cy8yZDI5amovdW5kZXJzdGFuZGluZ19wZXJsaW5fbm9pc2VfYW5faW5kZXB0aF9sb29rX2F0X3RoZS8=">/r/Unity3D<i class="fa fa-external-link-alt"></i></span>.</p>]]></content>
    
    
    <summary type="html">åŒ…å«æŸæ—å™ªå£°çš„åŸç†ä¸å®ç°, ç¿»è¯‘è‡ª:Understanding Perlin Noise</summary>
    
    
    
    <category term="å…¶ä»–" scheme="https://blog.liukairui.me/categories/%E5%85%B6%E4%BB%96/"/>
    
    
    <category term="æ•°å­¦" scheme="https://blog.liukairui.me/tags/%E6%95%B0%E5%AD%A6/"/>
    
    <category term="æ¸¸æˆ" scheme="https://blog.liukairui.me/tags/%E6%B8%B8%E6%88%8F/"/>
    
    <category term="ç¿»è¯‘" scheme="https://blog.liukairui.me/tags/%E7%BF%BB%E8%AF%91/"/>
    
  </entry>
  
  <entry>
    <title>ç†è§£å‚…é‡Œå¶å˜æ¢</title>
    <link href="https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/"/>
    <id>https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/</id>
    <published>2022-04-12T16:00:01.000Z</published>
    <updated>2022-04-12T16:00:01.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>p.s. å…¬å¼æœ‰ç‚¹å¤š, å¯èƒ½ä¼šå‡ºç°å…¬å¼åŠ è½½å¤±è´¥, å°è¯•åˆ·æ–°å³å¯</p></blockquote><p>æœ¬æ–‡åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ä»‹ç»å‚…é‡Œå¶å˜æ¢</p><ul><li>å‚…é‡Œå¶åˆ†æç›´è§‚ä½“éªŒ: æ¥è‡ª<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8xOTc2MzM1OA==">çŸ¥ä¹-å‚…é‡Œå¶åˆ†æä¹‹ææ­»æ•™ç¨‹<i class="fa fa-external-link-alt"></i></span></li><li>å‚…é‡Œå¶å±•å¼€ä¸å˜æ¢çš„æ¨å¯¼: æ¥è‡ª<span class="exturl" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMjMwMTA1NTc0L2NoYW5uZWwvc2VyaWVzZGV0YWlsP3NpZD0xNTY5NTk3">å“”å“©å“”å“©-çº¯å¹²è´§å‚…é‡Œå¶å˜æ¢<i class="fa fa-external-link-alt"></i></span></li><li>å‚…é‡Œå¶åº”ç”¨: æ¥è‡ª<span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMVg3NDExRjc0ND9wPTYmdD0xNzYzLjQ=">å“”å“©å“”å“©-ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦å…¥é—¨<i class="fa fa-external-link-alt"></i></span></li></ul><h2 id="å‚…é‡Œå¶åˆ†æç›´è§‚ä½“éªŒ">å‚…é‡Œå¶åˆ†æç›´è§‚ä½“éªŒ</h2><blockquote><p>æ³•å›½æ•°å­¦å®¶å‚…é‡Œå¶è®¤ä¸ºï¼Œä»»ä½•å‘¨æœŸå‡½æ•°éƒ½å¯ä»¥ç”¨æ­£å¼¦å‡½æ•°å’Œä½™å¼¦å‡½æ•°æ„æˆçš„æ— ç©·çº§æ•°æ¥è¡¨ç¤º</p></blockquote><h3 id="é¢‘åŸŸä¸æ—¶åŸŸ">é¢‘åŸŸä¸æ—¶åŸŸ</h3><p>æœ‰ä¸€æ®µå£°æ³¢, æˆ‘ä»¬å¯ä»¥å°†å…¶è¡¨ç¤ºä¸ºä¸€æ®µå£°æ³¢æ›²çº¿</p><figure><img src="./ç†è§£å‚…é‡Œå¶å˜æ¢/1-1.jpg" alt="å£°æ³¢-æ—¶åŸŸ" /><figcaption aria-hidden="true">å£°æ³¢-æ—¶åŸŸ</figcaption></figure><p>è¿™æ˜¯ä¸€ä¸ªæ—¶é—´ä¸å£°æ³¢çš„å‡½æ•°æ›²çº¿, æˆ‘ä»¬å°†å…¶ç§°ä¹‹ä¸ºå£°éŸ³çš„æ—¶åŸŸè¡¨è¾¾. ç„¶è€Œ,æˆ‘ä»¬æ²¡æ³•ä»å£°éŸ³ä¸­è·å¾—æ›´å¤šçš„ä¿¡æ¯(å¦‚ä»–ä»¬æ˜¯ç”±é‚£äº›éŸ³ç¬¦åˆæˆçš„?),æˆ‘ä»¬å¸Œæœ›ç”¨éŸ³ç¬¦çš„æ–¹å¼è¡¨è¾¾éŸ³ä¹(æ¯”å¦‚/duo/æ˜¯åœ¨é‚£äº›æ—¶å€™å‘å‡ºçš„,/ruai/æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™å‘å‡ºçš„?), æœ‰äº†è¿™äº›ä¿¡æ¯, æˆ‘ä»¬å°±å¯ä»¥åˆæˆè¿™æ®µå£°æ³¢,è¿™ç§°ä¸ºå£°æ³¢çš„é¢‘åŸŸè¡¨è¾¾</p><p>å‰é¢å£°æ³¢çš„ä¾‹å­ä¸­æ¨ªè½´æ˜¯æ—¶é—´, æˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾çš„å°†å…¶ç†è§£ä¸ºæ—¶åŸŸè¡¨è¾¾,å¯¹äºæ™®é€šå‡½æ•°å›¾åƒ, æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å…¶ç†è§£æˆæ—¶åŸŸè¡¨è¾¾. ä¾‹å¦‚, ä¸‹é¢æ˜¯ä¸€ä¸ªæ–¹æ³¢</p><figure><img src="./ç†è§£å‚…é‡Œå¶å˜æ¢/1-2.png" alt="æ–¹æ³¢-æ—¶åŸŸ" /><figcaption aria-hidden="true">æ–¹æ³¢-æ—¶åŸŸ</figcaption></figure><p>æˆ‘ä»¬å¯ä»¥è®¤ä¸ºå…¶æ˜¯æ–¹æ³¢çš„æ—¶åŸŸè¡¨è¾¾, åŒæ—¶,æˆ‘ä»¬å¯ä»¥ç”¨æ— ç©·ä¸ªä¸‰è§’å‡½æ•°çš„å’Œé€¼è¿‘ä»–</p><figure><img src="./ç†è§£å‚…é‡Œå¶å˜æ¢/1-3.jpg" alt="æ–¹æ³¢çš„é€¼è¿‘" /><figcaption aria-hidden="true">æ–¹æ³¢çš„é€¼è¿‘</figcaption></figure><p>æœ€å‰é¢é»‘è‰²çš„çº¿å°±æ˜¯æ‰€æœ‰æ­£å¼¦æ³¢å åŠ è€Œæˆçš„æ€»å’Œï¼Œä¹Ÿå°±æ˜¯è¶Šæ¥è¶Šæ¥è¿‘çŸ©å½¢æ³¢çš„é‚£ä¸ªå›¾å½¢ã€‚è€Œåé¢ä¾ä¸åŒé¢œè‰²æ’åˆ—è€Œæˆçš„æ­£å¼¦æ³¢å°±æ˜¯ç»„åˆä¸ºçŸ©å½¢æ³¢çš„å„ä¸ªåˆ†é‡,å…¶é¢‘åŸŸè¡¨è¾¾å¦‚ä¸‹</p><figure><img src="./ç†è§£å‚…é‡Œå¶å˜æ¢/1-4.jpg" alt="æ–¹æ³¢-é¢‘åŸŸ" /><figcaption aria-hidden="true">æ–¹æ³¢-é¢‘åŸŸ</figcaption></figure><p>çœ‹èµ·æ¥æ¯”è¾ƒå¥‡æ€ª, å®é™…ä¸Š, ä»–å°±æ˜¯ä»ä¾§é¢çœ‹å›¾</p><figure><img src="./ç†è§£å‚…é‡Œå¶å˜æ¢/1-5.jpg" alt="æ–¹æ³¢-æ—¶åŸŸé¢‘åŸŸ" /><figcaption aria-hidden="true">æ–¹æ³¢-æ—¶åŸŸé¢‘åŸŸ</figcaption></figure><p>æ›´åŠ å®Œæ•´çš„è¡¨ç¤º</p><figure><img src="./ç†è§£å‚…é‡Œå¶å˜æ¢/1-6.jpg" alt="æ–¹æ³¢-æ—¶åŸŸé¢‘åŸŸ" /><figcaption aria-hidden="true">æ–¹æ³¢-æ—¶åŸŸé¢‘åŸŸ</figcaption></figure><p>æˆ‘ä»¬ä¹Ÿå°†é¢‘åŸŸè¡¨ç¤ºå›¾ç§°ä¸ºæ—¶åŸŸçš„é¢‘è°±</p><h3 id="ç›¸ä½è°±">ç›¸ä½è°±</h3><p>åœ¨å‰é¢, æˆ‘ä»¬ä½¿ç”¨ä¸‰è§’å‡½æ•°ç´¯åŠ é€¼è¿‘ä¸€ä¸ªå‡½æ•°,ä¸€ä¸ªæè¿°ä¸‰è§’å‡½æ•°éœ€è¦æè¿°å…¶é¢‘ç‡, éœ‡å¹…, ç›¸ä½. é¢‘ç‡å°±æ˜¯é¢‘è°±çš„æ¨ªåæ ‡,éœ‡å¹…å¯ä»¥ç”¨é¢‘è°±çš„çºµåæ ‡è¡¨ç¤º, ä½†æ˜¯æˆ‘ä»¬æ²¡åŠæ³•è¡¨ç¤ºç›¸ä½.æ‰€ä»¥è¿˜éœ€è¦è¡¥å……ä¸€ä¸ªç›¸ä½è°±</p><figure><img src="./ç†è§£å‚…é‡Œå¶å˜æ¢/1-7.jpg" alt="æ–¹æ³¢-ç›¸ä½è°±" /><figcaption aria-hidden="true">æ–¹æ³¢-ç›¸ä½è°±</figcaption></figure><p>å…ˆæ‰¾å‡ºæ³¢å³°åˆ°é¢‘ç‡è½´çš„æ°´å¹³è·ç¦», åœ¨ç”¨è¿™ä¸ªå€¼<strong>é™¤ä»¥å‘¨æœŸ</strong>,å°±å¾—åˆ°äº†ç›¸ä½å¤§å­¦</p><h3 id="å‚…é‡Œå¶çº§æ•°åˆ°å‚…é‡Œå¶å˜æ¢">å‚…é‡Œå¶çº§æ•°åˆ°å‚…é‡Œå¶å˜æ¢</h3><p>å‚…é‡Œå¶è®¤ä¸ºå¯ä»¥ç”¨æ— ç©·ä¸ªé¢‘ç‡ä¾æ¬¡ä¸Šå‡çš„ä¸‰è§’å‡½æ•°çš„æ— ç©·çº§æ•°è´´è¿‘ä¸€ä¸ªå‡½æ•°,å°±åƒä¸‹é¢è¿™æ ·</p><figure><img src="./ç†è§£å‚…é‡Œå¶å˜æ¢/1-8.jpg" alt="å‚…ç«‹å¶çº§æ•°å±•å¼€" /><figcaption aria-hidden="true">å‚…ç«‹å¶çº§æ•°å±•å¼€</figcaption></figure><p>å¦‚æœå¿½ç•¥çº§æ•°, å°†é¢‘ç‡ä¹‹é—´çš„å·®å€¼å˜å°å‘¢? ä»ç´¯åŠ <spanclass="math inline">\(\sum_{n=0}^{\infty}f_n(x)\)</span>å˜æˆäº†<spanclass="math inline">\(\int_0^{\infty}f_\omega(x)d\omega\)</span></p><figure><img src="./ç†è§£å‚…é‡Œå¶å˜æ¢/1-9.jpg" alt="\Delta\omega\to 0" /><figcaption aria-hidden="true"><spanclass="math inline">\(\Delta\omega\to 0\)</span></figcaption></figure><p>è¿™å°±æ˜¯ä»å‚…é‡Œå¶çº§æ•°åˆ°å‚…é‡Œå¶å˜æ¢çš„è¿‡ç¨‹</p><p><strong>å‚…é‡Œå¶å˜æ¢å°±æ˜¯å°†æ—¶åŸŸè¡¨ç¤ºè½¬æ¢ä¸ºé¢‘åŸŸè¡¨ç¤º.é€†å‚…é‡Œå¶å˜æ¢å°±æ˜¯å°†é¢‘åŸŸè¡¨ç¤ºè½¬æ¢ä¸ºæ—¶åŸŸè¡¨ç¤º</strong></p><h3 id="å°†ä¸‰è§’å‡½æ•°è¡¨ç¤ºåœ¨é¢‘è°±ä¸Š">å°†ä¸‰è§’å‡½æ•°è¡¨ç¤ºåœ¨é¢‘è°±ä¸Š</h3><p>é¢‘è°±çœ‹èµ·æ¥å¾ˆå¥½ç”», æ¯”å¦‚ä¸Šå›¾, ä»ä¾§é¢è§‚æµ‹ä¸€ä¸‹, æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°é¢‘è°±,ä½†æ˜¯æœ‰ä¸ªå°é—®é¢˜, åœ¨çº§æ•°é‚£é‡Œ, æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ä¸‰è§’å‡½æ•°ä¹‹é—´å¤¹ç€çš„çš„å½©è‰²ç›´çº¿,é‚£äº›ä¹Ÿæ˜¯å‚ä¸ç´¯åŠ çš„ä¸‰è§’å‡½æ•°, æ³¢æµªçš„æ˜¯<spanclass="math inline">\(\cos\)</span>å‡½æ•°, ç›´çº¿æ˜¯<spanclass="math inline">\(\sin\)</span>å‡½æ•°, åªä¸è¿‡<spanclass="math inline">\(\omega = 0\)</span>, æ‰€ä»¥è¡¨è¾¾æˆäº†ç›´çº¿,æˆ‘ä»¬å¦‚ä½•ç”¨ä¸€ä¸ªæ•°åŒæ—¶è¡¨è¾¾<span class="math inline">\(\cos\)</span>ä¸<spanclass="math inline">\(\sin\)</span>çš„é¢‘ç‡å‘¢? å€Ÿç”¨å¤å¹³é¢ä¸æ¬§æ‹‰å…¬å¼</p><figure><img src="./ç†è§£å‚…é‡Œå¶å˜æ¢/1-10.jpg" alt="æ¬§æ‹‰å…¬å¼çš„å¤å¹³é¢è¡¨ç¤º" /><figcaption aria-hidden="true">æ¬§æ‹‰å…¬å¼çš„å¤å¹³é¢è¡¨ç¤º</figcaption></figure><p>æœ€åå¾—åˆ°å‚…é‡Œå¶å˜æ¢é¢‘è°±</p><figure><img src="./ç†è§£å‚…é‡Œå¶å˜æ¢/1-11.jpg" alt="æ–¹æ³¢çš„å®Œæ•´ç›¸ä½è°±" /><figcaption aria-hidden="true">æ–¹æ³¢çš„å®Œæ•´ç›¸ä½è°±</figcaption></figure><h2 id="å‚…é‡Œå¶å˜æ¢æ¨å¯¼">å‚…é‡Œå¶å˜æ¢æ¨å¯¼</h2><h3 id="ä¸‰è§’å‡½æ•°æ­£äº¤æ€§">ä¸‰è§’å‡½æ•°æ­£äº¤æ€§</h3><ul><li><p>ä¸‰è§’å‡½æ•°ç³»å®šä¹‰å¦‚ä¸‹:</p><p><span class="math display">\[  \{ 1, \sin x, \cos x, \ldots, \sin nx, \cos nx, \ldots , \sin mx, \cosmx, \ldots \}  \]</span></p><p>åœ¨è¿™é‡Œ, å¯ä»¥å°†<span class="math inline">\(1\)</span>çœ‹ä½œæ˜¯<spanclass="math inline">\(\cos 0x\)</span>,è¿˜å¯ä»¥ä¸ºä¸‰è§’å‡½æ•°ç³»åŠ ä¸Šä¸€ä¸ªå…ƒç´ <spanclass="math inline">\(0\)</span>(å³<span class="math inline">\(\sin0x\)</span>)</p></li><li><p>æ­£äº¤å‡½æ•°å®šä¹‰å¦‚ä¸‹:</p><blockquote><p>è‹¥<span class="math inline">\(f(x)\)</span>, <spanclass="math inline">\(g(x)\)</span>åœ¨åŒºé—´<spanclass="math inline">\([a,b]\)</span>ä¸Šæœ‰å®šä¹‰, ä¸” <spanclass="math display">\[\int_a^b f(t)g(t)dt = 0\]</span> é‚£ä¹ˆå°±è¯´<span class="math inline">\(f(x),g(x)\)</span>åœ¨åŒºé—´<span class="math inline">\([a,b]\)</span>ä¸Šæ­£äº¤</p></blockquote></li><li><p>ä¸‰è§’å‡½æ•°ç³»çš„æ­£äº¤æ€§: ä»»æ„ä¸¤ä¸ªä¸‰è§’å‡½æ•°ç³»çš„å‡½æ•°(<spanclass="math inline">\(m\neq n\)</span>)çš„ç§¯åœ¨åŒºé—´é•¿åº¦ä¸º<spanclass="math inline">\(2\pi\)</span>çš„åŒºé—´ä¸Šå†…ç§¯åˆ†ä¸º<spanclass="math inline">\(0\)</span>, è¯æ˜å¦‚ä¸‹:</p><p>é¦–é€‰é€‰å–ç§¯åˆ†èŒƒå›´ä¸º<span class="math inline">\([-\pi,\pi]\)</span>(å…¶ä»–åŒºé—´å¯ä»¥ç”±å‘¨æœŸå‡½æ•°æ€§è´¨æ¨å¾—)</p><ul><li><p>è‹¥é€‰å–<span class="math inline">\(f(x) = \sin nx\)</span>, <spanclass="math inline">\(g(x) = \cos mx\)</span>, ç§¯åˆ†ä¸º <spanclass="math display">\[  \int_{-\pi}^\pi \sin nx \ \cos mx \ dx  \]</span> ç”±å¥‡å‡½æ•°æ€§è´¨å¯çŸ¥ç§¯åˆ†ä¸º<spanclass="math inline">\(0\)</span></p></li><li><p>è‹¥é€‰å–<span class="math inline">\(f(x) = \cos nx\)</span>, <spanclass="math inline">\(g(x) = \cos mx\)</span>, ç§¯åˆ†ä¸º <spanclass="math display">\[  \int_{-\pi}^\pi \cos nx \ \cos mx \ dx  \]</span> ç”±ç§¯åŒ–å’Œå·®å…¬å¼</p><blockquote><p><span class="math display">\[\cos \alpha \ \cos \beta =\frac{1}{2}[\cos(\alpha+\beta)+\cos(\alpha-\beta)]\]</span></p></blockquote><p>çŸ¥,</p><ul><li><p>å½“<span class="math inline">\(m \neq n\)</span>æ—¶: <spanclass="math display">\[  \begin{align}  &amp; \int_{-\pi}^\pi \cos nx \ \cos mx \ dx \\  = &amp; \int_{-\pi}^\pi \frac{1}{2} [ \cos (n+m) x + \cos (n-m) x ] \dx \\  = &amp; \frac{1}{2}\left[\int_{-\pi}^\pi \cos (n+m)x \ dx+\int_{-\pi}^\pi \cos (n-m)x \ dx \right]\\  = &amp; \frac{1}{2}\left[\left. \frac{1}{m+n} \sin(n+m)x  \right|_{-\pi}^\pi + \left. \frac{1}{m-n} \sin(n-m)x  \right|_{-\pi}^\pi\right]\\  = &amp; 0  \end{align}  \]</span></p></li><li><p>é¡ºä¾¿çœ‹ä¸€ä¸‹å½“<span class="math inline">\(m = n\)</span>æ—¶: <spanclass="math display">\[  \begin{align}  &amp; \int_{-\pi}^\pi \cos nx \ \cos mx \ dx \\  = &amp; \int_{-\pi}^\pi \frac{1}{2} [ \cos 2n x + \cos 0 x ] \ dx \\  = &amp; \frac{1}{2}\int_{-\pi}^\pi cos 2nx \ dx + \pi \\  = &amp; 0 + \pi \\  = &amp; \pi  \end{align}  \]</span></p></li></ul></li><li><p>è‹¥é€‰å–<span class="math inline">\(f(x) = \sin nx\)</span>, <spanclass="math inline">\(g(x) = \sin mx\)</span>, ç§¯åˆ†ä¸º</p><p><span class="math display">\[  \int_{-\pi}^\pi \sin nx \ \sin mx \ dx  \]</span> ç”±ç§¯åŒ–å’Œå·®å…¬å¼</p><blockquote><p><span class="math display">\[\sin \alpha \ \sin \beta =-\frac{1}{2}[\cos(\alpha+\beta)-\cos(\alpha-\beta)]\]</span></p></blockquote><p>çŸ¥,</p><ul><li><p>å½“<span class="math inline">\(m \neq n\)</span>æ—¶: <spanclass="math display">\[\begin{align}&amp; \int_{-\pi}^\pi \sin nx \ \sin mx \ dx \\= &amp; \int_{-\pi}^\pi -\frac{1}{2} [ \cos (n+m) x - \cos (n-m) x ] \dx \\= &amp; -\frac{1}{2}\left[\int_{-\pi}^\pi \cos (n+m)x \ dx-\int_{-\pi}^\pi \cos (n-m)x \ dx \right]\\= &amp; - \frac{1}{2}\left[\left. \frac{1}{m+n} \sin(n+m)x  \right|_{-\pi}^\pi - \left. \frac{1}{m-n} \sin(n-m)x  \right|_{-\pi}^\pi\right]\\= &amp; 0\end{align}\]</span></p></li><li><p>é¡ºä¾¿çœ‹ä¸€ä¸‹å½“<span class="math inline">\(m = n\)</span>æ—¶: <spanclass="math display">\[\begin{align}&amp; \int_{-\pi}^\pi \sin nx \ \sin mx \ dx \\= &amp; \int_{-\pi}^\pi -\frac{1}{2} [ \cos 2n x - \cos 0 x ] \ dx \\= &amp; -\frac{1}{2}\int_{-\pi}^\pi cos 2nx \ dx  +\pi \\= &amp; 0 + \pi \\= &amp; \pi\end{align}\]</span></p></li></ul></li></ul><p>è‡³æ­¤, è¯æ˜äº†ä¸‰è§’å‡½æ•°æ­£äº¤æ€§</p></li></ul><h3 id="å‘¨æœŸä¸º2piå‡½æ•°çš„å‚…é‡Œå¶å±•å¼€">å‘¨æœŸä¸º<spanclass="math inline">\(2\pi\)</span>å‡½æ•°çš„å‚…é‡Œå¶å±•å¼€</h3><p>å‡è®¾<span class="math inline">\(f(x) = f(x+2\pi)\)</span>,å‚…é‡Œå¶çº§æ•°å¯ä»¥ç†è§£ä¸º: å‘¨æœŸä¸º<spanclass="math inline">\(2\pi\)</span>çš„å‡½æ•°å¯ä»¥è¡¨ç¤ºä¸ºæ— é™ä¸ªä¸‰è§’å‡½æ•°çš„å’Œ(å…·ä½“åŸå› éœ€è¦å‚è€ƒä¿¡å·ç³»ç»Ÿè¯¾ç¨‹),æŒ‰ç…§è¿™æ ·çš„æ€æƒ³, æˆ‘ä»¬å†™ä¸‹æœ´ç´ çš„è¡¨è¾¾å¼</p><p><span class="math display">\[f(x) = \sum_{n=0}^{+\infty} a_n \cos nx + \sum_{n=0}^{+\infty}b_n \sinnx\]</span> æ•™æä¸Šå®šä¹‰</p><blockquote><p><span class="math display">\[f(x) = \frac{a_0}{2} + \sum_{n=1}^{+\infty} a_n \cos nx +\sum_{n=1}^{+\infty}b_n \sin nx\]</span></p></blockquote><p>æœ‰äº›å‡ºå…¥, å°è¯•å°†<spanclass="math inline">\(n=0\)</span>å•ç‹¬æ‹¿å‡ºæ¥</p><p><span class="math display">\[\begin{align}f(x) &amp; = a_0 \cos 0x + b_0 \sin 0x + \sum_{n=1}^{+\infty} a_n \cosnx + \sum_{n=1}^{+\infty}b_n \sin nx \\&amp; = a_0 + \sum_{n=1}^{+\infty} a_n \cos nx + \sum_{n=1}^{+\infty}b_n\sin nx\end{align}\]</span> ä¸æ•™æä¸Šçš„<spanclass="math inline">\(\frac{a_0}{2}\)</span>æœ‰äº›å‡ºå…¥, ä½†æ˜¯<spanclass="math inline">\(a_0\)</span>æ˜¯ä¸ªå¸¸æ•°, å½¢å¼æ˜¯ä»€ä¹ˆæ ·å¼æ— æ‰€è°“,</p><ul><li><p>ä¸å¦¨å…ˆæ±‚å‡º<span class="math inline">\(a_0\)</span></p><p>æˆ‘ä»¬å‘ç°ä¸¤ä¸ª<spanclass="math inline">\(\sum\)</span>ä¸­éƒ½æœ‰ä¸€ä¸ªä¸‰è§’å‡½æ•°, ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯<spanclass="math inline">\(\cos 0x \times ä¸‰è§’å‡½æ•°\)</span>,å¦‚æœå¯¹å…¶åšä¸€ä¸ªåŒºé—´é•¿ä¸º<span class="math inline">\(2\pi\)</span>çš„ç§¯åˆ†,ç»“æœä¸º<span class="math inline">\(0\)</span>, è¿™æ ·å°±å¯ä»¥æ¶ˆå»<spanclass="math inline">\(a_n\)</span>äº†. <span class="math display">\[  \begin{align}  \int_{-\pi}^\pi f(x) dx &amp; = \int_{-\pi}^\pi a_0 \ dx +\int_{-\pi}^\pi \sum_{n=1}^{+\infty}a_n \cos nx\ dx + \int_{-\pi}^\pi\sum_{n=1}^{+\infty}b_n \sin nx\ dx \\  \int_{-\pi}^\pi f(x) dx &amp; = \int_{-\pi}^\pi a_0 \ dx+  \sum_{n=1}^{+\infty} a_n  \int_{-\pi}^\pi \cos nx\ dx+\sum_{n=1}^{+\infty}b_n \int_{-\pi}^\pi \sin nx\ dx \\  \int_{-\pi}^\pi f(x) dx &amp; = \int_{-\pi}^\pi a_0 \ dx \\  \int_{-\pi}^\pi f(x) dx &amp; = 2\pi a_0\\  a_0 &amp; = \frac{\int_{-\pi}^\pi f(x) dx}{2 \pi}  \end{align}  \]</span> è¿™é‡Œçš„<spanclass="math inline">\(a_0\)</span>å°±æ˜¯æ•™æä¸Š<spanclass="math inline">\(\frac{a_0}{2}\)</span>, å³æ•™æä¸Šçš„<spanclass="math inline">\(a_0 = \frac{\int_{-\pi}^\pi f(x)dx}{\pi}\)</span>, æ•™æä¸Šä½¿ç”¨<spanclass="math inline">\(\frac{a_0}{2}\)</span>è¡¨ç¤ºå°±æ˜¯ä¸ºäº†å½¢å¼ä¸Šçš„å¥½çœ‹,æ¯•ç«Ÿ<span class="math inline">\(a_0\)</span>æ˜¯ä¸ªå¸¸æ•°</p></li><li><p>ç»§ç»­æ±‚å‡º<span class="math inline">\(a_n\)</span></p><p>ä¸æ±‚<span class="math inline">\(a_0\)</span>æ€è·¯ä¸€æ ·,æˆ‘ä»¬å¸Œæœ›æ¶ˆé™¤æ‰€æœ‰æœ‰<span class="math inline">\(b_n sin\ nx\)</span>çš„é¡¹,å°† <span class="math display">\[  \begin{align}  f(x) = a_0 + \sum_{n=1}^{+\infty} a_n \cos nx +\sum_{n=1}^{+\infty}b_n \sin nx  \end{align}  \]</span> çš„ä¸¤è¾¹åŒæ—¶ä¹˜<span class="math inline">\(\cosmx\)</span>å¹¶åœ¨é•¿ä¸º<spanclass="math inline">\(2\pi\)</span>çš„åŒºé—´ä¸Šç§¯åˆ†,æˆ‘ä»¬å°±å¯ä»¥æ„é€ å‡º$_{-}^Â mx Â nx $, æ ¹æ®å¥‡å‡½æ•°æ€§è´¨,æˆ‘ä»¬çŸ¥é“è¿™ä¸€é¡¹æ’ç­‰äº<span class="math inline">\(0\)</span>(æ— è®º<spanclass="math inline">\(m\)</span>æ˜¯å¦ç­‰äº<spanclass="math inline">\(n\)</span>), äºæ˜¯å¾—å‡º <spanclass="math display">\[  \begin{align}  \int_{-\pi}^\pi f(x) \cos\ mx\ dx &amp; = \int_{-\pi}^\pi a_0\cos\ mx\dx + \int_{-\pi}^\pi  \sum_{n=1}^{+\infty} a_n \cos nx \cos mx\ dx+\int_{-\pi}^\pi  \sum_{n=1}^{+\infty}b_n \sin nx \cos\ mx\ dx \\  \int_{-\pi}^\pi f(x) \cos\ mx\ dx &amp; = \int_{-\pi}^\pi a_0\cos\ mx\dx + \sum_{n=1}^{+\infty} a_n \int_{-\pi}^\pi \cos nx \cos mx\ dx +\sum_{n=1}^{+\infty}b_n \int_{-\pi}^\pi\sin nx \cos\ mx\ dx \\  \int_{-\pi}^\pi f(x) \cos\ mx\ dx &amp; = \int_{-\pi}^\pi a_0\cos\ mx\dx + \sum_{n=1}^{+\infty} a_n \int_{-\pi}^\pi \cos nx \cos mx\ dx + 0 \\  \end{align}  \]</span> å½“<span class="math inline">\(n \neq m\)</span>æ—¶,æ ¹æ®ä¸‰è§’å‡½æ•°æ­£äº¤æ€§, <span class="math inline">\(\int_{-\pi}^\pi \cos nx\cos mx\ dx = 0\)</span>, å³ <span class="math display">\[  \begin{align}  \int_{-\pi}^\pi f(x) \cos\ mx\ dx &amp; = \int_{-\pi}^\pi a_0\cos\ mx\dx + a_m \int_{-\pi}^\pi \cos mx \cos mx\ dx \\  \end{align}  \]</span> åœ¨æ±‚ä¸‰è§’å‡½æ•°æ­£äº¤æ€§æ—¶, æˆ‘ä»¬æ¨å‡ºè¿‡<spanclass="math inline">\(\int_{-\pi}^\pi \cos mx \cos mx\ dx =\pi\)</span>, å³ <span class="math display">\[  \begin{align}  \int_{-\pi}^\pi f(x) \cos\ mx\ dx &amp; = \int_{-\pi}^\pi a_0\cos\ mx\dx + a_m \pi \\  \end{align}  \]</span> ç»§ç»­ç®€åŒ–, æˆ‘ä»¬çŸ¥é“<span class="math inline">\(m=n\)</span>,è€Œ<span class="math inline">\(n\in [1,\infty)\)</span>, å³<spanclass="math inline">\(m\neq 0\)</span> <span class="math display">\[  \begin{align}  \int_{-\pi}^\pi f(x) \cos\ mx\ dx &amp; = \int_{-\pi}^\pi a_0\cos\ mx\dx + a_m \pi \\  \int_{-\pi}^\pi f(x) \cos\ mx\ dx &amp; = a_0\int_{-\pi}^\pi \cos\ 0x\cos\ mx\ dx + a_m \pi \\  \int_{-\pi}^\pi f(x) \cos\ mx\ dx &amp; = a_m \pi \\  a_m &amp; = \frac{\int_{-\pi}^\pi f(x) \cos\ mx\ dx }{\pi}  \end{align}  \]</span> äºæ˜¯å¾—åˆ° <span class="math display">\[  a_n  = \frac{\int_{-\pi}^\pi f(x) \cos\ nx\ dx }{\pi}  \]</span> å®é™…ä¸Š, åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°, å½“<spanclass="math inline">\(n=0\)</span>æ—¶, <span class="math inline">\(a_0 =\frac{\int_{-\pi}^\pi f(x) \cos\ 0x\ dx }{\pi}= \frac{\int_{-\pi}^\pif(x) dx }{\pi}\)</span>ä¸æ•™æä¸­<spanclass="math inline">\(a_0\)</span>æ˜¯ä¸€æ ·çš„, è¿™å°±æ˜¯æ•™æç”¨<spanclass="math inline">\(\frac{a_0}{2}\)</span>å½¢å¼çš„åŸå› </p></li><li><p>ç»§ç»­æ±‚å‡º<span class="math inline">\(b_n\)</span></p><p>ä¸æ±‚<span class="math inline">\(b_n\)</span>æ€è·¯ä¸€æ ·,æˆ‘ä»¬å¸Œæœ›æ¶ˆé™¤æ‰€æœ‰æœ‰<span class="math inline">\(a_n \cos\ nx\)</span>çš„é¡¹,å°† <span class="math display">\[\begin{align}f(x) = a_0 + \sum_{n=1}^{+\infty} a_n \cos nx + \sum_{n=1}^{+\infty}b_n\sin nx\end{align}\]</span> çš„ä¸¤è¾¹åŒæ—¶ä¹˜<span class="math inline">\(\sinmx\)</span>å¹¶åœ¨é•¿ä¸º<spanclass="math inline">\(2\pi\)</span>çš„åŒºé—´ä¸Šç§¯åˆ†,æˆ‘ä»¬å°±å¯ä»¥æ„é€ å‡º$_{-}^Â mx Â nx $, æ ¹æ®å¥‡å‡½æ•°æ€§è´¨,æˆ‘ä»¬çŸ¥é“è¿™ä¸€é¡¹æ’ç­‰äº<span class="math inline">\(0\)</span>(æ— è®º<spanclass="math inline">\(m\)</span>æ˜¯å¦ç­‰äº<spanclass="math inline">\(n\)</span>), äºæ˜¯å¾—å‡º <spanclass="math display">\[\begin{align}\int_{-\pi}^\pi f(x) \sin\ mx\ dx &amp; = \int_{-\pi}^\pi a_0\sin\ mx\dx + \int_{-\pi}^\pi  \sum_{n=1}^{+\infty} a_n \cos nx \sin mx\ dx+\int_{-\pi}^\pi  \sum_{n=1}^{+\infty}b_n \sin nx \sin\ mx\ dx \\\int_{-\pi}^\pi f(x) \sin\ mx\ dx &amp; = \int_{-\pi}^\pi a_0\sin\ mx\dx + \sum_{n=1}^{+\infty} a_n \int_{-\pi}^\pi \cos nx \sin mx\ dx +\sum_{n=1}^{+\infty}b_n \int_{-\pi}^\pi \sin nx \sin\ mx\ dx \\\int_{-\pi}^\pi f(x) \sin\ mx\ dx &amp; = \int_{-\pi}^\pi a_0\sin\ mx\dx + \sum_{n=1}^{+\infty} a_n \times 0 + \sum_{n=1}^{+\infty}b_n\int_{-\pi}^\pi \sin nx \sin\ mx\ dx \\\int_{-\pi}^\pi f(x) \sin\ mx\ dx &amp; = \int_{-\pi}^\pi a_0\sin\ mx\dx + \sum_{n=1}^{+\infty}b_n \int_{-\pi}^\pi \sin nx \sin\ mx\ dx \\\end{align}\]</span> å½“<span class="math inline">\(n \neq m\)</span>æ—¶,æ ¹æ®ä¸‰è§’å‡½æ•°æ­£äº¤æ€§, <span class="math inline">\(\int_{-\pi}^\pi \sin nx\sin\ mx\ dx = 0\)</span>, å³ <span class="math display">\[\begin{align}\int_{-\pi}^\pi f(x) \sin\ mx\ dx &amp; = \int_{-\pi}^\pi a_0\sin\ mx\dx + b_m \int_{-\pi}^\pi \sin mx \sin\ mx\ dx\end{align}\]</span> åœ¨æ±‚ä¸‰è§’å‡½æ•°æ­£äº¤æ€§æ—¶, æˆ‘ä»¬æ¨å‡ºè¿‡<spanclass="math inline">\(\int_{-\pi}^\pi \sin mx \sin mx\ dx =\pi\)</span>, å³ <span class="math display">\[\begin{align}\int_{-\pi}^\pi f(x) \sin\ mx\ dx &amp; = \int_{-\pi}^\pi a_0\sin\ mx\dx + b_m \pi \\\end{align}\]</span> ç»§ç»­ç®€åŒ–, æˆ‘ä»¬çŸ¥é“<span class="math inline">\(m=n\)</span>,è€Œ<span class="math inline">\(n\in [1,\infty)\)</span>, å³<spanclass="math inline">\(m\neq 0\)</span> <span class="math display">\[\begin{align}\int_{-\pi}^\pi f(x) \sin\ mx\ dx &amp; = \int_{-\pi}^\pi a_0\sin\ mx\dx + b_m \pi \\\int_{-\pi}^\pi f(x) \sin\ mx\ dx &amp; = a_0\int_{-\pi}^\pi \cos\0x\sin\ mx\ dx + b_m \pi \\\int_{-\pi}^\pi f(x) \sin\ mx\ dx &amp; = b_m \pi \\b_m = \frac{\int_{-\pi}^\pi f(x) \sin\ mx\ dx}{\pi}\end{align}\]</span> äºæ˜¯å¾—åˆ° <span class="math display">\[b_n = \frac{\int_{-\pi}^\pi f(x) \sin\ nx\ dx}{\pi}\]</span></p></li></ul><p>æœ€åå¾—åˆ°å‘¨æœŸä¸º<spanclass="math inline">\(2\pi\)</span>å‡½æ•°çš„å‚…é‡Œå¶å±•å¼€ <spanclass="math display">\[\begin{align}f(x) &amp;= f(x+2\pi)\\f(x) &amp;= \frac{a_0}{2} + \sum_{n=1}^{\infty} a_n \cos\ nx+\sum_{n=1}^{\infty} b_n \sin\ nx\\a_n &amp;= \frac{\int_{-\pi}^\pi f(x) \cos\ nx\ dx }{\pi}\\b_n &amp;= \frac{\int_{-\pi}^\pi f(x) \sin\ nx\ dx}{\pi}\\\end{align}\]</span></p><h3 id="å‘¨æœŸä¸ºtå‡½æ•°çš„å‚…é‡Œå¶å±•å¼€">å‘¨æœŸä¸º<spanclass="math inline">\(T\)</span>å‡½æ•°çš„å‚…é‡Œå¶å±•å¼€</h3><p>ä½¿ç”¨æ¢å…ƒå°†<span class="math inline">\(f(x)\)</span>çš„å‘¨æœŸä»<spanclass="math inline">\(2\pi\)</span>æ¨å¹¿åˆ°<spanclass="math inline">\(T\)</span>,æˆ‘ä»¬éœ€è¦å°†ä¸‰è§’å‡½æ•°çš„å‘¨æœŸä¸ç§¯åˆ†åŒºé—´é•¿åº¦å˜æˆ<spanclass="math inline">\(T\)</span>, å³å¯¹äºä¸‰è§’å‡½æ•°æœ‰ <spanclass="math display">\[\begin{align}\frac{2\pi}{\omega} &amp; = T\\\omega &amp; = \frac{2\pi}{T}\\\end{align}\]</span> é€‰å–ç§¯åˆ†åŒºé—´<spanclass="math inline">\([0,T]\)</span>(é€‰å“ªé‡Œéƒ½å¯ä»¥,åªè¦æ˜¯ä¸€ä¸ªå‘¨æœŸå°±è¡Œ)å¯¹å‚æ•°å˜æ¢ <span class="math display">\[\begin{align}\cos x \to \cos \omega x \\\sin x \to \sin \omega x \\\end{align}\]</span></p><p><span class="math display">\[\begin{align}a_n &amp;= \frac{\int_{-\pi}^\pi f(x) \cos\ nx\ dx }{\pi} &amp;\to a_n&amp;= \frac{2\int_0^T f(x) \cos\ n\omega x\ dx }{T} \\b_n &amp;= \frac{\int_{-\pi}^\pi f(x) \sin\ nx\ dx }{\pi} &amp;\to b_n&amp;= \frac{2\int_0^T f(x) \sin\ n\omega x\ dx }{T} \\\end{align}\]</span> å¾—åˆ°å‘¨æœŸä¸º<spanclass="math inline">\(T\)</span>å‡½æ•°çš„å‚…é‡Œå¶å±•å¼€ <spanclass="math display">\[\begin{align}f(x) &amp; = \frac{a_0}{2} + \sum_{n=1}^{\infty} a_n \cos\ n\omega x +\sum_{n=1}^{\infty} b_n \sin\ n\omega x\\a_n &amp; = \frac{2\int_0^T f(x) \cos\ n\omega x\ dx }{T} \\b_n &amp; = \frac{2\int_0^T f(x) \sin\ n\omega x\ dx }{T} \\\omega &amp; = \frac{2\pi}{T}\end{align}\]</span></p><h3 id="å‚…é‡Œå¶çº§æ•°çš„å¤æ•°å½¢å¼">å‚…é‡Œå¶çº§æ•°çš„å¤æ•°å½¢å¼</h3><p>åˆ©ç”¨æ¬§æ‹‰å…¬å¼</p><blockquote><p><span class="math display">\[e^{i\theta} = \cos\theta + i\sin\theta\]</span></p></blockquote><p>ä»¤<span class="math inline">\(\theta&#39; =-\theta\)</span>æˆ‘ä»¬å¯ä»¥ç›¸åŠ å‡å¾—åˆ° <span class="math display">\[\begin{align}\cos\theta &amp;= \frac{1}{2} (e^{i\theta}+e^{-i\theta})\\\sin\theta &amp;= -\frac{1}{2}i (e^{i\theta}-e^{-i\theta})\\\end{align}\]</span> å¸¦å…¥å‘¨æœŸä¸º<span class="math inline">\(T\)</span>çš„å‚…é‡Œå¶å±•å¼€<span class="math display">\[\begin{align}f(x) &amp; = \frac{a_0}{2} + \sum_{n=1}^{\infty}\frac{1}{2}a_n  (e^{in\omega x}+e^{-in\omega x}) - \sum_{n=1}^{\infty}\frac{1}{2}ib_n (e^{in\omega x}-e^{-in\omega x})  \\\end{align}\]</span> åˆ†åˆ«å°†<span class="math inline">\(e^{in\omegat}\)</span>ä¸<span class="math inline">\(e^{-in\omega t}\)</span>åˆå¹¶<span class="math display">\[\begin{align}f(x) &amp; = \frac{a_0}{2} + \sum_{n=1}^{\infty}\frac{1}{2}(a_n-ib_n)e^{in\omega x}+\sum_{n=1}^{\infty}\frac{1}{2}(a_n+ib_n)e^{-in\omega x}\end{align}\]</span> æˆ‘ä»¬å‘ç°åä¸¤é¡¹å…·æœ‰ç±»ä¼¼çš„<spanclass="math inline">\(\frac{1}{2}(a_n?ib_n)e^{?in\omegax}\)</span>çš„ç»“æ„, å°†ååŠéƒ¨åˆ†çš„<spanclass="math inline">\(n\)</span>æ¢å…ƒä¸º<spanclass="math inline">\(-n\)</span> <span class="math display">\[\begin{align}f(x) &amp; = \frac{a_0}{2} + \sum_{n=1}^{\infty}\frac{1}{2}(a_n-ib_n)e^{in\omega x}+\sum_{n=-\infty}^{-1}\frac{1}{2}(a_{-n}+ib_{-n})e^{in\omega x}\end{align}\]</span> å°è¯•å°†åŒæ ·çš„ç»“æ„åº”ç”¨äº<spanclass="math inline">\(\frac{a_0}{2}\)</span>, äºæ˜¯å¾—åˆ° <spanclass="math display">\[\frac{a_0}{2} = \sum_{n=0}^{0}\frac{1}{2}(a_0)e^{i0\omega x}\]</span> å½¢å¼å®Œå…¨ç»Ÿä¸€äº† <span class="math display">\[f(x) = \sum_{-\infty}^{\infty} C_n e^{in\omega x} \\\]</span></p><p><span class="math display">\[C_n = \left\{\begin{align}&amp;\frac{a_0}{2}, &amp; n=0 \\&amp;\frac{a_n-ib_n}{2}, &amp; n\in(0,+\infty) \cap \mathbb{Z} \\&amp;\frac{a_{-n}+ib_{-n}}{2}, &amp; n\in(-\infty, 0)\cap \mathbb{Z} \\\end{align}\right.\]</span> å¸¦å…¥<span class="math inline">\(a_n, b_n\)</span>, å¾—åˆ°</p><ul><li><p>å¯¹äº<span class="math inline">\(C_0\)</span></p><p><span class="math display">\[  \begin{align}  C_0 &amp; = \frac{a_0}{2} \\  &amp; = \frac{1}{2} \frac{2}{T}\int_0^T f(x) \cos\ 0\omega x\ dx \\  &amp; = \frac{1}{T}\int_0^T f(x)\ dx \\  \end{align}  \]</span></p></li><li><p>å¯¹äº<span class="math inline">\(C_n(n\in[0,+\infty) \cap\mathbb{Z})\)</span></p><p><span class="math display">\[  \begin{align}  C_n &amp; = \frac{a_n-ib_n}{2} \\  &amp; = \frac{1}{2}\frac{2}{T}\left( \int_0^Tf(x)\cos n\omega x \ dx-i\int_0^Tf(x)\sin n\omega x\ dx\right)\\  &amp; = \frac{1}{T} \int_0^Tf(x)\left( \cos n\omega x - i\sin n\omegax\right)\ dx  \end{align}  \]</span></p><p>ç»“æœçš„æ‹¬å·ä¸­å¾ˆåƒæ¬§æ‹‰å…¬å¼, ä½†æ˜¯è™šéƒ¨å‰ä¸ºè´Ÿå·, ç”±äº<spanclass="math inline">\(\cos x\)</span>ä¸ºå¶å‡½æ•°, <spanclass="math inline">\(\sin x\)</span> ä¸ºå¥‡å‡½æ•° <spanclass="math display">\[  \begin{align}  C_n &amp; = \frac{1}{T} \int_0^Tf(x)\left( \cos n\omega x - i\sinn\omega x\right)\ dx\\  &amp; = \frac{1}{T} \int_0^Tf(x)\left( \cos \left(-n\omega x) + i\sin(-n\omega x\right)\right)\ dx\\  &amp; = \frac{1}{T} \int_0^Tf(x)e^{-in\omega x}\ dx  \end{align}  \]</span></p></li><li><p>å¯¹äº<span class="math inline">\(C_n(n\in(-\infty,0) \cap\mathbb{Z})\)</span></p><p><span class="math display">\[  \begin{align}  C_n &amp; = \frac{a_{-n}+ib_{-n}}{2} \\  &amp; = \frac{1}{2}\frac{2}{T}\left( \int_0^Tf(x)\cos (-n\omega x)\dx+i \int_0^Tf(x)\sin (-n\omega x)\ dx \right)\\  &amp; = \frac{1}{T} \int_0^Tf(x)\left( \cos n\omega x - i\sin n\omegax\right) dx \\  &amp; = \frac{1}{T} \int_0^Tf(x)e^{-in\omega x}\ dx  \end{align}  \]</span></p></li></ul><p>å‘ç°<span class="math inline">\(C_n(n\in(-\infty,0) \cap\mathbb{Z})\)</span>ä¸<span class="math inline">\(C_n(n\in(0,+\infty)\cap \mathbb{Z})\)</span>çš„è¡¨è¾¾å¼æ˜¯ä¸€æ ·çš„, åŒæ—¶å°†<spanclass="math inline">\(n=0\)</span>ä»£å…¥<spanclass="math inline">\(C_n(n\in(-\infty,0) \cap\mathbb{Z})\)</span>è¡¨è¾¾å¼, å‘ç°ç»“æœä¸<spanclass="math inline">\(C_0\)</span>ç›¸åŒ, æœ€å<spanclass="math inline">\(C_n\)</span>è¢«ç»Ÿä¸€ä¸º <span class="math display">\[C_n = \frac{1}{T} \int_0^Tf(x)e^{-in\omega x}\ dx\]</span> å³ <span class="math display">\[\begin{align}f(x) &amp;= f(x+T) \\f(x) &amp;= \sum_{-\infty}^{\infty}C_ne^{in\omega x}\\C_n &amp;= \frac{1}{T} \int_0^Tf(x)e^{-in\omega x}\ dx\\\end{align}\]</span></p><h3 id="å‚…é‡Œå¶å˜æ¢">å‚…é‡Œå¶å˜æ¢</h3><p>å¸Œæœ›å°†éå‘¨æœŸå‡½æ•°<spanclass="math inline">\(f(x)\)</span>è¡¨ç¤ºä¸ºå‚…é‡Œå¶<strong>å±•å¼€</strong>,<span class="math display">\[\begin{align}f(x) &amp;= \sum_{-\infty}^{\infty}C_ne^{in\omega x}\\C_n &amp;= \frac{1}{T} \int_0^Tf(x)e^{-in\omega x}\ dx\\\end{align}\]</span> å¯ä»¥å‘ç°<span class="math inline">\(e^{in\omegax}\)</span>æ˜¯ä¸€ä¸ªå›ºå®šæ¨¡å¼, <spanclass="math inline">\(f(x)\)</span>å±•å¼€åçš„æ¯ä¸€é¡¹éƒ½æ˜¯ç”±<spanclass="math inline">\(C_n\)</span>å†³å®šçš„, <spanclass="math inline">\(C_n\)</span>æ˜¯ä¸€ä¸ªå¤æ•°, å¯ä»¥å°†<spanclass="math inline">\(C_n\)</span>å–å€¼ç”»åœ¨ä¸€ä¸ªå¤å¹³é¢ä¸Š, å°†ä¸åŒ<spanclass="math inline">\(n\omega\)</span>ä¸‹çš„<spanclass="math inline">\(C_n\)</span>ç”»åœ¨ä¸€ä¸ªä¸‰ç»´åæ ‡ç³»ä¸Š(<spanclass="math inline">\(n\omega-C_n\)</span>), å³æˆ‘ä»¬å¾—åˆ°äº†<spanclass="math inline">\(f(x)\)</span>çš„é¢‘åŸŸè¡¨è¾¾</p><p>å¯ä»¥æŠŠéå‘¨æœŸå‡½æ•°å½“ä½œ<span class="math inline">\(T\to+\infty\)</span>çš„å‘¨æœŸå‡½æ•°, æ­¤æ—¶é¢‘è°±ä¸Šçš„<spanclass="math inline">\(w\)</span>ä¹‹é—´è·ç¦»<spanclass="math inline">\(\Delta w\to0\)</span>, <spanclass="math inline">\(f(x)\)</span>çš„é¢‘è°±ä¸Šçš„ç¦»æ•£ç‚¹å˜è¿ç»­, æˆä¸ºè¿ç»­å‡½æ•°,æ­¤æ—¶, æˆ‘ä»¬å°±å¯ä»¥å°†<spanclass="math inline">\(\sum^\infty_{n=-\infty}\Delta\omega\)</span>å˜ä¸º<spanclass="math inline">\(\int_{-\infty}^{\infty} d\omega\)</span></p><p>å°†<span class="math inline">\(C_n\)</span>ä»£å…¥<spanclass="math inline">\(f(x)\)</span> <span class="math display">\[f(x) = \sum_{-\infty}^{\infty} \frac{1}{T} \int_0^Tf(x)e^{-in\omega x}\dx e^{in\omega x}\\\]</span> å‡ºäº†ä¸ªå°é—®é¢˜, æˆ‘ä»¬æ‰¾ä¸å‰é¢è¯´çš„<spanclass="math inline">\(\Delta\omega\)</span>äº†...ä½†æ˜¯, æœ‰ <spanclass="math display">\[\frac{\omega}{2\pi} = \frac{1}{T}\\\]</span> ä»£å…¥å¾—åˆ° <span class="math display">\[\begin{align}f(x) &amp;= \sum_{-\infty}^{\infty} \frac{1}{T} \int_0^Tf(x)e^{-in\omegax}\ dx e^{in\omega x}\\&amp;=\frac{1}{2\pi}\sum_{-\infty}^{\infty}  \int_0^T \omegaf(x)e^{-in\omega x}\ dx e^{in\omega x}\\\end{align}\]</span> å°†<span class="math inline">\(C_n\)</span>çš„ç§¯åˆ†åŒºé—´ä»<spanclass="math inline">\([0,T]\)</span>æ¢åˆ°<spanclass="math inline">\([-\frac{T}{2},\frac{T}{2}]\)</span>(è¿™ä¸ªç§¯åˆ†åŒºé—´æ˜¯å¯ä»¥éšä¾¿æ¢çš„, åªè¦åŒºé—´é•¿ä¸ºTå°±è¡Œ,åœ¨å‰é¢æ¨å¯¼è¿‡ç¨‹ä¸­ä¹Ÿæ²¡æœ‰åˆ©ç”¨åˆ°<spanclass="math inline">\([0,T]\)</span>çš„ç‰¹æ®Šæ€§è´¨) <spanclass="math display">\[f(x)=\frac{1}{2\pi}\sum_{n=-\infty}^{\infty}  \int_{-\frac{T}{2}}^{\frac{T}{2}}\omega f(x)e^{-in\omega x}\ dx e^{in\omega x}\]</span> æˆ‘ä»¬åˆæœ‰<span class="math inline">\(\Delta\omega\to 0, T\to+\infty\)</span> <span class="math display">\[\begin{align}f(x)&amp;=\frac{1}{2\pi}\int_{-\infty}^{+\infty}  \int_{-\frac{T}{2}}^{\frac{T}{2}}  f(x)e^{-i\omegax}\ dx e^{i\omega x}\ d\omega\\&amp;=\frac{1}{2\pi}\int_{-\infty}^{+\infty}  \int_{-\infty}^{+\infty}  f(x)e^{-i\omegax}\ dx e^{i\omega x}\ d\omega\\\end{align}\]</span></p><p>æ³¨æ„, æŒ‡æ•°ä¸Šçš„<span class="math inline">\(n\omega\)</span>å˜æˆäº†<spanclass="math inline">\(\omega\)</span>, å› ä¸ºæˆ‘ä»¬å°†åŠ å’Œå˜æˆäº†ç§¯åˆ†</p><ul><li><p>å°†æ—¶åŸŸåˆ°é¢‘åŸŸçš„å˜æ¢ <span class="math display">\[  F(w) = \int_{-\infty}^{+\infty}  f(x)e^{-in\omega x}\ dx  \]</span></p><p>ç§°ä¸º<strong>å‚…é‡Œå¶å˜æ¢</strong></p></li><li><p>å°†é¢‘åŸŸåˆ°æ˜¯æ—¶åŸŸçš„å˜æ¢ <span class="math display">\[\begin{align}f(x)&amp;=\frac{1}{2\pi}\int_{-\infty}^{+\infty}  \int_{-\infty}^{+\infty}  f(x)e^{-in\omegax}\ dx e^{in\omega x}\ d\omega\\&amp;=\frac{1}{2\pi}\int_{-\infty}^{+\infty} F(w) e^{in\omega x}\d\omega\end{align}\]</span></p><p>ç§°ä¸º<strong>é€†å‚…é‡Œå¶å˜æ¢</strong></p></li></ul><p><strong>æœ€åæƒ³æƒ³æˆ‘ä»¬åšäº†ä»€ä¹ˆ</strong></p><ul><li>è¯æ˜äº†ä¸‰è§’å‡½æ•°æ­£äº¤æ€§, æ±‚äº†<span class="math inline">\(\int_{0}^{\pi}\sin nx \sin nx\ dx = \int_{0}^{\pi} \cos nx \cos nx\ dx =\pi\)</span></li><li>åˆ©ç”¨ä¸‰è§’å‡½æ•°æ­£äº¤æ€§æ±‚å‡ºäº†å‘¨æœŸä¸º<spanclass="math inline">\(2\pi\)</span>å‡½æ•°çš„å‚…é‡Œå¶å±•å¼€</li><li>å°†å‘¨æœŸä»<span class="math inline">\(2\pi\)</span>æ¨å¹¿åˆ°<spanclass="math inline">\(T\)</span>, å¾—åˆ°äº†å‚…é‡Œå¶å±•å¼€çš„ä¸€èˆ¬å½¢å¼</li><li>åˆ©ç”¨æ¬§æ‹‰å…¬å¼æ›¿æ¢å‚…é‡Œå¶å±•å¼€ä¸­çš„ä¸‰è§’å‡½æ•°, åˆå¹¶, æ¢å…ƒ,å¾—åˆ°å‚…é‡Œå¶å±•å¼€çš„å¤æ•°è¡¨ç°å½¢å¼</li><li>å°†éå‘¨æœŸå‡½æ•°è½¬ä¸ºå‘¨æœŸæ— ç©·å¤§çš„å‘¨æœŸå‡½æ•°, å°†åŠ å’Œè½¬ä¸ºç§¯åˆ†,æœ€ç»ˆå¾—åˆ°å‚…é‡Œå¶å˜æ¢ä¸é€†å˜æ¢. åˆ©ç”¨é¢‘åŸŸè¡¨è¾¾è§£é‡Šäº†ç§¯åˆ†çš„åˆç†æ€§</li></ul><h2 id="å‚…é‡Œå¶å˜æ¢åº”ç”¨">å‚…é‡Œå¶å˜æ¢åº”ç”¨</h2><p>å‚…é‡Œå¶å˜æ¢æœ€å¤§çš„åº”ç”¨å°±æ˜¯æ»¤æ³¢,æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å‚…é‡Œå¶å˜æ¢å°†æ—¶åŸŸè¡¨è¾¾è½¬æ¢ä¸ºé¢‘åŸŸè¡¨è¾¾,ç„¶åæ‰‹åŠ¨ç§»é™¤ä¸€äº›æ— ç”¨çš„é¢‘ç‡, æœ€ç»ˆé€šè¿‡é€†å‚…é‡Œå¶å˜æ¢å¾—åˆ°æ»¤æ³¢åæ—¶åŸŸè¡¨è¾¾.åœ¨å›¾å½¢å­¦ä¸­, æˆ‘ä»¬å¯ä»¥è®¤ä¸ºå›¾åƒæ˜¯å›¾çš„æ—¶åŸŸè¡¨è¾¾, å¹¶è·å–å…¶é¢‘åŸŸè¡¨è¾¾å›¾</p><figure><img src="./ç†è§£å‚…é‡Œå¶å˜æ¢/3-1.png" alt="å›¾å½¢åŠå…¶é¢‘è°±" /><figcaption aria-hidden="true">å›¾å½¢åŠå…¶é¢‘è°±</figcaption></figure><p>å·¦è¾¹æ˜¯æ—¶åŸŸ, å³è¾¹æ˜¯é¢‘åŸŸ. åœ¨é¢‘è°±ä¸­, å…‰äº®è¶Šé è¿‘ä¸­å¿ƒ, é¢‘ç‡è¶Šä½.å¤§éƒ¨åˆ†å›¾åƒçš„é¢‘è°±ä¸»è¦éƒ½é›†ä¸­åœ¨ä½é¢‘. æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°æ°´å¹³ä¸å‚ç›´çš„ä¸¤æ¡å…‰äº®,è¿™æ˜¯å› ä¸ºåœ¨å‚…é‡Œå¶å˜æ¢æ—¶, æˆ‘ä»¬å°†å›¾åƒçš„å·¦å³ä¸¤è¾¹, ä¸Šä¸‹ä¸¤è¾¹è¿äº†èµ·æ¥,ä½¿ä¹‹æˆä¸ºäº†ä¸€ä¸ªæ— é™å¤§çš„å›¾åƒ, è€Œå·¦å³è¾¹ç¼˜, ä¸Šè¾¹ç¼˜å·®å¼‚å°±å¾ˆå¤§, äºæ˜¯é¢‘ç‡å¾ˆé«˜,å‡ºç°äº†ä¸¤ä¸ªäº®æ¡.</p><p>é«˜é¢‘ä¸€èˆ¬ä»£è¡¨è¿™å›¾å½¢çš„è¾¹ç•Œ(è‰²å½©å˜åŒ–å¾ˆæ˜æ˜¾),è€Œä½é¢‘ä¸€èˆ¬ä»£è¡¨éè¾¹ç•Œ(å› ä¸ºè‰²å½©å˜åŒ–ä¸æ˜æ˜¾)</p><p>æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªä½é€šæ»¤æ³¢å™¨è¿‡æ»¤æ‰é«˜é¢‘æ³¢, æ•ˆæœå¦‚ä¸‹</p><figure><img src="./ç†è§£å‚…é‡Œå¶å˜æ¢/3-2.png" alt="åº”ç”¨ä½é€šæ»¤æ³¢å™¨å" /><figcaption aria-hidden="true">åº”ç”¨ä½é€šæ»¤æ³¢å™¨å</figcaption></figure><p>å›¾åƒè¾¹ç•Œæ²¡äº†, å›¾åƒå˜å¾—æ¨¡ç³Šäº†, è¿˜å¯ä»¥åº”ç”¨ä¸€ä¸ªé«˜é€šæ»¤æ³¢å™¨, æ•ˆæœå¦‚ä¸‹</p><figure><img src="./ç†è§£å‚…é‡Œå¶å˜æ¢/3-3.png" alt="åº”ç”¨é«˜é€šæ»¤æ³¢å™¨å" /><figcaption aria-hidden="true">åº”ç”¨é«˜é€šæ»¤æ³¢å™¨å</figcaption></figure><p>åªæœ‰è¾¹ç•Œä¿¡æ¯è¢«ä¿ç•™äº†ä¸‹æ¥...</p>]]></content>
    
    
    <summary type="html">æœ€è¿‘å­¦åˆ°å…‰æ …åŒ–æ—¶å‘ç°å®Œå…¨ä¸ç†è§£ä¿¡å·ä¸çº¿æ€§ç³»ç»Ÿä¸­çš„åŸºç¡€å†…å®¹ğŸ¤¯.å¤§ä¸€é«˜æ•°ä¹Ÿæ²¡æœ‰è®²å‚…é‡Œå¶å˜åŒ–,äºæ˜¯ä¸´æ—¶è¡¥ä¸€ä¸‹ç›¸å…³å®šä¹‰ä¸æ¨å¯¼ğŸ¤•</summary>
    
    
    
    <category term="æ§åˆ¶ç³»ç»Ÿ" scheme="https://blog.liukairui.me/categories/%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F/"/>
    
    <category term="å‚…é‡Œå¶å˜æ¢" scheme="https://blog.liukairui.me/categories/%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F/%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/"/>
    
    
    <category term="ç¬”è®°" scheme="https://blog.liukairui.me/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ§åˆ¶ç³»ç»Ÿ" scheme="https://blog.liukairui.me/tags/%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F/"/>
    
    <category term="å‚…é‡Œå¶å˜æ¢" scheme="https://blog.liukairui.me/tags/%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/"/>
    
  </entry>
  
  <entry>
    <title>GAMES-101ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦å…¥é—¨ç¬”è®°</title>
    <link href="https://blog.liukairui.me/article/GAMES-101%E7%8E%B0%E4%BB%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/"/>
    <id>https://blog.liukairui.me/article/GAMES-101%E7%8E%B0%E4%BB%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/</id>
    <published>2022-04-07T16:00:14.000Z</published>
    <updated>2022-04-07T16:00:14.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸»è®²: <span class="exturl" data-url="aHR0cHM6Ly9zaXRlcy5jcy51Y3NiLmVkdS9+bGluZ3FpLw==">é—«ä»¤çª<i class="fa fa-external-link-alt"></i></span>è¯¾ç¨‹ä¸»é¡µ: https://games-cn.org/intro-graphics/ Bç«™å›æ”¾:https://www.bilibili.com/video/BV1X7411F744</p></blockquote><h2 id="lecture-1-æ¦‚è®º">Lecture 1 æ¦‚è®º</h2><p><strong>å›¾å½¢å­¦å®šä¹‰</strong>: ç”¨è®¡ç®—æœºåˆæˆä¸æ“ä½œè§†è§‰ä¿¡æ¯</p><p><strong>å›¾å½¢å­¦åº”ç”¨</strong>: æ¸¸æˆ/ ç”µå½±/ åŠ¨ç”»/ è®¾è®¡/ å¯è§†åŒ–/è™šæ‹Ÿç°å®(Virtual Reality)/ å¢å¼ºæ˜¾ç¤º(Augmented Reality) (VRçœ‹ä¸åˆ°ç°å®,ARå¯ä»¥çœ‹åˆ°ç°å®, è¿˜å¯ä»¥çœ‹åˆ°é¢å¤–è™šæ‹Ÿçš„ä¸œè¥¿)/ æ•°å­—æ’ç”»/ æ¨¡æ‹Ÿ(ç‰¹æ•ˆ )/ GUI/æ’ç‰ˆä¸å°åˆ·</p><p><strong>å›¾å½¢å­¦ä¸è®¡ç®—æœºè§†è§‰</strong></p><ul><li><p>è®¡ç®—æœºè§†è§‰åšçš„æ˜¯çŒœæµ‹çš„äº‹æƒ…, å°è¯•ç†è§£, çŒœæµ‹å›¾åƒä¸­çš„ä¿¡æ¯</p></li><li><p>å›¾å½¢å­¦åšçš„äº‹å‡†ç¡®çš„äº‹æƒ…, å°†ä¿¡æ¯è¡¨ç°ä¸ºå›¾å½¢</p><pre class="mermaid">  graph LRmod(æ¨¡å‹) --å›¾å½¢å­¦>æ¸²æŸ“--> img(å›¾åƒ)img --è®¡ç®—æœºè§†è§‰--> modmod --å›¾å½¢å­¦>æ¨¡æ‹Ÿ/å»ºæ¨¡--> modimg --è®¡ç®—æœºè§†è§‰>å›¾å½¢å¤„ç†--> img</pre></li></ul><p><strong>éš¾ç‚¹</strong>:</p><ul><li>åˆ›å»ºå¹¶ä¸è™šæ‹Ÿä¸–ç•Œäº¤äº’</li><li>äº†è§£ææ–™çš„ç‰©ç†æ€§è´¨</li><li>æ–°çš„è®¡ç®—ä¸æ˜¾ç¤ºæŠ€æœ¯</li></ul><p><strong>è¯¾ç¨‹å¤§çº²</strong></p><ul><li>å…‰æ …åŒ–(Rasterization): å°†ä¸‰ç»´å‡ ä½•å½¢ä½“æ˜¾ç¤ºåœ¨å±å¹•ä¸Š</li><li>å‡ ä½•, æ›²çº¿ä¸æ›²é¢(Curves and Meshes): å¦‚ä½•å¾—åˆ°æ›²çº¿ä¸æ›²é¢,ç”¨ç®€å•æ›²é¢å¾—åˆ°å¤æ‚æ›²é¢, åœ¨å½¢å˜æ—¶æ›²é¢å˜åŒ–</li><li>å…‰çº¿è¿½è¸ª(Ray Tracing)</li><li>åŠ¨ç”»ä¸æ¨¡æ‹Ÿ(Animation and Simulation)</li></ul><h2 id="lecture-2-çº¿æ€§ä»£æ•°å¤ä¹ ">Lecture 2 çº¿æ€§ä»£æ•°å¤ä¹ </h2><p><strong>å›¾å½¢å­¦éœ€è¦çŸ¥è¯†</strong></p><ul><li>çº¿æ€§ä»£æ•°/ å¾®ç§¯åˆ†/ ç»Ÿè®¡å­¦</li><li>å…‰å­¦/ åŠ›å­¦</li><li>ä¿¡å·å¤„ç†/ æ•°å€¼åˆ†æ</li></ul><p><strong>å‘é‡</strong></p><ul><li><p>å‘é‡åªæœ‰é•¿åº¦ä¸æ–¹å‘æ²¡æœ‰ç»å¯¹çš„å§‹ç»ˆç‚¹.åŠ å‡éµå¾ªå¹³è¡Œå››è¾¹å½¢æ³•åˆ™</p></li><li><p>é»˜è®¤ä½¿ç”¨åˆ—å‘é‡, ä¹Ÿå¯ä»¥å†™ä½œ<spanclass="math inline">\((x,y,z)^T\)</span></p></li><li><p>ç”¨<span class="math inline">\(\| \vec{a}\|\)</span>è¡¨ç¤ºå‘é‡é•¿åº¦</p></li><li><p>ç”¨<span class="math inline">\(\hat{a}\)</span>è¡¨ç¤ºä¸<spanclass="math inline">\(a\)</span>å‘é‡åŒæ–¹å‘çš„å•ä½å‘é‡, å³<spanclass="math inline">\(\hat{a} = \vec{a} / \| \vec{a}\|\)</span></p></li><li><p>å‘é‡ç‚¹ä¹˜</p><ul><li><p><span class="math inline">\(\vec{a} \cdot \vec{b} =\|\vec{a}\|\|\vec{b}\|\cos\theta\)</span>, å³<spanclass="math inline">\(\cos\theta = \hat{a}\cdot\hat{b}\)</span></p></li><li><p>åœ¨ç¬›å¡å°”åæ ‡ç³»ä¸‹ <span class="math display">\[\vec{a} \cdot \vec{b} = \left(\begin{matrix}x_a\\ y_a\end{matrix}\right)\cdot \left(\begin{matrix}x_b\\ y_b\end{matrix}\right) = x_ax_b+y_ay_b\]</span></p><p><span class="math display">\[\vec{a} \cdot \vec{b} = \left(\begin{matrix}x_a\\ y_a\\z_a\end{matrix}\right) \cdot \left(\begin{matrix}x_b\\ y_b\\z_b\end{matrix}\right) = x_ax_b+y_ay_b+z_az_b\]</span></p></li><li><p>å‘é‡ç‚¹ä¹˜æ»¡è¶³äº¤æ¢ä¸åˆ†é…ç‡</p></li><li><p>åº”ç”¨: æ±‚ä¸¤å‘é‡å¤¹è§’ / æ±‚å‘é‡åœ¨å¦ä¸€ä¸ªå‘é‡ä¸Šçš„æŠ•å½± /ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„å‚ç›´è·ç¦»(æŠ•å½±å‘é‡å‡ä¸€ä¸‹) / æè¿°ä¸¤ä¸ªå‘é‡æœ‰å¤šæ¥è¿‘ /æè¿°ä¸¤ä¸ªå‘é‡çš„å‰åå…³ç³»(ç‚¹ç§¯æ­£è´Ÿ)</p></li></ul></li><li><p>å‘é‡å‰ç§¯</p><ul><li><p>è¾“å…¥ä¸¤ä¸ªå‘é‡<span class="math inline">\(\vec{a},\vec{b}\)</span>, å¾—åˆ°ä¸ä¸¤ä¸ªå‘é‡éƒ½å‚ç›´çš„å‘é‡</p><ul><li>å¤§å°: <span class="math inline">\(\|\vec{a}\| \|\vec{b}\|\sin\theta\)</span></li><li>æ–¹å‘: ä½¿ç”¨å³æ‰‹èºæ—‹æ³•åˆ™ä»<spanclass="math inline">\(\vec{a}\)</span>æ¡åˆ°<spanclass="math inline">\(\vec{b}\)</span>, æ‹‡æŒ‡æŒ‡å‘</li></ul></li><li><p>åœ¨ç¬›å¡å°”åæ ‡ç³»ä¸­ <span class="math display">\[\vec{a} \times \vec{b} = \left(\begin{matrix}x_a\\ y_a\\z_a\end{matrix}\right) \times \left(\begin{matrix}x_b\\ y_b\\z_b\end{matrix}\right) = \left(\begin{matrix}y_az_b-y_bz_a\\z_ax_b-z_bx_a\\ x_ay_b-x_by_a\end{matrix}\right)\]</span> çŸ©é˜µè¡¨ç¤º <span class="math display">\[\vec{a} \times \vec{b} = A^* b =\left(\begin{matrix}0&amp;-z_a&amp;y_a\\z_a&amp;0&amp;-x_a\\-y_a&amp;x_a&amp;0\end{matrix}\right)\left(\begin{matrix}x_b\\y_b\\z_b\end{matrix}\right)\]</span> æ³¨æ„çŸ©é˜µè¡¨ç¤ºæ—¶<spanclass="math inline">\(A^*\)</span>æ˜¯ä¸€ä¸ªæ•´ä½“è¡¨ç¤ºdual matrix,ä¸è¦å½“æˆä¹˜å·</p></li><li><p>ä¸æ»¡è¶³äº¤æ¢ç‡( <span class="math inline">\(\vec{a} \times \vec{b}= - \vec{b} \times \vec{a}\)</span> ), æ»¡è¶³åˆ†é…ç‡</p></li><li><p>åº”ç”¨:</p><ul><li>å»ºç«‹ä¸‰ç»´ç›´è§’åæ ‡ç³»(å³æ‰‹ç³»)</li><li>åˆ¤å®šå·¦å³: <span class="math inline">\(\vec{a} \times \vec{b} &gt;0\)</span>è¯´æ˜<span class="math inline">\(\vec{b}\)</span>åœ¨<spanclass="math inline">\(\vec{a}\)</span>å·¦è¾¹</li><li>åˆ¤æ–­ç‚¹åœ¨å¤šè¾¹å½¢å†…: ä»¥ä¸‰è§’å½¢ä¸ºä¾‹, åˆ¤æ–­ç‚¹<spanclass="math inline">\(P\)</span>åœ¨ä¸‰è§’å½¢<spanclass="math inline">\(ABC\)</span>å†…å³åˆ¤æ–­<spanclass="math inline">\(\vec{AB} \times \vec{AP}\)</span>, <spanclass="math inline">\(\vec{BC} \times \vec{BP}\)</span>, <spanclass="math inline">\(\vec{CA} \times\vec{CP}\)</span>æ˜¯å¦åŒå·(é¡¶ç‚¹æšä¸¾é¡ºåºä¸é‡è¦), æˆ‘ä»¬ç§°å‰ç§¯ä¸º<spanclass="math inline">\(0\)</span>çš„æƒ…å†µä¸ºconner case,éšä½ æŠŠä»–å®šä¹‰ä¸ºåœ¨å†…éƒ¨è¿˜æ˜¯å¤–éƒ¨</li></ul></li></ul><p><strong>çŸ©é˜µ</strong></p><ul><li>çŸ©é˜µä¹˜æ³•ä¸­ç»“æœçŸ©é˜µçš„<span class="math inline">\(m\)</span>è¡Œ<spanclass="math inline">\(n\)</span>åˆ—å°±æ˜¯ç¬¬ä¸€ä¸ªçŸ©é˜µçš„<spanclass="math inline">\(m\)</span>è¡Œä¹˜ç¬¬äºŒä¸ªçŸ©é˜µ<spanclass="math inline">\(n\)</span>åˆ—(è™½ç„¶æœ‰ç‚¹åºŸè¯, ä½†æ˜¯è›®å¥½ç”¨çš„)</li><li>çŸ©é˜µä¹˜æ³•æ²¡æœ‰äº¤æ¢ç‡, æœ‰ç»“åˆç‡ä¸åˆ†é…ç‡. <spanclass="math inline">\((AB)^T = B^TA^T\)</span></li><li>åº”ç”¨: å¯¹å›¾åƒä¸­çš„ç‚¹åº”ç”¨å˜æ¢</li></ul></li></ul><h2 id="lecture-3-transformation---æ¨¡å‹å˜æ¢">Lecture 3 Transformation -æ¨¡å‹å˜æ¢</h2><p>ä¸¤ç§å˜æ¢:</p><ul><li>æ¨¡å‹å˜æ¢: æ¨¡å‹å˜(ä»¿å°„å˜æ¢)</li><li>è§†å›¾å˜æ¢: æ‘„åƒæœºå˜(æŠ•å½±, 3Dè½¬2D...)</li></ul><h3 id="äºŒç»´å˜æ¢">äºŒç»´å˜æ¢</h3><p>å°±æ˜¯åˆ©ç”¨çŸ©é˜µå°†æ¯ä¸ªç‚¹è¿›è¡Œçº¿æ€§å˜æ¢, åšå˜æ¢ç›¸å½“äºæ±‚è§£çŸ©é˜µ,ä¹Ÿå°±æ˜¯ç”¨nä¸ªç‚¹æ±‚ä¸€ä¸ªnå…ƒä¸€æ¬¡æ–¹ç¨‹. æ³¨æ„, æ‰€æœ‰çš„å˜æ¢éƒ½é»˜è®¤åŸºäºåŸç‚¹</p><ul><li><p>ç¼©æ”¾(Scale)</p><p>å°†å›¾åƒç¼©æ”¾<spanclass="math inline">\(S_{a,b}\)</span>å€ç›¸å½“äºå°†æ¯ä¸ªç‚¹<spanclass="math inline">\(x \to x\times a, y \to y\times b\)</span>,å¯ä»¥ç”¨çŸ©é˜µç®€å•æè¿°å˜æ¢ <span class="math display">\[\left[\begin{matrix}x&#39;\\y&#39;\end{matrix}\right]=\left[\begin{matrix}s_x&amp;0\\0&amp;s_y\end{matrix}\right]\left[\begin{matrix}x\\y\end{matrix}\right]\]</span> å›¾å½¢å…³äº<spanclass="math inline">\(oy\)</span>å¯¹ç§°å°±ç›¸å½“äºæ˜¯ç¼©æ”¾<spanclass="math inline">\(S_{-1,1}\)</span></p></li><li><p>åˆ‡å˜(Shear)</p><p>å¤§æ¦‚é•¿è¿™æ ·</p><figure><img src="./img/3-1.png" alt="shear" /><figcaption aria-hidden="true">shear</figcaption></figure><p>ä¸çŸ¥é“å¦‚ä½•å˜æ¢çš„æ—¶å€™å°±åˆ—nå…ƒä¸€æ¬¡æ–¹ç¨‹, é¦–å…ˆå‘ç°<spanclass="math inline">\(y\)</span>æ˜¯ä¸å˜çš„, å°±çœ‹<spanclass="math inline">\(x\)</span>, æ‰¾<spanclass="math inline">\((1,0)\to(1,0)\)</span>, <spanclass="math inline">\((0,1)\to(a,1)\)</span> <spanclass="math display">\[\left\{\begin{align}1 = 1k_x + 0k_y\\a = 0k_x + 1k_y\end{align}\right.\]</span></p><p>å¾ˆå®¹æ˜“æ¨ç®—å‡º<span class="math inline">\(k_y = a, k_x = 1\)</span>,äºæ˜¯å¾—åˆ°çŸ©é˜µ <span class="math display">\[\left[\begin{matrix}x&#39;\\y&#39;\end{matrix}\right]=\left[\begin{matrix}1&amp;a\\0&amp;1\end{matrix}\right]\left[\begin{matrix}x\\y\end{matrix}\right]\]</span></p></li><li><p>æ—‹è½¬(Rotate)</p><p>é»˜è®¤æ—‹è½¬åŸºäºåŸç‚¹, ä»¥é€†æ—¶é’ˆä¸ºæ­£æ–¹å‘. ä½¿ç”¨<spanclass="math inline">\(R_\theta\)</span>è¡¨ç¤ºæ—‹è½¬äº†<spanclass="math inline">\(\theta\)</span></p><figure><img src="./img/3-2.png" alt="rotate" /><figcaption aria-hidden="true">rotate</figcaption></figure><p>å‡è®¾æ—‹è½¬äº†<spanclass="math inline">\(\theta\)</span>åªéœ€è¦æ‰¾ä¸¤ä¸ªç‰¹æ®Šç‚¹å°±å¯ä»¥æ±‚å¾—çŸ©é˜µ,è¿™é‡Œé‡‡ç”¨<span class="math inline">\((1,0)\to(\cos\theta,\sin\theta)\)</span>ä¸<span class="math inline">\((0,1)\to(-\sin\theta,\cos\theta)\)</span>æ–¹ä¾¿æ¶ˆå…ƒ <span class="math display">\[\left\{\begin{align}(\cos\theta, \sin\theta)^T = (k_{xx}\times1+k_{xy}\times 0,k_{yx}\times1+k_{yy}\times 0)^T \\(-\sin\theta, \cos\theta)^T = (k_{xx}\times0+k_{xy}\times 1,k_{yx}\times0+k_{yy}\times 1)^T\end{align}\right.\]</span> äºæ˜¯å¾—åˆ°æ—‹è½¬çŸ©é˜µ <span class="math display">\[\left[\begin{matrix}x&#39;\\y&#39;\end{matrix}\right]=\left[\begin{matrix}\cos\theta&amp;-\sin\theta\\ \sin\theta&amp;\cos\theta\end{matrix}\right]\left[\begin{matrix}x\\y\end{matrix}\right]\]</span></p></li><li><p>å¹³ç§»(Translation)</p><p>ç”¨<span class="math inline">\(T_{tx,ty}\)</span>æè¿°å°†ç‚¹å¹³ç§»<spanclass="math inline">\((t_x, t_y)\)</span>. å¹³ç§»ä¸å±äºä¸Šè¿°çº¿æ€§å˜æ¢,æ²¡æ³•ç”¨äºŒé˜¶çŸ©é˜µä¹˜æ³•æè¿°è¿™ç§å˜æ¢, å¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹æ³•è¡¨ç¤º <spanclass="math display">\[\left[\begin{matrix}x&#39;\\y&#39;\end{matrix}\right]=\left[\begin{matrix}1&amp;0\\0&amp;1\end{matrix}\right]\left[\begin{matrix}x\\y\end{matrix}\right]+\left[\begin{matrix}t_x\\t_y\end{matrix}\right]\]</span> æˆ‘ä»¬å¸Œæœ›å°†çº¿æ€§å˜æ¢ä¸å¹³ç§»ç”¨ä¸€ä¸ªç»Ÿä¸€çš„æ–¹å¼è¡¨ç°å‡ºæ¥.äºæ˜¯æƒ³åˆ°äº†ä½¿ç”¨<strong>é½æ¬¡åæ ‡</strong>(Homogeneous Coordinates)è¡¨ç¤ºæ³•,ä¸ºå°†æ¯ä¸ªç‚¹/å‘é‡å¢åŠ ä¸€ç»´</p><ul><li>ç‚¹: <span class="math inline">\((x,y)^T \to (x,y,1)^T\)</span></li><li>å‘é‡: <span class="math inline">\((x,y)^T \to(x,y,0)^T\)</span></li></ul><p>ç”¨ç¬¬ä¸‰ç»´<span class="math inline">\(w\)</span>ä¸ºé<spanclass="math inline">\(0\)</span>è¡¨ç¤ºç‚¹, <spanclass="math inline">\(w=0\)</span>è¡¨ç¤ºå‘é‡. <spanclass="math inline">\(w\neq0\)</span>æ—¶çš„ç‚¹<spanclass="math inline">\((x,y,w)^T\)</span>å¯ä»¥è®¤ä¸ºæ˜¯<spanclass="math inline">\((x/w, y/w, 1)^T\)</span>.ä¸¤ä¸ªç‚¹ç›¸å‡å°±æ˜¯å‘é‡(æ‰€ä»¥å‘é‡<span class="math inline">\(w = 0\)</span>),çœ‹èµ·æ¥è¿™ç§è¡¨ç¤ºæ–¹æ³•æ¯”è¾ƒç¬¦åˆæ•°å­¦å®šä¹‰</p><ul><li>å‘é‡åŠ å‡è¿˜æ˜¯å‘é‡: <span class="math inline">\((x_1,y_1,0)\pm(x_2,y_2,0) = (x_1+x_2, y_1+y_2, 0)\)</span></li><li>ç‚¹å‡ç‚¹æ˜¯å‘é‡: <span class="math inline">\((x_1,y_1,1)- (x_2,y_2,1) =(x_1-x_2, y_1-y_2, 0)\)</span></li><li>ç‚¹åŠ ç‚¹æ˜¯ä¸¤ç‚¹çš„ä¸­ç‚¹: <span class="math inline">\((x_1,y_1,1)+(x_2,y_2,1) = (x_1+x_2, y_1+y_2, 2) = (\frac{x_1+x_2}{2},\frac{y_1+y_2}{2}, 1)\)</span></li></ul><p>å¹³ç§»<span class="math inline">\(T_{tx,ty}\)</span>å¯ä»¥å†™ä½œ <spanclass="math display">\[\left[\begin{matrix}x&#39;\\y&#39;\\1\end{matrix}\right]=\left[\begin{matrix}1&amp;0&amp;t_x\\0&amp;1&amp;t_y\\0&amp;0&amp;1\end{matrix}\right]\left[\begin{matrix}x\\y\\1\end{matrix}\right]\]</span> å¾ˆå®¹æ˜“ç†è§£, ç¬¬ä¸‰åˆ—å¯ä»¥è¢«è®¤ä¸ºæ˜¯åç§»é‡</p><p>æˆ‘ä»¬ç§°æ—‹è½¬, ç¼©æ”¾, åˆ‡å˜, å¹³ç§»ä¸ºä»¿å°„å˜æ¢,æ‰€æœ‰ä»¿å°„å˜æ¢çŸ©é˜µç¬¬ä¸‰è¡Œå‡ä¸º<spanclass="math inline">\([0,0,1]\)</span></p></li><li><p>çŸ©é˜µä¹˜æ³•æœ‰ç»“åˆå¾‹æ— äº¤æ¢å¾‹</p><p>çŸ©é˜µæ»¡è¶³ç»“åˆç‡, ä¾‹å¦‚æˆ‘ä»¬å…ˆç”¨ä¸€ä¸ªæ—‹è½¬çš„çŸ©é˜µ<spanclass="math inline">\(M_R\)</span>å†ç”¨ä¸€ä¸ªç¼©æ”¾çŸ©é˜µ<spanclass="math inline">\(M_S\)</span>, å¤„ç†<spanclass="math inline">\(P\)</span>, æˆ‘ä»¬å¯ä»¥å†™<spanclass="math inline">\(P&#39; = M_S (M_R P)\)</span>, åˆ©ç”¨çŸ©é˜µä¹˜æ³•ç»“åˆå¾‹,ä¹Ÿå¯ä»¥å†™ä½œ<span class="math inline">\(P&#39; = (M_S M_R) P\)</span></p><p>å¯¹äºå¦‚ä¸‹çŸ©é˜µ <span class="math display">\[\left[\begin{matrix}x&#39;\\y&#39;\\1\end{matrix}\right]=\left[\begin{matrix}\cos\theta&amp;-\sin\theta&amp;t_x\\\sin\theta&amp;\cos\theta&amp;t_y\\0&amp;0&amp;1\end{matrix}\right]\left[\begin{matrix}x\\y\\1\end{matrix}\right]\]</span> æˆ‘ä»¬çŸ¥é“ä»–å³åº”ç”¨äº†æ—‹è½¬åˆåº”ç”¨äº†å¹³ç§».æˆ‘ä»¬å®šä¹‰çš„æ—‹è½¬æ˜¯åŸºäºåŸç‚¹çš„, æ­¤æ—¶æ—‹è½¬ä¸å¹³ç§»çš„é¡ºåºä¼šå½±å“æˆåƒ</p><p><img src="./img/3-3.png" /></p><p>æ¨¡æ‹Ÿä¸€ä¸‹å…ˆæ—‹è½¬åå¹³ç§»ä¸å…ˆå¹³ç§»åæ—‹è½¬å¯ä»¥è½»æ¾å¾—åˆ°è¿™ä¸ªçŸ©é˜µæ˜¯å…ˆæ—‹è½¬åå¹³ç§»çš„.æˆ‘ä»¬å¯ä»¥å¾—,ç”¨åŒä¸€ä¸ªçŸ©é˜µè¡¨ç¤ºçº¿æ€§å˜æ¢ä¸å¹³ç§»æ—¶åº”è¯¥<strong>å…ˆçº¿æ€§åå¹³ç§»</strong></p></li><li><p>é€†çŸ©é˜µ</p><p>åœ¨çº¿æ€§ä»£æ•°ä¸­è‹¥<span class="math inline">\(M N = I\)</span>åˆ™<spanclass="math inline">\(N, M\)</span>äº’ä¸ºé€†çŸ©é˜µ. åœ¨çº¿æ€§å˜æ¢ä¸­,ä¸€ä¸ªå˜æ¢çŸ©é˜µçš„é€†çŸ©é˜µ<spanclass="math inline">\(M^{-1}\)</span>åšä¸å˜æ¢çŸ©é˜µ<spanclass="math inline">\(M\)</span>å®Œå…¨ç›¸åçš„äº‹æƒ…(ä¾‹å¦‚<spanclass="math inline">\(M\)</span>æ˜¯æ—‹è½¬<spanclass="math inline">\(45^\circ\)</span>å¹³ç§»<spanclass="math inline">\((1,2)\)</span>, <spanclass="math inline">\(M^{-1}\)</span>åˆ™æ˜¯å¹³ç§»<spanclass="math inline">\((-1,-2)\)</span>æ—‹è½¬<spanclass="math inline">\(-45^\circ\)</span>). è¡¥å……: æ—‹è½¬çŸ©é˜µæ˜¯æ­£äº¤çŸ©é˜µ,å³æ—‹è½¬çŸ©é˜µçš„è½¬ç½®å°±æ˜¯ä»–çš„é€†çŸ©é˜µ</p></li></ul><h3 id="ä¸‰ç»´å˜æ¢">ä¸‰ç»´å˜æ¢</h3><p>ä¸‰ç»´å˜æ¢å¯ä»¥ç”¨äºŒç»´å˜æ¢ç±»æ¯”å¾—åˆ°, åªæ˜¯ä¸‰ç»´çš„å‘é‡æ˜¯<spanclass="math inline">\((x,y,z,0)^T\)</span>, ä¸‰ç»´çš„ç‚¹æ˜¯<spanclass="math inline">\((x,y,z,1)^T\)</span>æˆ–<spanclass="math inline">\((x,y,z,w)^T = (x/w,y/w,z/w,1)^T\)</span>,ä¸‰ç»´å˜æ¢çŸ©é˜µæ˜¯å››é˜¶çŸ©é˜µ</p><ul><li><p>ç¼©æ”¾ <span class="math display">\[S(s_x, s_y, s_z) = \left(\begin{matrix}s_x&amp;0&amp;0&amp;0\\0&amp;s_y&amp;0&amp;0\\0&amp;0&amp;s_z&amp;0\\0&amp;0&amp;0&amp;1\end{matrix}\right)\]</span></p></li><li><p>å¹³ç§» <span class="math display">\[T(t_x, t_y, t_z) = \left(\begin{matrix}1&amp;0&amp;0&amp;t_x\\0&amp;1&amp;0&amp;t_y\\0&amp;0&amp;1&amp;t_z\\0&amp;0&amp;0&amp;1\end{matrix}\right)\]</span></p></li><li><p>æ—‹è½¬æ¯”è¾ƒéº»çƒ¦</p><p><strong>ç»•åæ ‡è½´æ—‹è½¬</strong></p><ul><li><p>å…³äº<span class="math inline">\(ox\)</span>è½¬<spanclass="math inline">\(\alpha\)</span> <span class="math display">\[R_x(\alpha) =\left(\begin{matrix}1&amp;0&amp;0&amp;0\\0&amp;\cos\alpha&amp;-\sin\alpha&amp;0\\0&amp;\sin\alpha&amp;\cos\alpha&amp;0\\0&amp;0&amp;0&amp;1\end{matrix}\right)\]</span></p></li><li><p>å…³äº<span class="math inline">\(oz\)</span>è½¬<spanclass="math inline">\(\alpha\)</span> <span class="math display">\[R_z(\alpha) =\left(\begin{matrix}\cos\alpha&amp;-\sin\alpha&amp;0&amp;0\\\sin\alpha&amp;\cos\alpha&amp;0&amp;0\\0&amp;0&amp;1&amp;0\\0&amp;0&amp;0&amp;1\\\end{matrix}\right)\]</span></p></li><li><p>å…³äº<span class="math inline">\(oy\)</span>è½¬<spanclass="math inline">\(\alpha\)</span> <span class="math display">\[R_y(\alpha) =\left(\begin{matrix}\cos\alpha&amp;0&amp;\sin\alpha&amp;0\\0&amp;1&amp;0&amp;0\\-\sin\alpha&amp;0&amp;\cos\alpha&amp;0\\0&amp;0&amp;0&amp;1  \end{matrix}\right)\]</span></p></li></ul><p>å…³äº<spanclass="math inline">\(oy\)</span>æ—‹è½¬çŸ©é˜µçš„è´Ÿå·ä½ç½®çœ‹èµ·æ¥æœ‰ç‚¹æ€ª?å…¶å®æ²¡é—®é¢˜, ç»•<span class="math inline">\(ox\)</span>è½¬æˆ‘ä»¬ç”¨<spanclass="math inline">\(yz\)</span>, ç»•<spanclass="math inline">\(oz\)</span>è½¬æˆ‘ä»¬ç”¨<spanclass="math inline">\(zy\)</span>, ç»•<spanclass="math inline">\(oy\)</span>è½¬æˆ‘ä»¬ç”¨<spanclass="math inline">\(zx\)</span>éƒ½æ˜¯æŒ‰ç…§å³æ‰‹ç³»é¡ºåºè½¬çš„.</p><p><strong>ç»•ä»»æ„è¿‡åŸç‚¹å‘é‡æ—‹è½¬</strong></p><p>äººä»¬é€šè¿‡é£æœºå¯ä»¥åšå‡ºä»»æ„å§¿æ€ç±»æ¯”è®¤ä¸ºä»»æ„æ—‹è½¬å§¿æ€éƒ½å¯ä»¥ç”±ç»•<spanclass="math inline">\(ox, oy, oz\)</span>æ—‹è½¬å¾—æ¥.äºæ˜¯ç»•ä»»æ„è¿‡åŸç‚¹è½´æ—‹è½¬å¯ä»¥åˆ†è§£ä¸ºåˆ†åˆ«ç»•<span class="math inline">\(ox,oy, oz\)</span>æ—‹è½¬ <span class="math display">\[R_{x,y,z}(\alpha, \beta, \gamma) =R_{x}(\alpha)R_{y}(\beta)R_{z}(\gamma)\]</span> ä¹Ÿæœ‰ç°æˆçš„ç½—å¾·é‡Œæ ¼æ—‹è½¬å…¬å¼(Rodrigues' rotationformula)è®¡ç®—ç»•ä»»æ„è¿‡åŸç‚¹å‘é‡(<spanclass="math inline">\(n\)</span>)æ—‹è½¬å…¬å¼ <span class="math display">\[R(\vec{n},\alpha) = \cos(\alpha)\vec{I} +(1-\cos(\alpha))\vec{n}\vec{n}^T+\sin(\alpha)\left(\begin{matrix}0&amp;-n_z&amp;n_y\\n_z&amp;0&amp;-n_x\\-n_y&amp;n_x&amp;0\end{matrix}\right)\]</span> æœ€åä¸€ä¸ªå¤§çŸ©é˜µå°±æ˜¯å‰ç§¯çš„çŸ©é˜µè¡¨ç¤º</p><p><strong>ç½—å¾·é‡Œæ ¼æ—‹è½¬å…¬å¼è¯æ˜</strong></p><ul><li><p>å‘é‡å‰ç§¯çš„å‡ ä½•æ„ä¹‰</p><p>è®¾å‘é‡<span class="math inline">\(\vec{k}\)</span>ä¸ºå‚ç›´äºå‘é‡<spanclass="math inline">\(\vec{v}\)</span>çš„å•ä½å‘é‡. å‘é‡<spanclass="math inline">\(\vec{v} \times \vec{k}\)</span>çš„æ–¹å‘å‚ç›´äº<spanclass="math inline">\(\vec{v}\)</span>, <spanclass="math inline">\(\vec{k}\)</span>æ‰€æˆå¹³é¢, é•¿åº¦ä¸º<spanclass="math inline">\(\|v\| \|k\| \sin 90^\circ = \|v\|\)</span>,å¯ä»¥ç†è§£æˆ<span class="math inline">\(\vec{v} \times\vec{k}\)</span>æ˜¯<span class="math inline">\(\vec{v}\)</span>ç»•<spanclass="math inline">\(\vec{k}\)</span>æ—‹è½¬<spanclass="math inline">\(90^\circ\)</span></p></li><li><p>å‘é‡åˆ†è§£</p><p>è€ƒè™‘<span class="math inline">\(v\inR^3\)</span>çš„ä¸‰ç»´æ—‹è½¬é—®é¢˜ï¼Œæ—‹è½¬è½´<spanclass="math inline">\(k\)</span>æ˜¯å•ä½å‘é‡ï¼Œæ—‹è½¬è§’ä¸º<spanclass="math inline">\(Î¸\)</span>ï¼Œæ—‹è½¬åå‘é‡ä¸º<spanclass="math inline">\(v_{rot}\)</span>, å‘é‡<spanclass="math inline">\(v\)</span>å¯ä»¥åˆ†è§£ä¸ºå¹³è¡Œäº<spanclass="math inline">\(k\)</span>çš„åˆ†é‡<spanclass="math inline">\(v_\parallel\)</span>å’Œæ­£äº¤äº<spanclass="math inline">\(k\)</span>çš„åˆ†é‡<spanclass="math inline">\(v_\perp\)</span>, æ˜¾ç„¶æœ‰<spanclass="math inline">\(v = v_\parallel + v_\perp\)</span>, å¦‚å›¾:</p><p><img src="./img/3-4.png" /></p><p>å°è¯•è¡¨ç¤º<span class="math inline">\(v_\parallel\)</span>ä¸<spanclass="math inline">\(v_\perp\)</span>, æœ‰ <span class="math display">\[v_\parallel = (v\cdot k)k \\v_\perp = v - v_\parallel = v-(k\cdot v)k = -k\times (k\times v)\]</span> å…¶ä¸­<spanclass="math inline">\(v_\perp\)</span>çš„æœ€åä¸€æ­¥æ¨å¯¼å¦‚ä¸‹</p><p><img src="./img/3-5.png" /></p><p>é¦–å…ˆæ‰¾å¾—åˆ°<span class="math inline">\(v\)</span>, <spanclass="math inline">\(k\)</span>, å¯ä»¥çœ‹åˆ°<spanclass="math inline">\(k\times v\)</span>é•¿åº¦ä¸º<spanclass="math inline">\(\|v\| \sin(&lt;k,v&gt;)\)</span>, æ–¹å‘ä¸<spanclass="math inline">\(k, v\)</span>æ‰€åœ¨å¹³é¢å‚ç›´, <spanclass="math inline">\(k\times (k\times v)\)</span>é•¿åº¦ä¸º<spanclass="math inline">\(\|v\|\)</span>, æ–¹å‘ä¸<spanclass="math inline">\(k, (k\times v)\)</span>æ‰€åœ¨å¹³é¢å‚ç›´, æ­¤æ—¶<spanclass="math inline">\(k, k\times v, k\times(k\times v)\)</span>ä¸¤ä¸¤å‚ç›´,ç›¸å½“äºæˆ‘ä»¬åœ¨åœ¨<span class="math inline">\(k,v\)</span>æ‰€åœ¨å¹³é¢ä¸Šå»ºç«‹äº†åæ ‡ç³». <spanclass="math inline">\(v_\perp\)</span>ä¸<spanclass="math inline">\(k\times (k\times v)\)</span>å¹³è¡Œåå‘, å¤§å°ä¸º<spanclass="math inline">\(\|v\| \sin(&lt;k,v&gt;)\)</span>, ä¹Ÿå°±æ˜¯<spanclass="math inline">\(-k\times (k\times v)\)</span></p><p>å†çœ‹<span class="math inline">\(v\)</span>ä¸<spanclass="math inline">\(v_{rot}\)</span>,å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå‘é‡éƒ½è¢«åˆ†è§£ä¸ºäº†å¹³è¡Œä¸å‚ç›´å‘é‡. åœ¨æ—‹è½¬ä¸­, <spanclass="math inline">\(v_\parallel\)</span>ä¸å˜, <spanclass="math inline">\(v_\perp\)</span>å‘ç”Ÿäº†<spanclass="math inline">\(\theta\)</span>è§’æ—‹è½¬, å³ $v_{rot} = v_+(kv)$<span class="math display">\[\begin{align}v_{rot} &amp;= v_{\parallel rot} + v_{\perp rot}\\&amp;= v_\parallel + v_\perp\cos\theta+(k\times v)\sin\theta\\&amp;= v_\parallel + (v-v_\parallel)\cos\theta+(k\times v)\sin\theta \\&amp;= \cos\theta v + (1-\cos\theta)v_\parallel + \sin\theta k\times v\\&amp;= \cos\theta v + (1-\cos\theta)(k\cdot v)k+\sin\theta k\times v\\\end{align}\]</span> æ•´ç†æˆçŸ©é˜µå½¢å¼å°±æ˜¯ <span class="math display">\[v_{rot} = R(\vec{n},\alpha) v\]</span></p><p><span class="math display">\[R(\vec{k},\alpha) = \cos(\alpha)\vec{I} +(1-\cos(\alpha))\vec{k}\vec{k}^T+\sin(\alpha)\left(\begin{matrix}0&amp;-k_z&amp;k_y\\k_z&amp;0&amp;-k_x\\-k_y&amp;k_x&amp;0\end{matrix}\right)\]</span></p></li></ul></li></ul><h2 id="lecture-4-transformation---è§‚æµ‹å˜æ¢">Lecture 4 Transformation -è§‚æµ‹å˜æ¢</h2><p>è§‚æµ‹å˜æ¢çš„ç›®çš„æ˜¯å°†ä¸‰ç»´ç©ºé—´ä¸­çš„ç‰©ä½“å˜ä¸ºäºŒç»´,è§‚æµ‹å˜æ¢åˆåˆ†ä¸ºè§†å›¾å˜æ¢ä¸æŠ•å½±å˜æ¢</p><p>å˜æ¢æœ‰ä¸‰æ­¥</p><ul><li>æ¨¡å‹å˜æ¢(model transformation)æ˜¯å°†æ¨¡å‹æ”¾åœ¨ä¸€ä¸ªéœ€è¦çš„åœ°æ–¹</li><li>è§‚æµ‹å˜æ¢çš„è§†å›¾å˜æ¢(view transformation)æ˜¯å°†æ‘„åƒæœºæ”¾åœ¨éœ€è¦çš„åœ°æ–¹</li><li>è§‚æµ‹å˜æ¢çš„æŠ•å½±å˜æ¢(projectiontransformation)å°±æ˜¯å°†ä¸‰ç»´åœºæ™¯æŠ•å°„åˆ°æ˜¾ç¤ºå™¨ä¸Š</li></ul><p>å°†ä¸‰ä¸ªå˜æ¢åˆç§°ä¸ºMVPå˜æ¢</p><h3 id="è§†å›¾å˜æ¢">è§†å›¾å˜æ¢</h3><p>è§†å›¾å˜æ¢å°±æ˜¯å°†ç›¸æœºæ”¾åœ¨æƒ³è¦æ”¾çš„åœ°æ–¹, æè¿°ç›¸æœºä½ç½®åº”è¯¥æœ‰:ç›¸æœºä½ç½®(Position)<span class="math inline">\(\vec{e}\)</span>,ç›¸æœºçš„è§‚æµ‹æ–¹å‘(gaze direction)<spanclass="math inline">\(\hat{g}\)</span>, ç›¸æœºæœä¸Šæ–¹å‘(up direction)<spanclass="math inline">\(\hat{t}\)</span></p><figure><img src="./img/4-1.png" alt="ç›¸æœºä½ç½®" /><figcaption aria-hidden="true">ç›¸æœºä½ç½®</figcaption></figure><p>å½“ç›¸æœºä¸è§‚æµ‹ç‰©ä½“åŒæ—¶ç§»åŠ¨ä½†ç›¸å¯¹é™æ­¢æ—¶è§‚æµ‹çš„åœºæ™¯åº”è¯¥æ˜¯ä¸å˜çš„,äºæ˜¯æˆ‘ä»¬å¸Œæœ›å°†ç›¸æœºæ”¾åœ¨ä¸€ä¸ªå›ºå®šä½ç½®, åªè®©åœºæ™¯åŠ¨. çº¦å®šç›¸æœºå§‹ç»ˆåœ¨åŸç‚¹,çœ‹å‘<span class="math inline">\(oz\)</span>è´Ÿæ–¹å‘, <spanclass="math inline">\(oy\)</span>ä¸ºæœä¸Šæ–¹å‘</p><figure><img src="./img/4-2.png" alt="ç›¸å¯¹ä½ç½®" /><figcaption aria-hidden="true">ç›¸å¯¹ä½ç½®</figcaption></figure><p>å°†ç›¸æœºä»ä»»æ„ä½ç½®ç§»åŠ¨åˆ°åŸç‚¹åªéœ€åšå‡ æ¬¡ä»¿å°„å˜æ¢</p><ul><li>å¹³ç§»<span class="math inline">\((-x,-y,-z)\)</span></li><li>å°†<span class="math inline">\(\hat{g}\)</span>è½¬åŠ¨åˆ°<spanclass="math inline">\(-oz\)</span></li><li>å°†<span class="math inline">\(\vec{t}\)</span>è½¬åŠ¨åˆ°<spanclass="math inline">\(oy\)</span></li><li>å°†<span class="math inline">\(\hat{g} \times\vec{t}\)</span>è½¬åŠ¨åˆ°<span class="math inline">\(ox\)</span></li></ul><p>å°†å‘é‡æ—‹è½¬åˆ°åæ ‡è½´ä¸å¤ªå¥½å†™,æˆ‘ä»¬å¯ä»¥å…ˆå°†åæ ‡è½´æ—‹è½¬åˆ°å‘é‡ç„¶åæ±‚é€†çŸ©é˜µ(ç”±äºæ—‹è½¬çŸ©é˜µæ˜¯æ­£äº¤çŸ©é˜µ,çŸ©é˜µçš„è½¬ç½®å°±æ˜¯é€†çŸ©é˜µ), æœ€åå¾—åˆ° <span class="math display">\[\left[\begin{matrix}x_{\hat{g}\times \hat{t}}&amp;y_{\hat{g}\times\hat{t}}&amp;z_{\hat{g}\times\hat{t}}&amp;0\\x_{t}&amp;y_{t}&amp;z_{t}&amp;0\\x_{-g}&amp;y_{-g}&amp;z_{-g}&amp;0\\0&amp;0&amp;0&amp;1\\\end{matrix}\right]\left[\begin{matrix}1&amp;0&amp;0&amp;-x_e\\0&amp;1&amp;0&amp;-y_e\\0&amp;0&amp;1&amp;-z_e\\0&amp;0&amp;0&amp;1\\\end{matrix}\right]\]</span></p><h3 id="æŠ•å½±å˜æ¢">æŠ•å½±å˜æ¢</h3><p>æŠ•å½±å°±æ˜¯å°†3Dè½¬ä¸º2Dçš„è¿‡ç¨‹, åˆ†ä¸ºæ­£äº¤æŠ•å½±(Orthographicprojection)ä¸é€è§†æŠ•å½±(Perspective projection)</p><p><img src="./img/4-3.jpg" /></p><p><img src="./img/4-4.png" /></p><ul><li>é€è§†æŠ•å½±(å·¦): è®¤ä¸ºæ‘„åƒæœºæ˜¯ä¸€ä¸ªç‚¹, è€ƒè™‘äººç±»è§†è§‰ç‰¹æ€§,å¹³è¡Œçº¿å¯èƒ½ä¸å¹³è¡Œ, æœ‰è¿‘å¤§è¿œå°æ•ˆæœ.</li><li>æ­£äº¤æŠ•å½±(å³): è®¤ä¸ºæ‘„åƒæœºæ˜¯ä¸€ä¸ªè·ç¦»ç‰©ä½“æ— é™è¿œ, æŒ‰ç…§ç‰©ä½“æœ¬èº«å±æ€§æŠ•å½±,å¹³è¡Œçº¿ä»æ—§å¹³è¡Œ, æ²¡æœ‰è¿‘å¤§è¿œå°æ•ˆæœ, ä¸€èˆ¬ç”¨äºå·¥ç¨‹åˆ¶å›¾</li></ul><p><strong>æ­£äº¤æŠ•å½±</strong></p><p>æ­£äº¤æŠ•å½±å®ç°æ€è·¯ç®€å•,</p><ul><li>å°†åœºæ™¯åŒ…è£¹åœ¨ä¸€ä¸ªç«‹æ–¹ä½“ä¸­</li><li>å°†åœºæ™¯ä¸­å¿ƒç§»åŠ¨åˆ°åŸç‚¹</li><li>å°†ç«‹æ–¹ä½“ç¼©æ”¾åˆ°<spanclass="math inline">\([-1,1]^3\)</span>çš„ç«‹æ–¹ä½“(canonicalcube)ä¸­(éç­‰æ¯”ç¼©æ”¾)</li><li>å°†æ‰€æœ‰ç‚¹çš„<spanclass="math inline">\(z\)</span>å€¼è®¾ä¸º0å³å¯(å¿½ç•¥è¦†ç›–é—®é¢˜)</li></ul><p>è¿™é‡Œæ˜¯åœ¨è§†å›¾å˜æ¢ç»“æŸä¹‹åå°†åœºæ™¯ç§»åŠ¨åˆ°ä¸­å¿ƒå¹¶ç¼©æ”¾åˆ°æ­£åˆ™ç«‹æ–¹ä½“ä¸­,ä¸ä¼šå½±å“æ‘„åƒæœºä½ç½®,åç»­ä¼šé€šè¿‡è§†å£å˜æ¢ç­‰æ–¹æ³•è§£å†³å¹³ç§»ä¸éç­‰æ¯”ç¼©æ”¾ç­‰å¸¦æ¥ä½ç½®çš„é—®é¢˜</p><figure><img src="./img/4-5.png" alt="æ­£äº¤æŠ•å½±" /><figcaption aria-hidden="true">æ­£äº¤æŠ•å½±</figcaption></figure><p>å®šä¹‰è¿œ(f)è¿‘(n)å·¦(l)å³(r)ä¸Š(t)ä¸‹(b)å®¹æ˜“å¾—åˆ°å˜æ¢çŸ©é˜µ <spanclass="math display">\[M_{ortho} =\left[\begin{matrix}\frac{2}{r-l}&amp;0&amp;0&amp;0\\0&amp;\frac{2}{t-b}&amp;0&amp;0\\0&amp;0&amp;\frac{2}{n-f}&amp;0\\0&amp;0&amp;0&amp;1\end{matrix}\right]\left[\begin{matrix}1&amp;0&amp;0&amp;-\frac{r+l}{2}\\0&amp;1&amp;0&amp;-\frac{t+b}{2}\\0&amp;0&amp;1&amp;-\frac{n+f}{2}\\0&amp;0&amp;0&amp;1\end{matrix}\right]\]</span> <strong>é€è§†æŠ•å½±</strong></p><p><img src="./img/4-6.png" /></p><p>æˆ‘ä»¬å¯ä»¥å°†éœ€è¦æè¿°çš„ç‰©ä½“æ”¾åœ¨å·¦è¾¹è¿™æ ·çš„è§†é”¥(Frustum)ä¸­,å¯ä»¥è¿™æ ·ç†è§£è§†é”¥: ä»æ‘„åƒæœº(åŸç‚¹)å¤„å¾€å¤–çœ‹, å¯è§èŒƒå›´å°±æ˜¯ä¸€ä¸ªé”¥ä½“,æˆ‘ä»¬æˆªå‡ºä¸€ä¸ªå°å‡ºæ¥, (å½“ç„¶, è¿™ä¸ªæ£±å°çš„è¾¹ä¼šæ±‡èšåˆ°åŸç‚¹)</p><p>ç”¨å¦‚ä¸‹çš„æ–¹æ³•å®šä¹‰ä¸€ä¸ªè§†é”¥: è§†é‡çš„é•¿å®½æ¯”,è§†é‡èŒƒå›´(æ°´å¹³/å‚ç›´å¯è§†è§’åº¦)</p><p><img src="./img/4-8.png" /></p><ul><li>å®½é«˜æ¯”: <span class="math inline">\(Aspect = x_{right} /y_{top}\)</span></li><li>å‚ç›´å¯è§†è§’: <span class="math inline">\(\tan\frac{forY}{2} =\frac{y_{top}}{\|z_{near}\|}\)</span></li></ul><p>æˆ‘ä»¬æƒ³è¦åšçš„å°±æ˜¯å°†è¿™ä¸ªæ¤ä½“æŠ•å½±åˆ°å±å¹•ä¸Š,è§£å†³æ–¹æ³•æ˜¯<strong>å…ˆå°†æ¤ä½“"å‹"åˆ°å³è¾¹çš„ä¸€ä¸ªç«‹æ–¹ä½“(Cuboid)ä¸­,ç„¶åå†åšæ­£äº¤æŠ•å½±</strong>. åœ¨å˜æ¢è¿‡ç¨‹ä¸­æˆ‘ä»¬å¯ä»¥ä¿è¯</p><ul><li>Nearé¢æ˜¯å®Œå…¨ä¸å˜çš„.</li><li>åœ¨"å‹"çš„è¿‡ç¨‹ä¸­Faré¢ä¸Šå„ä¸ªç‚¹çš„<spanclass="math inline">\(z=f\)</span>(ä½†è¿™ä¸æ„å‘³ç€æ¤ä½“å†…éƒ¨ç‚¹åœ¨å‹çš„è¿‡ç¨‹ä¸­zå€¼ä¸å˜)</li><li>ç”±äºFrustumçš„è½´å¿ƒç©¿è¿‡<span class="math inline">\(oz\)</span>,æ‰€ä»¥Faré¢çš„ä¸­å¿ƒä»ç„¶åœ¨<span class="math inline">\(oz\)</span>è½´ä¸Š</li></ul><p>éœ€è¦åšçš„å°±æ˜¯æ±‚æŒ¤å‹çŸ©é˜µ<span class="math inline">\(M_{persp\toortho}\)</span></p><p>ä»<span class="math inline">\(ox\)</span>è´Ÿæ–¹å‘çœ‹è§†é”¥</p><p><img src="./img/4-7.png" /></p><p>é€šè¿‡ç›¸ä¼¼ä¸‰è§’å½¢å¯ä»¥è½»æ¾å¾—åˆ° <span class="math display">\[y&#39; = \frac{n}{z}y\]</span> ç±»ä¼¼çš„å¯ä»¥å¾—åˆ° <span class="math display">\[x&#39; = \frac{n}{z}x\]</span> å¾—åˆ°äº†éƒ¨åˆ†å˜æ¢ <span class="math display">\[(x,y,z,1)^T \to (nx/z, ny/z, ?, 1)\]</span> è¿™é‡Œæˆ‘ä»¬è¿›è¡Œä¸€ä¸ªå°çš„ç­‰ä»·å˜æ¢(ä»¥èŠ‚çœè®¡ç®—èµ„æº?) <spanclass="math display">\[(x,y,z,1)^T \to (nx/z, ny/z, ?, 1) = (nx, ny, ?, z)\]</span> å°±å‰©ä¸‹<spanclass="math inline">\(z\)</span>ä¸çŸ¥é“æ€ä¹ˆæ±‚äº†(ä¹Ÿå°±æ˜¯å˜æ¢çŸ©é˜µçš„ç¬¬ä¸‰è¡Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆ),è®¾å…¶ä¸º<span class="math inline">\((a,b,c,d)\)</span>, æˆ‘ä»¬åº”è¯¥æœ‰<spanclass="math inline">\((a,b,c,d)^T(x,y,z,1) = z&#39;z\)</span></p><ul><li>è¿‘å¹³é¢ä¸Šçš„ç‚¹ä¸å˜, å³: <span class="math inline">\(z = n\)</span>æ—¶,<span class="math inline">\(z&#39; = z\)</span>, å³<spanclass="math inline">\(x,y\)</span>åº”è¯¥ä¸<spanclass="math inline">\(z\)</span>æ— å…³, å³<span class="math inline">\(a =b = 0\)</span>, åŒæ—¶<span class="math inline">\(c \times n + d =n^2\)</span></li><li>è¿œå¹³é¢ä¸­å¿ƒç‚¹ä¸å˜, å³: <span class="math inline">\(c\times f + d =f^2\)</span></li></ul><p>æ±‚å¾—: <span class="math inline">\(c = n+f, d = -nf\)</span>,æœ€åå¾—åˆ°é€è§†æŠ•å½±çŸ©é˜µ <span class="math display">\[M_{persp\to ortho} =\left[\begin{matrix}n&amp;0&amp;0&amp;0\\0&amp;n&amp;0&amp;0\\0&amp;0&amp;n+f&amp;-nf\\0&amp;0&amp;1&amp;0\end{matrix}\right]\]</span></p><h2 id="lecture-5-rasterization---ä¸‰è§’å½¢">Lecture 5 Rasterization -ä¸‰è§’å½¢</h2><p>å®Œæˆå˜æ¢ä¹‹å, æˆ‘ä»¬å°†ç‰©ä½“ç¼©æ”¾åˆ°äº†ä¸€ä¸ª<spanclass="math inline">\([-1,1]^3\)</span>çš„æ­£åˆ™Cubeä¸­,ä¹‹åéœ€è¦å°†å…¶å…‰æ …åŒ–(Rasterize)åˆ°å±å¹•(Raster)ä¸Š</p><h3 id="å…‰æ …æ˜¾ç¤ºè®¾å¤‡">å…‰æ …æ˜¾ç¤ºè®¾å¤‡</h3><ul><li><p>æ¿€å…‰åˆ‡å‰²æœº</p></li><li><p>ç¤ºæ³¢å™¨</p></li><li><p>é˜´æå°„çº¿ç®¡(CRT): é€šè¿‡ä¸¤ä¸ªåè½¬ç£åœºå°†ç”µå­æ‰“åœ¨è§å…‰å±ä¸Š,é€šè¿‡æ‰«æçš„æ–¹å¼å®ç°è¦†ç›–, ååˆé€šè¿‡éš”è¡Œæ‰«æçš„æ–¹å¼å‡å°‘æ—¶é—´å¼€é”€,ä½†æ˜¯åœ¨æ‰«æè¿åŠ¨åœºæ™¯æ—¶ä¼šé€ æˆç”»é¢æ’•è£‚(é¬¼å½±)</p></li><li><p>é€šç”¨æ˜¾ç¤ºå™¨(LCD/ LED/ OLED...): å°†æ˜¾å­˜ä¸­åŒºåŸŸæ˜ å°„åˆ°å›¾åƒ</p></li><li><p>LCDæ˜¾ç¤ºå™¨</p><p><img src="./img/5-1.png" /></p><p>æ¶²æ™¶æ˜¾ç¤ºå™¨å‰åæœ‰ä¸¤ä¸ªå‚ç›´çš„å…‰æ ….æ­£å¸¸æƒ…å†µä¸‹åªæœ‰æ³¢åŠ¨æ–¹å‘ç›¸åŒçš„å…‰æ‰èƒ½é€šè¿‡å…‰æ …, å³ä¸åº”è¯¥æœ‰å…‰é€šè¿‡ç›¸äº’å…‰æ …,æ¶²æ™¶æ˜¾ç¤ºå™¨ä¸­çš„æ¶²æ™¶å¯ä»¥é€šè¿‡éœ‡åŠ¨å¼•å¯¼å…‰æ”¹å˜æ³¢åŠ¨æ–¹å‘ä»è€Œæ“ä½œéœ€è¦æ˜¾ç¤ºçš„éƒ¨åˆ†</p></li><li><p>å¢¨æ°´å±: æœ‰é»‘ç™½ä¸¤ç§åˆ†åˆ«å¸¦ç”µå¢¨æ°´,é€šè¿‡åŠ ç”µæ”¹å˜ä¸¤ç§é¢œè‰²å¢¨æ°´æœå‘</p></li></ul><h3 id="å…‰æ …åŒ–">å…‰æ …åŒ–</h3><p>å…‰æ …åŒ–å°±æ˜¯å°†ä¸‰ç»´å›¾å½¢æ˜¾ç¤ºåˆ°å±å¹•ä¸Šçš„è¿‡ç¨‹.å¯ä»¥è®¤ä¸ºå±å¹•å°±æ˜¯ä¸€ä¸ªå†…å­˜ä¸­çš„äºŒç»´æ•°ç»„(å·¦ä¸‹è§’ä¸º<spanclass="math inline">\((0,0)\)</span>, åƒç´ <spanclass="math inline">\((x,y)\)</span>çš„ä¸­å¿ƒåœ¨<spanclass="math inline">\((x+0.5,y+0.5)\)</span>)</p><p><strong>å°†Cubeç¼©æ”¾åˆ°å±å¹•(è§†å£å˜æ¢)</strong></p><p>å¿½ç•¥<span class="math inline">\(z\)</span>, å°†<spanclass="math inline">\([-1,1]\)</span>ç¼©æ”¾åˆ°<spanclass="math inline">\([0, width]\times [0,height]\)</span>. <spanclass="math display">\[M_{viewport} = \left[\begin{matrix}\frac{width}{2}&amp;0&amp;0&amp;\frac{width}{2}\\0&amp;\frac{height}{2}&amp;0&amp;\frac{height}{2}\\0&amp;0&amp;1&amp;0\\0&amp;0&amp;0&amp;1\\\end{matrix}\right]\]</span> <strong>ä½¿ç”¨ä¸‰è§’å½¢è¡¨è¿°å›¾åƒ</strong></p><p>ä¸€èˆ¬ç”¨ä¸‰è§’å½¢è¡¨è¿°å¤æ‚çš„å›¾åƒ, åŸå› æ˜¯</p><ul><li>ä¸‰è§’å½¢åªèƒ½æ„æˆä¸€ä¸ªå¹³é¢(å››è¾¹å½¢å°±å¯ä»¥æŠ˜å æˆç«‹ä½“çš„)</li><li>ä¸å­˜åœ¨å‡¹å¤šè¾¹å½¢, å®¹æ˜“åˆ¤æ–­ç‚¹ä¸ä¸‰è§’å½¢å…³ç³»</li><li>åªéœ€è¦å®šä¹‰ä¸‰è§’å½¢é¡¶ç‚¹ä¿¡æ¯å°±å¯ä»¥åœ¨å†…éƒ¨è½»æ¾æ’å€¼</li><li>ä¸‰è§’å½¢å¯ä»¥è¡¨ç¤ºä»»æ„å¤šè¾¹å½¢</li></ul><p><strong>é€šè¿‡é‡‡æ ·(simple)å°†ä¸‰è§’å½¢æ‰“ç¢åœ¨åƒç´ ä¸Š</strong></p><p>é‡‡æ ·å°±æ˜¯å°†å‡½æ•°ç¦»æ•£åŒ–çš„è¿‡ç¨‹,å¯¹äºä¸‰è§’å½¢å…‰æ …åŒ–æ¥è¯´å°±æ˜¯è¯¢é—®æ¯ä¸€ä¸ªåƒç´ åœ¨ä¸åœ¨ä¸‰è§’å½¢å†…</p><p>åˆ¤æ–­åƒç´ æ˜¯å¦åœ¨ä¸‰è§’å½¢å†…å°±æ˜¯é€šè¿‡å‰ç§¯åˆ¤æ–­åƒç´ ä¸­å¿ƒç‚¹ä¸ä¸‰è§’å½¢å…³ç³»</p><p><strong>é€šè¿‡Bounding Boxç¼©å°é‡‡æ ·èŒƒå›´</strong></p><p>å¯¹æ¯ä¸€ä¸ªåƒç´ éƒ½é‡‡æ ·æ¶ˆè€—è¿‡å¤§. æ˜¾ç„¶, åªæœ‰<spanclass="math inline">\([x_{min}, x_{max}]\times [y_{min},y_{max}]\)</span>èŒƒå›´å†…çš„ç‚¹æ‰æœ‰å¯èƒ½è½åœ¨ä¸‰è§’å½¢å†…, æ‰€ä»¥åªéå†è¿™ä¸ªåŒºåŸŸ.æˆ‘ä»¬ç§°è¿™æ ·ä¸‰ä¸ªé¡¶ç‚¹çš„æœ€å¤§æœ€å°å€¼å›´æˆçš„çŸ©å½¢ä¸ºBounding Box.</p><p>Bounding Boxä¹Ÿæ˜¯æœ‰ç¼ºç‚¹çš„, ä¾‹å¦‚ä¸€äº›æ–œæ”¾çš„çª„é•¿ä¸‰è§’å½¢, BoundingBoxä¼šå¤šç®—å¾ˆå¤šåƒç´ </p><p><img src="./img/5-2.png" /></p><p>æˆ‘ä»¬å¯ä»¥ä¼˜åŒ–ä¸€äº›ç‰¹æ®Šæƒ…å†µ,ä¾‹å¦‚å€¾æ–œä¸‰è§’å½¢å¯ä»¥ä»æ¯è¡Œçš„ä¸€è¾¹å¼€å§‹ä»å·¦åˆ°å³é‡‡æ ·</p><p><img src="./img/5-3.png" /></p><p><strong>é”¯é½¿(Jaggies) / èµ°æ ·(asing)é—®é¢˜</strong></p><p>æ¯ä¸ªåƒç´ éƒ½æœ‰ä¸€å®šå¤§å°, è¿™å¯¼è‡´æˆ‘ä»¬çš„é‡‡æ ·é¢‘ç‡æ˜¯ä¸€ä¸ªå¸¸æ•°,é‡‡æ ·é¢‘ç‡è¿‡ä½æ—¶ä¼šå‡ºç°èµ°æ ·é—®é¢˜</p><p><img src="./img/5-4.png" /></p><h2 id="lecture-6-rasterization---åèµ°æ ·ä¸æ·±åº¦æµ‹è¯•">Lecture 6Rasterization - åèµ°æ ·ä¸æ·±åº¦æµ‹è¯•</h2><h3 id="åèµ°æ ·">åèµ°æ ·</h3><p><strong>èµ°æ ·çš„åŸå› </strong>: åƒç´ æœ‰ä¸€å®šå°ºå¯¸, é‡‡æ ·é¢‘ç‡ä¸è¶³</p><p><strong>å¸¸è§èµ°æ ·</strong>: é”¯é½¿ / æ‘©å°”çº¹ / è½¦è½®æ•ˆåº”(wagon wheelillusion)...</p><p><strong>é‡‡æ ·é¢‘ç‡å¸¦æ¥èµ°æ ·çš„åŸå› </strong>:</p><p>å¯ä»¥çœ‹åˆ°, ä½¿ç”¨åŒæ ·çš„é‡‡æ ·é¢‘ç‡é‡‡æ ·ä½é¢‘ä¿¡å·æ—¶,é‡‡æ ·ç»“æœ(è“è‰²è™šçº¿)å¯ä»¥åŸºæœ¬è¿˜åŸåŸå‡½æ•°,ä½†é‡‡æ ·é«˜é¢‘ä¿¡å·æ—¶è¿˜åŸèƒ½åŠ›å˜å·®(æ²¡æ³•æ¢å¤ä¿¡æ¯)</p><p><img src="./img/6-1.png" /></p><p>ä½¿ç”¨åŒæ ·çš„é‡‡æ ·é¢‘ç‡é‡‡æ ·è“é»‘ä¸¤ä¸ªå‡½æ•°å¾—åˆ°åŒæ ·çš„ç»“æœ,æˆ‘ä»¬æ— æ³•é€šè¿‡é‡‡æ ·ç»“æœåŒºåˆ†ä»–ä»¬, è¿™å°±æ˜¯èµ°æ ·</p><p><img src="./img/6-2.png" /></p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>: å…ˆè¿‡æ»¤å›¾åƒçš„é«˜é¢‘éƒ¨åˆ†å†é‡‡æ ·,ä¹Ÿå°±æ˜¯å…ˆæ¨¡ç³Šå†é‡‡æ ·, å…¶æœ‰æ•ˆçš„åŸå› å¦‚ä¸‹</p><ul><li><p>å¯ä»¥é€šè¿‡å‚…ç«‹å¶å˜æ¢å¾—åˆ°å›¾ç‰‡çš„é¢‘è°±</p><p><img src="./img/6-3.png" /></p><p>è¿™æ ·ç†è§£å›¾åƒçš„é¢‘è°±: å‡è®¾æˆ‘ä»¬ç”¨ç°åº¦å€¼ä½œä¸º<spanclass="math inline">\(oz\)</span>è½´, æˆ‘ä»¬å¯ä»¥åœ¨åŸå›¾ä¸Šå¾—åˆ°ä¸€ä¸ªä¸‰ç»´åæ ‡ç³».å¯¹è¿™ä¸ªå›¾åšå‚…ç«‹å¶å˜æ¢, å³ç”¨æ³¢å‡½æ•°å åŠ é€¼è¿‘å›¾åƒ, æ¯ä¸ªæ³¢å‡½æ•°å¤§æ¦‚æ˜¯è¿™æ ·çš„</p><p><img src="./img/6-6.png" /></p><p>ä»–ä»¬å åŠ æœ€åé€¼è¿‘å›¾åƒ, ä¾‹å¦‚</p><p><img src="./img/6-7.png" /></p><p>æˆ‘ä»¬éœ€è¦åœ¨é¢‘è°±å›¾ä¸­æè¿°è¿™äº›ä¸‰ç»´æ³¢å‡½æ•°. æˆ‘ä»¬éœ€è¦ç”¨é¢‘ç‡<spanclass="math inline">\(f\)</span>, å¹…åº¦<spanclass="math inline">\(A\)</span>, ç›¸ä½<spanclass="math inline">\(\phi\)</span>æè¿°äºŒç»´æ³¢å‡½æ•°,åœ¨ä¸‰ç»´ä¸­æˆ‘ä»¬è¿˜è¦ç”¨æ–¹å‘<spanclass="math inline">\(\vec{n}\)</span>æè¿°æ³¢çš„è¿åŠ¨æ–¹å‘. åœ¨é¢‘è°±å›¾ä¸­,æˆ‘ä»¬ç”¨ç‚¹åˆ°ä¸­å¿ƒçš„è·ç¦»æè¿°é¢‘ç‡<span class="math inline">\(f\)</span>é«˜ä½,ç”¨ç‚¹çš„äº®åº¦æè¿°å¹…åº¦<span class="math inline">\(A\)</span>,ç”¨ä¸­å¿ƒåˆ°ç‚¹çš„æ–¹å‘æè¿°æ–¹å‘<span class="math inline">\(\vec{n}\)</span>.å¯ä»¥çœ‹åˆ°åœ¨å³è¾¹é¢‘è°±ä¸­, å¤§éƒ¨åˆ†ç‚¹åœ¨ä½é¢‘(å¤§å¤šè‡ªç„¶å›¾åƒéƒ½æ˜¯è¿™æ ·çš„).æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ä¸­é—´æœ‰ä¸¤æ¡ä¸¤çº¿, è¿™æ˜¯å› ä¸ºæ³¢å‡½æ•°çš„å®šä¹‰åŸŸæ˜¯<spanclass="math inline">\(\mathbb{R}^2\)</span>, æˆ‘ä»¬éœ€è¦ä¸æ–­çš„å°†å›¾åƒä¸Šä¸‹è¾¹,å·¦å³è¾¹æ‹¼æ¥åœ¨ä¸€èµ·, æœ€åå¾—åˆ°æ— é™å¤§çš„å›¾ç‰‡, ä½†æ˜¯å›¾ç‰‡ä¸Šä¸‹è¾¹, å·¦å³è¾¹å·®è·è¿‡å¤§,æ‰€ä»¥ä¼šå‡ºç°é«˜é¢‘.</p></li><li><p>å¯¹é¢‘è°±åº”ç”¨ä½é€šæ»¤æ³¢å™¨</p><p><img src="./img/6-4.png" /></p><p>å›¾åƒå˜æ¨¡ç³Š (å˜åŒ–å‰§çƒˆ(è¾¹ç¼˜)çš„éƒ¨åˆ†è¢«æŠ¹å»äº†)</p></li><li><p>å¯¹é¢‘è°±åº”ç”¨é«˜é€šæ»¤æ³¢å™¨</p><p><img src="./img/6-5.png" /></p><p>è¾¹ç¼˜è¢«æå–äº†</p></li><li><p>æˆ‘ä»¬å¸Œæœ›å»æ‰é«˜é¢‘ä¿¡å·, è¿™æ ·å¯ä»¥è®©é‡‡æ ·çš„ç»“æœèµ°æ ·å‡å°‘.è€Œå»æ‰é«˜é¢‘ä¼šè®©å›¾åƒå˜æ¨¡ç³Š. ä½†æ˜¯ä¼šæœ‰ä¸€äº›é‡‡æ ·ç‚¹å‡ºç°é¢œè‰²è¿‡æ¸¡</p><p><img src="./img/6-8.png" /></p><p>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨å¯¹å›¾åƒåšå·ç§¯æ›¿ä»£å‚…ç«‹å¶å˜æ¢-æ»¤æ³¢-é€†å˜æ¢çš„æ–¹æ³•è®©å›¾åƒå˜æ¨¡ç³Š(åœ¨æ—¶åŸŸä¸Šåšå·ç§¯ç›¸å½“äºåœ¨é¢‘åŸŸä¸Šåšä¹˜ç§¯),é‡‡ç”¨éå¸¸ç®€å•å·ç§¯æ–¹æ³•<span class="math inline">\(color[x,y] =\sum_{i=-1}^{i=1}\sum_{j=-1}^{j=1}color[x+i,y+j]/9\)</span></p></li></ul><p><strong>æ³¨æ„</strong>: å…ˆæ¨¡ç³Šå†é‡‡æ ·è€Œä¸èƒ½å…ˆé‡‡æ ·å†æ¨¡ç³Š, åŸå› å¦‚ä¸‹</p><ul><li><p>é‡‡æ ·ç›¸å½“äºç”¨ç‹„å¡æ‹‰æ¢³çŠ¶å‡½æ•°ä¹˜ä»¥æ—¶åŸŸä¸Šçš„å‡½æ•°, ç›¸å½“äºåœ¨é¢‘åŸŸä¸Šå·ç§¯,æœ€åå¾—åˆ°äº†é‡å¤çš„ä¸€å †å‡½æ•°</p><p><img src="./img/6-9.png" /></p></li><li><p>å¦‚æœé‡‡æ ·é—´éš”è¿‡å¤§, å°±ä¼šé€ æˆé‡å¤å‡½æ•°åœ¨é«˜é¢‘ä¸Šçš„å åŠ , äº§ç”Ÿèµ°æ ·</p><p><img src="./img/6-10.png" /></p></li><li><p>æ¨¡ç³Šæ“ä½œç›¸å½“äºè¿‡æ»¤æ‰äº†é«˜é¢‘éƒ¨åˆ†, ä»è€Œåœ¨é‡‡æ ·æ—¶ä¸äº§ç”Ÿå åŠ </p><p><img src="./img/6-11.png" /></p></li><li><p>å…ˆé‡‡æ ·åæ¨¡ç³Šç›¸å½“äºå…ˆå‘ç”Ÿäº†é«˜é¢‘å åŠ , ç„¶åè½½è¿‡æ»¤æ‰ä¸€éƒ¨åˆ†å åŠ éƒ¨åˆ†,æ‰€ä»¥æ•ˆæœä¸å¥½</p></li></ul><p>é™¤äº†ç®€å•å·ç§¯, æˆ‘ä»¬å¯ä»¥é€šè¿‡æé«˜é‡‡æ ·ç‡(è¶…é‡‡æ ·æŠ€æœ¯(Supersampling,MSAA))å†æ±‚å‡å€¼çš„æ–¹æ³•è®©å›¾åƒå˜æ¨¡ç³Š, ä¾‹å¦‚ä¸‹é¢æ˜¯ä¸€ä¸ª<spanclass="math inline">\(2\times 2\)</span>çš„MSAA</p><ul><li><p>æˆ‘ä»¬å°†ä¸€ä¸ªåƒç´ ç‚¹å˜ä¸º<span class="math inline">\(2\times2\)</span>ä¸ªåƒç´ ç‚¹, ç”¨æ¯ä¸ªå°åƒç´ ç‚¹é‡‡æ ·(è®¡ç®—æ˜¯å¦åœ¨ä¸‰è§’å½¢å†…)</p><p><img src="./img/6-12.png" /></p><ul><li>ç„¶åå¯¹æ¯ä¸ªåƒç´ æ±‚å¹³å‡</li></ul><p><img src="./img/6-13.png" /></p><p><img src="./img/6-14.png" /></p></li></ul><p>æ˜¾ç„¶, <span class="math inline">\(n\timesn\)</span>çš„MSAAéœ€è¦æ¶ˆè€—ç›´æ¥é‡‡æ ·<spanclass="math inline">\(n^2\)</span>å€çš„æ—¶ç©º, åœ¨å·¥ä¸šä¸­,æˆ‘ä»¬å¯ä»¥é‡æ–°å®šä¹‰å°åƒç´ çš„æ’åˆ—ä½ç½®å®ç°å°åƒç´ åœ¨åƒç´ é—´çš„å¤ç”¨</p><p><img src="./img/6-15.jpg" /></p><p>è¿˜æœ‰æ›´å¤šçš„åèµ°æ ·æ–¹æ³•: ä¾‹å¦‚FXAA(å…ˆé‡‡æ ·å¾—åˆ°é”¯é½¿å›¾, ç„¶ååŒ¹é…é”¯é½¿,æ›¿æ¢é”¯é½¿), TAA(ä¸ä¸Šä¸‹å¸§å¯¹å¯¹æ¯”åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢å†…)</p><h3 id="æ·±åº¦æµ‹è¯•">æ·±åº¦æµ‹è¯•</h3><p>ä¹‹å‰æ²¡æœ‰è€ƒè™‘å…‰æ …åŒ–è¿‡ç¨‹ä¸­å›¾åƒåœ¨<spanclass="math inline">\(oz\)</span>è½´ä¸Šçš„è¦†ç›–å…³ç³»,æœ‰å¯èƒ½å‡ºç°é åçš„å›¾åƒè¦†ç›–åœ¨è€ƒå‰çš„å›¾åƒå‰</p><p>å¤„ç†è¦†ç›–å…³ç³»çš„æœ´ç´ æƒ³æ³•æ˜¯æ ¹æ®ä¸‰è§’å½¢è·ç¦»æ’åº, å…ˆç”»è·ç¦»è¿œçš„,å†ç”»è·ç¦»è¿‘çš„, åç”»çš„è¦†ç›–ä¹‹å‰ç”»çš„,ä½†æ˜¯ç»å¸¸ä¼šé‡åˆ°å¾ªç¯è¦†ç›–ç­‰é—®é¢˜(ä¸‰è§’å½¢å„ä¸ªç‚¹å¤„<spanclass="math inline">\(z\)</span>å€¼å¯èƒ½ä¸åŒ), ä¾‹å¦‚</p><p><img src="./img/6-16.png" /></p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, å¼•å…¥äº†æ·±åº¦ç¼“å­˜æŠ€æœ¯. å³å¼€ä¸€ä¸ªä¸æˆå“å›¾åŒæ ·å¤§å°çš„æ•°ç»„,ä¸ºæ¯ä¸ªåƒç´ è®°å½•äº†è¯¥åƒç´ ä¸Šå·²ç»æ¸²æŸ“çš„ç‚¹çš„<spanclass="math inline">\(z\)</span>å€¼,æ¯æ¬¡å°è¯•å°†ä¸€ä¸ªä¸‰è§’å½¢æ¸²æŸ“åœ¨è¯¥ç‚¹ä¸Šæ—¶å°±ä¼šæ¯”è¾ƒå½“å‰è¯¥ç‚¹ä¸Šå·²æ¸²æŸ“å†…å®¹çš„æ·±åº¦ä¸ä¸‰è§’å½¢åœ¨è¯¥ç‚¹ä¸Šçš„æ·±åº¦,å¦‚æœæ–°ä¸‰è§’å½¢è·ç¦»ç›¸æœºå¾ˆè¿‘å°±æ›¿æ¢ä¹‹. ä¾‹å¦‚å·¦å›¾æ˜¯æ¸²æŸ“ç»“æœ,å³å›¾æ˜¯æ·±åº¦ç¼“å­˜(depth buffer)</p><p><img src="./img/6-17.png" /></p><h2 id="lecture-7-shading---blinn-phongåå°„æ¨¡å‹">Lecture 7 Shading -Blinn-Phongåå°„æ¨¡å‹</h2><p>ç€è‰²å°±æ˜¯å¯¹ä¸åŒçš„ç‰©ä½“åº”ç”¨ä¸åŒæè´¨çš„è¿‡ç¨‹</p><p>å¸ƒæ—å†¯åå°„æ¨¡å‹æ˜¯ç”¨æ¥æè¿°å…‰åœ¨ç‰©ä½“ä¸Šåå°„çš„ç®€å•æ¨¡å‹.Blinn-Phongæ¨¡å‹æ˜¯ä¸€ä¸ªç»éªŒæ¨¡å‹, ä¸è€ƒè™‘é˜´å½±,ä¸è€ƒè™‘å…‰ä»åå°„ç‚¹åˆ°è§‚å¯Ÿè€…çš„èƒ½é‡è¡°å‡, æ‰€ä»¥æ¨¡å‹æ•ˆæœä¸ä¸€å®šå¥½,ä¹Ÿä¸ä¸€å®šç»å¾—èµ·æ¨æ•²</p><p>Blinn-Phongæ¨¡å‹å°†å…‰åœ¨æè´¨ä¸Šçš„åå°„åˆ†ä¸ºä¸‰ä¸ªåŒºåŸŸ:</p><ul><li>é«˜å…‰éƒ¨åˆ†(Specular highlights): å…‰çº¿ç…§åˆ°å‘ç”Ÿé•œé¢åå°„éƒ¨åˆ†</li><li>æ¼«åå°„åŒº(Diffuse reflection): å…‰çº¿ç…§åˆ°å‘ç”Ÿæ¼«åå°„éƒ¨åˆ†</li><li>ç¯å¢ƒå…‰åŒº(Ambient lighting): å…‰æœ¬èº«ç…§ä¸åˆ°, ä½†æ˜¯è¢«å…¶ä»–éƒ¨åˆ†å…‰åå°„ç…§åˆ°,å‡è®¾ä»»ä½•ä¸€ä¸ªç‚¹éƒ½å¯ä»¥æ¥æ”¶åˆ°å¤§å°ä¸ºå¸¸é‡çš„ç¯å¢ƒå…‰</li></ul><p><img src="./img/7-1.png" /></p><p>æˆ‘ä»¬å‡è®¾ç€è‰²ç‚¹(shading point, å°±æ˜¯åå°„ç‚¹)æ‰€åœ¨çš„é¢æ˜¯ä¸€ä¸ªå°å¹³é¢,shading pointåˆ°å…‰æºæ–¹å‘<span class="math inline">\(l\)</span>, shadingpointåˆ°è§‚å¯Ÿè€…æ–¹å‘<span class="math inline">\(v\)</span>, shadingpointæ‰€åœ¨å¹³é¢æ³•çº¿<span class="math inline">\(n\)</span>, (<spanclass="math inline">\(l, v, n\)</span>éƒ½æ˜¯å•ä½å‘é‡)</p><p><strong>ç”Ÿæˆæ¼«åå°„</strong></p><ul><li><p>åŒæ ·çš„å…‰æ‰“åœ¨<strong>å•ä½é¢ç§¯</strong>ç‰©ä½“ä¸Šæ—¶,å…‰ä¸ç‰©ä½“æˆè§’åº¦ä¸åŒ, ç‰©ä½“æ¥æ”¶åˆ°çš„å…‰ä¸åŒ</p><p><img src="./img/7-2.png" /></p><p>å¯ä»¥å¾—åˆ°ç‰©ä½“æ¥æ”¶åˆ°çš„å…‰åº”è¯¥æ˜¯å…¥å°„å…‰å¼ºçš„<spanclass="math inline">\(\cos\theta\)</span>å€, è€Œ<spanclass="math inline">\(\cos\theta = l \cdot n\)</span></p></li><li><p>å…‰åœ¨ç©ºé—´ä¸­æ˜¯ä»¥çƒå½¢ä¼ æ’­çš„. å‡è®¾å…‰çº¿ä»å…‰æºå‘å°„ä¼ æ’­åˆ°äº†åŠå¾„ä¸º<spanclass="math inline">\(1\)</span>çš„çƒé¢ä¸Šæ—¶, å•ä½é¢ç§¯ä¸Šå…‰èƒ½é‡ä¸º<spanclass="math inline">\(I\)</span>. é‚£ä¹ˆå½“å…‰çº¿åˆ°è¾¾åŠå¾„ä¸º<spanclass="math inline">\(r\)</span>çš„çƒé¢ä¸Šæ—¶, å•ä½é¢ç§¯ä¸Šå…‰èƒ½é‡ä¸º<spanclass="math inline">\(I/r^2\)</span></p></li><li><p>å‡è®¾æ¼«åå°„æ˜¯å‘å››é¢å…«æ–¹å‡åŒ€åå°„çš„, åŒæ—¶ä¸è€ƒè™‘åå°„å…‰çš„èƒ½é‡æŸè€—<span class="math display">\[L_d = k_d(I/r^2)\max(0,n\cdot l)\]</span> è¿™é‡Œçš„<spanclass="math inline">\(\max\)</span>æ˜¯ä¸ºäº†é˜²æ­¢ç‚¹ç§¯å°äº0(shadingpointåœ¨æ²¡æœ‰è¢«å…‰ç…§çš„é‚£é¢, åŒæ—¶æˆ‘ä»¬ä¸è€ƒè™‘é€æ˜ç‰©ä½“)</p><p><span class="math inline">\(k_d\)</span>æ˜¯æ¼«åå°„ç³»æ•°:è¡¨ç¤ºç‰©ä½“å¸æ”¶å°„å…¥å…‰çº¿çš„èƒ½åŠ›, æ¯”å¦‚ç‰©ä½“æ˜¯ç™½è‰², é‚£ä¹ˆ<spanclass="math inline">\(k_d=0\)</span>, æ‰€æœ‰å°„å…¥å…‰çº¿éƒ½ä¼šè¢«åå°„.ç‰©ä½“æ˜¯é»‘è‰², é‚£ä¹ˆ<span class="math inline">\(k_d=1\)</span>,æ‰€æœ‰å°„å…¥å…‰çº¿éƒ½ä¼šè¢«å¸æ”¶, ä¸å‘ç”Ÿåå°„(ä¸€ç‚¹ç‰©ç†çŸ¥è¯†). ä¸€èˆ¬å°±ç”¨é¢œè‰²ä»£è¡¨<spanclass="math inline">\(k_d\)</span></p></li></ul><p><strong>ç”Ÿæˆé«˜å…‰åå°„</strong></p><p>åœ¨ç®€å•ç‰©ç†æ¨¡å‹ä¸­, åªæœ‰é•œé¢åå°„åªæœ‰åœ¨å…¥å°„è§’ç­‰äºè§‚æµ‹è§’çš„æ—¶å€™æ‰èƒ½çœ‹åˆ°.ä½†æ˜¯æˆ‘ä»¬è®¤ä¸ºåªè¦è§‚æµ‹è§’å’Œåå°„è§’å·®åœ¨ä¸€å®šèŒƒå›´å†…å°±å¯ä»¥çœ‹åˆ°å…‰çº¿,åªä¸è¿‡å…‰çº¿å¼ºä¸ä¸åŒç½¢äº†</p><p><img src="./img/7-3.png" /></p><p>å¦‚å·¦å›¾, åå°„å…‰ä¸º<span class="math inline">\(R\)</span>, åœ¨<spanclass="math inline">\(R\)</span>é™„è¿‘éƒ½å¯ä»¥çœ‹åˆ°ä¸€å®šå¼ºåº¦çš„åå°„å…‰,æˆ‘ä»¬éœ€è¦è¡¡é‡<span class="math inline">\(R\)</span>ä¸<spanclass="math inline">\(v\)</span>ä¹‹é—´çš„è§’åº¦å·®ä»¥è®¡ç®—å…‰å¼ºåº¦.æˆ‘ä»¬é€šè¿‡åŠç¨‹å‘é‡<span class="math inline">\(h =\frac{l+v}{\|l+v\|}\)</span>çš„æ–¹æ³•è¡¡é‡. æœ€åè¡¨è¿°æ–¹æ³•æ˜¯ <spanclass="math display">\[\begin{align}L_s &amp;= k_s(I/r^2)\max (0, \cos\alpha)^p\\&amp;= k_s(I/r^2)\max (0, n\cdot h)^p\end{align}\]</span> <span class="math inline">\(\cos\alpha\)</span>çœ‹èµ·æ¥æ¯”è¾ƒç¦»è°±,åªæœ‰å½“<span class="math inline">\(\alpha \geq90^\circ\)</span>æ—¶æ‰çœ‹ä¸åˆ°é•œé¢åå°„..., ä½†å³ä½¿<spanclass="math inline">\(l = -v\)</span>æ—¶<spanclass="math inline">\(\alpha\)</span>éƒ½ä¸åˆ°<spanclass="math inline">\(90^\circ\)</span>, æˆ‘ä»¬éœ€è¦åŠ ä¸€ä¸ªé«˜å…‰ç³»æ•°<spanclass="math inline">\(p\)</span>, è®©<spanclass="math inline">\((\cos\alpha)^p\)</span>å¿«é€Ÿè¡°å‡åˆ°<spanclass="math inline">\(0\)</span>, ä¸€èˆ¬è®¾<spanclass="math inline">\(p\)</span>ä¸º<spanclass="math inline">\(100-200\)</span>(p.s. ä¸ºä»€ä¹ˆä¸ç”¨<spanclass="math inline">\(&lt;R,v&gt;\)</span>è€Œè¦ç”¨åŠç¨‹å‘é‡å‘¢?å› ä¸ºåŠç¨‹å‘é‡è®¡ç®—æ›´å¿«(<span class="math inline">\(R\)</span>ä¸å¥½ç®—).ä¹Ÿæœ‰ç”¨<span class="math inline">\(&lt;R,v&gt;\)</span>çš„æ¨¡å‹,å«Phongæ¨¡å‹, Blinn-Phongæ¨¡å‹æ˜¯ä»–çš„æ”¹è¿›)</p><p><img src="./img/7-4.png" /></p><p><span class="math inline">\(k_s\)</span>ä¸ºé•œé¢åå°„ç³»æ•°,æŒ‰ç…§æ¼«åå°„çš„æ€è·¯, è¿™é‡Œåº”è¯¥è¡¨ç¤ºå¤šå°‘å…‰è¢«å¸æ”¶,ä½†æ˜¯åœ¨Blinn-Phongæ¨¡å‹ä¸è€ƒè™‘è¿™ä¸ª, ä¸€èˆ¬è®¤ä¸ºé•œé¢åå°„ä¼šå°†å…‰å…¨éƒ¨åå°„å‡ºå»<spanclass="math inline">\(k_s = 1\)</span></p><p><strong>ç”Ÿæˆç¯å¢ƒå…‰</strong></p><p>ç¯å¢ƒå…‰å¤ªéš¾ç®—äº†, æˆ‘ä»¬ç›´æ¥è®¤ä¸ºç¯å¢ƒå…‰ä¸ºå¸¸é‡<spanclass="math inline">\(I_a\)</span>, shading pointä¸Šæœ‰ç¯å¢ƒå…‰åå°„ç³»æ•°<spanclass="math inline">\(k_a\)</span> <span class="math display">\[L_a = k_a I_d\]</span></p><p>æœ€åå¾—åˆ°å¸ƒæ—å†¯æ¨¡å‹ <span class="math display">\[L = k_aI_a + k_d(I/r^2)\max(0, n\cdot l)+k_s(I/r^2)\max(0,n\cdot h)^p\]</span></p><h2 id="lecture-8-shading---ç€è‰²ç®¡çº¿çº¹ç†">Lecture 8 Shading -ç€è‰²&amp;ç®¡çº¿&amp;çº¹ç†</h2><p><strong>ç€è‰²é¢‘ç‡</strong></p><p>ä¹‹å‰Shadingæ˜¯å¯¹æŸä¸ªç‚¹ç€è‰². åœ¨æ¸²æŸ“ä¸­æˆ‘ä»¬å¯ä»¥å°†Shadingåº”ç”¨äºä»»ä½•ä½ç½®,å¦‚: ä¸‰è§’å½¢æ•´ä¸ªå¹³é¢ä¸Š / é¡¶ç‚¹ä¸Š(å†…éƒ¨æ’å€¼) / æ¯ä¸ªåƒç´ ä¸Š.åˆ†åˆ«å¯¹åº”ä¸‹é¢ä¸‰å¼ å›¾, å¯ä»¥çœ‹åˆ°, ç¬¬äºŒå¼ å›¾çš„åœ¨è¾¹ä¸Šæœ‰æ˜æ˜¾çš„åˆ†å¼‚</p><p><img src="./img/8-1.png" /></p><ul><li><p>åº”ç”¨åœ¨å¹³é¢ä¸Š(Flat Shading): å°†ç€è‰²åº”ç”¨äºä¸‰è§’å½¢é¢ä¸Š,æ•´ä¸ªä¸‰è§’å½¢ä¸€ä¸ªé¢œè‰², æˆ‘ä»¬é€šè¿‡ä¸‰è§’å½¢ä¸¤è¾¹å‰ç§¯æ±‚å¾—æ³•çº¿</p></li><li><p>åº”ç”¨åœ¨é¡¶ç‚¹ä¸Š(Gouraud Shading): å°†ç€è‰²åº”ç”¨äºé¡¶ç‚¹ä¸Š,åœ¨é¡¶ç‚¹ä¹‹é—´ä¸ä¸‰è§’å½¢å†…éƒ¨åšæ’å€¼. è®¡ç®—é¡¶ç‚¹çš„å‘ç°æ¯”è¾ƒå›°éš¾,æˆ‘ä»¬å¯ä»¥è®¡ç®—é¡¶ç‚¹ç›¸é‚»çš„é¢, æ ¹æ®ç›¸é‚»é¢çš„æ³•çº¿ä¸ç›¸é‚»é¢çš„é¢ç§¯åŠ æƒå¹³å‡å¾—åˆ°</p><p><img src="./img/8-2.png" /> <span class="math display">\[N_v = \frac{\sum_iN_i}{\|\sum_iN_i\|}\]</span> å‰ç§¯çš„ç»“æœä¸æ³•çº¿åŒå‘, é•¿åº¦æ˜¯é¢ç§¯, æ­£å¥½å°±åšäº†åŠ æƒ. æ­£å¸¸æƒ…å†µä¸‹,æˆ‘ä»¬çš„æƒ³æ³•æ˜¯åŠ æƒååº”è¯¥é™¤ä»¥é¢ç§¯å’Œ<spanclass="math inline">\(\sum_i\|N_i\|\)</span>æ¥å¹³å‡.ä½†æ˜¯åœ¨è¿™é‡Œè€å¸ˆç”¨äº†<span class="math inline">\(\|\sum_iN_i\|\)</span>,å› ä¸ºæˆ‘ä»¬å·²ç»é€šè¿‡é¢ç§¯åŠ æƒçš„å¾—åˆ°äº†æ–¹å‘,ç°åœ¨åªæ˜¯æƒ³å°†è¿™ä¸ªè¶…é•¿å‘é‡åŒ–ä¸ºå•ä½å‘é‡, æ‰€ä»¥ç›´æ¥é™¤ä»¥æ¨¡é•¿å°±è¡Œ,ä¸ç”¨é™¤ä»¥æ¯ä¸ªçš„é¢ç§¯(ç”¨æ¯ä¸ªçš„<spanclass="math inline">\(\sum_i\|N_i\|\)</span>æ±‚å‡ºæ¥ä¸ä¸€å®šæ˜¯å•ä½å‘é‡,æˆ‘ä»¬è¿˜è¦åšå½’ä¸€åŒ–)</p></li><li><p>åº”ç”¨åœ¨åƒç´ ä¸Š(Phone Shading): å…ˆæ±‚ä¸‰è§’å½¢é¡¶ç‚¹çš„æ³•çº¿,ç„¶åæ’å€¼åˆ°æ¯ä¸ªåƒç´ ä¸Š(æ³¨æ„æ’å€¼åå½’ä¸€åŒ–), å†åˆ†åˆ«ä¸ºæ¯ä¸ªåƒç´ ç€è‰²</p></li></ul><p>Gouraud Shadingä¸Phone Shadingéƒ½éœ€è¦æ’å€¼,åœ¨ä¸‰è§’å½¢ä¸Šå¯ä»¥ä½¿ç”¨é‡å¿ƒåæ ‡æ’å€¼</p><p><strong>æ¸²æŸ“ç®¡çº¿</strong></p><p>æ¸²æŸ“ç®¡çº¿(Graphics Pipeline / Real-time Rending Pipeline):å°†æ¨¡å‹è½¬ä¸ºå›¾åƒçš„å…¨éƒ¨è¿‡ç¨‹å°±æ˜¯æ¸²æŸ“ç®¡çº¿(ä¸­æ–‡çœ‹ä¸æ‡‚ä¹Ÿå¯ä»¥çœ‹åˆ°è‹±æ–‡ä¸­çš„Pipeline),ä¹Ÿå°±æ˜¯ä¹‹å‰çš„ä¸€ç³»åˆ—æ“ä½œ</p><pre class="mermaid">graph TBpoint(ç©ºé—´ä¸­çš„ç‚¹/Vertex) --æŠ•å½±åˆ°å±å¹•--> point2d(äºŒç»´ç‚¹/Vertex Stream) --è¿æ¥æˆä¸‰è§’å½¢--> triangle2d(ä¸‰è§’å½¢/Triangle Stream) --å…‰æ …åŒ–/Rasterization--> frgament(ä¸‰è§’å½¢åƒç´ /Frgament) --ç€è‰²/Shading--> shadedfrgament(ç€è‰²åä¸‰è§’å½¢/Shaded Fragments) --FrameBufferå¤„ç†--> opt(è¾“å‡ºåˆ°æ˜¾ç¤ºå™¨)</pre><p>å¯ä»¥çœ‹å‡º, å…¶å®ä¸‰è§’å½¢æ˜¯æˆ‘ä»¬è™šæ‹Ÿå‡ºçš„æ¦‚å¿µ, å®é™…ä¸Šæ˜¯ä¸å­˜åœ¨çš„</p><p><strong>çº¹ç†</strong></p><p>æˆ‘ä»¬å¯ä»¥ç»™ä¸‰è§’å½¢æ¸²æŸ“ä¸Šä¸åŒçš„æè´¨/çº¹ç†(æœ¨å¤´,å¡‘æ–™...),çº¹ç†å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„,é‡Œé¢å­˜å‚¨çš„æ˜¯æ¯ä¸ªç‚¹åœ¨å¸ƒæ—å†¯æ¨¡å‹ä¸­çš„åå°„ç³»æ•°/å…¶ä»–å±æ€§.</p><p><img src="./img/8-3.png" /></p><p>æˆ‘ä»¬å°†çº¹ç†å®šä¹‰åœ¨ç‰©ä½“è¡¨é¢ä¸Š(ä¹Ÿå°±æ˜¯ä¸€ä¸ªäºŒç»´å¹³é¢),ä¸ºäº†è®©ç‰©ä½“ä¸Šçš„ç‚¹ä¸çº¹ç†å¯ä»¥ä¸€ä¸€å¯¹åº”, æˆ‘ä»¬æƒ³åˆ°äº†ä¸‰è§’å½¢,åªéœ€è¦å®šä¹‰ç‰©ä½“è¡¨é¢ä¸‰è§’å½¢å¯¹åº”çº¹ç†ä¸Šçš„å“ªå—ä¸‰è§’å½¢å³å¯(ä¸‰è§’å½¢åœ¨æ˜ å°„æ—¶å¯ä»¥è¢«æ‰­æ›²,ä½†æ˜¯æˆ‘ä»¬å¸Œæœ›å¯ä»¥å°½å¯èƒ½å°‘æ‰­æ›²), æ˜ å°„å…³ç³»ç”±è‰ºæœ¯å®¶å®Œæˆ.ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä½¿ç”¨å°†çº¹ç†å®šä¹‰åœ¨æ–¹å½¢<spanclass="math inline">\([0,1]^2\)</span>çš„<spanclass="math inline">\(u-v\)</span>åæ ‡ä¸Š</p><p>åœ¨æ¸²æŸ“æ—¶, ä¸ºç‰©ä½“çš„æ¯ä¸ªç‚¹éƒ½å®šä¹‰çº¹ç†æ¶ˆè€—å¤ªå¤§äº†,æˆ‘ä»¬å¸Œæœ›å°±åƒè´´ç“·ç –ä¸€æ ·å¤ç”¨çº¹ç†,åœ¨è®¾è®¡çº¹ç†æ—¶æˆ‘ä»¬éœ€è¦è€ƒè™‘å¦‚ä½•è®©çº¹ç†åœ¨æ¥ç¼å¤„å‡ºæ— æ³•è¢«çœ‹å‡ºæ¥(ä¸‹å›¾å°±æ˜¯ä¸ºå®«æ®¿è´´ä¸Šé‡å¤çš„ç“·ç –)</p><p><img src="./img/8-4.png" /></p><h2 id="lecture-9-shading---çº¹ç†">Lecture 9 Shading - çº¹ç†</h2><p><strong>é‡å¿ƒåæ ‡æ’å€¼</strong></p><p>åœ¨æ·±åº¦ç¼“å­˜, é¡¶ç‚¹ç€è‰², åƒç´ ç€è‰², çº¹ç†è´´å›¾æ—¶æˆ‘ä»¬éƒ½éœ€è¦è¿›è¡Œæ’å€¼,åœ¨ä¸‰è§’å½¢ä¸­, å¯ä»¥ä½¿ç”¨é‡å¿ƒåæ ‡æ’å€¼.</p><p>é‡å¿ƒåæ ‡æ˜¯ä¸€ä¸ªä¸‰å…ƒç»„<spanclass="math inline">\((\alpha,\beta,\gamma)\)</span>, å¯¹äºä¸‰è§’å½¢<spanclass="math inline">\(ABC\)</span>ä¸ç‚¹<spanclass="math inline">\(P\)</span>, é‡å¿ƒåæ ‡æ»¡è¶³ <spanclass="math display">\[\left\{\begin{align}&amp;P = \alpha A + \beta B + \gamma C\\&amp;\alpha + \beta + \gamma = 1\\&amp;\alpha \geq 0\\&amp;\beta \geq 0\\&amp;\gamma \geq 0\\\end{align}\right.\]</span></p><ul><li>å½“<spanclass="math inline">\((\alpha,\beta,\gamma)\)</span>æ»¡è¶³<spanclass="math inline">\(\alpha + \beta + \gamma = 1\)</span>æ—¶, <spanclass="math inline">\(P\)</span>åœ¨ä¸‰è§’å½¢<spanclass="math inline">\(ABC\)</span>æ‰€åœ¨å¹³é¢ä¸Š</li><li>å½“<spanclass="math inline">\((\alpha,\beta,\gamma)\)</span>è¿˜æ»¡è¶³<spanclass="math inline">\(\alpha \geq 0, \beta \geq 0, \gamma \geq0\)</span>æ—¶, <span class="math inline">\(P\)</span>åœ¨ä¸‰è§’å½¢<spanclass="math inline">\(ABC\)</span>å†…</li></ul><p>åº”ç”¨"å¥”é©°å®šç†"å¯ä»¥å¾—åˆ° <span class="math display">\[\left\{\begin{align}&amp;\alpha = S_{PBC}/S_{ABC}\\&amp;\beta = S_{PAC}/S_{ABC}\\&amp;\gamma = S_{PAB}/S_{ABC} = 1-\alpha-\beta\\\end{align}\right.\]</span> ç¼ºç‚¹: ç‚¹ä¸ä¸‰è§’å½¢åœ¨æŠ•å½±åé‡å¿ƒåæ ‡ä¼šå‘ç”Ÿå˜åŒ–</p><p><strong>çº¹ç†æ”¾å¤§</strong></p><p>åœ¨ä¸‰ç»´åœºæ™¯ä¸­, æˆ‘ä»¬å¯ä»¥é€šè¿‡ç§»åŠ¨æ‘„åƒæœºçš„ä½ç½®æ”¾å¤§æˆ–ç¼©å°å›¾åƒ(é€è§†åŸç†),è‹¥åœºæ™¯è¢«æ”¾çš„å¾ˆå¤§(æ¯”å¦‚å‡‘åœ¨è„¸å‰é¢çœ‹äºº),æŸä¸ªæ•´æ•°åƒç´ ä¼šå¯¹åº”åˆ°çº¹ç†åæ ‡ä¸­çš„å°æ•°åƒç´ (çº¹ç†ä¸­çš„åƒç´ ä¹Ÿè¢«ç§°ä¸ºçº¹ç´ /Texel), æˆ‘ä»¬éœ€è¦é‡‡ç”¨ä¸€ç³»åˆ—æ–¹æ³•å¯¹è¿™ä¸ªå°æ•°åæ ‡å€¼è¿›è¡Œå·®å€¼è·å¾—è¯¥ç‚¹çº¹ç†</p><ul><li><p>Nearest: ç›´æ¥å°†å°æ•°ä¸‹æ ‡å››èˆäº”å…¥. è¿™ä¼šé€ æˆå¤šä¸ªåƒç´ æ˜¾ç¤ºä¸€ä¸ªçº¹ç´ ,ä»è€Œå‘ç”Ÿèµ°æ ·, å¦‚å³å›¾ä¸­çš„Jaggies</p><p><img src="./img/9-5.png" /></p></li><li><p>åŒçº¿æ€§æ’å€¼(Bilinear interpolation): å¯¹äºä¸€ä¸ªå°æ•°ä½ç½®<spanclass="math inline">\(P\)</span>, æˆ‘ä»¬æ‰¾<spanclass="math inline">\(P\)</span>é‚»è¿‘çš„å››ä¸ªçº¹ç´ , è®°<spanclass="math inline">\(P\)</span>åˆ°å·¦ä¸‹è§’çº¹ç´ çš„è·ç¦»ä¸º<spanclass="math inline">\(t, s\)</span>, åŒæ—¶æ˜“çŸ¥<spanclass="math inline">\(y_{u_{00}, u_{01}} = x_{u_{00}, u_{10}} =1\)</span></p><p><img src="./img/9-1.png" /></p><p>å®šä¹‰ä¸€ä¸ªä¸€ç»´çº¿æ€§æ’å€¼(<span class="math inline">\(x\)</span>åœ¨<spanclass="math inline">\(v_0v_1\)</span>ä¸Š): <spanclass="math inline">\(lerp(x,v_0,v_1) = v_0+x(v_1-v_0)\)</span></p><p>æˆ‘ä»¬åˆ†åˆ«å¯¹ç‚¹<span class="math inline">\(P\)</span>æŠ•å½±åœ¨<spanclass="math inline">\(u_{01}u_{11}\)</span>ä¸<spanclass="math inline">\(u_{00}u_{10}\)</span>çš„ä½ç½®åšçº¿æ€§æ’å€¼, å³: <spanclass="math inline">\(u_0 = lerp(s, u_{00}, u_{10})\)</span>ä¸<spanclass="math inline">\(u_1 = lerp(s, u_{01},u_{11})\)</span>å¾—åˆ°ç¬¬ä¸€æ¬¡æ’å€¼ç»“æœ</p><p><img src="./img/9-2.png" /></p><p>ä¹‹ååœ¨å‚ç›´æ–¹å‘åšä¸€æ¬¡çº¿æ€§æ’å€¼ <span class="math inline">\(u = lerp(t,u_{0}, u_{1})\)</span></p><p>äºæ˜¯æˆ‘ä»¬å¾—åˆ°<span class="math inline">\(P\)</span>ç‚¹çš„åŒçº¿æ€§æ’å€¼<spanclass="math inline">\(lerp(t, u_{0}, u_{1})\)</span></p></li><li><p>ä¸‰çº¿æ€§æ’å€¼(Bicubic interpolation):å°±æ˜¯å°†åŒçº¿æ€§æ’å€¼æ—¶é€‰å–å‘¨å›´4çº¹ç´ æ¢æˆé€‰16çº¹ç´ </p></li></ul><p>ä¸‰ç§æ–¹æ³•æ•ˆæœå¦‚ä¸‹</p><p><img src="./img/9-4.png" /></p><p>åŒçº¿æ€§æ’å€¼æ€§ä»·æ¯”æ›´é«˜ä¸€äº›</p><p><strong>çº¹ç†ç¼©å°</strong></p><p>åœ¨ä¸‰ç»´åœºæ™¯ä¸­, æˆ‘ä»¬å¯ä»¥é€šè¿‡ç§»åŠ¨æ‘„åƒæœºçš„ä½ç½®æ”¾å¤§æˆ–ç¼©å°å›¾åƒ(é€è§†åŸç†),è‹¥åœºæ™¯è¢«æ”¾çš„å¾ˆå°(æ¯”å¦‚çœ‹è¿œå¤„çš„å±±),æŸä¸ªæ•´æ•°åƒç´ ä¼šè¦†ç›–åˆ°çº¹ç†åæ ‡ä¸­çš„å¤šä¸ªçº¹ç´ ,æˆ‘ä»¬éœ€è¦å°†è¦†ç›–çš„ä¸€ç‰‡åŒºåŸŸè½¬ä¸ºä¸€ä¸ªåƒç´ </p><p>å¦‚æœç®€å•çš„å°†åƒç´ ä¸­å¿ƒå¯¹åº”åˆ°çº¹ç†ä¸­å¿ƒ,æˆ‘ä»¬å°±ä¼šå› é‡‡æ ·ç‡ä¸è¶³è€Œå¾—åˆ°æ‘©å°”çº¹(å³å›¾è¿œå¤„Moire)</p><p><img src="./img/9-5.png" /></p><p>æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨æœ´ç´ çš„MSAAè¶…é‡‡æ ·, ä½†æ˜¯æ¶ˆè€—è¿‡å¤§,æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¿«é€Ÿè¶…é‡‡æ ·çš„åŠæ³•. å°†ä¸€ä¸ªåƒç´ æ˜ å°„åˆ°ä¸€ä¸ªçº¹ç´ åŒºåŸŸ,ç„¶åå¿«é€Ÿå¾—åˆ°è¿™ä¸ªåŒºåŸŸçš„çº¹ç´ å‡å€¼</p><ul><li><p>é‡‡ç”¨è¿‘ä¼¼çš„æ–¹æ³•è·å¾—çº¹ç´ è¦†ç›–çš„çº¹åƒåŒºåŸŸ: å¯¹äºåƒç´ P,æˆ‘ä»¬å…ˆè·PåŠå…¶ä¸Šè¾¹ä¸å³è¾¹åƒç´ åœ¨<spanclass="math inline">\(u-v\)</span>åæ ‡ç³»ä¸­å¯¹åº”çš„çº¹ç´ åæ ‡,æµ‹é‡ä¸Šæ–¹ä¸å³æ–¹çº¹ç´ åˆ°På¯¹åº”çº¹ç´ è·ç¦». <span class="math inline">\(L_1,L_2\)</span>. å–ä¸¤è€…æœ€å¤§å€¼ä½œä¸ºè¦†ç›–èŒƒå›´çš„è¾¹é•¿å¹¶æ„å»ºæ­£æ–¹å½¢</p><p><img src="./img/9-7.png" /></p><p>å¯ä»¥ç”¨å¾®åˆ†è¡¨è¾¾ <span class="math display">\[L = \max\left(\sqrt{\left(\frac{du}{dx}\right)^2+\left(\frac{dv}{dx}\right)^2},\sqrt{\left(\frac{du}{dy}\right)^2+\left(\frac{dv}{dy}\right)^2}  \right)\]</span></p></li><li><p>åŒºé—´æ±‚å’Œå¯ä»¥é‡‡ç”¨æ ‘çŠ¶æ•°ç»„å®ç°,è¿™é‡Œé‡‡ç”¨äº†ç±»ä¼¼çš„<strong>MipMap</strong>å®ç°,è¯¥æ–¹æ³•ä¸åƒæ ‘çŠ¶æ•°ç»„ä¸€æ ·å¯ä»¥ç²¾ç¡®æŸ¥è¯¢åŒºé—´<spanclass="math inline">\([l,r]\)</span>çš„å‡å€¼, å…¶åªèƒ½è·å¾—è¿‘ä¼¼å€¼,å¹¶åªèƒ½æŸ¥è¯¢ä¸€ä¸ªæ­£æ–¹å½¢åŒºé—´, ä½†æ˜¯æ—¶é—´å¤æ‚<spanclass="math inline">\(O(1)\)</span>, ç©ºé—´å¤æ‚åº¦<spanclass="math inline">\(O(n)\)</span></p><ol type="1"><li><p>é¢„å¤„ç†çº¹ç†å®½é«˜ä¸º<spanclass="math inline">\(2\)</span>çš„æ•´æ¬¡å¹‚æ—¶çš„å„åƒç´ å‡å€¼</p><p><img src="./img/9-6.png" /></p></li><li><p>çœ‹èµ·æ¥å°±æ˜¯åšäº†ä¸ªåˆ†å—, æ­£å¸¸çš„æƒ³æ³•æ˜¯åœ¨æŸ¥è¯¢æ—¶å…ˆæŸ¥å¤§åˆ†å—,åˆ°è¾¹ç¼˜æ—¶æŸ¥å°åˆ†å—. è¿™æ ·çš„æ—¶é—´å¤æ‚åº¦æ˜¯<spanclass="math inline">\(O(logn)\)</span>,</p><p>Mipmapçš„åšæ³•æ˜¯: é€‰ä¸€ä¸ªæ¯”æŸ¥è¯¢åŒºé—´è¾¹é•¿ç¨å¤§çš„å—ç„¶åè·å–å…¶å€¼,å¯¹äºè¾¹é•¿ä¸º<span class="math inline">\(l\)</span>çš„æ­£æ–¹å½¢,Mipmapç›´æ¥å»<span class="math inline">\(level\[log_2l]\)</span>å›¾ä¸­æŸ¥è¯¢åƒç´ ä¸­å¿ƒç‚¹å¯¹åº”ç‚¹çº¹ç´ .</p><p>ç”±äº<span class="math inline">\(level\ n\)</span>å›¾æ¯”<spanclass="math inline">\(level\ 0\)</span>å›¾å°äº†<spanclass="math inline">\(2^n\)</span>å€,æˆ‘ä»¬éœ€è¦æŸ¥è¯¢çš„æ•´æ•°åƒç´ å¯¹åº”åˆ°çº¹ç´ åæ ‡ä¸­å¯èƒ½æ˜¯å°æ•°.åœ¨è¿™é‡Œå¯ä»¥é‡‡ç”¨åŒçº¿æ€§æ’å€¼çš„æ–¹æ³•å®ç°è¿‡æ¸¡.</p><p>è¿™æ ·çš„æŸ¥è¯¢æ–¹æ³•å¯ä»¥å°†æ—¶é—´å¤æ‚åº¦åšåˆ°<spanclass="math inline">\(O(1)\)</span>, Mipmapå ç”¨ç©ºé—´ä¹Ÿä»…ä¸ºåŸå›¾çš„<spanclass="math inline">\(1/3\)</span>(é€šè¿‡ç­‰æ¯”çº§æ•°å¾—åˆ°).</p></li><li><p>ä½†æ˜¯è¿™æ ·çš„æ–¹æ³•ä¼šé€ æˆåœ¨levelåˆ†ç•Œè¾¹ç¼˜çš„åƒç´ äº§ç”Ÿå‰²è£‚(ç›¸é‚»å‡ ä¸ªåƒç´ åº”ç”¨äº†ä¸åŒlevelçš„Mipmap),æˆ‘ä»¬å¸Œæœ›å¯ä»¥åœ¨Levelä¹‹é—´å®ç°å‡åŒ€è¿‡æ¸¡(å³è·å–è¯¸å¦‚Level 2.8ä¸Šçš„å›¾åƒ),å¯ä»¥åœ¨å±‚ä¸å±‚ä¹‹é—´å†åšä¸€æ¬¡çº¿æ€§æ’å€¼: è®¡ç®—å‡ºåƒç´ åœ¨<spanclass="math inline">\(level\[log_2l]\)</span>ä¸Šçš„çº¹ç´ åå†è®¡ç®—åƒç´ åœ¨<spanclass="math inline">\(level\ [log_2l]+1\)</span>ä¸Šçš„çº¹ç´ ,æœ€åé€šè¿‡çº¿æ€§æ’å€¼æ±‚å¾—åƒç´ åœ¨<span class="math inline">\(level\log_2l\)</span>å±‚çš„çº¹ç´ </p></li></ol></li></ul><p>ç„¶è€ŒMipmapçš„æ•ˆæœå¹¶ä¸å¥½, ä»–ä¼šå°†è¿œå¤„è¦†ç›–çº¹ç†æ¯”è¾ƒæ–œçš„åƒç´ å˜æ¨¡ç³Š.(å·¦å›¾ä¸ºæœ´ç´ MSAAçš„ç»“æœ, å³å›¾ä¸ºç”¨MipmapåMSAAçš„ç»“æœ,å¯ä»¥çœ‹åˆ°åœ¨æ¸²æŸ“å·¦ä¸Šè§’ä¸å³ä¸Šè§’æ—¶å›¾åƒä¼šè¾¹æ¨¡ç³Š)</p><p><img src="./img/9-8.png" /></p><p>ä¸boungin boxæ•ˆæœå˜å·®çš„åŸå› ç±»ä¼¼,å½“ä¸€ä¸ªåƒç´ è¦†ç›–çº¹ç´ åŒºåŸŸæ˜¯ä¸€ä¸ªæ–œå››è¾¹å½¢æ—¶, è¿™å¯¼è‡´è¦†ç›–æ­£æ–¹å½¢è¿‡å¤§,æ•ˆæœè¾¹æ¨¡ç³Š</p><p><img src="./img/9-9.png" /></p><p>å¯ä»¥é‡‡ç”¨<strong>å„å‘å¼‚æ€§è¿‡æ»¤</strong>ç¼“è§£è¿™ä¸ªé—®é¢˜</p><p><img src="./img/9-10.png" /></p><p>åœ¨Mipmapé¢„å¤„ç†ä¸åŒå°ºå¯¸æ­£æ–¹å½¢çš„åŸºç¡€ä¸Šé¢„å¤„ç†ä¸åŒå°ºå¯¸çš„é•¿æ–¹å½¢,è¿™æ ·åœ¨è¿‘ä¼¼æ±‚è¦†ç›–é¢ç§¯çš„æ—¶å€™å°±å¯ä»¥å°†è¦†ç›–é¢ç§¯è¿‘ä¼¼ä¸ºé•¿æ–¹å½¢äº†.è¿™æ ·é¢„å¤„ç†éœ€è¦å ç”¨åŸçº¹ç†3å€çš„ç©ºé—´.</p><p><strong>çº¹ç†çš„å…¶ä»–ç”¨é€”</strong></p><ul><li><p>å°†ç¯å¢ƒå…‰è®°å½•ä¸ºçº¹ç†</p><ul><li><p>Spherical Map: å¯ä»¥å‡è®¾åœ¨ç¯å¢ƒä¸­å¤®æœ‰é¢—å…‰æ»‘çš„çƒ,ç¯å¢ƒå…‰å°†è¢«æŠ•å½±åœ¨çƒé¢ä¸Š, é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠçƒé¢ä¸Šæ˜¾ç¤ºçš„ç¯å¢ƒå…‰å½“ä½œä¸€å¼ è´´å›¾,å°†è´´å›¾å±•å¼€å¹¶å­˜å‚¨ç¯å¢ƒå…‰</p><p><img src="./img/9-11.png" /></p></li><li><p>Cube Map: å°†ç¯å¢ƒç¯å¢ƒå…‰æŠ•å°„åœ¨çƒé¢ä¸Šä¼šé€ æˆçº¹ç†çš„æ‰­æ›²,å¯ä»¥å°†ç¯å¢ƒå…‰æŠ•å°„åˆ°ç«‹æ–¹ä½“ä¸Š, å­˜å‚¨ä¸ºå…­å¼ æ­£æ–¹å½¢å›¾åƒ.è¿™ç§æ–¹æ³•æŠ•å°„ç»“æœæ‰­æ›²å°, ä½†æ˜¯éš¾ä»¥å­˜å‚¨ç¯å¢ƒå…‰çš„å°„å…¥æ–¹å‘</p></li></ul></li><li><p>å°†å‡¹å‡¸è®°å½•ä¸ºçº¹ç†</p><p>ç”¨å‡ ä½•è¡¨ç¤ºç‰©ä½“è¡¨é¢çš„å‡¹å‡¸å¤ªéº»çƒ¦äº†,è¿™é‡Œè€ƒè™‘ç”¨è´´å›¾å»æè¿°è¡¨é¢çš„å¾®å°å‡ ä½•å˜åŒ–, å¹¶åœ¨è®¡ç®—åå°„æ—¶é€šè¿‡è´´å›¾æ”¹å˜æ³•çº¿,æœ‰ä¸¤ç§å®ç°</p><ul><li><p>å‡¹å‡¸è´´å›¾(Bump Map): ä¸€å¼ ç°åº¦å›¾,å­˜å‚¨äº†æ¯ä¸ª<strong>ç‚¹</strong>åº”è¯¥ç›¸å¯¹åŸç‰©ä½“ä¸Šçš„ç‚¹å†å‡¸å‡ºå¤šå°‘(é»˜è®¤é»‘è‰²ä¸º0)</p><p><img src="./img/9-12.png" /></p><p>åœ¨æ¸²æŸ“æ—¶éœ€è¦å…ˆåœ¨shading pointä¸Šå»ºç«‹æ–°åæ ‡ç³»,ç„¶åæ±‚å‡¹å‡¸è´´å›¾åœ¨è¯¥ç‚¹å¤„çš„åˆ‡çº¿, å°†åˆ‡çº¿æ—‹è½¬å¹¶å½’ä¸€åŒ–å¾—åˆ°æ³•çº¿,æœ€åå°†æ³•çº¿ä»æ–°åæ ‡ç³»è½¬æ¢åˆ°åŸåæ ‡ç³»ä¸Š.</p><p><img src="./img/9-13.png" /></p><p>å…·ä½“é€šè¿‡TBNå®ç°, å®ç°æ–¹æ³•:</p></li><li><p>æ³•çº¿è´´å›¾(Normal Map): è´´å›¾è®°å½•çš„æ˜¯æ³•çº¿å€¼, ç”¨è´´å›¾ä¸Šæ¯ä¸ªç‚¹çš„<spanclass="math inline">\((R,G,B)^T\)</span>è®°å½•è¯¥ç‚¹æ³•çº¿çš„<spanclass="math inline">\((x,y,z)^T\)</span>,è§„å®šæ³•çº¿ä¸­æ¯ä¸€é¡¹çš„å€¼èŒƒå›´ä¸º<span class="math inline">\(0-1\)</span>,å¹¶åœ¨ç€è‰²æ—¶å€™æ˜ å°„åˆ°<span class="math inline">\((-1,1)\)</span></p></li><li><p>ä½ç§»è´´å›¾(Displacement Map):æ˜¯å‡¹å‡¸è´´å›¾æ›´ç°ä»£åŒ–çš„åšæ³•ç›´æ¥å®šä¹‰æ¯ä¸€ä¸ª<strong>ä¸‰è§’å½¢é¡¶ç‚¹</strong>çš„ä½ç§»,è¿™æ ·åº”ç”¨è´´å›¾åä¸‰è§’å½¢ä¸Šçš„ç‚¹ç›´æ¥å‘ç”Ÿäº†å˜åŒ–,è¿™æ ·çš„æ•ˆæœæ›´åŠ çœŸå®(ä½†æ˜¯è®¡ç®—é‡å¤§)</p><p><img src="./img/9-14.png" /></p><p>ä¸å‡¹å‡¸è´´å›¾ç›¸æ¯”ä½ç§»è´´å›¾ç›´æ¥æ”¹å˜äº†ä¸‰è§’å½¢,åœ¨ç‰©ä½“è¾¹ç¼˜ä¸é˜´å½±ä¸Šè¡¨ç°æ›´å¥½(å³å›¾å³ä¸Šè§’è¾¹ç¼˜å·®å¼‚,å›¾ä¸Šçš„çªèµ·å¯¹å…¶ä»–éƒ¨åˆ†çªèµ·çš„é®æŒ¡, ä¸¤å›¾é˜´å½±çš„è¾¹ç¼˜å·®å¼‚)</p></li></ul></li><li><p>ä¸‰ç»´çº¹ç†</p><p>ä¸€èˆ¬ç”¨äºå®šä¹‰å¤§ç†çŸ³, å±±è„‰ç­‰çš„çº¹ç†. ä¸€èˆ¬ä¸å°†å…¶å®šä¹‰ä¸ºä¸€ä¸ªçœŸå®çš„è´´å›¾,è€Œæ˜¯ç”±å™ªå£°åŠ¨æ€åŠ¨æ€ç”Ÿäº§</p><p><img src="./img/9-15.png" /></p></li><li><p>è®°å½•æå‰ç®—å¥½çš„ä¿¡æ¯</p><p><img src="./img/9-16.png" /></p><p>æˆ‘ä»¬å¾ˆéš¾è®¡ç®—å‡ºçœ¼çªä¸­çš„é˜´å½±, å¯ä»¥ç›´æ¥å°†é˜´å½±ä¹‹é—´å®šä¹‰åœ¨çº¹ç†ä¸­</p></li></ul><h2 id="lecture-10-geometry---å‡ ä½•è¡¨ç¤º">Lecture 10 Geometry -å‡ ä½•è¡¨ç¤º</h2><p><strong>å‡ ä½•è¡¨ç¤ºåˆ†ç±»</strong></p><ul><li><p>éšå¼å‡ ä½•(Implicit): ä¸ç›´æ¥å®šä¹‰ç‚¹,è€Œå®šä¹‰ç‚¹æ»¡è¶³çš„æ¡ä»¶(ä¾‹å¦‚å®šä¹‰çƒä¸Šçš„ç‚¹<spanclass="math inline">\(x^2+y^2+z^2=1\)</span>).</p><p>æˆ‘ä»¬å¾ˆéš¾ç›´æ¥å¾—çŸ¥å…¶è¡¨ç¤ºä»€ä¹ˆç»“æ„,ä½†æ˜¯å¯ä»¥å¾ˆè½»æ¾çš„åˆ¤æ–­ç‚¹åœ¨ä¸åœ¨å‡ ä½•ä½“ä¸Š.</p><p>å¸¸è§çš„éšå¼è¡¨ç¤º:</p><ul><li><p>ä»£æ•°æ–¹æ³•: åˆ—è¡¨è¾¾å¼</p></li><li><p>æ„é€ ç«‹ä½“å‡ ä½•æ³•(Constructive Solid Geometry):é€šè¿‡ç®€å•å‡ ä½•ä½“çš„å¸ƒå°”è¿ç®—(äº¤å¹¶è¡¥)æè¿°å…¶ä»–å‡ ä½•ä½“</p><p><img src="./img/10-1.png" /></p></li><li><p>è·ç¦»å‡½æ•°: ä¸æè¿°å‡ ä½•ä½“ä¸Šçš„ç‚¹, è€Œæè¿°ä¸€ä¸ªç‚¹åˆ°å‡ ä½•ä½“ä¸Šç‚¹çš„è·ç¦».è¿™ç§æè¿°æ–¹å¼å¾ˆé€‚åˆè¡¨è¿°å‡ ä½•ä½“çš„èåˆè¿‡ç¨‹(æˆ‘ä»¬å®šä¹‰SDFå‡½æ•°ä¸ºå›¾ç‰‡ä¸Šç‚¹åˆ°ç‰©ä½“è¾¹ç•Œçš„è·ç¦»,å°†ä¸¤ä¸ªå›¾åƒèåˆå°±æ˜¯å°†ä¸¤ä¸ªè·ç¦»å‡½æ•°ç›¸åŠ .è·ç¦»å‡½æ•°ä¸º0çš„éƒ¨åˆ†å°±æ˜¯ç‰©ä½“çš„è¡¨é¢)</p><p><img src="./img/10-2.png" /></p></li><li><p>æ°´å¹³é›†: æå–è·ç¦»å‡½æ•°ä¸º<spanclass="math inline">\(n\)</span>çš„æ›²çº¿çš„é›†åˆ</p></li><li><p>åˆ†å½¢è¡¨ç¤º</p></li></ul></li><li><p>æ˜¾å¼å‡ ä½•(explicit): ç›´æ¥ç»™å‡ºå‡ ä½•ä½“(å¦‚ä¸‰è§’å½¢çš„é¡¶ç‚¹),æˆ–è€…é€šè¿‡å‚æ•°æ˜ å°„çš„å½¢å¼ç»™å‡º(ç»™å‡ºå‚æ•°èŒƒå›´, ç»™å‡ºå‚æ•°åˆ°åæ ‡çš„å‚æ•°æ–¹ç¨‹)</p><p>æˆ‘ä»¬å¾ˆéš¾ç›´æ¥å¾—çŸ¥ç‚¹ä¸å‡ ä½•ä½“çš„å…³ç³», ä½†æ˜¯å¯ä»¥å¾ˆè½»æ¾çš„å¾—çŸ¥å…¶è¡¨ç¤ºç»“æ„</p><p>å¸¸è§çš„æ˜¾å¼è¡¨ç¤ºåº”ç”¨:</p><ul><li><p>ç‚¹äº‘(point cloud): ç”¨è¶³å¤Ÿå¯†çš„ç‚¹å †ç Œè¡¨é¢</p></li><li><p>å¤šè¾¹å½¢é¢è¡¨ç¤º(æœ€å¸¸ç”¨): ç”¨å¤šè¾¹å½¢æ‹¼æ¥æè¿°å¤æ‚çš„ç‰©ä½“</p><p><img src="./img/10-3.png" /></p><p>æè¿°ç‰©ä½“æ—¶éœ€è¦æè¿°ä¸‰è§’å½¢çš„é¡¶ç‚¹ä¸ä¸‰è§’å½¢ä¹‹é—´çš„è¿æ¥å…³ç³». WavefrontObject File(<code>.obj</code>)æ–‡ä»¶å°±é‡‡ç”¨äº†è¿™ç§å®šä¹‰æ–¹æ³•, ä¾‹å¦‚</p><pre class="line-numbers language-obj" data-language="obj"><code class="language-obj"># Blender3D v249 OBJ File: untitled.blend# www.blender3d.orgmtllib cube.mtl# å®šä¹‰ç©ºé—´ä¸­çš„ç‚¹v 1.000000 -1.000000 -1.000000v 1.000000 -1.000000 1.000000...# å®šä¹‰çº¹ç†åæ ‡vt 0.748573 0.750412vt 0.749279 0.501284...# å®šä¹‰é¢ä¸Šçš„æ³•çº¿vn 0.000000 0.000000 -1.000000vn -1.000000 -0.000000 -0.000000# å®šä¹‰é¢f 1&#x2F;2&#x2F;8 2&#x2F;9&#x2F;8 3&#x2F;13&#x2F;8   # ç”¨ç¬¬1-2-3ä¸ªç‚¹å®šä¹‰ä¸€ä¸ªå¹³é¢, ä»–ä»¬åˆ†åˆ«å¯¹åº”2-9-13ä¸ªçº¹ç†åæ ‡, åˆ†åˆ«å¯¹åº”8-8-8ä¸ªæ³•çº¿f 1&#x2F;2&#x2F;8 3&#x2F;13&#x2F;8 4&#x2F;14&#x2F;8...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><h2 id="lecture-11-geometry---æ›²çº¿ä¸æ›²é¢">Lecture 11 Geometry -æ›²çº¿ä¸æ›²é¢</h2><p><strong>æ›²çº¿çš„æ˜¾å¼è¡¨ç¤º</strong></p><ul><li><p>è´å¡å°”æ›²çº¿(Bezier Curves)</p><ul><li><p>äºŒæ¬¡è´å¡å°”æ›²çº¿: æŒ‰é¡ºåºå®šä¹‰ä¸¤ä¸ªç‚¹<spanclass="math inline">\(P_1\)</span>, <spanclass="math inline">\(P_2\)</span>, å®šä¹‰ä¸€ä¸ªæ–°ç‚¹<spanclass="math inline">\(P\)</span>, å–<span class="math inline">\(t\in[0,1]\)</span>, åœ¨<span class="math inline">\(t=t_0\)</span>æ—¶, <spanclass="math inline">\(P\)</span>çš„ä½ç½®æ˜¯çº¿æ®µ<spanclass="math inline">\(P_1P_2\)</span>ä¸Šè·ç¦»<spanclass="math inline">\(P_1\)</span>é•¿åº¦ä¸º<span class="math inline">\(t\times length_{P_1P_2}\)</span>çš„ä½ç½®</p></li><li><p>äºŒæ¬¡è´å¡å°”æ›²çº¿: æŒ‰é¡ºåºå®šä¹‰ä¸‰ä¸ªç‚¹<spanclass="math inline">\(P_1\)</span>, <spanclass="math inline">\(P_2\)</span>, <spanclass="math inline">\(P_3\)</span>, å®šä¹‰ä¸‰ä¸ªæ–°ç‚¹<spanclass="math inline">\(P_4\)</span>, <spanclass="math inline">\(P_5\)</span>, <spanclass="math inline">\(P\)</span>, å–<span class="math inline">\(t\in[0,1]\)</span>, åœ¨<span class="math inline">\(t=t_0\)</span>æ—¶, <spanclass="math inline">\(P_4\)</span>çš„ä½ç½®æ˜¯çº¿æ®µ<spanclass="math inline">\(P_1P_2\)</span>ä¸Šè·ç¦»<spanclass="math inline">\(P_1\)</span>é•¿åº¦ä¸º<span class="math inline">\(t\times length_{P_1P_2}\)</span>çš„ä½ç½®, <spanclass="math inline">\(P_5\)</span>çš„ä½ç½®æ˜¯çº¿æ®µ<spanclass="math inline">\(P_2P_3\)</span>ä¸Šè·ç¦»<spanclass="math inline">\(P_2\)</span>é•¿åº¦ä¸º<span class="math inline">\(t\times length_{P_2P_4}\)</span>çš„ä½ç½®, è¿æ¥<spanclass="math inline">\(P_4P_5\)</span>, <spanclass="math inline">\(P\)</span>åœ¨çº¿æ®µ<spanclass="math inline">\(P_4P_5\)</span>ä¸Šè·ç¦»<spanclass="math inline">\(P_4\)</span>é•¿åº¦ä¸º<span class="math inline">\(t\times length_{P_4P_5}\)</span>çš„ä½ç½®, <spanclass="math inline">\(P\)</span>çš„è½¨è¿¹å°±æ˜¯äºŒæ¬¡è´å¡å°”æ›²çº¿</p><p><img src="./img/11-1.gif" /></p></li><li><p>ä»¥æ­¤ç±»æ¨, ä¸‰æ¬¡è´å¡å°”æ›²çº¿å°±æ˜¯å–ä¸‰ä¸ªçº¿æ®µä¸Šä¸‰ä¸ªç‚¹, è¿æˆä¸¤ä¸ªçº¿æ®µ,å–äºŒæ¬¡è´å¡å°”æ›²çº¿åœ¨<spanclass="math inline">\(t\)</span>æ—¶çš„ä½ç½®,</p></li><li><p>å¦‚ä½•å®ç°è´å¡å°”æ›²çº¿:</p><p>éµå¾ªè´å¡å°”æ›²çº¿å®šä¹‰: <span class="math inline">\(P_1\toP_2\)</span>çš„ç‚¹å¯ä»¥è¡¨ç¤ºä¸º<spanclass="math inline">\((1-t)P_1+t(P_2)\)</span>, é€’å½’åº”ç”¨å³å¯</p><p>å¸¸ç”¨çš„å°±æ˜¯ä¸‰æ¬¡è´å¡å°”æ›²çº¿, æˆ‘ä»¬æœ‰é”šç‚¹<span class="math inline">\(P_1,P_2, P_3, P_4\)</span>, å…¶ä¸­å›ºå®š<span class="math inline">\(P_1=(0,0),P_4=(1,1)\)</span>åœ¨, å˜é‡åªæœ‰<span class="math inline">\(P_{2},P_{3}\)</span>, æ›²çº¿å…¬å¼ä¸º <span class="math display">\[b(t) = P_1(1-t)^3+3P_2t(1-t)^2+3P_3t^2(1-t)+P_4t^3, t\in [0,1]\]</span> å®é™…æ•ˆæœä¸äºŒæ¬¡é¡¹å±•å¼€ç±»ä¼¼, å¯ä»¥å¾—åˆ°æ›´æ™®éçš„å®šä¹‰:</p><p>é€šè¿‡<span class="math inline">\(n+1\)</span>ä¸ªæ§åˆ¶ç‚¹å¯ä»¥å¾—åˆ°<spanclass="math inline">\(n\)</span>é˜¶è´å¡å°”æ›²çº¿, <spanclass="math inline">\(b^n_j(t)\)</span>è¡¨ç¤ºåœ¨<spanclass="math inline">\(t\)</span>æ—¶åˆ», <spanclass="math inline">\(n\)</span>é˜¶ç¬¬<spanclass="math inline">\(j\)</span>ä¸ªç‚¹çš„ä½ç½® <span class="math display">\[\begin{align}b^n(t) &amp;= b^n_0(t) = \sum_{j=0}^nb_jB^n_j(t)\\B^n_i(t) &amp;=\left( \begin{matrix}n\\i\end{matrix}\right)t^i(1-t)^{n-i}\end{align}\]</span> å…¶ä¸­<spanclass="math inline">\(B^n_j(t)\)</span>ä¸ºä¼¯æ©æ–¯å¦å¤šé¡¹å¼,å®é™…è¯´çš„å°±æ˜¯äºŒæ¬¡é¡¹å±•å¼€</p></li><li><p>æ€§è´¨</p><ul><li><span class="math inline">\(t=0\)</span>æ—¶éƒ½åœ¨èµ·ç‚¹</li><li>å¯¹äºä¸‰æ¬¡è´å¡å°”: åœ¨<span class="math inline">\(t=0\)</span>æ—¶, <spanclass="math inline">\(b^1_0(0)\)</span>ä¸<spanclass="math inline">\(b^1_2(0)\)</span>çš„è¿åŠ¨æ–¹å‘åˆ‡çº¿åˆ†åˆ«ä¸º<spanclass="math inline">\(b^{1&#39;}_0(0)=3(b_1-b_0),b^{1&#39;}_1(0)=3(b_3-b_2)\)</span></li><li>è´å¡å°”æ›²çº¿ä¸Šçš„ç‚¹ä¸æ§åˆ¶ç‚¹åŒæ—¶åšä»¿å°„å˜æ¢(æŠ•å½±ä¸è¡Œ),ç‚¹ä¸å˜(æƒ³è¦å¯¹æ›²çº¿åšå˜æ¢å¯ä»¥ç›´æ¥å¯¹æ§åˆ¶ç‚¹åšå˜æ¢).</li><li>è´å¡å°”æ›²çº¿ä¸€å®šåœ¨æ§åˆ¶ç‚¹å›´æˆçš„çªåŒ…å†…</li></ul></li></ul></li><li><p>é€æ®µè´å¡å°”æ›²çº¿(Piecewise Bezier Curves)</p><p>å½“è´å¡å°”æ›²çº¿é˜¶æ•°å˜é«˜æ—¶, å¯¹äº<spanclass="math inline">\(n\)</span>é˜¶è´å¡å°”æ›²çº¿, æˆ‘ä»¬éœ€è¦<spanclass="math inline">\(n+1\)</span>ä¸ªç‚¹æ‰èƒ½æ§åˆ¶ä¸€ä¸ªæ›²çº¿,æ­¤æ—¶æ›²çº¿çš„æ§åˆ¶å°±å˜å›°éš¾äº†. æˆ‘ä»¬å¸Œæœ›å¯ä»¥åˆ†æ®µè¡¨ç¤ºæ›²çº¿, ç„¶åå°†å…¶æ‹¼æ¥èµ·æ¥.ä¸€èˆ¬ä½¿ç”¨æ¯å››ä¸ªç‚¹å®šä¹‰è´å¡å°”æ›²çº¿çš„ä¸€æ®µ(Piecewise cube Bezier)</p><p><img src="./img/11-2.png" /></p><p>æ¯æ¡æ›²çº¿ç”±ä¸¤ç«¯å„è‡ªçš„ä¸€ä¸ªé»‘ç‚¹å’Œä¸€ä¸ªè“ç‚¹å…±å››ä¸ªæ§åˆ¶ç‚¹ç»„æˆ. å¯¹äºä¸­é—´çš„ç‚¹,ç‚¹ä¸Šæœ‰ä¸€ä¸ªå…±ç”¨çš„é»‘ç‚¹ä¸ä¸¤ä¸ªæ›²çº¿å„è‡ªçš„è“ç‚¹ç»„æˆ</p><p>å¦‚æœæƒ³è¦ä¿è¯ä¸¤æ®µæ›²çº¿åœ¨è¡”æ¥å¤„è¿ç»­,åªéœ€è¦ä¿è¯åœ¨è¡”æ¥å¤„ä¸¤ä¸ªé»‘è“çº¿<strong>ç­‰å¤§å…±çº¿åå‘</strong></p></li><li><p>Spline: æ ·æ¡æ›²çº¿</p></li></ul><p><strong>æ›²é¢çš„æ˜¾å¼è¡¨ç¤º</strong></p><ul><li><p>è´å¡å°”æ›²é¢</p><p>å¯ä»¥ä½¿ç”¨å››ä¸ªç‚¹å®šä¹‰ä¸€ä¸ªä¸‰é˜¶è´å¡å°”æ›²çº¿, åœ¨æ›²é¢ä¸­,å¯ä»¥å†ç”¨16ä¸ªç‚¹å®šä¹‰å››æ¡å¤„äºå¹³è¡Œå¹³é¢çš„è´å¡å°”æ›²çº¿,æˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ›²çº¿ä¸Šä¸€ä¸ªæˆªé¢ä¸Šçš„å››ä¸ªç‚¹æ˜¯æ§åˆ¶ç‚¹, ä»è€Œæ„å»ºä¸€æ¡è´å¡å°”æ›²çº¿,æœ€åå¾—åˆ°è´å¡å°”æ›²é¢</p><p><img src="./img/11-3.gif" /></p></li></ul><h2 id="lecture-12-geometry---æ›²é¢æ“ä½œä¸é˜´å½±">Lecture 12 Geometry -æ›²é¢æ“ä½œä¸é˜´å½±</h2><p>å¯ä»¥å¯¹æ›²é¢ä¸Šä¸‰è§’å½¢è¿›è¡Œæ“ä½œ</p><ul><li>æ›²é¢ç»†åˆ†(Mesh Subdivision / upsampling): ä¸‰è§’å½¢æ•°é‡å¢åŠ ,è¡¨ç¤ºçš„æ›²é¢æ›´åŠ å…‰æ»‘(å›¾<span class="math inline">\(2\to 3\)</span>)</li><li>æ›²é¢(Mesh Simplification / downsampling): ä¸‰è§’å½¢æ•°é‡å‡å°‘,ç®€åŒ–æ›²é¢(å›¾<span class="math inline">\(2\to 4\)</span>)</li><li>æ›²é¢æ­£åˆ™åŒ–(Mesh Regularization / same #triangles):è®©ä¸‰è§’å½¢é¢å˜å¾—æ›´åŠ è§„åˆ™, å‡å°‘å°–é”çš„ä¸‰è§’å½¢,è®©ä¸‰è§’å½¢å°½é‡æ¥è¿‘ç­‰è¾¹ä¸‰è§’å½¢(å›¾<span class="math inline">\(2\to5\)</span>)</li></ul><p><img src="./img/12-1.png" /></p><p><strong>ä¸‰è§’å½¢ç»†åˆ†</strong></p><p>å¼•å…¥æ›´å¤šçš„ä¸‰è§’å½¢, åŒæ—¶è®©ä¸‰è§’å½¢ä½ç½®ç›¸å¯¹äºåŸæ¥å¤§ä¸‰è§’å½¢ä½ç½®å˜åŒ–,ä»è€Œä½¿ç‰©ä½“å˜å¾—æ›´å…‰æ»‘. å¸¸è§çš„ç®—æ³•:</p><ul><li><p>Loop Subdivision(å‘æ˜è€…æ˜¯Loop, ä¸è¦è¯‘ä¸ºå¾ªç¯ç»†åˆ†),åªé€‚ç”¨äºä¸‰è§’å½¢</p><ol type="1"><li><p>å¼•å…¥ä¸‰è§’å½¢: ä¸‰è§’å½¢ä¸‰è¾¹å–ä¸­ç‚¹, ä¸­ç‚¹é—´è¿çº¿,äºæ˜¯1ä¸ªä¸‰è§’å½¢å˜æˆ4ä¸ª</p></li><li><p>è°ƒæ•´ä½ç½®:</p><ul><li><p>å¯¹äºå¼•å…¥æ–°é¡¶ç‚¹(ä¸­ç‚¹): <span class="math inline">\(P = 3/8 * (A +B) + 1/8 * (C + D)\)</span>, <span class="math inline">\(A,B\)</span>ä¸ºæ‰€åœ¨è¾¹çš„é¡¶ç‚¹. <spanclass="math inline">\(CD\)</span>ä¸ºç›¸é‚»ä¸¤ä¸ªä¸‰è§’å½¢å¯¹è¾¹é¡¶ç‚¹</p></li><li><p>å¯¹äºåŸæœ‰é¡¶ç‚¹:</p></li></ul><p><span class="math display">\[  \begin{align}  P &amp; = (1 - n*u) * original\_position + u * neighbo\_position\_sum\\  v &amp; = è¢«è°ƒæ•´é¡¶ç‚¹åº¦æ•° \\  u &amp; = \left\{  \begin{matrix}  3/16&amp; \ &amp;n = 3\\  3/8n&amp; \ &amp;otherwise  \end{matrix}  \right.  \end{align}  \]</span></p><p>æ³¨æ„è¿™é‡Œæ˜¯é’ˆå¯¹ä¸€ä¸ªåŸæœ‰é¡¶ç‚¹è®¡ç®—çš„, è®¡ç®—ç›¸é‚»ç‚¹ä½ç½®çš„æ—¶å€™<spanclass="math inline">\(n\)</span>è¿˜æ˜¯è¢«è°ƒæ•´ç‚¹åº¦æ•°, è€Œä¸æ˜¯ç›¸é‚»ç‚¹çš„åº¦æ•°</p><p><img src="./img/12-2.png" /></p></li></ol></li><li><p>Catmull-Clark Subdivision, é€‚ç”¨äºä¸€èˆ¬å¹³é¢</p><ol type="1"><li><p>å®šä¹‰å››è¾¹å½¢é¢(quad face)ä¸éå››è¾¹å½¢é¢(none-quad face).åº¦ä¸ä¸º4çš„ç‚¹ä¸ºå¥‡å¼‚ç‚¹(Extraordinary Vertex)</p></li><li><p>å¼•å…¥ç‚¹: å–æ¯ä¸ªè¾¹ä¸é¢çš„ä¸­ç‚¹, å°†è¾¹çš„ä¸­ç‚¹ä¸é¢çš„ä¸­ç‚¹è¿æ¥</p><p><img src="./img/12-4.png" /></p><p>å¯ä»¥çœ‹åˆ°, ç¬¬ä¸€æ¬¡å¼•å…¥æ–°ç‚¹å:</p><ul><li>éå››è¾¹å½¢é¢å…¨æ²¡äº†</li><li>éå››è¾¹å½¢é¢ä¸­ç‚¹å˜æˆæ–°å¥‡å¼‚ç‚¹, åº¦æ•°ä¸ºåŸå¤šè¾¹å½¢é¢æ•°</li><li>åŸå¥‡å¼‚ç‚¹åº¦æ•°ä¸å˜</li></ul></li><li><p>è°ƒæ•´ä½ç½®</p><ul><li>å¯¹äºé¢çš„ä¸­ç‚¹: ä½ç½®æ˜¯æ‰€åœ¨å¹³é¢å››ä¸ªç‚¹å‡å€¼</li><li>å¯¹äºè¾¹ä¸Šä¸­ç‚¹: ä½ç½®è¿˜æ˜¯ç›¸é‚»é¢ä¸­ç‚¹äºæ‰€åœ¨è¾¹ç«¯ç‚¹å‡å€¼</li><li>åŸæ¥çš„ç‚¹: <spanclass="math inline">\(\frac{\sum_if_i+2\sum_im_i+4p}{16}\)</span>,å…¶ä¸­<span class="math inline">\(f_i\)</span>æ˜¯ç›¸é‚»é¢ä¸­ç‚¹, <spanclass="math inline">\(m_i\)</span>æ˜¯ç›¸é‚»è¾¹ä¸­ç‚¹, <spanclass="math inline">\(p\)</span>æ˜¯è¢«è°ƒæ•´ç‚¹ä½ç½®</li></ul></li></ol></li></ul><p>å¯ä»¥çœ‹åˆ°, æˆ‘ä»¬è¿™äº›ç®—æ³•å¹¶ä¸æ˜¯æ ¹æ®åŸç‰©ä½“å½¢æ€å¯¹é¡¶ç‚¹è°ƒæ•´çš„,è€Œæ˜¯æ ¹æ®å·²æœ‰èŠ‚ç‚¹è·å–ä¸€ä¸ªæ–°ç‚¹åæ ‡, çœ‹èµ·æ¥æ˜¯ä¸€ç§"é«˜çº§çš„æ›²é¢æ’å€¼".è¿™æ ·çš„åšæ³•ä¸èƒ½è®©ç»†åˆ†åæ¨¡å‹æ›´åŠ æ¥è¿‘äºåŸç‰©ä½“, ä½†æ˜¯å¯ä»¥è®©æ¨¡å‹æ›´åŠ å…‰æ»‘,ä¾‹å¦‚</p><p><img src="./img/12-3.png" /></p><p><strong>æ›²é¢ç®€åŒ–</strong></p><p>æœ‰çš„æ—¶å€™æˆ‘ä»¬ä¸å¸Œæœ›é¡¶ç‚¹å¤ªå¤š(ç‰©ä½“ç¦»å¾—å¾ˆè¿œ, æ²¡å¿…è¦æ¸²æŸ“é‚£ä¹ˆä»”ç»†),æ‰€ä»¥éœ€è¦æ›²çº¿ç»†åˆ†,</p><p>ç®—æ³•: è¾¹åç¼©, å»æ‰ä¸€ä¸ªè¾¹, æŠŠç›¸é‚»èŠ‚ç‚¹è¿èµ·æ¥</p><ul><li><p>æ‰¾åˆ°æ–°ç‚¹:</p><p><img src="./img/12-5.png" /></p><p>å‡è®¾éœ€è¦å°†ç°è‰²éƒ¨åˆ†åç¼©æˆä¸‰ä¸ªç‚¹å¹¶äº§ç”Ÿä¸€ä¸ªè“è‰²çš„æ–°ç‚¹,ä½†æ˜¯æ–°ç‚¹çš„ä½ç½®éš¾ä»¥ç¡®å®š. å¦‚æœé‡‡ç”¨å‡å€¼ä¼šå¾—åˆ°å·¦è¾¹çš„æ•ˆæœ,æˆ‘ä»¬ä½¿ç”¨äºŒæ¬¡åº¦é‡è¯¯å·®(Quadric Error Metrics)è¯„ä»·ç‚¹çš„ä½ç½®,è®©æ–°ç‚¹è·ç¦»å¹³é¢è·ç¦»å’Œæœ€å°.</p></li><li><p>æ‰¾åˆ°éœ€è¦åç¼©çš„è¾¹: ä¸ºæ¯ä¸ªè¾¹è®¡ç®—åç¼©åäºŒæ¬¡åº¦é‡è¯¯å·®æœ€å°çš„è¾¹.ä½†æ˜¯æ¯æ¬¡åç¼©åå…¶ä»–è¾¹çš„äºŒæ¬¡åº¦é‡è¯¯å·®ä¼šå˜åŒ–,æˆ‘ä»¬éœ€è¦åŠ¨æ€ç»´æŠ¤è¾¹çš„äºŒæ¬¡åº¦é‡è¯¯å·®, ç”¨ä¸€ä¸ªHeapå³å¯</p></li><li><p>è¿™æ˜¯ä¸€ä¸ªè´ªå¿ƒç®—æ³•, è™½ç„¶ä¸æ˜¯æœ€ä¼˜, ä½†æ˜¯çœ‹ç€ä¸é”™</p></li></ul><p><strong>é˜´å½±ç”Ÿæˆ</strong></p><p>å¯ä»¥åœ¨å…‰æ …åŒ–æ—¶å€™è¿›è¡Œé˜´å½±ç”Ÿæˆ(Shadow Mapping).</p><ul><li>Shadow Mappingæ˜¯ä¸€ä¸ªå›¾åƒç©ºé—´çš„åšæ³•:åœ¨ç”Ÿæˆé˜´å½±æ—¶æ— éœ€çŸ¥é“ç‰©ä½“çš„å‡ ä½•ä¿¡æ¯.</li><li>åªé€‚ç”¨äºç‚¹å…‰æº</li><li>ä¼šäº§ç”Ÿèµ°æ ·ç°è±¡</li><li>åªèƒ½ç”Ÿæˆç¡¬é˜´å½±(ä¸€ä¸ªç‚¹è¦ä¹ˆåœ¨é˜´å½±é‡Œ, è¦ä¹ˆä¸åœ¨é˜´å½±é‡Œ)</li><li>å­˜åœ¨æ•°å€¼ç²¾åº¦é—®é¢˜</li></ul><p>æ ¸å¿ƒæ€æƒ³: å¦‚æœä¸€ä¸ªç‚¹ä¸å†é˜´å½±é‡Œ,é‚£ä¹ˆä»å…‰æºæ–¹å‘ä¸æ‘„åƒæœºæ–¹å‘éƒ½èƒ½çœ‹åˆ°ä»–</p><p>å®ç°:</p><ul><li>å°†å…‰æºå½“ä½œæ‘„åƒæœºç»´æŠ¤æ¯ä¸ªç‚¹æ­¤æ—¶çš„Depth Buffer</li><li>ä»åŸæ‘„åƒæœºç‚¹åšå…‰æ …åŒ–, å¯¹äºå±å¹•ä¸Šçš„æ¯ä¸ªç‚¹,è®¡ç®—ç‚¹åˆ°å…‰æºçš„è·ç¦»å¹¶äºä¸Šä¸€æ­¥ç»´æŠ¤çš„Depth Bufferæ¯”è¾ƒ, å¦‚æœè·ç¦»å¤§äºDepthBufferå°±è¯´æ˜å…‰æ‰“ä¸åˆ°, æ­¤å¤„æ˜¯é˜´å½±</li><li>ç”±äºDepth Bufferåƒç´ æœ‰å°ºå¯¸(å¦‚: Depth Bufferæ˜¯1080Pçš„,ä½†æ˜¯å…‰æ …åŒ–æ˜¯2Kçš„, å…‰æ …åŒ–çš„ä¸€ä¸ªåƒç´ ä¸å¯¹åº”Depth Bufferä¸Šä¸€ä¸ªåƒç´ ),æµ®ç‚¹æ•°è¯¯å·®, å¾ˆéš¾ç²¾ç¡®æ¯”è¾ƒä¸¤ä¸ªè·ç¦»æ˜¯å¦ç›¸ç­‰. ä¸€èˆ¬å¯ç”¨å®é™…æ·±åº¦å¤§äºDepthBufferæ·±åº¦+espåˆ¤å®šè¢«é®æŒ¡. ä½†æ˜¯ä¾ç„¶å¾ˆéš¾å‡†ç¡®å®ç°</li></ul><p><strong>ç¡¬é˜´å½±ä¸è½¯é˜´å½±</strong></p><p><img src="./img/12-6.png" /></p><p>åœ¨Shadow Mappingæ—¶, æˆ‘ä»¬è®¤ä¸ºå…‰æºæ˜¯ç‚¹å…‰æº, ä½†æ˜¯å®é™…å…‰æºæ˜¯æœ‰ä½“ç§¯çš„,ä¾‹å¦‚ä¸Šå›¾æœˆé£Ÿç°è±¡ ä¸­, åœ°çƒä¸Šä¸€éƒ¨åˆ†æ˜¯å®Œå…¨çœ‹ä¸åˆ°å…‰çš„(UmbraåŒºåŸŸ),ä¸€éƒ¨åˆ†æ˜¯å¯ä»¥çœ‹åˆ°ä¸€éƒ¨åˆ†å…‰çš„(PenumbraåŒºåŸŸ),å°†å®Œå…¨çœ‹ä¸åˆ°å…‰çš„é˜´å½±ç§°ä¸ºç¡¬é˜´å½±, å°†å¯ä»¥çœ‹åˆ°éƒ¨åˆ†å…‰çš„é˜´å½±ç§°ä¸ºè½¯é˜´å½±.</p><h2 id="lecture-13-ray-tracing---whitted-styleå…‰çº¿è¿½è¸ª">Lecture 13 RayTracing - Whitted-Styleå…‰çº¿è¿½è¸ª</h2><p>å…‰çº¿è¿½è¸ªä¸å…‰æ …åŒ–æ˜¯ä¸¤ç§<strong>å®Œå…¨ä¸åŒçš„æˆåƒæ–¹å¼</strong>(ç›¸äº’æ›¿ä»£)</p><p>å…‰æ …åŒ–é’ˆå¯¹å•ç‚¹å¤„ç†, ä½†ä¸èƒ½å®ç°å…¨å±€æ•ˆæœ(è½¯é˜´å½±, ç£¨ç ‚é•œé¢åå°„,é—´æ¥å…‰ç…§). å…‰è¿½å¯ä»¥å®ç°å…¨å±€æ•ˆæœ, ä½†æ˜¯éå¸¸æ…¢,ä¸€èˆ¬ç”¨äºç¦»çº¿æ¸²æŸ“(ç”µå½±ç­‰)</p><p><strong>å…‰çº¿è¿½è¸ªçš„åŸºæœ¬å‡è®¾</strong></p><ul><li>å…‰æ²¿ç›´çº¿ä¼ æ’­(ä¸è€ƒè™‘æ³¢åŠ¨æ€§)</li><li>å…‰çº¿ç¢°æ’åä¸æ”¹å˜åŸä¼ æ’­æ€§è´¨</li><li>äººå¯ä»¥çœ‹åˆ°å›¾åƒæ˜¯å› ä¸ºå…‰çº¿ä»å…‰æºå‘å‡º, ä¸æ–­åå°„æŠ˜å°„, æœ€åè¿›å…¥äººçœ¼.å…‰è·¯æ˜¯å¯é€†çš„(äººå¯ä»¥çœ‹åˆ°ç‰©ä½“ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯äººçœ¼å‘å‡ºäº†æŸç§æ„ŸçŸ¥å…‰çº¿,æœ€åæ±‡é›†åˆ°å…‰æºå¤„)</li><li>äººçœ¼æ˜¯ä¸€ä¸ªç‚¹</li><li>å…‰çº¿åœ¨ç‰©ä½“è¡¨é¢ä¼šå‘ç”Ÿå®Œç¾æŠ˜å°„</li></ul><p>å…‰çº¿è¿½è¸ªå°±æ˜¯æ¨¡æ‹Ÿäººçœ¼å‘å‡ºæ„ŸçŸ¥å…‰çº¿,é€šè¿‡ä¸æ–­åå°„æŠ˜å°„æœ€åæ±‡é›†åˆ°å…‰æºçš„è¿‡ç¨‹(æ±‡é›†ä¸åˆ°å…‰æºçš„æ„ŸçŸ¥å…‰çº¿å°±åœ¨æŠ˜å°„åå°„æ—¶è¡°å‡å®Œäº†...).</p><p><strong>æ„ŸçŸ¥å…‰çº¿æŠ•å°„</strong></p><p><img src="./img/13-1.png" /></p><p>ä»äººçœ¼çœ‹å‘å±å¹•, è®©çœ¼ç›å‘å‡ºçš„å…‰çº¿ç©¿é€å±å¹•æ‰“åœ¨ç‰©ä½“ä¸Š,å…ˆä¸è€ƒè™‘æŠ˜å°„ä¸å¤šæ¬¡åå°„, æˆ‘ä»¬ç›´æ¥å°†ç€è‰²ç‚¹ä¸å…‰æºè¿çº¿,å¦‚æœè¿çº¿ä¹‹é—´æ²¡æœ‰é®æŒ¡é‚£è¯´æ˜è¯¥ç‚¹ä¸åœ¨é˜´å½±ä¸­,ä½¿ç”¨ç€è‰²æ¨¡å‹å°±å¯ä»¥è®¡ç®—æ˜¯ä»€ä¹ˆé¢œè‰². è‡³æ­¤, æˆ‘ä»¬å¾—åˆ°äº†ä¸å…‰æ …åŒ–ç›¸ä¼¼çš„ç»“æœ.åœ¨å…‰è¿½ä¸­æˆ‘ä»¬å¯¹ç®—æ³•è¿›è¡Œäº†ä¸€äº›æ”¹è¿›</p><p><strong>Whitted-Styleå…‰çº¿è¿½è¸ª</strong></p><p>ä¸€ç§æ¯”è¾ƒå¤è€çš„å…‰è¿½ç®—æ³•, æ•ˆæœä¸æ˜¯å¾ˆå¥½</p><p><img src="./img/13-2.png" /></p><p>æˆ‘ä»¬çœ‹å³ä¾§å“ªä¸ª"é‡‘å±çƒ", å¯ä»¥çœ‹åˆ°çƒä¸Šæœ‰æœ¬èº«çš„é‡‘å±é“¶è‰²,ä¹Ÿæœ‰åå°„ç¯å¢ƒå…‰å¾—åˆ°çš„é¢œè‰².å·¦ä¾§çš„"ç»ç’ƒçƒ"ä¸Šè¿˜å¯ä»¥çœ‹åˆ°æŠ˜å°„çœ‹åˆ°çš„èƒŒåçš„å…‰</p><p>åœ¨Whitted-Styleå…‰è¿½ä¸­, äººçœ¼å‘å‡ºçš„å…‰çº¿(eye ray / primaryray)åœ¨æ‰“åˆ°ç‰©ä½“ç‚¹ä¸Šåè¢«æ‰“æ•£ä¸ºä¸‰ç§å…‰çº¿</p><ul><li>eye rayé€šè¿‡éå®Œç¾åå°„æ‰“åˆ°å…‰æº, é€šè¿‡ç€è‰²æ¨¡å‹å¾—åˆ°ç‰©ä½“æœ¬èº«é¢œè‰²</li><li>é€šè¿‡å®Œç¾åå°„å¾—åˆ°å…¶ä»–ç‰©ä½“çš„é¢œè‰²</li><li>é€šè¿‡æŠ˜å°„å¾—åˆ°çš„å…¶ä»–ç‰©ä½“é¢œè‰²</li></ul><p><img src="./img/13-3.png" /></p><p>åœ¨æ¯æ¬¡åå°„æŠ˜å°„åå…‰çº¿èƒ½é‡ä¼šè¡°å¼±, å¯ä»¥ä½¿ç”¨é€’å½’å®ç°è¯¥ç®—æ³•</p><p><strong>å­˜åœ¨çš„é—®é¢˜</strong></p><ul><li>å¦‚ä½•åˆ¤æ–­æ„ŸçŸ¥å…‰çº¿å’Œå“ªä¸ªç‰©ä½“ç›¸äº¤,äº¤ç‚¹åœ¨å“ªé‡Œ(æˆ‘ä»¬éœ€è¦è®©å…‰åœ¨ä¸‰ç»´ç‰©ä½“ä¹‹é—´åå¤åå°„, æ‰€ä»¥ä¸èƒ½ä½¿ç”¨DepthMapå®ç°)</li><li>åå°„å…‰æŠ˜å°„å…‰æ–¹å‘ä¸è¡°å‡è®¡ç®—</li></ul><p><strong>å…‰ä¸ç‰©ä½“äº¤ç‚¹è®¡ç®—</strong></p><ul><li><p>å…‰çº¿çš„å®šä¹‰: åŸç‚¹(<spanclass="math inline">\(O\)</span>)ä¸æ–¹å‘(å•ä½å‘é‡<spanclass="math inline">\(\vec{d}\)</span>)ç»„æˆ, å…‰çº¿å°±æ˜¯ä¸€ç³»åˆ—ç‚¹<spanclass="math inline">\(O+td, (0\leq t&lt;\infty)\)</span></p></li><li><p>å…‰æºä¸ç‰©ä½“å…³ç³»åˆ¤å®š: è‹¥å…‰çº¿ä¸ç‰©ä½“æœ‰å¶æ•°ä¸ªäº¤ç‚¹åˆ™å…‰æºåœ¨ç‰©ä½“å¤–,æœ‰å¥‡æ•°ä¸ªäº¤ç‚¹åˆ™å…‰æºåœ¨ç‰©ä½“å†…</p></li><li><p>å…‰çº¿ä¸éšå¼å®šä¹‰æ›²é¢çš„äº¤ç‚¹: å°†å…‰çº¿æ–¹ç¨‹ä¸æ›²é¢æ–¹ç¨‹è”ç«‹. èˆå»<spanclass="math inline">\(t\)</span>çš„å¤æ•°æ ¹ä¸è´Ÿæ ¹, å–æœ€å°çš„<spanclass="math inline">\(t\)</span>ä¸ºç¬¬ä¸€ä¸ªäº¤ç‚¹</p></li><li><p>å…‰çº¿ä¸æ˜¾å¼å®šä¹‰æ›²é¢çš„äº¤ç‚¹:</p><p>å…‰çº¿ä¸æ›²é¢äº¤ç‚¹ä¸æ˜¯å¾ˆå¥½æ±‚, ä½†æ˜¯å…‰çº¿ä¸‰è§’å½¢çš„äº¤ç‚¹è¿˜æ˜¯å¾ˆå¥½æ±‚çš„</p><ul><li><p>å…‰çº¿ä¸ä¸‰è§’å½¢æ±‚äº¤ç‚¹</p><p>å…ˆæ±‚å…‰çº¿ä¸ä¸‰è§’å½¢é¢çš„äº¤ç‚¹, å†åˆ¤æ–­äº¤ç‚¹åœ¨ä¸å†ä¸‰è§’å½¢å†…</p><p>å¹³é¢å¯ä»¥ç”¨å¹³é¢ä¸Šä¸€ä¸ªç‚¹<spanclass="math inline">\(P&#39;\)</span>åŠå…¶æ³•å‘é‡<spanclass="math inline">\(\vec{N}\)</span>è¡¨ç¤º, å¹³é¢ä¸Šä»»æ„ä¸€ç‚¹<spanclass="math inline">\(P\)</span>æ»¡è¶³<spanclass="math inline">\(\vec{PP&#39;}\cdot \vec{N} = 0\)</span>,å°†å…‰çº¿è¡¨ç¤ºä¸º<span class="math inline">\(O+t\vec{d}\)</span></p><p>è”ç«‹å³å¯: <span class="math inline">\((O+t\vec{d}-P&#39;) \cdot\vec{N} = 0\)</span>, ä½¿ç”¨å…‹è±å§†æ³•åˆ™å¯ä»¥å¾—åˆ° <spanclass="math display">\[t = \frac{(P&#39;-O)\cdot N}{d\cdot N}\]</span> æœ€ååˆ¤æ–­ç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢å†…éƒ¨</p></li><li><p>Moller Trumboreç®—æ³•</p><p>å°±æ˜¯å°†ä¸Šé¢æ­¥éª¤ä¸é‡å¿ƒåæ ‡åˆ¤æ–­ç‚¹ä¸ä¸‰è§’å½¢ä½ç½®ç»„åˆåœ¨ä¸€èµ·</p><p><span class="math display">\[\begin{align}\left[\begin{matrix}t\\b_1\\b_2\end{matrix}\right]=\frac{1}{S_1\cdot E_1}\left[\begin{matrix}S_2\cdot E_2\\S_1\cdot S\\S_2\cdot D\end{matrix}\right]\end{align}\]</span></p><p>å…¶ä¸­</p><p><span class="math display">\[E_1 = P_1-P_0\\E_2 = P_2-P_0\\S = O-P_0\\S_1 = D\times E_2\\S_2 = S\times E_1\\\]</span></p></li><li><p>åˆ¤æ–­å…‰çº¿ä¸æ¯ä¸ªä¸‰è§’å½¢æ±‚äº¤å¤ªæ…¢äº†, é‡‡ç”¨ç±»ä¼¼BoundingBoxçš„æ€æƒ³åŠ é€Ÿæ±‚äº¤</p></li></ul></li></ul><p><strong>Bounding Volumes</strong></p><p>å°†ç‰©ä½“ç”¨ç›¸å¯¹ç®€å•çš„å½¢çŠ¶åŒ…èµ·æ¥, è‹¥å…‰çº¿ä¸BoundingVolumesä¸æƒ³äº¤é‚£ä¸€å®šä¸å’Œç‰©ä½“ç›¸äº¤. ä¸ºäº†æ–¹ä¾¿è®¡ç®—,æˆ‘ä»¬ä¸€èˆ¬ç”¨è¾¹ä¸åæ ‡è½´å¹³è¡Œçš„ç«‹æ–¹ä½“åšåŒ…å›´å’Œ.åœ¨å¤„ç†å…‰çº¿ä¸ç«‹æ–¹ä½“ç›¸äº¤åˆ¤å®šé—®é¢˜æ—¶æˆ‘ä»¬å¯ä»¥é‡‡ç”¨åæ ‡è½´åˆ†è§£. æ ¸å¿ƒæ€æƒ³æ˜¯:å¦‚æœç‚¹åœ¨ç«‹æ–¹ä½“å†…éƒ¨, é‚£ä¹ˆç‚¹ä¸ç«‹æ–¹ä½“æŠ•å½±åœ¨<span class="math inline">\(xoy,yoz, zox\)</span>ä¸Šæ—¶, ç‚¹éƒ½åœ¨æŠ•å½±çŸ©å½¢å†…éƒ¨. å¦‚æœä»»ä½•ä¸€ä¸ªæ–¹å‘æŠ•å½±ä¸æˆç«‹,ç‚¹å°±ä¸åœ¨ç«‹æ–¹ä½“å†…éƒ¨.</p><p>ç”±äºæˆ‘ä»¬é€‰å–çš„ç«‹æ–¹ä½“è¾¹éƒ½å¹³è¡Œäºåæ ‡è½´, å¾ˆå®¹æ˜“åšç›¸äº¤è®¡ç®—,å¯¹äºä¸€ä¸ªæŠ•å½±å¹³é¢(ä»¥<span class="math inline">\(xoy\)</span>ä¸ºä¾‹),åªéœ€æ±‚å°„çº¿ä¸çŸ©å½¢äº¤ç‚¹æ—¶<spanclass="math inline">\(t\)</span>å¹¶å¯¹èŒƒå›´æ±‚äº¤(ä¸‹å›¾å…ˆæ±‚å°„çº¿ä¸<spanclass="math inline">\(x\)</span>äº¤ç‚¹, å†æ±‚<spanclass="math inline">\(y\)</span>, æœ€åæ±‚<spanclass="math inline">\(t\)</span>å–å€¼çš„äº¤é›†),å¯¹ä¸‰é¢åˆ†åˆ«æŠ•å½±æ±‚äº¤å³å¯å¾—åˆ°å…‰çº¿ç©¿è¿‡ç«‹æ–¹ä½“çš„<spanclass="math inline">\(t\)</span>å–å€¼èŒƒå›´, è®¡<spanclass="math inline">\(t_{enter} = t_{min}, t_{exit} =t_{max}\)</span></p><p><img src="./img/13-4.png" /></p><p>è®¨è®ºå¦‚ä¸‹æƒ…å†µ</p><ul><li><span class="math inline">\(t_{exit} &lt; 0\)</span>:ç‰©ä½“åœ¨å…‰çº¿åé¢</li><li><span class="math inline">\(t_{exit} \geq 0, t_{enter} &lt;0\)</span>: å…‰æºåœ¨ç‰©ä½“é‡Œé¢</li><li><span class="math inline">\(t_{exit} \geq 0, t_{enter} &lt;t_{exit}\)</span>: æ­£å¸¸æƒ…å†µ</li></ul><p><strong>åˆ©ç”¨å…‰çº¿ä¸Bounding Volumesç›¸äº¤åŠ é€Ÿå…‰çº¿ä¸æ›²é¢ç›¸äº¤</strong></p><ul><li><p>Uniform Gridsæ–¹æ³•(åœ¨ç‰©ä½“åˆ†å¸ƒå‡åŒ€æ—¶æ•ˆæœå¥½)</p><p>å°†åœºæ™¯å‡åŒ€çš„åˆ†æˆç­‰å¤§çš„å°ç›’å­, è®°å½•ç›’å­ä¸å“ªä¸ªç‰©ä½“ç›¸äº¤,è‹¥å…‰çº¿ä¸ç›’å­ç›¸äº¤ç€åˆ¤æ–­å…‰çº¿ä¸å¯¹åº”ç‰©ä½“æ˜¯å¦ç›¸äº¤</p><p><img src="./img/13-5.png" /></p><ul><li>å¦‚ä½•æ‰¾åˆ°æµ…è“è‰²è·¯å¾„å‘¢? å¦‚æœå…‰çº¿ä¸ä¸€ä¸ªæµ…è“è‰²æ ¼å­ç›¸äº¤,é‚£ä¹ˆä¸‹ä¸€ä¸ªæµ…è“è‰²æ ¼å­ä¸€å®šåœ¨è¿™ä¸ªæ ¼å­å‘¨å›´å…«ä¸ªæ ¼å­</li><li>æ ¼å­å°ºå¯¸å¦‚ä½•ç¡®å®š: <span class="math inline">\(æ ¼å­æ•° \approx 27\times åœºæ™¯ä¸­ç‰©ä½“æ•°ç›®\)</span>(ç»éªŒå…¬å¼)</li></ul></li><li><p>Spatial Partitionsæ–¹æ³•(åœ¨åœºæ™¯ç©ºæ—·æ—¶æ•ˆæœå¥½)</p><p>æˆ‘ä»¬ä¸å¸Œæœ›å°†ç©ºé—´åˆ’åˆ†ä¸ºç­‰å¤§çš„æ–¹å—, è€Œæ˜¯ä¸ºç©ºæ—·ç©ºé—´åˆ†é…å¤§æ ¼å­,å¯†é›†ç©ºé—´åˆ†å¸ƒå°æ ¼å­. å¸¸è§åˆ’åˆ†æ–¹æ³•æœ‰:</p><p><img src="./img/13-6.png" /></p><ul><li><p>å…«å‰æ ‘(Oct-Tree): å°†ä¸€ä¸ªèŠ‚ç‚¹åˆ†ä¸ºå…«ä¸ªå­èŠ‚ç‚¹(ç±»ä¼¼ä¸€ç»´çš„äºŒå‰æ ‘).åœ¨åˆ‡å‰²æ—¶,è‹¥èŠ‚ç‚¹ä¸­æœ‰è¶³å¤Ÿæ•°é‡å°‘çš„ç‰©ä½“(ä¾‹å¦‚èŠ‚ç‚¹åªä¸ä¸€ä¸ªç‰©ä½“ç›¸äº¤)å°±åœæ­¢</p></li><li><p>KD-Tree: å…«å‰æ ‘å®é™…ä¸Šæ˜¯ä½¿ç”¨äº†äºŒå‰æ ‘çš„æ€æƒ³, ä½†æ˜¯åœ¨é«˜ç»´ç©ºé—´ä¸­,æ ‘çš„åˆ†ææ•°æˆæŒ‡æ•°å€å¢é•¿(å››ç»´çš„16å‰æ ‘), äºæ˜¯æå‡ºäº†KD-Tree.åˆ’åˆ†ç©ºé—´æ—¶ä¾æ¬¡ä»ä¸åŒè½´åˆ‡ç‰©ä½“.åˆ‡å¼€çš„ç‰©ä½“åœ¨ä¸‹æ¬¡åˆ‡å‰²æ—¶å€™ç‹¬ç«‹åˆ‡å‰²(åˆ‡çº¿å¯ä»¥ä¸åœ¨ä¸€èµ·)äºæ˜¯å¯ä»¥ç”¨äºŒå‰æ ‘å­˜å‚¨KD-Tree.éå¶å­åªéœ€è¦ä¿å­˜åˆ‡çº¿, å¶å­èŠ‚ç‚¹ä¿å­˜ç›¸äº¤çš„æ›²é¢.é‡‡ç”¨ç±»ä¼¼äºŒåˆ†çš„æ–¹æ³•æ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸å…‰ç›¸äº¤çš„å¶å­èŠ‚ç‚¹</p><p>KD-Treeå­˜åœ¨çš„é—®é¢˜: éš¾ä»¥åˆ¤æ–­ç‰©ä½“ä¸ç›’å­ç›¸äº¤.ä¸€ä¸ªç‰©ä½“å¯ä»¥å‡ºç°åœ¨å¤šä¸ªBounding Volumesä¸­</p></li><li><p>BSP-Tree: æ¯æ¬¡å°†ç©ºé—´åˆ’åˆ†ä¸ºç­‰ç‰©ä½“æ•°ä¸¤å—.ä½†æ˜¯BSP-Treeçš„åˆ‡çº¿ä¸å¹³è¡Œäºè½´çº¿, é«˜ç»´æ—¶åˆ‡é¢éš¾ä»¥è®¡ç®—</p></li></ul></li><li><p>Object Partitions &amp; Bounding Volume Hierarchy(BVH)(ç»¼åˆæœ€å¥½)</p><p>Spatial Partitionsä¸­åˆ¤Bounding Volumesä¸ç‰©ä½“å…³ç³»å¤ªéº»çƒ¦äº†,æˆ‘ä»¬å¯ä»¥åå‘æ“ä½œ, é€šè¿‡ç‰©ä½“ç”ŸæˆBounding Volumes. ç„¶åå¯¹BoundingVolumesæ“ä½œ</p><p>æˆ‘ä»¬å°†ä¸€ç»„ç‰©ä½“(ä¸€ä¸ªBoundingVolume)é‡‡ç”¨æŸç§æ–¹æ³•(ä¾‹å¦‚KD-Treeæ€æƒ³)åˆ’åˆ†æˆä¸¤éƒ¨åˆ†, ç”Ÿæˆä¸¤ä¸ªBoundingVolume, é€’å½’è¿›è¡Œå¤šæ¬¡åˆ’åˆ†ä¸é‡ç®—Bounding Volume(å¯ä»¥ç”¨äºŒå‰æ ‘å­˜å‚¨è¿™ä¸€è¿‡ç¨‹).è¿™æ ·ä¸€ä¸ªç‰©ä½“åªå­˜åœ¨äºä¸€ä¸ªBounding Volume, åŒæ—¶ä¸€ä¸ªBoundingVolumeä¸­çš„ç‰©ä½“ä¹Ÿæ˜¯å·²çŸ¥çš„(ä¾‹å¦‚å›¾ä¸­è™½ç„¶è“ç»¿Bounding Volumeæœ‰äº¤é›†,ä½†æ˜¯ä»ç„¶å¯ä»¥åˆ†æ¸…å“ªä¸ªä¸‰è§’å½¢å±äºå“ªä¸ªåŒºåŸŸ)</p><p><img src="./img/13-7.png" /></p><p>åˆ’åˆ†ä¸‰è§’å½¢çš„æŠ€å·§</p><ul><li>æ¯æ¬¡å–ä¸€ä¸ªç»´åº¦è¿›è¡Œåˆ’åˆ†(åˆ’åˆ†é¢ä¸åæ ‡é¢å¹³è¡Œ),ä½†æ˜¯ä¸å¿…è¦åƒKD-Treeä¸€æ ·ä¾æ¬¡åˆ’åˆ†</li><li>æ¯æ¬¡å°†Bounding Volumeæœ€é•¿è½´ç æ–­</li><li>æ¯æ¬¡ä»ç¬¬<spanclass="math inline">\(n/2\)</span>ä¸ªä¸‰è§’å½¢å¤„åˆ’åˆ†(è®¡ç®—ç‰©ä½“é‡å¿ƒå¹¶ä½¿ç”¨å¿«é€Ÿé€‰æ‹©ç®—æ³•<spanclass="math inline">\(O(n)\)</span>å®ç°.å¿«é€Ÿåˆ’åˆ†ç®—æ³•å€ŸåŠ©å¿«é€Ÿæ’åºæ€æƒ³å®ç°äº†æŸ¥æ‰¾ç¬¬<spanclass="math inline">\(n\)</span>å¤§çš„æ•°:åœ¨å¿«æ’æ¯æ¬¡æ‰¾åˆ°ä¸­é—´èŠ‚ç‚¹æ—¶åªæŸ¥æ‰¾è‡ªå·±éœ€è¦çš„é‚£ä¸€åŠ)</li><li>å½“åŒ…å›´çš„èŠ‚ç‚¹æ•°è¶³å¤Ÿå°‘æ—¶åœæ­¢(æ¯”å¦‚5ä¸ª)</li></ul></li></ul><h2 id="lecture-14-ray-tracing---è¾å°„åº¦é‡å­¦">Lecture 14 Ray Tracing -è¾å°„åº¦é‡å­¦</h2><p>è¾å°„åº¦é‡å­¦: ç²¾ç¡®æè¿°å…‰ç›¸å…³ç‰©ç†é‡çš„æ–¹æ³•ä¸å•ä½,å®šä¹‰äº†å…‰ç…§åœ¨ç©ºé—´ä¸­çš„å±æ€§</p><p><strong>Radiant Energy and Flux(Power)</strong></p><p>Radiant Energy: ç”µç£è¾å°„å‡ºçš„èƒ½é‡, ç‰©ç†é‡<spanclass="math inline">\(Q\)</span>, å•ä½<spanclass="math inline">\(J\)</span></p><p>Radiant Flux(Power): å•ä½æ—¶é—´çš„èƒ½é‡ç±»ä¼¼åŠŸç‡, ç‰©ç†é‡<spanclass="math inline">\(\Phi = \frac{dQ}{dt}\)</span>, å•ä½<spanclass="math inline">\(W\)</span>æˆ–<spanclass="math inline">\(lm\)</span>(æµæ˜, å…‰å­¦ä¸“ç”¨)</p><p><strong>Radiant Intensity</strong></p><p>æè¿°è¾å°„æºçš„ç‰©ç†é‡, è¡¨ç¤º<strong>å•ä½ç«‹ä½“è§’(unit solidangle)å‘å‡º</strong>çš„åŠŸç‡ <span class="math display">\[I(\omega) = \frac{d\Phi}{d\omega}\]</span> å•ä½<span class="math inline">\(\frac{lm}{sr} = cd\)</span>,å…¶ä¸­ä½ <span class="math inline">\(sr\)</span>ä¸ºç«‹ä½“è§’å•ä½</p><p>å•ä½ç«‹ä½“è§’/å¾®åˆ†ç«‹ä½“è§’</p><ul><li><p>åœ¨äºŒç»´å›¾å½¢ä¸­, ç”¨å¼§åº¦æè¿°äºŒç»´è§’, ä¸”<spanclass="math inline">\(\theta = \frac{l}{r}\)</span></p></li><li><p>åœ¨ä¸‰ç»´å›¾å½¢ä¸­, ç”¨ç«‹ä½“è§’æè¿°ä¸‰ç»´è§’, ä¸”<spanclass="math inline">\(\Omega = \frac{A}{r^2}\)</span>, Aä¸ºæŠ•å°„çƒé¢ç§¯</p><p><img src="./img/14-1.png" /></p><p>é¢ç§¯è®¡ç®—(åˆ©ç”¨çƒåæ ‡ç³»ç»Ÿ) <span class="math display">\[dA = r^2 \sin\theta\ d\theta\ d\phi\]</span> å•ä½ç«‹ä½“è§’å°±æ˜¯<spanclass="math inline">\(å•ä½é¢ç§¯/r^2\)</span>, <spanclass="math inline">\(d\omega = dA/r^2=\sin\theta\ d\theta\d\phi\)</span></p></li><li><p>çƒä½“ç«‹ä½“è§’ä¸º<spanclass="math inline">\(4\pi\)</span>(è®¾ä¸€ä¸ªåŠå¾„ä¸º1çš„çƒ,ç«‹ä½“è§’å’Œä¸ºé¢ç§¯)</p></li></ul><p><strong>Irradiant</strong></p><p>æè¿°è¾å°„æ¥æ”¶è€…çš„ç‰©ç†é‡, è¡¨ç¤º<strong>å•ä½é¢ç§¯æ¥å—</strong>çš„åŠŸç‡</p><p>ç‰©ç†é‡<span class="math inline">\(E\)</span>, å•ä½<spanclass="math inline">\(\frac{lm}{m^2}=lux\)</span></p><p>æ­¤å¤„çš„å•ä½é¢ç§¯ä¸ºä¸å…¥å°„å…‰çº¿<strong>å‚ç›´</strong>çš„å•ä½é¢ç§¯,è‹¥ä¸å‚ç›´åˆ™è®¡ç®—å‚ç›´åˆ†é‡<span class="math inline">\(E =\frac{\Phi}{A}\cos\theta\)</span></p><p><strong>Radiance</strong></p><p>æè¿°å…‰çº¿çš„ç©ºé—´å±æ€§,è¡¨ç¤º<strong>å•ä½ç«‹ä½“è§’å•ä½æŠ•å½±é¢ç§¯</strong>ä¸Šçš„åŠŸç‡ <spanclass="math display">\[L(p,\omega) = \frac{d^2\Phi(p,\omega)}{d\omega \cos\theta}\]</span> <img src="./img/14-2.png" /></p><p>è€ƒè™‘å…‰çº¿ä»ä¸€ä¸ªå¾ˆå°çš„è¡¨é¢è¾å°„å‡º,å¹¶ä¸”åœ¨ä¸€ä¸ªç‚¹ä¸Šå‘å››é¢å…«æ–¹æŠ•å°„å…¶åœ¨å•ä½ç«‹ä½“è§’è¾å°„å‡ºåŠŸç‡å°±æ˜¯Radiance</p><p>è¿˜å¯ä»¥åˆ†ä¸ºIncident Radianceä¸Exiting Radiance,åˆ†åˆ«è¡¨ç¤ºå°„å…¥ä¸å‘å‡ºçš„èƒ½é‡</p><p>å¯ä»¥è¿™æ ·ç†è§£</p><ul><li>Irradiant: å•ä½é¢ç§¯è€Œæ”¶åˆ°çš„åŠŸç‡</li><li>Radiance: å•ä½é¢ç§¯å•ä½æ–¹å‘æ”¶åˆ°çš„åŠŸç‡</li></ul><h2 id="lecture-15-ray-tracing---å…‰çº¿ä¼ æ’­">Lecture 15 Ray Tracing -å…‰çº¿ä¼ æ’­</h2><p><strong>Bidirectional Reflectance Distribution Function (BRDF)åŒå‘åå°„åˆ†å¸ƒå‡½æ•°</strong></p><p>BRDFå‡½æ•°æè¿°å…¥å°„å…‰çº¿åœ¨ç‰©ä½“è¡¨é¢çš„ä¸åŒæ–¹å‘çš„èƒ½é‡åå°„åˆ†å¸ƒ.å¯ä»¥å°†åå°„ç†è§£ä¸ºç‰©ä½“è¡¨é¢å¸æ”¶äº†æ‰€æœ‰å…¥å°„å…‰åå°†ä¸€éƒ¨åˆ†å…‰å†å‘å°„å‡ºå»çš„è¿‡ç¨‹</p><p><img src="./img/15-1.png" /></p><ul><li><p>å•ä½è¡¨é¢å¸æ”¶çš„ä»<spanclass="math inline">\(\omega_i\)</span>æ–¹å‘å°„å…¥èƒ½é‡: <spanclass="math inline">\(dE(\omega_i) = L(\omega_i)\cos\theta_i\d\omega_i\)</span></p></li><li><p>BRDFå‡½æ•°å®šä¹‰å•ä½è¡¨é¢åœ¨<spanclass="math inline">\(\omega_r\)</span>æ–¹å‘åå°„èƒ½é‡å æ¥æ”¶èƒ½é‡å æ¯”(BRDFåœ¨æ¯ä¸ªåå°„æ–¹å‘å…·ä½“å€¼ç”±ç‰©ä½“æè´¨å†³å®š)<span class="math display">\[f_r(\omega_i\to \omega_r) = \frac{dL_r(\omega_r)}{dE_i(\omega_i)} =\frac{dL_r(\omega_r)}{L_i(\omega_i)\cos\theta_id\omega_i}\]</span></p></li><li><p>ç‰©ä½“è¡¨é¢ä»ä»»æ„æ–¹å‘æ¥æ”¶å…‰çº¿åœ¨æŸä¸€è§’åº¦åå°„å…‰(å¯¹æ¯ä¸ªå…¥å°„æ–¹å‘ç§¯åˆ†)<span class="math display">\[L_r(p, \omega_r) = \int_{H^2}f_r(p,\omega_i\to\omega_r)L_i(p,\omega_i)\cos\theta_i\ d\omega_i\]</span></p></li><li><p>ä¸Šé¢è¿™ä¸ªæ–¹ç¨‹ä»…è€ƒè™‘äº†ä»ä¸åŒå…‰æºç…§å‘ç‰©ä½“çš„åå°„å…‰,æ²¡æœ‰è€ƒè™‘é—´æ¥åå°„</p></li></ul><p><strong>æ¸²æŸ“æ–¹ç¨‹(Rendering Equation)</strong></p><p>åŒæ—¶è€ƒè™‘åå°„å…‰ä¸ç‰©ä½“æœ¬èº«å‘å‡ºçš„å…‰</p><p><span class="math display">\[L_o(p, \omega_o) =L_r(p, \omega_o) + \int_{\Omega^+}f(p,\omega_i,\omega_o)L_i(p,\omega_i)(n\cdot\omega_i)\ d\omega_i\]</span> å¯¹äºé¢å…‰æº: å¯ä»¥å¯¹é¢å…‰æºè¦†ç›–çš„æ¯ä¸ªç«‹ä½“è§’åšç§¯åˆ†</p><p>å¯¹äºäºŒæ¬¡åå°„: å¯ä»¥å°†åå°„æ¥å…‰çš„ç‰©ä½“å½“ä½œä¸€ä¸ªé¢å…‰æºå¤„ç†</p><p>å¯ä»¥åœ¨æ•°å­¦å½¢å¼ä¸Šç®€åŒ–æˆç®—å­å¾®åˆ†æ–¹ç¨‹ <span class="math display">\[L(u) = e(u) + \int L(v)K(u,v)\ dv=E+KL\]</span> <span class="math inline">\(K\)</span>æ˜¯å…¥å°„èƒ½é‡, <spanclass="math inline">\(L\)</span>æ˜¯æŸç‚¹è¾å°„èƒ½é‡ç®—å­,åº”ç”¨æ³°å‹’å±•å¼€æ±‚å¾—<spanclass="math inline">\(L=E+KE+K^2E+K^3E+...\)</span></p><p>å¯ä»¥ç†è§£æˆç‚¹å‘å‡ºçš„èƒ½é‡<spanclass="math inline">\(L=\)</span>è¯¥ç‚¹ç›´æ¥å‘å‡ºçš„èƒ½é‡<spanclass="math inline">\(E+\)</span>å…‰æºä¸€æ¬¡åå°„èƒ½é‡<spanclass="math inline">\(KE+\)</span>ä¸¤æ¬¡åå°„èƒ½é‡<spanclass="math inline">\(K^2E+...\)</span></p><h2 id="lecture-16-ray-tracing---è’™ç‰¹å¡æ´›è·¯å¾„è¿½è¸ª">Lecture 16 RayTracing - è’™ç‰¹å¡æ´›è·¯å¾„è¿½è¸ª</h2><p><strong>è’™ç‰¹å¡æ´›ç§¯åˆ†</strong></p><p>æ±‚å®šç§¯åˆ†æ—¶çš„å¸¸è§æ€è·¯æ˜¯å…ˆæ±‚ä¸å®šç§¯åˆ†, å†é€šè¿‡ä¸Šä¸‹ç•Œè·å¾—å®šç§¯åˆ†.ä½†æ˜¯å½“å‡½æ•°è¾ƒä¸ºå¤æ‚æ—¶, ä¸å®šç§¯åˆ†ä¸æ˜“æ±‚è§£. è’™ç‰¹å¡æ´›ç§¯åˆ†æ˜¯å¦ä¸€ç§ç§¯åˆ†æ–¹æ³•.åœ¨ç§¯åˆ†åŒºé—´ä¸­éšæœºå–å‡ ä¸ªæ•°åŠå…¶å¯¹åº”çš„<spanclass="math inline">\(f(x)\)</span>, æ±‚è¿™å‡ ä¸ª<spanclass="math inline">\(f(x)\)</span>çš„å‡å€¼, è®¤ä¸ºå®šç§¯åˆ†å¯ä»¥è¿‘ä¼¼æˆ <spanclass="math display">\[\int f(x)dx = \frac{1}{N}\sum_{i=1}^N\frac{f(X_i)}{p(X_i)}\]</span> <span class="math inline">\(p(X_i)\)</span>ä¸ºä¸€ä¸ªéšæœºå˜é‡<spanclass="math inline">\(X_i\)</span>åœ¨é‡‡æ ·æ—¶è¢«é€‰ä¸­çš„æ¦‚ç‡,å½“éšæœºå˜é‡å‡åŒ€åœ¨<spanclass="math inline">\([a,b]\)</span>é‡‡æ ·æ—¶å¯ä»¥è®¤ä¸º<spanclass="math inline">\(p(X_i)=\frac{1}{b-a}\)</span>. <spanclass="math display">\[\int_a^b f(x)dx =  \frac{b-a}{N}\sum_{i=1}^Nf(X_i)\]</span> <strong>è·¯å¾„è¿½è¸ª</strong></p><p>Whitted-Style Ray Tracingçš„æ€æƒ³æ˜¯æ— é™å¼¹å°„"æ„ŸçŸ¥å…‰çº¿",æ¯æ¬¡è®°å½•åå°„ç‚¹é¢œè‰². å­˜åœ¨é—®é¢˜</p><ul><li><p>ä¸èƒ½è®¤ä¸ºå…‰çº¿åœ¨ç‰©ä½“è¡¨é¢å‘ç”Ÿå®Œç¾é•œé¢åå°„</p></li><li><p>å°†åå°„ç‚¹ç›´æ¥ä¸å…‰æºç›¸è¿æ²¡æœ‰è€ƒè™‘æ¼«åå°„(æ³¨æ„ä¸‹å›¾å¤©èŠ±æ¿ä¸ç«‹æ–¹ä½“ä¾§è¾¹æ˜ å°„çš„å¢™é¢é¢œè‰²)</p><p><img src="./img/16-1.png" /></p></li></ul><p>å¯ä»¥é‡‡ç”¨å›¾åƒåº¦é‡å­¦æ–¹æ³•å–ä»£Ray Tracing. éœ€è¦åšçš„å°±æ˜¯è§£å‡ºæ¸²æŸ“æ–¹ç¨‹ <spanclass="math display">\[L_o(p,\omega_0) =L_e(p,\omega_0)+\int_{\Omega^+}L_i(p,\omega_i)f_r(p,\omega_i,\omega_o)(n\cdot \omega_i)\ d\omega_i\]</span> <strong>å®ç°</strong></p><ul><li>å®šç§¯åˆ†æ±‚è§£: è’™ç‰¹å¡æ´›ç§¯åˆ†, åœ¨ä¸åŒæ–¹å‘ä¸Šé‡‡æ ·, é‡‡æ ·åŒºé—´æ˜¯ä¸€ä¸ªåŠçƒ,<span class="math inline">\(p(\omega) =1/2\pi\)</span>(åŠçƒé¢ç«‹ä½“è§’æ˜¯<spanclass="math inline">\(2\pi\)</span>). åœ¨ä»£ç å®ç°æ—¶,åªéœ€è¦ä»ç€è‰²ç‚¹å‘å‡º<span class="math inline">\(N\)</span>æ¡å…‰, æ±‚<spanclass="math inline">\(\frac{1}{N}\sum_{i=1}^n\frac{L_i(p,\omega_i)f_r(p,\omega_i,\omega_o)(n\cdot\omega_i)}{p(\omega_i)}\)</span></li><li>é—´æ¥å…‰ç…§<span class="math inline">\(L\)</span>çš„é€’å½’å®šä¹‰:å¯ä»¥æŠŠé—´æ¥å…‰ç…§çš„åå°„ç‰©ä½“å½“ä½œå…‰æº, è®¡ç®—ä»ç€è‰²ç‚¹çœ‹å‘åå°„ç‚¹çš„é¢œè‰²</li></ul><pre class="line-numbers language-none"><code class="language-none">shade(p, wo)    Randomly choose N directions wi~pdf    Lo &#x3D; 0.0    For each wi        Trace a ray r(p, wi)        If ray r hit the light        Lo +&#x3D; (1 &#x2F; N) * L_i * f_r * cosine &#x2F; pdf(wi)        Else If ray r hit an object at q        Lo +&#x3D; (1 &#x2F; N) * shade(q, -wi) * f_r * cosine &#x2F; pdf(wi)    Return Lo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>é—®é¢˜</strong></p><ul><li><p>é€šè¿‡è¿™ç§æ–¹å¼æ±‚çš„é—´æ¥å…‰ç…§æ—¶,æ¯æ¬¡æ±‚é—´æ¥å…‰ç…§éƒ½è¦åšä¸€ä¸ªè’™ç‰¹å¡æ´›ç§¯åˆ†é‡‡æ ·(å¦‚å›¾, å‡è®¾ä¸€æ¬¡ç§¯åˆ†é‡‡æ ·100ä¸ªç‚¹,è‹¥è¿™100ä¸ªç‚¹éƒ½æ‰“åˆ°å…¶ä»–ç‰©ä½“ä¸Š, ç»è¿‡<spanclass="math inline">\(n\)</span>æ¬¡é—´æ¥å…‰ç…§æˆ‘ä»¬éœ€è¦åš<spanclass="math inline">\(100^{n+1}\)</span>æ¬¡)</p><p><img src="./img/16-2.png" /></p><p>è§„é¿æŒ‡æ•°çˆ†ç‚¸æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å°†åº•æ•°å˜æˆ1(æ¯æ¬¡å®šç§¯åˆ†åªéšæœºé‡‡ä¸€ä¸ªç‚¹).è¿™ä¼šäº§ç”Ÿå™ªéŸ³(éšæœºé‡‡æ ·ç‚¹é€‰çš„ä¸å¥½), ä½†æ˜¯åªè¦ç©¿è¿‡ä¸€ä¸ªåƒç´ ç‚¹çš„eyerayè¶³å¤Ÿå¯†é›†å°±å¯ä»¥é¿å…è¿™ä¸€é—®é¢˜(å¦‚å›¾, æˆ‘ä»¬å‘å‡ºè¶³å¤Ÿå¯†çš„eye ray,ä½†æ˜¯æ¯æ¬¡é—´æ¥åå°„æ—¶åªåå°„ä¸€æ¬¡)</p><p><img src="./img/16-3.png" /></p><p><strong>é‡‡æ ·æ•°<spanclass="math inline">\(N=1\)</span>çš„æ¸²æŸ“æ–¹ç¨‹å®ç°å°±æ˜¯è·¯å¾„è¿½è¸ª</strong></p></li><li><p>æ²¡æœ‰å®šä¹‰é€’å½’è¾¹ç•Œ</p><p>å…‰çº¿æ˜¯æ— é™å¼¹å°„çš„(è™½ç„¶æœ‰æŸè€—, ä½†æ˜¯èƒ½é‡ä¸€å®šä¸ä¼šé™ä¸º0, ä¸€å®šæ˜¯æ— é™å¼¹å°„),è®¡ç®—æœºä¸­ä¸èƒ½è¿™æ ·. äººä»¬å¼•å…¥äº†ä¿„ç½—æ–¯è½®ç›˜èµŒ(Russian Roulette)çš„æ€æƒ³:æ¯æ¬¡å¼¹å°„æ—¶ä»¤å…‰æœ‰<span class="math inline">\(p\)</span>çš„æ¦‚ç‡ç»§ç»­å¼¹å°„,è‹¥éšæœºåˆ°<spanclass="math inline">\(p\)</span>èŒƒå›´å†…åˆ™ç»§ç»­å¼¹å°„å¹¶å°†å¼¹å°„ç»“æœ<spanclass="math inline">\(/p\)</span>è¿”å›, è‹¥éšæœºåˆ°<spanclass="math inline">\(1-p\)</span>ç€ç›´æ¥è¿”å›<spanclass="math inline">\(0\)</span>, é€’å½’æ‰§è¡Œåå…¶è¿”å›å€¼æ•°å­¦æœŸæœ›<spanclass="math inline">\(E = P*(Lo/P)+(1-P)*0 = Lo\)</span></p></li></ul><p>åº”ç”¨ä¸Šè¿°æ”¹è¿›</p><pre class="line-numbers language-none"><code class="language-none">shade(p, wo)    Manually specify a probability P_RR    Randomly select ksi in a uniform dist. in [0, 1]     # è½®ç›˜èµŒ    If (ksi &gt; P_RR) return 0.0;    Randomly choose ONE direction wi~pdf(w)              # N&#x3D;1çš„è·¯å¾„è¿½è¸ª    Trace a ray r(p, wi)    If ray r hit the light    Return L_i * f_r * cosine &#x2F; pdf(wi) &#x2F; P_RR    Else If ray r hit an object at q    Return shade(q, -wi) * f_r * cosine &#x2F; pdf(wi) &#x2F; P_RRray_generation(camPos, pixel)    Uniformly choose N sample positions within the pixel    pixel_radiance &#x3D; 0.0    For each sample in the pixel        Shoot a ray r(camPos, cam_to_sample)        If ray r hit the scene at p        pixel_radiance +&#x3D; 1 &#x2F; N * shade(p, sample_to_cam)    Return pixel_radiance<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è·¯å¾„è¿½è¸ªå¹¶ä¸é«˜æ•ˆ, ä¸€æ—¦é‡‡æ ·ç‡(ç©¿è¿‡ä¸€ä¸ªåƒç´ çš„eye ray, Samples PerPixel/SPP)è¿‡ä½, å°±ä¼šå› ä¸º<spanclass="math inline">\(N=1\)</span>äº§ç”Ÿå™ªéŸ³</p><p><img src="./img/16-4.png" /></p><p>å¦‚æœæˆ‘ä»¬å¯ä»¥æé«˜é‡‡æ ·çº¿å‘½ä¸­å…‰æºçš„æ¦‚ç‡å°±å¯ä»¥å‡å°‘SPP,è¿™éœ€è¦ä¿®æ”¹ä¹‹å‰çš„å‡åŒ€é‡‡æ ·æ¨¡å¼(åŒæ ·æ¦‚ç‡å¯†åº¦å‡½æ•°ä¹Ÿä¼šå˜): å¯ä»¥ç›´æ¥æ¢é‡‡æ ·æº,ä»å…‰æºå¤„é‡‡æ ·, å¼ºåˆ¶é‡‡æ ·æ ·æœ¬éƒ½ä»å…‰æºå¤„æ¥</p><p><img src="./img/16-5.png" /></p><p>åœ¨å…‰æºä¸Šå‡åŒ€é‡‡æ ·, å…‰æºé¢ç§¯ä¸º<span class="math inline">\(A\)</span>,é‚£ä¹ˆé‡‡æ ·<span class="math inline">\(p = 1/A\)</span>.æ¸²æŸ“æ–¹ç¨‹ä»åå°„ç‚¹é‡‡æ ·å˜æˆå…‰æºé‡‡æ ·æ¨¡å¼, å³<spanclass="math inline">\(d\omega =\frac{dA\cos\theta&#39;}{\|x&#39;-x\|^2}\)</span> <spanclass="math display">\[\begin{align}L_o(p,\omega_0) &amp;= \int_{\Omega^+}L_i(p,\omega_i)f_r(p,\omega_i,\omega_o)\cos\theta\ d\omega_i\\&amp;= \int_{A}L_i(p,\omega_i)f_r(p,\omega_i,\omega_o)\frac{\cos\theta\cos\theta&#39;}{\|x&#39;-x\|^2}\ dA\end{align}\]</span> åº”ç”¨å…‰æºé‡‡æ ·æ”¹è¿›åçš„ç®—æ³•, åœ¨æ¯æ¬¡è®¡ç®—åå°„æ—¶å°†å…‰åˆ†ä¸ºä¸¤éƒ¨åˆ†</p><ul><li>è®¡ç®—ç›´æ¥å…‰ç…§: æ¢ç§¯åˆ†åŸŸ, æ— éœ€ä½¿ç”¨RR</li><li>è®¡ç®—å¤šæ¬¡åå°„å…‰: é‡‡ç”¨ä¹‹å‰çš„ä¿„ç½—æ–¯è½®ç›˜èµŒ</li></ul><pre class="line-numbers language-none"><code class="language-none">shade(p, wo)    # Contribution from the light source.    L_dir  &#x3D; 0.0    Uniformly sample the light at xâ€™ (pdf_light &#x3D; 1 &#x2F; A)    Shoot a ray from p to x&#39;    If the ray is not blocked in the middle# é˜²æ­¢ç‰©ä½“é®æŒ¡    L_dir &#x3D; L_i * f_r * cos Î¸ * cos Î¸â€™ &#x2F; |xâ€™ - p|^2 &#x2F; pdf_light    # Contribution from other reflectors. è¿˜æ˜¯åŸæ¥çš„ä¿„ç½—æ–¯è½®ç›˜èµŒ    L_indir &#x3D; 0.0    Test Russian Roulette with probability P_RR    Uniformly sample the hemisphere toward wi (pdf_hemi &#x3D; 1 &#x2F; 2pi)    Trace a ray r(p, wi)    If ray r hit a non-emitting object at q    L_indir &#x3D; shade(q, -wi) * f_r * cos Î¸ &#x2F; pdf_hemi &#x2F; P_RR    Return L_dir + L_indir<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å­˜åœ¨çš„å…¶ä»–é—®é¢˜: éš¾ä»¥å¦‚ä½•å¤„ç†ç‚¹å…‰æº(<spanclass="math inline">\(dA\)</span>å¤ªå°äº†)</p><p><strong>æ³¨æ„è’™ç‰¹å¡æ´›ç§¯åˆ†, ä¿„ç½—æ–¯è½®ç›˜èµŒæ€æƒ³å’Œé™ä½SPPæ–¹æ³•</strong></p><p><strong>è·¯å¾„è¿½è¸ªåçš„å·¥ä½œ</strong></p><ul><li>å¦‚ä½•å¯¹çƒä½“è¿›è¡Œå‡åŒ€é‡‡æ ·: é‡‡æ ·ç†è®º</li><li>å¦‚ä½•å¯¹ç‰¹å®šå½¢çŠ¶è®¾è®¡å¥½çš„é‡‡æ ·æ–¹æ³•ä¸pdf(é™¤äº†å…‰æºé‡‡æ ·): é‡è¦æ€§é‡‡æ ·</li><li>å¦‚ä½•è¯„ä»·éšæœºæ•°ç”Ÿæˆè´¨é‡(å‡åŒ€åˆ†å¸ƒ, ç›¸é‚»éšæœºæ•°ä¹‹é—´è·ç¦»):ä½å·®å¼‚åŒ–åºåˆ—</li><li>å¦‚ä½•ç»“åˆåŠçƒé‡‡æ ·ä¸å…‰æºé‡‡æ ·: å¤šé‡é‡è¦æ€§é‡‡æ ·(MIS)</li><li>é€šè¿‡ä¸€ä¸ªåƒç´ çš„eye rayså¦‚ä½•åŠ æƒå¾—åˆ°æ‰“åœ¨åƒç´ çš„èƒ½é‡</li><li>åƒç´ çš„é¢œè‰²å¦‚ä½•ç¡®å®š(è·¯å¾„è¿½è¸ªçš„ç»“æœæ˜¯"åŠŸç‡", åŠŸç‡ä¸é¢œè‰²å¹¶éçº¿æ€§å¯¹åº”):ä¼½ç›çŸ«æ­£, é¢œè‰²ç©ºé—´</li></ul><p><strong>å…¶ä»–å¹¿ä¹‰å…‰è¿½ç®—æ³•</strong></p><ul class="task-list"><li><input type="checkbox" checked="" />Whitted-style ray tracing</li><li><input type="checkbox" checked="" />path tracing</li><li><input type="checkbox" />å•å‘path-tracing</li><li><input type="checkbox" />åŒå‘path-tracing</li><li><input type="checkbox" />å…‰å­æ˜ å°„</li><li><input type="checkbox" />Metropolis å…‰çº¿ä¼ è¾“</li><li><input type="checkbox" />VCM</li><li><input type="checkbox" />UPBP(å¤§æ‚çƒ©)</li></ul><h2 id="lecture-17-materials-and-appearances">Lecture 17 Materials andAppearances</h2><p>ç ”ç©¶é—®é¢˜: å…‰ç…§ä¸æè´¨ä¹‹é—´çš„ä½œç”¨, å®é™…ä¸Šå°±æ˜¯ç ”ç©¶æè´¨çš„BRDFå‡½æ•°</p><p><strong>å‹ƒæœ—æè´¨(Lambertian Material)</strong></p><p>å‹ƒæœ—æè´¨è‡ªå·±ä¸å‘å…‰, ä¸”åªå‘ç”Ÿæ¼«åå°„.</p><p><img src="./img/17-1.png" /></p><p>å½“å…¥å°„å…‰å‡åŒ€æ‰“åœ¨ç‰©ä½“ä¸Š, æ ¹æ®èƒ½é‡å®ˆæ’å¯ä»¥å¾—åˆ° <spanclass="math display">\[\begin{align}L_o(\omega_o) &amp;= \int_{H^2}f_rL_i(\omega_i)\cos\theta_i\ d\omega_i\\&amp;=f_rL_i\int_{H^2}\cos\theta_i\ d\omega_i\\&amp;=\pi f_rL_i\\f_r = \frac{1}{\pi}\end{align}\]</span> äºæ˜¯æ¼«åå°„ç³»æ•°<span class="math inline">\(f_r =\frac{\rho}{\pi}\)</span>,å…¶ä¸­<spanclass="math inline">\(\rho\)</span>ä¸ºåå°„ç‡(albedo, å¯ä»¥æ˜¯é¢œè‰²å‘é‡,ä¹Ÿå¯ä»¥æ˜¯å€¼)</p><p><strong>å…‰é¢æè´¨(Glossy material)</strong></p><p>æœ‰é•œé¢åå°„, ä½†æ˜¯æœ‰æ²¡æœ‰é‚£ä¹ˆå…‰æ»‘çš„æè´¨. ä¾‹å¦‚é“œ, é“</p><p><img src="./img/17-2.png" /></p><p><strong>ç†æƒ³åå°„/æŠ˜å°„ææ–™(Ideal reflective / refractivematerial)</strong></p><p>åŒæ—¶å­˜åœ¨å…‰çº¿åå°„ä¸æŠ˜å°„. ä¾‹å¦‚æ°´, ç»ç’ƒ</p><p><img src="./img/17-3.png" /></p><p><strong>åå°„</strong></p><ul><li>åˆ©ç”¨å‘é‡è¡¨ç¤º: <span class="math inline">\(\omega_i + \omega_o = 2(\omega_i\cdot n)n\)</span></li><li>åˆ©ç”¨ä»°è§’è¡¨ç¤º: <span class="math inline">\(\Phi_o = (\Phi_i + \pi)\mod\ 2\pi\)</span></li></ul><p><strong>æŠ˜å°„</strong></p><p>Snellå®šç†: ä¸åŒçš„æè´¨æœ‰ä¸åŒæŠ˜å°„ç‡(çœŸç©º1, æ°´1.33),å…¥å°„è§’æ­£å¼¦ä¸æŠ˜å°„è§’æ­£å¼¦æŠ˜å°„ç‡ç›¸ä¹˜ç›¸ç­‰. <spanclass="math inline">\(\eta_i\sin\theta_i =\eta_t\sin\theta_t\)</span></p><p><img src="./img/17-4.png" /></p><p>è‹¥å°„å‡ºæè´¨æŠ˜å°„ç‡å°äºå°„å…¥æè´¨æŠ˜å°„ç‡, åˆ™ä¸å‘ç”ŸæŠ˜å°„(å³å…¨åå°„),BRDFå‡½æ•°è¡¨ç¤ºå›ºå®šå…¥å°„å…‰åœ¨ä¸åŒè§’åº¦åå°„åˆ†å¸ƒ,ç±»æ¯”æœ‰BTDFå‡½æ•°è¡¨ç¤ºå›ºå®šå…¥å°„å…‰çº¿åœ¨ä¸åŒè§’åº¦æŠ˜å°„åˆ†å¸ƒ, ä¸¤è€…ç»Ÿç§°ä¸ºBSDF</p><p><strong>è²æ¶…è€³é¡¹(Fresnel Reflection / Term)</strong></p><p>åœ¨åŒæ—¶å‘ç”Ÿé•œé¢åå°„ä¸æŠ˜å°„æè´¨ä¸Š, å…¥å°„è§’(åå°„è§’)è§’åº¦ä¸åŒ,å‘ç”Ÿåå°„ä¸æŠ˜å°„å…‰çº¿çš„æ¯”ä¾‹ä¸åŒ, å…¥å°„è§’ä¸ç‰©ä½“å‡ ä¹å¹³è¡Œæ—¶, æ›´å¤šçš„å…‰ä¼šè¢«åå°„,å…¥å°„è§’ä¸ç‰©ä½“å‚ç›´æ—¶æ›´å¤šçš„å…‰ä¼šæŠ˜å°„. å®šä¹‰æŠ˜å°„ä¸åå°„å…‰çš„æ¯”ä¾‹ä¸ºè²æ¶…è€³é¡¹</p><ul><li><p>ç»ç¼˜ä½“çš„å¤§è‡´è²æ¶…è€³é¡¹(çº¢çº¿)</p><p><img src="./img/17-5.png" /></p></li><li><p>å¯¼ä½“çš„å¤§è‡´è²æ¶…è€³é¡¹(çº¢çº¿)</p><p><img src="./img/17-6.png" /></p></li></ul><p>å¯ä»¥çœ‹åˆ°å¯¼ä½“åœ¨ä¸åŒè§’åº¦ä¸Šè²æ¶…è€³é¡¹éƒ½å¾ˆé«˜, æ‰€ä»¥æˆ‘ä»¬ç”¨é“œç­‰å¯¼ä½“åšé•œå­,è€Œä¸æ˜¯ç”¨ä¸ç»¸, ç»ç’ƒç­‰ç»ç¼˜ä½“</p><p>æˆ‘ä»¬éœ€è¦è®¡ç®—å…¥å°„è§’ä¸º<spanclass="math inline">\(\theta\)</span>æ—¶çš„åå°„ç‡, ä½†æ˜¯è²æ¶…è€³é¡¹ä¸å¥½ç®—,å¯ä»¥é‡‡ç”¨Schlick's Approximation è¿‘ä¼¼å¾—åˆ° <span class="math display">\[R(\theta) = R_0+(1-R_0)(1-\cos\theta)^5 \\R_0 = \left(\frac{\eta_i-\eta_t}{\eta_i+\eta_t}\right)^2\]</span> å…¶ä¸­<span class="math inline">\(R_0\)</span>ä¸ºåœ¨0åº¦æ—¶çš„åå°„ç‡,ä¹Ÿå«åŸºå‡†åå°„ç‡(<span class="math inline">\(n_1,n_2\)</span>ä¸æè´¨ç›¸å…³)</p><p><strong>å¾®è¡¨é¢æè´¨(Microfacet Material)</strong></p><p>å½“ä»è§‚å¯Ÿç‚¹ç¦»è¡¨é¢è¶³å¤Ÿè¿œ,æˆ‘ä»¬å°±çœ‹ä¸åˆ°ç‰©ä½“ä¸ç‰©ä½“ä¸Šçš„å‡¹(macrosurface)å‡¸(microsurface)é¢,è¿™äº›å‡¹å‡¸çš„å‡ ä½•ä½“å…±åŒå½¢æˆäº†ç‹¬ç‰¹çš„æè´¨,è§‚å¯Ÿè€…åªèƒ½çœ‹åˆ°å…‰åœ¨è¡¨é¢å½¢æˆçš„åå°„(å¦‚ä¸‹å›¾, é«˜å…‰åŒºä¸åªèƒ½çœ‹åˆ°å…‰,çœ‹ä¸åˆ°å…·ä½“çš„ç‰©ä½“)</p><p><img src="./img/17-7.png" /></p><p>å¯ä»¥ç”¨ç‰©ä½“è¡¨é¢å‘ç°åˆ†å¸ƒåº¦é‡æè´¨, å½“ç‰©ä½“è¡¨é¢æ³•çº¿å‘ˆç°ä¸€è‡´åˆ†å¸ƒæ—¶,ç‰©ä½“å‘ˆç°å…‰é¢æè´¨, å½“ç‰©ä½“è¡¨é¢æ³•çº¿å‘ˆç°ä¸ä¸€è‡´åˆ†å¸ƒæ—¶, ç‰©ä½“å‘ˆç°æ¼«åå°„æè´¨</p><p><img src="./img/17-8.png" /></p><p>å®šä¹‰å¾®è¡¨é¢ä¸Šçš„BRDF: <span class="math display">\[f(i,o) = \frac{F(i,h)G(i,o,h)D(h)}{4(n,i)(n,o)}\]</span></p><ul><li><span class="math inline">\(F(i,h)\)</span>ä¸ºè²æ¶…è€³é¡¹</li><li><span class="math inline">\(h\)</span>è¡¨ç¤ºå°„å‡ºå…¥å‘é‡çš„åŠç¨‹å‘é‡</li><li><span class="math inline">\(D(h)\)</span>è¡¨ç¤ºæ³•çº¿åœ¨<spanclass="math inline">\(h\)</span>æ–¹å‘çš„åˆ†å¸ƒ(æˆ‘ä»¬è®¤ä¸ºå¾®è¡¨é¢æ˜¯é•œé¢åå°„,åªæœ‰åå°„é¢å‘ç°ä¸åŠç¨‹å‘é‡åŒå‘æ—¶æ‰ä¼šå‘ç”Ÿåå°„)</li><li><spanclass="math inline">\(G(i,o,h)\)</span>ç”¨äºç‰©ä½“è¡¨é¢çš„è‡ªé®æŒ¡/æŠ•å½±çº¿æ€§(ä¸€ä¸ªå°çªèµ·æŠŠå…‰çº¿æŒ¡ä½äº†)ä¿®æ­£,è¿™ç§ç°è±¡å¸¸å‘ç”Ÿäºå…‰çº¿å‡ ä¹ä¸ç‰©ä½“å¹³è¡Œå°„å…¥(graazing angle),æ­£å¸¸æƒ…å†µä¸‹è‡ªé®æŒ¡ä¼šå¯¼è‡´è¾¹ç¼˜è¿‡äº®. æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°ä¿®æ­£</li></ul><p><strong>å„å‘å¼‚æ€§(Anisotropic)ä¸å„é¡¹åŒæ€§(Isotropic)æè´¨Materials</strong></p><ul><li>å„å‘åŒæ€§: ç‰©ä½“å¾®è¡¨é¢ä¸å­˜åœ¨æ–¹å‘æ€§(æ³•çº¿åˆ†å¸ƒå‡åŒ€), æ»¡è¶³<spanclass="math inline">\(f_r(\theta_i,\Phi_i;\theta_r,\Phi_r) =f_r(\theta_i,\Phi_i;\theta_r,\Phi_r - \Phi_i)\)</span>, å³æ—‹è½¬æ–¹ä½è§’,BRDFä¸å˜</li><li>å„å‘å¼‚æ€§: æ³•çº¿åˆ†å¸ƒåœ¨ç‰¹æ®Šæ–¹å‘, æ»¡è¶³<spanclass="math inline">\(f_r(\theta_i,\Phi_i;\theta_r,\Phi_r) \neqf_r(\theta_i,\Phi_i;\theta_r,\Phi_r - \Phi_i)\)</span>, å³æ—‹è½¬æ–¹ä½è§’,BRDFå˜</li></ul><p><strong>BRDFæ€§è´¨</strong></p><ul><li>å‡½æ•°å€¼éè´Ÿ</li><li>å¯åŠ æ€§</li><li>å…‰è·¯å¯é€†æ€§</li><li>èƒ½é‡ä¸å¢(BRDFå’Œå°äº1)</li><li>å¯¹äºå„é¡¹åŒæ€§æè´¨: å¯ä»¥å¿½ç•¥BRDFå…¥å°„è§’</li></ul><p><strong>BRDFæµ‹é‡</strong></p><p>å¯ä»¥ç›´æ¥ç”¨æœºå™¨æµ‹é‡ä¸åŒå‡ºå…¥å°„è§’çš„BRDF, ä½†æ˜¯å››ç»´å‡½æ•°æµ‹é‡å¾ˆæ…¢,å¯ä»¥åˆ©ç”¨å…‰è·¯å¯é€†æ€§å‡å°‘æµ‹é‡é‡, ä¹Ÿå¯ä»¥æ ¹æ®æè´¨å„å‘åŒæ€§å‡å°‘æµ‹é‡é‡</p><h2 id="lecture-18-materials-and-appearances">Lecture 18 Materials andAppearances</h2><p><strong>é«˜çº§å…‰çº¿ä¼ æ’­</strong></p><p>è‹¥è’™ç‰¹å¡æ´›æ–¹æ³•æ±‚å¾—çš„å®šç§¯åˆ†çš„æœŸæœ›å€¼ä¸çœŸå®æœŸæœ›ä¸€æ ·,æˆ‘ä»¬å°±ç§°ä¼°è®¡æ˜¯æ— åçš„, å¦‚æœä¼°è®¡æ˜¯æœ‰åçš„,ä½†æ˜¯å½“é‡‡æ ·ç‚¹è¶³å¤Ÿå¤šæ—¶æœŸæœ›å¯ä»¥æ”¶æ•›åˆ°æ­£ç¡®å€¼æˆ‘ä»¬å°±ç§°ä¼°è®¡æ˜¯ä¸€è‡´çš„.å¸¸è§è·¯å¾„è¿½è¸ªæ–¹æ³•æœ‰</p><ul><li><p>æ— åå…‰çº¿ä¼ æ’­</p><ul><li><p>åŒå‘è·¯å¾„è¿½è¸ªBidirectional path tracing(BDPT):åˆ†åˆ«ä»å…‰æºä¸æ‘„åƒæœºå‘å‡ºå…‰, åŒæ—¶æŠ•å°„, ç§°è¿™æ ·çš„å…‰çº¿ä¸ºåŠè·¯å¾„,ä¸¤ä¸ªåŠè·¯å¾„è¿èµ·æ¥å°±æ˜¯ä¸€æ¡å…‰è·¯.åŒå‘è·¯çº¿è¿½è¸ªå¯¹äºå¤§ç‰‡è¢«é—´æ¥å…‰ç…§äº®çš„çš„åœºæ™¯æ•ˆæœå¾ˆå¥½(å› ä¸ºç›´æ¥ä»å…‰æºå¼€å§‹è¿½è¸ª)</p></li><li><p>Metropoliså…‰çº¿ä¼ æ’­Metropolis Light Transport(MLT):ä½¿ç”¨é©¬å°”ç§‘å¤«é“¾è¿›è¡Œé‡‡æ ·(æ ¹æ®ä¸€ä¸ªæ ·æœ¬è·å¾—ä¸ä¹‹ç›¸è¿‘çš„æ ·æœ¬).å¯ä»¥æ ¹æ®ä¸€æ¡è·¯å¾„ç”Ÿæˆå‘¨å›´çš„è·¯å¾„. è¯¥æ–¹å¼ç‰¹åˆ«é€‚åˆåšå¤æ‚åå°„çš„å…‰è·¯ä¼ æ’­.ç¼ºç‚¹æ˜¯å¾ˆéš¾åˆ†æç®—æ³•æ”¶æ•›æ—¶é—´</p><p><img src="./img/18-1.png" /></p></li></ul></li><li><p>æœ‰åå…‰çº¿ä¼ æ’­</p><ul><li><p>å…‰å­æ˜ å°„(Photon Mapping):é€‚åˆæ¸²æŸ“å…‰ç»è¿‡å…‰å­¦é¢èšç„¦åçš„ç»“æœä¸å¤æ‚è·¯å¾„</p><p><img src="./img/18-2.png" /></p><p>ä¸€ç§å®ç°æ–¹æ³•:</p><ol type="1"><li>ä»å…‰æºå‡ºå‘è¿½è¸ªå…‰å­, å…‰å­æ‰“å€’æ¼«åå°„é¢å°±ä¸åŠ¨äº†,è®©å…‰å­éƒ½åœåˆ°æ¼«åå°„é¢ä¸Š</li><li>ä»ç…§ç›¸æœºå‡ºå‘è¿½è¸ªå…‰å­, å…‰å­æ‰“å€’æ¼«åå°„é¢å°±ä¸åŠ¨äº†,è®©å…‰å­éƒ½åœåˆ°æ¼«åå°„é¢ä¸Š</li><li>è®¡ç®—å±€éƒ¨çš„å¯†åº¦ä¼°è®¡(ç»™ä¸€ä¸ªç‚¹, æ±‚å‘¨å›´Nä¸ªå…‰å­), å¯ä»¥ç”¨<spanclass="math inline">\(N\)</span>çš„èŒƒå›´åº¦é‡æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»€ä¹ˆ</li></ol></li><li><p>VCM: å…‰å­æ˜ å°„+åŒå‘è·¯å¾„è¿½è¸ª,åœ¨åŒå‘è·¯å¾„è¿½è¸ªæ—¶å€™è‹¥ä¸¤ä¸ªç‚¹åœ¨åŒä¸€é¢ä¸Šä¸”ç¦»å¾—è¶³å¤Ÿè¿‘,æˆ‘ä»¬å°±è®¤ä¸ºè¿™ä¸¤ä¸ªåŠè·¯å¾„ç›¸äº¤</p></li></ul></li><li><p>å®æ—¶è¾å°„åº¦Instant Radiosity (IR)</p><p>è®¤ä¸ºå·²ç»è¢«ç…§äº®çš„åœ°æ–¹æ˜¯å…‰æº, å°†å…‰æºç›´å°„åˆ°çš„åœ°æ–¹å½“ä½œæ–°å…‰æºå¹¶å–ä»£åŸå…‰æº.ä¼˜ç‚¹: å¿«, ç¼ºç‚¹: æ¥ç¼å¤„ä¼šå‡ºç°å°å…‰ç‚¹</p></li></ul><p>è™½ç„¶è¿™äº›æ–¹æ³•å¾ˆé«˜ç«¯, ä½†æ˜¯è·¯å¾„è¿½è¸ªè¿˜æ˜¯æœ€å‡†ç¡®çš„</p><p><strong>å¤–è§‚å»ºæ¨¡</strong></p><ul><li><p>éè¡¨é¢æ¨¡å‹</p><ul><li><p>æ•£å°„ä»‹è´¨: å…‰åœ¨è¡Œè¿›çš„è¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿæ•£å°„/æ±‡èš. å¦‚: é›¾, äº‘</p><p>ä½¿ç”¨Phase Functionå®šä¹‰æ•£å°„æ–¹å¼</p><p><img src="./img/18-3.png" /></p><p>æ¸²æŸ“æ–¹æ³•: å…‰åœ¨ä»»ä½•åœ°æ–¹æ–¹å‘éƒ½å¯èƒ½å‘ç”Ÿæ”¹å˜,äº§ç”Ÿä¸åŒPathå°è¯•æŠ˜åˆ°å…‰æº</p></li><li><p>å¤´å‘ä¸æ¯›å‘: ç ”ç©¶å…‰ä¸æ›²çº¿å¦‚ä½•ä½œç”¨,æ¯›å‘æœ‰æ— è‰²çš„é«˜å…‰ä¸æœ‰è‰²çš„é«˜å…‰</p><p>å°†æ¯›å‘è®¤ä¸ºæ˜¯ç»ç’ƒå£³åŒ…è£¹çš„è‰²ç´ æŸ±, æŸ±è¡¨é¢æœ‰å•å‘é”¯é½¿.å…‰æœ‰ä¸‰ç§è¡Œè¿›æ–¹å¼</p><p><img src="./img/18-4.png" /></p><p>åŠ¨ç‰©æ¯›å‘ä¸äººå¤´å‘ç›¸æ¯”, é«“è´¨æ›´å¤§, å…‰æ›´å®¹æ˜“å‘ç”Ÿæ•£å°„.å¾—åˆ°æ”¹è¿›åçš„åœ†æŸ±æ¨¡å‹(åœ¨è‰²ç´ ä¸­åŒ…å…¥é«“è´¨åœ†æŸ±é¢)</p><p><img src="./img/18-5.png" /></p></li><li><p>é¢—ç²’æè´¨Granular Material</p><p>æ¸²æŸ“å°çŸ³å­, æ²™ç²’ç”¨</p></li></ul></li><li><p>è¡¨é¢æ¨¡å‹</p><ul><li><p>åŠé€æ˜æè´¨Translucent Material</p><p>æ¸²æŸ“ç‰çŸ³, äººä½“(åŠé€å…‰çš„éƒ¨ä½),è€ƒè™‘äº†å…‰æ‰“å…¥ç‰©ä½“åå‘ç”Ÿæ•£å°„æœ€åä»å…¶ä»–éƒ¨ä½å°„å‡º,ä½¿ç”¨BSSRDFå‡½æ•°å–ä»£BRDFå‡½æ•°è¡¨ç¤ºä»æŸä¸ªæ–¹å‘å°„å…¥ä»å…¶ä»–åœ°æ–¹å°„å‡ºçš„å…‰åˆ†å¸ƒ</p><p><img src="./img/18-6.png" /></p></li><li><p>å¸ƒæ–™</p></li><li><p>ç»†èŠ‚åº¦æ¨¡å‹</p><p>æˆ‘ä»¬æ¸²æŸ“å‡ºçš„ç‰©ä½“éƒ½å¤ªå®Œç¾äº†,ç°å®ä¸­çš„ç‰©ä½“è¡¨é¢æˆ–å¤šæˆ–å°‘éƒ½æœ‰ä¸€äº›åˆ’ç—•ä¸ç¼ºé™·, å¯ä»¥å®šä¹‰ä¸€äº›è´´å›¾è®©å…¶æœ‰ç‘•ç–µ.æˆ‘ä»¬çš„æ¨¡å‹ä¹Ÿæ²¡æœ‰è€ƒè™‘å…‰çš„æ³¢åŠ¨æ€§,æ²¡æœ‰è€ƒè™‘å…‰çš„å¹²æ¶‰(å¦‚é‡‘å±è¡¨é¢ä¸ä»…å¯ä»¥çœ‹åˆ°é‡‘å±é¢œè‰²,è¿˜å¯ä»¥çœ‹åˆ°ä¸€äº›å› ä¸ºå¹²æ¶‰äº§ç”Ÿçš„äº®ç‚¹)</p><p><img src="./img/18-7.png" /></p></li></ul></li><li><p>ç¨‹åºåŒ–ç”Ÿæˆæ¨¡å‹</p><p>ç”¨å‡½æ•°åŠ¨æ€ç”Ÿæˆå¤–è§‚(ä¸‰ç»´çº¹ç†)</p></li></ul><h2 id="lecture-19-cameras-lenses">Lecture 19 Cameras Lenses</h2><p>åœ¨æ­¤ä¹‹å‰å›¾åƒéƒ½æ˜¯é€šè¿‡è®¡ç®—æœºåˆæˆçš„, å®é™…ä¸Š,æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ç›¸æœºç›´æ¥åˆæˆå›¾åƒ</p><p>ç›¸æœºæˆåƒæ¨¡å¼: å°å­”æˆåƒç›¸æœº(Pinhole)ä¸é•œå¤´ä¼ æ„Ÿå™¨æˆåƒ(Lenses Form Imageon Sensor)</p><p><strong>å°å­”æˆåƒç›¸æœº</strong></p><p>åº”ç”¨å°å­”æˆåƒåŸç†, æ²¡æœ‰åƒç´ å¤§å°ä¸ç„¦è·é™åˆ¶,æ¯ä¸ªç‚¹éƒ½æ˜¯æ¸…æ™°çš„æ²¡æœ‰æ·±åº¦å¯è¨€</p><p><strong>é•œå¤´-ä¼ æ„Ÿå™¨ç›¸æœº</strong></p><p>ç›¸æœºçš„æ„Ÿå…‰å…ƒä»¶æ˜¯ä¼ æ„Ÿå™¨(Sensor Accumulates Irradiance DuringExposure), å…¶è®°å½•çš„æ˜¯Irradiance(å„ç§æ–¹å‘çš„å…‰)</p><p>ä¸ºä»€ä¹ˆç›¸æœºéœ€è¦é•œå¤´å‘¢? å› ä¸ºä¼ æ„Ÿå™¨æ¥å—çš„æ˜¯å„ç§æ–¹å‘çš„Irradiance,è€Œä¸èƒ½æ¥æ”¶ç‰¹å®šæ–¹å‘çš„å…‰, æˆ‘ä»¬éœ€è¦ä¸€ä¸ªé€é•œå°†ä¸åŒæ¥å‘çš„å…‰æ±‡èšåœ¨ä¸åŒåœ°æ–¹</p><p><img src="./img/19-1.png" /></p><p>æ‘„åƒæœºé•œå¤´å¹¶éæ˜¯ä¸€ä¸ªè–„é€é•œ, è€Œæ˜¯ä¸€ä¸ªè–„é€é•œç»„,ç›¸æœºå¯ä»¥é€šè¿‡è°ƒæ•´é€é•œç»„ä¹‹é—´è·ç¦»å®ç°æ•´ä½“å˜ç„¦.é€šè¿‡å˜æ¢ç„¦è·å¯ä»¥è°ƒæ•´ç›¸æœºçš„è§†åœº. é•œå¤´ä¼ æ„Ÿå™¨ç›¸æœºçš„è¯„ä»·æŒ‡æ ‡æœ‰: è§†åœº(Fieldof View/FOV), ä¼ æ„Ÿå™¨å°ºå¯¸(Sensor Size), æ›å…‰(Exposure), å…‰åœˆ(Aperture),å¿«é—¨é€Ÿåº¦(Shutter), æ„Ÿå…‰åº¦(Gain/ISO),</p><p><strong>è§†åœº(Field of View/FOV)</strong></p><p>è¡¨ç¤ºå¯ä»¥çœ‹åˆ°å¤šè¿œçš„èŒƒå›´(ä¸é€è§†æŠ•å½±é‚£å—å·®ä¸å¤š) <spanclass="math display">\[FOV = 2\arctan\left(\frac{h}{2f}\right)\]</span> å…¶ä¸­<spanclass="math inline">\(h\)</span>æ˜¯ä¼ æ„Ÿå™¨é«˜åº¦(ä¸€èˆ¬ä¸ç”¨å®½åº¦è¡¨ç¤ºFOV), <spanclass="math inline">\(f\)</span>æ˜¯ç„¦è·(Focal Length)</p><p><img src="./img/19-2.png" /></p><p>FOVç”±ä¸¤ä¸ªå‚æ•°å†³å®š, æˆ‘ä»¬è§„å®š, å¸‚é¢ä¸Šçš„é•œå¤´<spanclass="math inline">\(f\)</span>åº”è¯¥ä¸ºç›¸æœºç­‰æ•ˆ35mmèƒ¶ç‰‡çš„<spanclass="math inline">\(f\)</span></p><p>FOVå¤§æˆåƒå®½å¹¿, FOVå°æˆåƒçª„è¿œ</p><p><strong>ä¼ æ„Ÿå™¨å°ºå¯¸(Sensor Size)</strong></p><p>ä¼ æ„Ÿå™¨å°ºå¯¸è¶Šå¤§åˆ†è¾¨ç‡è¶Šå¤§</p><p><strong>æ›å…‰åº¦(Exposure)</strong></p><p><span class="math inline">\(H=T\times E\)</span>,å³æ›å…‰åº¦æ˜¯Irradiance(E)åœ¨Exposure Time(T)ä¸Šçš„ç§¯åˆ†</p><ul><li>Exposure Timeç”±å¿«é—¨é€Ÿåº¦å†³å®š</li><li>Irradianceç”±è¿›å…‰åŠŸç‡ä¸å…‰åœˆ, ISOå†³å®š</li></ul><p><strong>å…‰åœˆ, å¿«é—¨é€Ÿåº¦, æ„Ÿå…‰åº¦</strong></p><ul><li><p>å…‰åœˆæ˜¯ä»¿ç…§äººä½“ç³å­”è®¾è®¡çš„, å†³å®šè¿›å…‰é‡, ç”¨f-stopè¡¨ç¤º</p></li><li><p>å¿«é—¨å¯ä»¥ç†è§£ä¸ºä¼ æ„Ÿå™¨å¤–é¢çš„å¸˜å­, åœ¨æˆåƒæ—¶å¸˜å­æ”¾ä¸‹,ç„¶ååœ¨è§„å®šæ—¶é—´ååœ¨æ”¾ä¸‹. å¿«é—¨é€Ÿåº¦è¡¨ç¤ºä¼ æ„Ÿå™¨æ„Ÿå…‰æ—¶é—´</p><p><img src="./img/19-3.gif" /></p></li><li><p>æ„Ÿå…‰åº¦(ISO)å¯ä»¥è®¤ä¸ºæ˜¯å¯¹å›¾åƒçš„åæœŸå¤„ç†, å°†ç›¸æœºä¼šå°†æ¥æ”¶åˆ°çš„å…‰<spanclass="math inline">\(\times ISO\)</span>å€</p></li></ul><p>ä¸åŒå…‰åœˆ, å¿«é—¨é€Ÿåº¦, æ„Ÿå…‰åº¦</p><p><img src="./img/19-4.png" /></p><ul><li><p>ISOè¡¨ç¤ºåƒç´ å¢ç›Šå€æ•°, <strong>ISOè¶Šå¤§, å›¾åƒè¶Šäº®</strong>,ISOåœ¨æ”¾å¤§å›¾åƒçš„è¿‡ç¨‹ä¸­ä¹Ÿä¼šæ”¾å¤§å™ªå£°,æ‰€ä»¥<strong>ISOè¿‡å¤§ä¼šå‡ºç°å™ªç‚¹</strong>. ISOæ˜¯çº¿æ€§çš„,ä¹Ÿå°±æ˜¯è¯´ISO400ä¸€å®šæ¯”ISO200äº®ä¸€å€</p></li><li><p>å¿«é—¨é€Ÿåº¦ç”¨ç§’è¡¨ç¤º, <strong>å¿«é—¨æ—¶é—´é•¿ä¼šé€ æˆè¿åŠ¨æ¨¡ç³Š</strong>.æœºæ¢°å¼å¿«é—¨æ˜¯ä¸€ä¸ªå¸˜å­, å…¶é®æŒ¡ä¼ æ„Ÿå™¨éœ€è¦æ—¶é—´,æ‰€ä»¥å„ä¸ªä¼ æ„Ÿå™¨å¼€å§‹æ„Ÿå…‰çš„æ—¶åˆ»ä¸åŒ, è¿™ä¼šé€ æˆå¦‚ä¸‹å›¾èºæ—‹æ¡¨çš„æœå†»æ•ˆåº”(RollingShutter)</p><p><img src="./img/19-5.png" /></p></li><li><p>å…‰åœˆç”¨f-stopè¡¨ç¤º, <span class="math inline">\(f-stop =f/d\)</span>(å³ç„¦è·/å…‰åœˆç›´å¾„), <strong>æ•°å­—è¶Šå°, å…‰åœˆè¶Šå¤§, é€å…‰é‡è¶Šå¤§,æ™¯æ·±è¶Šæµ…, è¿œå¤„æˆåƒè¶Šæ¨¡ç³Š</strong></p></li></ul><p><strong>è–„é€é•œè¿‘ä¼¼å‡è®¾</strong></p><ul><li>è¿›å…¥é€é•œçš„æ‰€æœ‰å¹³è¡Œå…‰çº¿éƒ½é€šè¿‡å…¶ç„¦ç‚¹</li><li>é€šè¿‡ä¸€ä¸ªç„¦ç‚¹çš„æ‰€æœ‰å…‰çº¿åœ¨é€šè¿‡é€é•œåå°†æ˜¯å¹³è¡Œçš„</li><li>ç„¦è·å¯ä»¥ä»»æ„æ”¹å˜(é€šè¿‡é€é•œç»„)</li><li>å¯¹äºç„¦è·<span class="math inline">\(f\)</span>, ç‰©è·<spanclass="math inline">\(z_0\)</span>, åƒè·<spanclass="math inline">\(z_i\)</span>æœ‰<spanclass="math inline">\(\frac{1}{f}=\frac{1}{z_i}+\frac{1}{z_0}\)</span></li></ul><p><strong>å¤±ç„¦æ¨¡ç³Š(Deforce Blur)</strong></p><p>å½“ä¸€ç³»åˆ—ä¸‰ç»´ç‰©ä½“åœ¨æ„Ÿå…‰å™¨ä»¶Sensor Planeä¸Šæˆåƒæ—¶,æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å…‰è·¯å¯é€†æ€§æ¨å‡ºåœ¨æ„Ÿå…‰å™¨ä»¶ä¸Šå®Œç¾æˆåƒçš„ç‰©è·.è¯¥ç‰©è·å¯¹åº”çš„å¹³é¢ä¸ºFocal Plane.ä¸åœ¨è¯¥å¹³é¢ä¸Šæˆåƒçš„ç‰©ä½“åˆ™ä¼šåœ¨æ„Ÿå…‰å…ƒä»¶ä¸ŠæŠ•å°„å‡ºæ¨¡ç³Šçš„åƒ</p><p><img src="./img/19-6.png" /></p><p>å¦‚å›¾, è“è‰²æ„Ÿå…‰å¹³é¢è·ç¦»é€é•œ<span class="math inline">\(z_s\)</span>,å®Œç¾æˆåƒå¹³é¢è·ç¦»é€é•œ<span class="math inline">\(z_s&#39;\)</span>,ç„¶è€Œå°åœ†ç‚¹è·ç¦»é€é•œ<span class="math inline">\(z_0\)</span>,å¯¼è‡´å…‰çº¿åœ¨<span class="math inline">\(z_i\)</span>å¤„èšç„¦åå†æ¬¡æŠ•å°„,æœ€ååœ¨æ„Ÿå…‰å¹³é¢ä¸ŠæŠ•å‡ºä¸€ä¸ªç›´å¾„ä¸º<spanclass="math inline">\(C\)</span>çš„åœ†, æˆ‘ä»¬ç§°è¿™ä¸ªåœ†ä¸ºå¼¥æ•£åœ†(Circle ofConfusion/CoC). åˆ©ç”¨ç›¸ä¼¼ä¸‰è§’å½¢å¯ä»¥å¾—åˆ°å¼¥æ•£åœ†ç›´å¾„<spanclass="math inline">\(C=\frac{d&#39;}{z_i}A =\frac{\|z_s-z_i\|}{z_i}A=\frac{\|z_s-z_i\|}{z_i}\frac{f}{N}\)</span></p><p>å¯ä»¥çœ‹åˆ°, å¼¥æ•£åœ†çš„ç›´å¾„ä¸<span class="math inline">\(z_i, z_s, f,N\)</span>æœ‰å…³, <span class="math inline">\(z_i\)</span>ä¸<spanclass="math inline">\(z_0, f\)</span>æœ‰å…³, è€Œ<spanclass="math inline">\(f, z_s\)</span>æ˜¯å®šå€¼, æ‰€ä»¥<spanclass="math inline">\(C\)</span>åªä¸ç‰©è·<spanclass="math inline">\(z_0\)</span>, å…‰åœˆç›´å¾„<spanclass="math inline">\(N\)</span>æœ‰å…³, å½“å…‰åœˆf-stopå˜å°, å…‰åœˆç›´å¾„<spanclass="math inline">\(N\)</span>å˜å¤§, éFocalPlaneä¸Šçš„ç‰©ä½“æˆåƒå°±è¶Šæ¨¡ç³Š</p><p><strong>è®¡ç®—æœºæ¨¡æ‹Ÿé•œå¤´-ä¼ æ„Ÿå™¨ç›¸æœºæ‹ç…§</strong></p><p>è®¡ç®—æœºä¹Ÿå¯ä»¥æ¨¡æ‹Ÿå‡ºå¤±ç„¦æ¨¡ç³Šçš„æ•ˆæœ</p><p><img src="./img/19-7.png" /></p><p>å°†æˆåƒé¢ä½œä¸ºæ„Ÿå…‰å¹³é¢, åœ¨æˆåƒå¹³é¢é€‰æ‹©ä¸€ä¸ªç‚¹å°†è¯¥ç‚¹ä¸é€é•œä¸­å¿ƒè¿çº¿,è®¡ç®—å¾—åˆ°å¯¹åº”Focal Planeä¸Šçš„ç‚¹</p><p><strong>æ™¯æ·±(Depth of Field)</strong></p><p>æˆ‘ä»¬è®¤ä¸ºå½“CoCè¶³å¤Ÿå°æ—¶(ä¾‹å¦‚å°äºä¸€ä¸ªåƒç´ å°ºå¯¸)æˆåƒå°±æ˜¯æ¸…æ™°çš„,å¯¹äºä¸€æ¬¡æˆåƒ, å°†CoCè¶³å¤Ÿå°æ—¶å¯¹åº”çš„ç‰©è·èŒƒå›´é•¿åº¦ç§°ä¸ºæ™¯æ·±</p><p><img src="./img/19-8.png" /></p><h2 id="lecture-20-light-fields-color-and-perception">Lecture 20 LightFields, Color and Perception</h2><p><strong>å…‰åœºLight Fields/Lumigraph</strong></p><p>æˆ‘ä»¬å¸Œæœ›æ„é€ ä¸€ä¸ªå‡½æ•°è¡¨ç¤ºä»å›ºå®šç‚¹åœ¨ä¸åŒè§’åº¦èƒ½çœ‹åˆ°çš„ä¸œè¥¿</p><ul><li><p>Grayscale snapshotå®šä¹‰äº†äººåœ¨çƒåæ ‡ç³»ä¸­å¿ƒæƒ³ä¸åŒæ–¹å‘çœ‹çš„å…‰å¼ºåº¦<spanclass="math inline">\(P(\theta, \Phi)\)</span>, åªæœ‰å…‰ç…§å¼ºåº¦,æˆ‘ä»¬çœ‹åˆ°çš„æ˜¯ç°åº¦å›¾</p><p><img src="./img/20-1.png" /></p></li><li><p>Colorsnapshotå®šä¹‰äº†äººåœ¨çƒåæ ‡ç³»ä¸­å¿ƒæƒ³ä¸åŒæ–¹å‘çœ‹çš„ä¸åŒæ³¢é•¿å…‰å¼ºåº¦<spanclass="math inline">\(P(\theta, \Phi,\lambda)\)</span>,ä¸åŒæ³¢é•¿çš„å…‰å¯¹åº”äº†ä¸åŒçš„é¢œè‰², æˆ‘ä»¬çœ‹åˆ°çš„æ˜¯å½©è‰²å›¾</p><p><img src="./img/20-2.png" /></p></li><li><p>è¿˜å¯ä»¥ä¸ºColor snapshotåŠ ä¸Šæ—¶é—´ç»´åº¦<spanclass="math inline">\(P(\theta, \Phi,\lambda, t)\)</span></p></li><li><p>å…¨å…‰å‡½æ•°å®šä¹‰äº†åœºæ™¯ä¸­æ¯ä¸ªç‚¹ä»ä¸åŒæ—¶é—´è§’åº¦çœ‹åˆ°çš„é¢œè‰²å¼ºåº¦<spanclass="math inline">\(P(\theta, \Phi,\lambda, t, V_X, V_Y,V_Z)\)</span></p><p><img src="./img/20-3.png" /></p></li></ul><p>æœ‰äº†å…¨å…‰å‡½æ•°, æˆ‘ä»¬å°±çŸ¥é“æ‘„å½±æœºåœ¨ä»»ä½•æ—¶é—´, ä»»ä½•åœ°ç‚¹,ä»»ä½•æ–¹å‘çœ‹åˆ°çš„é¢œè‰²äº†. æ¢è€Œè¨€ä¹‹,å…¨å…‰å‡½æ•°æ˜¯æˆ‘ä»¬åœ¨æ˜¾ç¤ºå™¨ä¸Šæ¸²æŸ“æ•´ä¸ªåœºæ™¯éœ€è¦çš„å”¯ä¸€ä¿¡æ¯.ä½†æ˜¯ä¿¡æ¯ä¼¼ä¹æœ‰ç‚¹å¤šäº†.</p><p><img src="./img/20-4.png" /></p><p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå¹³é¢, è®°å½•ä»è¿™ä¸ªå¹³é¢æ¯ä¸ªç‚¹å‘å‡ºçš„ä¸åŒæ–¹å‘çš„å…‰,å®šä¹‰å…¶ä¸ºå…‰åœºå‡½æ•°(<spanclass="math inline">\(P(x,y,\theta,\Phi)\)</span>).å…‰åœºå‡½æ•°è®°å½•äº†å¹³é¢ä¸Šæ¯ä¸ªç‚¹åœ¨æ¯ä¸ªæ–¹å‘è§‚æµ‹çš„é¢œè‰².å¦‚æœæŠŠè¿™ä¸ªå¹³é¢å½“æˆæ˜¾ç¤ºå™¨, æˆ‘ä»¬å°±å¾—åˆ°äº†ä»ä¸åŒè§’åº¦è§‚å¯Ÿæ˜¾ç¤ºå™¨ä¸Šç‚¹çš„ç»“æœ</p><p>ç„¶è€Œ, <spanclass="math inline">\(P(x,y,\theta,\Phi)\)</span>çš„å®šä¹‰å¹¶ä¸æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨,æ¯æ¬¡æ¸²æŸ“æ—¶æˆ‘ä»¬éƒ½è¦è®¡ç®—ç”¨æˆ·çœ‹åˆ°å±å¹•ä¸Šç‚¹ä»°è§’.å¯ä»¥åœ¨å…‰åœºå¹³é¢åå†åŠ å…¥ä¸€ä¸ªè¾…åŠ©å¹³é¢, å®šä¹‰ä¸€ä¸ªæ–¹å‘ä¸ºè¾…åŠ©å¹³é¢ä¸Šçš„ç‚¹<spanclass="math inline">\((u,v)\)</span>ä¸å…‰åœºé¢ä¸Šçš„ç‚¹<spanclass="math inline">\((x,y)\)</span>è¿çº¿çš„æ–¹å‘</p><p><img src="./img/20-5.png" /></p><p>å°†ä¸åŒç»´åº¦ä½œä¸ºåæ ‡è½´,æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸åŒçš„å›¾åƒ(ä¸Šå›¾ä¸­æ¯ä¸ªå°å›¾æ˜¯ä»ä¸€ä¸ªå›ºå®šç‚¹çœ‹å…‰åœºå¹³é¢çš„æˆåƒ,ä¸‹å›¾çš„å°å›¾æ˜¯ä¸€ä¸ªå›ºå®šçš„å…‰åœºå¹³é¢ä¸Šçš„ç‚¹è¢«ä¸åŒæ˜¯<spanclass="math inline">\((u,v)\)</span>çœ‹åˆ°çš„æ ·å­)</p><p><img src="./img/20-6.png" /></p><p><strong>å…‰åœºæ‘„åƒæœº</strong></p><p>æ™®é€šæ‘„åƒæœºæ„Ÿå…‰å…ƒä»¶ä¸Šä¸€ä¸ªåŸºæœ¬å•ä½(åƒç´ )æ¥æ”¶åˆ°çš„æ˜¯ä¸åŒæ–¹å‘å…‰çš„æ€»å’Œ.å…¶è®°å½•çš„æ˜¯æ‘„åƒæœºåœ¨æŸä¸ªä½ç½®, æŸä¸ªæ–¹å‘çš„æˆåƒ.</p><p>å…‰åœºæ‘„åƒæœºæ¨¡æ‹Ÿäº†è‹è‡çš„å¤çœ¼,åœ¨æ„Ÿå…‰å…ƒä»¶çš„æ¯ä¸ªåŸºæœ¬å•ä½("åƒç´ ")å‰æ–¹æ”¾äº†ä¸€ä¸ªé€é•œ,è¯¥é€é•œå¯ä»¥å°†ä¸åŒæ¥å‘çš„å…‰åˆ†æ•£çš„æ‰“åœ¨è¿™ä¸ªæ„Ÿå…‰å…ƒä»¶ä¸Š,æ„Ÿå…‰å…ƒä»¶åˆ†åˆ«è®°å½•è¯¥åƒç´ ä¸Šä¸åŒæ¥å‘çš„å…‰å¼ºåº¦.æˆ‘ä»¬å¯ä»¥è·å–åŒä¸€æ¥å‘çš„å…‰åœ¨æ„Ÿå…‰å…ƒä»¶ä¸Šçš„å¼ºåº¦,æ¯ä¸ªæ–¹å‘çš„æˆåƒå°±ç›¸å½“äºæ˜¯ä¸€ä¸ªæ™®é€šç›¸æœºæ‹çš„ä¸€å¼ ç…§ç‰‡.è¿™æ ·ä¸€æ¬¡æ‹æ‘„å°±è®°å½•äº†ä¸€ä¸ªå¹³é¢ä¸Šæ¯ä¸ªç‚¹æ”¶åˆ°ä¸åŒæ–¹å‘çš„å…‰,ç›¸å½“äºè®°å½•äº†ä¸€ä¸ªå…‰åœºå‡½æ•°</p><p><img src="./img/20-7.png" /></p><p>ä¼˜ç‚¹:</p><ul><li>è®°å½•äº†åŒä¸€ä½ç½®çš„ä¸åŒæ–¹å‘å…‰ç…§</li><li>å¯ä»¥éšæ—¶åœ¨æ‹ç…§ç»“æŸåéšæ—¶æ›´æ¢ç„¦è·</li></ul><p>ç¼ºç‚¹:</p><ul><li>åˆ†è¾¨ç‡ä¸è¶³, æ¯•ç«Ÿä¸€ä¸ªé€é•œåªå¯¹åº”ä¸€ä¸ªåƒç´ ,é€é•œåéœ€è¦å¾ˆå¤šæ„Ÿå…‰å…ƒä»¶åˆ†åˆ«è®°å½•ä¸åŒæ–¹å‘æ¥å…‰</li><li>é€é•œéš¾é€ </li></ul><p><strong>é¢œè‰²ä¸æ„ŸçŸ¥(Color and Perception)</strong></p><p>ä¸åŒé¢œè‰²çš„å…‰å¯¹åº”ä¸åŒçš„æ³¢é•¿. ä¸åŒçš„å…‰è¿˜å¯ä»¥å åŠ äº§ç”Ÿæ–°çš„å…‰,ä½¿ç”¨è°±åŠŸç‡å¯†åº¦(Spectral Power Distribution,SPD)å®šä¹‰ä¸€ä¸ªå…‰åœ¨ä¸åŒæ³¢é•¿ä¸Šçš„åŠŸç‡åˆ†å¸ƒ(ä¸‹å›¾æ˜¯æ—¥å…‰ä¸LEDå…‰çš„SPDå›¾)</p><p><img src="./img/20-8.png" /></p><p>SPDæ”¯æŒçº¿æ€§åŠ å’Œ, ä¸¤ä¸ªå…‰çš„å åŠ å°±æ˜¯ä¸¤ä¸ªå…‰SPDçš„å åŠ (å³:å…‰çº¿æ˜¯åŠ è‰²ç³»ç»Ÿ)</p><p><strong>äººçœ¼æ„ŸçŸ¥å…‰çº¿çš„æ–¹å¼</strong>: ä¸ç›¸æœºæˆåƒç±»ä¼¼,å…‰çº¿é€šè¿‡ç³å­”(å…‰åœˆ)å°„å…¥äººçœ¼, é€šè¿‡æ™¶çŠ¶ä½“(è–„é€é•œ)å‘ç”ŸæŠ˜å°„,æ‰“åœ¨è§†ç½‘è†œ(æ„Ÿå…‰å…ƒä»¶)ä¸Š. è§†ç½‘è†œä¸Šåˆ†å¸ƒç€æ„ŸçŸ¥å…‰çº¿å¼ºåº¦çš„æŸ±çŠ¶ç»†èƒ(RodCells)ä¸æ„ŸçŸ¥é¢œè‰²çš„é”¥å½¢ç»†èƒ(Cone Cells). é”¥å½¢ç»†èƒåˆ†ä¸ºä¸‰ç§ç»†èƒ: S-Cone,M-Cone, L-Cone. ä¸‰ç§ç»†èƒåˆ†åˆ«å¯¹ä¸‰ç§ä¸åŒèŒƒå›´æ³¢é•¿çš„å…‰æ•æ„Ÿåº¦ä¸åŒ,</p><p><img src="./img/20-9.png" /></p><p>äººç±»æ„ŸçŸ¥é¢œè‰²çš„ç»“æœå°±æ˜¯ä¸‰ç§ç»†èƒåˆ†åˆ«è®¡ç®—æ•æ„Ÿåº¦å¯¹æ„Ÿåº”å¼ºåº¦çš„ç§¯åˆ†å¾—åˆ°çš„ä¸‰å…ƒç»„<spanclass="math inline">\((S,M,L)\)</span>.(p.s.ä¸åŒäººçœ¼ä¸­ä¸‰ç§ç»†èƒæ•°é‡åˆ†å¸ƒå·®å¼‚å¾ˆå¤§,æ‰€ä»¥ç†è®ºä¸Šä¸åŒäººçœ‹åˆ°çš„é¢œè‰²å…¶å®æ˜¯ä¸åŒçš„) ç†è®ºä¸Š, å¯¹äºä¸åŒSPDçš„å…‰,åªè¦ç»†èƒè®¡ç®—å‡º<span class="math inline">\((S,M,L)\)</span>ä¸€æ ·,äººçœ¼æ„ŸçŸ¥åˆ°çš„é¢œè‰²å°±æ˜¯ä¸€æ ·çš„.è¿™ç§ç°è±¡æˆä¸º<strong>åŒè‰²å¼‚è°±</strong>(ä¸‹é¢çš„å…‰SPDä¸åŒ,ä½†æ˜¯ä¸‰ç§ç»†èƒå„è‡ªç®—å‡ºçš„ç§¯åˆ†æ˜¯ä¸€æ ·çš„)</p><p><img src="./img/20-10.png" /></p><p>åœ¨æ˜¾ç¤ºæ—¶, æˆ‘ä»¬å¾ˆéš¾æ¨¡æ‹Ÿè‡ªç„¶ç•Œçš„ä»»æ„å…‰çº¿(å¦‚ä¸Šå›¾ä¸­å·¦ä¸Šå­å›¾è¿ç»­çš„SPD),ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨åŒè‰²å¼‚è°±ç°è±¡,ä»…ä»…ç”¨ä¸‰ä¸ªæ³¢é•¿çš„å…‰(å¦‚ä¸Šå›¾ä¸­å³ä¸Šå­å›¾)æ¨¡æ‹Ÿå‡ºç›¸åŒçš„<spanclass="math inline">\((S,M,L)\)</span></p><p><strong>é¢œè‰²åŒ¹é…å‡½æ•°</strong></p><p>é¢œè‰²åŒ¹é…å‡½æ•°å‘Šè¯‰æˆ‘ä»¬æè¿°æ³¢é•¿ä¸º<spanclass="math inline">\(x\)</span>çš„å…‰, éœ€è¦å¤šå°‘çš„é¢„å®šä¹‰çš„ç‰¹å®šå…‰ç»„åˆèµ·æ¥.ä¾‹å¦‚CIE-RGBè‰²å½©ç³»ç»Ÿä½¿ç”¨ä¸‰ç§ç‰¹å®šæ³¢é•¿çš„çº¢ç»¿è“å…‰æè¿°ä¸€å®šæ³¢é•¿èŒƒå›´çš„å…‰.å…¶é¢œè‰²åŒ¹é…å‡½æ•°å¦‚ä¸‹</p><p><img src="./img/20-11.png" /></p><p>æ³¨æ„åˆ°åœ¨ä¸€æ®µæ³¢é•¿åŒºé—´, ç»¿è‰²ä¸çº¢è‰²çš„éœ€æ±‚å€æ•°æ˜¯å°äº0çš„,è¿™è¡¨ç¤ºæˆ‘ä»¬æ— æ³•ç”¨RGBè¡¨ç¤ºè¿™ä¸ªé¢œè‰², å‡è®¾ä¸€ä¸ªé¢œè‰²çš„RGBè¡¨ç¤ºæ˜¯<spanclass="math inline">\((-0.1, 0.1, 0.1)\)</span>,å…¶è¯´æ˜æˆ‘ä»¬æ— æ³•è¡¨ç¤ºè¿™ä¸ªå…‰, ä½†æ˜¯è¿™ä¸ªå…‰ä¸<spanclass="math inline">\((0.1,0,0)\)</span>å…‰æ··åˆå, æˆ‘ä»¬å¯ä»¥ç”¨<spanclass="math inline">\((0,0.1,0.1)\)</span>è¡¨ç¤º</p><p><strong>é¢œè‰²ç©ºé—´ä¸è‰²åŸŸ</strong></p><ul><li><p>CIE-XYZç³»ç»Ÿ[ç§‘ç ”å¸¸ç”¨]</p><p>CIE-XYZæ˜¯ä¸€å¥—äººé€ é¢œè‰²åŒ¹é…ç³»ç»Ÿ. XYZæ˜¯ä¸‰ç§æ³¢é•¿çš„é¢„å®šä¹‰å…‰.ä½†è¿™ä¸‰ç§å…‰å¹¶ä¸ä»£è¡¨ç‰¹å®šé¢œè‰². å¯ä»¥é€šè¿‡XYZçš„éè´Ÿçº¿æ€§ç»„åˆè¡¨è¿°å¯è§å…‰. åŒæ—¶,Yå…‰ä¸€å®šç¨‹åº¦ä¸Šä»£è¡¨äº†é¢œè‰²çš„äº®åº¦.</p><p>æˆ‘ä»¬å¸Œæœ›å°†XYZå¯ä»¥è¡¨ç¤ºçš„é¢œè‰²(å³: è‰²åŸŸ)å¯è§†åŒ–å±•ç°å‡ºæ¥,ä½†æ˜¯XYZæ˜¯ä¸‰ä¸ªé¢œè‰², å¯ä»¥å…ˆå°†XYZå½’ä¸€åŒ–, å¾—åˆ°<span class="math inline">\(x= \frac{X}{X+Y+Z}, y = \frac{Y}{X+Y+Z}\)</span>, è¿™æ ·<spanclass="math inline">\(z = 1-x-y\)</span>å°±å¯ä»¥ä¸ç”¨å†åœ¨åæ ‡ç³»ä¸­è¡¨ç¤ºäº†,ç”±äºYè¡¨ç¤ºäº®åº¦, æˆ‘ä»¬å¯ä»¥è®©Yä¸ºå®šå€¼, ä»…å˜æ¢<spanclass="math inline">\(X,Y\)</span>è·å¾—<spanclass="math inline">\(x,y\)</span>. æœ€åä¸º<spanclass="math inline">\((x,y)\)</span>ç€ä¸Šå…¶è¡¨è¿°çš„é¢œè‰²å³å¯</p><p><img src="./img/20-12.png" /></p><p>åœ¨è‰²åŸŸä¸­é—´å¯ä»¥çœ‹åˆ°ç™½è‰²(å› ä¸ºç™½è‰²æ˜¯æ‰€æœ‰é¢œè‰²çš„æ··åˆ),åœ¨è‰²åŸŸè¾¹ç¼˜å¯ä»¥çœ‹åˆ°çº¯è‰²</p></li><li><p>æ ‡å‡†RGBç³»ç»Ÿ(RGB/sRGB)[å¾ˆå¸¸ç”¨]</p><p>é¢„å®šä¹‰äº†ç‰¹å®šæ³¢é•¿çš„æ ‡å‡†çº¢ç»¿è“, å…¶ä»–é¢œè‰²éƒ½ç”¨å®ƒè¡¨ç¤º.ä½†æ˜¯sRGBæœ‰ä¸€éƒ¨åˆ†é¢œè‰²æ˜¯è¡¨ç¤ºä¸äº†çš„(é¢œè‰²åŒ¹é…å‡½æ•°ä¸­å°äº0çš„éƒ¨åˆ†),å…¶åªèƒ½è¡¨è¿°XYZé¢œè‰²ç©ºé—´ä¸­ä¸€ä¸ªä¸‰è§’å½¢çš„éƒ¨åˆ†</p><p><img src="./img/20-13.png" /></p></li><li><p>HSV/HSLé¢œè‰²ç©ºé—´[è‰ºæœ¯å®¶å¸¸ç”¨]</p><p>ä½¿ç”¨è‰²è°ƒ(Hue, é¢œè‰²åœ¨è‰²ç¯ä¸Šçš„è§’åº¦)-é¥±å’Œåº¦(Saturation,æè¿°é¢œè‰²æ›´æ¥è¿‘æ··åˆé¢œè‰²(ç™½è‰²)è¿˜æ˜¯çº¯è‰²)-æ˜åº¦(Value/Lightness)å®šä¹‰é¢œè‰²</p><p><img src="./img/20-14.png" /></p></li><li><p>LABè‰²å½©ç©ºé—´</p><p>å®šä¹‰<span class="math inline">\(L\)</span>è½´ä¸¤ç«¯æ˜¯é»‘ç™½, <spanclass="math inline">\(a\)</span>è½´ä¸¤ç«¯æ˜¯çº¢ç»¿, <spanclass="math inline">\(b\)</span>è½´ä¸¤æ®µæ˜¯é»„è“, å…¶ä»–é¢œè‰²å°±æ˜¯ä»–ä»¬çš„ç»„åˆ.LABè‰²å½©ç©ºé—´è®¤ä¸ºç©ºé—´ä¸¤ç«¯çš„é¢œè‰²éƒ½æ˜¯äº’è¡¥è‰²(é»‘-ç™½, çº¢-ç»¿...)</p><p>å¦‚æœäº§ç”Ÿä¸¤ç§é¢œè‰²çš„å…‰æ³¢ç›¸æ··åˆï¼Œç»“æœå‡ºç°ç°è‰²ï¼Œåˆ™ä¸¤ç§é¢œè‰²äº’è¡¥.äººè„‘è®¤ä¸ºä¸¤ä¸ªé¢œè‰²å·®å¼‚è¿‡å¤§æ—¶å°±è®¤ä¸ºä»–ä»¬æ˜¯äº’è¡¥çš„(ä¾‹å¦‚å¾ˆå®¹æ˜“æƒ³è±¡å‡ºé»„ç»¿,è“ç»¿è‰², ä½†æ˜¯å¾ˆéš¾æƒ³è±¡å‡ºçº¢ç»¿è‰²)</p><p><img src="./img/20-15.png" /></p><p>è¿˜æœ‰ä¸€äº›ä¸äº’è¡¥è‰²ç›¸å…³çš„è§†è§‰é”™è§‰: äººå¦‚æœç›¯ä¸€ä¸ªé¢œè‰²æ—¶é—´å°±äº†,å¿½ç„¶åˆ‡æ¢åˆ°å…¶ä»–é¢œè‰², äººè„‘å°±ä¼šè„‘è¡¥å‡ºè¿™ä¸ªé¢œè‰²çš„äº’è¡¥è‰²(<span class="exturl" data-url="aHR0cHM6Ly93d3cudmVyeXdlbGxtaW5kLmNvbS93aGF0LWlzLXRoZS1vcHBvbmVudC1wcm9jZXNzLXRoZW9yeS1vZi1jb2xvci12aXNpb24tMjc5NTgzMA==">æ‹®æŠ—ç†è®º<i class="fa fa-external-link-alt"></i></span>)</p></li><li><p>CMYKç³»ç»Ÿ</p><p>å‰é¢çš„é¢œè‰²ç³»ç»Ÿéƒ½æ˜¯åŠ è‰²ç³»ç»Ÿ(é¢œè‰²æ··åˆå¾—åˆ°ç™½è‰²),ä½†æ˜¯ç°å®ä¸­å°åˆ·ç­‰æ˜¯ä¸€ä¸ªå‡è‰²ç³»ç»Ÿ(é¢œè‰²æ··åˆå¾—åˆ°é»‘è‰²). CMYKæ˜¯ä¸€ä¸ªå‡è‰²ç³»ç»Ÿ,å®šä¹‰C(é’)M(æ´‹çº¢/å“çº¢)Y(é»„)K(é»‘)å››ç§å¢¨æ°´çš„æ¯”ä¾‹å®šä¹‰é¢œè‰². å…¶æ··åˆå¦‚ä¸‹å›¾</p><p><img src="./img/20-16.png" /></p><p>æ³¨æ„åˆ°: é€šè¿‡æ··åˆCMYå°±å¯ä»¥å¾—åˆ°é»‘è‰²K, ä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯è¦å®šä¹‰K,è€Œä¸æ˜¯åœ¨å°åˆ·ä¸­ç›´æ¥ç”¨CMYæ··åˆå¾—åˆ°K. è¿™æ˜¯å› ä¸ºKå¢¨æ°´æœ€ä¾¿å®œ,è€ŒCMYå¢¨æ°´é€ ä»·é«˜...</p></li></ul><h2 id="lecture-21-animation-and-simulation">Lecture 21 Animation andSimulation</h2><p>åŠ¨ç”»å®ç°æ–¹å¼: å…³é”®å¸§åŠ¨ç”», ç‰©ç†æ¨¡æ‹Ÿ</p><p><strong>è´¨ç‚¹å¼¹ç°§ç³»ç»Ÿ(Mass Spring Rope)</strong></p><p>å°±æ˜¯ä¸€ç³»åˆ—ç›¸äº’è¿æ¥çš„è´¨ç‚¹å’Œå¼¹ç°§.</p><p>å¼¹ç°§ç³»ç»Ÿä¸­, ç«¯ç‚¹ä¸¤è¾¹ç‰©ä½“çš„ç›¸äº’ä½œç”¨åŠ›ä¸å½¢å˜é•¿åº¦æ­£æ¯”å³: <spanclass="math display">\[f_{a\to b} = -f_{b\to a} =  k_s\frac{b-a}{\|b-a\|}(\|b-a\|-l)\]</span> <span class="math inline">\(l\)</span>ä¸ºè‡ªç„¶å±•å¼€é•¿åº¦, <spanclass="math inline">\(a,b\)</span>ä¸ºä¸¤ä¸ªè´¨ç‚¹å‘é‡.</p><p>åœ¨æ¨¡æ‹Ÿä¸­, æˆ‘ä»¬ç”¨<span class="math inline">\(\dot{y}\)</span>è¡¨ç¤º<spanclass="math inline">\(y\)</span>çš„ä¸€é˜¶å¯¼æ•°, ç”¨<spanclass="math inline">\(\ddot{y}\)</span>è¡¨ç¤º<spanclass="math inline">\(y\)</span>çš„äºŒé˜¶å¯¼æ•°...</p><p>å°†å¼¹ç°§æ‹‰å¼€å, æ ¹æ®èƒ½é‡å®ˆæ’, å¼¹ç°§ä¼šæ°¸è¿œè¿åŠ¨. ä¸ºäº†è®©ç‰©ä½“åœä¸‹æ¥,æˆ‘ä»¬è¦ä¸ºå¼•å…¥æ‘©æ“¦åŠ›<spanclass="math inline">\(f=-k_d\dot{b}\)</span>(<spanclass="math inline">\(b\)</span>ä¸ºé€Ÿåº¦, <spanclass="math inline">\(k_d\)</span>ä¸ºå¸¸æ•°).è¿™æ ·å¼•å…¥æ‘©æ“¦åŠ›ä¼šå¯¼è‡´å¼¹ç°§æ•´ä½“è¿åŠ¨æ—¶å‡ºç°é¢å¤–çš„æ‘©æ“¦åŠ›(å¼¹ç°§ä¸¤ç«¯ç›¸å¯¹é™æ­¢,æ•´ä½“åœ¨å…‰æ»‘çš„æ°´å¹³é¢ä¸Šè¿åŠ¨, ä¼šå‘ç°å¼¹ç°§ä¼šè¶Šæ¥è¶Šæ…¢). è€ƒè™‘åˆ°è¿™ä¸ªé—®é¢˜,å¼•å…¥ç›¸å¯¹é€Ÿåº¦(ç”¨<span class="math inline">\(a\)</span>åˆ°<spanclass="math inline">\(b\)</span>è¿çº¿ç‚¹ä¹˜ç›¸å¯¹è¿åŠ¨è¿åŠ¨å‘é‡ç›¸å½“äºè·å¾—äº†ç›¸å¯¹è¿åŠ¨å‘é‡åœ¨<spanclass="math inline">\(\vec{ab}\)</span>ä¸Šçš„æŠ•å½±, ç„¶åå†æ¢æˆå‘é‡) <spanclass="math display">\[f_b = -k_d\frac{b-a}{\|b-a\|}(\dot{b}-\dot{a})\frac{b-a}{\|b-a\|}\]</span> <img src="./img/21-1.gif" /></p><p>å¼¹ç°§ä¹‹é—´è¿˜å¯ä»¥ç»„åˆæˆä¸åŒçš„å½¢çŠ¶:</p><p><img src="./img/21-2.png" /></p><p>ç”¨è¿™äº›ç®€å•å›¾å½¢æ— æ³•è¡¨ç¤ºå„å¼å„æ ·çš„æè´¨</p><ul><li><p>è®©å¹³é¢ç»“æ„æŠ—åˆ‡å˜</p><p>æ‹‰ç€ä¸Šå›¾å¹³é¢ç»“æ„çš„å·¦ä¸‹ä¸å³ä¸Šè§’, è¿™ä¸ªç½‘ä¼šæ›´å®¹æ˜“è¢«æ‹‰æ­ª,å³ä¸¤è¾¹çš„èŠ‚ç‚¹å‘æ–œå¯¹è§’çº¿æ±‡èš. æˆ‘ä»¬éœ€è¦å¢åŠ å¼¹ç°§æŠ—æ‹’åˆ‡å˜</p><p><img src="./img/21-3.png" /></p><p>æ­¤æ—¶å†æ‹‰ä½å·¦ä¸‹å³ä¸Š, è“è‰²çš„å¼¹ç°§ä¼šæŠ—æ‹’å‹ç¼©</p><p>å½“ç„¶, è¿˜åº”è¯¥ç»™å¦ä¸€åŠå¯¹è§’çº¿åŠ å…¥å¼¹ç°§é˜²æ­¢å‘ç”Ÿå¦ä¸€ä¸ªæ–¹å‘çš„åˆ‡å˜</p><p><img src="./img/21-4.png" /></p></li><li><p>è®©å¹³é¢æŠ—å¼¯æ›²</p><p>åœ¨æŠ—åˆ‡è¾¹åŸºç¡€ä¸Š, å¹³é¢ç»“æ„å¾ˆå®¹æ˜“æ²¿ç€æ­£æ–¹å½¢è¾¹æŠ˜å ,å¯ä»¥åœ¨ç›¸éš”é¡¶ç‚¹ä¹‹é—´å»ºç«‹å¼¹ç°§</p><p><img src="./img/21-5.png" /></p></li></ul><p><strong>ç²’å­ç³»ç»Ÿ(Particle Systems)</strong></p><p>å®šä¹‰äº†ä¸€å †å¾®å°çš„ç²’å­, ç„¶åä¸€ä¸ªä¸€ä¸ªå»ºæ¨¡,åˆ†ææ¯ä¸ªç²’å­å—åŠ›(ç²’å­é—´ä½œç”¨ä¸å—åˆ°çš„å¤–åŠ›)</p><p><strong>è¿åŠ¨å­¦</strong></p><p>ç»™å®šä¸€ä¸ªæ¨¡å‹çš„æ¯ä¸ªç»„ä»¶å¦‚ä½•è¿åŠ¨, æ±‚è§£æ¯ä¸ªç»„ä»¶çš„ä½ç½®</p><p>å®šä¹‰æ¨¡å‹çš„éª¨éª¼ç³»ç»Ÿæœ‰ä¸‰ç§å…³èŠ‚</p><ul><li>Pin: å°†ä¸€ä¸ªé’‰å­é’‰åœ¨éª¨éª¼ä¹‹é—´,è¿™æ ·ä¸¤ä¸ªéª¨éª¼å¯ä»¥åœ¨æ‰€æˆäºŒç»´å¹³é¢å†…æ—‹è½¬</li><li>Ball: éª¨éª¼ä¸€æ®µåŒ…åœ¨éª¨éª¼å¦ä¸€ç«¯, è¿™æ ·éª¨éª¼å°±å¯ä»¥å·²è¿æ¥ç«¯ä¸ºçƒå¿ƒæ—‹è½¬</li><li>Prismatic Joint: å¯ä»¥è®¤ä¸ºæ˜¯ä¸¤ä¸ªéª¨éª¼ä¹‹é—´æœ‰ä¸€ä¸ªå¯ä»¥æ‹‰ä¼¸çš„ç‰©ä»¶è¿æ¥</li></ul><p>ä¾‹å¦‚: å·²çŸ¥ä¸¤ä¸ªå…³èŠ‚æ˜¯Piné“¾æ¥, ç»™å‡º<spanclass="math inline">\(\theta_1,\theta_2\)</span>å˜åŒ–å‡½æ•°æ±‚<spanclass="math inline">\(t\)</span>æ—¶åˆ»æ—¶<spanclass="math inline">\(P\)</span>ç‚¹çš„ä½ç½®</p><p><img src="./img/21-6.png" /></p><p><strong>é€†è¿åŠ¨å­¦</strong>æ˜¯ç»™å‡ºç»„ä»¶æŸä¸ªç‚¹çš„ä½ç½®,æ±‚è§£æ¯ä¸ªç»„ä»¶æ˜¯å¦‚ä½•å˜æ¢çš„(è¿˜æœ‰å¤šè§£ä¸æ— è§£å¯èƒ½)</p><p>ä¾‹å¦‚: å·²çŸ¥ä¸¤ä¸ªå…³èŠ‚æ˜¯Piné“¾æ¥, ç»™å‡º<spanclass="math inline">\(t\)</span>æ—¶åˆ»æ—¶<spanclass="math inline">\(P\)</span>ç‚¹çš„ä½ç½®, æ±‚<spanclass="math inline">\(\theta_1,\theta_2\)</span>å˜åŒ–å‡½æ•°</p><p><img src="./img/21-7.png" /></p><p>ä¸€è¿åŠ¨å­¦ä¸€èˆ¬ç”¨ä¼˜åŒ–æ–¹æ³•æ±‚è§£, è€Œä¸æ˜¯ç”¨æ•°å­¦æ–¹æ³•æ±‚è§£</p><p><strong>Rigging</strong></p><p>é€šè¿‡æ§åˆ¶çº¿ä¸ºéª¨éª¼æ·»åŠ åŠ¨ä½œ/åšé€ å‹(ç±»ä¼¼äºæçº¿æœ¨å¶)</p><p><strong>åŠ¨ä½œæ•æ‰</strong></p><p>è®©è§’è‰²ç©¿ä¸Šæœ‰æ§åˆ¶ç‚¹çš„è¡£æœ, ç›¸æœºæ•æ‰åˆ°æ§åˆ¶ç‚¹å°±å®ç°äº†åŠ¨ä½œæ•æ‰</p><h2 id="lecture-22-animation-and-simulation">Lecture 22 Animation andSimulation</h2><p><strong>å•ç²’å­æ¨¡æ‹Ÿ(Single particle simulation)</strong></p><p>å·²çŸ¥ä¸€ä¸ªç‰©ä½“åˆå§‹æ—¶çš„èµ·ç‚¹å’Œé€Ÿåº¦, å¾ˆå®¹æ˜“å¾—åˆ°è¯¥ç‰©ä½“åœ¨ä¸‹ä¸€æ—¶åˆ»çš„ä½ç½®.æˆ‘ä»¬æƒ³è¦æ¨¡æ‹Ÿä¸€ä¸ªç²’å­åœ¨é€Ÿåº¦åœº(<spanclass="math inline">\(v(x,t)\)</span>)çš„è¿åŠ¨è½¨è¿¹</p><p>å¯ä»¥ç”¨å¾®åˆ†æ–¹ç¨‹è®¡ç®—è¡¨è¿°<span class="math inline">\(\dot{x} =v(x,t)\)</span>, å¸Œæœ›å¾—åˆ°ä½ç½®å…³äºæ—¶é—´çš„å‡½æ•°<spanclass="math inline">\(x(t)\)</span>, å‡è®¾åˆå§‹ä½ç½®ä¸º<spanclass="math inline">\(x_0\)</span></p><ul><li><p>å¯ä»¥é‡‡ç”¨æ¬§æ‹‰æ–¹æ³•è§£å¾®åˆ†æ–¹ç¨‹</p><p><span class="math display">\[  x^{t+\Delta t}=x^{t}+\Delta t\dot{x}^{t}\\  \dot{x}^{t+\Delta t}=\dot{x}^{t}+\Delta t\ddot{x}^{t}  \]</span></p><p>ä½†æ˜¯æ•ˆæœä¸æ€ä¹ˆå¥½(<span class="math inline">\(\Deltat\)</span>ä¸å¤Ÿå°), <strong>ä¸ç¨³å®š</strong>(å¯èƒ½ä¼šåç¦»é€Ÿåº¦åœº)</p><p><img src="./img/22-1.png" /></p></li><li><p>å¯ä»¥é‡‡ç”¨ä¸­ç‚¹æ³•æ”¹è¿›æ¬§æ‹‰æ–¹æ³•</p><p>å¦‚å›¾, ä»<span class="math inline">\(o\)</span>ç‚¹å‡ºå‘, å…ˆèµ°<spanclass="math inline">\(\Delta t\)</span>æ­¥, åˆ°è¾¾<spanclass="math inline">\(a\)</span>ç‚¹, å–<spanclass="math inline">\(oa\)</span>ä¸­ç‚¹<spanclass="math inline">\(b\)</span>, è·å–<spanclass="math inline">\(b\)</span>ç‚¹é€Ÿåº¦, é‡æ–°ä»åŸç‚¹èµ°<spanclass="math inline">\(\Delta t\)</span>æ­¥, é€Ÿåº¦å–<spanclass="math inline">\(b\)</span>ç‚¹é€Ÿåº¦</p><p><img src="./img/22-2.png" /></p><p>Bç‚¹: $x_b = x(t)+tÂ v(x(t),t)/2 $</p><p>Cç‚¹: $x_c = x(t)+tÂ v(x_B,t) $</p><p>è”ç«‹æ–¹ç¨‹ <span class="math display">\[  x^{t+\Delta t} = x^t+\Delta t \dot{x}^t+\frac{(\Deltat)^2}{2}\ddot{x}^t  \]</span></p></li><li><p>å¯ä»¥é‡‡ç”¨è‡ªé€‚åº”æ”¹å˜æ­¥é•¿æ³•æ”¹è¿›æ¬§æ‹‰æ–¹æ³•</p><p>å¦‚å›¾, ä»<span class="math inline">\(o\)</span>ç‚¹å‡ºå‘, å…ˆèµ°<spanclass="math inline">\(\Delta T\)</span>æ­¥, åˆ°è¾¾<spanclass="math inline">\(x_T\)</span>ç‚¹, å†ä»<spanclass="math inline">\(o\)</span>ç‚¹å‡ºå‘, èµ°ä¸¤æ¬¡<spanclass="math inline">\(\Delta T/2\)</span>æ­¥, åˆ°è¾¾<spanclass="math inline">\(x_{T/2}\)</span>. è®¡ç®—<spanclass="math inline">\(\|x_t-x_{T/2}\|\)</span>, å¦‚æœè¯¯å·®è¿‡å¤§, å°±å°†<spanclass="math inline">\(\Delta T\)</span>å‡åŠ, ç»§ç»­è¿­ä»£.è¿™æ ·åœ¨ä¸åŒä½ç½®æˆ‘ä»¬å¯ä»¥é€‰ç”¨ä¸åŒçš„<span class="math inline">\(\DeltaT\)</span>è®¡ç®—</p><p><img src="./img/22-3.png" /></p></li><li><p>å¯ä»¥é‡‡ç”¨éšå¼æ¬§æ‹‰æ–¹æ³•(åå‘çš„æ–¹æ³•)</p><p>ä¹‹å‰æ¬§æ‹‰æ–¹æ³•ä¼°ç®—<span class="math inline">\(t+\Deltat\)</span>æ—¶åˆ»ä½ç½®æ—¶ä½¿ç”¨çš„æ˜¯<spanclass="math inline">\(t\)</span>æ—¶åˆ»çš„é€Ÿåº¦,éšå¼æ¬§æ‹‰æ–¹æ³•ä½¿ç”¨ä¸‹ä¸€æ—¶åˆ»çš„é€Ÿåº¦ä¼°ç®— <span class="math display">\[  x^{t+\Delta t}=x^{t}+\Delta t\dot{x}^{t +\Delta t}\\  \dot{x}^{t+\Delta t}=\dot{x}^{t}+\Delta t\ddot{x}^{t+\Delta t}  \]</span> æ–¹ç¨‹ä¸å¥½è§£(éœ€è¦ä½¿ç”¨ä¼˜åŒ–æ–¹æ³•ä¼°ç®—ä¸‹ä¸€ä¸ªç‚¹çš„é€Ÿåº¦&amp;åŠ é€Ÿåº¦),ä½†æ˜¯å¥½ç”¨åˆç¨³å®š:)</p><p>éšå¼æ¬§æ‹‰è¯¯å·®æ˜¯ä¸€é˜¶çš„(å±€éƒ¨è¯¯å·®<spanclass="math inline">\(O(h^2)\)</span>, å…¨å±€è¯¯å·®<spanclass="math inline">\(O(h)\)</span>, <spanclass="math inline">\(h\)</span>ä¸ºæ­¥é•¿(å¦‚æœ¬ä¾‹ä¸­<spanclass="math inline">\(\Delta t\)</span>))</p></li><li><p>å¯ä»¥é‡‡ç”¨Runge-Kuttaæ–¹æ³•æ”¹è¿›æ¬§æ‹‰æ–¹æ³•</p><p>ä¸€ç±»æ–¹æ³•, ç‰¹åˆ«æ“…é•¿è§£éçº¿æ€§å¸¸å¾®åˆ†æ–¹ç¨‹. å…¶ä¸­RK4æ–¹æ³•æ˜¯ä¸€ä¸ª4é˜¶æ–¹æ³•,å¯¹äºå¦‚ä¸‹æ–¹ç¨‹ <span class="math display">\[  \frac{dy}{dx}=f(t,y)\\  y(t_0)=y_0  \]</span> RK4å…ˆå®šä¹‰ <span class="math display">\[  t_{n+1}=t_n+h\\  y_{n+1}= y_n+\frac{1}{6}h(K_1+2K_2+2K_3+K_4)  \]</span>å³ä¸‹ä¸€æ¬¡ä½ç½®æ˜¯ä¸Šä¸€æ¬¡åŠ ä¸Šæ­¥é•¿åŠ ä¸Šä¸€ä¸ªå¥‡æ€ªçš„å€¼(ç›¸å½“äºåäº†ä¸€ä¸ªåŒå‘çš„å‡å€¼)<span class="math display">\[  k_1=f(t_n,y_n)\\  k_2=f(t_n+h/2,y_n+hk_1/2)\\  k_3=f(t_n+h/2,y_n+hk_2/2)\\  k_4=f(t_n+h,y_n+hk_3)\\  \]</span></p></li><li><p>é‡‡ç”¨éç‰©ç†æ–¹æ³•</p><p>é€šè¿‡è®¾ç½®ä¸€ç³»åˆ—é™åˆ¶ä¸æ–­è¦æ±‚ä¿®æ­£ä½ç½®,å”¯ä¸€ç¼ºç‚¹å°±æ˜¯ä¸ç¬¦åˆç‰©ç†è§„å¾‹(è§æµä½“æ¨¡æ‹Ÿ)</p></li></ul><p>p.s. å¦‚ä½•å®šä¹‰æ•°å€¼æ–¹æ³•ç¨³å®šæ€§</p><ul><li>ç¨³å®šæ€§: åº¦é‡æ¯ä¸€æ­¥çš„è¯¯å·®(æˆªæ–­è¯¯å·®),æ•´ä½“è¯¯å·®ä¸é˜¶(<spanclass="math inline">\(\Delta t\)</span>)çš„å…³ç³».</li><li>è¯¯å·®ä¸º<span class="math inline">\(O(h^n)\)</span>è¯´æ˜<spanclass="math inline">\(h\)</span>æ¯å‡å°ä¸€åŠ, å±€éƒ¨è¯¯å·®å‡å°‘åˆ°<spanclass="math inline">\(1/{2^n}\)</span></li></ul><p><strong>åˆšä½“æ¨¡æ‹Ÿ(Rigid Body Simulation)</strong></p><p>åˆšä½“ä¸ä¼šå‘ç”Ÿå½¢å˜, åˆšä½“è¿åŠ¨ä¼šè¦æ±‚å†…éƒ¨çš„ç‚¹ä»¥åŒæ ·çš„æ–¹å¼è¿åŠ¨.å¯ä»¥æŠŠåˆšä½“æƒ³è±¡æˆä¸€ä¸ªå¤§ç²’å­, åªä¸è¿‡åœ¨æ±‚åˆšä½“è¿åŠ¨æ—¶å€™ä¼šç»™å‡ºæ›´å¤šé™åˆ¶ <spanclass="math display">\[\frac{d}{dt}\left(\begin{matrix}X\\ \theta\\\dot{X}\\\omega\end{matrix}\right)=\left(\begin{matrix}\dot{X}\\ \omega\\a\\\alpha\end{matrix}\right)\]</span> <span class="math inline">\(\alpha\)</span>ä¸ºè§’åŠ é€Ÿåº¦, <spanclass="math inline">\(a\)</span>ä¸ºåŠ é€Ÿåº¦</p><p><strong>æµä½“æ¨¡æ‹Ÿ(Fluid Simulation)</strong></p><p>æŠŠæµä½“å½“æˆå¾ˆå°çš„ä¸å¯å‹ç¼©çš„å°åˆšä½“ç²’å­ç»„åˆ.æµä½“åœ¨ä»»ä½•ä½ç½®å°åˆšä½“çš„å¯†åº¦ä¸€æ ·(æ®æ­¤,æˆ‘ä»¬å¯ä»¥ä¸æ–­ä¿®æ­£æ¨¡æ‹Ÿçš„åˆšä½“ä½ç½®ä¿è¯æµä½“å¯†åº¦å¤„å¤„ç›¸ç­‰). ä¸ºäº†æ¨¡æ‹Ÿå¯†åº¦ç›¸åŒ,æˆ‘ä»¬éœ€è¦çŸ¥é“å¯†åº¦å¯¹å„ä¸ªå°çƒçš„æ¢¯åº¦(å¯¼æ•°),éœ€è¦çŸ¥é“ç§»åŠ¨æ¯ä¸ªå°çƒå¯¹äºå‘¨å›´æµä½“å¯†åº¦çš„æ”¹å˜</p><p>æµä½“æ¨¡æ‹Ÿçš„æ–¹æ³•</p><ul><li>è´¨ç‚¹æ³•(æ‹‰æ ¼æœ—æ—¥æ–¹æ³•): ä¸ºæ¯ä¸ªåˆšä½“å•ç‹¬æ¨¡æ‹Ÿ</li><li>ç½‘æ ¼æ³•(æ¬§æ‹‰æ–¹æ³•): å°†æ¨¡æ‹Ÿçš„æµä½“åˆ’åˆ†ä¸ºç½‘æ ¼. è€ƒè™‘ç½‘æ ¼éšç€æ—¶é—´å˜åŒ–</li><li>æ··åˆæ³•: è®¤ä¸ºä¸åŒçš„ç²’å­å…·æœ‰æè´¨å±æ€§(å¯†åº¦, è´¨é‡, ç²˜æ€§),ä»¥æ ¼å­ä¸ºå•ä½æ¨¡æ‹Ÿæµä½“çš„å˜åŒ–, å°†æ¨¡æ‹Ÿç»“æœå†™å›ç²’å­</li></ul><hr /><h2 id="assignment-0">Assignment 0</h2><p><strong>ç¯å¢ƒé…ç½®(Arch Linux)</strong></p><p>ä¾èµ–åº“å®‰è£…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yay -S eigen opencv2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>ä½œä¸š</strong></p><ul><li>å®ç°æ—‹è½¬å¹¶ä½ç§» <span class="math display">\[\left[\begin{matrix}\cos\theta &amp; -\sin\theta &amp; t_x \\\sin\theta &amp; \cos\theta &amp; t_y \\0 &amp; 0 &amp; 1 \\\end{matrix}\right] \times P\]</span></li></ul><p><strong>å…¶ä»–</strong></p><p><code>eigen</code>çš„å‘é‡ä¹˜æ³•</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">Vector3d v(1,2,3);Vector3d w(0,1,2);cout &lt;&lt; &quot;Dot product: &quot; &lt;&lt; v.dot(w) &lt;&lt; endl;&#x2F;&#x2F;ç‚¹ä¹˜cout &lt;&lt; &quot;Dot product via a matrix product: &quot; &lt;&lt; v.adjoint()*w &lt;&lt; endl;&#x2F;&#x2F;ç‚¹ä¹˜cout &lt;&lt; &quot;Cross product:\n&quot; &lt;&lt; v.cross(w) &lt;&lt; endl;&#x2F;&#x2F;å‰ä¹˜<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„: å‰ä¹˜åªèƒ½ç”¨äºç»´æ•°ä¸º3çš„å‘é‡, ç‚¹ä¹˜ä½¿ç”¨äºä»»ä½•ç»´æ•°çš„å‘é‡</p><h2 id="assignment-1">Assignment 1</h2><p>ä½œä¸šéœ€è¦ä½¿ç”¨CPUæ¨¡æ‹Ÿå…‰æ …æ¸²æŸ“å™¨,æˆ‘ä»¬éœ€è¦å®Œæˆä¸€ä¸ªæ¨¡å‹å˜æ¢çŸ©é˜µä¸æŠ•å½±çŸ©é˜µ</p><ul><li><p>åˆ›å»ºä¸€ä¸ªç»•<span class="math inline">\(oz\)</span>æ—‹è½¬çŸ©é˜µ <spanclass="math display">\[\left[\begin{matrix}\cos x &amp; -\sin x &amp; 0 &amp; 0\\ \sin x &amp; \cos x &amp; 0&amp;0\\0 &amp; 0 &amp; 1 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 1\end{matrix}\right]\]</span></p></li><li><p>åˆ›å»ºä¸€ä¸ªæŠ•å½±çŸ©é˜µ <span class="math display">\[\left[\begin{matrix}n &amp; 0 &amp; 0 &amp; 0\\0 &amp; n &amp; 0 &amp;0\\0 &amp; 0 &amp; n+f &amp; -nf\\0 &amp; 0 &amp; 0 &amp; 1\end{matrix}\right]\]</span></p></li><li><p>ä½¿ç”¨ç½—å¾·æ ¼æ—‹è½¬å…¬å¼å®Œæˆé™„åŠ é¢˜ <span class="math display">\[R(\vec{n},\alpha) = \cos(\alpha)\vec{I} +(1-\cos(\alpha))\vec{n}\vec{n}^T+\sin(\alpha)\left(\begin{matrix}0&amp;-n_z&amp;n_y\\n_z&amp;0&amp;-n_x\\-n_y&amp;n_x&amp;0\end{matrix}\right)\]</span></p></li></ul><p>ç»“æœ</p><ul><li><p>ç»•<span class="math inline">\(oz\)</span>æ—‹è½¬</p><figure><img src="./img/rotate@(0,0,1).gif" alt="ç»•ozæ—‹è½¬" /><figcaption aria-hidden="true">ç»•ozæ—‹è½¬</figcaption></figure></li><li><p>ç»•<span class="math inline">\((1,1,1)/\sqrt{3}\)</span>æ—‹è½¬</p><figure><img src="./img/rotate@(1,1,1).gif" alt="ç»•(1,1,1)æ—‹è½¬" /><figcaption aria-hidden="true">ç»•(1,1,1)æ—‹è½¬</figcaption></figure></li></ul><h2 id="assignment-2">Assignment 2</h2><p>åœ¨ä½œä¸šä¸€çš„åŸºç¡€ä¸Šå®Œæˆ:</p><p><strong>åŸºç¡€éƒ¨åˆ†</strong></p><ul><li><p>åˆ›å»ºbounding box</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">const float INF &#x3D; 1.0 * 0x3f3f3f3f;float lf &#x3D; INF, rt &#x3D; -INF, bt &#x3D; INF, tp &#x3D; -INF;for(int i&#x3D;0;i&lt;3;i++)&#123;    lf &#x3D; std::min(lf, v[i].x());    rt &#x3D; std::max(rt, v[i].x());    bt &#x3D; std::min(bt, v[i].y());    tp &#x3D; std::max(tp, v[i].y());&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åˆ¤æ–­ç‚¹ä¸‰è§’å½¢å†…</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">static bool insideTriangle(float x, float y, const Vector3f* _v)&#123;    float cnt &#x3D; 0;    for(int i&#x3D;0;i&lt;3;i++)&#123;        const float x1 &#x3D; x - _v[i].x();        const float x2 &#x3D; x - _v[(i+1)%3].x();        const float y1 &#x3D; y - _v[i].y();        const float y2 &#x3D; y - _v[(i+1)%3].y();        const float v &#x3D; x1 * y2 - x2 * y1;        if(v !&#x3D; 0 &amp;&amp; v * cnt &gt;&#x3D; 0) cnt +&#x3D; v;        else if(v !&#x3D; 0)return false;    &#125;    return true;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç»´æŠ¤depth buffer</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">for(float x &#x3D; std::floor(lf); x&lt; std::ceil(rt);x+&#x3D;1.0)&#123;    for(float y &#x3D; std::floor(bt); y&lt; std::ceil(tp);y+&#x3D;1.0)&#123;        if(insideTriangle(x,y, t.v))&#123;            const float deep &#x3D; depth_buf[get_index(x,y)];            auto[alpha, beta, gamma] &#x3D; computeBarycentric2D(x, y, t.v);            float w_reciprocal &#x3D; 1.0&#x2F;(alpha &#x2F; v[0].w() + beta &#x2F; v[1].w() + gamma &#x2F; v[2].w());            float z_interpolated &#x3D; alpha * v[0].z() &#x2F; v[0].w() + beta * v[1].z() &#x2F; v[1].w() + gamma * v[2].z() &#x2F; v[2].w();            z_interpolated *&#x3D; w_reciprocal;            if(z_interpolated &lt; deep) &#123;                depth_buf[get_index(x,y)] &#x3D; z_interpolated;                set_pixel(Eigen::Vector3f(x,y,1), t.getColor());            &#125;        &#125;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>æé«˜éƒ¨åˆ†</strong></p><ul><li><p>æ”¹ä¸ºè¶…é‡‡æ ·</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">for(float x &#x3D; std::floor(lf); x&lt; std::ceil(rt);x+&#x3D;1.0)&#123;    for(float y &#x3D; std::floor(bt); y&lt; std::ceil(tp);y+&#x3D;1.0)&#123;        int idx &#x3D; 0;        for(float delx &#x3D; 0.25; delx&lt;&#x3D;1.0; delx+&#x3D;0.5)&#123;            for(float dely &#x3D; 0.25; dely&lt;&#x3D;1.0; dely+&#x3D;0.5)&#123;                const float deep &#x3D; depth_buf2[4 * get_index(x,y) + idx];                auto[alpha, beta, gamma] &#x3D; computeBarycentric2D(x+delx, y+dely, t.v);                float w_reciprocal &#x3D; 1.0&#x2F;(alpha &#x2F; v[0].w() + beta &#x2F; v[1].w() + gamma &#x2F; v[2].w());                float z_interpolated &#x3D; alpha * v[0].z() &#x2F; v[0].w() + beta * v[1].z() &#x2F; v[1].w() + gamma * v[2].z() &#x2F; v[2].w();                z_interpolated *&#x3D; w_reciprocal;                if(z_interpolated &lt; deep &amp;&amp; insideTriangle(x+delx,y+dely, t.v)) &#123;                    depth_buf2[4 * get_index(x,y) + idx] &#x3D; z_interpolated;                    col_buf2[4 * get_index(x,y) + idx] &#x3D; t.getColor();                &#125;                ++idx;            &#125;        &#125;        Eigen::Vector3f color &#x3D; Eigen::Vector3f&#123;0, 0, 0&#125;;        for(int i&#x3D;0;i&lt;4;i++)color &#x3D; color + col_buf2[4 * get_index(x,y) + i];        set_pixel(Eigen::Vector3f(x,y,1), color&#x2F;4);    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>ç»“æœ</strong></p><ul><li><p>æ— è¶…é‡‡æ ·</p><figure><img src="./img/origin.png" alt="æ— è¶…é‡‡æ ·" /><figcaption aria-hidden="true">æ— è¶…é‡‡æ ·</figcaption></figure></li><li><p>æ— è¶…é‡‡æ ·(æ”¾å¤§<span class="math inline">\(256\%\)</span>)</p><figure><img src="./img/origin@256.png" alt="æ— è¶…é‡‡æ ·æ”¾å¤§256%" /><figcaption aria-hidden="true">æ— è¶…é‡‡æ ·æ”¾å¤§256%</figcaption></figure></li><li><p><span class="math inline">\(2\times 2\)</span>è¶…é‡‡æ ·</p><figure><img src="./img/SSAA2x2.png" alt="2x2è¶…é‡‡æ ·" /><figcaption aria-hidden="true">2x2è¶…é‡‡æ ·</figcaption></figure></li><li><p><span class="math inline">\(2\times 2\)</span>è¶…é‡‡æ ·(æ”¾å¤§<spanclass="math inline">\(256\%\)</span>)</p><figure><img src="./img/SSAA2x2@256.png" alt="2x2è¶…é‡‡æ ·æ”¾å¤§256%" /><figcaption aria-hidden="true">2x2è¶…é‡‡æ ·æ”¾å¤§256%</figcaption></figure></li></ul><h2 id="assignment-3">Assignment 3</h2><p><strong>åŸºç¡€éƒ¨åˆ†</strong></p><ul><li><p>åˆ›å»ºbounding box, ç»´æŠ¤æ·±åº¦ç¼“å­˜, ä½¿ç”¨é‡å¿ƒåæ ‡+æ’å€¼è®¡ç®—é¢œè‰²,æ³•å‘é‡, æ·±åº¦, çº¹ç†åæ ‡</p></li><li><p>å¤ç”¨ä¹‹å‰çš„æŠ•å½±å‡½æ•°</p></li><li><p>è¡¥å…¨å¸ƒæ—å†¯æ¨¡å‹</p></li><li><p>è·å–çº¹ç†è´´å›¾ä¸Šçš„é¢œè‰², å¹¶ä½¿ç”¨å¸ƒæ—å†¯æ¨¡å‹ç€è‰²</p></li><li><p>è®¡ç®—å‡¹å‡¸è´´å›¾æ³•å‘é‡å¹¶ç€è‰²</p></li><li><p>è®¡ç®—ä½ç§»è´´å›¾æ³•å‘é‡å¹¶ç€è‰²</p></li></ul><p><strong>æé«˜éƒ¨åˆ†</strong></p><ul><li>æ‰¾å…¶ä»–æ¨¡å‹æ¸²æŸ“(ä½¿ç”¨çš„æ˜¯<code>/models/Crate</code>)</li><li>å°†è´´å›¾å°ºå¯¸ä»<span class="math inline">\(1024\times1024\)</span>ç¼©å°åˆ°<span class="math inline">\(512\times512\)</span></li><li>å®ç°åŒçº¿æ€§æ’å€¼</li><li>ä½¿ç”¨åŒçº¿æ€§æ’å€¼è·å–è´´å›¾é¢œè‰²</li><li>å¯¹æ¯”ä¸¤è€…åŒºåˆ«: åœ¨çœ¼çª, è¹„å­å¤„è¿‡æ¸¡æ›´åŠ é¡ºæ»‘, æ–‘ç‚¹è¢«æ”¾å¤§</li></ul><p><strong>ç»“æœ</strong></p><ul><li><p>ç›´æ¥æ¸²æŸ“</p><figure><img src="./img/normal.png" alt="ç›´æ¥æ¸²æŸ“" /><figcaption aria-hidden="true">ç›´æ¥æ¸²æŸ“</figcaption></figure></li><li><p>ä½¿ç”¨Blinn-Phongæ¨¡å‹æ¸²æŸ“</p><figure><img src="./img/phong.png" alt="Blinn-Phong" /><figcaption aria-hidden="true">Blinn-Phong</figcaption></figure></li><li><p>çº¹ç†è´´å›¾</p><figure><img src="./img/texture.png" alt="å‡¹å‡¸è´´å›¾çº¹ç†è´´å›¾" /><figcaption aria-hidden="true">å‡¹å‡¸è´´å›¾çº¹ç†è´´å›¾</figcaption></figure></li><li><p>å‡¹å‡¸è´´å›¾</p><figure><img src="./img/bump.png" alt="å‡¹å‡¸è´´å›¾" /><figcaption aria-hidden="true">å‡¹å‡¸è´´å›¾</figcaption></figure></li><li><p>ä½ç§»è´´å›¾</p><figure><img src="./img/displacement.png" alt="ä½ç§»è´´å›¾" /><figcaption aria-hidden="true">ä½ç§»è´´å›¾</figcaption></figure></li><li><p>æ¸²æŸ“ä¸€ä¸ªç«‹æ–¹ä½“-Blinn-Phongæ¨¡å‹</p><figure><img src="./img/Crate-Phong.png" alt="ç«‹æ–¹ä½“-Blinn-Phong" /><figcaption aria-hidden="true">ç«‹æ–¹ä½“-Blinn-Phong</figcaption></figure></li><li><p>æ¸²æŸ“ä¸€ä¸ªç«‹æ–¹ä½“-çº¹ç†è´´å›¾</p><figure><img src="./img/Crate-texture.png" alt="ç«‹æ–¹ä½“-çº¹ç†è´´å›¾" /><figcaption aria-hidden="true">ç«‹æ–¹ä½“-çº¹ç†è´´å›¾</figcaption></figure></li><li><p>ä¸ä½¿ç”¨åŒçº¿æ€§æ’å€¼æ¸²æŸ“ç‰›(ä½¿ç”¨<span class="math inline">\(521\times521\)</span>çº¹ç†)</p><figure><img src="./img/no-Bilinear.png" alt="ä¸ä½¿ç”¨åŒçº¿æ€§æ’å€¼" /><figcaption aria-hidden="true">ä¸ä½¿ç”¨åŒçº¿æ€§æ’å€¼</figcaption></figure></li><li><p>ä½¿ç”¨åŒçº¿æ€§æ’å€¼æ¸²æŸ“ç‰›(ä½¿ç”¨<span class="math inline">\(521\times521\)</span>çº¹ç†)</p><figure><img src="./img/Bilinear.png" alt="ä½¿ç”¨åŒçº¿æ€§æ’å€¼" /><figcaption aria-hidden="true">ä½¿ç”¨åŒçº¿æ€§æ’å€¼</figcaption></figure></li><li><p>ä¸¤è€…å·®åˆ«</p><figure><img src="./img/diff-Bilinear.png" alt="ä¸¤è€…å·®åˆ«" /><figcaption aria-hidden="true">ä¸¤è€…å·®åˆ«</figcaption></figure></li></ul><h2 id="assignment-4">Assignment 4</h2><p>å®Œæˆè´å¡å°”æ›²çº¿ä¸åèµ°æ ·:</p><p><strong>ç»“æœ</strong></p><ul><li><p>è´å¡å°”æ›²çº¿å¤šé¡¹å¼è®¡ç®—ä¸æ¨¡æ‹Ÿç»“æœå¯¹æ¯”</p><figure><img src="./img/diff-naive-decast.png" alt="ç»“æœå¯¹æ¯”" /><figcaption aria-hidden="true">ç»“æœå¯¹æ¯”</figcaption></figure></li><li><p>åŠ å…¥åèµ°æ ·åæ•ˆæœ(ä¸Šåˆ°ä¸‹: åèµ°æ ·-æ¨¡æ‹Ÿå®ç°-å‡½æ•°å®ç°)</p><figure><img src="./img/anti-decast-naive.png" alt="åŠ å…¥åèµ°æ ·" /><figcaption aria-hidden="true">åŠ å…¥åèµ°æ ·</figcaption></figure></li></ul><h2 id="assignment-5">Assignment 5</h2><p>å®ŒæˆPrime Rayç”Ÿæˆ, Prime Rayä¸ä¸‰è§’å½¢ç›¸äº¤æ£€æµ‹:</p><p><strong>ç»“æœ</strong></p><ul><li><img src="./img/binary.png" /></li></ul><h2 id="assignment-6">Assignment 6</h2><ul><li><p>å®ç°å…‰çº¿ç”Ÿæˆä¸å…‰çº¿æ˜ å°„</p></li><li><p>å®ç°å…‰çº¿ä¸ä¸‰è§’å½¢ç›¸äº¤åˆ¤æ–­</p></li><li><p>åˆ¤æ–­ç‚¹ä¸Bounding Boxç›¸äº¤</p></li><li><p>è®¡ç®—å…‰çº¿ä¸æ›²é¢è·ç¦»</p></li><li><p>å®ç°SAHåŠ é€Ÿ</p><p>SAHè®¤ä¸ºå…‰çº¿ç©¿é€ä¸€ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡ä¸å…¶è¡¨é¢ç§¯æˆæ¯”ä¾‹.å°†å­BoundingBoxä½œä¸ºä¸€ä¸ªæ•´ä½“,ç¨‹åºæ€»æ€§èƒ½æ¶ˆè€—æœŸæœ›åº”è¯¥æ˜¯æ¯ä¸ªå­èŠ‚ç‚¹æ¶ˆè€—åŠ æƒè¢«é€‰ä¸­çš„æ¦‚ç‡å‡å€¼<spanclass="math inline">\(C=C_{traw}+p_xC_{x}+p_yC_{y}\)</span>(è®¤ä¸º<spanclass="math inline">\(C_{traw}\)</span>æ˜¯å¸¸æ•°). æ€»æœŸæœ›æ¶ˆè€—ä¸­,å­åŒºåŸŸæ¶ˆè€—å¯ä»¥è¡¨ç¤ºä¸ºå…ƒç´ æ•°é‡*å…ƒç´ è¡¨é¢ç§¯. <span class="math display">\[C=C_{traw}+\|A\|\frac{S_A}{S}C_{isect}+\|B\|\frac{S_B}{S}p_yC_{isect}\]</span> ($ C_{isect}$æ˜¯åˆ¤æ–­å°„çº¿ä¸ç‰©ä½“æ˜¯å¦ç›¸äº¤çš„èŠ±è´¹)</p><p>æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æœ€å°åŒ–<span class="math inline">\(C\)</span>.å¯ä»¥æ¯ä¸ªå‡ ä¸ªç‚¹é‡‡æ ·, å–æ¶ˆè€—æœ€å°çš„<spanclass="math inline">\(C\)</span>ä½œä¸ºå­åŒºåŸŸåˆ†å‰²ç‚¹. ç”±äº<spanclass="math inline">\(C\)</span>æ˜¯<spanclass="math inline">\(U\)</span>å½¢å‡½æ•°, ä¹Ÿå¯ä»¥ä¸‰åˆ†å®ç°.</p><p>ä½†æ˜¯åœ¨æœ¬ä¾‹å­ä¸­SAHåŠ é€Ÿæ•ˆæœå¹¶ä¸æ˜æ˜¾(åŠ é€Ÿ<spanclass="math inline">\(5.52\%\)</span>), è¿™å¯èƒ½æ˜¯å› ä¸ºç‰©ä½“åˆ†å¸ƒè¿‡äºå‡è¡¡,å¯¼è‡´çš„åˆ†å‰²ç‚¹ä¸BVHé€‰å–çš„é‡å¿ƒä¸­ç‚¹ç›¸è¿‘. å¦‚æœæ¸²æŸ“çš„æ˜¯ä¸€ä¸ªç©ºæ—·åœºåœ°,æ•ˆæœå¯èƒ½ä¼šå¥½ä¸€äº›</p></li></ul><p><strong>ç»“æœ</strong></p><ul><li><p>BVHåŠ é€Ÿç»“æ„(1467s)</p><p><img src="./img/BVH.png" /></p></li><li><p>SAHåŠ é€Ÿç»“æ„(1386s)</p><p><img src="./img/SAH.png" /></p></li></ul><h2 id="assignment-7">Assignment 7</h2><p>å®ç°è·¯å¾„è¿½è¸ªä¸å¾®è¡¨é¢</p><p>ä»£ç ä¸­Sceneåˆ†ç±»ä¸å‚æ•°è§£é‡Š</p><p><img src="./img/Scene.png" /></p><p><strong>ç»“æœ</strong></p><ul><li><p>cornellboxå…‰çº¿è¿½è¸ª(SPP = 256, cost = 93min)</p><p><img src="./img/cornellbox-SPP-256.png" /></p></li><li><p>cornellboxå…‰çº¿è¿½è¸ª(SPP = 1024, cost = 11h)</p><p><img src="./img/cornellbox-SPP-1024.png" /></p></li><li><p>cornellboxå…‰çº¿è¿½è¸ª(SPP = 16384, cost = 177h)</p><p><img src="./img/cornellbox-SPP-16384.png" /></p></li></ul><h2 id="assignment-8">Assignment 8</h2><p>ä½¿ç”¨æ˜¾/éšæ¨¡å¼æ¬§æ‹‰ä¸æ˜¾å¼Verletæ–¹æ³•å®ç°è´¨ç‚¹å¼¹ç°§ç³»ç»Ÿ</p><p><strong>ç»“æœ</strong></p><ul><li><p>æ˜¾å¼æ¬§æ‹‰æ–¹æ³•, ä¸æ·»åŠ é˜»å°¼<del>(é—ªç”µäº”è¿é­)</del></p><figure><img src="./img/Euler-without-dapming.gif"alt="Euler-without-dapming" /><figcaption aria-hidden="true">Euler-without-dapming</figcaption></figure></li><li><p>æ˜¾å¼æ¬§æ‹‰æ–¹æ³•, æ·»åŠ é˜»å°¼</p><figure><img src="./img/Euler-with-dapming.gif" alt="Euler-with-dapming" /><figcaption aria-hidden="true">Euler-with-dapming</figcaption></figure></li><li><p>éšå¼æ¬§æ‹‰æ–¹æ³•ä¸Verletæ–¹æ³•</p><figure><img src="./img/Implicii-Euler-with-dapming-verlet.gif"alt="Euler-without-dapming" /><figcaption aria-hidden="true">Euler-without-dapming</figcaption></figure></li></ul>]]></content>
    
    
    <summary type="html">å­¦WebGLä¹‹å‰å…ˆæ¥è¡¥ä¹ äº†ä¸€ä¸‹å›¾å½¢å­¦åŸºç¡€çŸ¥è¯†,ä¸»è®²:é—«ä»¤çª,è§†é¢‘æ¥è‡ªBç«™:BV1X7411F744</summary>
    
    
    
    <category term="è®¡ç®—æœºç†è®º" scheme="https://blog.liukairui.me/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%90%86%E8%AE%BA/"/>
    
    <category term="è®¡ç®—æœºå›¾å½¢å­¦" scheme="https://blog.liukairui.me/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%90%86%E8%AE%BA/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
    
    <category term="ç¬”è®°" scheme="https://blog.liukairui.me/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="è®¡ç®—æœºç†è®º" scheme="https://blog.liukairui.me/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%90%86%E8%AE%BA/"/>
    
    <category term="è®¡ç®—æœºå›¾å½¢å­¦" scheme="https://blog.liukairui.me/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>æ•°ç‘Cookieæ··æ·†æ˜¯å¦‚ä½•å·¥ä½œçš„</title>
    <link href="https://blog.liukairui.me/article/%E6%95%B0%E7%91%9ECookie%E6%B7%B7%E6%B7%86%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84/"/>
    <id>https://blog.liukairui.me/article/%E6%95%B0%E7%91%9ECookie%E6%B7%B7%E6%B7%86%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84/</id>
    <published>2022-04-01T12:01:50.000Z</published>
    <updated>2022-04-01T12:01:50.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>æˆ‘çš„æ ·æœ¬æ–‡ä»¶<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0thaXJ1aUxpdS9hdXRvLWNsb2NrLWluLXN6eGQvdHJlZS9tYXN0ZXIvaG93LWl0LXdvcmsvcnVpc2h1">åœ¨æ­¤<i class="fa fa-external-link-alt"></i></span></strong></p><p>æœ¬æ¬¡åˆ†ææ–‡ä»¶ç‰¹å¾</p><ul><li><p>è¯·æ±‚HTMLæ–‡ä»¶åŒ…å«:<code>set-cookie: 36501JSESSIONID</code>ä¸<code>set-cookie: lD01YhBPHVTHO</code>,åœ¨dev-toolsçš„åº”ç”¨é¢æ¿ä¸­æŸ¥åˆ°<code>cookie: lD01YhBPHVTHP</code></p></li><li><p>HTMLå¼•å…¥JSæ–‡ä»¶<code>cIZgBeQvEQK9/AiHJXIs5GyJH.dee59c7.js</code></p></li><li><p>JSæ–‡ä»¶å¼€å¤´ä¸º<code>$_ts...$_ts['dee59c7']</code>,å…¶ä¸­<code>dee59c7</code>ä¸ºç‰ˆæœ¬</p></li><li><p>HTMLä¸­JSå¤šä¸ºå¦‚ä¸‹å½¢å¼</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">_$lt</span><span class="token punctuation">(</span><span class="token parameter">_$<span class="token constant">EZ</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> _$aS <span class="token operator">=</span> _$<span class="token constant">EZ</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>  <span class="token keyword">var</span> _$$<span class="token constant">N</span><span class="token punctuation">,</span>    _$<span class="token constant">VC</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">_</span>$<span class="token constant">XD</span><span class="token punctuation">(</span>_$aS <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    _$vC <span class="token operator">=</span> _$<span class="token constant">EZ</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">97</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> _$Vw <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> _$<span class="token constant">JP</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> _$<span class="token constant">JP</span> <span class="token operator">&lt;</span> _$aS<span class="token punctuation">;</span> <span class="token operator">++</span>_$<span class="token constant">JP</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    _$$<span class="token constant">N</span> <span class="token operator">=</span> _$<span class="token constant">EZ</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>_$<span class="token constant">JP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>_$$<span class="token constant">N</span> <span class="token operator">>=</span> <span class="token number">40</span> <span class="token operator">&amp;&amp;</span> _$$<span class="token constant">N</span> <span class="token operator">&lt;</span> <span class="token number">92</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      _$$<span class="token constant">N</span> <span class="token operator">+=</span> _$vC<span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>_$$<span class="token constant">N</span> <span class="token operator">>=</span> <span class="token number">92</span><span class="token punctuation">)</span> _$$<span class="token constant">N</span> <span class="token operator">=</span> _$$<span class="token constant">N</span> <span class="token operator">-</span> <span class="token number">52</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_$$<span class="token constant">N</span> <span class="token operator">>=</span> <span class="token number">97</span> <span class="token operator">&amp;&amp;</span> _$$<span class="token constant">N</span> <span class="token operator">&lt;</span> <span class="token number">127</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      _$$<span class="token constant">N</span> <span class="token operator">+=</span> _$vC<span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>_$$<span class="token constant">N</span> <span class="token operator">>=</span> <span class="token number">127</span><span class="token punctuation">)</span> _$$<span class="token constant">N</span> <span class="token operator">=</span> _$$<span class="token constant">N</span> <span class="token operator">-</span> <span class="token number">30</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    _$<span class="token constant">VC</span><span class="token punctuation">[</span>_$Vw<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> _$$<span class="token constant">N</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token function">_$yn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> _$<span class="token constant">VC</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="å¤§è‡´å·¥ä½œåŸç†">å¤§è‡´å·¥ä½œåŸç†</h4><ul><li>è·å–HTMLæ–‡ä»¶, HTMLæ–‡ä»¶æºå¸¦ä¸¤ä¸ªCookie</li><li>HTMLè¯·æ±‚JSæ–‡ä»¶(JSæ–‡ä»¶ä¸ºä¹±ç )</li><li>HTMLä¸­JSè§£å¯†JSæ–‡ä»¶, å¾—åˆ°JSå­—ç¬¦ä¸²</li><li>ä½¿ç”¨<code>eval</code>æ‰§è¡ŒJSå­—ç¬¦ä¸²,JSå­—ç¬¦ä¸²è®¡ç®—å¹¶è®¾ç½®åŠ å¯†<code>Cookie</code>(<code>lD01YhBPHVTHP</code>)</li><li>ç¦»è°±çš„æ˜¯<code>RUISHUTESTFUNCTIONENTRY</code>æ¯æ¬¡è¯·æ±‚è·å–å€¼ä¸åŒ(å…¶ä¸­é™¤äº†<code>$_ts</code>ä¹‹å¤–å˜é‡åéƒ½æ˜¯å˜åŒ–çš„,ä½†æ˜¯ä¿è¯æ¯æ¬¡è®¡ç®—ç»“æœç›¸åŒ)</li></ul><h4 id="è§£å†³æ€è·¯">è§£å†³æ€è·¯</h4><p>å°†ä»£ç ä»å‹ç¼©(å•è¡Œ)å½¢å¼è½¬ä¸ºæ ¼å¼åŒ–åçš„å¤šè¡Œæ¨¡å¼, æ–¹ä¾¿debug</p><h4 id="å‡†å¤‡å·¥ä½œè§£å†³åŠ¨æ€js">å‡†å¤‡å·¥ä½œ(è§£å†³åŠ¨æ€JS)</h4><p>ç”±äºJSä¸HTMLä¸­å˜é‡éƒ½æ˜¯åŠ¨æ€çš„,æ‰“å¼€ç½‘ç«™å<code>Ctrl+S</code>ä¿å­˜å…¨éƒ¨æ–‡ä»¶. åœ¨VSCodeä¸­æ‰“å¼€HTMLæ–‡ä»¶,ä½¿ç”¨æ ¼å¼åŒ–å·¥å…·æ ¼å¼åŒ–, å¾—åˆ°å¦‚ä¸‹å½¢å¼HTML</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>  <span class="token comment">&lt;!-- ... --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;qXVS74Mnw/*...*/03336qqqqqqqq<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../cIZgBeQvEQK9/AiHJXIs5GyJH.dee59c7.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> _$<span class="token constant">XI</span> <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span>    <span class="token comment">// _$_0 = [</span>      <span class="token comment">// [14, 10, 13, 15, 12, 1, 0, 8, 5, 12, 7, 3, 2, 9, 12, 11, 5],</span>      <span class="token comment">// [</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- ... --></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­</p><ul><li><code>&lt;meta&gt;</code>ä¸­å­—ç¬¦ä¸²å‚ä¸åŠ å¯†</li><li>ç¬¬ä¸€ä¸ª<code>&lt;script&gt;</code>è¯·æ±‚ä¹±ç JS</li><li>ç¬¬äºŒä¸ª<code>&lt;script&gt;</code>ä¸­çš„ç«‹å³æ‰§è¡Œå‡½æ•°æ˜¯"è§£ç å™¨"</li></ul><p>ä¸ºäº†æ–¹ä¾¿åˆ†æ, æˆ‘ä»¬å°†ç«‹å³æ‰§è¡Œå‡½æ•°åˆ†ç¦»åˆ°<code>outer.js</code>å¹¶å¼•å…¥</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;qXVS7/*...*/3703336qqqqqqqq<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../cIZgBeQvEQK9/AiHJXIs5GyJH.dee59c7.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>js/outer.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>åœ¨<code>outer.js</code>ç«‹å³æ‰§è¡Œå‡½æ•°å‰åŠ å…¥<code>debugger</code>è¿™æ ·æˆ‘ä»¬å¯ä»¥åœ¨è§£å¯†å‰æš‚åœ</p><p>æˆ‘ä»¬ä½¿ç”¨æœ¬åœ°JSæ–‡ä»¶è¿›è¡Œåˆ†æ, æˆ¿å­å˜é‡æ¢æ¥æ¢å»</p><p>åœ¨ä¿å­˜æ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python -m http.server 8081<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ ·åœ¨<code>0.0.0.0:8081</code>å¼€å¯äº†ä¸€ä¸ªweb server</p><h4id="æ¸…ç©ºè‡ªå¸¦debuggerè§£å†³å‰ç«¯åè°ƒè¯•">æ¸…ç©ºè‡ªå¸¦debugger(è§£å†³å‰ç«¯åè°ƒè¯•)</h4><p>ç‘æ•°çš„å‰ç«¯åè°ƒè¯•å°±æ˜¯æ³¨å†Œäº†å‡ ä¸ªå®šæ—¶å™¨,æ¯500mså»<code>eval(function)</code>,è¿™ä¸ªfunctionè·å–ä¸€ä¸ªæ—¶é—´æˆ³å¹¶debugger. ä¸¤ä¸ªè§£å†³æ–¹æ³•</p><ul><li><p>åœ¨debuggerçš„è¡Œå·å¤„å³é”®, é€‰æ‹©ä¸€å¾‹ä¸å†æ­¤å¤„æš‚åœ,çœ‹åˆ°å‡ºç°ä¸€ä¸ªé»„è‰²é—®å·è¡¨ç¤ºå¿½ç•¥äº†è¿™ä¸ªdebugger</p></li><li><p>å€ŸåŠ©JSæ˜¯å•çº¿ç¨‹çš„, åœ¨debuggeræ—¶å€™æ‰§è¡Œ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">999999</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>  <span class="token function">clearInterval</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul><h4id="åŠ«æŒcookieä¸eval">åŠ«æŒ<code>cookie</code>ä¸<code>eval</code></h4><p>åœ¨å‰é¢ä»‹ç»ä¸­, æˆ‘ä»¬çŸ¥é“, è¿™æ®µJSçš„ä½œç”¨å°±æ˜¯å®šæ—¶<code>set-cookie</code>.æ‰€ä»¥æˆ‘ä»¬è¦å°†<code>cookie</code>çš„<code>set</code>ä¸<code>get</code>è¿›è¡Œé‡å†™,æ–¹ä¾¿åœ¨è¯»å†™cookieæ—¶æš‚åœ, è¿›è¡Œå †æ ˆåˆ†æ.åœ¨<code>outer.js</code>è¢«<code>debugger</code>æš‚åœçš„æ—¶å€™, å†™å…¥</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> _cookie <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">__lookupSetter__</span><span class="token punctuation">(</span><span class="token string">'cookie'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// ç§»èµ°cookie</span>document<span class="token punctuation">.</span><span class="token function">__defineSetter__</span><span class="token punctuation">(</span><span class="token string">"cookie"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>       <span class="token comment">// é‡è®¾cookie</span>  <span class="token keyword">debugger</span><span class="token punctuation">;</span>  _cookie<span class="token operator">=</span>c<span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">__defineGetter__</span><span class="token punctuation">(</span><span class="token string">"cookie"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">debugger</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> _cookie<span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŒæ ·, è§£å¯†å‡½æ•°éœ€è¦å…ˆè§£å¯†åŠ å¯†ä¸²,ç„¶åéœ€è¦ä½¿ç”¨<code>eval</code>æ‰§è¡Œè§£å¯†JS,æ‰€ä»¥éœ€è¦åŠ«æŒ<code>eval</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">orig <span class="token operator">=</span> window<span class="token punctuation">.</span>eval<span class="token punctuation">;</span>window<span class="token punctuation">.</span><span class="token function-variable function">eval</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">debugger</span><span class="token punctuation">;</span><span class="token function">orig</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>window<span class="token punctuation">.</span>eval<span class="token punctuation">.</span><span class="token function-variable function">toString</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> orig<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="åˆ†æevalå…¥å£">åˆ†æ<code>eval</code>å…¥å£</h4><p>åœ¨dev-toolsä¸­æ‰§è¡Œä»£ç , ä»£ç ä»<code>outer.js</code>çš„é¦–è¡Œå¼€å§‹æ‰§è¡Œ,æš‚åœåœ¨äº†<code>eval</code>, åœ¨è°ƒç”¨å †æ ˆä¸­é€‰åˆ°ä¸Šä¸€çº§<code>_$XC</code>,çœ‹åˆ°æ­£åœ¨æ‰§è¡Œçš„ä»£ç </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">_$aS <span class="token operator">=</span> _$$<span class="token constant">N</span><span class="token punctuation">[</span>_$6p<span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_$qP<span class="token punctuation">,</span> _$<span class="token constant">EZ</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p><code>_$$N</code>: æœªçŸ¥å‡½æ•°</p></li><li><p><code>_$6p</code>: å¯ä»¥çœ‹åˆ°æ˜¯ä¸€ä¸ªå˜é‡æ›¿æ¢è¡¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token operator">:</span> <span class="token string">"&#125;"</span><span class="token number">1</span><span class="token operator">:</span> <span class="token string">"$_ts"</span><span class="token number">2</span><span class="token operator">:</span> <span class="token string">","</span><span class="token number">3</span><span class="token operator">:</span> <span class="token string">"random"</span><span class="token number">4</span><span class="token operator">:</span> <span class="token string">"substr"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>_$6p[47]</code>: <code>call</code></p></li><li><p><code>_$qP</code>: <code>window</code></p></li><li><p><code>_$EZ</code> : ä¸€ä¸ª172Kçš„ä»£ç </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">var</span> _$1U<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>_$f8<span class="token operator">=</span>$_ts<span class="token punctuation">.</span>scj<span class="token punctuation">,</span>_$v4<span class="token operator">=</span>$_ts<span class="token punctuation">.</span>aebi<span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">_$yB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">var</span> _$vI<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">730</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_$vI<span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">_$iv</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>_$vI<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">_$9j</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">var</span> _$vI<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">709</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_$vI<span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">_$iv</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>_$vI<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">_$b_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">var</span> _$vI<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">614</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_$vI<span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">_$iv</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>_$vI<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">_$Th</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">var</span> _$vI<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">185</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_$vI<span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">_$iv</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>_$vI<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> _$<span class="token constant">IT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">var</span> _$vI<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">607</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_$vI<span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">_$iv</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>_$vI<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">_$Hj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">var</span> _$vI<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">810</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_$vI<span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">_$iv</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>_$vI<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/*...*/</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><p>æ˜¯è¿™ä¸ªè¡¨è¾¾å¼è°ƒç”¨çš„<code>evla</code>,æ‰€ä»¥åªèƒ½æ˜¯<code>_$$N</code>æ˜¯<code>eval</code>,è¿™ä¸ªè¡¨è¾¾å¼å¤§æ¦‚æ„æ€å°±æ˜¯</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">_$aS <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">'ä¸€ä¸ªé•¿é•¿çš„String'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¹Ÿå°±æ˜¯è¯´, è¿™ä¸ªStringå°±æ˜¯å¾…é‡Šæ”¾çš„ä»£ç .ä¿å­˜Stringä¸º<code>inner.js</code>, æ ¼å¼åŒ–ä»£ç , å¹¶æ›¿æ¢å¯¼å‡º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function-variable function">RUISHUTESTFUNCTIONENTRY</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">  if (60 &#x3D;&#x3D;&#x3D; 20 * _$LZ) &#123;-   _$aS &#x3D; _$$N[_$6p[47]](_$qP, _$EZ);+   RUISHUTESTFUNCTIONENTRY();  &#125; else if (_$LZ * 69 &#x3D;&#x3D;&#x3D; 69) &#123;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç›¸å½“äºæˆ‘ä»¬æ‰‹åŠ¨é‡Šæ”¾äº†è§£å¯†å‡½æ•°, ä½†æ˜¯ä½¿ç”¨æˆ‘ä»¬çš„æ–¹æ³•å, ä¸ä¼šå‡ºç°å¦‚ä¸‹æƒ…å½¢:è§£å¯†ä»£ç é‡Šæ”¾ä¸ºå•è¡Œ, è¿”å›å †æ ˆæ—¶åªèƒ½çœ‹åˆ°ä¸€è¡Œ, å®Œå…¨æ— æ³•debug</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">debugger</span><span class="token operator">></span> <span class="token constant">XXX</span><span class="token operator">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ³¨æ„, è¿™ä¸æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ é™¤<code>AiHJXIs5GyJH.dee59c7.js</code>,æ‰“å¼€å°±å¯ä»¥çœ‹åˆ°, æˆ‘ä»¬è§£å¯†çš„å­—ç¬¦ä¸²å¼€å¤´ä¸å…¶ä¸åŒ</p><ul><li><p>æˆ‘ä»¬è§£å¯†çš„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> _$1U <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>    _$f8 <span class="token operator">=</span> $_ts<span class="token punctuation">.</span>scj<span class="token punctuation">,</span>    _$v4 <span class="token operator">=</span> $_ts<span class="token punctuation">.</span>aebi<span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">_$yB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> _$vI <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">730</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_$vI<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">_$iv</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> _$vI<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åŸæ–‡ä»¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">$_ts<span class="token operator">=</span>window<span class="token punctuation">[</span><span class="token string">'$_ts'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>$_ts<span class="token punctuation">)</span>$_ts<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>$_ts<span class="token punctuation">.</span>scj<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>$_ts<span class="token punctuation">[</span><span class="token string">'dee59c7'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><p>æ‰¾ç‚¹ç‰¹æ®Šä»£ç æ¯”å¯¹, æˆ‘æ‰¾äº†</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">'=a"S%$Y\'tU9q.C,~NQy-^|6rXh:H?M[&lt;@fK;0W+VI2RiJ(FencmskgL#OBT>\\4Gj`P&amp;1_wD7oZxAb]&#125;updv5Ez) *3&#123;!l8/'</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‘ç°åœ¨<code>AiHJXIs5GyJH.dee59c7.js</code>ä¹Ÿå­˜åœ¨</p><p>å¯ä»¥å¤§èƒ†çš„çŒœæµ‹æ‰§è¡Œé€»è¾‘:</p><ul><li>åŠ è½½<code>AiHJXIs5GyJH.dee59c7.js</code>,é‡Šæ”¾å˜é‡(è™½ç„¶å˜é‡å€¼å¯èƒ½æ˜¯ä¹±ç )</li><li>åŠ è½½è§£å¯†å™¨</li><li>è§£å¯†å™¨è§£å¯†<code>AiHJXIs5GyJH.dee59c7.js</code>å¹¶è·å¾—å¾…é‡Šæ”¾JSå­—ç¬¦æŸ¥</li><li>é‡Šæ”¾JS, æ‰§è¡Œè®¡ç®—é€»è¾‘</li></ul><p>æˆ‘ä»¬åšçš„äº‹æƒ…å°±æ˜¯åŠ«æŒevalçš„å†…å®¹, å¹¶æ ¼å¼åŒ–ä»£ç , æ‰‹åŠ¨é‡Šæ”¾, æ–¹ä¾¿è°ƒè¯•.ä¸ºæ­¤, HTMLåº”å˜ä¸ºå¦‚ä¸‹ç»“æ„</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;qXVS7/*...*/3703336qqqqqqqq<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../cIZgBeQvEQK9/AiHJXIs5GyJH.dee59c7.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>js/inner.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>js/outer.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><hr /><p>é‡æ–°åŠ è½½ç½‘é¡µ, ç»§ç»­æ•è·</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> _$<span class="token constant">ET</span> <span class="token operator">=</span> _$<span class="token constant">Z5</span><span class="token punctuation">[</span>_$<span class="token constant">SH</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_$qP<span class="token punctuation">[</span>_$<span class="token constant">SH</span><span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'; '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ£€æŸ¥å˜é‡</p><ul><li><p><code>_$SH[9]</code>: <code>"call"</code></p></li><li><p><code>_$Z5</code>: <code>split</code></p></li><li><p><code>_$SH</code>: å¯ä»¥çœ‹åˆ°æ˜¯ä¸€ä¸ªå˜é‡æ›¿æ¢è¡¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">723</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span> â€¦ <span class="token number">99</span><span class="token punctuation">]</span><span class="token number">0</span><span class="token operator">:</span> <span class="token string">"prototype"</span><span class="token number">1</span><span class="token operator">:</span> <span class="token string">"type"</span><span class="token number">2</span><span class="token operator">:</span> <span class="token string">"toString"</span><span class="token number">3</span><span class="token operator">:</span> <span class="token string">"readyState"</span><span class="token number">4</span><span class="token operator">:</span> <span class="token string">"concat"</span><span class="token number">5</span><span class="token operator">:</span> <span class="token string">"indexOf"</span><span class="token number">6</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token number">7</span><span class="token operator">:</span> <span class="token string">"body"</span><span class="token number">8</span><span class="token operator">:</span> <span class="token string">"slice"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>_$qP</code>: <code>document</code></p></li><li><p><code>_$SH[43]</code>: <code>cookie</code></p></li></ul><p>ä¹Ÿå°±æ˜¯è¿™å¥æŒ‡ä»¤çš„æ„æ€æ˜¯</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">_$<span class="token constant">ET</span> <span class="token operator">=</span> split<span class="token punctuation">[</span><span class="token string">'call'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>document<span class="token punctuation">[</span><span class="token string">'cookie'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">';'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å€¼å¾—æ³¨æ„åˆ°æ˜¯3806è¡Œä¸Šé¢çš„ä»£ç ,Chromeç»™å‡ºæç¤º<code>_$CG='lD01YhBPHVTHP='</code>.è¿™å°±æ˜¯æˆ‘ä»¬è¦æ‹¼çš„å¤´å•Š!</p><p>æ²¡ä»€ä¹ˆæ„æ€...ç»§ç»­æ‰§è¡Œ</p><hr /><p>æš‚åœåˆ°äº†<code>cookie.setter</code>, è¿”å›ä¸Šçº§å †æ ˆ<code>_$iv</code>,ç»§ç»­æ£€æŸ¥</p><ul><li><code>_$qP</code>: <code>document</code></li><li><code>_$SH[43]</code>: <code>cookie</code></li><li><code>_$qS</code>: "enable_lD01YhBPHVTH=true"</li></ul><p>ç›¸å½“äºè®¾ç½®äº†ä¸€ä¸ªcookie, è¿™ä¸ªcookieæ˜¯ä¸€ä¸ªä¸´æ—¶çš„(å¤šåˆ·æ–°å‡ æ¬¡å°±å‘ç°äº†),ç»§ç»­æ‰§è¡Œ</p><hr /><p>æš‚åœåˆ°äº†<code>eval</code>, è¿”å›ä¸Šå±‚å †æ ˆ<code>_$iv</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">_$<span class="token constant">ET</span> <span class="token operator">=</span> <span class="token function">_$qt</span><span class="token punctuation">(</span>_$<span class="token constant">SH</span><span class="token punctuation">[</span><span class="token number">615</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>_$SH[615]</code>:<code>"Z8XHJJY.bmF0aXZlRmlVyUHJ()"</code></li><li><code>_$SH</code>æ˜¯å˜é‡æ›¿æ¢è¡¨</li><li><code>_$qt</code>: <code>Æ’ (str)&#123;debugger;orig(str);&#125;</code>è¿™å°±æ˜¯æˆ‘ä»¬åŠ«æŒçš„<code>eval</code></li></ul><p>å¯æƒœè¿™æ¬¡æ‰§è¡Œå¤±è´¥äº†, å› ä¸ºæ²¡æœ‰<code>Z8XHJJY</code>,ç¨‹åºè¿›å…¥ä¸‹é¢çš„<code>catch()</code>å¹¶å‡ºæ¥</p><hr /><p>ç»§ç»­æ‰§è¡Œ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">_$<span class="token constant">ET</span> <span class="token operator">=</span> <span class="token function">_$qt</span><span class="token punctuation">(</span>_$<span class="token constant">SH</span><span class="token punctuation">[</span><span class="token number">661</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åŒä¸Š, è½å…¥catch</p><hr /><p>ç»§ç»­æ‰§è¡Œ, æš‚åœåœ¨<code>cookie.set</code>,æŸ¥çœ‹å †æ ˆ<code>_$iv</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">_$qP<span class="token punctuation">[</span>_$<span class="token constant">SH</span><span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span>      <span class="token comment">// document.cookie =</span>      _$<span class="token constant">CG</span> <span class="token operator">+</span>          <span class="token comment">// åˆšåˆšé‡åˆ°è¿‡, æ˜¯æˆ‘ä»¬éœ€è¦çš„"lD01YhBPHVTHP"</span>      _$<span class="token constant">SH</span><span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">]</span> <span class="token operator">+</span>      <span class="token comment">// `=`</span>      _$41 <span class="token operator">+</span>          <span class="token comment">// lD01YhBPHVTHPçš„å€¼</span>      <span class="token function">_$iv</span><span class="token punctuation">(</span><span class="token number">994</span><span class="token punctuation">)</span> <span class="token operator">+</span>     <span class="token comment">// ''</span>      _$<span class="token constant">SH</span><span class="token punctuation">[</span><span class="token number">589</span><span class="token punctuation">]</span> <span class="token operator">+</span>     <span class="token comment">// ; path...</span>      <span class="token function">_$iv</span><span class="token punctuation">(</span><span class="token number">983</span><span class="token punctuation">,</span> _$s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// '; expires=Wed, 06 Apr 2022 11:26:36 GMT; Secure'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå°±æ˜¯åœ¨æ­¤æ‰§è¡Œäº†ä¸€æ¬¡æ‹¼ä¸², æŸ¥çœ‹è°ƒç”¨æ ˆ,çœ‹åˆ°äº†æˆ‘ä»¬å‘½åçš„<code>RUISHUTESTFUNCTIONENTRY()</code></p><p>æ‰€æœ‰æ“ä½œéƒ½æ˜¯åœ¨è¿™é‡Œè¿›è¡Œçš„</p><p>è‡³æ­¤, æˆ‘ä»¬æœ‰äº†å˜é‡æ›¿æ¢è¡¨, <code>inner.js</code>,<code>outer.js</code>, <code>&lt;meta&gt;</code>, å¦‚ä½•è§£å¯†ä»£ç å‘¢?</p><h4 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h4><ul><li><p>æ ¹æ®å·²æœ‰å˜é‡æ›¿æ¢è¡¨, ä¸€è¡Œä¸€è¡Œç†æ¸…é€»è¾‘...(è´¹å¤´å‘)</p></li><li><p>æ—¢ç„¶æˆ‘ä»¬çŸ¥é“äº†åŠ å¯†ç¨‹åºå°±æ˜¯åœ¨åå¤æ‰§è¡Œ<code>inner.js</code>,ä¸å¦‚æ¬²æ“’æ•…çºµ, åœ¨Nodeä¸­å¼•å…¥å¹¶æ‰§è¡Œ, ä½†æ˜¯Nodeä¸­æ²¡æœ‰DOM/BOMæ–¹æ³•,æ‰€ä»¥éœ€è¦æˆ‘ä»¬å®ç°å‡ ä¸ªå‡çš„,å°¤å…¶æ˜¯<code>query meta</code>çš„æ—¶å€™(!è¿™æ˜¯ä¸€ç§éå¸¸ä¸å®‰å…¨çš„æ–¹æ³•,ä¾‹å¦‚åŠ å¯†è€…å®Œå…¨å¯ä»¥åˆ¤æ–­å½“å‰æ˜¯å¦ä¸ºNodeç¯å¢ƒ, å¦‚æœæ˜¯,ç›´æ¥æ‰§è¡Œæ”»å‡»æŒ‡ä»¤)</p></li><li><p>ä½¿ç”¨ä¸­é—´äººæ”»å‡», ç»“åˆå˜é‡æ›¿æ¢è¡¨, å®ç°è§£å¯†JS</p></li><li><p>ä½¿ç”¨æ¨¡æ‹Ÿçˆ¬è™«å·¥å…·</p></li><li><p>å˜é‡æ›¿æ¢å§‹ç»ˆæ˜¯ä¸€ç§çŒ«é¼ æ¸¸æˆ. æ›´å¥½çš„æ–¹æ³•æ˜¯:ä½¿ç”¨<code>jsdom</code>æ¨¡å—åœ¨Nodeä¸­å®ç°è½»é‡åŒ–æµè§ˆå™¨ç¯å¢ƒ,æˆ‘çš„å®ç°ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">promiseStick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> res<span class="token punctuation">,</span> rej<span class="token punctuation">;</span>  <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">[</span>res<span class="token punctuation">,</span> rej<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> res<span class="token punctuation">,</span> rej <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">reqLoginToken</span><span class="token punctuation">(</span><span class="token parameter">p <span class="token operator">=</span> <span class="token function">promiseStick</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> cookieMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> dom <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">JSDOM</span><span class="token punctuation">.</span><span class="token function">fromURL</span><span class="token punctuation">(</span>    <span class="token string">'https://xxx.cn'</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span>      <span class="token literal-property property">resources</span><span class="token operator">:</span> <span class="token string">'usable'</span><span class="token punctuation">,</span>      <span class="token literal-property property">runScripts</span><span class="token operator">:</span> <span class="token string">'dangerously'</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// åŠ«æŒcookieè·å–ç”Ÿæˆæ—¶æœº</span>  dom<span class="token punctuation">.</span>window<span class="token punctuation">.</span>_cookie <span class="token operator">=</span> dom<span class="token punctuation">.</span>window<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">__lookupSetter__</span><span class="token punctuation">(</span><span class="token string">'cookie'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  dom<span class="token punctuation">.</span>window<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">__defineSetter__</span><span class="token punctuation">(</span><span class="token string">'cookie'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    _cookie <span class="token operator">=</span> c<span class="token punctuation">;</span>    <span class="token keyword">const</span> cs <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cookieMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>cs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cookieMap<span class="token punctuation">.</span>size <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token comment">// ä¸€ä¸ªenable_XXä¸´æ—¶token, ä¸€ä¸ªåŠ å¯†çš„</span>      p<span class="token punctuation">.</span><span class="token function">res</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token literal-property property">cookie</span><span class="token operator">:</span> <span class="token function">Object</span><span class="token punctuation">(</span>dom<span class="token punctuation">.</span>cookieJar<span class="token punctuation">.</span>store<span class="token punctuation">.</span>idx<span class="token punctuation">[</span><span class="token string">'uaaap.swu.edu.cn'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token literal-property property">cookieE</span><span class="token operator">:</span> cookieMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>login<span class="token punctuation">.</span>encryptCookie<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      dom<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      dom <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  dom<span class="token punctuation">.</span>window<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">__defineGetter__</span><span class="token punctuation">(</span><span class="token string">'cookie'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> _cookie<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> p<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>å€¼å¾—å­¦ä¹ çš„ä¸œè¥¿</p><ul><li>cookie&amp;evalåŠ«æŒ</li><li>dev-toolçš„ä¸€å¾‹ä¸æš‚åœ</li><li>setIntervalæ¸…é™¤debugger</li></ul>]]></content>
    
    
    <summary type="html">è¿‘æœŸæƒ³è¦åšå­¦æ ¡æŸç½‘ç«™çˆ¬è™«, ä½†æ˜¯åœ¨CASç»Ÿä¸€ç™»å½•ç¯èŠ‚åå¤ç™»å½•å¤±è´¥. ç»æŸ¥, å­¦æ ¡ç»Ÿä¸€è®¤è¯ç³»ç»Ÿé‡‡ç”¨äº†æ•°ç‘æŸç‰ˆåŠ¨æ€å®‰å…¨æ–¹æ¡ˆ(åŒ…æ‹¬åŠ¨æ€JS, Cookieæ··æ·†, å‰ç«¯åè°ƒè¯•), åœ¨è¯·æ±‚HTMLæ—¶ä¼šæºå¸¦ä¸¤ä¸ªCookieå¹¶å®šæ—¶ç”ŸæˆåŠ å¯†Cookie. æ²¡æœ‰æºå¸¦åŠ å¯†Cookieçš„è¯·æ±‚éƒ½ä¼šè¢«è®¤ä¸ºæ˜¯éæ³•çš„.ğŸ¤•</summary>
    
    
    
    <category term="çæŠ˜è…¾" scheme="https://blog.liukairui.me/categories/%E7%9E%8E%E6%8A%98%E8%85%BE/"/>
    
    <category term="ä¸€äº›çˆ¬è™«" scheme="https://blog.liukairui.me/categories/%E7%9E%8E%E6%8A%98%E8%85%BE/%E4%B8%80%E4%BA%9B%E7%88%AC%E8%99%AB/"/>
    
    
    <category term="å‰ç«¯" scheme="https://blog.liukairui.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="çˆ¬è™«" scheme="https://blog.liukairui.me/tags/%E7%88%AC%E8%99%AB/"/>
    
    <category term="æ•°ç‘" scheme="https://blog.liukairui.me/tags/%E6%95%B0%E7%91%9E/"/>
    
  </entry>
  
  <entry>
    <title>å‡½æ•°å¼ç¼–ç¨‹Haskellåˆæ¢</title>
    <link href="https://blog.liukairui.me/article/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8BHaskell%E5%88%9D%E6%8E%A2/"/>
    <id>https://blog.liukairui.me/article/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8BHaskell%E5%88%9D%E6%8E%A2/</id>
    <published>2022-03-02T16:00:01.000Z</published>
    <updated>2022-03-02T16:00:01.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç®€ä»‹">ç®€ä»‹</h3><h4 id="ç¼˜èµ·">ç¼˜èµ·</h4><p>ğŸ¤”æƒ³æƒ³æœ¬ç§‘CSæ•™è‚²å¤§å¤šéƒ½æ•™çš„æ˜¯ä»€ä¹ˆ?</p><ul><li>ç®—æ³•: åœ¨ç»™ä½ ä¸€ä¸ªé—®é¢˜, è¦ä½ å°½<strong>å¿«</strong>ç®—å‡ºè§£.</li><li>æ•°æ®åº“: ç»™ä½ ä¸€äº›æ•°æ®, è¦ä½ <strong>å¿«</strong>é€Ÿå‚¨å­˜æŸ¥æ‰¾.</li><li>åˆ†å¸ƒå¼ç®—æ³•/GPUç¼–ç¨‹: ä¸€ä¸ªCPUä¸å¤Ÿç”¨, ç»™ä½ æ›´å¿«çš„ç¡¬ä»¶(é›†ç¾¤æˆ–è€…GPU),è¦ä½ æ›´<strong>å¿«</strong>ç®—å‡ºè§£</li><li>äººå·¥æ™ºèƒ½è¯¾: å†™å‡ºæŒ‡æ•°å¢é•¿çš„æœç´¢ç®—æ³•, ç„¶åå†ç”¨å‰ªæ,å­¦ä¹ ç­‰æ–¹æ³•<strong>åŠ é€Ÿ</strong>.</li><li>ä½“ç³»ç»“æ„è¯¾: æ˜¯åœ¨ç”¨ç”µè·¯é—¨é€ å‡ºæ›´<strong>å¿«</strong>çš„CPU.</li></ul><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸€ä¸ªåŠ²å»ä¼˜åŒ–æœºå™¨, ç¨‹åºå‘˜éš¾é“ä¸é‡è¦å—? éšç€ä»£ç è§„æ¨¡çš„å¢å¤§,é‡æ„, è°ƒè¯•, æµ‹è¯•, APIè®¾è®¡å˜å¾—è¶Šæ¥è¶Šå¤æ‚. äºæ˜¯äººä»¬æå‡ºäº†å‡½æ•°å¼ç¼–ç¨‹.å‡½æ•°å¼ç¼–ç¨‹ä¸å…³å¿ƒä»£ç çš„é€»è¾‘æ‰§è¡Œé€Ÿåº¦(å¤æ‚åº¦).ç¨‹åºå‘˜åªè´Ÿè´£å°†é—®é¢˜æè¿°ç»™è®¡ç®—æœº, è€Œé€Ÿåº¦ä¼˜åŒ–åˆ™ä¸€å£æ°”äº¤ç»™è®¡ç®—æœºå¤„ç†.</p><p>âš ï¸<strong>æ³¨æ„</strong>: Haskellå¹¶æ²¡æœ‰åœ¨å·¥ä¸šç•Œæµè¡Œ.è¿™æ„å‘³ç€ä½ å¾ˆéš¾å°†Haskellåº”ç”¨äºå¤§å‹é¡¹ç›®(è™½ç„¶Haskellå…·æœ‰è¿™æ ·çš„èƒ½åŠ›)</p><h4 id="ä»€ä¹ˆæ˜¯haskellå‡½æ•°å¼ç¼–ç¨‹">ä»€ä¹ˆæ˜¯Haskell/å‡½æ•°å¼ç¼–ç¨‹</h4><p>ğŸ”¡Haskellæ˜¯ä¸€é—¨çº¯ç²¹å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€</p><p><strong>ğŸå‡½æ•°å¼ä¸å‘½ä»¤å¼ç¼–ç¨‹å¯¹æ¯”</strong></p><ul><li><p>ğŸƒâ€â™‚ï¸æ‰§è¡Œæ“ä½œ:</p><ul><li>å‘½ä»¤å¼ç¼–ç¨‹: ç»™è®¡ç®—æœºä¸€ç³»åˆ—æŒ‡ä»¤, è®¡ç®—æœºæ ¹æ®æŒ‡ä»¤æ‰§è¡Œå˜é‡çŠ¶æ€å˜åŒ–.æœ€åå¾—åˆ°ç»“æœ</li><li>å‡½æ•°å¼ç¼–ç¨‹: å‘Šè¯‰è®¡ç®—æœºæˆ‘ä»¬éœ€è¦è§£å†³ä»€ä¹ˆæ ·çš„é—®é¢˜</li></ul><p>ä¾‹å¦‚: è·å–å­—ç¬¦ä¸²<spanclass="math inline">\(s\)</span>ä¸­çš„å¤§å†™å­—æ¯</p><ul><li>å‘½ä»¤å¼ç¼–ç¨‹: éå†<span class="math inline">\(s\)</span> -å¦‚æœå­—ç¬¦<span class="math inline">\(c\)</span>æ»¡è¶³<spanclass="math inline">\(&#39;A&#39; \leq c \leq &#39;Z&#39;\)</span> -å°†<span class="math inline">\(c\)</span>æ”¾å…¥æ•°ç»„<spanclass="math inline">\(res\)</span> - è¿”å›<spanclass="math inline">\(res\)</span></li><li>å‡½æ•°å¼ç¼–ç¨‹: æˆ‘è¦è·å¾—ä¸€ä¸ªå­—ç¬¦ä¸² - è¿™ä¸ªå­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦æ¥è‡ª<spanclass="math inline">\(s\)</span> - åªæœ‰å¤§å†™å­—æ¯æ»¡è¶³è¦æ±‚ -å¤§å†™å­—æ¯æŒ‡çš„æ˜¯<span class="math inline">\({&#39;A&#39;,&#39;B&#39;,...,&#39;Z&#39;}\)</span></li></ul><p>ä¸éš¾å‘ç°,æˆ‘ä»¬å¯ä»¥å¾ˆéš¾å°†å‘½ä»¤å¼ç¼–ç¨‹ä¸­çš„è¯­å¥è½¬åŒ–ä¸ºæ•°å­¦å‡½æ•°(æ¯”å¦‚éå†çš„<code>for</code>å°±æ— æ³•è½¬æ¢ä¸ºå‡½æ•°),ä½†æ˜¯å¯ä»¥å¾ˆè½»æ˜“çš„å°†å‡½æ•°å¼ç¼–ç¨‹è¯­å¥çš„å†…å®¹è½¬åŒ–ä¸ºæ•°å­¦è¡¨è¾¾å¼ <spanclass="math display">\[f(s) = \{x|x \in s , x \in Caps\} \ \ \  where\ Caps = \{&#39;A&#39;,&#39;B&#39;,...,&#39;Z&#39;\}\]</span> ä»–çš„Haskellè¡¨è¾¾å¼ä¹Ÿå¾ˆæ•°å­¦åŒ–(æš‚æ—¶çœ‹ä¸æ‡‚ä¹Ÿæ²¡æœ‰å¤§ç¢)</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">f s &#x3D; [x|x&lt;-s, x &#96;elem&#96; [&#39;A&#39;..&#39;Z&#39;]]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å›å¤´æƒ³æƒ³,æˆ‘ä»¬ç»å¸¸æŠŠå‘½ä»¤å¼ç¼–ç¨‹è¯­å¥ä¸­çš„<code>function</code>ç§°ä½œ"å‡½æ•°".ä½†æ˜¯è¿™äº›"å‡½æ•°"å†…éƒ¨å´æ€»æ˜¯æœ‰æ•°å­¦å‡½æ•°æ— æ³•å®ç°çš„å†…å®¹(ä¾‹å¦‚å¾ªç¯,å˜é‡é‡å¤èµ‹å€¼). æ‰€å¹¸å‡½æ•°å¼ç¼–ç¨‹è§£å†³äº†è¿™ä¸ªé—®é¢˜</p></li><li><p>ğŸ™…å˜é‡ä¸å¸¸é‡</p><ul><li>å‘½ä»¤å¼ç¼–ç¨‹: å¸¸é‡ä¸€æ—¦å£°æ˜å°±æ— æ³•å˜åŒ–, è€Œå˜é‡å¯ä»¥éšæ—¶é‡æ–°èµ‹å€¼</li><li>å‡½æ•°å¼ç¼–ç¨‹: å˜é‡ä¸€æ—¦è¢«æŒ‡å®š, å°±ä¸å¯ä»¥æ›´æ”¹äº†.å‡½æ•°èƒ½åšçš„å”¯ä¸€äº‹æƒ…å°±æ˜¯åˆ©ç”¨å¼•æ•°è®¡ç®—ç»“æœ(æ¯•ç«Ÿæ•°å­¦å‡½æ•°ä¸­å¯æ²¡æœ‰é‡å¤èµ‹å€¼çš„æ“ä½œ,ä½†æ•°å­¦ä¸­å¯åˆ°å¤„éƒ½æ˜¯å¤åˆå‡½æ•°)</li></ul></li><li><p>ğŸ’Šå‰¯ä½œç”¨(side effect, å³æ”¹å˜éå‡½æ•°å†…éƒ¨çš„çŠ¶æ€)</p><ul><li>å‘½ä»¤å¼ç¼–ç¨‹: å‡½æ•°å¯èƒ½å­˜åœ¨å‰¯ä½œç”¨(ä¿®æ”¹å¤–éƒ¨å˜é‡å€¼)</li><li>å‡½æ•°å¼ç¼–ç¨‹: æ— å‰¯ä½œç”¨, ä¸”å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„å‡½æ•°æ˜¯çº¯å‡½æ•°(å³:ä»¥åŒæ ·çš„å‚æ•°è°ƒç”¨åŒä¸€ä¸ªå‡½æ•°ä¸¤æ¬¡, å¾—åˆ°çš„ç»“æœä¸€å®šæ˜¯ç›¸åŒ)</li></ul></li><li><p>â±æƒ°æ€§æ±‚å€¼</p><ul><li><p>å‘½ä»¤å¼ç¼–ç¨‹: é™¤éä½¿ç”¨ç‰¹æ®Šæ•°æ®ç»“æ„, é»˜è®¤éæƒ°æ€§æ±‚å€¼,ä¾‹å¦‚åœ¨JSä¸­å†™ä¸‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token operator">=></span>d<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token operator">=></span>d<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è§£é‡Šå™¨ä¼šå¯¹æ•°ç»„éå†ä¸¤æ¬¡</p></li><li><p>å‡½æ•°å¼ç¼–ç¨‹: é»˜è®¤æƒ°æ€§æ±‚å€¼, ä¾‹å¦‚åœ¨Haskellä¸­å†™ä¸‹</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">map (&#x2F;2) (map (+1) [1,2,3])<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ•°ç»„åªä¼šéå†ä¸€æ¬¡, å³æ¯ä¸€ä¸ªå…ƒç´ éƒ½è°ƒç”¨å‡½æ•°ä¸¤æ¬¡, æœ€åå¾—åˆ°ç»“æœ.å¥½åƒæœ‰ç‚¹é—®é¢˜: å¦‚æœæˆ‘æƒ³å®šä¹‰ä¸€ä¸ª<code>cnt</code>,å¹¶è®©<code>cnt</code>åœ¨æ¯æ¬¡æ‰§è¡ŒåŠ æ³•/ä¹˜æ³•çš„æ—¶å€™<code>+1</code>,æœ€ååŠ <code>cnt</code>åˆ°ç»“æœä¸Šå‘¢? å³</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>t<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    t<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">;</span>cnt<span class="token operator">++</span><span class="token punctuation">;</span>    t<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">/=</span><span class="token number">2</span><span class="token punctuation">;</span>cnt<span class="token operator">++</span><span class="token punctuation">;</span>    t<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+=</span>cnt<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Haskellçš„æƒ°æ€§æ±‚å€¼ä¼¼ä¹ä¼šè®©è¿™æ ·çš„å‡½æ•°æ— æ³•å®ç°? ä½†æ˜¯è¿˜è®°å¾—å‰¯ä½œç”¨å—,Haskellä¸­çš„å‡½æ•°éƒ½æ˜¯çº¯å‡½æ•°, çº¯å‡½æ•°çš„æ‰§è¡Œä¸èƒ½å¯¹å¤–éƒ¨äº§ç”Ÿå‰¯ä½œç”¨.ä¹Ÿæ­£æ˜¯å› ä¸ºå‡½æ•°éƒ½æ˜¯çº¯å‡½æ•°,æ‰€ä»¥æƒ°æ€§æ±‚å€¼æ—¶å€™å°†å…ƒç´ ç»å¸¸è¿ç»­å˜åŒ–å¹¶ä¸ä¼šé€ æˆç»“æœå­˜åœ¨å·®å¼‚.</p><p>æƒ°æ€§æ±‚å€¼çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥å¤„ç†ä¸€ä¸ªæ— é™æ•°ç»„ä¾‹å¦‚:è·å–å‰10ä¸ªå¥‡æ•°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">[1..]           -- è·å–ä¸€ä¸ª[1,2,3...]çš„æ— é™æ•°ç»„filter (odd) [1..]    -- è¿‡æ»¤å‡ºæ‰€æœ‰å¥‡æ•° [1,3,5..]take 10 filter (odd) [1..]   -- å–å‰10é¡¹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><p><strong>ğŸš«Haskellæ˜¯é™æ€å¼ºç±»å‹è¯­è¨€</strong></p><ul><li>é™æ€ç±»å‹æ„å‘³ç€æˆ‘ä»¬éœ€è¦åœ¨è¿è¡Œå‰æ˜ç¡®æŒ‡å‡ºå˜é‡çš„ç±»å‹,åŒæ—¶Haskellæ”¯æŒç±»å‹æ¨å¯¼,è¿™æ„å‘³ç€æˆ‘ä»¬ä¸å¿…å‘Šè¯‰Haskellæ¯ä¸€ä¸ªå˜é‡çš„ç±»å‹(ä¾‹å¦‚Haskellä¼šè‡ªåŠ¨æ¨æ–­<code>a = 1+1</code>çš„<code>a</code>æ˜¯æ•°å€¼,åŒæ—¶ç”±äºHaskellä¸å¯é‡å¤èµ‹å€¼, açš„ç±»å‹ä¸ä¼šå†æœ‰å˜åŒ–)</li><li>å¼ºç±»å‹æ„å‘³ç€Haskellä¸ä¼šè‡ªåŠ¨è¿›è¡Œç±»å‹è½¬æ¢(é™¤äº†éƒ¨åˆ†è¯­æ³•ç³–)</li></ul><h4 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®</h4><p>ğŸ› æœ€æ–¹ä¾¿çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨<code>Haskell Platform</code>, æ­¤ç¨‹åºåŒ…åŒ…å«</p><ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuaGFza2VsbC5vcmcvZ2hjLw==">GHC<i class="fa fa-external-link-alt"></i></span>: Haskellç¼–è¯‘å™¨</li><li><span class="exturl" data-url="aHR0cHM6Ly9jYWJhbC5yZWFkdGhlZG9jcy5pby8=">cabal-install<i class="fa fa-external-link-alt"></i></span>:åŒ…ç®¡ç†å™¨</li><li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmhhc2tlbGxzdGFjay5vcmcv">stack<i class="fa fa-external-link-alt"></i></span>:è·¨å¹³å°å¼€å‘å·¥å…·</li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hhc2tlbGwvaGFza2VsbC1sYW5ndWFnZS1zZXJ2ZXI=">haskell-language-server<i class="fa fa-external-link-alt"></i></span>:è¯­è¨€æ”¯æŒ</li></ul><p>å¯¹äº<code>archlinux</code>, ç”±äºGHCé‡‡ç”¨åŠ¨æ€é“¾æ¥, éœ€è¦å¢åŠ å‡ ä¸ªè½¯ä»¶</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pacman -S ghc cabal-install stack haskell-language-server happy alex haskell-haddock-library<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯¹äºVSCodeç”¨æˆ·</p><ul><li><span class="exturl" data-url="aHR0cHM6Ly9tYXJrZXRwbGFjZS52aXN1YWxzdHVkaW8uY29tL2l0ZW1zP2l0ZW1OYW1lPW1vZ2Vrby5oYXNrZWxsLWV4dGVuc2lvbi1wYWNr">HaskellExtension Pack<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9tYXJrZXRwbGFjZS52aXN1YWxzdHVkaW8uY29tL2l0ZW1zP2l0ZW1OYW1lPWRyYW1mb3JldmVyLnZzY29kZS1naGMtc2ltcGxl">SimpleGHC (Haskell) Integration<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9tYXJrZXRwbGFjZS52aXN1YWxzdHVkaW8uY29tL2l0ZW1zP2l0ZW1OYW1lPXBob2l0eW5lLnBob2l0eW5lLXZzY29kZQ==">HaskellGHCi Debug Adapter Phoityne<i class="fa fa-external-link-alt"></i></span></li></ul><p>GHCåœ¨ç¼–è¯‘Haskellæ–‡ä»¶(<code>.hs</code>æ–‡ä»¶)çš„åŒæ—¶æä¾›äº†äº¤äº’æ¨¡å¼(ç±»ä¼¼Node,Python, è™½ç„¶ä»–æ˜¯ç¼–è¯‘å‹è¯­è¨€(è¿™é‡Œåº”è¯¥æ„Ÿè°¢çº¯å‡½æ•°çš„ç‰¹æ€§)),åªéœ€è¦ç»ˆç«¯è¾“å…¥<code>ghci</code>å³å¯è¿›å…¥äº¤äº’æ¨¡å¼. åœ¨äº¤äº’æ¨¡å¼ä¸­</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">:l xx.hs    -- å¯ä»¥åŠ è½½xx.hsæ–‡ä»¶, å…¶ä¸­.hså¯ä»¥çœç•¥:r          -- åˆ·æ–°å·²ç»åŠ è½½çš„æ–‡ä»¶<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="åŸºç¡€è¯­æ³•">åŸºç¡€è¯­æ³•</h3><h4 id="è¿ç®—ç¬¦">è¿ç®—ç¬¦</h4><ul><li><p>æ•°å­¦è¿ç®—: <code>2 + 15</code>, <code>49 * 100</code>,<code>1892 - 1472</code>, <code>5 / 2</code>,<code>50 * (100 - 4999)</code></p><p>æ³¨æ„: <code>5 * -3</code>ä¼šæŠ¥é”™,å› ä¸º<strong>åœ¨Haskellä¸­å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘</strong>,è€Œ<code>*</code>æœ¬èº«å°±æ˜¯ä¸€ä¸ªäºŒå…ƒå‡½æ•°.Haskellä¼šå°†è¡¨è¾¾å¼è§£æä¸º<code>( 5 * - ) 3</code>,æ‰€ä»¥åº”è¯¥æ”¹ä¸º<code>5 * (-3)</code></p></li><li><p>Booleanè¿ç®—: <code>True</code>, <code>False</code>(å¿…é¡»å¤§å†™),<code>&amp;&amp;</code>, <code>||</code>, <code>not</code>,<code>==</code>, <code>/=</code>(å³<code>!=</code>)</p></li></ul><p>æ•°å­¦è¿ç®—ä¸Booleanè¿ç®—éƒ½ä¸æ”¯æŒé»˜è®¤ç±»å‹è½¬æ¢(æ•´æ•°æ”¯æŒé»˜è®¤è½¬æ¢ä¸ºå°æ•°)</p><h4 id="å‡½æ•°è°ƒç”¨">å‡½æ•°è°ƒç”¨</h4><ul><li><p>å‡½æ•°è°ƒç”¨: è°ƒç”¨æ–¹æ³•ä¸º<code>å‡½æ•°å å‚æ•°1 å‚æ•°2...</code>,çœ‹èµ·æ¥å¾ˆæ€ª, æ²¡æœ‰<code>()</code>, ä¹Ÿæ²¡æœ‰<code>,</code>åˆ†éš”. ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">succ 8                 -- è·å–8çš„åç»§, å³9min 9 10               -- 8,9æœ€å°å€¼max 9 10               -- 8,9æœ€å¤§å€¼succ 9 + max 5 4 + 1   -- å‡½æ•°è°ƒç”¨å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§, å³(succ 9) + (max 5 4) + 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ä¸­ç¼€å‡½æ•°: å¯¹äºäºŒå…ƒå‡½æ•°,æˆ‘ä»¬å¯ä»¥å°†<code>f x y</code>å†™æˆ<code>x `f` y</code>, æ³¨æ„,è¿™é‡Œçš„<code>`</code>, æ˜¯å¿…é¡»çš„. ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">2 &#96;min&#96; 4    -- å³ min 2 41 &#96;elem&#96; [2,3,1] -- å³elem 1 [2,3,1], å…¶ä¸­elem x xsè¿”å›xæ˜¯å¦åœ¨xsä¸­<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>å‡½æ•°è°ƒç”¨æ˜¯è‡ªå·¦å‘å³çš„</p></li></ul><h4 id="å‡½æ•°ç¼–å†™">å‡½æ•°ç¼–å†™</h4><ul><li><p>å‡½æ•°å®šä¹‰ä¸æ•°å­¦ä¸­çš„å‡½æ•°è¡¨è¾¾å¼å¾ˆç±»ä¼¼, ä¾‹å¦‚</p><ul><li><p>éœ€è¦å®šä¹‰è¡¨è¾¾å¼<span class="math inline">\(doubleMe(x) =x+x\)</span>, åªéœ€è¦</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">doubleMe x &#x3D; x+x<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>éœ€è¦å®šä¹‰è¡¨è¾¾å¼<span class="math inline">\(doubleUs(x,y) =x+x+y+y\)</span>, åªéœ€è¦</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">doubleUs x y &#x3D; x+x+y+y<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>å½“ç„¶, ä¹Ÿå¯ä»¥è°ƒç”¨å‡½æ•°</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">doubleUs x y &#x3D; doubleMe x + doubleMe y<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li></ul></li><li><p>å˜é‡å°±æ˜¯å¸¸å‡½æ•°(å› ä¸ºå˜é‡ä¸å¯ä¿®æ”¹å€¼, æ‰€ä»¥,å¯ä»¥åƒæ„å»ºå¸¸å‡½æ•°ä¸€æ ·æ„å»ºå˜é‡)</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">testValue &#x3D; 12<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æ— éœ€å…³å¿ƒ<strong>å‡½æ•°ä¹‹é—´</strong>çš„ä½ç½®, ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">doubleUs x y &#x3D; doubleMe x + doubleMe ydoubleMe x &#x3D; x + xdemoRes &#x3D; demoUs 1 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¹¶ä¸ä¼šæŠ¥é”™</p></li><li><p>æ¡ä»¶è¯­å¥If: <code>if-then-else</code>ç»“æ„, ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">doubleSmallNumber x &#x3D; if x &gt; 100                      then x                      else  x*2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ”¯æŒå‹è¡Œä¹¦å†™</p></li><li><p>ä½¿ç”¨<code>_</code>è¡¨ç¤ºæˆ‘ä»¬ä¸å…³ç³»è¿™ä¸ªå˜é‡å–å€¼, ä¾‹å¦‚å®šä¹‰å‡½æ•° <spanclass="math display">\[f(x,y,z) = x\\g(x,y,z) = y\\g(x,y,z) = z\]</span> Haskellè¡¨ç¤ºå°±æ˜¯</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">f x _ _ &#x3D; xg _ y _ &#x3D; yh _ _ z &#x3D; z<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™å’ŒJSä¸­<code>_</code>è¡¨ç¤ºä¸å…³å¿ƒå˜é‡ä¸ä¸€æ ·, è¿™ä¸ªç”šè‡³å¯ä»¥é‡å</p></li><li><p>åœ¨Haskellä¸­ä½¿ç”¨<code>'</code>è¡¨ç¤ºç±»ä¼¼, ä½†æ˜¯ä¸åŒçš„å‡½æ•°,æ¯”å¦‚æˆ‘ä»¬æƒ³ä½¿ç”¨ä¸¤ç§æ–¹å¼å®ç°<spanclass="math inline">\(Fibonacci\)</span></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">fib n &#x3D; if n&lt;&#x3D;2 then n else fib (n-1) + fib (n-2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¿½ç„¶æˆ‘ä»¬åˆæƒ³å®ç°ä¸€ä¸ª<spanclass="math inline">\(Fibonacci\)</span></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">fib&#39; n &#x3D; if n&lt;&#x3D;3 then n else fib (n-1) + fib (n-2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™åªæ˜¯ä¸€ç§å‘½åä¹ æƒ¯, ä¸å¼ºåˆ¶, ä¹Ÿæ²¡æœ‰å…¶ä»–æ•ˆæœ</p></li></ul><h4 id="listç±»å‹åŸºç¡€">Listç±»å‹åŸºç¡€</h4><p>ğŸ“œè¿™é‡Œçš„Listå’ŒJS/Pythonçš„æ•°ç»„ç±»ä¼¼,æˆ‘å–œæ¬¢æŠŠä»–ä½œä¸º<strong>å¯é‡å¤æ— åºé›†åˆ</strong>ä½¿ç”¨.</p><ul><li><p>å£°æ˜ä¸€ä¸ªListå¾ˆç®€å•</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">t &#x3D; [1,2,3]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>âš ï¸Listä¸­çš„å…ƒç´ ç±»å‹å¿…é¡»ç›¸åŒ</p></li><li><p>å­—ç¬¦ä¸²å®é™…ä¸Šæ˜¯å­—ç¬¦Listçš„è¯­æ³•ç³–</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">&quot;231&quot; &#x3D;&#x3D; [&#39;2&#39;,&#39;3&#39;,&#39;1&#39;]  -- True<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>å¯ä»¥ä½¿ç”¨<code>++</code>è¿ç®—åˆå¹¶List, ä¾‹å¦‚</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">t &#x3D; [1,2,3] ++ [4,5,6]   -- [1,2,3,4,5,6]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>âš ï¸å…¶å®ç°åŸç†æ˜¯éå†<code>++</code>å‰çš„æ•°ç»„å¹¶åˆå¹¶åˆ°åè€…,æ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªä½æ•ˆè¿ç®—å­</p></li><li><p>å¯ä»¥ä½¿ç”¨<code>:</code>è¿ç®—ç¬¦å°†å…ƒç´ åŠ å…¥Listå¤´éƒ¨, ä¾‹å¦‚</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">t &#x3D; 1:[2,3,4]    -- [1,2,3,4]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>æ”¯æŒé“¾å¼è°ƒç”¨, ä¾‹å¦‚</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">t &#x3D; 1:2:3:[4,5,6]   -- [1,2,3,4,5,6]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>å¯ä»¥ä½¿ç”¨<code>!!</code>å–Listçš„æŸä¸€ä½</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">t &#x3D; [1,2,3,4,5,6] !! 2   -- 3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>âš ï¸è¶Šç•Œè®¿é—®ä¼šæŠ¥é”™</p></li><li><p>å–å€¼æ–¹æ³•</p><ul><li><p><code>head List</code>è¿”å›<strong>é¦–ä¸ª</strong>å…ƒç´ :<code>head [1,2,3]</code>ä¸º<code>1</code></p></li><li><p><code>tail List</code>è¿”å›<strong>éé¦–ä¸ª</strong>å…ƒç´ ä»¬:<code>tail [1,2,3]</code>ä¸º<code>[2,3]</code></p></li><li><p><code>last List</code>è¿”å›<strong>æœ€åä¸€ä¸ª</strong>å…ƒç´ :<code>last [1,2,3]</code>ä¸º<code>3</code></p></li><li><p><code>init List</code>è¿”å›<strong>éæœ€åä¸€ä¸ª</strong>å…ƒç´ :<code>init [1,2,3]</code>ä¸º<code>[1,2]</code></p><p>âš ï¸å¯¹ç©ºæ•°ç»„æ‰§è¡Œå‡ä¼šæŠ¥é”™</p></li></ul></li><li><p>å…¶ä»–æ–¹æ³•</p><ul><li><p><code>length List</code>è¿”å›æ•°ç»„é•¿åº¦:<code>length [1,2,3]</code>ä¸º<code>3</code></p></li><li><p><code>null List</code>è¿”å›æ˜¯å¦ä¸ºç©º: <code>null [1,2,3]</code> ä¸º<code>False</code></p></li><li><p><code>reverse List</code>åè½¬æ•°ç»„:<code>reverse [1,2,3]</code>ä¸º<code>[3,2,1]</code>,å¹¶ä¸ä¼šåè½¬åŸæ•°ç»„(å› ä¸ºçº¯å‡½æ•°)</p></li><li><p><code>take n List</code>è¿”å›å‰<code>n</code>çš„å…ƒç´ ,è¶Šç•Œéƒ¨åˆ†ä¸è¿”å›, <code>n==0</code>è¿”å›<code>[]</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">take 2  [1,2,3,4]  -- [1,2]take 10 [1,2,3,4]  -- [1,2,3,4]take 0  [1,2,3,4]  -- []take -1 [1,2,3,4]  -- Error!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>drop</code>ä¸<code>take</code>ç±»ä¼¼,ä½œç”¨ä¸ºåˆ é™¤å‰<code>n</code>ä¸ªå…ƒç´ </p></li><li><p><code>maximum List</code>è¿”å›æœ€å¤§å€¼:<code>maximum [1,9,2,3,4]</code>ä¸º<code>9</code></p></li><li><p><code>maximum List</code>è¿”å›æœ€å¤§å€¼:<code>minimum [8,4,2,1,5,6]</code>ä¸º<code>1</code></p></li><li><p><code>sum List</code>è¿”å›å’Œ:<code>sum [8,4,2,1,5,6]</code>ä¸º<code>26</code></p></li><li><p><code>product List</code>è¿”å›ç§¯:<code>product [8,4,2,1,5,6]</code>ä¸º<code>1920</code></p></li></ul></li><li><p><code>elem ele List</code>åˆ¤æ–­<code>ele</code>æ˜¯å¦åœ¨<code>List</code>ä¸­:<code>4 `elem` [3,4,5,6]</code>ä¸º<code>True</code></p></li></ul><h4 id="listçš„range">Listçš„Range</h4><p>ğŸ“œç±»ä¼¼äºPythonçš„Range, ä½†æ˜¯æ›´åŠ æ™ºèƒ½</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">t &#x3D; [1..5]   -- [1,2,3,4,5]t &#x3D; [&#39;a&#39;..&#39;f&#39;]  -- [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;,&#39;e&#39;,&#39;f&#39;]-- é»˜è®¤Stepä¸º1, è‡ªå®šä¹‰æ—¶éœ€è¦åˆ—å‰ä¸¤é¡¹t &#x3D; [1,1.2..2]  --  [1.0,1.2,1.4,1.5999999999999999,1.7999999999999998,1.9999999999999998]-- ä½†æ˜¯ç²¾åº¦å ªå¿§, å»ºè®®ä½¿ç”¨å…¶ä»–æ–¹æ³•(åé¢ä¼šæåˆ°)t &#x3D; [1..]   -- [1,2,3..]å®šä¹‰æ— é™é•¿Listt &#x3D; [1,3..]   -- [1,3,5,7..]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>repeat n</code>è¿”å›æ— é™ä¸ª<code>n</code>ç»„æˆçš„List(ç­‰ä»·äº<code>[n,n..]</code>)</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">t &#x3D; repeat 5   -- [5,5,5,5...]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸€èˆ¬æ­é…<code>take</code>ä½¿ç”¨</p><h4 id="listçš„comprehension">Listçš„Comprehension</h4><p>ğŸ”°éå¸¸ç±»ä¼¼äºé›†åˆçš„å®šä¹‰(è¿™ä¹Ÿæ˜¯æˆ‘æŠŠListå½“æ— åºå¯é‡é›†åˆçš„åŸå› )</p><p>å¯¹äºä¸€ä¸ªé›†åˆ <span class="math display">\[S = \{ 2x | x \in \mathbb N , \sqrt{x} \in \{1,..,100\} \}\]</span> é¦–å…ˆä»–æ˜¯ä¸€ä¸ªList, æ‰€ä»¥åº”è¯¥åŒ…ç€<code>[]</code>,ä¹‹åæœ‰ä¸€ä¸ªç«–çº¿åˆ†éš”ç¬¦, å·¦è¾¹æ˜¯è¾“å‡ºå‡½æ•°(é›†åˆä¸­çš„ä»£è¡¨å…ƒç´ ), å³è¾¹æ˜¯çº¦æŸ,ä¾‹å¦‚<code>[x|æ¡ä»¶]</code>, æ¡ä»¶ä¸­<spanclass="math inline">\(\in\)</span>ä½¿ç”¨<code>&lt;-</code>è¡¨ç¤º,é‚£ä¹ˆåˆšåˆšé›†åˆå°±å¯ä»¥è¡¨ç¤ºä¸º<code>t = [ 2*x | x &lt;- [1..100], (sqrt x) `elem` [1..100]]</code></p><p>è¿˜å¯ä»¥ç»“åˆä¹‹å‰çš„å‡½æ•°ä¸<code>if</code>è¯­å¥, ä¾‹å¦‚:</p><p>å®šä¹‰<code>List</code>å®ƒèƒ½å¤Ÿä½¿<code>List</code>ä¸­æ‰€æœ‰å¤§äº 10çš„å¥‡æ•°å˜ä¸º <code>"BANG"</code>ï¼Œå°äº 10 çš„å¥‡æ•°å˜ä¸º<code>"BOOM"</code>ï¼Œå…¶ä»–åˆ™ç»Ÿç»Ÿæ‰”æ‰</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">boomBangs xs &#x3D; [ if x &lt; 10 then &quot;BOOM!&quot; else &quot;BANG!&quot; | x &lt;- xs, odd x]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åŒæ—¶æ”¯æŒåŒå¤šListä¸­å–å…ƒç´ </p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">[ x*y | x &lt;- [2,5,10], y &lt;- [8,10,11]]  --[16,20,22,40,50,55,80,100,110]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ğŸ¤”<strong>ä½¿ç”¨comprehensionçš„æ—¶å€™æ³¨æ„æ€è€ƒæ–¹å¼</strong>:æˆ‘éœ€è¦çš„Listæ˜¯ä»€ä¹ˆæ ·å­çš„, è€Œä¸æ˜¯Listæ˜¯æ€ä¹ˆç®—å‡ºæ¥çš„</p><h4 id="tupleç±»å‹åŸºç¡€">Tupleç±»å‹åŸºç¡€</h4><p>ğŸ“œè¿™é‡Œçš„Tupleå’ŒPythonçš„å…ƒç»„ç±»ä¼¼. ä¸Listä¸åŒçš„å°±æ˜¯: Tupleæ˜¯å®šé•¿çš„,å…¶ä¸­å¯ä»¥ä¸ºä»»æ„ä¸åŒæ•°æ®ç±»å‹(ä¾‹å¦‚<code>('a',1)</code>)</p><p>âš ï¸Tupleä¹Ÿæ˜¯æœ‰ç±»å‹çš„, è¿™æ„å‘³ç€è‹¥Listä¸­æœ‰Tuple,é‚£ä¹ˆæ‰€æœ‰çš„Tupleç±»å‹åº”è¯¥ç›¸åŒ(æ¯ä¸ªTupleçš„é•¿åº¦ç›¸åŒ, æ¯ä¸€ä¸ªä½ç½®çš„ç±»å‹ç›¸åŒ),å³</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">[(1,2,3), (4,5,6)]   -- ğŸ‘[(1,2,3), (4,5,True)]  -- ğŸ’©[(1,2,3), (4,5)]   -- ğŸ’©[(1,2), (4,5.0)]          -- ğŸ‘ åŒæ—¶ä½ å°†è·å¾—[(1,2.0), (4,5.0)]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ–¹æ³•:</strong></p><ul><li><p><code>fst Tuple</code>è·å–<strong>äºŒå…ƒ</strong>Tupleçš„ç¬¬ä¸€ä¸ªå…ƒç´ ,ä¸å¯ç”¨äºå…¶ä»–é•¿åº¦Tuple!</p></li><li><p><code>snd Tuple</code>è·å–<strong>äºŒå…ƒ</strong>Tupleçš„ç¬¬äºŒä¸ªå…ƒç´ ,ä¸å¯ç”¨äºå…¶ä»–é•¿åº¦Tuple!</p></li><li><p><code>zip List List</code>è·å–ä¸€ä¸ªäº¤å‰é…å¯¹çš„Tuple List</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">zip [1,2,3,4,5] [5,5,5,5,5]-- [(1,5),(2,5),(3,5),(4,5),(5,5)]zip [1 .. 5] [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;, &quot;four&quot;, &quot;five&quot;]-- [(1,&quot;one&quot;),(2,&quot;two&quot;),(3,&quot;three&quot;),(4,&quot;four&quot;),(5,&quot;five&quot;)]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ª<code>zip</code>å‡½æ•°ç¡®å®å¾ˆå½¢è±¡å•ŠğŸ˜‚, åŒæ—¶è‹¥ä¸¤ä¸ªListé•¿åº¦ä¸ä¸€æ ·çš„,åˆ™èˆå¼ƒé•¿å‡ºçš„éƒ¨åˆ†(æ‹‰æ‹‰é“¾çš„æ—¶å€™è¦æ˜¯ä¸¤è¾¹ä¸ä¸€æ ·é•¿ä¹Ÿåªèƒ½æ‹‰åˆ°è¾ƒçŸ­çš„ä½ç½®),è¿™ç§ç‰¹æ€§ä¸æƒ°æ€§æ±‚å€¼ç»„åˆå<code>zip</code>å°±å¯ä»¥å¤„ç†æ— é™æ•°ç»„äº†</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">zip &quot;Karry&quot; [1..]-- [(&#39;K&#39;,1),(&#39;a&#39;,2),(&#39;r&#39;,3),(&#39;r&#39;,4),(&#39;y&#39;,5)]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>zipWi1th f List List</code>: ä¸<code>zip</code>ç±»ä¼¼,å°†æ¯æ¬¡å–å¾—çš„ä¸¤ä¸ªå…ƒç´ è°ƒç”¨<code>f</code>å¹¶è¿”å›</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">add x y &#x3D; x + yzipWith add [1 .. 10] [1 .. 10]-- [2,4,6,8,10,12,14,16,18,20]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>ğŸ˜†æœ‰è¶£çš„ä¾‹å­</strong>: è¿˜æ˜¯è¦æ³¨æ„æ€è€ƒæ–¹å¼</p><ul><li><p>æ‰€æœ‰ä¸‰è¾¹é•¿åº¦çš†ä¸ºæ•´æ•°ä¸”å°äºç­‰äº 10ï¼Œå‘¨é•¿ä¸º 24 çš„ä¸‰è§’å½¢</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">triangles &#x3D; [ (a,b,c) | c &lt;- [1..10], b &lt;- [1..10], a &lt;- [1..10], a+b&gt;c, a+c&gt;b, b+c&gt;a]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>ä¸‰è¾¹éƒ½å°äºç­‰äº 10 çš„ç›´è§’ä¸‰è§’å½¢(ä¸‰è¾¹æŒ‰é¡ºåºè¾“å‡º)</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">triangles&#39; &#x3D; [ (a,b,c) | c &lt;- [1..10], b &lt;- [1..c], a &lt;- [1..b], a^2 + b^2 &#x3D;&#x3D; c^2]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å‘¨é•¿ä¸º24, ä¸‰è¾¹éƒ½å°äºç­‰äº 10 çš„ç›´è§’ä¸‰è§’å½¢</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">triangles&#39;&#39; &#x3D; [ (a,b,c) | c &lt;- [1..10], b &lt;- [1..c], a &lt;- [1..b], a^2 + b^2 &#x3D;&#x3D; c^2, a+b+c &#x3D;&#x3D; 24]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h3 id="ç±»å‹ä¸ç±»å‹ç±»">ç±»å‹ä¸ç±»å‹ç±»</h3><h4 id="ç±»å‹types">ç±»å‹(Types)</h4><p>Haskellæ˜¯é™æ€ç±»å‹è¯­è¨€ä¸”æ”¯æŒç±»å‹æ¨å¯¼.ä½†Haskellä¸æ”¯æŒéšå¼ç±»å‹è½¬æ¢(é™¤äº†Int-&gt;Float)</p><p>å¯ä»¥åœ¨<code>ghci</code>ä¸­ä½¿ç”¨<code>:t è¡¨è¾¾å¼</code>çš„æ–¹å¼è·å–ç±»å‹</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">:t &#39;a&#39;     -- &#39;a&#39;::Char:t True    -- True::Bool:t &quot;HELLO!&quot;   -- &quot;HELLO&quot;::String:t max    -- max :: Ord a &#x3D;&gt; a -&gt; a -&gt; a:t [1,2,3]   -- [1,2,3] :: Num a &#x3D;&gt; [a]:t 12.3    -- 12.3 :: Fractional p &#x3D;&gt; p:t (True, 1)  -- (True, 1) :: Num b &#x3D;&gt; (Bool, b):t (&#x3D;&#x3D;)    -- (&#x3D;&#x3D;) :: Eq a &#x3D;&gt; a -&gt; a -&gt; Bool<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ğŸ™„å¸¸è§çš„ç±»å‹æœ‰</p><ul><li><code>Int</code>: è¡¨ç¤º<span class="math inline">\(-2^{31} \sim2^{31}-1\)</span>çš„æ•´æ•°</li><li><code>Integer</code>: è¡¨ç¤ºæ•´æ•°, æ— ç•Œ</li><li><code>Float</code>: å•ç²¾åº¦æµ®ç‚¹æ•°</li><li><code>Double</code>: åŒç²¾åº¦æµ®ç‚¹å‹</li><li><code>Bool</code>: å¸ƒå°”å‹,å–å€¼ä¸º<code>True</code>ä¸<code>False</code></li><li><code>Char</code>: å­—ç¬¦å‹,<code>String = [Char]</code>è¡¨ç¤ºå­—ç¬¦ä¸²</li></ul><p>ğŸ™„ç±»å‹è¡¨ç¤ºæ—¶çš„æœ¯è¯­</p><ul><li><p>ä½¿ç”¨å¤§å†™å­—æ¯å¼€å¤´è¡¨ç¤ºç±»å‹</p></li><li><p><code>::</code>è¡¨ç¤º"ç±»å‹ä¸º", ä¾‹å¦‚: "HELLO"çš„ç±»å‹ä¸ºString</p></li><li><p><code>[a]</code>è¡¨ç¤º<code>a</code>ç±»å‹çš„æ•°ç»„</p></li><li><p>å¯¹äºå‡½æ•°, å°†å‚æ•°ä¸è¿”å›å€¼ç±»å‹ä¾æ¬¡ä½¿ç”¨<code>-&gt;</code>è¿æ¥å³å¯,ä¾‹å¦‚</p><ul><li><p><code>a-&gt;b</code>è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå‡½æ•°,æ¥å—ä¸€ä¸ª<code>a</code>ç±»å‹çš„å‚æ•°,è¿”å›ä¸€ä¸ª<code>b</code>ç±»å‹å˜é‡</p></li><li><p><code>a-&gt;b-&gt;c-&gt;d</code>è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå‡½æ•°,æŒ‰é¡ºåºæ¥å—<code>a</code>,<code>b</code>, <code>c</code>ç±»å‹å˜é‡,è¿”å›<code>d</code>ç±»å‹å˜é‡</p></li></ul><p>å°†å‚æ•°ä¸è¿”å›å€¼ç±»å‹ç®€å•ç²—æš´çš„è¿æ¥åœ¨ä¸€èµ·çœ‹èµ·æ¥æœ‰ç‚¹"æ¬ è€ƒè™‘", å®é™…ä¸Š,è¿™æ ·çš„æ¨¡å¼åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ååˆ†ç¬¦åˆç›´è§‰</p><p>å½“å‡½æ•°å¯ä»¥æ¥å—å¤šç§ç±»å‹çš„å‚æ•°å¹¶è¿”å›ä¸åŒç±»å‹çš„ç±»å‹æ—¶,æˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨<code>a</code>, <code>b</code>,<code>c</code>...è¡¨ç¤ºæŸä¸€ç§ç±»å‹,è¿™ä¸å‘½ä»¤å¼è¯­è¨€ä¸­çš„<strong>å¤šæ€</strong>ç±»ä¼¼,ä¾‹å¦‚<code>reverse</code>å‡½æ•°: <code>[a] -&gt; [a]</code></p></li><li><p>è¿ç®—ç¬¦ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°,ä¾‹å¦‚<code>==</code>ç±»å‹å°±æ˜¯ä¸€ä¸ª<code>a-&gt;a-&gt;Bool</code>,ä¸è¿‡åœ¨è¿›è¡Œç±»å‹åˆ¤æ–­åº”è¯¥ä½¿ç”¨æ‹¬å·å°†è¿ç®—ç¬¦æ‹¬èµ·æ¥,å¦‚<code>:t (==)</code></p></li><li><p>Tupleçš„ç±»å‹æ˜¯æ¯ä¸€é¡¹çš„ç±»å‹ç»„æˆçš„Tuple</p></li><li><p>è‡³ä»Šæ²¡æœ‰è§£å†³çš„<code>=&gt;</code>è¡¨ç¤ºä»€ä¹ˆ,è¿™éœ€è¦ç±»å‹ç±»çš„çŸ¥è¯†</p></li></ul><h4 id="ç±»å‹å˜é‡type-variablesä¸ç±»å‹ç±»type-variables">ç±»å‹å˜é‡(Typevariables)ä¸ç±»å‹ç±»(Type variables)</h4><p>ğŸå‰é¢æåˆ°, æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨<code>a</code>,<code>b</code>ç­‰å˜é‡è¡¨ç¤ºä»»æ„ç±»å‹,ä¾‹å¦‚<code>sum</code>å‡½æ•°è¡¨ç¤º<code>[a]-&gt;a</code>,æ­¤æ—¶çš„<code>a</code>å°±æ˜¯<strong>ç±»å‹å˜é‡</strong>, ä¾‹å¦‚</p><ul><li><code>fst</code>å‡½æ•°: <code>[a] -&gt; a</code></li><li><code>length</code>å‡½æ•°: <code>[a] -&gt; Int</code></li><li><code>div</code>å‡½æ•°: <code>a -&gt; a -&gt; a</code></li></ul><p>æ­¤æ—¶, <code>div</code>å‡½æ•°ä¼¼ä¹æœ‰ç‚¹é—®é¢˜,æˆ‘ä»¬åªç”¨<code>a</code>ä»£è¡¨äº†æŸä¸€ç§ç±»å‹, ä½†æ˜¯<code>Char</code>ç±»å‹èƒ½é™¤å—?æˆ‘ä»¬åº”è¯¥å°†ç±»å‹å˜é‡é™å®šåˆ°ä¸€å®šç±»å‹èŒƒå›´,ä¾‹å¦‚<code>div</code>å‡½æ•°çš„<code>a</code>åº”è¯¥æ˜¯ä¸€ä¸ªå¯è®¡ç®—ç±»å‹,ç”¨<code>:t</code>æ£€æŸ¥<code>div</code>å‡½æ•°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; :t divdiv :: (Integral a) &#x3D;&gt; a -&gt; a -&gt; a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™é‡Œçš„<code>(Integral a)</code>ç”¨æ¥æè¿°<code>a</code>è¿™ä¸ªç±»å‹æ˜¯ä¸€ä¸ª<code>Integral</code>ç±»å‹ç±»(æ‹¬å·è¡¨ç¤ºçœç•¥).æ³¨æ„æè¿°:<strong>ç±»å‹å˜é‡<code>a</code>æ˜¯ä¸€ä¸ª<code>Intergral</code>ç±»å‹ç±»çš„ç±»å‹å˜é‡</strong>,åœ¨æè¿°ç»“æŸæ—¶å€™ä½¿ç”¨<code>=&gt;</code>é“¾æ¥ç±»å‹å£°æ˜</p><p>ğŸª†æœ‰ç‚¹å¥—å¨ƒçš„æ„æ€äº†. å°†è¿™äº›æœ¯è¯­ä¸å‘½ä»¤å¼ç¼–ç¨‹å¯¹åº”ä¸€ä¸‹.</p><ul><li><p>å‡½æ•°çš„å‚æ•°ä¸è¿”å›å€¼å¯èƒ½æ˜¯å¤šç§ç±»å‹çš„(<strong>å¯¹åº”å¤šæ€</strong>)</p></li><li><p>äºæ˜¯æˆ‘ä»¬å°†æ¯ç§ç±»å‹ç”¨ä¸åŒçš„ç±»å‹å˜é‡è¡¨ç¤º(<strong>å¯¹åº”æ¨¡æ¿,ç”¨ç±»å‹å˜é‡ä»£è¡¨æŸä¸€ä¸ªç±»</strong>)</p></li><li><p>ä¸ºäº†çº¦æŸç±»å‹å˜é‡, æˆ‘ä»¬æå‡ºäº†ç±»å‹ç±».é‚£ä»€ä¹ˆæ ·çš„ç±»å±äºæŸä¸ªç±»å‹ç±»å‘¢?</p><p><strong>å®Œæˆäº†ç±»å‹ç±»ä¸­å®šä¹‰çš„æˆå‘˜ä¸æ–¹æ³•çš„ç±»</strong>éƒ½å¯ä»¥å±äºç±»å‹ç±»(<strong>å¯¹åº”æ¥å£</strong>).</p></li></ul><p>ğŸŒ°çœ‹å‡ ä¸ªå¸¸è§çš„ä¾‹å­</p><ul><li><p><code>Eq</code>ç±»å‹ç±»è¡¨ç¤ºå¯ä»¥è¡¨ç¤ºç›¸ç­‰çš„ç±»å‹ç±».<code>Eq</code>ç±»å‹ç±»è¦æ±‚å®ç°<code>==</code>å‡½æ•°ä»¥ç”¨äºåˆ¤æ–­.</p><p>ä¾‹å¦‚<code>:t (==)</code>ç±»å‹ä¸º<code>(==) :: Eq a =&gt; a -&gt; a -&gt; Bool</code></p></li><li><p><code>Ord</code>ç±»å‹ç±»è¡¨ç¤ºå¯ä»¥æ¯”è¾ƒç±»å‹ç±»,<code>Ord</code>ç±»å‹ç±»è¦æ±‚å®ç°<code>&lt;</code>, <code>&gt;</code>,<code>&lt;=</code>, <code>&gt;=</code>å‡½æ•°.</p><p><code>:t min</code>ç±»å‹ä¸º<code>min :: Ord a =&gt; a -&gt; a -&gt; a</code></p></li><li><p><code>Show</code>ç±»å‹ç±»è¡¨ç¤ºå¯ä»¥è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„ç±»å‹ç±»,<code>Show</code>ç±»è¦æ±‚å®ç°<code>show</code>å‡½æ•°ç”¨äºè½¬æ¢ä¸ºå­—ç¬¦ä¸²</p><p>ä¾‹å¦‚:<code>:t show</code>ç±»å‹ä¸º<code>show :: Show a =&gt; a -&gt; String</code></p><p>ä¾‹å¦‚: <code>show 123</code>è¡¨ç¤º<code>"123"</code>,<code>show [1,2,3]</code>è¡¨ç¤º<code>"[1,2,3]"</code></p></li><li><p><code>Read</code>ç±»å‹ä¸<code>Show</code>ç±»å‹ç›¸å.<code>read</code>å‡½æ•°å¯ä»¥å°†å­—ç¬¦ä¸²è½¬æ¢ä¸º<code>Read</code>ç±»å‹ç±»çš„æˆå‘˜</p><p>ä¾‹å¦‚:<code>:t read</code>ç±»å‹ä¸º<code>read :: Read a =&gt; String -&gt; a</code></p><p>ä½†æ˜¯: å°†<code>String</code>è½¬æ¢ä¸º<code>Read</code>ç±»å‹ç±»ä¸­å“ªä¸ªç±»å‹å‘¢,æ¯”å¦‚"True"åº”è¯¥è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿˜æ˜¯å¸ƒå°”å‘¢</p><ul><li>å¯ä»¥ä½¿ç”¨Haskellè‡ªå¸¦çš„ç±»å‹æ¨å¯¼:<code>read "123" + 1</code>å¾—åˆ°<code>124</code></li><li>å¯ä»¥ä½¿ç”¨Haskellç±»å‹å£°æ˜æ‰‹åŠ¨æŒ‡å®š:<code>read "123" :: Float</code>å¾—åˆ°<code>123.0</code></li></ul></li><li><p><code>Enum</code>ç±»å‹ç±»çš„æˆå‘˜éƒ½æ˜¯å¯æšä¸¾çš„.å…¶æˆå‘˜å®ç°äº†<code>succ</code>(åç»§å­)ä¸<code>pred</code>(å‰ç»§å­)æ–¹æ³•.<code>Bool</code>, <code>Char</code>, <code>Ordering</code>,<code>Int</code>, <code>Integer</code>, <code>Float</code>,<code>Double</code>ç±»å‹éƒ½æœ¯è¯­è¯¥ç±»å‹ç±»</p><p>ä¾‹å¦‚:<code>:t succ</code>ç±»å‹ä¸º<code>succ :: Enum a =&gt; a -&gt; a</code></p></li><li><p><code>Bounded</code>ç±»å‹ç±»çš„æˆå‘˜éƒ½æœ‰ä¸Šé™ä¸ä¸‹é™</p><ul><li><code>:t minBound</code>ç±»å‹ä¸º<code>minBound :: Bounded a =&gt; a</code>,ä¾‹å¦‚:<code>minBound :: Int</code>ä¸º<code>-9223372036854775808</code></li><li><code>:t maxBound</code>ç±»å‹ä¸º<code>maxBound :: Bounded a =&gt; a</code></li></ul></li><li><p><code>Num</code>ä¸ºæ•°å­—ç±»å‹ç±»</p></li><li><p><code>Integral</code>: è¡¨ç¤ºæ•´æ•°, åŒ…å«<code>Int</code> å’Œ<code>Integer</code></p><p>å½“æˆ‘ä»¬æƒ³æ˜¾å¼å°†<code>Integral</code>è½¬åŒ–ä¸º<code>Num</code>æ—¶,å¯ä»¥ä½¿ç”¨<code>fromIntegral</code>å‡½æ•°</p><p>âš ï¸<code>Integer</code>ä¸<code>Integral</code>åŒºåˆ«</p></li><li><p><code>Floating</code>: è¡¨ç¤ºæµ®ç‚¹æ•°, åŒ…å«<code>Float</code> å’Œ<code>Double</code></p></li></ul><p>âš ï¸å¦‚æœä¸€ä¸ªç±»å‹å±äºå¤šä¸ªç±»å‹ç±»å¯ä»¥è¿™æ ·å†™</p><h3 id="å‡½æ•°">å‡½æ•°</h3><p>Haskellæœ‰ä¸€å¥—ç‹¬ç‰¹çš„å‡½æ•°è¯­æ³•</p><h4 id="æ¨¡å¼åŒ¹é…pattern-matching">æ¨¡å¼åŒ¹é…(Pattern matching)</h4><p>æ¨¡å¼åŒ¹é…é€šè¿‡æ£€æŸ¥æ•°æ®çš„ç‰¹å®šç»“æ„æ¥æ£€æŸ¥å…¶æ˜¯å¦åŒ¹é…ï¼Œå¹¶æŒ‰æ¨¡å¼ä»ä¸­å–å¾—æ•°æ®.è¿™åœ¨å‡½æ•°å®šä¹‰ä¸­å¾ˆå¸¸ç”¨</p><p>ğŸ‘‚å¬èµ·æ¥å’Œå­—ç¬¦ä¸²æ­£åˆ™åŒ¹é…å¾ˆåƒ. åœ¨å®šä¹‰å‡½æ•°æ—¶å¯ä»¥è¿™æ ·å†™</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">lucky :: (Integral a) &#x3D;&gt; a -&gt; Stringlucky 7 &#x3D; &quot;LUCKY NUMBER SEVEN!&quot;lucky x &#x3D; &quot;Sorry, you&#39;re out of luck, pal!&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>åœ¨è°ƒç”¨ <code>lucky</code> æ—¶, æ¨¡å¼ä¼šä»<strong>ä¸Šè‡³ä¸‹è¿›è¡Œæ£€æŸ¥,ä¸€æ—¦æœ‰åŒ¹é…, é‚£å¯¹åº”çš„å‡½æ•°ä½“å°±è¢«åº”ç”¨äº†</strong>.è¿™ä¸ªæ¨¡å¼ä¸­çš„å”¯ä¸€åŒ¹é…æ˜¯å‚æ•°ä¸º<code>7</code>ï¼Œå¦‚æœä¸æ˜¯<code>7</code>ï¼Œå°±è½¬åˆ°ä¸‹ä¸€ä¸ªæ¨¡å¼ï¼Œå®ƒåŒ¹é…ä¸€åˆ‡æ•°å€¼å¹¶å°†å…¶ç»‘å®šä¸º<code>x</code> . è‹¥æ˜¯è‡ªä¸Šè€Œä¸‹æ£€æŸ¥æ‰€æœ‰æ¨¡å¼éƒ½æ²¡æœ‰å‘½ä¸­, Haskellä¼šæŠ¥é”™.æ‰€ä»¥åœ¨ä½¿ç”¨æ¨¡å¼åŒ¹é…çš„æ—¶å€™åŠ¡å¿…è¦è€ƒè™‘<strong>è¾¹ç•Œæ¡ä»¶ä¸ç‰¹æ®Šå€¼</strong>(è¿™ä¸ä½ åœ¨æ•°å­¦è¡¨è¾¾å¼ä¸­è€ƒè™‘è¾¹ç•Œå€¼ä¸€æ ·é‡è¦)</p><p>ä¸€ä¸ªå®ç°é˜¶ä¹˜çš„ä¾‹å­</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">factorial :: (Integral a) &#x3D;&gt; a -&gt; afactorial 0 &#x3D; 1factorial n &#x3D; n * factorial (n - 1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ğŸ¤”çœ‹èµ·æ¥æ¨¡å¼åŒ¹é…åªæ˜¯ç”¨äºç±»ä¼¼æ•°å­¦ä¸­é€’å½’å®šä¹‰çš„ä¸€ä¸ªè¯­æ³•ç³–?(ç®€åŒ–äº†<code>switch-case</code>)</p><p>ğŸ‘»å¹¶ä¸æ˜¯,æ¨¡å¼åŒ¹é…è¿˜æœ‰é«˜çº§ç”¨æ³•(æˆ‘æ›´å–œæ¬¢æŠŠä»–ç†è§£ä¸ºJSæ­£åˆ™ä¸­<code>if(regExp.test())&#123;args = regExp.exec()&#125;</code>çš„è¯­æ³•ç³–æˆ–è€…æ˜¯<code>Object</code>ç»“æ„èµ‹å€¼çš„è¯­æ³•ç³–)</p><ul><li><p>å®ç°ä¸€ä¸ªäºŒç»´å‘é‡ç›¸åŠ </p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">addVectors :: (Num a) &#x3D;&gt; (a, a) -&gt; (a, a) -&gt; (a, a)addVectors a b &#x3D; (fst a + fst b, snd a + snd b)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>ç”¨æ¨¡å¼åŒ¹é…å†™å</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">addVectors :: (Num a) &#x3D;&gt; (a, a) -&gt; (a, a) -&gt; (a, a)addVectors (x1, y1) (x2, y2) &#x3D; (x1 + x2, y1 + y2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>åœ¨å®šä¹‰å‡½æ•°çš„æ—¶å€™æˆ‘å°±å°†å‚æ•°ä¸ä¼ å…¥å€¼è¿›è¡Œäº†åŒ¹é…</p></li><li><p>å®ç°ä¸€ä¸ª<code>List</code>çš„<code>reverse</code>(æ³¨æ„å®ç°æ€è·¯ä¸æ¨¡å¼åŒ¹é…çš„åº”ç”¨)</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">reverse&#39; :: [a] -&gt; [a]reverse&#39; (x : xs) &#x3D; reverse&#39; xs ++ [x]reverse&#39; [] &#x3D; []<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><ul><li><p><code>x : xs</code>: è¡¨ç¤ºåŒ¹é…ä¸€ä¸ªList,å°†è¿™ä¸ªListçš„ç¬¬ä¸€ä¸ªå…ƒç´ è®¾ç½®ä¸º<code>x</code>,å‰©ä¸‹çš„è®¾ç½®ä¸º<code>xs</code></p><p>ä¾‹å¦‚:ä½¿ç”¨å…¶åŒ¹é…çš„æ—¶å€™<code>[1,2,3]</code>å°±ä¼šåŒ¹é…ä¸º<code>1:[2,3]</code>,äºæ˜¯<code>x = 1, xs = [2,3]</code></p><p>âš ï¸ä½¿ç”¨è¿™æ ·çš„æ–¹å¼åŒ¹é…æ•°ç»„æ—¶éœ€è¦åŠ ä¸Šæ‹¬å·è¡¨ç¤ºä»–ä»¬æ˜¯ä¸€ä½“çš„</p></li><li><p><code>reverse</code>å‡½æ•°æ˜¯ä»€ä¹ˆå‘¢? å°±æ˜¯æŠŠæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ”¾åˆ°æœ€å,åœ¨å‰é¢åŠ ä¸Šåè½¬åçš„å‰©ä¸‹çš„å…ƒç´ </p></li><li><p>ä»€ä¹ˆæ—¶å€™ä¼šåŒ¹é…å¤±è´¥å‘¢? å½“å‚æ•°æ˜¯ç©ºæ•°ç»„çš„æ—¶å€™å°±å–ä¸å‡ºæ¥å¤´,äºæ˜¯è®¾ç½®ä¸€ä¸ªè¾¹ç•Œå€¼</p></li></ul></li><li><p>å®ç°ä¸€ä¸ª<code>List</code>çš„<code>head</code>å‡½æ•°</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">head&#39; :: [a] -&gt; ahead&#39; (x:_) &#x3D; xhead&#39; [] &#x3D; error &quot;empty list&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>æˆ‘ä»¬å¹¶ä¸å…³å¿ƒæ¨¡å¼åŒ¹é…æ—¶é¦–å…ƒç´ åé¢çš„å…ƒç´ ,é‚£ä¹ˆå¯ä»¥ç”¨<code>_</code>ä»£æ›¿</p></li><li><p>å®ç°ä¸€ä¸ªå¿«é€Ÿæ’åº</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">qsort :: (Ord a) &#x3D;&gt; [a] -&gt; [a]qsort (target:xs) &#x3D; [x|x&lt;-xs, x&lt;&#x3D;target] ++ [target] ++ [x|x&lt;-xs, x&gt;target]qsort [] &#x3D; []<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„ä¾‹å­, å¿«é€Ÿæ’åºæ˜¯ä»€ä¹ˆ, å°±æ˜¯éšä¾¿è¿™ä¸€ä¸ªå…ƒç´ ,æŠŠæ¯”ä»–å°çš„æ’åºåæ”¾åœ¨å·¦è¾¹, æ¯”ä»–å¤§çš„æ’åºåæ”¾åœ¨å³è¾¹</p></li><li><p>è¿˜å¯ä»¥åœ¨åŒ¹é…æ—¶ä½¿ç”¨<code>@</code>è¯­æ³•ä¿ç•™å¯¹æ•´ä½“çš„å¼•ç”¨</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">capital :: String -&gt; Stringcapital &quot;&quot; &#x3D; &quot;Empty string, whoops!&quot;capital all@(x:xs) &#x3D; &quot;The first letter of &quot; ++ all ++ &quot; is &quot; ++ [x]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p></li></ul><h4 id="guardså®ˆå«">Guards(å®ˆå«)</h4><p>ğŸ’‚ğŸ½<code>guard</code>ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªå€¼çš„æŸé¡¹å±æ€§æ˜¯å¦ä¸ºçœŸ.å¬èµ·æ¥å’Œè·¯ç”±å®ˆå«ä¸€æ ·, å¦‚æœæ¡ä»¶åˆ¤æ–­é€šè¿‡å°±æ”¾è¡Œ. ä¾‹å¦‚è®¡ç®—BMIå‡½æ•°:</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">bmiTell :: (RealFloat a) &#x3D;&gt; a -&gt; StringbmiTell bmi         -- æ³¨æ„è¿™é‡Œæ²¡æœ‰ç­‰å·    | bmi &lt;&#x3D; 18.5 &#x3D; &quot;underweight&quot;      -- ç­‰å·åœ¨è¿™é‡Œ    | bmi &lt;&#x3D; 25.0 &#x3D; &quot;Pffft&quot;                -- ä¸if-elseä¸€æ ·åªä¼šåŒ¹é…ç¬¬ä¸€ä¸ªé€šè¿‡çš„    | bmi &lt;&#x3D; 30.0 &#x3D; &quot;fat&quot;    | otherwise   &#x3D; &quot;whale&quot;      -- æœ€åå¯ä»¥ä½¿ç”¨otherwiseå…œåº•<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ğŸ‘€çœ‹èµ·æ¥æ˜¯ä¸ªè¯­æ³•ç³–: <code>|</code>å’Œ<code>if-else-if</code>ä¸€æ ·,<code>otherwise</code>å’Œå…œåº•<code>else</code>ä¸€æ ·,ä½†æ˜¯ç”¨åœ¨æ­¤å¤„ç›¸å½“ç®€æ´.</p><p>âš ï¸å¦‚æœä½¿ç”¨<code>Guard</code>ä¸”æ²¡æœ‰ä½¿ç”¨<code>otherwise</code>ä¸”å…¨éƒ¨åŒ¹é…å¤±è´¥,Haskellä¼šåŒ¹é…ä¸‹ä¸€ä¸ªå‡½æ•°, ä¾‹å¦‚:</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">f :: (Ord a, Num a) &#x3D;&gt; a -&gt; [a]f x  | x &lt; 0 &#x3D; error &quot;make sure x &gt;&#x3D; 0&quot;  | x &#x3D;&#x3D; 0 &#x3D; [0]f x &#x3D; x : f (x - 1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœ<code>x&gt;0</code>, <code>f x</code>ä¼šå…ˆè¿›å…¥ç¬¬ä¸€ä¸ªå‡½æ•°,ä¸¤ä¸ª<code>guard</code>éƒ½åŒ¹é…å¤±è´¥äº†, äºæ˜¯è¿›å…¥ä¸‹ä¸€ä¸ªæ¨¡å¼åŒ¹é…</p><h4 id="whereç»‘å®š">Whereç»‘å®š</h4><p>æ”¹è¿›ä¸€ä¸‹BMI, è¦æ±‚ç”¨æˆ·è¾“å…¥èº«é«˜ä¸ä½“é‡ğŸ‘‡</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">bmiTell :: (RealFloat a) &#x3D;&gt; a -&gt; a -&gt; StringbmiTell weight height    | weight &#x2F; height ^ 2 &lt;&#x3D; 18.5 &#x3D; &quot;underweight&quot;    | weight &#x2F; height ^ 2 &lt;&#x3D; 25.0 &#x3D; &quot;Pffft&quot;    | weight &#x2F; height ^ 2 &lt;&#x3D; 30.0 &#x3D; &quot;fat&quot;    | otherwise                   &#x3D; &quot;whale&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸å‘½ä»¤å¼è¯­è¨€ä¸€æ ·, æˆ‘ä»¬æƒ³æŠŠ<code>weight / height ^ 2</code>å®šä¹‰æˆå˜é‡,å¯ä»¥ä½¿ç”¨<code>where</code>å…³é”®å­—</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">bmiTell :: (RealFloat a) &#x3D;&gt; a -&gt; a -&gt; StringbmiTell weight height    | bmi &lt;&#x3D; 18.5 &#x3D; &quot;underweight&quot;    | bmi &lt;&#x3D; 25.0 &#x3D; &quot;Pffft&quot;    | bmi &lt;&#x3D; 30.0 &#x3D; &quot;fat&quot;    | otherwise   &#x3D; &quot;whale&quot;    where bmi &#x3D; weight &#x2F; height ^ 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°±åƒå†™æ•°å­¦å…¬å¼ä¸€æ · <span class="math display">\[\begin{equation}f(h,w) = \left\{ \\\begin{aligned}&amp;\text{underweight} &amp; BMI\leq 18.5 \\&amp;\text{Pffft} &amp; 18.5&lt; BMI\leq 25 \\&amp;\text{fat} &amp; 25&lt; BMI\leq 30 \\&amp;\text{whale} &amp; 30&lt; BMI\end{aligned}\right.\ \ \ where\ BMI = w/h^2\end{equation}\]</span> <code>where</code>åé¢å¯ä»¥è·Ÿå¤šä¸ªåå­—å’Œå‡½æ•°å®šä¹‰</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">bmiTell :: (RealFloat a) &#x3D;&gt; a -&gt; a -&gt; StringbmiTell weight height    | bmi &lt;&#x3D; skinny &#x3D; &quot;You&#39;re underweight, you emo, you!&quot;    | bmi &lt;&#x3D; normal &#x3D; &quot;You&#39;re supposedly normal. Pffft, I bet you&#39;re ugly!&quot;    | bmi &lt;&#x3D; fat    &#x3D; &quot;You&#39;re fat! Lose some weight, fatty!&quot;    | otherwise     &#x3D; &quot;You&#39;re a whale, congratulations!&quot;    where bmi &#x3D; weight &#x2F; height ^ 2          skinny &#x3D; 18.5          normal &#x3D; 25.0          fat &#x3D; 30.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>âš ï¸æ³¨æ„</p><ul><li><p><code>where</code> ç»‘å®šä¸­å®šä¹‰çš„åå­—åªå¯¹æœ¬å‡½æ•°å¯è§,å…¶ä¸­çš„åå­—éƒ½æ˜¯ä¸€åˆ—å‚ç›´æ’å¼€</p></li><li><p><code>where</code> ç»‘å®šä¹Ÿå¯ä»¥ä½¿ç”¨æ¨¡å¼åŒ¹é…,å‰é¢é‚£æ®µä»£ç å¯ä»¥æ”¹æˆï¼š</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">where bmi &#x3D; weight &#x2F; height ^ 2      (skinny, normal, fat) &#x3D; (18.5, 25.0, 30.0)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><code>where</code>å¯ä»¥åµŒå¥—ä½¿ç”¨</p></li></ul><h4 id="letç»‘å®š">Letç»‘å®š</h4><p>ä¸<code>where</code>ç±»ä¼¼, ä½œç”¨åŸŸä¸åŒ.<code>where</code>ç»‘å®šåœ¨å‡½æ•°åº•éƒ¨,åœ¨<strong>æ‰€æœ‰<code>guard</code>å†…</strong>å¯è§,ä½†<code>let</code>åªå¯¹<code>let-in</code>ç»‘å®šçš„<code>in</code><strong>è¡¨è¾¾å¼</strong>å¯è§,ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">cylinder :: (RealFloat a) &#x3D;&gt; a -&gt; a -&gt; acylinder r h &#x3D;    let sideArea &#x3D; 2 * pi * r * h        topArea &#x3D; pi * r ^2    in  sideArea + 2 * topArea<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="caseè¡¨è¾¾å¼">Caseè¡¨è¾¾å¼</h4><p>ä¸å‘½ä»¤å¼ç¼–ç¨‹çš„<code>case</code>ç±»ä¼¼, åŒæ ·æ”¯æŒæ¨¡å¼åŒ¹é…</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">case expression of pattern -&gt; result                   pattern -&gt; result                   pattern -&gt; result                   ...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">describeList :: [a] -&gt; StringdescribeList xs &#x3D; &quot;The list is &quot; ++ case xs of [] -&gt; &quot;empty.&quot;                                               [x] -&gt; &quot;a singleton list.&quot;                                               xs -&gt; &quot;a longer list.&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å°†å‡½æ•°å®šä¹‰ä¸ºä¸­ç¼€å‡½æ•°">å°†å‡½æ•°å®šä¹‰ä¸ºä¸­ç¼€å‡½æ•°</h4><p>ä¸ä½¿ç”¨åå¼•å·ä¹Ÿå¯ä»¥å®šä¹‰ä¸­ç¼€å‡½æ•°. ä½†æ˜¯,å‡½æ•°ååªèƒ½ä½¿ç”¨<code>:|!@#$%^&amp;*-+./&lt;&gt;?\~</code>,ä¹‹åå¯ä»¥ä½¿ç”¨ä¸‹é¢ä»»æ„æ–¹å¼å®šä¹‰</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">a |+| b   &#x3D; method1(|+|) a b &#x3D; method1 a b(|+|)     &#x3D; method1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="å®šä¹‰å‡½æ•°çš„ç»“åˆæ€§ä¸ä¼˜å…ˆçº§">å®šä¹‰å‡½æ•°çš„ç»“åˆæ€§ä¸ä¼˜å…ˆçº§</h4><p>ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">infixr 9 op<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>infi*</code>å®šä¹‰ç»“åˆæ€§ <code>infixr</code>æ˜¯å³ç»“åˆ,<code>infixl</code>æ˜¯å·¦ç»“åˆ, <code>infix</code>æ— å·¦å³ä¼˜å…ˆæ€§.</li><li>æ•°å­—å®šä¹‰ä¼˜å…ˆçº§ ä¼˜å…ˆçº§ä¸€å…±æœ‰åä¸ª, <code>0-9</code>, æ•°å­—è¶Šå¤§è¶Šé«˜,å¦‚æœå®šä¹‰æ—¶çœç•¥äº†æ•°å­—, åˆ™é»˜è®¤ä¸º9. é¢„å®šä¹‰çš„æœ‰</li></ul><table><thead><tr class="header"><th>å€¼</th><th>å·¦ç»“åˆ</th><th>æ— ç»“åˆ</th><th>å³ç»“åˆ</th></tr></thead><tbody><tr class="odd"><td>9</td><td>!!</td><td></td><td>.</td></tr><tr class="even"><td>8</td><td></td><td></td><td>^, ^^, **</td></tr><tr class="odd"><td>7</td><td>*,/,<code>div</code></td><td></td><td></td></tr><tr class="even"><td>6</td><td>+, -</td><td></td><td></td></tr><tr class="odd"><td>5</td><td></td><td></td><td>:, ++</td></tr><tr class="even"><td>4</td><td></td><td>==,/=,&lt;,&lt;=,&gt;,&gt;=,<code>elem</code>,<code>notElem</code></td><td></td></tr><tr class="odd"><td>3</td><td></td><td></td><td>&amp;&amp;</td></tr><tr class="even"><td>2</td><td></td><td></td><td></td></tr><tr class="odd"><td>1</td><td>&gt;&gt;, &gt;&gt;=</td><td></td><td></td></tr><tr class="even"><td>0</td><td></td><td></td><td><span class="math inline">\(,\)</span>!,<code>seq</code></td></tr></tbody></table><h3 id="é€’å½’">é€’å½’</h3><p>ğŸª†ä½¿ç”¨æ¨¡å¼åŒ¹é…ä¸é€’å½’å¯ä»¥ä¼˜é›…çš„å®ç°é€’å½’.åœ¨å®ç°é€’å½’æ—¶æœ€éœ€è¦å…³æ³¨çš„å°±æ˜¯<strong>è¾¹ç•Œæ¡ä»¶</strong>.<strong>è€Œé€’å½’çš„çš„å®ç°æ€è·¯å°±æ˜¯æè¿°é—®é¢˜æ˜¯å¦‚ä½•å®šä¹‰çš„</strong></p><ul><li><p>å®ç°<code>List</code>çš„<code>max</code>å‡½æ•°</p><p>å‘½ä»¤å¼æ€è·¯: è®¾ä¸€ä¸ªå˜é‡æ¥å­˜å‚¨å½“å‰çš„æœ€å¤§å€¼ï¼Œç„¶åç”¨å¾ªç¯éå†è¯¥<code>List</code>ï¼Œè‹¥å­˜åœ¨æ¯”è¿™ä¸ªå€¼æ›´å¤§çš„å…ƒç´ ï¼Œåˆ™ä¿®æ”¹å˜é‡ä¸ºè¿™ä¸€å…ƒç´ çš„å€¼</p><p>å‡½æ•°å¼æ€è·¯:<code>List</code>çš„æœ€å¤§å€¼å°±æ˜¯<code>head</code>å’Œ<code>tail</code>æœ€å¤§å€¼çš„æœ€å¤§å€¼.ç©º<code>List</code>çš„æœ€å¤§å€¼ä¸ºError</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">maximum&#39; :: (Ord a) &#x3D;&gt; [a] -&gt; amaximum&#39; [] &#x3D; error &quot;maximum of empty list&quot;maximum&#39; [x] &#x3D; xmaximum&#39; (x:xs)    | x &gt; maxTail &#x3D; x    | otherwise &#x3D; maxTail    where maxTail &#x3D; maximum&#39; xs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å®ç°<code>replicate n x</code>å‡½æ•°(å°†<code>x</code>é‡å¤<code>n</code>æ¬¡)</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">replicate&#39; :: (Num i, Ord i) &#x3D;&gt; i -&gt; a -&gt; [a]replicate&#39; n x    | n &lt;&#x3D; 0    &#x3D; []    | otherwise &#x3D; x:replicate&#39; (n-1) x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>âš ï¸è¿™é‡Œä½¿ç”¨<code>Guard</code>è€Œä¸æ˜¯æ¨¡å¼åŒ¹é…æ˜¯å› ä¸ºæ¨¡å¼åŒ¹é…æ— æ³•åŒ¹é…<code>&lt;0</code></p></li><li><p>å®ç°<code>take</code>å‡½æ•°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">take&#39; :: (Num i, Ord i) &#x3D;&gt; i -&gt; [a] -&gt; [a]take&#39; 0 _ &#x3D; []take&#39; _ [] &#x3D; []take&#39; n (x:xs) &#x3D; x : take&#39; (n-1) xs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ›´åŠ å‘¨å…¨çš„çš„ä»£ç (åŒæ ·å› ä¸ºæˆ‘ä»¬è¦åŒ¹é…<code>n&lt;0</code>çš„æƒ…å†µ,æ‰€ä»¥ä¸èƒ½ç”¨æ¨¡å¼åŒ¹é…äº†)</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">take&#39; :: (Num i, Ord i) &#x3D;&gt; i -&gt; [a] -&gt; [a]take&#39; n _    | n &lt;&#x3D; 0   &#x3D; []take&#39; _ []     &#x3D; []take&#39; n (x:xs) &#x3D; x : take&#39; (n-1) xs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å®ç°<code>repeat</code>å‡½æ•°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">repeat&#39; :: a -&gt; [a]repeat&#39; x &#x3D; x:repeat&#39; x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>å®ç°<code>zip</code>å‡½æ•°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">zip&#39; :: [a] -&gt; [b] -&gt; [(a, b)]zip&#39; [] _ &#x3D; []zip&#39; _ [] &#x3D; []zip&#39; (x1:xs1) (x2:xs2) &#x3D; (x1,x2):zip&#39; xs1 xs2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å®ç°<code>elem</code>å‡½æ•°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">elem&#39; :: (Eq a) &#x3D;&gt; a -&gt; [a] -&gt; Boolelem&#39; e [] &#x3D; Falseelem&#39; e (x : xs) &#x3D; (e &#x3D;&#x3D; x) || elem&#39; e xs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯æœ‰ç‚¹ä¸å‡½æ•°å¼, æ”¹ä¸€æ”¹</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">elem&#39; :: (Eq a) &#x3D;&gt; a -&gt; [a] -&gt; Boolelem&#39; e (x : xs)  | e &#x3D;&#x3D; x &#x3D; True  | otherwise &#x3D; elem&#39; e xselem&#39; e _ &#x3D; False<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ¸©ä¹ ä¸€ä¸‹å¿«é€Ÿæ’åº(å¹¶ä½¿ç”¨<code>where</code>è®©å…¶çœ‹èµ·æ¥æ›´åƒå‡½æ•°å¼)</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">qsort :: (Ord a) &#x3D;&gt; [a] -&gt; [a]qsort (target:xs) &#x3D; lowers ++ [target] ++ uppers  where lowers &#x3D; qsort [x|x&lt;-xs, x&lt;&#x3D;target]        uppers &#x3D; qsort [x|x&lt;-xs, x&gt;target]qsort _ &#x3D; []<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>âš ï¸æ€è·¯: å®šä¹‰è¾¹ç•Œæ¡ä»¶, å†å®šä¹‰ä¸ªå‡½æ•°,è®©å®ƒä»ä¸€å †å…ƒç´ ä¸­å–ä¸€ä¸ªå¹¶åšç‚¹äº‹æƒ…å, æŠŠä½™ä¸‹çš„å…ƒç´ é‡æ–°äº¤ç»™è¿™ä¸ªå‡½æ•°</p><ul><li><p>å®ç°åŸƒç­›</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">primes &#x3D; filterPrime [2..]  where filterPrime (p:xs) &#x3D;          p : filterPrime [x | x &lt;- xs, x &#96;mod&#96; p &#x2F;&#x3D; 0]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™ç§ç”Ÿæˆå™¨ç”Ÿæˆ+éªŒè¯å™¨éªŒè¯çš„æ¨¡å¼å€¼å¾—å­¦ä¹ </p></li><li><p>å®ç°æ–æ³¢é‚£å¥‘</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">fib :: Int -&gt; [Int]fib n &#x3D; take n $ fibList [1, 1]  where    fibList [a, b] &#x3D; a : fibList [b, a + b]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„å­¦ä¹ å¦‚ä½•å­˜å‚¨é€’å½’ä¸­éœ€è¦çš„è°ƒç”¨å€¼</p></li></ul><h3 id="å‡½æ•°pro">å‡½æ•°Pro</h3><p>ğŸ˜•å‡½æ•°å¼ç¼–ç¨‹ä¸æ•°å­¦è¡¨è¾¾å¼çœ‹èµ·æ¥å¤ªåƒäº†.</p><p>ğŸ‘¼äºæ˜¯æˆ‘å¤©çœŸçš„ä»¥ä¸ºå‡½æ•°å¼ç¼–ç¨‹å°±æ˜¯ç”¨æ•°å­¦çš„æ–¹å¼æè¿°é—®é¢˜,ç„¶åå°†å…¶è¡¨ç¤ºä¸ºå‡½æ•°å¼ç¼–ç¨‹è¯­å¥.</p><p>ğŸ¤”å®é™…ä¸Šå‡½æ•°å¼ç¼–ç¨‹æ›´åŠ æ³¨é‡<strong>å°†å‡½æ•°ä½œä¸º"ä¸€ç­‰å…¬æ°‘",ä»è€Œæ“ä½œå‡½æ•°æˆ–æ˜¯å‡½æ•°çš„ä¸€éƒ¨åˆ†è§£å†³é—®é¢˜</strong></p><h4 id="å‡½æ•°æŸ¯é‡ŒåŒ–ä¸ä¸å…¨è°ƒç”¨">å‡½æ•°æŸ¯é‡ŒåŒ–ä¸ä¸å…¨è°ƒç”¨</h4><p>åœ¨JSä¸­ç»å¸¸èƒ½å¬åˆ°è¿™ä¸ªå‡½æ•°æŸ¯é‡ŒåŒ–è¿™ä¸ªè¯è¯­, åœ¨JSä¸­,æŸ¯é‡ŒåŒ–å°±æ˜¯æŠŠå¤šå‚å‡½æ•°å˜æˆå•å‚å‡½æ•°,å¹¶è¿”å›ä¸€ä¸ªå•å‚æ•°å‡½æ•°ç”¨äºåƒä¸‹ä¸‹ä¸€ä¸ªå‚æ•°.</p><p>ğŸ¬ä½†æ˜¯, Haskellä¸­æ‰€æœ‰å‡½æ•°éƒ½åªæœ‰ä¸€ä¸ªå‚æ•°, æ‰€æœ‰å‡½æ•°éƒ½æ˜¯æŸ¯é‡ŒåŒ–å‡½æ•°.è€Œå¤šå‚å‡½æ•°åªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–!</p><p>ğŸ˜±æ‹¿<code>max</code>å‡½æ•°ä¸¾ä¾‹.<code>max</code>å‡½æ•°å®é™…ä¸Šåªæ¥å—ä¸€ä¸ªå‚æ•°<code>x</code>,ç„¶åè¿”å›ä¸€ä¸ªå’Œ<code>x</code>æ¯”è¾ƒå¤§å°çš„å‡½æ•°,ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">comp x y &#x3D; x y  -- æ¥å—x,y è¿”å›x yçš„ç»“æœmaxWith5 &#x3D; max 5     -- è¿”å›ä¸€ä¸ªmax 5å‡½æ•°res &#x3D; zipWith comp (repeat maxWith5) [1 .. 10]-- [5,5,5,5,5,6,7,8,9,10]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå°±æ˜¯è¯´<code>maxWith5</code>å°±æ˜¯ä¸€ä¸ªå‡½æ•°, å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°,è¿”å›å’Œ<code>5</code>æ¯”è¾ƒå¤§çš„é‚£ä¸ª,ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¹‹å‰å†™çš„<code>max 5 6</code>å¯ä»¥å†™æˆ<code>(max 5) 6</code></p><p>å†çœ‹çœ‹<code>maxWith5</code>,è¯•è¯•å†™å‡ºä»–çš„ç±»å‹:<code>Ord a =&gt; a -&gt; a</code>. æ˜¾è€Œæ˜“è§,æ¥å—ä¸€ä¸ª<code>Ord</code>ç±»å‹ç±»çš„<code>a</code>ç±»å˜é‡,è¿”å›ä¸€ä¸ª<code>a</code>ç±»å˜é‡. è€Œä¹‹å‰é‚£ä¸ª<code>max</code>å‡½æ•°å‘¢?æ”¶åˆ°ä¸€ä¸ª<code>a</code>ç±»å˜é‡,è¿”å›ä¸€ä¸ª<code>Ord a =&gt; a -&gt; a</code>ç±»å‡½æ•°.è¯•è¯•å†™å‡º<code>max</code>å‡½æ•°ç±»å‹:<code>Ord a =&gt; a -&gt; (a-&gt;a)</code>è¿™ä¸ªæ‹¬å·æ²¡å•¥ç”¨(å› ä¸ºHaskellæ˜¯è‡ªå·¦å‘å³è§£æçš„)äºæ˜¯ç®€åŒ–æˆ<code>Ord a =&gt; a -&gt; a -&gt; a</code>è¿™ä¹Ÿå°±è§£é‡Šäº†<strong>ä¸ºä»€ä¹ˆæŠŠå‚æ•°ç±»å‹ä¸ç»“æœç”¨<code>-&gt;</code>è¿åœ¨ä¸€èµ·æ˜¯ç¬¦åˆç›´è§‰çš„</strong></p><p>âš›åƒ<code>max 5</code>è¿™æ ·çš„å‡½æ•°è°ƒç”¨å°±æ˜¯<strong>ä¸å…¨è°ƒç”¨</strong>,è€Œä¸­ç¼€å‡½æ•°ä¹Ÿå­˜åœ¨ä¸å…¨è°ƒç”¨, ä¾‹å¦‚<code>elem [1..]</code>, <code>==4</code>,<code>*5</code></p><h4 id="é«˜é˜¶å‡½æ•°">é«˜é˜¶å‡½æ•°</h4><p>ğŸŒŒé«˜é˜¶å‡½æ•°: æ¥æ”¶å‡½æ•°ä½œä¸ºå‚æ•°æˆ–è¿”å›å‡½æ•°çš„å‡½æ•°å°±æ˜¯é«˜é˜¶å‡½æ•°, ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">applyTwice :: (a -&gt; a) -&gt; a -&gt; aapplyTwice f x &#x3D; f (f x)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™ä¸ªç±»å‹ä¼¼ä¹æœ‰ç‚¹ç‰¹åˆ«, å¤šäº†ä¸€ä¸ªæ‹¬å·,è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°è€Œä¸æ˜¯ç±»å‹<code>a</code>(å› ä¸ºHaskellæ˜¯å³ç»“åˆçš„)</p><p>ç»“åˆå‡½æ•°æŸ¯é‡ŒåŒ–ä¸ä¸å…¨è°ƒç”¨, æˆ‘ä»¬å¯ä»¥å†™å‡ºè¿™æ ·çš„è¡¨è¾¾å¼</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">applyTwice (+3) 10         -- 16 (è°ƒç”¨å‡½æ•°å­  ğŸ˜²applyTwice (++ &quot; HAHA&quot;) &quot;HEY&quot;  --&quot;HEY HAHA HAHA&quot;applyTwice (&quot;HAHA &quot; ++) &quot;HEY&quot;    -- &quot;HAHA HAHA HEY&quot;ghci&gt; applyTwice (multThree 2 2) 9  -- 144ghci&gt; applyTwice (3:) [1]           -- [3,3,1]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»“åˆå‡½æ•°å­å¯ä»¥å®ç°å¤šç§ç‚«é…·çš„æ“ä½œ. è¿™å°±æ˜¯æŠŠå‡½æ•°å½“æˆå¯¹è±¡ç”¨</p><p>å®ç°ä¸€ä¸ª<code>zipWith</code>, ä½“éªŒä¸€ä¸‹æ— å‚æ•°çš„ä¸å…¨è°ƒç”¨</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">zipWith&#39; :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]zipWith&#39; f (x : xs) (y : ys) &#x3D; f x y : zipWith&#39; f xs yszipWith&#39; (+) [4,2,5,6] [2,6,2,3]         --[6,8,7,9]zipWith&#39; max [6,3,2,1] [7,3,1,5]         -- [7,3,2,5]zipWith&#39; (++) [&quot;foo &quot;, &quot;bar &quot;, &quot;baz &quot;] [&quot;fighters&quot;, &quot;hoppers&quot;, &quot;aldrin&quot;]-- [&quot;foo fighters&quot;,&quot;bar hoppers&quot;,&quot;baz aldrin&quot;]zipWith&#39; (*) (replicate 5 2) [1..]       -- [2,4,6,8,10]zipWith&#39; (zipWith&#39; (*)) [[1,2,3],[3,5,6],[2,3,4]] [[3,2,2],[3,4,5],[5,4,3]]-- [[3,4,6],[9,20,30],[10,12,12]]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥å€ŸåŠ©é«˜é˜¶å‡½æ•°å®ç°å‘½ä»¤å¼ä¸­çš„<code>for</code>ã€<code>while</code>ã€èµ‹å€¼ã€çŠ¶æ€æ£€æµ‹</p><p><code>flip</code>æ˜¯ä¸€ä¸ªå¸¸ç”¨é«˜é˜¶å‡½æ•°, å®ç°åŠŸèƒ½å¾ˆç®€å•</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">flip :: (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; cflip f y x &#x3D; f x y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¹Ÿå°±æ˜¯ä¼ å…¥ä¸€ä¸ªäºŒå…ƒå‡½æ•°, ä¼ å›ä¸€ä¸ªæ¥å—å‚æ•°ç›¸åçš„äºŒå…ƒå‡½æ•°(<strong>æ³¨æ„:ä¼ å›çš„æ˜¯å‡½æ•°è€Œä¸æ˜¯å‡½æ•°çš„è¿è¡Œç»“æœ!</strong>)</p><p>âš ï¸<code>flip</code>ç»å¸¸ç”¨æ¥å¯¹åº“å‡½æ•°è¿›è¡Œæ”¹è¿›, ä¾‹å¦‚æˆ‘éœ€è¦å‡½æ•°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">pushFont :: [a]-&gt;a-&gt;[a]pushFont xs x &#x3D; x:xs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¦æ˜¯å‡½æ•°å‚æ•°èƒ½åè¿‡æ¥å°±å¥½äº†, äºæ˜¯æˆ‘å°±å¯ä»¥å†™</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">pushFont :: [a]-&gt;a-&gt;[a]pushFont &#x3D; flip (:)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸éœ€è¦æ·»åŠ å‚æ•°, å°±ç®—å›ºæ‰§çš„æ·»åŠ ä¸Šäº†å‚æ•°, å‡½æ•°åªæ˜¯å˜æˆè¿™æ ·</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">pushFont :: [a]-&gt;a-&gt;[a]pushFont x xs &#x3D; flip (:) x xs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>éƒ½æ˜¯åœ¨æœ€åè°ƒç”¨å‡½æ•°, é‚£ä¹ˆåŠ ä¸åŠ å‚æ•°æ²¡å…³ç³». è®°ä½:<strong>æˆ‘ä»¬å®šä¹‰çš„æ˜¯å‡½æ•°, è€Œä¸æ˜¯è¿ç®—ç»“æœ</strong></p><h4 id="lambdaå‡½æ•°">Lambdaå‡½æ•°</h4><p>ä¸JSç±»å‹, å¯ä»¥ç”ŸæˆåŒ¿åå‡½æ•°, é€šå¸¸åœ¨è¿™ä¸ªå‡½æ•°åªæ˜¯ç”¨ä¸€æ¬¡çš„æ—¶å€™ä½¿ç”¨,è¯­æ³•ä¸º<code>\å‚æ•°1 å‚æ•°2 -&gt; è¡¨è¾¾å¼</code>, ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">flip&#39; :: (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; cflip&#39; f x y &#x3D; \x y -&gt; f y x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å°½ç®¡è¿™ä¸ <code>flip' f x y = f y x</code>ç­‰ä»·ï¼Œå®ƒå¯ä»¥æ›´æ˜ç™½åœ°è¡¨ç¤ºå‡ºå®ƒä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å‡½æ•°</p><h4 id="mapfilterfoldscan">map&amp;filter&amp;fold&amp;scan</h4><p>è¿™å‡ ä¸ªå‡½æ•°ä¸JSçš„<code>Array.map</code>, <code>Array.filter</code>,<code>Array.reduce</code>å¾ˆåƒ, æ‰€ä»¥ååˆ†é‡è¦</p><p>ä»–ä»¬æœ¬èº«æ˜¯Listçš„æ–¹æ³•, ä½†æ˜¯åœ¨åº“å‡½æ•°åŠ è½½çš„æ—¶å€™è¢«è‡ªåŠ¨å¼•ç”¨äº†,ä¹Ÿå°±æ˜¯ç±»ä¼¼äº</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">map &#x3D; Array.map<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p><code>map</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">map :: (a -&gt; b) -&gt; [a] -&gt; [b]map _ [] &#x3D; []map f (x:xs) &#x3D; f x : map f xs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¼ å…¥æ˜ å°„å‡½æ•°ä¸<code>List</code>, è¿”å›å¯¹æ¯ä¸ªå…ƒç´ æ˜ å°„åçš„ç»“æœ</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">map (+3) [1,5,3,1,6]                    -- [4,8,6,4,9]map (++ &quot;!&quot;) [&quot;BIFF&quot;, &quot;BANG&quot;, &quot;POW&quot;]    -- [&quot;BIFF!&quot;,&quot;BANG!&quot;,&quot;POW!&quot;]map (replicate 3) [3..6]               -- [[3,3,3],[4,4,4],[5,5,5],[6,6,6]]map (map (^2)) [[1,2],[3,4,5,6],[7,8]]  -- [[1,4],[9,16,25,36],[49,64]]map fst [(1,2),(3,5),(6,3),(2,6),(2,5)] -- [1,3,6,2,2]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨å‡½æ•°å­ä½œä¸ºå‡½æ•°è°ƒç”¨å°±è®©<code>map</code>ç‚«é…·å¤šäº†</p><p>ä»¥ä¸Šçš„æ‰€æœ‰ä»£ç éƒ½å¯ä»¥ç”¨ List Comprehensionæ¥æ›¿ä»£ã€‚<code>map (+3) [1,5,3,1,6]</code> ä¸<code>[x+3 | x &lt;- [1,5,3,1,6]</code> å®Œå…¨ç­‰ä»·.</p></li><li><p><code>filter</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]filter _ [] &#x3D; []filter p (x:xs)    | p x       &#x3D; x : filter p xs    | otherwise &#x3D; filter p xs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¼ å…¥åˆ¤æ–­å‡½æ•°, ä¼ å‡ºç¬¦åˆè¦æ±‚çš„å…ƒç´ </p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">filter (&gt;3) [1,5,3,2,1,6,4,3,2,1]         -- [5,6,4]filter (&#x3D;&#x3D;3) [1,2,3,4,5]                  -- [3]filter even [1..10]                       -- [2,4,6,8,10]let notNull x &#x3D; not (null x) in filter notNull [[1,2,3],[],[3,4,5],[2,2],[],[],[]]-- [[1,2,3],[3,4,5],[2,2]]filter (&#96;elem&#96; [&#39;a&#39;..&#39;z&#39;]) &quot;u LaUgH aT mE BeCaUsE I aM diFfeRent&quot;-- &quot;uagameasadifeent&quot;filter (&#96;elem&#96; [&#39;A&#39;..&#39;Z&#39;]) &quot;i lauGh At You BecAuse u r aLL the Same&quot;-- &quot;GAYBALLS&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸Šéƒ½å¯ä»¥ç”¨ <code>List Comprehension</code>çš„é™åˆ¶æ¡ä»¶æ¥å®ç°ã€‚å¹¶æ²¡æœ‰æ•™æ¡è§„å®šä½ å¿…é¡»åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ç”¨ <code>map</code> å’Œ<code>filter</code> è¿˜æ˜¯ <code>List Comprehension</code>.å¦‚æœæœ‰å¤šä¸ªé™åˆ¶æ¡ä»¶ï¼Œåªèƒ½è¿ç€å¥—å¥½å‡ ä¸ª <code>filter</code> æˆ–ç”¨<code>&amp;&amp;</code> ç­‰é€»è¾‘å‡½æ•°çš„ç»„åˆä¹‹, è¿™æ—¶å°±ä¸å¦‚<code>List comprehension</code></p></li><li><p><code>fold</code>ç³»åˆ—å‡½æ•°æœ‰<code>foldl</code>,<code>foldlr</code>,<code>foldl1</code>, <code>foldlr1</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">foldl&#39; :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; bfoldl&#39; _ pre [] &#x3D; prefoldl&#39; f pre (tar : tails) &#x3D; fold&#39; f (f pre tar) tails<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¸<code>reduce</code>ç±»ä¼¼, å‚æ•°æœ‰: æŒ‡å®šè¿”å›ç´¯åŠ å€¼å‡½æ•°, ç´¯åŠ åˆå§‹å€¼,æ•°ç»„. ä¾‹å¦‚:</p><p>å®ç°æ•°ç»„æ±‚å’Œ</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">sum&#39; :: (Num a) &#x3D;&gt; [a] -&gt; asum&#39; &#x3D; foldl (+) 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åˆçœç•¥å‚æ•°äº†, å› ä¸º<strong>æˆ‘ä»¬å®šä¹‰çš„æ˜¯å‡½æ•°,è€Œä¸æ˜¯è¿ç®—ç»“æœ</strong></p><p>å®ç°<code>reverse</code>(çœ‹æˆ‘æ˜¯å¤šè ¢ğŸ™ƒ)</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">reverse&#39; :: [a] -&gt; [a]reverse&#39; xs &#x3D; foldl (\acc x -&gt; x:acc) [] xs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>é¦–å…ˆ<code>xs</code>æ˜¯å¯ä»¥çœç•¥çš„(<strong>æˆ‘ä»¬å®šä¹‰çš„æ˜¯å‡½æ•°,è€Œä¸æ˜¯è¿ç®—ç»“æœ</strong>)</p><p>å…¶æ¬¡<code>\acc x -&gt; x:acc</code>å®é™…ä¸Šå°±æ˜¯<code>flip (:)</code>äºæ˜¯æ”¹æˆ</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">reverse&#39; :: [a] -&gt; [a]reverse&#39; &#x3D; foldl (flip (:)) []<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>foldr</code>ä¸<code>foldl</code>çš„åŒºåˆ«å°±æ˜¯å‰è€…æ˜¯è‡ªå³å‘å·¦éå†,ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">reverse&#39; :: [a] -&gt; [a]reverse&#39; &#x3D; foldr (:) []map&#39; :: (a -&gt; b) -&gt; [a] -&gt; [b]map&#39; f &#x3D; foldr (\x acc -&gt; f x : acc) []<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>foldl1</code> ä¸ <code>foldr1</code> çš„è¡Œä¸ºä¸<code>foldl</code> å’Œ <code>foldr</code>ç›¸ä¼¼ï¼Œåªæ˜¯ä½ æ— éœ€æ˜ç¡®æä¾›åˆå§‹å€¼ã€‚ä»–ä»¬å‡å®š Listçš„é¦–ä¸ª(æˆ–æœ«å°¾)å…ƒç´ ä½œä¸ºèµ·å§‹å€¼</p><p>å®ç°ä¸€äº›åº“å‡½æ•°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">maximum&#39; :: (Ord a) &#x3D;&gt; [a] -&gt; amaximum&#39; &#x3D; foldr1 (\x acc -&gt; if x &gt; acc then x else acc)product&#39; :: (Num a) &#x3D;&gt; [a] -&gt; aproduct&#39; &#x3D; foldr1 (*)filter&#39; :: (a -&gt; Bool) -&gt; [a] -&gt; [a]filter&#39; p &#x3D; foldr (\x acc -&gt; if p x then x : acc else acc) []head&#39; :: [a] -&gt; ahead&#39; &#x3D; foldr1 (\x _ -&gt; x)last&#39; :: [a] -&gt; alast&#39; &#x3D; foldl1 (\_ x -&gt; x)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>scan</code>ç³»åˆ—åŒ…æ‹¬<code>scanl</code>,<code>scanr</code>,<code>scanl1</code>å’Œ<code>scanr1</code>.å¯ä»¥ç®€å•ç†è§£ä¸º<code>scanl</code>,<code>scanr</code>è¿”å›çš„æ˜¯<code>foldl</code>,<code>foldr</code>çš„æ¯ä¸€æ­¥ä¸­é—´å€¼.<code>scanl1</code>å’Œ<code>scanr1</code>ä¸<code>foldl1</code>,<code>foldr1</code>ç±»ä¼¼</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">scanl&#39; :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; [b]scanl&#39; f xs0 &#x3D; foldl (\aac x -&gt; aac ++ [f x (last aac)]) [xs0]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°<code>scan*</code>ä¼¼ä¹æ˜¯è°ƒè¯•<code>fold*</code>çš„å¥½å·¥å…·</p></li></ul><p>ä¸ä¹‹å‰çš„è¯­æ³•ç»„åˆ, å¯ä»¥å‘ç°</p><ul><li><p><code>Lambda</code>è¡¨è¾¾å¼å¯ä»¥æ­é…è¿™äº›å‡½æ•°å®ç°ç‚«é…·æ•ˆæœ</p></li><li><p>å¯ä»¥ä½¿ç”¨<code>takeWhile</code>æ–¹ä¾¿çš„å¤„ç†ç”¨ä¸Šè¿°å‡½æ•°å¤„ç†æ— é™é•¿æ•°ç»„çš„ç»“æœ</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">takeWhile&#39; :: (a -&gt; Bool) -&gt; [a] -&gt; [a]takeWhile&#39; _ [] &#x3D; []takeWhile&#39; f (x : xs)  | f x &#x3D; x : takeWhile&#39; f xs  | otherwise &#x3D; []<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="ä¸.è°ƒç”¨"><code>$</code>ä¸<code>.</code>è°ƒç”¨</h4><ul><li><p><code>$</code>ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">($) :: (a -&gt; b) -&gt; a -&gt; bf $ x &#x3D; f x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ğŸ¤¨çœ‹èµ·æ¥å°±æ˜¯å°†è¿ä¸ªå‡½æ•°å’Œå‚æ•°è¿èµ·æ¥. å·®ä¸å¤š,ä½†æ˜¯åˆ«å¿˜äº†åœ¨Haskellä¸­å‡½æ•°è°ƒç”¨å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§(ä¸”æ˜¯å·¦ç»“åˆ, å³:åŒçº§è¡¨è¾¾å¼è‡ªå³å‘å·¦è®¡ç®—, ä¾‹å¦‚ f a b = (f a) b,å¯ä»¥ç²—æš´ç†è§£æˆå°†å·¦è¾¹çš„ç»“åˆåœ¨ä¸€èµ·),ä½†æ˜¯è¿™é‡Œçš„<code>$</code>å…·æœ‰æœ€ä½ä¼˜å…ˆçº§(ä¸”æ˜¯å³ç»“åˆ, å³:åŒçº§è¡¨è¾¾å¼è‡ªå·¦å‘å³è®¡ç®—, ä¾‹å¦‚ f $ a b = f (a b),å¯ä»¥ç²—æš´ç†è§£æˆå°†å³è¾¹çš„ç»“åˆåœ¨ä¸€èµ·)</p><p>ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">t &#x3D; max 5 max 6 7<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨Haskellä¸­ä¼šæŠ¥é”™, åŸå› æ˜¯Haskellå°†ä»£ç ç†è§£æˆäº†(å·¦ç»“åˆäº†)</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">t &#x3D; ((max 5) max) 6 7<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ‘ä»¬åªèƒ½æ·»åŠ æ‹¬å·</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">t &#x3D; max 5 (max 6 7)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦ä¸€ä¸ªæ–¹å¼å°±æ˜¯ä½¿ç”¨<code>$</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">t &#x3D; max 5 $ max 6 7--  |---| å…ˆè§£æè¿™ä¸€æ®µè¿”å›ä¸€ä¸ªå‡½æ•°--        ^ é‡åˆ°äº†$äºæ˜¯æ— æ³•è§£æ, è§£æå³è¾¹--          |------|è§£æè¿™ä¸€æ®µçš„å¾—åˆ°7--  (max 5) 7  å˜æˆäº†è¿™æ ·-- æœ€åå¾—åˆ°7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹<code>$</code>èµ·æ¥å°±åƒæ˜¯ä¸ºå·¦å³ä¸¤è¾¹åˆ†åˆ«åŠ äº†ç­‰ä¼˜å…ˆçº§çš„éš”ç¦»ç¬¦(æ‹¬å·)<strong>ä»è€Œä¿æŠ¤ä¸¤è¾¹åˆ†åˆ«è®¡ç®—</strong>,ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">map ($ 3) [(4+),(10*),(^2),sqrt]-- [7.0,30.0,9.0,1.7320508075688772]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>âš ï¸ä½†æ˜¯æ³¨æ„<code>$</code>å³ç»“åˆçš„,æ˜¯å•å€¼å‡½æ•°(å·¦è¾¹æ˜¯<strong>å‡½æ•°</strong>å³è¾¹æ˜¯<strong>å•å‚æ•°</strong>).å¯èƒ½ä½ ä¼šæƒ³Haskellä¸­çš„å‡½æ•°æœ¬èº«å°±æ˜¯æŸ¯é‡ŒåŒ–çš„å‡½æ•°ğŸ™„? ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆå½±å“?ğŸ¤¨äºæ˜¯æƒ³å½“ç„¶çš„è¿›è¡Œå¦‚ä¸‹æ”¹è¿›</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">t :: [(Int, Int)]t &#x3D; zip (map (+ 5) [1 .. 10]) (map (* 5) [10 .. 20])-- æ”¹ä¸º --&gt;t &#x3D; zip $ map (+ 5) [1 .. 10] $ map (* 5) [10 .. 20]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ğŸ¤¨çœ‹èµ·æ¥æ˜¯å¯è¡Œçš„</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">-- Step 1zip $ [6..15] $ [10..100]-- Step 2(zip [6..15]) [10..100]-- Step 3newFunction [10..100]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ğŸ’€æ‰§è¡Œå°±å‡ºé—®é¢˜, åˆ«å¿˜äº†<code>$</code>æ˜¯ä½ä¼˜å…ˆçº§å³ç»“åˆçš„,Haskellæ˜¯è¿™ä¹ˆç†è§£ä»£ç çš„</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">-- Step 1 $ æ˜¯ä½ä¼˜å…ˆçº§çš„, å…¶ä»–å…ˆè®¡ç®—zip $ [6..15] $ [10..100]-- Step 2 $ æ˜¯å³ç»“åˆçš„...zip ([6..15] $ [10..100])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å·¦è¾¹ç®—å‡ºæ¥æ˜¯ä¸ªList, ä¸æ˜¯<code>$</code>æ¥æ”¶çš„å‡½æ•°, å¦‚ä½•éªŒè¯å‘¢?è¿™æ ·æ”¹</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">t :: [b] -&gt; [(Integer, b)]t &#x3D; zip $ map (+ 5) [1 .. 10]tt :: [(Integer, Integer)]tt &#x3D; t $ map (* 5) [10 .. 20]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®é™…ä¸ŠVSCodeçš„HLintæ’ä»¶å› ä¸ºç»™æˆ‘ä»¬æç¤º</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">However, $ has low, right-associative binding precedence, so it sometimes allows parentheses to be omitted; for example:f $ g $ h x  &#x3D;  f (g (h x))It is also useful in higher-order situations, such as map ($ 0) xs, or Data.List.zipWith ($) fs xs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹åˆ°äº†å§, ä¸èƒ½å°†<code>$</code>äº†ç†è§£ä¸ºè·¯éšœğŸš§,ç®€å•çš„å°†ä»£ç å·¦å³åŠ ä¸Šæ‹¬å·, è€Œæ˜¯ä¸€ä¸ªç½‘ğŸ•¸ï¸,å°†<code>$</code>åé¢çš„éƒ½åŒ…èµ·æ¥</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">f $ g x $ h x --ç†è§£ä¸º--&gt; f (g x) (h x)  ğŸ’©f $ g x $ h x --ç†è§£ä¸º--&gt; f (g x (h x))  ğŸ‘<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><del>æ¯•ç«Ÿ<code>$</code>ğŸ’µä»æ¥ä¸æ˜¯éšœç¢ğŸš§,è€Œæ˜¯é™·é˜±æŠŠä½ åŒ…èµ·æ¥ğŸ•¸ï¸</del></p><p>ğŸ˜²<code>$</code> <strong>è¿˜å¯ä»¥å°†æ•°æ®ä½œä¸ºå‡½æ•°ä½¿ç”¨</strong>ä¾‹å¦‚æ˜ å°„ä¸€ä¸ªå‡½æ•°è°ƒç”¨ç¬¦åˆ°ä¸€ç»„å‡½æ•°ç»„æˆçš„ Listï¼š</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">map ($ 3) [(4+),(10*),(^2),sqrt]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p><code>.</code>è°ƒç”¨(Function composition, å‡½æ•°ç»„åˆ)</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c-- æ³¨æ„, è¿™é‡Œè¦æ±‚å‡½æ•°çš„è¿”å›å€¼ä¸ä¸‹ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ç±»å‹æ˜¯ç›¸åŒçš„f . g &#x3D; \x -&gt; f (g x)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¸æ•°å­¦ä¸­çš„å¤åˆå‡½æ•°ç±»ä¼¼, æˆ‘ä»¬å¯ä»¥è¿™æ ·è¡¨ç¤ºç»„åˆå‡½æ•° <spanclass="math display">\[f(g(x)) = (f \circ g)(x)\]</span>åœ¨Haskellä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†<code>f (g x)</code>(æˆ–è€…<code>f $ g x</code>)è¡¨ç¤ºä¸º<code>f . g x</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">f &#x3D; (+ 1)g &#x3D; (* 10)t1 :: Integer -&gt; Integert1 x &#x3D; f (g x)   -- æœ€ç®€å•çš„å½¢å¼t2 :: Integer -&gt; Integert2 x &#x3D; f $ g x   -- æŠŠæ‹¬å·å¹²æ‰-- t2&#39; :: Integer -&gt; Integer-- t2&#39; &#x3D; f $ g   -- Errort3 :: Integer -&gt; Integert3 &#x3D; f . g<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æˆ‘ä»¬å¹³æ—¶å†™çš„æ˜¯<code>t1</code>çš„å½¢å¼, ä¸ºäº†æ–¹ä¾¿çš„å†™<spanclass="math inline">\(f ( g (x) )\)</span>, æˆ‘ä»¬å¼•å…¥<code>$</code>.å¹¶å®ç°äº†<code>t2</code>å½¢å¼</li><li>æˆ‘ä»¬æƒ³æ¢æˆ<span class="math inline">\((f \circ g)(x)\)</span>å½¢å¼,è¿™æ—¶å°±éœ€è¦<code>.</code>è¿ç®—</li></ul><p>çœ‹èµ·æ¥<code>.</code>, <code>$</code>æ˜¯ç­‰ä»·çš„äº’æ¢å½¢å¼(<code>$</code>,<code>.</code>éƒ½æ˜¯å³ç»“åˆçš„), ä½†æ˜¯ä»–ä»¬çš„ç±»å‹æœ‰å¾ˆå¤§çš„åŒºåˆ«</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">($) :: (a -&gt; b) -&gt; a -&gt; b(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li><code>$</code>æ¥æ”¶<strong>å‡½æ•°ä¸å˜é‡</strong>,è¿”å›ä¸€ä¸ª<strong>å˜é‡</strong></li><li><code>.</code>æ¥æ”¶<strong>ä¸¤ä¸ªå‡½æ•°</strong>,è¿”å›ä¸€ä¸ª<strong>å‡½æ•°</strong></li></ul><p>æ²¡äººè¯´å˜é‡ä¸èƒ½æ˜¯ä¸€ä¸ªå‡½æ•°, å‡½æ•°ä¸èƒ½æ˜¯å˜é‡,ç›´è§‰çœ‹èµ·æ¥<code>$</code>ç”¨äºè¡¨è¾¾å¼<code>.</code>ç”¨äºå‡½æ•°, ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">map (\xs -&gt; negate (sum (tail xs))) [[1..5],[3..6],[1..7]]-- ä¼˜åŒ–ä¸º --&gt;map (negate . sum . tail) [[1..5],[3..6],[1..7]][-14,-15,-27]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹äºå¤šå‚å‡½æ•°, æˆ‘ä»¬å¯ä»¥å€Ÿç”¨<code>()</code>æˆ–<code>$</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">sum (replicate 5 (max 6.7 8.9))(sum . replicate 5 . max 6.7) 8.9sum . replicate 5 . max 6.7 $ 8.9<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ğŸ˜²<code>.</code><strong>å¦ä¸€ç”¨é€”å°±æ˜¯å®šä¹‰point free style</strong></p><ul><li><p>æ„Ÿè°¢æŸ¯é‡ŒåŒ–å‡½æ•°,å½“å‡½æ•°å‚æ•°æŒ‰é¡ºåºä»…ä»…å‡ºç°åœ¨å®ç°çš„å°¾éƒ¨æ—¶å€™æ—¶æˆ‘ä»¬å¯ä»¥å°†å‚æ•°çœç•¥, ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">myFun :: (Ord a) &#x3D;&gt; a -&gt; a -&gt; amyFun x y &#x3D; max x y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç®€åŒ–ä¸º</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">myFun :: (Ord a) &#x3D;&gt; a -&gt; a -&gt; amyFun &#x3D; max<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>å¦‚æœå‚æ•°é¡ºåºå‡ºç°, ä½†æ˜¯å‚æ•°åœ¨æ‹¬å·å†…éƒ¨å‘¢?</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">myFun x y &#x3D; (* 2) (max x y)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½¿ç”¨<code>.</code>å°†ä¸€ä¸ªå‚æ•°ä»æ‹¬å·ä¸­è§£æ”¾å‡ºæ¥</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">myFun x &#x3D; (* 2) . max x<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>.</code>æ˜¯å³ç»“åˆçš„, æ‰€ä»¥æˆ‘ä»¬åªèƒ½è§£æ”¾ä¸€ä¸ªå‚æ•°</p><p>è¿™æ ·çš„çœç•¥å‚æ•°å½¢å¼å°±æ˜¯point free style</p></li></ul></li></ul><h3 id="æ¨¡å—">æ¨¡å—</h3><p>Haskell ä¸­çš„æ¨¡å—æ˜¯å«æœ‰ä¸€ç»„ç›¸å…³çš„å‡½æ•°ï¼Œå‹åˆ«å’Œå‹åˆ«ç±»çš„ç»„åˆã€‚è€Œ Haskellè¿›ç¨‹çš„æœ¬è´¨ä¾¿æ˜¯ä»ä¸»æ¨¡å—ä¸­å¼•ç”¨å…¶å®ƒæ¨¡å—å¹¶è°ƒç”¨å…¶ä¸­çš„å‡½æ•°æ¥æ‰§è¡Œæ“ä½œã€‚å…¶ä¸­ç¼ºçœè‡ªåŠ¨åŠ è½½çš„å‡½æ•°å‡åœ¨<code>Prelude</code>æ¨¡å—ä¸­.Haskellæ¨¡å—åŠ è½½è§„åˆ™ä¸Pythonç±»ä¼¼</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import Data.List             -- åŠ è½½Listæ¨¡å—import Data.List(sort, nub)   -- ä»…åŠ è½½Listæ¨¡å—çš„sort&amp;nubimport Data.List hiding (nub) -- å¼•å…¥é™¤nubå¤–çš„Listæ¨¡å—(ä¸€èˆ¬ç”¨äºåå­—å†²çª)sort [1,2,3]     -- ç›´æ¥è°ƒç”¨å³å¯, æ— éœ€æ¨¡å—åimport qualified Data.Map     -- å¼•å…¥Mapæ¨¡å—, ä½†æ˜¯ä½¿ç”¨éœ€è¦æŒ‡æ˜æ¨¡å—(ç”¨äºåå­—å†²çª)Data.Map.sort [1,2,3]     -- æŒ‡æ˜æ¨¡å—åå¼•å…¥import qualified Data.Map as M -- æŒ‡æ˜ç¼©å†™M.sort [1,2,3]     -- æŒ‡æ˜æ¨¡å—åå¼•å…¥<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨<code>ghci</code>ä¸­å¯ä»¥é‡‡ç”¨<code>:m æ¨¡å— [æ¨¡å—...]</code>çš„æ–¹å¼åŠ è½½</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">:m Data.List Data.Map Data.Set<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="data.listæ¨¡å—"><code>Data.List</code>æ¨¡å—</h4><blockquote><p>æºç è§: <span class="exturl" data-url="aHR0cHM6Ly9oYWNrYWdlLmhhc2tlbGwub3JnL3BhY2thZ2UvYmFzZS00LjE2LjAuMC9kb2NzL3NyYy9EYXRhLUxpc3QuaHRtbA==">List<i class="fa fa-external-link-alt"></i></span><span class="exturl" data-url="aHR0cHM6Ly9oYWNrYWdlLmhhc2tlbGwub3JnL3BhY2thZ2UvYmFzZS00LjE2LjAuMC9kb2NzL3NyYy9EYXRhLU9sZExpc3QuaHRtbA==">OldList<i class="fa fa-external-link-alt"></i></span></p><p>ä¸¤ä¸ªæ¨¡å—å…³ç³»:</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import Data.OldList hiding ( all, and, any, concat, concatMap, elem, find,                             foldl, foldl1, foldl&#39;, foldr, foldr1, mapAccumL,                             mapAccumR, maximum, maximumBy, minimum, minimumBy,                             length, notElem, null, or, product, sum )<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li><p><code>intersperse</code>:</p><p>å°†å…ƒç´ ç½®äº List ä¸­æ¯<strong>å¯¹</strong>å…ƒç´ çš„ä¸­é—´</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">intersperse&#39; :: a -&gt; [a] -&gt; [a]intersperse&#39; _ [] &#x3D; []intersperse&#39; _ [x] &#x3D; [x]intersperse&#39; e (x : xs) &#x3D; x : e : intersperse&#39; e xsintersperse&#39;&#39; :: a -&gt; [a] -&gt; [a]intersperse&#39;&#39; _ [] &#x3D; []intersperse&#39;&#39; e arr &#x3D; init $ foldr (\x aac -&gt; x : e : aac) [] arr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>intercalate</code> å–ä¸¤ä¸ª List ä½œå‚æ•°. å®ƒä¼šå°†ç¬¬ä¸€ä¸ª Listäº¤å‰æ’å…¥ç¬¬äºŒä¸ª List ä¸­é—´ï¼Œå¹¶è¿”å›ä¸€ä¸ª List.</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">intercalate&#39; :: [a] -&gt; [[a]] -&gt; [a]intercalate&#39; _ [] &#x3D; []intercalate&#39; _ [x] &#x3D; xintercalate&#39; item (x : xs) &#x3D; x ++ item ++ intercalate&#39; item xsintercalate&#39;&#39; :: [a] -&gt; [[a]] -&gt; [a]intercalate&#39;&#39; item xs &#x3D; take (length mid - length item) mid  where    mid &#x3D; foldl (\aac x -&gt; aac ++ x ++ item) [] xs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>transpose</code> å‡½æ•°å¯ä»¥åè½¬ä¸€ç»„ List çš„ List. ä½ è‹¥æŠŠä¸€ç»„List çš„ List çœ‹ä½œæ˜¯ä¸ª 2D çš„çŸ©é˜µï¼Œé‚£ <code>transpose</code>çš„æ“ä½œå°±æ˜¯å°†å…¶åˆ—è½¬ä¸ºè¡Œ</p><p>å°è¯•å®ç°ä¸€ä¸‹</p><ul><li><p>æœ€å¼€å§‹æˆ‘æƒ³ä¸åˆ°å¯ä»¥åŒæ—¶æ“ä½œå¤šæ•°ç»„åŒä¸€ä½ç½®çš„æ–¹æ³•,äºæ˜¯å€ŸåŠ©å‘½ä»¤å¼ç¼–ç¨‹çš„æ–¹æ³•æ„šè ¢å®ç°ğŸ™ƒ(ä½¿ç”¨List.Rangeå®ç°å¾ªç¯)</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">transpose :: [[a]] -&gt; [[a]]transpose xss &#x3D; [heads cur xss | cur &lt;- [0 .. (max2D xss - 1)]]  where    max2D xss &#x3D; foldl max 0 (map length xss)    heads cur xss&#39; &#x3D; flat (map (\xs -&gt; if length xs &lt;&#x3D; cur then [] else [xs !! cur]) xss&#39;)      where        flat [] &#x3D; []        flat (x : xs) &#x3D; x ++ flat xs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>åæ¥æƒ³åˆ°</p><p>ğŸ¤”å¦‚æœè¿™æ˜¯Cè¯­è¨€, é‚£ä¹ˆäºŒç»´æ•°ç»„æœ¬è´¨å°±æ˜¯ä¸€ç»´æ•°ç»„ç»„åˆ,æ‰€ä»¥å¯ä»¥å°†ç¬¬äºŒè¡ŒåŒä¸€ä½ç½®çš„å…ƒç´ ç§»åŠ¨åˆ°ä¸Šä¸€è¡ŒåŒä½ç½®å³è¾¹å®ç°</p><p>ä½†æ˜¯åœ¨Haskellä¸­æ²¡æœ‰æŒ‡é’ˆè¿™ä¹ˆåº•å±‚çš„ä¸œè¥¿æŠŠçº¿æ€§ç»“æ„åˆ†ä¸ºäºŒç»´æ•°ç»„,ä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨åˆ†ç•Œ</p><p>ğŸ˜<code>transpose'</code>å®ç°åŸç†å¤§æ¦‚æ˜¯</p><ol type="1"><li><p>å°†æ•°ç»„è½¬ä¸º3D</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">[    [1,2,3],    [4,5,6],    [7,8,9]]--&gt;[    [[1],[2],[3]],    [[4],[5],[6]],    [[7],[8],[9]]]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>ä¸¤ä¸¤åˆå¹¶</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">[    [[1],[2],[3]],    [[4],[5],[6]],    [[7],[8],[9]]]--&gt;[    [[1,4],[2,5],[3,6]],    [[7],[8],[9]]]--&gt;[    [[1,4,7],[2,5,8],[3,6,9]],]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p><code>transpose'''</code>å°±æ˜¯å°†ä¸åŒé•¿åº¦æ•°ç»„éƒ½<code>repeat</code>åˆ°ç­‰é•¿</p></li></ol><p>äºæ˜¯å¾—åˆ°</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">-- æ™®é€šæ¬¾ğŸ‘‡----- åˆå¹¶ä¸¤è¡Œ [7,8,9]-&gt;[[1,4],[2,5],[3,6]]-&gt;[[1,4,7],[2,5,8],[3,6,9]]mergeRow :: [[a]] -&gt; [[a]] -&gt; [[a]]mergeRow &#x3D; zipWith (++)----- å°†ä¸€ä¸ªä¸€ç»´æ•°ç»„è½¬åŒ–ä¸ºäºŒä½ [1,2,3] -&gt; [[1],[2],[3]]form2D :: [a] -&gt; [[a]]form2D &#x3D; map (: [])transpose&#39; :: [[a]] -&gt; [[a]]transpose&#39; &#x3D; foldl1 mergeRow . stakedForm  where    stakedForm &#x3D; map form2D-- å‹è¡Œæ¬¾ğŸ‘‡ğŸ˜transpose&#39;&#39; :: [[a]] -&gt; [[a]]transpose&#39;&#39; &#x3D; foldl1 (zipWith (++)) . map (map (: []))-- è§£å†³å¯¹ä¸é½ğŸ‘‡transpose&#39;&#39;&#39; :: [[a]] -&gt; [[a]]transpose&#39;&#39;&#39; &#x3D; foldl1 mergeRow&#39; . stakedForm  where    stakedForm &#x3D; map $ map (: [])    mergeRow&#39; xs1 xs2 &#x3D; takeWhile (not . null) . zipWith (++) (infForm xs1) $ infForm xs2      where        infForm &#x3D; (++ repeat [])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>ğŸ˜’ä½†æ˜¯ä¸å¤Ÿå‡½æ•°åŒ–,æˆ‘ä»¬ç›¸å½“äºå‘Šè¯‰Haskellæ‰§è¡Œçš„æ–¹å¼å°±æ˜¯æŠŠä¸¤ä¸ªListè¿èµ·æ¥,ç»§ç»­è¿›è¡Œä¸€ä¸‹ä¼˜åŒ–</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">transpose&#39;&#39;&#39;&#39; :: [[a]] -&gt; [[a]]transpose&#39;&#39;&#39;&#39; xs  where    zipWith&#39; _ [] yys &#x3D; yys    zipWith&#39; _ xxs [] &#x3D; [[xx] | xx &lt;- xxs]    zipWith&#39; f (xx : xxs) (yy : yys) &#x3D; f xx yy : zipWith&#39; f xxs yystranspose&#39;&#39;&#39;&#39; [] &#x3D; []<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul></li><li><p><code>concat</code>å°†Listè¿èµ·æ¥(å»é™¤ä¸€å±‚åµŒå¥—)</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">concat&#39; :: [[a]] -&gt; [a]concat&#39; &#x3D; foldl1 (++)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>concatMap</code>å°†Listè½¬æ¢ä¸ºäºŒç»´Listå†<code>concat</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">concatMap&#39; :: [a -&gt; [b]] -&gt; [a] -&gt; [b]concatMap&#39; f &#x3D; concat . (map f)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>and</code>å–ä¸€ç»„å¸ƒå°”å€¼<code>List</code>ä½œå‚æ•°.åªæœ‰å…¶ä¸­çš„å€¼å…¨ä¸º<code>True</code>çš„æƒ…å†µä¸‹æ‰ä¼šè¿”å›<code>True</code>.</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">and&#39; :: [Bool] -&gt; Booland&#39; &#x3D; foldl1 (&amp;&amp;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>or</code>ä¸€ç»„å¸ƒå°”å€¼<code>List</code>ä¸­è‹¥å­˜åœ¨ä¸€ä¸ª<code>True</code>å®ƒå°±è¿”å›<code>True</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">or&#39; :: [Bool] -&gt; Boolor&#39; &#x3D; foldl1 (||)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>any</code>ä¸<code>all</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">any&#39; :: [a -&gt; Bool] -&gt; [a]any&#39; f &#x3D; or . (map f)all&#39; :: [a -&gt; Bool] -&gt; [a]all&#39; f &#x3D; and . (map f)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>iterate</code>: å–ä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªå€¼ä½œå‚æ•°.å®ƒä¼šç”¨è¯¥å€¼å»è°ƒç”¨è¯¥å‡½æ•°å¹¶ç”¨æ‰€å¾—çš„ç»“æœå†æ¬¡è°ƒç”¨è¯¥å‡½æ•°ï¼Œäº§ç”Ÿä¸€ä¸ªæ— é™çš„List.</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">iterate&#39; :: (a -&gt; a) -&gt; a -&gt; [a]iterate&#39; f x &#x3D; x : iterate&#39; f (f x)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>splitAt</code>å–ä¸€ä¸ª List å’Œæ•°å€¼ä½œå‚æ•°ï¼Œå°†è¯¥ Liståœ¨ç‰¹å®šçš„ä½ç½®æ–­å¼€ã€‚è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ª List çš„äºŒå…ƒç»„.</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">splitAt&#39; :: Int -&gt; [b] -&gt; ([b], [b])splitAt&#39; n xs &#x3D; (lefts xs, rights)  where    len &#x3D; max 0 $ min (length xs) n    lefts &#x3D; take len    rights &#x3D; reverse . take (length xs - len) $ reverse xs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">let (a,b) &#x3D; splitAt 3 &quot;foobar&quot; in b ++ a-- &quot;barfoo&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>takeWhile</code>ä»ä¸€ä¸ª Listä¸­å–å…ƒç´ ï¼Œä¸€æ—¦é‡åˆ°ä¸ç¬¦åˆæ¡ä»¶çš„æŸå…ƒç´ å°±åœæ­¢.</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">takeWhile&#39; :: (a -&gt; Bool) -&gt; [a] -&gt; [a]takeWhile&#39; f (x : xs)  | f x &#x3D; x : takeWhile&#39; f xs  | otherwise &#x3D; []takeWhile&#39; _ [] &#x3D; []<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>dropWhile</code>ä¸<code>takeWhile</code>ç›¸ä¼¼ï¼Œä¸è¿‡æ˜¯æ‰”æ‰ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ã€‚ä¸€æ—¦é™åˆ¶æ¡ä»¶è¿”å›<code>False</code>ï¼Œå®ƒå°±è¿”å› List çš„ä½™ä¸‹éƒ¨åˆ†.</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">dropWhile&#39; :: (a -&gt; Bool) -&gt; [a] -&gt; [a]dropWhile&#39; f (x : xs)  | f x &#x3D; dropWhile&#39; f xs  | otherwise &#x3D; xsdropWhile&#39; _ [] &#x3D; []<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>span</code>ä¸<code>break</code>è¿”å›é¦–æ¬¡å¤±è´¥/æˆåŠŸå·¦å³æ•°æ®</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">span&#39; :: (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])span&#39; f xs &#x3D; (takeWhile f xs, dropWhile f xs)break&#39; :: (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])break&#39; f &#x3D; span (not . f)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>sort</code>æ’åºä¸€ä¸ª<code>List</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">sort&#39; :: (Ord a)&#x3D;&gt;[a] -&gt; [a]sort&#39; (tar:xs) &#x3D; lowers ++ [tar] ++ uppers  where lowers &#x3D; sort&#39; [x|x&lt;-xs, x&lt;&#x3D;tar]        uppers &#x3D; sort&#39; [x|x&lt;-xs, x&gt;tar]sort&#39; [] &#x3D; []<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>group</code>å–ä¸€ä¸ª Listä½œå‚æ•°ï¼Œå¹¶å°†å…¶ä¸­ç›¸é‚»å¹¶ç›¸ç­‰çš„å…ƒç´ å„è‡ªå½’ç±»ï¼Œç»„æˆä¸€ä¸ªä¸ªå­ List.</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">group&#39; :: Eq a &#x3D;&gt; [a] -&gt; [[a]]group&#39; (x : xs)  | null res &#x3D; [[x]]  | x &#x3D;&#x3D; head headx &#x3D; (x : headx) : tail res  | otherwise &#x3D; [x] : res  where    res &#x3D; group&#39; xs    headx &#x3D; head resgroup&#39; [] &#x3D; []-- çœ‹ä¸‹æºç çš„å®ç°æ¨¡å¼group&#39; :: Eq a &#x3D;&gt; [a] -&gt; [[a]]group&#39; [] &#x3D; []group&#39; (x : xs) &#x3D; (x : ys) : group&#39; zs  where    (ys, zs) &#x3D; span (&#x3D;&#x3D; x) xs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»Ÿè®¡å…ƒç´ å‡ºç°æ¬¡æ•°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; map (\l@(x:xs) -&gt; (x,length l)) . group . sort $ [1,1,1,1,2,2,2,2,3,3,2,2,2,5,6,7]-- [(1,4),(2,7),(3,2),(5,1),(6,1),(7,1)]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>inits</code> å’Œ <code>tails</code> ä¸ <code>init</code> å’Œ<code>tail</code> ç›¸ä¼¼ï¼Œåªæ˜¯å®ƒä»¬ä¼šé€’å½’åœ°è°ƒç”¨è‡ªèº«ç›´åˆ°ä»€ä¹ˆéƒ½ä¸å‰©</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">inits&#39; :: [a] -&gt; [[a]]inits&#39; xs &#x3D; scanr (\_ acc -&gt; init acc) xs xstails&#39; :: [a] -&gt; [[a]]tails&#39; xs &#x3D; scanl (\acc _ -&gt; tail acc) xs xs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>isInfixOf</code>æ•°ç»„æ¨¡å¼åŒ¹é…</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import Data.List (tails)isInfixOf&#39; :: Eq a &#x3D;&gt; [a] -&gt; [a] -&gt; BoolisInfixOf&#39; needle haystack &#x3D; foldl (\acc x -&gt; acc || take len x &#x3D;&#x3D; needle) False $ tails haystack  where    len &#x3D; length needle<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>isPrefixOf</code>ä¸<code>isSuffixOf</code>åˆ†åˆ«æ£€æŸ¥ä¸€ä¸ª Listæ˜¯å¦ä»¥æŸå­ List å¼€å¤´æˆ–è€…ç»“å°¾.</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">isPrefixOf&#39; :: (Eq a) &#x3D;&gt; [a] -&gt; [a] -&gt; BoolisPrefixOf&#39; needle haystack &#x3D; needle &#x3D;&#x3D; take len haystack  where    len &#x3D; length needleisSuffixOf&#39; :: (Eq a) &#x3D;&gt; [a] -&gt; [a] -&gt; BoolisSuffixOf&#39; needle haystack &#x3D; reverse needle &#x3D;&#x3D; take len (reverse haystack)  where    len &#x3D; length needle<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>elem</code>ä¸<code>notElem</code>æ£€æŸ¥ä¸€ä¸ª Listæ˜¯å¦åŒ…å«æŸå…ƒç´ .</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">elem&#39; :: Eq a &#x3D;&gt; a -&gt; [a] -&gt; Boolelem&#39; v &#x3D; foldl (\acc x -&gt; acc || x &#x3D;&#x3D; v) FalsenotElem&#39; :: Eq a &#x3D;&gt; a -&gt; [a] -&gt; BoolnotElem&#39; v xs &#x3D; not (elem&#39; v xs)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>partition</code> å–ä¸€ä¸ªé™åˆ¶æ¡ä»¶å’Œ List ä½œå‚æ•°ï¼Œè¿”å›ä¸¤ä¸ªListï¼Œç¬¬ä¸€ä¸ª List ä¸­åŒ…å«æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œè€Œç¬¬äºŒä¸ª Listä¸­åŒ…å«ä½™ä¸‹çš„.</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">partition&#39; :: (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])partition&#39; p &#x3D; foldr (select&#39; p) ([], [])select&#39; :: (a -&gt; Bool) -&gt; a -&gt; ([a], [a]) -&gt; ([a], [a])select&#39; p x (ts, fs)  | p x &#x3D; (x : ts, fs)  | otherwise &#x3D; (ts, x : fs)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>partition</code>ä¸<code>span</code> å’Œ <code>break</code> ä¸åŒ,<code>span</code> å’Œ <code>break</code>ä¼šåœ¨é‡åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆæˆ–ä¸ç¬¦åˆæ¡ä»¶çš„å…ƒç´ å¤„æ–­å¼€ï¼Œè€Œ <code>partition</code>åˆ™ä¼šéå†æ•´ä¸ª List</p></li><li><p><code>find</code> å–ä¸€ä¸ª Listå’Œé™åˆ¶æ¡ä»¶ä½œå‚æ•°ï¼Œå¹¶è¿”å›é¦–ä¸ªç¬¦åˆè¯¥æ¡ä»¶çš„å…ƒç´ ï¼Œè€Œè¿™ä¸ªå…ƒç´ æ˜¯ä¸ª<code>Maybe</code> å€¼ï¼Œ<code>Maybe</code> å€¼æ˜¯<code>Just something</code> æˆ– <code>Nothing</code>ã€‚ä¸ä¸€ä¸ª Listå¯ä»¥ä¸ºç©ºä¹Ÿå¯ä»¥åŒ…å«å¤šä¸ªå…ƒç´ ç›¸ä¼¼ï¼Œä¸€ä¸ª <code>Maybe</code>å¯ä»¥ä¸ºç©ºï¼Œä¹Ÿå¯ä»¥æ˜¯å•ä¸€å…ƒç´ ã€‚åŒæ ·ä¸ List ç±»ä¼¼ï¼Œä¸€ä¸ª Int å‹çš„ Listå¯ä»¥å†™ä½œ <code>[Int]</code>ï¼Œ<code>Maybe</code>æœ‰ä¸ª Int å‹å¯ä»¥å†™ä½œ<code>Maybe Int</code>ã€‚å…ˆè¯•ä¸€ä¸‹ <code>find</code> å‡½æ•°å†è¯´.</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">find (&gt;4) [1,2,3,4,5,6]-- Just 5find (&gt;9) [1,2,3,4,5,6]-- Nothing:t find-- find :: (a -&gt; Bool) -&gt; [a] -&gt; Maybe a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>elemIndex</code> ä¸ <code>elem</code>ç›¸ä¼¼ï¼Œåªæ˜¯å®ƒè¿”å›çš„ä¸æ˜¯å¸ƒå°”å€¼ï¼Œå®ƒåªæ˜¯'å¯èƒ½'(Maybe)è¿”å›æˆ‘ä»¬æ‰¾çš„å…ƒç´ çš„ç´¢å¼•ï¼Œè‹¥è¿™ä¸€å…ƒç´ ä¸å­˜åœ¨ï¼Œå°±è¿”å›<code>Nothing</code>ã€‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">:t elemIndexelemIndex :: (Eq a) &#x3D;&gt; a -&gt; [a] -&gt; Maybe Int4 &#96;elemIndex&#96; [1,2,3,4,5,6]-- Just 310 &#96;elemIndex&#96; [1,2,3,4,5,6]-- Nothing<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>elemIndices</code>ä¸ <code>elemIndex</code>ç›¸ä¼¼ï¼Œåªä¸è¿‡å®ƒè¿”å›çš„æ˜¯æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„<code>List</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">elemIndices&#39; :: (Eq a) &#x3D;&gt; a -&gt; [a] -&gt; [Integer]elemIndices&#39; target xs &#x3D; [cur| (x, cur) &lt;- zip xs [0..], x &#x3D;&#x3D; target]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>findIndex</code>ä¸<code>elemIndices</code>ç±»ä¼¼,ä½†ä¹‹è¿”å›ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„ç´¢å¼•çš„Maybe</p></li><li><p><code>zip*</code>,<code>zipWith*</code>æ”¯æŒå¤šæ•°ç»„<code>zip</code>(æœ€å¤§åˆ°<code>zip7</code>)</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">zip4 [2,3,3] [2,2,2] [5,5,3] [2,2,2]-- [(2,2,5,2),(3,2,5,2),(3,2,3,2)]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>lines</code>æ ¹æ®æ¢è¡Œç¬¦<code>split</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">lines&#39; :: String -&gt; [String]lines&#39; xs  | null snds &#x3D; [fsts]  | otherwise &#x3D; fsts : lines&#39; (tail snds)  where    (fsts, snds) &#x3D; span (&#x2F;&#x3D; &#39;\n&#39;) xs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>unlines</code>æ˜¯ <code>lines</code>çš„åå‡½æ•°ï¼Œå®ƒå–ä¸€ç»„å­—ä¸²çš„ <code>List</code>ï¼Œå¹¶å°†å…¶é€šè¿‡<code>'\n'</code>åˆå¹¶åˆ°ä¸€å—.</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">unlines&#39; :: [String] -&gt; Stringunlines&#39; &#x3D; foldl (\acc x -&gt; acc ++ x ++ [&#39;\n&#39;]) &quot;&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>words</code>å’Œ<code>unwords</code>å¯ä»¥æŠŠä¸€ä¸ªå­—ä¸²åˆ†ä¸ºä¸€ç»„å•è¯æˆ–æ‰§è¡Œç›¸åçš„æ“ä½œ</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">words &quot;hey these are the words in this\nsentence&quot;-- [&quot;hey&quot;,&quot;these&quot;,&quot;are&quot;,&quot;the&quot;,&quot;words&quot;,&quot;in&quot;,&quot;this&quot;,&quot;sentence&quot;]unwords [&quot;hey&quot;,&quot;there&quot;,&quot;mate&quot;]-- &quot;hey there mate&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­é—´éš”ç¬¦åˆ¤æ–­é‡‡ç”¨<code>Data.Char.isSpace</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">isSpace c  | uc &lt;&#x3D; 0x377 &#x3D; uc &#x3D;&#x3D; 32 || uc - 0x9 &lt;&#x3D; 4 || uc &#x3D;&#x3D; 0xa0  | otherwise &#x3D; iswspace (ord c) &#x2F;&#x3D; 0  where    uc &#x3D; fromIntegral (ord c) :: Word<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å³å…¨éƒ¨Unicodeç©ºæ ¼ä¸ <code>\t</code>, <code>\n</code>,<code>\r</code>, <code>\f</code>, <code>\v</code></p></li><li><p><code>delete</code>å–ä¸€ä¸ªå…ƒç´ å’Œ List ä½œå‚æ•°ï¼Œä¼šåˆ æ‰è¯¥ Listä¸­é¦–æ¬¡å‡ºç°çš„è¿™ä¸€å…ƒç´ .</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">delete &#39;h&#39; &quot;hey there ghang!&quot;-- &quot;ey there ghang!&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>\</code>ç±»ä¼¼æŸ¥é›†, åœ¨æ’å…¥æ—¶æ£€æŸ¥å…ƒç´ æ˜¯å¦å·²ç»å­˜åœ¨,âš ä½†ä¸å»é‡å·¦æ“ä½œæ•°, ä¸å»é‡å³æ“ä½œæ•°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; [1,2,2,3] \\ [2,2,3,3,4]-- [1]ghci&gt; [1,2,2,3] \\ [2,3,3,4]-- [1,2]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>union</code>ç±»ä¼¼å¹¶é›†, åœ¨æ’å…¥æ—¶æ£€æŸ¥å…ƒç´ æ˜¯å¦å·²ç»å­˜åœ¨,âš ä¸å»é‡å·¦æ“ä½œæ•°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">[1,2,3,3] &#96;union&#96; [2,2,5,9]-- [1,2,3,3,5,9]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>intersect</code>ç±»ä¼¼äº¤é›†, åœ¨æ’å…¥æ—¶æ£€æŸ¥å…ƒç´ æ˜¯å¦å·²ç»å­˜åœ¨,âš ä¸å»é‡å·¦æ“ä½œæ•°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">intersect [1,2,2,3] [2,2,2,3,3,4]-- [2,2,3]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>insert</code>å¯ä»¥å°†ä¸€ä¸ªå…ƒç´ æ’å…¥ä¸€ä¸ª<strong>å¯æ’åº(è€Œä¸æ˜¯å·²æ’åº)</strong>çš„<code>List</code>,å¹¶å°†å…¶ç½®äºé¦–ä¸ªå¤§äºç­‰äºå®ƒçš„å…ƒç´ ä¹‹å‰ï¼Œå¦‚æœä½¿ç”¨ <code>insert</code>æ¥ç»™ä¸€ä¸ªæ’è¿‡åºçš„ List æ’å…¥å…ƒç´ ï¼Œè¿”å›çš„ç»“æœä¾ç„¶æ˜¯æ’åºçš„.</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">insert 4 [1,2,3,5,6,7]--[1,2,3,4,5,6,7]insert &#39;g&#39; $ [&#39;a&#39;..&#39;f&#39;] ++ [&#39;h&#39;..&#39;z&#39;]-- &quot;abcdefghijklmnopqrstuvwxyz&quot;insert 3 [1,2,4,3,2,1]-- [1,2,3,4,3,2,1]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>length</code>,<code>take</code>,<code>drop</code>,<code>splitAt</code>,<code>!!</code>,<code>replicate</code>éƒ½æœ‰ä¸€ä¸ª<code>generic*</code>ç‰ˆæœ¬,åŒºåˆ«å°±æ˜¯å°†ç±»å‹å‚æ•°ä¸­çš„<code>Int</code>æ›¿æ¢ä¸º<code>Num</code>, ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">:t genericLength-- genericLength :: Num i &#x3D;&gt; [a] -&gt; i:t length-- length :: Foldable t &#x3D;&gt; t a -&gt; Int<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>nub</code>, <code>delete</code>, <code>union</code>,<code>intsect</code> , <code>group</code> éƒ½æœ‰<code>*By</code>ç‰ˆæœ¬,å®ƒä»¬çš„åŒºåˆ«å°±æ˜¯å‰ä¸€ç»„å‡½æ•°ä½¿ç”¨ <code>(==)</code> æ¥æµ‹è¯•æ˜¯å¦ç›¸ç­‰ï¼Œè€Œå¸¦<code>By</code> çš„é‚£ç»„åˆ™å–ä¸€ä¸ªå‡½æ•°ä½œå‚æ•°æ¥åˆ¤å®šç›¸ç­‰æ€§ï¼Œ<code>group</code>å°±ä¸ <code>groupBy (==)</code> ç­‰ä»·</p><p>ä¾‹å¦‚å°†ç›¸é‚»ä¸”åŒå·å…ƒç´ æ”¾ä¸€èµ·</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">let values &#x3D; [-4.3,-2.4,-1.2,0.4,2.3,5.9,10.5,29.1,5.3,-2.4,-14.5,2.9,2.3]groupBy (\x y -&gt; (x &gt; 0) &#x3D;&#x3D; (y &gt; 0)) values-- [[-4.3,-2.4,-1.2],[0.4,2.3,5.9,10.5,29.1,5.3],[-2.4,-14.5],[2.9,2.3]]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p><code>on</code>å‡½æ•°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">on :: (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; cf &#96;on&#96; g &#x3D; \x y -&gt; f (g x) (g y)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¾‹å¦‚ä¸Šé¢åŠŸèƒ½å¯ä»¥äº›ä¸º</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">groupBy ((&#x3D;&#x3D;) &#96;on&#96; (&gt; 0)) values-- [[-4.3,-2.4,-1.2],[0.4,2.3,5.9,10.5,29.1,5.3],[-2.4,-14.5],[2.9,2.3]]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>sort</code>ï¼Œ<code>insert</code>ï¼Œ<code>maximum</code>,<code>min</code>éƒ½æœ‰<code>*By</code>,åˆ¤åˆ«å‡½æ•°è¿”å›<code>Ordering</code>ç±»å‹(<code>LT</code>,<code>EQ</code>,<code>GT</code>)</p><p>ä¾‹å¦‚æŒ‰ç…§<code>List</code>é•¿åº¦å°†äºŒç»´<code>List</code>æ’åº</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">xs &#x3D; [[5,4,5,4,4],[1,2,3],[3,5,4,3],[],[2],[2,2]]sortBy (compare &#96;on&#96; length) xs-- [[],[2],[2,2],[1,2,3],[3,5,4,3],[5,4,5,4,4]]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="data.charæ¨¡å—"><code>Data.Char</code>æ¨¡å—</h4><ul><li><p>èŒƒå›´åˆ¤æ–­å‡½æ•°</p><ul><li><code>isControl</code>: æ˜¯å¦æ˜¯æ§åˆ¶å­—</li><li><code>isSpace</code>: æ˜¯å¦æ˜¯ç©ºæ ¼</li><li><code>isUper</code>: æ˜¯å¦ä¸ºå¤§å†™</li><li><code>isAlpha</code>: æ˜¯å¦ä¸ºå­—æ¯</li><li><code>isAlphaNum</code>: æ˜¯å¦ä¸ºå­—æ¯æˆ–æ•°å­—</li><li><code>isPrint</code>: æ˜¯å¦æ˜¯å¯æ‰“å°çš„</li><li><code>isDigit</code>: æ˜¯å¦ä¸ºæ•°å­—.</li><li><code>isOctDigit</code>: æ˜¯å¦ä¸ºå…«è¿›åˆ¶æ•°å­—</li><li><code>isHexDigit</code>: æ˜¯å¦ä¸ºåå…­è¿›åˆ¶æ•°å­—</li><li><code>isLetter</code>: æ˜¯å¦ä¸ºå­—æ¯</li><li><code>isMark</code>: æ˜¯å¦ä¸º<code>unicode</code>æ³¨éŸ³å­—ç¬¦(å¦‚:<code>Ã©</code>).</li><li><code>isNumber</code>: æ˜¯å¦ä¸ºæ•°å­—</li><li><code>isPunctuation</code>:æ˜¯å¦ä¸ºæ ‡ç‚¹ç¬¦å·</li><li><code>isSymbol</code>: æ˜¯å¦ä¸ºè´§å¸ç¬¦å·</li><li><code>isSeperater</code>:æ˜¯å¦ä¸º<code>unicode</code>ç©ºæ ¼æˆ–åˆ†éš”ç¬¦.</li><li><code>isAscii</code>: æ˜¯å¦åœ¨<code>unicode</code>å­—æ¯è¡¨çš„å‰ 128ä½</li><li><code>isLatin1</code>: æ˜¯å¦åœ¨<code>unicode</code>å­—æ¯è¡¨çš„å‰ 256ä½.</li><li><code>isAsciiUpper</code>: æ˜¯å¦ä¸ºå¤§å†™çš„ ascii å­—ç¬¦</li><li><code>isAsciiLower</code>: æ˜¯å¦ä¸ºå°å†™çš„ ascii å­—ç¬¦</li></ul><p>å®ç°<code>words</code>å‡½æ•°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">words xs&#x3D; filter (not . any isSpace) . groupBy ((&#x3D;&#x3D;) &#96;on&#96; isSpace) $ xs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p><code>generalCategory</code>è·å–å­—ç¬¦å±äºå“ªä¸ªåˆ†ç±»,å‡½æ•°ç±»å‹ä¸º<code>generalCategory :: Char -&gt; GeneralCategory</code>,è¿™é‡Œçš„<code>GeneralCategory</code>ä¸<code>Ordering</code>ç±»ä¼¼,ä¸ºæšä¸¾ç±»å‹</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; generalCategory &#39; &#39;Spaceghci&gt; generalCategory &#39;A&#39;UppercaseLetterghci&gt; generalCategory &#39;a&#39;LowercaseLetterghci&gt; generalCategory &#39;.&#39;OtherPunctuationghci&gt; generalCategory &#39;9&#39;DecimalNumberghci&gt; map generalCategory &quot; \t\nA9?|&quot;[Space,Control,Control,UppercaseLetter,DecimalNumber,OtherPunctuation,MathSymbol]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>è½¬æ¢å‡½æ•°</p><ul><li><code>toUpper</code>: å°†ä¸€ä¸ªå­—ç¬¦è½¬ä¸ºå¤§å†™å­—æ¯</li><li><code>toLower</code>: å°†ä¸€ä¸ªå­—ç¬¦è½¬ä¸ºå°å†™å­—æ¯</li><li><code>toTitle</code>:å°†ä¸€ä¸ªå­—ç¬¦è½¬ä¸º<code>title-case</code>ï¼Œå¯¹å¤§å¤šæ•°å­—å…ƒè€Œè¨€ï¼Œ<code>title-case</code>å°±æ˜¯å¤§å†™.</li><li><code>digitToInt</code>:å°†ä¸€ä¸ª<strong>å­—ç¬¦(ä¸æ”¯æŒå­—ç¬¦ä¸²)</strong>è½¬ä¸º<code>Int</code>å€¼ï¼Œè€Œè¿™ä¸€å­—ç¬¦å¿…é¡»å¾—åœ¨<code>'1'..'9','a'..'f'</code>æˆ–<code>'A'..'F'</code>çš„èŒƒå›´ä¹‹å†…(ç›¸å½“äºè½¬æ¢ä¸º16è¿›åˆ¶, ä½†å› ä¸ºæ˜¯ç»™å­—ç¬¦è½¬æ¢, æ‰€ä»¥æ²¡ä»€ä¹ˆé—®é¢˜)</li><li><code>intToDigit</code>æ˜¯<code>digitToInt</code>çš„åå‡½æ•°, å–ä¸€ä¸ª<code>0</code> åˆ° <code>15</code> çš„ <code>Int</code>å€¼ä½œå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå°å†™çš„å­—ç¬¦.</li><li><code>ord</code>ä¸<code>char</code>å‡½æ•°å¯ä»¥å°†å­—ç¬¦ä¸å…¶å¯¹åº”çš„æ•°å­—ç›¸äº’è½¬æ¢.</li></ul></li></ul><h4 id="data.mapæ¨¡å—"><code>Data.Map</code>æ¨¡å—</h4><p>é€šè¿‡æ ‘å®ç°çš„Map. ç”±äºMapä¸­å‡½æ•°ä¸å…¶ä»–å‡½æ•°å†²çªè¾ƒå¤š,æœ€å¥½é‡‡ç”¨<code>qualified import</code></p><ul><li><p><code>fromList</code>: <code>List</code>è½¬<code>Map</code>,Listä¸ºK-VäºŒå…ƒç»„, Keyç›¸åŒä¼šè¦†ç›–</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">Map.fromList :: (Ord k) &#x3D;&gt; [(k,v)] -&gt; Map.Map k vMap.fromList [(&quot;betty&quot;,&quot;555-2938&quot;),(&quot;bonnie&quot;,&quot;452-2928&quot;),(&quot;lucille&quot;,&quot;205-2928&quot;),(&quot;lucille&quot;,&quot;205-000&quot;)]-- fromList [(&quot;betty&quot;,&quot;555-2938&quot;),(&quot;bonnie&quot;,&quot;452-2928&quot;),(&quot;lucille&quot;,&quot;205-000&quot;)]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>fromListWith</code>ç”¨æ¥è§£å†³é‡å¤Kçš„é—®é¢˜</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import qualified Data.Map as Mres &#x3D; M.fromListWith (\v1 v2 -&gt; v1 ++ &quot;, &quot; ++ v2) [(&quot;betty&quot;, &quot;555-2938&quot;), (&quot;bonnie&quot;, &quot;452-2928&quot;), (&quot;lucille&quot;, &quot;205-2928&quot;), (&quot;lucille&quot;, &quot;205-000&quot;)]-- fromList [(&quot;betty&quot;,&quot;555-2938&quot;),(&quot;bonnie&quot;,&quot;452-2928&quot;),(&quot;lucille&quot;,&quot;205-000, 205-2928&quot;)]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>empty</code>è¿”å›ç©º<code>Map</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">empty-- fromList []<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>insert K V</code>æ’å…¥</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">Map.insert 3 100 Map.empty-- fromList [(3,100)]Map.insert 5 600 (Map.insert 4 200 ( Map.insert 3 100  Map.empty))-- fromList [(3,100),(4,200),(5,600)]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>insertWith</code>ç”¨äºå¤„ç†é‡å¤K</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import qualified Data.Map as Mres &#x3D; M.insertWith (+) 3 100 $ M.fromList [(3, 4), (5, 103), (6, 339)]-- fromList [(3,104),(5,103),(6,339)]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>null</code>åˆ¤ç©ºMap</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">Data.Map.null empty-- True<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>size</code>è¿”å›Mapå¤§å°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">Data.Map.size $ Data.Map.fromList [(2,4),(3,3),(4,2),(5,4),(6,4)]-- 5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>singleton K V</code>è¿”å›ä¸€ä¸ªK-Vçš„Map</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">Map.singleton 3 9-- fromList [(3,9)]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>lookup K</code>è¿”å›<code>Maybe V</code>/<code>Nothing</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import qualified Data.Map as Mt &#x3D; M.fromList [(&quot;betty&quot;, &quot;555-2938&quot;), (&quot;bonnie&quot;, &quot;452-2928&quot;), (&quot;lucille&quot;, &quot;205-2928&quot;), (&quot;lucille&quot;, &quot;205-000&quot;)]res &#x3D; M.lookup &quot;bonnie&quot; t-- Just &quot;452-2928&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>member K map</code>åˆ¤æ–­Ke yæ˜¯å¦å­˜åœ¨</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import qualified Data.Map as Mt &#x3D; M.fromList [(&quot;betty&quot;, &quot;555-2938&quot;), (&quot;bonnie&quot;, &quot;452-2928&quot;), (&quot;lucille&quot;, &quot;205-2928&quot;), (&quot;lucille&quot;, &quot;205-000&quot;)]res &#x3D; M.member &quot;bonnie&quot; t<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>map</code>, <code>filter</code>åŒ<code>List</code></p></li><li><p><code>toList</code> æ˜¯ <code>fromList</code> çš„åå‡½æ•°ã€‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">Map.toList . Map.insert 9 2 $ Map.singleton 4 3-- [(4,3),(9,2)]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>keys</code>/<code>elems</code>è¿”å›<code>K/V</code>ç»„æˆçš„<code>List</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import qualified Data.Map as Mt &#x3D; M.fromList [(&quot;betty&quot;, &quot;555-2938&quot;), (&quot;bonnie&quot;, &quot;452-2928&quot;), (&quot;lucille&quot;, &quot;205-2928&quot;), (&quot;lucille&quot;, &quot;205-000&quot;)]res &#x3D; M.elems t-- [&quot;555-2938&quot;,&quot;452-2928&quot;,&quot;205-000&quot;]res&#39; &#x3D; M.keys t-- [&quot;betty&quot;,&quot;bonnie&quot;,&quot;lucille&quot;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="data.set-æ¨¡å—"><code>Data.Set</code> æ¨¡å—</h4><p>ä½¿ç”¨æ ‘å®ç°çš„é›†åˆ, å»ºè®®ä½¿ç”¨<code>qualified import</code>å¼•å…¥</p><ul><li><p><code>fromList</code>, <code>List</code>è½¬<code>Set</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import qualified Data.Set as Sa &#x3D; S.fromList [1,2,3,4,3,2,1]-- fromList [1,2,3,4]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>intersection</code>äº¤é›†, <code>difference</code>å·®é›†</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import qualified Data.Set as Sa &#x3D; S.fromList [1, 2, 3, 4, 3, 2, 1]b &#x3D; S.fromList [1, 2, 2, 1]S.intersection a b-- fromList [1,2]S.difference a b-- fromList [3,4]S.union a b-- fromList [1,2,3,4]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>null</code>, <code>size</code>, <code>member</code>,<code>empty</code>, <code>singleton</code>, <code>insert</code>,<code>delete</code>ä¸Listç±»ä¼¼</p></li><li><p><code>isSubsetOf</code>,<code>isProperSubsetOf</code>åˆ¤æ–­æ˜¯ä¸æ˜¯å­é›†ä¸çœŸå­é›†</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import qualified Data.Set as Sa &#x3D; S.fromList [1, 2, 3, 4, 3, 2, 1]b &#x3D; S.fromList [1, 2, 2, 1]c &#x3D; S.fromList [1, 2]b &#96;S.isSubsetOf&#96; a-- Truec &#96;S.isProperSubsetOf&#96; b-- False<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ”¯æŒ<code>Map</code>, <code>Filter</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import qualified Data.Set as SS.filter odd $ S.fromList [3, 4, 5, 6, 7, 2, 3, 4]-- fromList [3,5,7]S.map (+ 1) $ S.fromList [3, 4, 5, 6, 7, 2, 3, 4]-- fromList [3,4,5,6,7,8]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>é€šå¸¸ä½¿ç”¨<code>Set</code>å®Œæˆ<code>List</code>çš„å»é‡æ“ä½œ,å…¶é€Ÿåº¦ä¼˜äº<code>List.nub</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">setNub xs &#x3D; Set.toList $ Set.fromList xs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å”¯ä¸€çš„ç¼ºç‚¹æ˜¯ä¼šä¸¢å¤±é¡ºåº</p></li></ul><h4 id="å£°æ˜æ¨¡å—">å£°æ˜æ¨¡å—</h4><ul><li><p>å£°æ˜å•æ¨¡å—</p><ul><li><p>åˆ›å»ºæ–‡ä»¶, æ–‡ä»¶åä¸º<code>æ¨¡å—å.hs</code>,æ¨¡å—åéœ€å¼€å¤´å¤§å†™</p></li><li><p>æ–‡ä»¶é¦–éƒ¨å†™å‡ºæ¨¡å—åä¸éœ€è¦å¯¼å‡ºçš„æ–¹æ³•, ä¾‹å¦‚<code>Demo.hs</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">module Demo  ( demo1,    demo2,  )wheredemo1 :: Integer -&gt; Integerdemo1 &#x3D; demo3 . (1 +)demo2 :: Integer -&gt; Integerdemo2 &#x3D; demo3 . (1 -)-- demo3ä»…ä½œä¸ºå†…éƒ¨è°ƒç”¨ä½¿ç”¨, æ— éœ€å¯¼å‡º, å¯ä»¥ä¸åœ¨moduleä¸­å†™demo3 :: Integer -&gt; Integerdemo3 &#x3D; (* 2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å°†æ¨¡å—æ”¾åœ¨åŒçº§ç›®å½•, ä¾‹å¦‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">.â”œâ”€â”€ Demo.hsâ””â”€â”€ test.hs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å°±å¯ä»¥åœ¨<code>test.hs</code>ä¸­è°ƒç”¨</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import Demores :: Integerres &#x3D; demo1 1-- 4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>ä¹Ÿå¯ä»¥åˆ†å±‚è®¾è®¡æ¨¡å—,åªéœ€è¦å°†å…¶æ”¾å…¥å­æ–‡ä»¶ä¸­å¹¶ä½¿ç”¨<code>.</code>å¼•å…¥</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">.â”œâ”€â”€ Demosâ”‚   â”œâ”€â”€ DemoA.hsâ”‚   â””â”€â”€ DemoB.hsâ””â”€â”€ test.hs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­</p><ul><li><p><code>DemoA.hs</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">module Demos.DemoA  ( demo1,    demo2,  )wheredemo1 :: Integer -&gt; Integerdemo1 &#x3D; demo3 . (1 +)demo2 :: Integer -&gt; Integerdemo2 &#x3D; demo3 . (1 -)demo3 :: Integer -&gt; Integerdemo3 &#x3D; (* 2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>DemoB.hs</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">module Demos.DemoB  ( demo1,    demo2,  )wheredemo1 :: Integer -&gt; Integerdemo1 &#x3D; demo3 . (2 +)demo2 :: Integer -&gt; Integerdemo2 &#x3D; demo3 . (2 -)demo3 :: Integer -&gt; Integerdemo3 &#x3D; (* 4)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>test.hs</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import qualified Demos.DemoA as Aimport qualified Demos.DemoB as Ba &#x3D; A.demo1 1-- 4b &#x3D; B.demo1 1-- 12<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><h3 id="å£°æ˜ç±»å‹ä¸ç±»å‹ç±»">å£°æ˜ç±»å‹ä¸ç±»å‹ç±»</h3><h4 id="ä»£æ•°æ•°æ®ç±»å‹">ä»£æ•°æ•°æ®ç±»å‹</h4><p>ä»£æ•°æ•°æ®ç±»å‹: ç”±å€¼çš„ä¸€äº›é›†åˆ, ä»¥åŠè¿™äº›é›†åˆä¹‹é—´çš„ä¸€äº›å‡½æ•°æ„æˆçš„ç±»å‹.è¿™äº›å‡½æ•°éƒ½æ˜¯ä¸€é˜¶å‡½æ•°, ä¸èƒ½ä»¥å…¶ä»–å‡½æ•°ä½œä¸ºå‚æ•°.</p><ul><li><p>ä¾‹å¦‚<code>Bool</code>ç±»å‹çš„å®šä¹‰</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data Bool &#x3D; False | True<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><ul><li><p><code>data</code>å…³é”®å­—ç”¨äºå£°æ˜æ–°ç±»åˆ«</p></li><li><p><code>=</code>å³è¾¹æ˜¯<strong>å€¼æ„é€ å­</strong>,åŒ…å«äº†è¿™ä¸ªç±»å‹çš„æ‰€æœ‰å¯èƒ½å€¼(å³<code>True</code>, <code>False</code>,ç”¨<code>|</code>åˆ†å¼€)</p></li><li><p>ä»€ä¹ˆæ˜¯å€¼æ„é€ å­å‘¢? å¬èµ·æ¥å¾ˆåƒå‘½ä»¤å¼ç¼–ç¨‹ä¸­çš„æ„é€ å‡½æ•°ğŸ¤”.ä¸å¦¨æ‰§è¡Œ<code>:t False</code>. å¾—åˆ°<code>False :: Bool</code>,æˆ‘ä»¬å¯ä»¥è¿™æ ·æƒ³: <code>False</code>æ˜¯ä¸€ä¸ªå‡½æ•°, è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªå¸¸å‡½æ•°,ä¸æ¥å—ä»»ä½•å‚æ•°, è¿”å›ä¸€ä¸ª<code>Bool</code>ç±»å‹çš„æ•°æ®</p><p><strong>å€¼æ„é€ å­çš„æœ¬è´¨æ˜¯ä¸ªå‡½æ•°ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªå‹åˆ«çš„å€¼</strong></p></li></ul></li><li><p>ä¾‹å¦‚å®šä¹‰ä¸€ä¸ªæ”¯æŒåœ†å½¢æˆ–æ­£æ–¹å½¢çš„<code>Shape</code>ç±»å‹.</p><ul><li><p>é¦–å…ˆæˆ‘ä»¬çŸ¥é“è¿™ä¸ªç±»å‹çš„å–å€¼åº”è¯¥æ˜¯åœ†/æ­£æ–¹å½¢:</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data Shape &#x3D; Circle | Rectangle<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>æœ‰ç‚¹åç›´è§‰,è¿™é‡Œçš„<code>Circle</code>ä¸<code>Rectangle</code>æ˜¯ä»€ä¹ˆ?</p><p>æ˜¯å€¼æ„é€ å­, ä¹Ÿå°±æ˜¯è¯´ä»–ä»¬å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªç‹¬ç«‹çš„<strong>å€¼</strong>,è¿™é‡Œçš„<code>Circle</code>å’Œä¹‹å‰çš„<code>False</code>æ˜¯ä¸€ä¸ªä¸œè¥¿</p></li><li><p>å¦‚ä½•è¡¨ç¤ºä¸€ä¸ª<code>Circle</code>å‘¢,å¯ä»¥ä½¿ç”¨ä¸‰ä¸ªå‚æ•°(é¡¹)è¡¨ç¤º<code>x, y, r</code>.å¯ä»¥å°†å‚æ•°ç±»å‹é™„åœ¨å€¼æ„é€ å­åè¡¨ç¤ºè¿™ä¸ªæ„é€ å­çš„ç±»å‹.åŒç†å¯ä»¥ç”¨<code>x1, y1, x2, y2</code>è¡¨ç¤ºé•¿æ–¹å½¢</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data Shape &#x3D; Circle Float Float Float | Rectangle Float Float Float Float<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>å°è¯•æ£€æŸ¥<code>Circle</code>ç±»å‹:</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">Circle :: Float -&gt; Float -&gt; Float -&gt; Shape<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>æ˜¯ä¸€ä¸ªå‡½æ•°, æ¥å—ä¸‰ä¸ª<code>Float</code>, è¿”å›ä¸€ä¸ª<code>Shape</code>.çœ‹èµ·æ¥ä¸å‘½ä»¤å¼ç¼–ç¨‹ç›¸å·®ç”šè¿œğŸ¤”, æˆ‘ä»¬å¹¶æ²¡æœ‰<strong>å®ç°å€¼æ„é€ å­—</strong>,æ²¡æœ‰æè¿°æˆ‘ä»¬æ˜¯å¦‚ä½•å°†ä¸‰ä¸ª<code>Float</code>ç±»å‹çš„å˜é‡è¡¨ç¤ºä¸ºä¸€ä¸ª<code>Shape</code>ç±»å‹çš„åœ†çš„.åˆ«å¿˜äº†Haskellçš„å‡½æ•°æ˜¯çº¯å‡½æ•°ğŸ˜†. ä½¿ç”¨ç›¸åŒçš„ä¸‰ä¸ªå‚æ•°å°±å¯ä»¥è·å–åŒä¸€ä¸ªåœ†.å¯ä»¥è¿™æ ·ç†è§£: <code>Circle 1 1 1</code>å°±ä»£è¡¨ä¸€ä¸ªåœ†,ä»–çš„ç±»å‹å°±æ˜¯<code>Shape</code>,</p></li></ul></li></ul><p><strong>ä¸è¦å°†å€¼æ„é€ å­ä¸ç±»æ··æ·†, ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ³•æ˜¯è®°ä½ä¾‹å­:<code>Bool</code>æ˜¯ç±»å‹, <code>True</code>æ˜¯å€¼æ„é€ å­</strong>,åœ¨å‡½æ•°å£°æ˜ç±»å‹çš„åº”è¯¥ä½¿ç”¨ç±»å‹è€Œä¸æ˜¯å€¼æ„é€ å­. ä¾‹å¦‚:å®ç°è·å–åœ†é¢ç§¯çš„å‡½æ•°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data Shape &#x3D; Circle Float Float Float | Rectangle Float Float Float FloatgetCiecleSize :: Shape -&gt; Float       -- ğŸ‘getCiecleSize :: Circle -&gt; Float      -- ğŸ‘<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åƒä¸‡ä¸è¦æŠŠå€¼æ„é€ å­ç”¨ä½œç±»å‹å£°æ˜,è¿™å°±å’Œä½ å°†<code>True</code>ç”¨ä½œç±»å‹å£°æ˜ä¸€æ ·æ„šè ¢</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">tellMessage :: Bool -&gt; String      -- ğŸ‘tellMessage :: True -&gt; String      -- ğŸ‘tellMessage True &#x3D; &quot;Wow, it is true&quot;tellMessage False &#x3D; &quot;Opps, it is false&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>é—®é¢˜æ¥äº†, æˆ‘ä»¬åªæƒ³è®¡ç®—<code>Circle</code>çš„é¢ç§¯,ä½†æ˜¯æˆ‘ä»¬åœ¨å‡½æ•°å£°æ˜çš„æ—¶å€™åªè¦æ±‚å‚æ•°æ˜¯<code>Shape</code>,æ²¡æ³•è¿‡æ»¤<code>Rectangle</code>å•ŠğŸ¤¯! å¥½å¥½æƒ³æƒ³,å¦‚æœæˆ‘ä»¬åªæ˜¯æƒ³å®ç°è¾“å…¥<code>True</code>è¿”å›å­—ç¬¦ä¸²,è¾“å…¥<code>Fasle</code>ä¸ç®¡, åº”è¯¥å¦‚ä½•å®ç°å‘¢? æ¨¡å¼åŒ¹é…</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">tellMessage :: Bool -&gt; StringtellMessage True &#x3D; &quot;Wow, it is true&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸€æ ·æ ·çš„, ä¸è¿‡<code>Circle</code>æ„é€ å­æœ‰å‚æ•°, æˆ‘ä»¬è¦ä¸€å¹¶åŒ¹é…</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">getCiecleSize :: Shape -&gt; FloatgetCiecleSize (Circle _ _ r) &#x3D; pi * r ^ 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å†å®ç°ä¸€ä¸ªè·å–<code>Shape</code>é¢ç§¯çš„æ–¹æ³•</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">surface :: Shape -&gt; Floatsurface (Circle _ _ r) &#x3D; pi * r ^ 2surface (Rectangle x1 y1 x2 y2) &#x3D; (abs $ x2 - x1) * (abs $ y2 - y1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ğŸ˜†æœ€åä¼˜åŒ–ä¸€ä¸‹, å®šä¹‰ä¸€ä¸ª<code>Point</code>ç±»</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data Point &#x3D; Point Float Floatdata Shape &#x3D; Circle Point Float | Rectangle Point Pointsurface :: Shape -&gt; Floatsurface (Circle _ r) &#x3D; pi * r ^ 2surface (Rectangle (Point x1 y1) (Point x2 y2)) &#x3D; (abs $ x2 - x1) * (abs $ y2 - y1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å€¼å¾—æ³¨æ„çš„æ˜¯ç±»å‹<code>Point</code>ä¸å€¼æ„é€ å­<code>Point</code>é‡åäº†.æ²¡å•¥ç¨€å¥‡çš„,</p><ul><li>å‰é¢çš„<code>Point</code>æ˜¯ç±»å‹, ç”¨äºç±»å‹å£°æ˜,ç±»ä¼¼äº<code>Bool</code></li><li>åé¢çš„<code>Point</code>æ˜¯å€¼æ„é€ å­, ç”¨äºè¡¨ç¤ºå€¼,ç±»ä¼¼äº<code>True</code></li></ul><p>ğŸ§°æˆ‘ä»¬è¿˜å¯ä»¥å°†<code>Shape</code>çš„å®šä¹‰ä¸æ–¹æ³•æ‰“åŒ…æˆæ¨¡å—</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">module Shapes( Point(..), Shape(..), surface) where<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç±»å‹åçš„<code>(..)</code>è¡¨ç¤ºå¯¼å‡ºç±»å‹çš„å…¨éƒ¨å€¼æ„é€ å­.è¿™æ ·å¯¼å…¥è€…å°±å¯ä»¥ç›´æ¥å®šä¹‰ç±»å‹äº†. å¦‚æœæˆ‘ä»¬ä¸å¸Œæœ›å¯¼å…¥è€…ç›´æ¥æ„é€ å®ä¾‹,æˆ‘ä»¬å¯ä»¥å£°æ˜åƒ<code>Map.fromList</code>çš„å‡½æ•°æ„é€ ç±»å‹</p><h4 id="record-syntax">Record Syntax</h4><p>ğŸ·ï¸Haskellæä¾›äº†<code>record syntax</code>, å¯ä»¥åœ¨å®šä¹‰ç±»å‹çš„åŒæ—¶,ä¸ºæ¯ä¸ªå­—æ®µæŒ‡å®šè¯»å–å™¨. å°±åƒå‘½ä»¤å¼ç¼–ç¨‹ä¸€æ ·, æˆ‘ä»¬å¯ä»¥ä¸ºæ¯é¡¹èµ‹äºˆæ ‡è¯†,ä¾‹å¦‚å®šä¹‰<code>Person</code>ç±»å‹æ—¶, æˆ‘ä»¬å¯ä»¥å†™ä¸‹</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data Person &#x3D; Person &#123; firstName :: String                     , lastName :: String                     , age :: Int                     , height :: Float                     , phoneNumber :: String                     , flavor :: String                     &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·å°±ä¸º<code>Person</code>å€¼æ„é€ å­å‚æ•°èµ‹äºˆäº†æ ‡ç­¾</p><p>ä¸ç›´æ¥ä½¿ç”¨<code>Person :: Person String String...</code>å£°æ˜ä¸åŒçš„æ˜¯<strong><code>Haskell</code>ä¸ºæ¯ä¸€ä¸ªå‚æ•°ç»‘å®šçš„æ ‡è¯†ç¬¦ç»‘å®šäº†ä¸€ä¸ªå‡½æ•°</strong>,ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; :t flavorflavor :: Person -&gt; String<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™ä¸ªå‡½æ•°å–<code>Person</code>ç±»å‹å€¼, è¿”å›è¿™ä¸ªå€¼ä¸­è¯¥å…ƒç´ æ‰€åœ¨ä½å€¼</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data Person &#x3D; Person  &#123; firstName :: String,    lastName :: String,    age :: Int,    height :: Float,    phoneNumber :: String,    flavor :: String  &#125;per &#x3D; Person &quot;Kairui&quot; &quot;Liu&quot; 12 123 &quot;13456789022&quot; &quot;i do not know&quot;flavor per   -- &quot;i do not know&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç­‰ä»·äº</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">flavor&#39; :: Person -&gt; Stringflavor&#39; (Person _ _ _ _ _ f) &#x3D; f<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="ç±»å‹å‚æ•°">ç±»å‹å‚æ•°</h4><p>ç±»ä¼¼äºå‘½ä»¤å¼ç¼–ç¨‹ä¸­çš„"æ¨¡æ¿", å¯ä»¥åœ¨å£°æ˜ç±»å‹çš„æ—¶å€™åŠ å…¥ç±»å‹å˜é‡å‚æ•°,ä¾‹å¦‚<code>Maybe</code>ç±»å‹</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data Maybe a &#x3D; Nothing | Just a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ¥å—ä¸€ä¸ªç±»å‹å‚æ•°å¹¶åœ¨<code>Just</code>ä¸­ä½¿ç”¨,åœ¨è°ƒç”¨<code>Just X</code>çš„æ—¶å€™, Haskellä¼šè‡ªåŠ¨åˆ¤æ–­ç±»å‹å¹¶è¿”å›</p><p>ç”šè‡³å¯ä»¥åœ¨ç±»å‹å®šä¹‰æ—¶é™å®šç±»å‹å˜é‡ç±»å‹(<strong>ä½†æ˜¯å¼ºçƒˆä¸å»ºè®®</strong>),å› ä¸ºåœ¨å‡½æ•°ç±»å‹å®šä¹‰æ—¶æˆ‘ä»¬è¿˜æ˜¯éœ€è¦å£°æ˜ç±»å‹çš„ç±»å‹ç±»</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data (Ord k) &#x3D;&gt; Map k v &#x3D; ...<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å®ç°ä¸€ä¸ªçŸ¢é‡åŠ æ³•</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data Vector a &#x3D; Vector a a a deriving (Show)plusV :: (Num a) &#x3D;&gt; Vector a -&gt; Vector a -&gt; Vector aplusV (Vector x1 y1 z1) (Vector x2 y2 z2) &#x3D; Vector (x1 + x2) (y1 + y2) (z1 + z2)plusV (Vector 1 2 3) (Vector 1 2 3)-- Vector 2 4 6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é€’å½’å®šä¹‰ç±»å‹">é€’å½’å®šä¹‰ç±»å‹</h4><p>å®šä¹‰å€¼æ„é€ å­çš„æ—¶å€™ä½¿ç”¨æœ¬èº«çš„ç±»å‹å°±æ„æˆäº†æ•°æ®ç±»å‹é€’å½’å®šä¹‰.</p><ul><li><p>å®šä¹‰ä¸€ä¸ª<code>List</code>.ä¸€ä¸ª<code>List</code>è¦ä¹ˆæ˜¯ç©ºçš„<code>[]</code>,è¦ä¹ˆæ˜¯<code>elem:List</code></p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data List a &#x3D; Empty | Cons a (List a)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>å…¶ä¸­<code>Cons</code>å°±æ˜¯<code>:</code></p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; :t (:)(:) :: a -&gt; [a] -&gt; [a]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>ä¹Ÿå°±æ˜¯: <code>List</code>æœ‰ä¸¤ä¸ªå€¼,è¦ä¹ˆæ˜¯<code>Empty</code>å€¼æ„é€ å­è¦ä¹ˆæ˜¯<code>Cons</code>å€¼æ„é€ å­.å…¶ä¸­<code>Cons</code>å€¼æ„é€ å­æœ‰ä¸¤ä¸ªå‚æ•°,<code>a</code>ä¸<code>List a</code></p><p>åŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨<code>Record Syntax</code>å®šä¹‰<code>List</code></p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data List a &#x3D; Empty | Cons &#123; listHead :: a, listTail :: List a&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>ä¾‹å¦‚<code>[1,2,3]</code>ç›¸å½“äº<code>1:2:3:[]</code></p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">Cons 1 $ Cons 2 $ Cons 3 Empty<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>å®šä¹‰<code>++</code></p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">infixr 5  ++(++) :: [a] -&gt; [a] -&gt; [a][]     ++ ys &#x3D; ys(x:xs) ++ ys &#x3D; x : (xs ++ ys)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>å®šä¹‰æœç´¢äºŒå‰æ ‘(å…ˆä¸ç®¡<code>deriving...</code>)</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data BST a &#x3D; EmptyTree | Node a (BST a) (BST a) deriving (Show, Eq)-- è·å–å•å…ƒç´ getOne :: a -&gt; BST agetOne a &#x3D; Node a EmptyTree EmptyTreeinsertNode :: (Ord a, Eq a) &#x3D;&gt; a -&gt; BST a -&gt; BST ainsertNode x EmptyTree &#x3D; getOne xinsertNode x (Node a lt rt)  | x &lt; a &#x3D; Node a (insertNode x lt) rt  | x &gt; a &#x3D; Node a lt (insertNode x rt)  | x &#x3D;&#x3D; a &#x3D; Node a lt rtelemNode :: (Ord a, Eq a) &#x3D;&gt; a -&gt; BST a -&gt; BoolelemNode x EmptyTree &#x3D; FalseelemNode x (Node a lt rt)  | x &#x3D;&#x3D; a &#x3D; True  | x &lt; a &#x3D; elemNode x lt  | x &gt; a &#x3D; elemNode x rtt1 :: BST Integert1 &#x3D; insertNode 10 . insertNode 5 $ getOne 7-- Node 7 (Node 5 EmptyTree EmptyTree) (Node 10 EmptyTree EmptyTree)t2 :: Boolt2 &#x3D; elemNode 3 t1-- Falset3 :: Boolt3 &#x3D; elemNode 10 t1-- True<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h4 id="ç±»å‹åˆ«å">ç±»å‹åˆ«å</h4><p>ğŸ‘»ä¸å‘½ä»¤å¼ç¼–ç¨‹ä¸­ç±»å‹åˆ«åç±»ä¼¼.</p><ul><li><p>çœ‹çœ‹<code>String</code>è¯­æ³•ç³–æ˜¯å¦‚ä½•å®šä¹‰çš„</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">type String &#x3D; [Char]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>å°±æ˜¯å°†ç±»å‹æ˜ å°„åˆ°å¦ä¸€ä¸ªç±»å‹ç»„</p></li><li><p>å®šä¹‰ä¸€ä¸ªç”µè¯ç°¿</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">-- æ­£å¸¸æ¬¾phoneBook :: [(String,String)]phoneBook &#x3D;    [(&quot;betty&quot;,&quot;555-2938&quot;)    ,(&quot;penny&quot;,&quot;853-2492&quot;)    ]-- åˆ«åæ¬¾type PhoneBook &#x3D; [(String,String)]-- Record Syntax åˆ«åæ¬¾type PhoneNumber &#x3D; Stringtype Name &#x3D; Stringtype PhoneBook &#x3D; [(Name,PhoneNumber)]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h4 id="æ´¾ç”Ÿ">æ´¾ç”Ÿ</h4><p>ç±»ä¼¼å‘½ä»¤å¼ç¼–ç¨‹çš„æ¥å£ä¸æ´¾ç”Ÿ,åœ¨Haskellä¸­å½“ç±»å‹å¯ä»¥é€šè¿‡æ´¾ç”Ÿçš„æ–¹å¼å½’å±äºä¸€ä¸ªç±»å‹ç±»</p><p><strong>æˆ‘ä»¬åªè®¨è®ºå¦‚ä½•å£°æ˜ç±»å‹ä¸ºé¢„å®šäº<code>Type Classes</code></strong>,ä¸è¿‡ç­‰è‡ªå·±ä¼šå®šä¹‰<code>Type Class</code>æ—¶è‡ªç„¶ä¹Ÿå°±ä¼šæ´¾ç”Ÿäº†</p><p>ç±»å‹æ˜¯å¯ä»¥å±äºä¸€ä¸ªç±»å‹ç±»çš„(ä¾‹å¦‚<code>Bool</code>æ˜¯ä¸€ä¸ª<code>Eq</code>ç±»å‹ç±»çš„),æˆ‘ä»¬ä¹Ÿå¯ä»¥å£°æ˜è‡ªå·±çš„ç±»å‹å±äºæŸä¸ªç±»å‹ç±». ä¾‹å¦‚</p><ul><li><p>å®šä¹‰<code>Shape</code>æ´¾ç”Ÿè‡ª<code>Show</code>(ä½¿å…¶å¯ä»¥è¢«æ‰“å°)</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data Shape &#x3D; Circle Float Float Float | Rectangle Float Float Float Float deriving (Show)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åªéœ€ä½¿ç”¨<code>deriving (Show)</code>å³å¯å£°æ˜ç±»å‹æ´¾ç”Ÿè‡ª<code>Show</code>.ä¹‹åå°±å¯ä»¥åœ¨<code>ghci</code>ä¸­æ‰“å°<code>Shape</code>äº†</p><p>ğŸåŒæ—¶, è‹¥ç±»ä¼¼æ˜¯é€šè¿‡<code>Record Syntax</code>å®šä¹‰çš„ ,<code>show</code>åˆ°å¤„çš„å½¢å¼ä¼šç•¥æœ‰ä¸åŒ</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data Shape &#x3D; Circle Float Float Float | Rectangle Float Float Float Float deriving (Show)data Shape&#39; &#x3D; Circle&#39; &#123;x :: Float, y :: Float, r :: Float&#125; | Rectangle&#39; &#123;x1 :: Float, y1 :: Float, x2 :: Float, y2 :: Float&#125; deriving (Show)t &#x3D; show (Circle 1 2 3)-- &quot;Circle 1.0 2.0 3.0&quot;t&#39; &#x3D; show (Circle&#39; 1 2 3)-- &quot;Circle&#39; &#123;x &#x3D; 1.0, y &#x3D; 2.0, r &#x3D; 3.0&#125;&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ğŸ¤”æœ‰ç‚¹å°é—®é¢˜,ä»å¤´åˆ°å°¾æˆ‘ä»¬éƒ½æ²¡æœ‰å®ç°<code>Show</code>ç±»å‹ç±»ä¸­çš„ä¸€ä¸ªå‡½æ•°å•Š.æ€ä¹ˆå°±æ‰“å°å‡ºæ¥äº†å‘¢?</p><p>è¿™æ˜¯å› ä¸º<code>Show</code>ç±»å‹ç±»ä¸­å­˜åœ¨é»˜è®¤å®ç°, æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨é‡å†™</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data Shape &#x3D; Circle Float Float Float | Rectangle Float Float Float Float    -- æ³¨æ„æ²¡æœ‰&quot;deriving&quot;-- å®ç°æ¥å£instance Show Shape where  show (Circle x y r) &#x3D; &quot;Look! it is a circle, with origin (&quot; ++ show x ++ &quot;, &quot; ++ show y ++ &quot;), and r &#x3D; &quot; ++ show r  show (Rectangle x1 y1 x2 y2) &#x3D; &quot;Look! it is a rectangle, from (&quot; ++ show x1 ++ &quot;, &quot; ++ show y1 ++ &quot;), to (&quot; ++ show x2 ++ &quot;, &quot; ++ show y2 ++ &quot;)&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; show (Circle 1 2 3)&quot;Look! it is a circle, with origin (1.0, 2.0), and r &#x3D; 3.0&quot;ghci&gt; show (Rectangle  1 2 3 4)&quot;Look! it is a rectangle, from (1.0, 2.0), to (3.0, 4.0)&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å®šä¹‰<code>Shape</code>æ´¾ç”Ÿè‡ª<code>Eq</code></p><p>é»˜è®¤<code>Eq</code>å®ç°ä¸º: åˆ†åˆ«æ¯”è¾ƒæ¯ä¸€ä¸ªå…ƒç´ æ˜¯å¦ç›¸ç­‰</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data Person &#x3D; Person &#123; firstName :: String                     , lastName :: String                     , age :: Int                     &#125; deriving (Eq)mikeD &#x3D; Person &#123;firstName &#x3D; &quot;Michael&quot;, lastName &#x3D; &quot;Diamond&quot;, age &#x3D; 43&#125;adRock &#x3D; Person &#123;firstName &#x3D; &quot;Adam&quot;, lastName &#x3D; &quot;Horovitz&quot;, age &#x3D; 41&#125;mca &#x3D; Person &#123;firstName &#x3D; &quot;Adam&quot;, lastName &#x3D; &quot;Yauch&quot;, age &#x3D; 44&#125;mca &#x3D;&#x3D; adRock         -- FalsemikeD &#x3D;&#x3D; adRock       -- FalsemikeD &#x3D;&#x3D; mikeD        -- TruemikeD &#x3D;&#x3D; Person &#123;firstName &#x3D; &quot;Michael&quot;, lastName &#x3D; &quot;Diamond&quot;, age &#x3D; 43&#125;-- True<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‡å†™æ—¶éœ€è¦å®ç°<code>==</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data Shape &#x3D; Circle Float Float Float | Rectangle Float Float Float Floatinstance Eq Shape where  (Circle x1 y1 r1) &#x3D;&#x3D; (Circle x2 y2 r2) &#x3D; x1 &#x3D;&#x3D; x2 &amp;&amp; y1 &#x3D;&#x3D; y2 &amp;&amp; r1 &#x3D;&#x3D; r2  (Rectangle x11 y11 x21 y21) &#x3D;&#x3D; (Rectangle x12 y12 x22 y22) &#x3D; x11 &#x3D;&#x3D; x12 &amp;&amp; y11 &#x3D;&#x3D; y12 &amp;&amp; x21 &#x3D;&#x3D; x22 &amp;&amp; y21 &#x3D;&#x3D; y22  _ &#x3D;&#x3D; _ &#x3D; False-- åˆ«çœ‹ä¸æ‡‚, åªæ˜¯ç®€å•çš„ä¸­ç¼€è¡¨è¾¾å¼t1 &#x3D; Circle 1 1 1 &#x3D;&#x3D; Circle 1 1 1            -- Truet2 &#x3D; Circle 1 1 2 &#x3D;&#x3D; Circle 1 1 1            -- Falset3 &#x3D; Rectangle 1 1 2 3 &#x3D;&#x3D; Rectangle 1 1 2 3  -- Truet4 &#x3D; Rectangle 1 1 2 3 &#x3D;&#x3D; Rectangle 1 1 2 4  -- Falset5 &#x3D; Circle 1 1 2 &#x3D;&#x3D; Rectangle 1 1 2 4       -- False<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å®šä¹‰<code>Bool</code>ç±»å‹æ´¾ç”Ÿè‡ª<code>Ord</code>.ä½¿å¾—å…¶æ”¯æŒ<code>&lt;</code>, <code>&gt;</code>, <code>==</code>,<code>succ</code>, <code>pred</code>, <code>minBound</code>,<code>maxBound</code>, <code>..</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data Bool &#x3D; False | True deriving (Ord)succ False      -- Truepred True       -- False<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>Ord</code>çš„é¡ºåºå°±æ˜¯å®šä¹‰ç±»å‹æ—¶<code>|</code>çš„é¡ºåº.</p></li></ul><h4 id="å®šä¹‰typeclasses">å®šä¹‰<code>TypeClasses</code></h4><p><code>Haskell</code>çš„<code>TypeClasses</code>ä¸å‘½ä»¤å¼ç¼–ç¨‹ä¸­çš„æ¥å£ç±»ä¼¼.æˆ‘ä»¬éœ€è¦å®šä¹‰<code>TypeClasses</code>ä¸<code>TypeClasses</code>ä¸­å‡½æ•°.ä½¿ç”¨<code>class</code>å…³é”®å­—å®šä¹‰ğŸ™ƒ(å¤šå°‘æœ‰ç‚¹å˜²è®½),å…¶éœ€è¦å®ç°çš„æ–¹æ³•åœ¨<code>where</code>ä¸­. ä¾‹å¦‚</p><ul><li><p><code>Eq</code>ç±»å‹ç±»çš„å®šä¹‰</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">class Eq a where    (&#x3D;&#x3D;) :: a -&gt; a -&gt; Bool    (&#x2F;&#x3D;) :: a -&gt; a -&gt; Bool    x &#x3D;&#x3D; y &#x3D; not (x &#x2F;&#x3D; y)    x &#x2F;&#x3D; y &#x3D; not (x &#x3D;&#x3D; y)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ğŸ˜²çœ‹èµ·æ¥æœ‰ç‚¹ç¦»è°±,è¿™æ³¢å¾ªç¯å®šä¹‰å±å®æ˜¯æ²¡æƒ³åˆ°...è¦æ˜¯çœŸæ˜¯è¿™ä¹ˆå®šä¹‰çš„å¯å¤ªç¦»è°±äº†.å¯æ˜¯äººå®¶çœŸçš„æ˜¯è¿™ä¹ˆå®šä¹‰çš„. æ¯•ç«Ÿ, è¿™æ˜¯é»˜è®¤å®šä¹‰,æˆ‘ä»¬åœ¨å®ç°æ¥å£çš„æ—¶å€™å¯ä»¥é‡å†™</p><p>å®ç°ä¸€ä¸ªçº¢ç»¿ç¯ç±»å‹, å¹¶æ´¾ç”Ÿè‡ª<code>Eq</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data TrafficLight &#x3D; Red | Yellow | Greeninstance Eq TrafficLight where    Red &#x3D;&#x3D; Red &#x3D; True    Green &#x3D;&#x3D; Green &#x3D; True    Yellow &#x3D;&#x3D; Yellow &#x3D; True    _ &#x3D;&#x3D; _ &#x3D; False<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å®šä¹‰äº†çº¢ç»¿ç¯çš„ä¸‰ä¸ªå€¼,å¹¶ä¸”é‡å†™äº†<code>==</code>(åªæœ‰ä¸‰ç§æƒ…å†µæ˜¯True,å…¶ä»–éƒ½æ˜¯<code>False</code>)</p><p>ç„¶åå°±ä¸ç”¨å®šä¹‰<code>/=</code>äº†,<code>Haskell</code>ç›´æ¥ä½¿ç”¨é»˜è®¤çš„<code>/=</code>å®šä¹‰</p></li></ul><p>å…¶ä¸­ç±»å‹å®šä¹‰ä¹Ÿå¯ä»¥å¯¹ç±»å‹å‚æ•°å˜é‡è¿›è¡Œå®šä¹‰,å®šä¹‰<code>Mybe</code>ç±»å‹çš„å…ƒç´ æ´¾ç”Ÿè‡ª<code>Eq</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">instance (Eq m) &#x3D;&gt; Eq (Maybe m) where    Just x &#x3D;&#x3D; Just y &#x3D; x &#x3D;&#x3D; y    Nothing &#x3D;&#x3D; Nothing &#x3D; True    _ &#x3D;&#x3D; _ &#x3D; False<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥ä½¿ç”¨<code>:info</code>è·å–ç±»å‹æ‰€æ´¾ç”Ÿçš„<code>TypeClasses</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; :info Maybetype Maybe :: * -&gt; *data Maybe a &#x3D; Nothing | Just a        -- Defined in â€˜GHC.Maybeâ€™instance Applicative Maybe -- Defined in â€˜GHC.Baseâ€™instance Eq a &#x3D;&gt; Eq (Maybe a) -- Defined in â€˜GHC.Maybeâ€™instance Functor Maybe -- Defined in â€˜GHC.Baseâ€™instance Monad Maybe -- Defined in â€˜GHC.Baseâ€™instance Semigroup a &#x3D;&gt; Monoid (Maybe a) -- Defined in â€˜GHC.Baseâ€™instance Ord a &#x3D;&gt; Ord (Maybe a) -- Defined in â€˜GHC.Maybeâ€™instance Semigroup a &#x3D;&gt; Semigroup (Maybe a)  -- Defined in â€˜GHC.Baseâ€™instance Show a &#x3D;&gt; Show (Maybe a) -- Defined in â€˜GHC.Showâ€™instance Read a &#x3D;&gt; Read (Maybe a) -- Defined in â€˜GHC.Readâ€™instance MonadFail Maybe -- Defined in â€˜Control.Monad.Failâ€™instance Foldable Maybe -- Defined in â€˜Data.Foldableâ€™instance Traversable Maybe -- Defined in â€˜Data.Traversableâ€™<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>çœ‹ä¸€ä¸ªä¾‹å­: <code>yes-no typeclass</code></strong>ğŸ˜</p><p><code>yes-no typeclass</code>ç±»ä¼¼å¼±ç±»å‹çš„<code>Bool</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">class YesNo a where    yesno :: a -&gt; Boolinstance YesNo Int where    yesno 0 &#x3D; False    yesno _ &#x3D; Trueinstance YesNo [a] where    yesno [] &#x3D; False    yesno _ &#x3D; Trueinstance YesNo Bool where    yesno &#x3D; id    -- idçš„ä½œç”¨å°±æ˜¯è¿”å›å‚æ•°<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®ç°ä¸€ä¸ªæ–¹æ³•</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">yesnoIf :: (YesNo y) &#x3D;&gt; y -&gt; a -&gt; a -&gt; ayesnoIf yesnoVal yesResult noResult &#x3D;    if yesno yesnoVal then yesResult else noResult<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="functor-typeclass">Functor typeclass</h4><p>ğŸš§<code>Functor typeclass</code>æ˜¯Haskellä¸­å¾ˆé‡è¦çš„<code>TypeClasses</code>,å…¶ä»…å®šä¹‰äº†<code>fmap</code>æ–¹æ³•, è¯¥æ–¹æ³•ç”¨äºå®ç°è¯¥ç±»å‹çš„<code>map</code>,æ€ä¹ˆå¤„ç†<code>f x</code>åˆ°<code>y</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">class Functor f where    fmap :: (a -&gt; b) -&gt; f a -&gt; f b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¾‹å¦‚åœ¨<code>List</code>ä¸­</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">instance Functor [] where    fmap &#x3D; mapfmap (*2) [1..3]-- [2,4,6]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨<code>Maybe</code>ä¸­å®ç°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">instance Functor Maybe where    fmap f (Just x) &#x3D; Just (f x)    fmap f Nothing &#x3D; Nothing<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>åœ¨<code>Either</code>ä¸­å®ç°(å¦‚æœæ˜¯<code>Right</code>å°±æ˜ å°„,å¦‚æœæ˜¯<code>Left</code>å°±ä¸)</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data Either a b &#x3D; Left a | Right b  -- Either å®šä¹‰instance Functor (Either a) where    fmap f (Right x) &#x3D; Right (f x)    fmap f (Left x) &#x3D; Left x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="kind">Kind</h4><p>åœ¨å®šä¹‰<code>Type</code>çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»™å®šç±»å‹å‚æ•°è€Œå®ç°ç±»ä¼¼"æ¨¡æ¿"("å¤šæ€")çš„åŠŸèƒ½.ä¹Ÿå°±æ˜¯è¯´, å®šä¹‰<code>Type</code>çš„æ—¶å€™å¯ä»¥ç»™ä¸€ä¸ªå‚æ•°ç±»å‹,è¿”å›ä¸€ä¸ª"å…·ä½“"çš„<code>Type</code>. ğŸ¤”çœ‹èµ·æ¥æœ‰ç‚¹åƒå‡½æ•°?</p><p>è¿˜æœ‰ä¸ªé—®é¢˜,çœ‹çœ‹<code>Just 5</code>çš„ç±»å‹<code>(Just 5) :: Num a =&gt; Maybe a</code>,ä»–æ˜¯æ€ä¹ˆçŸ¥é“<code>5</code>æ˜¯<code>Num</code>ç±»å‹çš„å‘¢? ğŸ¤”å¾ˆç®€å•,<code>5</code>ä¸Šè¾¹ç»‘å®šäº†ä¸€ä¸ª<code>Type</code>æ ‡ç­¾ğŸ·.å¯ä»¥ä½¿ç”¨<code>:k</code>æŸ¥çœ‹</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; :k Int-- Int :: *<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>*</code>æ ‡è®°è¡¨ç¤ºä¸€ä¸ª"å…·ä½“"çš„Type,å°±æ˜¯å®šä¹‰ç±»å‹çš„æ—¶å€™æ²¡æœ‰ç±»å‹å‚æ•°.</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; :k Maybe-- Maybe :: * -&gt; *<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸<code>:t</code>ç±»ä¼¼,è¿™ä¸ª<code>Kind</code>çš„æ„æ€æ˜¯æ¥å—ä¸€ä¸ª<code>*</code>(å…·ä½“çš„ç±»å‹),è¿”å›ä¸€ä¸ª<code>*</code>(å…·ä½“çš„ç±»å‹), åŒç†</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; :k Maybe Int-- Maybe Int :: *<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¡¨ç¤º<code>Maybe Int</code>æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»å‹.<code>Kind</code>ä¹Ÿæ”¯æŒæŸ¯é‡ŒåŒ–</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; :k Either-- Either :: * -&gt; * -&gt; *ghci&gt; :k Either String-- Either String :: * -&gt; *ghci&gt; :k Either String Int-- Either String Int :: *<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr /><h3 id="è¾“å…¥ä¸è¾“å‡º">è¾“å…¥ä¸è¾“å‡º</h3><p>åœ¨å‘½ä»¤å¼è¯­è¨€ä¸­è½»è€Œæ˜“ä¸¾å®ç°çš„IO, åœ¨<code>Haskell</code>å´æ˜¯ä¸€ä»¶éš¾äº‹,Terminalæ˜¾ç¤ºçš„å†…å®¹æœ¬èº«æ˜¯ä¸€ä¸ªå˜é‡,è€Œ<code>Haskell</code>çš„å‡½æ•°æ˜¯æ— å‰¯ä½œç”¨çš„çº¯å‡½æ•°.å‘å±å¹•è¾“å‡ºæ„å‘³ç€ä¿®æ”¹äº†å¤–éƒ¨å˜é‡.å°±åƒå°†IPv6æ•°æ®åŒ…æ‰“åŒ…æˆIPv4æ•°æ®åŒ…ä»¥é€šè¿‡IPv4ç¯å¢ƒä¸€æ ·.<code>Haslell</code>é‡‡å–äº†ç±»ä¼¼"éš§é“"çš„æ–¹æ³•è§£å†³è¿™ä¸€é—®é¢˜ğŸª†</p><ul><li>å°†éœ€è¦è¾“å‡ºçš„æ•°æ®"åŒ…è£…"æˆä¸€ç§ç‰¹æ®Šçš„ç±»å‹é€å‡ºå‡½æ•°,è¿™ä¸ªç‰¹æ®Šçš„ç±»å‹å¯ä»¥ä¸éçº¯å‡½æ•°ç¯å¢ƒæ¥è§¦,éçº¯å‡½æ•°ç¯å¢ƒä¸­å‡½æ•°è·å–åŒ…è£…ä¸­çš„æ•°æ®å¹¶è¾“å‡º</li><li>åœ¨è·å–è¾“å…¥æ—¶, éçº¯å‡½æ•°ç¯å¢ƒå°†æ•°æ®"åŒ…è£…"ä¸ºç‰¹æ®Šç±»å‹,å°†ç‰¹æ®Šç±»å‹æ•°æ®ä¼ å…¥<code>Haskell</code>,<code>Haskell</code>å–å‡ºå…¶å†…éƒ¨çš„æ•°æ®</li></ul><h4 id="åŸºç¡€ioå‡½æ•°">åŸºç¡€IOå‡½æ•°</h4><ul><li><p><strong><code>main</code>&amp;<code>do</code>æ–¹æ³•</strong>ğŸ“‡</p><p>é¦–å…ˆè¦äº†è§£çš„æ˜¯<code>main</code>,<strong>æ‰€æœ‰IOç›¸å…³åŠ¨ä½œéƒ½å¿…é¡»ç›´æ¥æˆ–é—´æ¥ç»‘å®šåœ¨<code>main</code>å‡½æ•°ä¸Šæ‰ä¼šè¢«æ‰§è¡Œ</strong></p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">main &#x3D; putStrLn &quot;hello, world&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><code>main</code>ä¸­ä¸å¯èƒ½åªç»‘å®šä¸€ä¸ªIOå‡½æ•°,å¯ä»¥ä½¿ç”¨<code>do</code>å¯ä»¥é“¾æ¥ä¸€ä¸²IOæŒ‡ä»¤</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">main &#x3D; do    putStrLn &quot;Hello&quot;    putStrLn &quot;Helloha&quot;    putStrLn &quot;nihao&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å°†æ‰€æœ‰IOéƒ½ç›´æ¥å†™åœ¨<code>main</code>ä¸Šæ˜¯åœ¨æœ‰ç‚¹å†—é•¿,æˆ‘ä»¬å¯ä»¥é—´æ¥ç»‘å®šIOå‡½æ•°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">main &#x3D; do  putStrLn &quot;hi&quot;  name &lt;- getLine  demo namedemo name &#x3D; putStrLn (&quot;Hi &quot; ++ name ++ &quot; !&quot;)demo2 &#x3D; putStrLn &quot;hiii&quot; -- æ²¡ç»‘åœ¨mainä¸Šå°±ä¸æ‰§è¡Œ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>"åŒ…è£…"çš„ç±»å‹</strong>ğŸ</p><ul><li><p>è™½ç„¶å¹¶ä¸çŸ¥é“IOå‡½æ•°æœ‰é‚£äº›,ä½†æ˜¯éšéšçº¦çº¦è¿˜æ˜¯çŸ¥é“ä¸Šé¢çš„<code>putStrLn</code>æ˜¯ç”¨æ¥è¾“å‡ºçš„,å°è¯•çœ‹çœ‹å…¶åŒ…è£…çš„ç±»å‹</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; :t putStrLnputStrLn :: String -&gt; IO ()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>æ”¶å…¥ä¸€ä¸ª<code>String</code>,å¾—åˆ°ä¸€ä¸ª<code>IO ()</code>ç±»å‹(<code>IO action</code>),è¿™é‡Œçš„<code>IO</code>å°±æ˜¯åŒ…è£…, åé¢æ¥ç€ä¸€ä¸ªç©ºTuple, ä½œä¸ºä¸€ä¸ªè¾“å‡ºå‡½æ•°,æˆ‘ä»¬å°†æ•°æ®æ”¾åœ¨ç›’å­é‡Œé¢è¾“å‡º, å¤–éƒ¨ç¯å¢ƒæ¥å—å¹¶æ‹¿èµ°æ•°æ®,è¿™ä¸ªåŒ…è£…é‡Œé¢å°±æˆç©ºçš„äº†, æ‰€ä»¥è¿”å›ä¸€ä¸ªç©ºåŒ…è£…</p></li><li><p>è™½ç„¶å¹¶ä¸çŸ¥é“IOå‡½æ•°æœ‰é‚£äº›,ä½†æ˜¯éšéšçº¦çº¦è¿˜æ˜¯çŸ¥é“ä¸Šé¢çš„<code>getLine</code>æ˜¯ç”¨æ¥è¾“å…¥çš„,å°è¯•çœ‹çœ‹å…¶åŒ…è£…çš„ç±»å‹</p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; :t getLinegetLine :: IO String<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>æ²¡æ¯›ç—…, å°±æ˜¯ä¸€ä¸ªIOåŒ…è£…, åŒ…è£…å†…æ˜¯ä¸€ä¸ª<code>String</code>.</p><p>é‚£ä¹ˆå¦‚ä½•è·å–åŒ…è£…ä¸­çš„æ•°æ®å‘¢? ,ä½¿ç”¨<code>&lt;-</code>ç¬¦å·å°†åŒ…è£…ç±»å‹<code>IO String</code>è§£åŒ…ä¸º<code>String</code>,<strong>æ³¨æ„: <code>&lt;-</code>ç¬¦å·åªèƒ½ç”¨äº<code>do</code>è¯­å¥,è¿™ä¿è¯äº†ä¸çº¯ç²¹çš„ä¸œè¥¿åªå­˜åœ¨äºdoä¸­</strong></p></li><li><p><code>main</code>çš„ç±»å‹:<code>main</code>çš„ç±»å‹ä¸º<code>do</code>çš„æœ€åä¸€æ¡æŒ‡ä»¤å†³å®š,è€Œ<code>do</code>è¿”å›ç±»å‹å¿…é¡»æ˜¯<code>IO *</code></p><p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">main &#x3D; do  putStrLn &quot;hi&quot;       -- ğŸ‘, ç±»å‹ä¸ºIO ()main &#x3D; do  putStrLn &quot;hi&quot;  getLine             -- ğŸ‘, ç±»å‹ä¸ºIO Stringmain &#x3D; do  putStrLn &quot;hi&quot;  name &lt;- getLine     -- ğŸ‘, ç±»å‹ä¸ºString<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul></li><li><p><code>let binding</code></p><p>åœ¨å‡½æ•°ä¸­,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>where</code>/<code>let-in</code>æŒ‡å®šå±€éƒ¨å‡½æ•°,ä½†æ˜¯åœ¨<code>do</code>è¯­å¥ä¸­æˆ‘ä»¬åªèƒ½ä½¿ç”¨<code>let</code>(å› ä¸º<code>do</code>æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼)</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import Data.Charmain &#x3D; do    putStrLn &quot;What&#39;s your first name?&quot;    firstName &lt;- getLine    putStrLn &quot;What&#39;s your last name?&quot;    lastName &lt;- getLine    let bigFirstName &#x3D; map toUpper firstName        bigLastName &#x3D; map toUpper lastName    putStrLn $ &quot;hey &quot; ++ bigFirstName ++ &quot; &quot; ++ bigLastName ++ &quot;, how are you?&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong><code>do-block</code>ä¸<code>return</code></strong></p><p>ä»¥ä¸‹å‡½æ•°å®ç°äº†ä¸æ–­ä»Terminalè¯»å–å­—ç¬¦ä¸², å¹¶å°†å¥å­ä¸­çš„å•è¯åè½¬</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">main &#x3D; do    line &lt;- getLine    if null line        then return ()        else do            putStrLn $ reverseWords line            mainreverseWords :: String -&gt; StringreverseWords &#x3D; unwords . map reverse . words<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>å¯ä»¥çœ‹åˆ°<code>main</code>ä¹Ÿå¯ä»¥é€’å½’è°ƒç”¨,ä½†æ˜¯åœ¨è¿™ä¸ª<code>else</code>è¯­å¥ä¸­æˆ‘ä»¬é¡ºåºè°ƒç”¨äº†ä¸¤ä¸ªè¯­å¥,æ‰€ä»¥åº”è¯¥ç”¨<code>do</code>åŒ…èµ·æ¥</p></li><li><p>æ³¨æ„<code>line=null</code>åçš„<code>then return ()</code>,è¿™ä¸ª<code>return</code>çš„ä½œç”¨æ˜¯<strong>ä½¿ç”¨ä¸€ä¸ª<code>pure value</code>æ„é€ ä¸€ä¸ª<code>IO action</code></strong>,ä¹Ÿå°±æ˜¯è¯´è¿™é‡Œ<code>return ()</code>åªæ˜¯æ„é€ äº†ä¸€ä¸ª<code>IO Action ()</code>,ä½œä¸º<code>do-block</code>çš„æœ€åä¸€å¥,<code>IO Action ()</code>æˆä¸ºäº†è¿”å›å€¼</p></li><li><p>è°¨è®°:<code>return</code>å‡½æ•°åªæ˜¯æ„é€ äº†ä¸€ä¸ª<code>IO Action</code>,ç»ä¸æ˜¯å‘½ä»¤å¼ç¼–ç¨‹ä¸­çš„åœæ­¢è§£æè¿”å›,ä¸‹é¢çš„ä»£ç ä¼šè¿”å›<code>IO ()</code>(å› ä¸º<code>putStrLn</code>)</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">main &#x3D; do    return ()    return &quot;HAHAHA&quot;    line &lt;- getLine    return &quot;BLAH BLAH BLAH&quot;    return 4    putStrLn line<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>å¸¸è§IOå‡½æ•°</p><ul><li><code>putStrLn string</code>å°†<code>string</code>æ‰“å°åœ¨Terminalä¸­å¹¶<strong>æ¢è¡Œ</strong></li><li><code>putStr string</code> è·Ÿ <code>putStrLn</code> åªæ˜¯ä¸æ¢è¡Œ</li><li><code>putChar char</code> æ¥å—ä¸€ä¸ªå­—ç¬¦ï¼Œå¹¶å›ä¼ ä¸€ä¸ª<code>IO action</code> å°†ä»–æ‰“å°åˆ°ç»ˆç«¯ä¸Š</li><li><code>print</code>æ¥å—<code>Show</code>ç±»å‹çš„å€¼ï¼Œè°ƒç”¨<code>show</code> æ¥å°†å€¼å˜æˆå­—ä¸²ç„¶åå°†å…¶è¾“å‡ºåˆ°ç»ˆç«¯ä¸Š. åŸºæœ¬ä¸Š, ä»–å°±æ˜¯<code>putStrLn . show</code></li><li><code>getChar</code> æ˜¯ä¸€ä¸ªä»è¾“å…¥è¯»è¿›ä¸€ä¸ªå­—ç¬¦çš„<code>IO action</code></li><li><code>when</code>ä¼ å…¥<code>Bool</code>ä¸<code>IO Action</code>,è‹¥ä¸º<code>True</code>åˆ™å›ä¼ <code>IO Action</code>,ä¸º<code>False</code>åˆ™å›ä¼ <code>IO ()</code></li></ul></li><li><p>IOå‡½æ•°ä¸­çš„"<code>Functor</code>"</p><ul><li><p><code>sequence</code>:æ¥æ”¶<code>IO Action</code>çš„<code>List</code>,ä¾æ¬¡æ‰§è¡Œå¹¶è¿”å›<code>IO è¿”å›å€¼çš„List</code>å³:<code>[IO a] -&gt; IO [a]</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">main &#x3D; do  xs &lt;- sequence [getLine, getLine, getLine]  print xs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è®°å¾—, <code>sequence</code>è¿”å›çš„æ˜¯<code>IO [a]</code>,æ‰€ä»¥è¿˜ç”¨<code>&lt;-</code>è¿”å›</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">main &#x3D; do  xs &lt;- sequence . map print $ [1 .. 3]  print xs        -- [(),(),()] printè¿”å›çš„æ˜¯ç©ºTuple, è¿™é‡Œä¹Ÿæ˜¯<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p><code>mapM</code>ç›¸å½“äºå…ˆ<code>map</code>å†<code>sequence</code>.å³</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">main &#x3D; do  xs &lt;- mapM print [1, 2, 3]  print xs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç›¸å½“äº</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">main &#x3D; do  xs &lt;- mapM&#39; print [1, 2, 3]  print xsmapM&#39; :: (a -&gt; IO b) -&gt; [a] -&gt; IO [b]mapM&#39; f &#x3D; (sequence . map f)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>mapM_</code>å°±æ˜¯è¿”å›ä¸º<code>return ()</code>çš„<code>mapM</code></p></li><li><p><code>forever</code>æ˜¯<code>Monad</code>çš„æ–¹æ³•,å…¶æ¥æ”¶ä¸€ä¸ª<code>IO Action</code>å¹¶æ­»å¾ªç¯æ‰§è¡Œ, å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import Control.Monad.Logic (forever)import Unicode.Char (toUpper)main &#x3D; forever $ do  t &lt;- getLine  putStrLn $ map toUpper t<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç­‰ä»·äº</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import Control.Monad.Logic (forever)import Unicode.Char (toUpper)main &#x3D; do  t &lt;- getLine  putStrLn $ map toUpper t  main<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>forM</code>æ˜¯<code>Monad</code>çš„æ–¹æ³•,<code>forM</code>ä¹‹äº<code>forever</code>ç›¸å½“äº<code>mapM</code>ä¹‹äº<code>sequence</code>.ä½œç”¨æ˜¯å…ˆMap, å†å¯¹æ¯ä¸€é¡¹æ‰§è¡Œå‡½æ•°.</p><p>å®ç°è¾“å…¥å››ä¸ªå­—ç¬¦ä¸²å¹¶è¾“å‡º</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import Control.Monadmain &#x3D; do    colors &lt;- forM [1,2,3,4] (\a -&gt; do        putStrLn $ &quot;Which color do you associate with the number &quot; ++ show a ++ &quot;?&quot;        color &lt;- getLine        return color)    putStrLn &quot;The colors that you associate with 1, 2, 3 and 4 are: &quot;    mapM putStrLn colors<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç­‰ä»·äº</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">main &#x3D; do  t &lt;-    forM&#39;      [1, 2, 3, 4]      ( \a -&gt; do          putStrLn $ show a ++ &quot;: &quot;          i &lt;- getLine          return i      )  mapM putStrLn tforM&#39; (x : xs) f &#x3D; f x : forM&#39; xs fforM&#39; [] _ &#x3D; []<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><h4 id="æ–‡ä»¶ä¸å­—ç¬¦æµ">æ–‡ä»¶ä¸å­—ç¬¦æµ</h4><ul><li><p><code>getContents</code>:ä»Terminalè¯»å–<code>String</code>ç›´åˆ°<code>EOF</code>,ä¸”<code>getContents</code>æ˜¯æƒ°æ€§çš„, éœ€è¦å¤šå°‘ä»å†…å­˜ä¸­æ‹¿å¤šå°‘,ä¹‹å‰<code>forever</code>å¤§å†™çš„ç¨‹åºå¯ä»¥æ”¹æˆ</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import Unicode.Char (toUpper)main &#x3D; do  t &lt;- getContents  putStrLn $ map toUpper t<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ­£å› ä¸ºæ˜¯æƒ°æ€§çš„,æˆ‘ä»¬å¯ä»¥åˆ†æ‰¹è¾“å…¥å†…å®¹(åªæœ‰åœ¨<code>map</code>çš„æ—¶å€™æ‰ä¼šè°ƒå…¥)ğŸ«—</p></li><li><p>è¯»å†™æ–‡ä»¶ğŸ“„</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import System.IOmain &#x3D; do    handle &lt;- openFile &quot;girlfriend.txt&quot; ReadMode    contents &lt;- hGetContents handle    putStr contents    hClose handle<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­,<code>openFile</code>è·å–æ–‡ä»¶Handle(å¯ä»¥ç†è§£æˆä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆåŠå…¶<code>Context</code>)ç±»å‹å®šä¹‰</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">openFile :: FilePath -&gt; IOMode -&gt; IO Handle<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>IOMode</code>æè¿°äº†æ–‡ä»¶è¯»å†™çš„æ¨¡å¼, å®šä¹‰</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data IOMode &#x3D; ReadMode | WriteMode | AppendMode | ReadWriteMode<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>FilePath</code>å®šä¹‰</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">type FilePath &#x3D; String<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>openFile</code>è¿”å›<code>IO Handle</code>,ä¹‹åä½¿ç”¨<code>hGetContents</code>å°†æ–‡ä»¶Handleä¸­æ•°æ®å–å‡ºå¾—åˆ°<code>IO String</code>.<code>hGetContents</code>ä¸<code>getContents</code>ç±»ä¼¼, ä¹Ÿæ˜¯Lazyçš„,åœ¨è¯»å–æ–‡ä»¶æ—¶å¹¶ä¸ä¼šå°†æ–‡ä»¶å…¨éƒ¨è¯»å…¥å†…å­˜.æ–‡ä»¶æ“ä½œç»“æŸåä½¿ç”¨<code>hClose</code>å…³é—­æ–‡ä»¶</p></li><li><p>å¦ä¸€ç§è¯»å†™æ–‡ä»¶çš„æ–¹å¼æ˜¯<code>withFile</code>, å®šä¹‰</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">withFile :: FilePath -&gt; IOMode -&gt; (Handle -&gt; IO a) -&gt; IO a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å³: æ¥æ”¶ä¸¤ä¸ªå‚æ•°ä¸æ–‡ä»¶å¤„ç†å‡½æ•°, æœ€åè¿”å›ä¸€ä¸ª<code>IO</code>, ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import System.IOmain &#x3D; do    withFile &quot;girlfriend.txt&quot; ReadMode (\handle -&gt; do            contents &lt;- hGetContents handle            putStr contents)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¹æ˜“å®ç°<code>withFile</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">withFile&#39; :: FilePath -&gt; IOMode -&gt; (Handle -&gt; IO a) -&gt; IO awithFile&#39; path mode f &#x3D; do    handle &lt;- openFile path mode    result &lt;- f handle    hClose handle    return result<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ä¸<code>hGetContents</code>æ¯”èµ·æ¥æ›´åŠ å®¹æ˜“çš„æ–‡ä»¶è¯»å…¥å‡½æ•°æœ‰<code>hGetLine</code>,<code>hPutStr</code>, <code>hPutStrLn</code>, <code>hGetChar</code>,ä»–ä»¬éƒ½æ¥å—ä¸€ä¸ª<code>IO Handle</code>,è¡Œä¸ºä¸å»æ‰<code>h</code>å‰ç¼€å‡½æ•°ç›¸åŒ</p></li><li><p>ä¹Ÿå¯ä»¥çœç•¥<code>IO Handle</code>ä¸<code>hClose</code>ä½¿ç”¨å¦‚ä¸‹<code>readFile</code>,<code>writeFile</code>, <code>appendFile</code>å‡½æ•°è¯»å†™æ–‡ä»¶</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import System.IOmain &#x3D; do    contents &lt;- readFile &quot;girlfriend.txt&quot;    putStr contents<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import System.IOmain &#x3D; do    contents &lt;- readFile &quot;girlfriend.txt&quot;    writeFile &quot;girlfriendcaps.txt&quot; &quot;123456&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import System.IOmain &#x3D; do    todoItem &lt;- getLine      -- getLine ä¸åŒ…å«å›è½¦    appendFile &quot;todo.txt&quot; (todoItem ++ &quot;\n&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>IOå‡½æ•°æ˜¯æƒ°æ€§çš„, å¯ä»¥æ‰‹åŠ¨ä½¿ç”¨<code>hSetBuffering</code>é…ç½®buffer,ç±»å‹å®šä¹‰æˆ‘iå“¦</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">hSetBuffering -&gt; IO Handle -&gt; BufferMode<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å…¶ä¸­</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">type BufferMode &#x3D; NoBuffering | LineBuffering | BlockBuffering (Maybe Int)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æœ€åä¸€é¡¹è¡¨ç¤ºBufferå¤§å°ä¸ºå¤šå°‘Byte</p></li><li><p><code>openTempFile</code>å‡½æ•°å¯ä»¥åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºå¹¶æ‰“å¼€ä¸€ä¸ªéšæœºåå­—çš„æ–‡ä»¶,ç”¨äºæš‚å­˜æ•°æ®</p></li></ul><h4 id="å‘½ä»¤è¡Œå‚æ•°">å‘½ä»¤è¡Œå‚æ•°</h4><p><code>System.Environment</code>çš„<code>getArgs</code>ä¸<code>getProgName</code>å®šä¹‰äº†å‘½ä»¤è¡Œç›¸å…³å‚æ•°</p><ul><li><p><code>getArgs</code>è¿”å›å‚æ•°æ•°ç»„,æœ€åä¸€ä¸ªå…ƒç´ æ˜¯æ‰€æœ‰å‚æ•°String</p></li><li><p><code>getProgName</code>è¿”å›ç¨‹åºå, ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import System.Environmentimport Data.Listmain &#x3D; do    args &lt;- getArgs    progName &lt;- getProgName    putStrLn &quot;The arguments are:&quot;    mapM putStrLn args    putStrLn &quot;The program name is:&quot;    putStrLn progName<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">$ .&#x2F;arg-test first second w00t &quot;multi word arg&quot;The arguments are:firstsecondw00tmulti word argThe program name is:arg-test<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="å‡½æ•°å¼åœ°è§£å†³é—®é¢˜">å‡½æ•°å¼åœ°è§£å†³é—®é¢˜</h3><p>ä¸€ä¸ªä¸é”™çš„æ€è€ƒæ€è·¯æ˜¯</p><ol type="1"><li>æ˜ç¡®æˆ‘ä»¬è¾“å…¥ä¸è¾“å‡ºçš„æ•°æ®ç±»å‹</li><li>å¿˜æ‰<code>Haskell</code>, æƒ³æƒ³æˆ‘ä»¬è‡ªå·±æ˜¯æ€ä¹ˆä¸€æ­¥æ­¥è§£é¢˜çš„</li><li>æ€è€ƒå¦‚ä½•åœ¨<code>Haskell</code>ä¸­è¡¨è¾¾æˆ‘ä»¬çš„æ•°æ®,åº”è¯¥å¦‚ä½•å®šä¹‰æˆ‘ä»¬çš„è¡Œä¸º</li><li>åœ¨ Haskell ä¸­è¦å¦‚ä½•å¯¹è¿™äº›æ•°æ®åšè¿ç®—æ¥äº§ç”Ÿå‡ºè§£ç­”</li></ol><h4 id="æ±‚è§£é€†æ³¢å…°è¡¨è¾¾å¼">æ±‚è§£é€†æ³¢å…°è¡¨è¾¾å¼</h4><p><span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3poLWNuLyVFOSU4MCU4NiVFNiVCMyVBMiVFNSU4NSVCMCVFOCVBMSVBOCVFNyVBNCVCQSVFNiVCMyU5NQ==">é€†æ³¢å…°è¡¨ç¤ºæ³•-wiki<i class="fa fa-external-link-alt"></i></span></p><p>åœ¨å‘½ä»¤å¼ç¼–ç¨‹ä¸­, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ ˆè½»æ¾å¤„ç†, åœ¨<code>Haskell</code>ä¸­,å‘ååŠ å…¥å…ƒç´ å¾ˆéº»çƒ¦, ä¸å¦‚å‘å‰åŠ å…¥å…ƒç´ </p><ol type="1"><li>æ˜ç¡®æˆ‘ä»¬è¾“å…¥ä¸è¾“å‡ºçš„æ•°æ®ç±»å‹: <code>String-&gt;Num</code></li><li>å¿˜æ‰<code>Haskell</code>, æƒ³æƒ³æˆ‘ä»¬è‡ªå·±æ˜¯æ€ä¹ˆä¸€æ­¥æ­¥è§£é¢˜çš„<ol type="1"><li>å¦‚æœæ•°å­—åˆ™å‹æ ˆ, é‡åˆ°ç¬¦å·åˆ™å¼¹ä¸¤ä¸ªå…ƒç´ , è®¡ç®—åå‹æ ˆ</li></ol></li><li>æ€è€ƒå¦‚ä½•åœ¨<code>Haskell</code>ä¸­è¡¨è¾¾æˆ‘ä»¬çš„æ•°æ®,åº”è¯¥å¦‚ä½•å®šä¹‰æˆ‘ä»¬çš„è¡Œä¸º<ol type="1"><li>å°†<code>String</code>å˜ä¸ºä¸€ä¸ªä¸ªå…ƒç´ <code>String</code>(æ•°å­—/ç¬¦å·)çš„<code>List</code></li><li>è®¡ç®—åˆ°æœ€åå°±å¾—åˆ°äº†ä¸€ä¸ªå•å…ƒç´ <code>List</code></li><li>å–å‡ºè¿™ä¸ªå…ƒç´ </li></ol></li><li>åœ¨ Haskell ä¸­è¦å¦‚ä½•å¯¹è¿™äº›æ•°æ®åšè¿ç®—æ¥äº§ç”Ÿå‡ºè§£ç­”<ol type="1"><li>ä½¿ç”¨<code>words</code>è§£æ</li><li>ä½¿ç”¨<code>flodl</code>éå†</li><li>ä½¿ç”¨<code>guard</code>åˆ¤æ–­å…ƒç´ ç±»å‹</li><li>ä½¿ç”¨<code>x:xs</code>å‹æ ˆ</li><li>ä½¿ç”¨<code>(x:y:ys)</code>æ¨¡å¼åŒ¹é…è·å–topsä¸å‰©ä¸‹å†…å®¹</li></ol></li></ol><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">solveRPN :: (Fractional a, Read a) &#x3D;&gt; String -&gt; asolveRPN xs &#x3D; head $ foldl foldingNum [] (words xs)  where    foldingNum (x : y : ys) &quot;+&quot; &#x3D; x + y : ys    foldingNum (x : y : ys) &quot;-&quot; &#x3D; x - y : ys    foldingNum (x : xs) &quot;-&quot; &#x3D; (-x) : xs    -- åªæœ‰åŒç›®è¿ç®—åŒ¹é…å¤±è´¥æ‰ä¼šåŒ¹é…    foldingNum (x : y : ys) &quot;*&quot; &#x3D; x * y : ys    foldingNum (x : y : ys) &quot;&#x2F;&quot; &#x3D; x &#x2F; y : ys    foldingNum ys nums &#x3D; read nums : ys<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æœ€çŸ­è·¯æœç´¢">æœ€çŸ­è·¯æœç´¢</h4><p>æœ‰ä¸¤ä¸ªèµ·ç‚¹ä¸ä¸¤ä¸ªç»ˆç‚¹, ä½ å¯ä»¥æŒ‡å®šèµ·ç‚¹ä¸ç»ˆç‚¹, æ±‚èµ·ç‚¹åˆ°ç»ˆç‚¹æœ€å°å€¼</p><p>æœ‰ä¸¤æ¡ä¸»è¦é“è·¯ï¼Œä»–ä»¬ä¸­é—´æœ‰å¾ˆå¤šå°è·¯è¿æ¥å½¼æ­¤ã€‚å¦‚æœä½ è¦èµ°å°è·¯çš„è¯éƒ½ä¼šèŠ±æ‰ä¸€å®šçš„æ—¶é—´ã€‚ä½ çš„é—®é¢˜å°±æ˜¯è¦é€‰ä¸€æ¡æœ€ä½³è·¯å¾„è®©ä½ å¯ä»¥å°½å¿«å‰å¾€ç»ˆç‚¹,</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ST &#x3D;&#x3D;50&#x3D;&#x3D;+&#x3D;&#x3D;05&#x3D;&#x3D;+&#x3D;&#x3D;40&#x3D;&#x3D;+&#x3D;&#x3D;10&#x3D;&#x3D; ED        ||     ||     ||        30     20     25        ||     ||     ||ST &#x3D;&#x3D;10&#x3D;&#x3D;+&#x3D;&#x3D;90&#x3D;&#x3D;+&#x3D;&#x3D;02&#x3D;&#x3D;+&#x3D;&#x3D;8&#x3D;&#x3D; ED<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å…¥æ ¼å¼: è·¯å¾„æŒ‰ç…§è‡ªå·¦å‘å³æ¯ç»„:ä¸Šä¸‹å³çš„æ¨¡å¼è¾“å…¥(æœ€åä¸¤ä¸ªEDä¹‹é—´é•¿åº¦ä¸º0), ä¾‹å¦‚ä¸Šä¾‹</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">[50, 10, 30, 5, 90, 20, 40, 2, 25, 10, 8, 0]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol type="1"><li>æ˜ç¡®æˆ‘ä»¬è¾“å…¥ä¸è¾“å‡ºçš„æ•°æ®ç±»å‹: <code>[Num]-&gt;[Char]</code></li><li>å¿˜æ‰<code>Haskell</code>, æƒ³æƒ³æˆ‘ä»¬è‡ªå·±æ˜¯æ€ä¹ˆä¸€æ­¥æ­¥è§£é¢˜çš„<ol type="1"><li>åˆ†åˆ«è®¡ç®—æ¯èµ°åˆ°ä¸€ä¸ªä¸Šä¸‹å²”è·¯å£çš„æœ€å°è·ç¦»</li></ol></li><li>æ€è€ƒå¦‚ä½•åœ¨<code>Haskell</code>ä¸­è¡¨è¾¾æˆ‘ä»¬çš„æ•°æ®,åº”è¯¥å¦‚ä½•å®šä¹‰æˆ‘ä»¬çš„è¡Œä¸º<ol type="1"><li>æˆ‘ä»¬éœ€è¦ä¸‹ä¸€ç»„è·¯å¾„çš„ä¸Šæ–¹è·¯çº¿èŠ±è´¹, ä¸‹æ–¹è·¯çº¿èŠ±è´¹, å²”è·¯ä¹‹é—´èŠ±è´¹,åˆ°è¾¾å‰ä¸€ä¸ªä¸Šä¸‹å²”è·¯å£èŠ±è´¹, è½¬ç§»åˆ°ä¸‹ä¸€ä¸ªå²”è·¯</li></ol></li><li>åœ¨ Haskell ä¸­è¦å¦‚ä½•å¯¹è¿™äº›æ•°æ®åšè¿ç®—æ¥äº§ç”Ÿå‡ºè§£ç­”<ol type="1"><li><code>åˆ°è¾¾ä¸Šæ–¹è·¯å£èŠ±è´¹=min(å‰ä¸€ä¸ªä¸Šæ–¹è·¯å£èŠ±è´¹+ä¸Šæ–¹è·¯çº¿èŠ±è´¹, å‰ä¸€ä¸ªä¸‹æ–¹è·¯å£èŠ±è´¹+ä¸‹æ–¹è·¯çº¿èŠ±è´¹+ä¸Šä¸‹è·¯å£èŠ±è´¹)</code></li><li>åˆ°è¾¾ä¸‹æ–¹è·¯å£èŠ±è´¹åŒç†</li></ol></li></ol><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">pathGet :: (Num a, Ord a) &#x3D;&gt; [a] -&gt; a -&gt; a -&gt; [Char]pathGet (t : b : r : xs) ct cb  | cct &lt; ccb &#x3D; &#39;A&#39; : pathGet xs cct ccb  | otherwise &#x3D; &#39;B&#39; : pathGet xs cct ccb  where    cct &#x3D; min (ct + t) (cb + b + r)    ccb &#x3D; min (ct + t + r) (cb + b)pathGet _ ct cb  | ct &lt; cb &#x3D; &quot;A&quot;  | otherwise &#x3D; &quot;B&quot;res &#x3D; pathGet [50, 10, 30, 5, 90, 20, 40, 2, 25, 10, 8, 0] 0 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä»functoråˆ°monoids">ä»Functoråˆ°Monoids</h3><h4 id="functoræ˜¯ä»€ä¹ˆ">Functoræ˜¯ä»€ä¹ˆ</h4><p>åœ¨Haskellä¸­, <code>Functor</code>æ˜¯ä¸€ä¸ªç±»å‹ç±»,å…¶ä»…å®šä¹‰äº†ä¸€ä¸ª<code>fmap</code>æ–¹æ³•ç”¨äºæè¿°Typeæ˜¯å¦‚ä½•è¢«Map Overçš„.ä»€ä¹ˆæ˜¯map overå‘¢?</p><p>Haskellçš„<code>List</code>ä¸­æœ‰ä¸€ä¸ª<code>map</code>æ–¹æ³•,å…è®¸ä¼ å…¥ä¸€ä¸ªå‡½æ•°ä¸<code>List</code>,è¿”å›ä¸€ä¸ªå°†Listçš„ä¸­æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ‰§è¡Œå‡½æ•°çš„ç»“æœ.è¿™ä¸JSçš„<code>Array.map</code>ç±»ä¼¼.æ‰€ä»¥æˆ‘ä»¬å½“æ—¶è®¤ä¸º<code>Map</code>å°±æ˜¯ä¸€ä¸ªæ˜ å°„. ç„¶è€Œ,<code>Map</code>ä¸æ­¢å¯ä»¥åº”ç”¨äº<code>List</code>.<code>Map</code>å¯ä»¥ç”¨äºä»»ä½•å®šä¹‰äº†<code>fmap</code>çš„å¯¹è±¡</p><p>æˆ‘ä»¬å°†å¯¹è±¡åˆ†ä¸ºç®€å•å¯¹è±¡ä¸é«˜é˜¶å¯¹è±¡. ç®€å•å¯¹è±¡ä¹Ÿå¯ä»¥ç§°ä¹‹ä¸º"å€¼", ä¾‹å¦‚æ•°å­—,Charå°±æ˜¯ç®€å•å¯¹è±¡, æˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¹å…¶è¿›è¡Œæœ´ç´ æ“ä½œ.é«˜é˜¶å¯¹è±¡å¥½åƒä¸€ä¸ªç”¨ç›’å­åŒ…è£…è¿‡çš„å¯¹è±¡ğŸ, å›é¡¾Listçš„å®šä¹‰</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data List a &#x3D; Empty | Cons a (List a)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨è¿™é‡Œ, æˆ‘ä»¬å°†Listå½“ä½œä¸€ä¸ªæ•´ä½“. å…¶ä¸­åŒ…å«äº†ä¸€äº›ç›¸å¯¹"ç®€å•"çš„å¯¹è±¡.æˆ‘ä»¬æ— æ³•ç”¨æ™®é€šå‡½æ•°ç›´æ¥æ“ä½œè¿™äº›æ™®é€šå¯¹è±¡.ä¾‹å¦‚æˆ‘ä»¬æ²¡æ³•å¯¹ä¸€ä¸ª<code>[1,2,3]</code>è¿™ä¸ªæ•´ä½“æ‰§è¡Œ<code>(+1)</code>æ“ä½œ,å¦‚ä½•åˆºå…¥é«˜é˜¶å¯¹è±¡ğŸ¤º, è®©æ™®é€šå‡½æ•°æ“ä½œé«˜é˜¶å¯¹è±¡å†…éƒ¨çš„æ™®é€šå…ƒç´ å‘¢?å°†Typeå®šä¹‰ä¸ºä½¿ç”¨<code>Functor</code>å¹¶ä½¿ç”¨<code>fmap</code>,ä¾‹å¦‚æˆ‘æƒ³å°†<code>Maybe</code>ä¸­çš„å€¼<code>(+1)</code>:</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; t &#x3D; Just 2ghci&gt; t + 1-- &lt;interactive&gt;:2:1: error:--     â€¢ Non type-variable argument in the constraint: Num (Maybe a)--       (Use FlexibleContexts to permit this)--     â€¢ When checking the inferred type--         it :: forall &#123;a&#125;. (Num a, Num (Maybe a)) &#x3D;&gt; Maybe aghci&gt; fmap (+1) t-- Just 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Maybe</code>æ˜¯ä¸€ä¸ªé«˜é˜¶å¯¹è±¡, ä¹Ÿæ˜¯<code>Functor</code>çš„æ´¾ç”ŸType.å› æ­¤, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>fmap</code>å¯¹å†…éƒ¨å…ƒç´ è¿›è¡Œæ“ä½œ. é‚£,å…¶ä¸­<code>fmap</code>æ‹¿åˆ°å‡½æ•°ä¸<code>Maybe</code>ä¹‹åçš„è¡Œä¸ºç”±<code>Maybe</code>ç±»å‹å®šä¹‰æ—¶å®ç°(ç±»æ¯”,<code>map</code>æ‹¿åˆ°å‡½æ•°ä¸<code>List</code>ä¹‹åæ€ä¹ˆçŸ¥é“è¦å°†å‡½æ•°åº”ç”¨äºæ¯ä¸ªå…ƒç´ å‘¢?è¿™ä¹Ÿæ˜¯ç”±<code>List</code>æ´¾ç”Ÿ<code>Functor</code>æ—¶å€™å®ç°çš„)</p><p>ğŸ“Š<strong>æ€»ç»“: <code>Functor</code>æ˜¯ä¸€ä¸ªç±»å‹ç±»,å®šä¹‰äº†ä¸€ä¸ª<code>fmap</code>å‡½æ•°,è¯¥å‡½æ•°æè¿°å¦‚ä½•ç”¨ä¸€ä¸ªæ™®é€šå‡½æ•°å¯¹é«˜é˜¶å¯¹è±¡è¿›è¡Œæ“ä½œ</strong></p><p><code>fmap</code>çš„å®šä¹‰å¦‚ä¸‹</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">fmap :: (Functor f) &#x3D;&gt; (b -&gt; c) -&gt; f b -&gt; f c<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥çœ‹çœ‹<code>Maybe</code>çš„<code>Functor</code>å®ç°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">instance Functor Maybe where    fmap f (Just x) &#x3D; Just (f x)    fmap f Nothing &#x3D; Nothing<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥ä»¿åˆ¶ä¸€ä¸ª<code>List</code>çš„<code>Functor</code>å®ç°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data List&#39; a &#x3D; Empty | Cons a (List&#39; a) deriving (Show)instance Functor List&#39; where  fmap _ Empty &#x3D; Empty  fmap f (Cons x xs) &#x3D; Cons (f x) (fmap f xs)t &#x3D; fmap (+ 1) $ Cons 1 $ Cons 2 $ Cons 3 Empty<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>âš–<strong>æœ€å:<code>Functor</code>çš„<code>fmap</code>å®ç°åº”è¯¥éµå¾ªå¦‚ä¸‹æ³•åˆ™</strong></p><ul><li>å¦‚æœæˆ‘ä»¬å¯¹ functor åš map <code>id</code>ï¼Œé‚£å¾—åˆ°çš„æ–°çš„ functoråº”è¯¥è¦è·ŸåŸæ¥çš„ä¸€æ ·. å³: <code>fmap id = id</code></li><li>å…ˆå°†ä¸¤ä¸ªå‡½æ•°åˆæˆå¹¶å°†ç»“æœ<code>map over</code>ä¸€ä¸ª<code>functor</code>çš„ç»“æœ,åº”è¯¥è·Ÿå…ˆå°†ç¬¬ä¸€ä¸ªå‡½æ•°<code>map over</code>ä¸€ä¸ª<code>functor</code>ï¼Œå†å°†ç¬¬äºŒä¸ªå‡½æ•°<code>map over</code>é‚£ä¸ª<code>functor</code>çš„ç»“æœæ˜¯ä¸€æ ·çš„.å³:<code>fmap (f . g) = fmap f . fmap g</code>æˆ–<code>fmap (f . g) F = fmap f (fmap g F)</code></li></ul><h4 id="applicative-functors">Applicative Functors</h4><p>ä»”ç»†çœ‹<code>fmap</code>çš„ç±»å‹å®šä¹‰, æˆ‘ä»¬çš„å‡½æ•°åªèƒ½æ¥æ”¶ä¸€ä¸ªå‚æ•°,å¹¶è¿”å›ä¸€ä¸ªå‚æ•°. æˆ‘ä»¬æ— æ³•è®©å‡½æ•°æ¥æ”¶å¤šä¸ªå‚æ•°,ä¾‹å¦‚<code>\ x y -&gt; x + y</code></p><p>âœ¨ä¸ºæ­¤,æˆ‘ä»¬å¯ä»¥é‡‡ç”¨<code>Functors</code>çš„å‡çº§ç‰ˆ<code>Applicative Functors</code>,å³<code>Applicative</code>ç±»å‹ç±», å…¶ç±»å‹å®šä¹‰å¦‚ä¸‹</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">class (Functor f) &#x3D;&gt; Applicative f where    pure :: a -&gt; f a    (&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b    (&lt;$&gt;) :: (a -&gt; b) -&gt; f a -&gt; f b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>(Functor f) =&gt; Applicative f</code>è¯´æ˜<code>Applicative Functors</code>å¿…é¡»æ˜¯<code>Functors</code></li><li><code>pure</code>æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå€¼, è¿”å›ä¸€ä¸ªå€¼ä¸ºè¯¥ç±»å‹çš„é«˜é˜¶å¯¹è±¡</li><li><code>&lt;*&gt;</code>æ¥æ”¶ä¸€ä¸ªåŒ…è£¹ç€å‡½æ•°çš„é«˜é˜¶å¯¹è±¡,å†æ¥æ”¶ä¸€ä¸ªé«˜é˜¶å¯¹è±¡, å¾—åˆ°å¦ä¸€ä¸ªé«˜é˜¶å¯¹è±¡. çœ‹èµ·æ¥ä¸<code>fmap</code>ç±»ä¼¼,åªä¸è¿‡æ¥æ”¶çš„å‡½æ•°ç”¨é«˜é˜¶å¯¹è±¡åŒ…èµ·æ¥äº†</li><li><code>&lt;$&gt;</code>çœ‹èµ·æ¥å°±æ˜¯å‡½æ•°ä¸åŒ…å¯¹è±¡çš„<code>&lt;*&gt;</code></li></ul><p><strong>å¯ä»¥çœ‹çœ‹<code>Maybe</code>çš„<code>Applicative Functors</code>å®šä¹‰</strong></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">instance Applicative Maybe where  pure &#x3D; Just  Nothing &lt;*&gt; _ &#x3D; Nothing  (Just f) &lt;*&gt; something &#x3D; fmap f something  f &lt;$&gt; x &#x3D; fmap f x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; Just (+3) &lt;*&gt; Just 9-- Just 12ghci&gt; pure (+) &lt;*&gt; Just 3 &lt;*&gt; Just 5    -- ä¹Ÿå¯ä»¥ä½¿ç”¨pureè¿›è¡Œè½¬æ¢-- Just 8ghci&gt; (+) &lt;$&gt; Just 3 &lt;*&gt; Just 4         -- è¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨&lt;$&gt;-- Just 7ghci&gt; (++) &lt;$&gt; Just &quot;johntra&quot; &lt;*&gt; Just &quot;volta&quot;Just &quot;johntravolta&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>äºæ˜¯æˆ‘ä»¬å¯ä»¥ç”¨<code>pure f &lt;*&gt; p1 &lt;*&gt; p2 &lt;*&gt; ...</code>/<code>f &lt;$&gt; p1 &lt;*&gt; p2 &lt;*&gt; ...</code>è¿›è¡Œå¤šå‚æ•°è°ƒç”¨äº†</p><p><strong>å†çœ‹ä¸‹<code>List</code>çš„<code>Applicative Functors</code>å®šä¹‰</strong></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">instance Applicative [] where    pure x &#x3D; [x]    fs &lt;*&gt; xs &#x3D; [f x | f &lt;- fs, x &lt;- xs]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>ç¬¬ä¸€è¡Œè¿˜å¥½ç†è§£, æ”¶å…¥ä¸€ä¸ªæ™®é€šå…ƒç´ , è¿”å›å•å…ƒç´ <code>List</code></li><li>ç¬¬äºŒè¡Œè¯´<code>&lt;*&gt;</code>æ”¶å…¥ä¸¤ä¸ª<code>List</code>,ç”¨ç¬¬ä¸€ä¸ª<code>List</code>çš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œç¬¬äºŒä¸ª<code>List</code></li><li>ğŸ˜’ä¸ºä»€ä¹ˆListçš„<code>&lt;*&gt;</code>æ˜¯è¿™æ ·å®šä¹‰çš„å‘¢,ä¸ºå•¥ä¸èƒ½åƒ<code>zipWith</code>ä¸€æ ·å·¥ä½œå‘¢? ğŸ˜±è¿™æ˜¯Haskellçš„Listçš„å®šä¹‰,ä¸è¦çº ç»“...</li></ul><p>ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; [(*0),(+100),(^2)] &lt;*&gt; [1,2,3]-- [0,0,0,101,102,103,1,4,9]ghci&gt; (++) &lt;$&gt; [&quot;ha&quot;,&quot;heh&quot;,&quot;hmm&quot;] &lt;*&gt; [&quot;?&quot;,&quot;!&quot;,&quot;.&quot;]-- [&quot;ha?&quot;,&quot;ha!&quot;,&quot;ha.&quot;,&quot;heh?&quot;,&quot;heh!&quot;,&quot;heh.&quot;,&quot;hmm?&quot;,&quot;hmm!&quot;,&quot;hmm.&quot;]-- ç­‰ä»·äºghci&gt; [ x ++ y | x &lt;- [&quot;ha&quot;,&quot;heh&quot;,&quot;hmm&quot;], y &lt;- [&quot;?&quot;,&quot;!&quot;,&quot;.&quot;]]-- ç­‰ä»·äºghci&gt; [(++)] &lt;*&gt; [&quot;ha&quot;, &quot;heh&quot;, &quot;hmm&quot;] &lt;*&gt; [&quot;?&quot;, &quot;!&quot;, &quot;.&quot;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>çœ‹çœ‹<code>IO</code>çš„<code>Applicative Functors</code>å®šä¹‰</strong></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">instance Applicative IO where    pure &#x3D; return    a &lt;*&gt; b &#x3D; do        f &lt;- a        x &lt;- b        return (f x)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">main &#x3D; do    a &lt;- (++) &lt;$&gt; getLine &lt;*&gt; getLine    putStrLn $ &quot;The two lines concatenated turn out to be: &quot; ++ a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒéš¾ç†è§£çš„<code>(-&gt;) r</code>çš„<code>Applicative Functors</code></strong></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">instance Applicative ((-&gt;) r) where    pure x &#x3D; (\_ -&gt; x)    f &lt;*&gt; g &#x3D; \x -&gt; f x (g x)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>(-&gt;) r</code>è¡¨ç¤ºä¸€ä¸ªæ¥æ”¶å‚æ•°ç±»å‹ä¸º<code>r</code>çš„å‡½æ•°,ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; (\x y z -&gt; [x,y,z]) &lt;$&gt; (+3) &lt;*&gt; (*2) &lt;*&gt; (&#x2F;2) $ 5-- [8.0,10.0,2.5]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>è¿˜æœ‰ç±»ä¼¼äº<code>Zip</code>çš„<code>List</code><code>ZipList</code></strong></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">instance Applicative ZipList where        pure x &#x3D; ZipList (repeat x)        ZipList fs &lt;*&gt; ZipList xs &#x3D; ZipList (zipWith (\f x -&gt; f x) fs xs)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·çš„æ“ä½œå¾ˆæ£’,<code>&lt;*&gt;</code>å…è®¸æˆ‘ä»¬åƒä½¿ç”¨<code>zipWith</code>ä¸€æ ·ä½¿ç”¨<code>&lt;*&gt; zipList</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; getZipList $ (+) &lt;$&gt; ZipList [1,2,3] &lt;*&gt; ZipList [100,100,100]-- [101,102,103]ghci&gt; getZipList $ (+) &lt;$&gt; ZipList [1,2,3] &lt;*&gt; ZipList [100,100..]-- [101,102,103]  (zipWithè¦æ±‚ç»“æœä»¥çŸ­Listä¸ºå‡†)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>âš–<strong>æœ€å:<code>Applicative Functors</code>çš„<code>fmap</code>å®ç°åº”è¯¥éµå¾ªå¦‚ä¸‹æ³•åˆ™</strong></p><ul><li>`pure f &lt;*&gt; x = fmap f x``</li><li>`pure id &lt;*&gt; v = v``</li><li>`pure (.) &lt;<em>&gt; u &lt;</em>&gt; v &lt;<em>&gt; w = u&lt;</em>&gt; (v &lt;*&gt; w)``</li><li>`pure f &lt;*&gt; pure x = pure (f x)``</li><li><code>u &lt;*&gt; pure y = pure ($ y) &lt;*&gt; u</code></li></ul><h4 id="newtype">newtype</h4><p>å¯ä»¥é€šè¿‡<code>data</code>å£°æ˜ä¸€ä¸ª<code>Type</code>, ç„¶è€Œ,å¦‚æœæˆ‘ä»¬çš„<code>Type</code>ä¸­åªæœ‰<strong>ä¸€ä¸ªå€¼æ„é€ å­,å€¼æ„é€ å­åªæœ‰ä¸€ä¸ªå­—æ®µ</strong>, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>newtype</code>å®šä¹‰</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data ZipList a &#x3D; ZipList &#123; getZipList :: [a] &#125;-- ç­‰ä»·äºnewtype ZipList a &#x3D; ZipList &#123; getZipList :: [a] &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¼˜ç‚¹æœ‰</p><ul><li>ğŸƒâ€â™‚ï¸<code>newtype</code>æ¯”è¾ƒå¿«,Haskellä¼šå°†<code>newtype</code>ç†è§£ä¸ºç°æœ‰ç±»å‹çš„äºŒæ¬¡åŒ…è£…,åœ¨è°ƒç”¨çš„æ—¶å€™åªéœ€è¦è§£åŒ…å³å¯, æ— éœ€å…³å¿ƒå€¼åˆ°åº•åŒ¹é…åˆ°äº†å“ªä¸ªå€¼æ„é€ å­</li><li>ğŸ˜´<code>newtype</code>æ˜¯æƒ°æ€§çš„, ç±»å‹åªæœ‰åœ¨éœ€è¦çš„æ—¶å€™æ‰ä¼šè§£åŒ…,ç„¶åè®¡ç®—</li></ul><h4 id="monoids">Monoids</h4><p><code>Monoids</code>çš„æ„æ€æ˜¯ä¸­è¯‘æ˜¯å¹ºåŠç¾¤, ç›¸å…³æ•°å­¦å®šä¹‰å¦‚ä¸‹</p><ul><li><p><span class="math inline">\(G\)</span>ä¸ºéç©ºé›†åˆï¼Œå¦‚æœåœ¨<spanclass="math inline">\(G\)</span>ä¸Šå®šä¹‰çš„äºŒå…ƒè¿ç®— <em>ï¼Œæ»¡è¶³</em></p><ul><li>å°é—­æ€§: å¯¹äºä»»æ„<span class="math inline">\(a, b \in G\)</span>,æœ‰<span class="math inline">\(a * b \in G\)</span></li><li>ç»“åˆå¾‹: å¯¹äºä»»æ„<span class="math inline">\(a, b, c \in G\)</span>,æœ‰<span class="math inline">\((a*b)*c=a*(b*c)\)</span></li><li>å¹ºå…ƒ: å­˜åœ¨å¹ºå…ƒ<span class="math inline">\(e\)</span>,ä½¿å¾—å¯¹äºä»»æ„<span class="math inline">\(a\in G\)</span>, <spanclass="math inline">\(e*a=a*e=a\)</span></li><li>é€†å…ƒ: å¯¹äºä»»æ„<span class="math inline">\(a\inG\)</span>ï¼Œå­˜åœ¨é€†å…ƒ<spanclass="math inline">\(a^{-1}\)</span>ï¼Œä½¿å¾—<spanclass="math inline">\(a^{-1}*a=a*a^{-1}=e\)</span></li></ul><p>åˆ™ç§°<span class="math inline">\((G, *)\)</span>æ˜¯ç¾¤ï¼Œç®€ç§°<spanclass="math inline">\(G\)</span>æ˜¯ç¾¤</p></li><li><p>å¦‚æœä»…æ»¡è¶³å°é—­æ€§å’Œç»“åˆå¾‹, åˆ™ç§°<spanclass="math inline">\(G\)</span>æ˜¯ä¸€ä¸ªåŠç¾¤</p></li><li><p>å¦‚æœä»…æ»¡è¶³å°é—­æ€§, ç»“åˆå¾‹å¹¶ä¸”æœ‰å¹ºå…ƒ, åˆ™ç§°Gæ˜¯ä¸€ä¸ªå«å¹ºåŠç¾¤</p></li></ul><p>å†çœ‹ä¸‹<code>Monoid</code>åœ¨Haskellä¸­çš„å®šä¹‰</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">class Monoid m where    mempty :: m              -- å¸¸æ•°, è¡¨ç¤ºå¹ºå…ƒ    mappend :: m -&gt; m -&gt; m   -- å‡½æ•°, è¡¨ç¤ºå¹ºåŠç¾¤ä¸­çš„äºŒå…ƒè¿ç®—å‡½æ•°    mconcat :: [m] -&gt; m      -- å‡½æ•°, å°†ä¸€å †Monoid&quot;å‹ç¼©&quot;ä¸ºä¸€ä¸ª    mconcat &#x3D; foldr &#96;mappend&#96; mempty -- ç¼ºçœå®ç°, ä½¿ç”¨å¹ºå…ƒä½œä¸ºèµ·å§‹, ä½¿ç”¨äºŒå…ƒè¿ç®—åˆå¹¶<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­äºŒå…ƒè¿ç®—éœ€è¦æ»¡è¶³å¹ºå…ƒä¸ç»“åˆå¾‹, å³</p><ul><li><code>mempty `mappend` x = x</code></li><li><code>x `mappend` mempty = x</code></li><li><code>(x `mappend` y) `mappend` z = x `mappend` (y `mappend` z)</code></li></ul><p><strong>çœ‹çœ‹ç†Ÿæ‚‰ç±»å‹çš„<code>Monoids</code>æ˜¯å¦‚ä½•å®šä¹‰äºŒå…ƒè¿ç®—ä¸å¹ºå…ƒçš„</strong></p><ul><li><p><code>List</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">instance Monoid [a] where    mempty &#x3D; []    mappend &#x3D; (++)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>å¹ºå…ƒä¸º<code>[]</code></li><li>äºŒå…ƒè¿ç®—ä¸º<code>++</code></li></ul><p>ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; [1,2,3] &#96;mappend&#96; [4,5,6]-- [1,2,3,4,5,6]ghci&gt; (&quot;one&quot; &#96;mappend&#96; &quot;two&quot;) &#96;mappend&#96; &quot;tree&quot;-- &quot;onetwotree&quot;ghci&gt; &quot;one&quot; &#96;mappend&#96; (&quot;two&quot; &#96;mappend&#96; &quot;tree&quot;)-- &quot;onetwotree&quot;ghci&gt; &quot;one&quot; &#96;mappend&#96; &quot;two&quot; &#96;mappend&#96; &quot;tree&quot;-- &quot;onetwotree&quot;ghci&gt; &quot;pang&quot; &#96;mappend&#96; mempty-- &quot;pang&quot;ghci&gt; mconcat [[1,2],[3,6],[9]]-- [1,2,3,6,9]ghci&gt; mempty :: [a]-- []<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ•°é›†ä¸Šçš„<code>*</code>ä¸<code>+</code></p><p>Haskellå®šä¹‰äº†<code>Sum</code>ä¸<code>Product</code></p><ul><li>å¹ºå…ƒåˆ†åˆ«ä¸º<code>0</code>, <code>1</code></li><li>äºŒå…ƒè¿ç®—åˆ†åˆ«ä¸º<code>+</code>, <code>*</code></li></ul><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">newtype Product a &#x3D;  Product &#123; getProduct :: a &#125;    deriving (Eq, Ord, Read, Show, Bounded)instance Num a &#x3D;&gt; Monoid (Product a) where    mempty &#x3D; Product 1    Product x &#96;mappend&#96; Product y &#x3D; Product (x * y)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; getProduct $ Product 3 &#96;mappend&#96; Product 9-- 27ghci&gt; getProduct $ Product 3 &#96;mappend&#96; mempty-- 3ghci&gt; getProduct $ Product 3 &#96;mappend&#96; Product 4 &#96;mappend&#96; Product 2-- 24ghci&gt; getProduct . mconcat . map Product $ [3,4,2]-- 24<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>Any</code>ä¸<code>All</code></p><p>ç±»ä¼¼äºæ•°å­¦ä¸­çš„å­˜åœ¨ä¸ä»»æ„</p><ul><li>å¹ºå…ƒåˆ†åˆ«ä¸º<code>false</code>, <code>true</code></li><li>äºŒå…ƒè¿ç®—åˆ†åˆ«ä¸º<code>||</code>, <code>&amp;&amp;</code></li></ul><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">newtype Any &#x3D; Any &#123; getAny :: Bool &#125;    deriving (Eq, Ord, Read, Show, Bounded)instance Monoid Any where    mempty &#x3D; Any False    Any x &#96;mappend&#96; Any y &#x3D; Any (x || y)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">newtype All &#x3D; All &#123; getAll :: Bool &#125;        deriving (Eq, Ord, Read, Show, Bounded)instance Monoid All where        mempty &#x3D; All True        All x &#96;mappend&#96; All y &#x3D; All (x &amp;&amp; y)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; getAny $ Any True &#96;mappend&#96; Any False-- Trueghci&gt; getAny $ mempty &#96;mappend&#96; Any True-- Trueghci&gt; getAny . mconcat . map Any $ [False, False, False, True]-- Trueghci&gt; getAny $ mempty &#96;mappend&#96; mempty-- Falseghci&gt; getAll $ mempty &#96;mappend&#96; All True-- Trueghci&gt; getAll $ mempty &#96;mappend&#96; All False-- Falseghci&gt; getAll . mconcat . map All $ [True, True, True]-- Trueghci&gt; getAll . mconcat . map All $ [True, True, False]-- False<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>Maybe</code></p><ul><li>å¹ºå…ƒä¸º<code>Nothing</code></li><li>äºŒå…ƒè¿ç®—è§ä¸‹</li></ul><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">instance Monoid a &#x3D;&gt; Monoid (Maybe a) where    mempty &#x3D; Nothing    Nothing &#96;mappend&#96; m &#x3D; m    m &#96;mappend&#96; Nothing &#x3D; m    Just m1 &#96;mappend&#96; Just m2 &#x3D; Just (m1 &#96;mappend&#96; m2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; Nothing &#96;mappend&#96; Just &quot;andy&quot;-- Just &quot;andy&quot;ghci&gt; Just LT &#96;mappend&#96; Nothing-- Just LTghci&gt; Just (Sum 3) &#96;mappend&#96; Just (Sum 4)-- Just (Sum &#123;getSum &#x3D; 7&#125;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>çœ‹çœ‹<code>Monoids</code>ä¸­çš„<code>mconcat</code>æœ‰ä»€ä¹ˆç”¨</strong></p><p>ä¸<code>fmap</code>ç±»ä¼¼çš„ä½¿ç”¨æ–¹å¼, å…¶ä½¿ç”¨<code>fold*</code>è°ƒç”¨,åªä¸è¿‡è¿™ä¸ª<code>fold*</code>å¹¶éprecludeçš„<code>List.fold*</code>,éœ€è¦æ‰‹åŠ¨å¼•å…¥</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import qualified Foldable as Fghci&gt; :t F.foldr-- F.foldr :: (F.Foldable t) &#x3D;&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¾‹å¦‚<code>Maybe</code>çš„<code>fold*</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; F.foldl (+) 2 (Just 9)-- 11ghci&gt; F.foldr (||) False (Just True)-- True<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>âš–<strong>æœ€å: <code>Monad</code>å®ç°åº”è¯¥éµå¾ªå¦‚ä¸‹æ³•åˆ™</strong></p><ul><li><code>retrun x &gt;&gt;= f</code>åº”è¯¥ç­‰äº <code>f x</code></li><li><code>m &gt;&gt;= return</code> ä¼šç­‰äº <code>m</code></li><li><code>(m &gt;&gt;= f) &gt;&gt;= g</code> è·Ÿ<code>m &gt;&gt;= (\x -&gt; f x &gt;&gt;= g)</code> æ˜¯ç›¸ç­‰çš„</li></ul><h3 id="monadåº”ç”¨">Monadåº”ç”¨</h3><p><code>Monad</code>å°è£…äº†é«˜é˜¶å¯¹è±¡ä¹‹é—´çš„è®¡ç®—ä¸è½¬æ¢æ–¹å¼,ä»è€Œä½¿é«˜é˜¶å¯¹è±¡å¯ä»¥è¢«è½»æ˜“çš„ç”¨æœ´ç´ çš„æ–¹æ³•æ“ä½œ</p><h4 id="monadä¸Šçš„æ–¹æ³•"><code>Monad</code>ä¸Šçš„æ–¹æ³•</h4><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">class Monad m where    return :: a -&gt; m a    (&gt;&gt;&#x3D;) :: m a -&gt; (a -&gt; m b) -&gt; m b    (&gt;&gt;) :: m a -&gt; m b -&gt; m b    x &gt;&gt; y &#x3D; x &gt;&gt;&#x3D; \_ -&gt; y    fail :: String -&gt; m a    fail msg &#x3D; error msg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>return</code>ä¸<code>Applicative</code>ä¸­çš„<code>pure</code>ç±»ä¼¼</li><li><code>&gt;&gt;=</code>å‡½æ•°,æ¥å—ä¸€ä¸ª<code>Monad</code>ä¸ä¸€ä¸ªæ™®é€šå€¼åˆ°<code>Monad</code>çš„å‡½æ•°,è¿”å›ä¸€ä¸ª<code>Monad</code></li><li><code>&gt;&gt;</code>å‡½æ•°æ¥å—ä¸¤ä¸ª<code>Monad</code>, è¿”å›åè€…</li><li><code>fail</code>æ¥å—ä¸€ä¸ª<code>String</code>, æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸</li></ul><p>çœ‹çœ‹<code>Maybe</code>çš„<code>Monad</code>å®ç°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">instance Monad Maybe where    return x &#x3D; Just x    Nothing &gt;&gt;&#x3D; f &#x3D; Nothing    Just x &gt;&gt;&#x3D; f  &#x3D; f x    fail _ &#x3D; Nothing<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ç»´æŠ¤ä¸¤ä¸ªæ•°">ç»´æŠ¤ä¸¤ä¸ªæ•°</h4><p>æ†å­ä¸¤ç«¯æœ‰è‹¥å¹²åªé¸ŸğŸ¦, å½“å·¦å³ä¸¤ç«¯é¸Ÿæ•°å·®å°äºç­‰äº2æ—¶, æ†å­å¹³è¡¡,å¦åˆ™æ†å­å¤±è¡¡. ç»™è‹¥å¹²åŠ å‡é¸Ÿçš„æ“ä½œ, è¿”å›æ†å­çŠ¶æ€</p><p>æˆ‘ä»¬å¯ä»¥ç”¨<code>Maybe</code>çš„<code>Just</code>è¡¨ç¤ºå¹³è¡¡çŠ¶æ€,ç”¨<code>Nothing</code>è¡¨ç¤ºå¤±è¡¡</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">type Birds &#x3D; Inttype Pole &#x3D; (Birds,Birds)landLeft :: Birds -&gt; Pole -&gt; Maybe PolelandLeft n (left,right)    | abs ((left + n) - right) &lt; 4 &#x3D; Just (left + n, right)    | otherwise                    &#x3D; NothinglandRight :: Birds -&gt; Pole -&gt; Maybe PolelandRight n (left,right)    | abs (left - (right + n)) &lt; 4 &#x3D; Just (left, right + n)    | otherwise                    &#x3D; Nothing<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥ä½¿ç”¨<code>&gt;&gt;=</code>è¿ç»­è°ƒç”¨å‡½æ•°â›“</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; return (0,0) &gt;&gt;&#x3D; landRight 2 &gt;&gt;&#x3D; landLeft 2 &gt;&gt;&#x3D; landRight 2-- Just (2,4)ghci&gt; return (0,0) &gt;&gt;&#x3D; landLeft 1 &gt;&gt;&#x3D; landRight 4 &gt;&gt;&#x3D; landLeft (-1) &gt;&gt;&#x3D; landRight (-2)-- Nothing<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥ä½¿ç”¨<code>&gt;&gt;</code>ç›´æ¥è®¾ç½®çŠ¶æ€</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; return (0,0) &gt;&gt;&#x3D; landLeft 1 &gt;&gt; Nothing &gt;&gt;&#x3D; landRight 1-- Nothing<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>çœ‹æ¥<code>(&gt;&gt;=)</code>å¯ä»¥æ–¹ä¾¿çš„å®ç°ä¸€ä¸ª<code>Monad</code>è¢«å¤šä¸ªå‡½æ•°è°ƒç”¨,è€Œ<code>&lt;$&gt; ... &lt;*&gt;</code>å¯ä»¥å®ç°ä¸€ä¸ªå‡½æ•°è°ƒç”¨å¤šä¸ªå‚æ•°</strong></p><h4 id="doè¡¨ç¤ºæ³•"><code>do</code>è¡¨ç¤ºæ³•</h4><p>å¯ä»¥å°†<code>&gt;&gt;=</code>è¡¨è¾¾å¼é“¾</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">foo :: Maybe Stringfoo &#x3D; Just 3   &gt;&gt;&#x3D; (\x -&gt;      Just &quot;!&quot; &gt;&gt;&#x3D; (\y -&gt;      Just (show x ++ y)))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç”¨<code>do</code>è¯­å¥è¡¨ç¤º</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">foo :: Maybe Stringfoo &#x3D; do    x &lt;- Just 3    y &lt;- Just &quot;!&quot;    Just (show x ++ y)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹èµ·æ¥<code>do</code>å°±åƒæ˜¯å‘½ä»¤å¼å˜æˆçš„ä¸€ä¸ª<code>Block</code>,å…è®¸ç”¨æˆ·å­˜ä¸€äº›å˜é‡è¿›å», å†è¿”å›ç»“æœ,è¿™é‡Œä¹Ÿè¦é‡‡ç”¨<code>&lt;-</code>å°†å€¼ä»é«˜é˜¶å¯¹è±¡ä¸­å–å‡º</p><p>çš„ä½†æ˜¯è¿™ä¸ªå°±æ¯”è¾ƒç¦»è°±</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">routine :: Maybe Poleroutine &#x3D; do  start &lt;- return (0, 0)  first &lt;- landLeft 2 start  Nothing  second &lt;- landRight 2 first  final &lt;- landLeft 1 second  return final<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸è®º<code>return final</code>è¿˜æ˜¯<code>start</code>,<code>first</code>, <code>second</code>éƒ½æ˜¯<code>Nothing</code>...</p><p>å½“æˆ‘ä»¬åœ¨ <code>do</code> è¡¨ç¤ºæ³•å†™äº†ä¸€è¡Œè¿ç®—ï¼Œä½†æ²¡æœ‰ç”¨åˆ°<code>&lt;-</code> æ¥ç»‘å®šå€¼çš„è¯ï¼Œå…¶å®å®é™…ä¸Šå°±æ˜¯ç”¨äº†<code>&gt;&gt;</code>, ç›¸å½“äºè®¾ç½®äº†çŠ¶æ€, ä¸æ˜¯å¾ˆç†è§£</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">routine :: [Int]routine &#x3D; do  start &lt;- return 1  []  return (start + 1)-- []<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">routine :: Maybe [Int]routine &#x3D; do  start &lt;- return [1]  Just [1,2,3,4,5,6]  return (999:start)-- Just [999,1]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">main &#x3D; do  start &lt;- getLine  first &lt;- getLine  return &quot;opps&quot;  second &lt;- getLine  print start-- 1\n2\n3\n-- 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="listçš„monadå®šä¹‰"><code>List</code>çš„<code>Monad</code>å®šä¹‰</h4><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">instance Monad [] where    return x &#x3D; [x]    xs &gt;&gt;&#x3D; f &#x3D; concat (map f xs)    fail _ &#x3D; []<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸<code>Applicative</code>æœ‰äº›åŒºåˆ«, ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; (*) &lt;$&gt; [1,2,3] &lt;*&gt; [10,100,1000]-- [10,100,1000,20,200,2000,30,300,3000]ghci&gt; [3,4,5] &gt;&gt;&#x3D; \x -&gt; [x,-x]-- [3,-3,4,-4,5,-5]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="éšæœºæ•°">éšæœºæ•°</h4><p>åœ¨å‘½ä»¤å¼ç¼–ç¨‹ä¸­å¯ä»¥å€ŸåŠ©<code>random</code>ç±»ä¼¼çš„å‡½æ•°è½»æ¾å®ç°éšæœºæ•°.ç„¶è€ŒHaskellä¸­å‡½æ•°éƒ½æ˜¯çº¯å‡½æ•°,è¿™æ„å‘³ç€æ¯æ¬¡<code>random</code>çš„ç»“æœéƒ½åº”è¯¥æ˜¯å®šå€¼ğŸ˜°, ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜,Haskellå°†<code>random</code>å®šä¹‰ä¸ºäº†ä¸€ä¸ªç‰¹åˆ«çš„ç±»å‹</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">random :: (RandomGen g, Random a) &#x3D;&gt; g -&gt; (a, g)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ‘ä»¬éœ€è¦ä¼ å…¥ä¸€ä¸ª<code>RandomGen</code>ç„¶åè·å¾—ä¸€ä¸ªéšæœºæ•°<code>a</code>ä¸ä¸€ä¸ª<code>RandomGen</code>.<code>RandomGen</code>åƒæ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ğŸ§«,é€šè¿‡åŒä¸€ä¸ªç”Ÿæˆå™¨è°ƒç”¨<code>random</code>å¯ä»¥å¾—åˆ°ç›¸åŒçš„ç»“æœ.æ¯æ¬¡<code>random</code>åæˆ‘ä»¬å¯ä»¥è·å¾—ä¸€ä¸ªå…¨æ–°çš„<code>RandomGen</code>ç”¨äºä¸‹æ¬¡<code>random</code>.å¯ä»¥åˆ©ç”¨<code>mkStdGen</code>ç”Ÿæˆä¸€ä¸ª<code>RandomGen</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">mkStdGen :: Int -&gt; StdGenghci&gt; random (mkStdGen 100)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>äºæ˜¯æˆ‘ä»¬å¯ä»¥ç”Ÿæˆä¸€äº›ä¸åŒç±»å‹çš„<code>random</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; random (mkStdGen 949488) :: (Float, StdGen)-- (0.8938442,1597344447 1655838864)ghci&gt; random (mkStdGen 949488) :: (Bool, StdGen)-- (False,1485632275 40692)ghci&gt; random (mkStdGen 949488) :: (Integer, StdGen)-- (1691547873,1597344447 1655838864)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ğŸª™ç”Ÿæˆä¸‰æ¬¡æŠ•ç¡¬å¸çš„ç»“æœ</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">threeCoins :: StdGen -&gt; (Bool, Bool, Bool)threeCoins gen &#x3D;    let (firstCoin, newGen) &#x3D; random gen    (secondCoin, newGen&#39;) &#x3D; random newGen    (thirdCoin, newGen&#39;&#39;) &#x3D; random newGen&#39;    in  (firstCoin, secondCoin, thirdCoin)ghci&gt; threeCoins (mkStdGen 21)-- (True,True,True)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Haskellè¿˜æä¾›<code>randomR</code>å®šä¹‰éšæœºæ•°ä¸Šä¸‹ç•Œ</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; randomR (1,6) (mkStdGen 359353)-- (6,1494289578 40692)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¹Ÿæä¾›äº†ç”Ÿæˆæ— é™ä¸ªæœ‰é™éšæœºæ•°çš„<code>randomRs</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; take 10 $ randomRs (&#39;a&#39;,&#39;z&#39;) (mkStdGen 3) :: [Char]-- &quot;ndkxbvmomg&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="bytestring">ByteString</h4><p>åœ¨è¯»å–å¤§æ–‡ä»¶çš„æ—¶å€™<code>[Char]</code>çš„æ•ˆç‡å¾€å¾€å¾ˆä½,å¯ä»¥ä½¿ç”¨ByteString, å…¶æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ª<code>Byte</code>.å­˜åœ¨ä¸¤ä¸ª<code>ByteString</code></p><ul><li><code>strict</code>å‹: ä½äº<code>Data.ByteString</code>, éæƒ°æ€§,æ— <code>Thunk</code>, ä¿è¯äº†ä¸ä¼šå‡ºç°"over head"</li><li><code>Lazy</code>å‹: ä½äº<code>Data.ByteString.Lazy</code>,ä¿å­˜åœ¨64Kçš„chunksä¸­(è¿™ä¼¼çš„å…¶å¤§æ¦‚ç‡å¯ä»¥è¢«è£…å…¥L2 Cache)</li></ul><p>å…¶å®šä¹‰äº†æ–¹æ³•</p><ul><li><p><code>pack :: [Word8] -&gt; ByteString</code></p><p>æ¥å—ä¸€ä¸ª<code>Word8</code>æ•°ç»„, è¿”å›<code>ByteString</code>,å…¶ä¸­<code>Word8</code>å°±æ˜¯<code>0-255</code>çš„<code>Int</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import qualified Data.ByteString.Lazy as Bimport qualified Data.ByteString as Sghci&gt; B.pack [99,97,110]-- Chunk &quot;can&quot; Emptyghci&gt; B.pack [98..120]-- Chunk &quot;bcdefghijklmnopqrstuvwx&quot; Empty<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>unpack</code>ä¸<code>pack</code>ç›¸å,æŠŠä¸€ä¸ª<code>bytestring</code>å˜æˆä¸€ä¸ª<code>byte list</code></p></li><li><p><code>fromChunks</code>æ¥å—ä¸€ä¸²<code>strict</code>çš„<code>bytestrings</code>å¹¶æŠŠä»–å˜æˆä¸€ä¸²<code>lazy bytestring</code></p></li><li><p><code>toChunks</code>æ¥å—ä¸€ä¸ª<code>lazy bytestrings</code>å¹¶å°†ä»–å˜æˆä¸€ä¸²<code>strict bytestrings</code></p></li><li><p><code>ByteString</code>ä¹Ÿæ”¯æŒ<code>:</code>,å…¶ä¸­<code>B.empty</code>ç›¸å½“äº<code>[]</code></p></li></ul><h4 id="write-monad"><code>Write Monad</code></h4><p>âœï¸æˆ‘ä»¬å¸Œæœ›ç»´æŠ¤ä¸€ä¸ªçŠ¶æ€, å¹¶åœ¨æ¯æ¬¡applyå‡½æ•°çš„æ—¶å€™ä¸ºå…¶åŠ ä¸Šæ—¥å¿—,æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨<code>Write Monad</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">instance (Monoid w) &#x3D;&gt; Monad (Writer w) where    return x &#x3D; Writer (x, mempty)    (Writer (x,v)) &gt;&gt;&#x3D; f &#x3D; let (Writer (y, v&#39;)) &#x3D; f x in Writer (y, v &#96;mappend&#96; v&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import Control.Monad.Writernewtype Writer w a &#x3D; Writer &#123; runWriter :: (a, w) &#125;logNumber :: Int -&gt; Writer [String] IntlogNumber x &#x3D; Writer (x, [&quot;Got number: &quot; ++ show x])multWithLog :: Writer [String] IntmultWithLog &#x3D; do    a &lt;- logNumber 3    b &lt;- logNumber 5    return (a*b)-- ghci&gt; runWriter multWithLog-- (15,[&quot;Got number: 3&quot;,&quot;Got number: 5&quot;])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å¯ä»¥ä½¿ç”¨difference-listsæé«˜å†™logçš„æ•ˆç‡</strong></p><p>ç®€å•ç†è§£æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„Liståœ¨æ‰§è¡Œ<code>[1,2]++[3,4]</code>æ—¶æ˜¯åŒæ­¥çš„,ä½†æ˜¯<code>DiffList</code>åœ¨æ‰§è¡Œçš„æ—¶å€™æ˜¯æƒ°æ€§çš„,è¿™ä¿è¯äº†å¯ä»¥å¿«é€Ÿ<code>++</code>, åªæœ‰åœ¨è¯»å–æ—¶æ‰æ‰§è¡Œ, å®ç°ä¹Ÿå¾ˆç®€å•</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">instance Monoid (DiffList a) where    mempty &#x3D; DiffList (\xs -&gt; [] ++ xs)    (DiffList f) &#96;mappend&#96; (DiffList g) &#x3D; DiffList (\xs -&gt; f (g xs))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="reader-monad"><code>Reader Monad</code></h4><p><code>Reader Monad</code>æ˜¯å°†ä¸€ä¸ªæŸ¯é‡ŒåŒ–å‡½æ•°ä½œä¸º<code>Monad</code>å¯¹è±¡</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">instance Monad ((-&gt;) r) where    return x &#x3D; \_ -&gt; x    h &gt;&gt;&#x3D; f &#x3D; \w -&gt; f (h w) w<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="state-monad"><code>State Monad</code></h4><p><code>State Monad</code>ç”¨äºå®ç°çŠ¶æ€è½¬æ¢,ä»–ä¿å­˜äº†è®¡ç®—ç»“æœä¸ä¸‹ä¸€æ¬¡æ‰§è¡Œçš„state,ä¾‹å¦‚ä¹‹å‰éšæœºæ•°å°±ç”¨åˆ°äº†<code>State Monad</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">instance Monad (State s) where    return x &#x3D; State $ \s -&gt; (x,s)    (State h) &gt;&gt;&#x3D; f &#x3D; State $ \s -&gt; let (a, newState) &#x3D; h s                                        (State g) &#x3D; f a                                    in  g newState<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="error-monad"><code>Error Monad</code></h4><p>å°±æ˜¯<code>Either</code>çš„<code>Monad</code>å®ç°.ç›¸æ¯”<code>Maybe</code>ä»–å¯ä»¥è®°å½•é”™è¯¯ä¿¡æ¯</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">instance (Error e) &#x3D;&gt; Monad (Either e) where    return x &#x3D; Right x    Right x &gt;&gt;&#x3D; f &#x3D; f x    Left err &gt;&gt;&#x3D; f &#x3D; Left err    fail msg &#x3D; Left (strMsg msg)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å…¶ä»–monadæ–¹æ³•">å…¶ä»–<code>Monad</code>æ–¹æ³•</h4><ul><li><p><code>leftM</code>ç›¸å½“äº<code>functor</code>çš„<code>fmap</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">liftM :: (Monad m) &#x3D;&gt; (a -&gt; b) -&gt; m a -&gt; m b<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p><code>join</code>ç›¸å½“äºå»æ‰ä¸€å±‚åŒ…è£¹</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">join :: (Monad m) &#x3D;&gt; m (m a) -&gt; m a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; join (Just (Just 9))Just 9ghci&gt; join (Just Nothing)Nothingghci&gt; join NothingNothing<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>filterM</code>å°†ä¸€ä¸ª<code>List</code>è½¬æ¢ä¸ºåˆæ³•çš„<code>Monad List</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">filterM :: (Monad m) &#x3D;&gt; (a -&gt; m Bool) -&gt; [a] -&gt; m [a]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p><code>foldM</code>æŠ˜å ä¸€ä¸ª<code>List</code>å¹¶è½¬ä¸º<code>Monad</code></p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">foldM :: (Monad m) &#x3D;&gt; (a -&gt; b -&gt; m a) -&gt; a -&gt; [b] -&gt; m a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; foldl (\acc x -&gt; acc + x) 0 [2,8,3,1]-- 14<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul><h3 id="ç”¨zippersä¿å­˜çŠ¶æ€">ç”¨Zippersä¿å­˜çŠ¶æ€</h3><p>Haskellçš„å‡½æ•°æ˜¯çº¯å‡½æ•°å¼, è¿™æ„å‘³ç€å¯¹å‡½æ•°ä¼ å…¥ç›¸åŒçš„å˜é‡,å‡½æ•°ä¼šæœ‰ç›¸åŒçš„è¾“å‡º,ä½†æ˜¯æœ‰äº›æ—¶å€™æˆ‘ä»¬ä¹Ÿéœ€è¦è®°å½•æ‰§è¡Œçš„çŠ¶æ€ğŸ“¹(ä¾‹å¦‚éœ€è¦ç»´æŠ¤ä¸€ä¸ªæ ‘,ç„¶è€Œå½“æˆ‘é”å®šå¹¶ä¿®æ”¹å­æ ‘åHaskellåªèƒ½è¿”å›ä¸€ä¸ªæ–°å­æ ‘, ä¸èƒ½ä¿®æ”¹åŸæ ‘),è¿™æ—¶å¯ä»¥å®šä¹‰ä¸€ä¸ª<code>Zippers</code>æ•°æ®ç»“æ„ä¿å­˜çŠ¶æ€ğŸ¤</p><h4 id="ç»´æŠ¤äºŒå‰æœç´¢æ ‘">ç»´æŠ¤äºŒå‰æœç´¢æ ‘</h4><p>ä¹‹å‰å®šä¹‰è¿‡äºŒå‰æœç´¢æ ‘</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data Tree a &#x3D; Empty | Node a (Tree a) (Tree a) deriving (Show)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ£€ç´¢æ ‘ä¸Šå…ƒç´ æ—¶å€™éœ€è¦å‘å·¦/å‘å³/å‘ä¸Šèµ°,è€Œçº¯å‡½æ•°çš„ç‰¹æ€§è®©æˆ‘ä»¬åªèƒ½å®šä¹‰è¿™æ ·çš„å‡½æ•°</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">goLeft :: Tree a -&gt; Tree a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ‘ä»¬çš„å‡½æ•°åªèƒ½è¿”å›ä¸€ä¸ªæ ‘çš„å­æ ‘, è¿™å¯¼è‡´å®ç°å‘ä¸Šèµ°æ˜¯éå¸¸å›°éš¾çš„ğŸ¤¦â€â™‚ï¸. åŒæ—¶,å¦‚æœä¸“é—¨å­˜å‚¨åŸæ ‘, æˆ‘ä»¬å°†æ— æ³•è·å–åŸæ ‘</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">tree &#x3D; geLeft (Node 1 (Empty) (Empty))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ­¤æ—¶<code>tree</code>æ˜¯<code>Empty</code>, ä½†æ˜¯åŸæ ‘æ˜¯ä»€ä¹ˆæˆ‘ä»¬ä¸çŸ¥é“.æˆ‘ä»¬éœ€è¦å°†åŸæ ‘ä½œä¸ºçŠ¶æ€å­˜å‚¨èµ·æ¥, å¯¹äºä¸€æ£µæ ‘</p><pre class="mermaid">graph TB Root(Root_cur) --> L Root --> R</pre><p>å½“æˆ‘ä»¬è¦å°†ä½ç½®ä»Rootè½¬æ¢åˆ°Læ—¶,æˆ‘ä»¬å¯ä»¥åƒä¹‹å‰Logä¸€æ ·æŠŠ<code>Root</code>ä¸<code>R</code>å­˜å‚¨èµ·æ¥,æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ•°æ®ç»“æ„<code>Crumb</code>ğŸ¥¯,<code>LeftCrumb</code>è¡¨ç¤ºå…¶èµ°å‘äº†L,æ­¤æ—¶å­˜å‚¨äº†<code>LeftCrumb Root (Tree R)</code>, åä¹‹ç±»ä¼¼</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data Crumb a &#x3D; LeftCrumb a (Tree a) | RightCrumb a (Tree a) deriving (Show)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥å°†çŠ¶æ€ä»¬å­˜å‚¨ä¸º<code>[Crumb]</code>,ç”¨<code>Tuple</code>å­˜å‚¨å½“å‰ä½ç½®ä¸çŠ¶æ€, æœ€åå¾—åˆ°äº†</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">data Crumb a &#x3D; LeftCrumb a (Tree a) | RightCrumb a (Tree a) deriving (Show)type Breadcrumbs a &#x3D; [Crumb a]goLeft :: (Tree a, Breadcrumbs a) -&gt; (Tree a, Breadcrumbs a)goLeft (Node x l r, bs) &#x3D; (l, LeftCrumb x r:bs)    -- å½“å‰ä¸ºå·¦å­æ ‘, rootä¸å³å­æ ‘å‹å…¥BreadcrumbsgoRight :: (Tree a, Breadcrumbs a) -&gt; (Tree a, Breadcrumbs a)goRight (Node x l r, bs) &#x3D; (r, RightCrumb x l:bs)goUp :: (Tree a, Breadcrumbs a) -&gt; (Tree a, Breadcrumbs a)goUp (t, LeftCrumb x r:bs) &#x3D; (Node x t r, bs)    -- topçš„rootåšå½“å‰ä½ç½®, å±•å¼€å³å­æ ‘goUp (t, RightCrumb x l:bs) &#x3D; (Node x l t, bs)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬è¿˜, å¯ä»¥ä¸ºè¿™æ ·çš„å­˜å‚¨æ¨¡å¼èµ·ä¸ªåˆ«å</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">type Zipper a &#x3D; (Tree a, Breadcrumbs a)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æœ€åå®ç°ä¸€ä¸‹èŠ‚ç‚¹çš„ç»´æŠ¤æ“ä½œ</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">modify :: (a -&gt; a) -&gt; Zipper a -&gt; Zipper amodify f (Node x l r, bs) &#x3D; (Node (f x) l r, bs)modify f (Empty, bs) &#x3D; (Empty, bs)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ“ä½œ</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">x -: f &#x3D; f xfreeTree &#x3D; ...-- å‘å·¦, å‘å³, æ›¿æ¢ä¸ºPnewFocus &#x3D; (freeTree,[]) -: goLeft -: goRight -: modify (\_ -&gt; &#39;P&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ç»´æŠ¤list">ç»´æŠ¤<code>List</code></h4><p>å¯ä»¥å°†ä¸€ä¸ªListåˆ†ä¸º<code>cur</code>åŠå…¶å³è¾¹çš„<code>List</code>ä¸<code>cur</code>å·¦è¾¹çš„<code>List</code>çš„é€†åº</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">goForward :: ListZipper a -&gt; ListZipper agoForward (x:xs, bs) &#x3D; (xs, x:bs)goBack :: ListZipper a -&gt; ListZipper agoBack (xs, b:bs) &#x3D; (b:xs, bs)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">ghci&gt; let xs &#x3D; [1,2,3,4]ghci&gt; goForward (xs,[])-- ([2,3,4],[1])ghci&gt; goForward ([2,3,4],[1])-- ([3,4],[2,1])ghci&gt; goForward ([3,4],[2,1])-- ([4],[3,2,1])ghci&gt; goBack ([4],[3,2,1])-- ([3,4],[2,1])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ç»´æŠ¤ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ">ç»´æŠ¤ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ</h4><p>ğŸ“ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿå°±æ˜¯ä¸€ä¸ªå¤šå‰æ ‘, æ ‘ä¸Šæœ‰ä¸¤ç§ç±»å‹(æ–‡ä»¶ä¸æ–‡ä»¶å¤¹),ä»–ä»¬éƒ½æœ‰æ–‡ä»¶(å¤¹)å, æ–‡ä»¶å¤¹ä¸­åº”è¯¥è¿˜åŒ…å«ä¸€é¢—å­æ ‘,æ–‡ä»¶ä¸­åº”è¯¥åŒ…å«æ–‡ä»¶ä¸­çš„æ•°æ®</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">import Data.List (break)type Name &#x3D; Stringtype Data &#x3D; String-- ä¸€ä¸ªæ–‡ä»¶&#x2F;æ–‡ä»¶å¤¹data FSItem &#x3D; File Name Data | Folder Name [FSItem] deriving (Show)-- ä¸Šå±‚æ–‡ä»¶å¤¹å æ–‡ä»¶å¤¹ä¸­è¯¥æ–‡ä»¶å‰é¢çš„æ–‡ä»¶ æ–‡ä»¶å¤¹ä¸­è¯¥æ–‡ä»¶ä¹‹åçš„æ–‡ä»¶data FSCrumb &#x3D; FSCrumb Name [FSItem] [FSItem] deriving (Show)type FSZipper &#x3D; (FSItem, [FSCrumb])-- å‘ä¸Šèµ°å°±æ˜¯å°†ä»–å‰åçš„æ–‡ä»¶å’Œä»–åˆåœ¨ä¸€èµ·fsUp :: FSZipper -&gt; FSZipperfsUp (item, FSCrumb name ls rs:bs) &#x3D; (Folder name (ls ++ [item] ++ rs), bs)-- è¿›å…¥æ–‡ä»¶å¤¹fsTo :: Name -&gt; FSZipper -&gt; FSZipperfsTo name (Folder folderName items, bs) &#x3D;  let (ls, item:rs) &#x3D; break (nameIs name) items  in  (item, FSCrumb folderName ls rs:bs)-- åˆ¤æ–­æ–‡ä»¶(å¤¹)ånameIs :: Name -&gt; FSItem -&gt; BoolnameIs name (Folder folderName _) &#x3D; name &#x3D;&#x3D; folderNamenameIs name (File fileName _) &#x3D; name &#x3D;&#x3D; fileName-- é‡å‘½åæ–‡ä»¶fsRename :: Name -&gt; FSZipper -&gt; FSZipperfsRename newName (Folder name items, bs) &#x3D; (Folder newName items, bs)fsRename newName (File name dat, bs) &#x3D; (File newName dat, bs)-- æ–°å»ºæ–‡ä»¶fsNewFile :: FSItem -&gt; FSZipper -&gt; FSZipperfsNewFile item (Folder folderName items, bs) &#x3D;    (Folder folderName (item:items), bs)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¾‹å¦‚</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">-- myDisk &#x3D; ...ghci&gt; let newFocus &#x3D; (myDisk,[]) -: fsTo &quot;pics&quot; -: fsTo &quot;skull_man(scary).bmp&quot;ghci&gt; fst newFocus        -- æ˜¾ç¤ºFSItem-- File &quot;skull_man(scary).bmp&quot; &quot;Yikes!&quot;ghci&gt; let newFocus2 &#x3D; (myDisk,[]) -: fsTo &quot;pics&quot; -: fsRename &quot;cspi&quot; -: fsUp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ğŸ§—<strong>æœ€å, æ³¨æ„è€ƒè™‘è¾¹ç•Œ, ä¸ºæˆ‘ä»¬çš„å‡½æ•°è®¾ç½®å…œåº•æ¡ä»¶,<code>Maybe</code>å¯ä»¥ç”¨äºè¡¨ç¤ºç»™å‡ºçš„åŠ¨ä½œæ˜¯å¦åˆæ³•</strong>, ä¾‹å¦‚:</p><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell">goUp :: Zipper a -&gt; Maybe (Zipper a)goUp (t, LeftCrumb x r:bs) &#x3D; Just (Node x t r, bs)goUp (t, RightCrumb x l:bs) &#x3D; Just (Node x l t, bs)goUp (_, []) &#x3D; Nothing<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><hr /><p>å‚è€ƒèµ„æ–™:</p><ul><li><span class="exturl" data-url="aHR0cHM6Ly9sZWFybnlvdWFoYXNrZWxsLm1ubzIub3JnL3poLWNu">Haskellè¶£å­¦æŒ‡å—<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dpbnRlcmxhbmQxOTg5L21hZ2ljLWhhc2tlbGwv">é­”åŠ›Haskell<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3F1ZXN0aW9uLzQ1MDc3MzEzMS9hbnN3ZXIvMTgwNzMyMTExMA==">çŸ¥ä¹ -ä¸ºä»€ä¹ˆå›½å¤–å¤§å­¦è®¡ç®—æœºç³»æœ¬ç§‘ç”ŸåŸ¹å…»å¦‚æ­¤å¼ºè°ƒå‡½æ•°å¼ç¼–ç¨‹?<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
    
    
    <summary type="html">è½¬å˜æ€ç»´ğŸ¤”. ä»æ€è€ƒHow(æ€ä¹ˆç¼–å†™æŒ‡ä»¤)åˆ°æ€è€ƒWhat(æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜æ˜¯ä»€ä¹ˆ). æœ€åˆæˆ‘ä»¥ä¸ºå‡½æ•°å¼ç¼–ç¨‹å°±æ˜¯æ€è€ƒå¦‚ä½•ç”¨å‡½æ•°(æ•°å­¦)çš„æ–¹å¼æè¿°é—®é¢˜. ä½†é€æ¸å‘ç°å‡½æ•°å¼ç¼–ç¨‹çš„é‡ç‚¹æ˜¯å¦‚ä½•æ“ä½œå‡½æ•°å»æè¿°å‡½æ•°. æ€»ä¹‹, ä»–å€¼å¾—ä¸€å­¦!ğŸ˜</summary>
    
    
    
    <category term="çæŠ˜è…¾" scheme="https://blog.liukairui.me/categories/%E7%9E%8E%E6%8A%98%E8%85%BE/"/>
    
    <category term="å‡½æ•°å¼ç¼–ç¨‹" scheme="https://blog.liukairui.me/categories/%E7%9E%8E%E6%8A%98%E8%85%BE/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/"/>
    
    
    <category term="çæŠ˜è…¾" scheme="https://blog.liukairui.me/tags/%E7%9E%8E%E6%8A%98%E8%85%BE/"/>
    
    <category term="å‡½æ•°å¼ç¼–ç¨‹" scheme="https://blog.liukairui.me/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/"/>
    
    <category term="Haskell" scheme="https://blog.liukairui.me/tags/Haskell/"/>
    
  </entry>
  
</feed>
