<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="manifest" href="/images/manifest.json"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CPT+Sans:300,300italic,400,400italic,700,700italic%7CFira+Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/greem/pace-theme-minimal.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"blog.liukairui.me","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.13.1","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"width":320},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"GPJGYFJZH3","apiKey":"594eec10fca5caccffae82e82d066310","indexName":"hexo","hits":{"per_page":10}}}</script><script src="/js/config.js"></script><meta name="description" content="包含柏林噪声的原理与实现, 翻译自:Understanding Perlin Noise"><meta property="og:type" content="article"><meta property="og:title" content="理解柏林噪声"><meta property="og:url" content="https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/"><meta property="og:site_name" content="LiuKairui&#39;s Blog"><meta property="og:description" content="包含柏林噪声的原理与实现, 翻译自:Understanding Perlin Noise"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/raw1d.png"><meta property="og:image" content="https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/raw2d.png"><meta property="og:image" content="https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/raw3d.png"><meta property="og:image" content="https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/logic01.png"><meta property="og:image" content="https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/logic02.png"><meta property="og:image" content="https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/logic03.png"><meta property="og:image" content="https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/logic04.png"><meta property="og:image" content="https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/logic05.png"><meta property="og:image" content="https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/octave01.png"><meta property="og:image" content="https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/octave02.png"><meta property="article:published_time" content="2022-06-26T16:00:01.000Z"><meta property="article:modified_time" content="2022-06-26T16:00:01.000Z"><meta property="article:author" content="Liu Kairui"><meta property="article:tag" content="数学"><meta property="article:tag" content="游戏"><meta property="article:tag" content="翻译"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/raw1d.png"><link rel="canonical" href="https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/","path":"article/理解柏林噪声/","title":"理解柏林噪声"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>理解柏林噪声 | LiuKairui's Blog</title><script>var titleTime,OriginTitile=document.title;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="我们活着是为了什么? | "+OriginTitile,clearTimeout(titleTime)):(document.title="整点薯条 | "+OriginTitile,titleTime=setTimeout(function(){document.title=OriginTitile},2e3))})</script><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><link rel="alternate" href="/atom.xml" title="LiuKairui's Blog" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">LiuKairui's Blog</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">整点薯条</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-新活"><a href="/ff_monthly/" rel="section"><i class="fa fa-solid fa-newspaper fa-fw"></i>新活</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fas fa-hashtag fa-fw"></i>标签</a></li><li class="menu-item menu-item-收藏夹"><a href="/favorites/" rel="section"><i class="fab fa-gratipay fa-fw"></i>收藏夹</a></li><li class="menu-item menu-item-留言板"><a href="/messageBoard/" rel="section"><i class="fab fa-facebook-messenger fa-fw"></i>留言板</a></li><li class="menu-item menu-item-项目"><a href="/projects/" rel="section"><i class="fa fa-satellite fa-fw"></i>项目</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container"><div class="algolia-stats"><hr></div><div class="algolia-hits"></div><div class="algolia-pagination"></div></div></div></div><script async src="/js/wobblewindow.js"></script><script async>window.addEventListener("load",function(){768<window.innerWidth&&($("body>main>header").wobbleWindow({radius:50,movementTop:!1,movementLeft:!1,movementRight:!1,debug:!1}),$("body>footer").wobbleWindow({radius:50,movementBottom:!1,movementLeft:!1,movementRight:!1,debug:!1}))})</script></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8E%9F%E7%90%86"><span class="nav-text">原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="nav-text">代码实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-text">配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%8A%A8%E6%9B%B2%E7%BA%BF"><span class="nav-text">缓动曲线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hash-%E5%87%BD%E6%95%B0"><span class="nav-text">Hash 函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A2%AF%E5%BA%A6%E5%87%BD%E6%95%B0"><span class="nav-text">梯度函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86%E5%87%BD%E6%95%B0%E8%BF%9E%E8%B5%B7%E6%9D%A5"><span class="nav-text">将函数连起来</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E9%9C%87%E5%B9%85"><span class="nav-text">处理震幅</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E8%AE%BA"><span class="nav-text">结论</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="nav-text">参考文献</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0"><span class="nav-text">更新</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Liu Kairui" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">Liu Kairui</p><div class="site-description" itemprop="description">LiuKairui's Personal Website</div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">72</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">34</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">80</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author site-overview-item animated"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0thaXJ1aUxpdQ==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;KairuiLiu"><i class="fab fa-github fa-fw"></i>GitHub</span> </span><span class="links-of-author-item"><span class="exturl" data-url="bWFpbHRvOm1lQGxpdWthaXJ1aS5tZQ==" title="E-Mail → mailto:me@liukairui.me"><i class="fa fa-envelope fa-fw"></i>E-Mail</span> </span><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9xbS5xcS5jb20vY2dpLWJpbi9xbS9xcj9rPW9hZjNUb09sTjE3aHI1c0hWOThiVDhxeHNOWUdhdzVMJm5vdmVyaWZ5PTA=" title="QQ → https:&#x2F;&#x2F;qm.qq.com&#x2F;cgi-bin&#x2F;qm&#x2F;qr?k&#x3D;oaf3ToOlN17hr5sHV98bT8qxsNYGaw5L&amp;noverify&#x3D;0"><i class="fab fa-qq fa-fw"></i>QQ</span> </span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a> </span><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9saXVrYWlydWkuYmxvZy5jc2RuLm5ldA==" title="CSDN → https:&#x2F;&#x2F;liukairui.blog.csdn.net"><i class="fab fa-cuttlefish fa-fw"></i>CSDN</span></span></div><div class="cc-license site-overview-item animated" itemprop="license"><span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></span></div></div></div></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Liu Kairui"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="LiuKairui's Blog"><meta itemprop="description" content="LiuKairui's Personal Website"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="理解柏林噪声 | LiuKairui's Blog"><meta itemprop="description" content="包含柏林噪声的原理与实现, 翻译自:Understanding Perlin Noise"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">理解柏林噪声</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2022-06-27 00:00:01" itemprop="dateCreated datePublished" datetime="2022-06-27T00:00:01+08:00">2022-06-27</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%85%B6%E4%BB%96/" itemprop="url" rel="index"><span itemprop="name">其他</span></a> </span></span><span id="/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/" class="post-meta-item leancloud_visitors" data-flag-title="理解柏林噪声" title="阅读次数"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> </span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span id="busuanzi_value_page_pv"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/" itemprop="commentCount"></span> </a></span><span class="post-meta-item theme_switch_wapper hidden" id="theme_switch_wapper"><span class="post-meta-item-icon"><i class="fa-brands fa-markdown"></i></span> <span class="post-meta-item-text">主题： </span><select name="theme_switch" id="theme_switch"><option>sneh</option><option>mo</option><option>with</option><option>next</option></select> </span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>8.3k</span></span></div><div class="post-description">包含柏林噪声的原理与实现, 翻译自:Understanding Perlin Noise</div></div></header><div class="post-body" itemprop="articleBody"><blockquote><ul><li><strong>翻译自</strong>: Understanding Perlin Noise</li><li><strong>原文作者：</strong> Adrian Biagioli</li><li><strong>本文链接：</strong> http://adrianb.io/2014/08/09/perlinnoise.html</li><li><strong>版权声明：</strong> 原文采用 <span class="exturl" data-url="aHR0cHM6Ly9pLmNyZWF0aXZlY29tbW9ucy5vcmcvbC9ieS80LjAvZGVlZC56aA==">CC BY 4.0<i class="fa fa-external-link-alt"></i></span> 许可协议，本文采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo">CC BY-NC-SA 4.0<i class="fa fa-external-link-alt"></i></span> 许可协议</li></ul></blockquote><p>本文的目的是对 Ken Perlin 所著 <span class="exturl" data-url="aHR0cDovL21ybC5ueXUuZWR1L35wZXJsaW4vbm9pc2Uv">Improved Perlin Noise<i class="fa fa-external-link-alt"></i></span> 通俗易懂的解释，这篇文章的代码使用 C# 实现并可自由使用。如果你只是想看最终的结果，<span class="exturl" data-url="aHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vRmxhZmxhMi9mMDI2MGE4NjFiZTBlYmRlZWY3Ng==">你可以在这里查看最终代码<i class="fa fa-external-link-alt"></i></span>。</p><p>柏林噪声是一种在程序化内容生成领域强有力的算法。其通常应用在游戏与诸如电影的视觉媒体方向。作为该算法的发明者， Ken Perlin ，<span class="exturl" data-url="aHR0cHM6Ly9tcmwuY3Mubnl1LmVkdS9+cGVybGluL2RvYy9vc2Nhci5odG1s">因其早期的实验获得了奥斯卡金像奖<i class="fa fa-external-link-alt"></i></span>。在这篇文章中，我将探索他2022年发布的<span class="exturl" data-url="aHR0cDovL21ybC5ueXUuZWR1L35wZXJsaW4vbm9pc2Uv">改进柏林噪声（ Improved Perlin Noise ）<i class="fa fa-external-link-alt"></i></span>。在游戏开发领域，柏林噪声可用于任何类型的波状型材料或材质。它可以用于生成地形（例如类似我的世界游戏的地形），火焰的效果，水和云。这些效果通常可以用二维或者三维的柏林噪声实现，当然，也可以轻松地扩展到四维实现。另外仅一维的柏林噪声可以用于生成横向滚动的地形（如游戏：泰拉瑞亚（ Terraria ）、星界边境（Starbound））或创造手绘线条的效果。</p><p>此外，如果你将柏林噪声扩展一个维度，并将这个维度作为时间，你将可以实现效果的动画化。例如，二维柏林噪声可以用于描绘地形，但是三维的柏林噪声可以描绘海洋中的水波变化。下面是不同维度柏林噪声的图像及其实际应用</p><table><colgroup><col style="width:3%"><col style="width:23%"><col style="width:73%"></colgroup><thead><tr class="header"><th>维度</th><th>噪声灰度图</th><th>应用</th></tr></thead><tbody><tr class="odd"><td>1</td><td><img src="./理解柏林噪声/raw1d.png"></td><td><img src="./理解柏林噪声/use1d.png"><br>用于创造手绘线条效果</td></tr><tr class="even"><td>2</td><td><img src="./理解柏林噪声/raw2d.png"></td><td><img src="./理解柏林噪声/use2d.png"><br>通过应用渐变可以创造出火焰的效果</td></tr><tr class="odd"><td>3</td><td><img src="./理解柏林噪声/raw3d.png"></td><td><img src="./理解柏林噪声/use3d.png"><br>使用柏林噪声创建拥有<strong>洞穴</strong>的地形（也许是最广泛的用途)</td></tr></tbody></table><p>由此可见，柏林噪声可以用于很多自然现象的模拟，接下来让我们看看柏林噪声算法的原理</p><h2 id="原理">原理</h2><p><em>注意：很多内容来自<span class="exturl" data-url="aHR0cDovL3dlYnN0YWZmLml0bi5saXUuc2UvfnN0ZWd1L1ROTTAyMi0yMDA1L3Blcmxpbm5vaXNlbGlua3MvcGVybGluLW5vaXNlLW1hdGgtZmFxLmh0bWw=">Matt Zucker 写的这篇文章<i class="fa fa-external-link-alt"></i></span>。但是，那篇文章是基于 1980 年代初编写的原始柏林噪声算法，在这篇文章中，我将使用 2022 年发表的改进柏林噪声算法，因此我的版本与 Zucker 的版本有一些关键性的不同</em></p><p>让我们看看最基本的柏林噪声函数</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">perlin</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">double</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> y<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> z<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这个函数使用 <code>x, y, z</code> 作为输入，返回一个介于 0.0 到 1.0 之间的 <code>double</code> 类型数字。那么，我们可以对输入做些什么操作呢？首先，我们将 <code>x, y, z</code> 放入一个立方体中。换句话说就是找到 `[x, y, z] % 1. 在坐标系中的位置。下图是其在二维坐标中的表示。（蓝点表述输入坐标，周围四个点是单位坐标）</p><p><img src="./理解柏林噪声/logic01.png"></p><p>对于4个单位坐标点（在三维中有8个）中的每个节点，我们生成一个<em>伪随机梯度向量</em>，这个梯度向量定义了一个正方向与一个负方向（与正方向反向）。伪随机的意思是对于任何一组输入到梯度向量方程中的整数集合（索引）总是会得到相同的向量。因此，他只是看上去是随机的。此外，这意味着每个单位坐标都有”自己的“梯度，如果梯度函数（梯度向量方程）不变，梯度永远不会改变。</p><p><img src="./理解柏林噪声/logic02.png"></p><p>然而上图并不是准确，在 Ken Perlin 的改进噪声中，这些单位坐标上的点并不是完全随机的，每个单位点上对应的伪随机梯度向量是通过点到单位点向量决定的</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>选择这些梯度向量背后的原因见：Ken Perlin's 在 2022 发表的 SIGGRAPH 论文 <span class="exturl" data-url="aHR0cDovL21ybC5ueXUuZWR1L35wZXJsaW4vcGFwZXI0NDUucGRm">Improving Noise<i class="fa fa-external-link-alt"></i></span></p><p><em>注意：很多关于柏林噪声的文章使用了不使用这些向量的原始柏林噪声算法，例如上图就描述的原始柏林噪声算法，因为图片是在 Improving Noise 发表前制作的，但是核心思想是相同的</em></p><p>接下来，我们需要计算四个距离向量（三维下是八个），即点周围四（八）个单位点到选取点的向量，这些距离向量二维表示如图</p><p><img src="./理解柏林噪声/logic03.png"></p><p>之后，我们需要<span class="exturl" data-url="aHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Eb3RfcHJvZHVjdA==">点积<i class="fa fa-external-link-alt"></i></span>梯度向量与距离向量从而计算出单位点的权值</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">grad<span class="token punctuation">.</span>x <span class="token operator">*</span> dist<span class="token punctuation">.</span>x <span class="token operator">+</span> grad<span class="token punctuation">.</span>y <span class="token operator">*</span> dist<span class="token punctuation">.</span>y <span class="token operator">+</span> grad<span class="token punctuation">.</span>z <span class="token operator">*</span> dist<span class="token punctuation">.</span>z<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这样做的原因是两个向量的<span class="exturl" data-url="aHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Eb3RfcHJvZHVjdA==">点积<i class="fa fa-external-link-alt"></i></span>相当于是两个向量夹角余弦乘以这些向量的大小：</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token function">dot</span><span class="token punctuation">(</span>vec1<span class="token punctuation">,</span>vec2<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span><span class="token function">angle</span><span class="token punctuation">(</span>vec1<span class="token punctuation">,</span>vec2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> vec1<span class="token punctuation">.</span>length <span class="token operator">*</span> vec2<span class="token punctuation">.</span>length<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>换句话说，两个同向向量点积相当于</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token number">1</span> <span class="token operator">*</span> vec1<span class="token punctuation">.</span>length <span class="token operator">*</span> vec2<span class="token punctuation">.</span>length<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>同时，如果两个向量方向相反，他们的点积为</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> vec1<span class="token punctuation">.</span>length <span class="token operator">*</span> vec2<span class="token punctuation">.</span>length<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果两个向量是垂直的，他们的点积为0</p><p>因此，当距离向量与梯度向量同向（夹角小于<span class="math inline">\(90^\circ\)</span>），点积为正,反向，点积为负。这就梯度向量如何分正方向与负方向的，如图表示了正方向与负方向的影响</p><p><img src="./理解柏林噪声/logic04.png"></p><p>所以现在我们需要在这 4 个值之间进行插值，使得我们可以在四个单位点（三维八个）中获得权值。解决方案很简单：平均均值（双线性插值），以二维为例</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">// 四个单位点的权值定义如下:</span>
<span class="token comment">// [g1] | [g2]</span>
<span class="token comment">// -----------</span>
<span class="token comment">// [g3] | [g4]</span>
<span class="token class-name"><span class="token keyword">int</span></span> g1<span class="token punctuation">,</span> g2<span class="token punctuation">,</span> g3<span class="token punctuation">,</span> g4<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> u<span class="token punctuation">,</span> v<span class="token punctuation">;</span>   <span class="token comment">// u，v 是输入点在单位点中的坐标位置</span>
            <span class="token comment">// 例如 (u,v) = (0.5,0.5) 表示输入点在单位点围成方形中心</span>

<span class="token class-name"><span class="token keyword">int</span></span> x1 <span class="token operator">=</span> <span class="token function">lerp</span><span class="token punctuation">(</span>g1<span class="token punctuation">,</span>g2<span class="token punctuation">,</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> x2 <span class="token operator">=</span> <span class="token function">lerp</span><span class="token punctuation">(</span>g3<span class="token punctuation">,</span>h4<span class="token punctuation">,</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">int</span></span> average <span class="token operator">=</span> <span class="token function">lerp</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span>x2<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后一个问题是：使用上面的平均均值（双线性插值）的方法效果并不好，这种方法虽然计算很简单，但是看起来并不自然。我们需要一些平滑过渡。因此，我们使用了淡入淡出函数，有名缓动曲线，如图是一种缓动曲线</p><p><img src="./理解柏林噪声/logic05.png"></p><p>这个缓动曲线将应用于<code>u</code>，<code>v</code>的计算，这样的处理会使接近边缘的输入点更加接近边缘。改进柏林噪声使用了这样的缓动曲线方程 <span class="math display">\[ 6t^5-15t^4+10t^3 \]</span> 这就是柏林噪声的原理，我们现在已经理解了柏林噪声的每一部分，让我们看一些代码实现</p><h2 id="代码实现">代码实现</h2><p>代码是使用 C# 实现的，这份代码是 <span class="exturl" data-url="aHR0cDovL21ybC5ueXUuZWR1L35wZXJsaW4vbm9pc2Uv">Ken Perlin's Java Implementation<i class="fa fa-external-link-alt"></i></span> 的轻微修改版本。这份代码比原版更加清晰并添加了一些重复噪声的能力。这些代码是可以自由使用的（毕竟我没有真正的实现 - 但是 Ken Perlin 做到了）</p><h3 id="配置">配置</h3><p>第一步需要设置一个排列表，简称 <code>p[]</code> 数组。他通常是一个长度为 256 值介于 0 到 255 的数组。我们也可以重复这个数组（通常总大小为 512 ）以避免数组越界：</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> permutation <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">151</span><span class="token punctuation">,</span><span class="token number">160</span><span class="token punctuation">,</span><span class="token number">137</span><span class="token punctuation">,</span><span class="token number">91</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span>                 <span class="token comment">// Ken Perlin 实现的查找表，这是随机选取的</span>
    <span class="token number">131</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">201</span><span class="token punctuation">,</span><span class="token number">95</span><span class="token punctuation">,</span><span class="token number">96</span><span class="token punctuation">,</span><span class="token number">53</span><span class="token punctuation">,</span><span class="token number">194</span><span class="token punctuation">,</span><span class="token number">233</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">225</span><span class="token punctuation">,</span><span class="token number">140</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">,</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">69</span><span class="token punctuation">,</span><span class="token number">142</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">37</span><span class="token punctuation">,</span><span class="token number">240</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span>    <span class="token comment">// 元素值介于 0 - 255</span>
    <span class="token number">190</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token number">148</span><span class="token punctuation">,</span><span class="token number">247</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">,</span><span class="token number">234</span><span class="token punctuation">,</span><span class="token number">75</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">,</span><span class="token number">197</span><span class="token punctuation">,</span><span class="token number">62</span><span class="token punctuation">,</span><span class="token number">94</span><span class="token punctuation">,</span><span class="token number">252</span><span class="token punctuation">,</span><span class="token number">219</span><span class="token punctuation">,</span><span class="token number">203</span><span class="token punctuation">,</span><span class="token number">117</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">57</span><span class="token punctuation">,</span><span class="token number">177</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">,</span>
    <span class="token number">88</span><span class="token punctuation">,</span><span class="token number">237</span><span class="token punctuation">,</span><span class="token number">149</span><span class="token punctuation">,</span><span class="token number">56</span><span class="token punctuation">,</span><span class="token number">87</span><span class="token punctuation">,</span><span class="token number">174</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">125</span><span class="token punctuation">,</span><span class="token number">136</span><span class="token punctuation">,</span><span class="token number">171</span><span class="token punctuation">,</span><span class="token number">168</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span><span class="token number">175</span><span class="token punctuation">,</span><span class="token number">74</span><span class="token punctuation">,</span><span class="token number">165</span><span class="token punctuation">,</span><span class="token number">71</span><span class="token punctuation">,</span><span class="token number">134</span><span class="token punctuation">,</span><span class="token number">139</span><span class="token punctuation">,</span><span class="token number">48</span><span class="token punctuation">,</span><span class="token number">27</span><span class="token punctuation">,</span><span class="token number">166</span><span class="token punctuation">,</span>
    <span class="token number">77</span><span class="token punctuation">,</span><span class="token number">146</span><span class="token punctuation">,</span><span class="token number">158</span><span class="token punctuation">,</span><span class="token number">231</span><span class="token punctuation">,</span><span class="token number">83</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">229</span><span class="token punctuation">,</span><span class="token number">122</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">211</span><span class="token punctuation">,</span><span class="token number">133</span><span class="token punctuation">,</span><span class="token number">230</span><span class="token punctuation">,</span><span class="token number">220</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">92</span><span class="token punctuation">,</span><span class="token number">41</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">,</span><span class="token number">245</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">244</span><span class="token punctuation">,</span>
    <span class="token number">102</span><span class="token punctuation">,</span><span class="token number">143</span><span class="token punctuation">,</span><span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">63</span><span class="token punctuation">,</span><span class="token number">161</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">216</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">73</span><span class="token punctuation">,</span><span class="token number">209</span><span class="token punctuation">,</span><span class="token number">76</span><span class="token punctuation">,</span><span class="token number">132</span><span class="token punctuation">,</span><span class="token number">187</span><span class="token punctuation">,</span><span class="token number">208</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">169</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">196</span><span class="token punctuation">,</span>
    <span class="token number">135</span><span class="token punctuation">,</span><span class="token number">130</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">188</span><span class="token punctuation">,</span><span class="token number">159</span><span class="token punctuation">,</span><span class="token number">86</span><span class="token punctuation">,</span><span class="token number">164</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">109</span><span class="token punctuation">,</span><span class="token number">198</span><span class="token punctuation">,</span><span class="token number">173</span><span class="token punctuation">,</span><span class="token number">186</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">52</span><span class="token punctuation">,</span><span class="token number">217</span><span class="token punctuation">,</span><span class="token number">226</span><span class="token punctuation">,</span><span class="token number">250</span><span class="token punctuation">,</span><span class="token number">124</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">,</span>
    <span class="token number">5</span><span class="token punctuation">,</span><span class="token number">202</span><span class="token punctuation">,</span><span class="token number">38</span><span class="token punctuation">,</span><span class="token number">147</span><span class="token punctuation">,</span><span class="token number">118</span><span class="token punctuation">,</span><span class="token number">126</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">82</span><span class="token punctuation">,</span><span class="token number">85</span><span class="token punctuation">,</span><span class="token number">212</span><span class="token punctuation">,</span><span class="token number">207</span><span class="token punctuation">,</span><span class="token number">206</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">227</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">58</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">182</span><span class="token punctuation">,</span><span class="token number">189</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">42</span><span class="token punctuation">,</span>
    <span class="token number">223</span><span class="token punctuation">,</span><span class="token number">183</span><span class="token punctuation">,</span><span class="token number">170</span><span class="token punctuation">,</span><span class="token number">213</span><span class="token punctuation">,</span><span class="token number">119</span><span class="token punctuation">,</span><span class="token number">248</span><span class="token punctuation">,</span><span class="token number">152</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">154</span><span class="token punctuation">,</span><span class="token number">163</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span><span class="token number">221</span><span class="token punctuation">,</span><span class="token number">153</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">155</span><span class="token punctuation">,</span><span class="token number">167</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span><span class="token number">172</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span>
    <span class="token number">129</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">39</span><span class="token punctuation">,</span><span class="token number">253</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span><span class="token number">98</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token number">79</span><span class="token punctuation">,</span><span class="token number">113</span><span class="token punctuation">,</span><span class="token number">224</span><span class="token punctuation">,</span><span class="token number">232</span><span class="token punctuation">,</span><span class="token number">178</span><span class="token punctuation">,</span><span class="token number">185</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token number">218</span><span class="token punctuation">,</span><span class="token number">246</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">228</span><span class="token punctuation">,</span>
    <span class="token number">251</span><span class="token punctuation">,</span><span class="token number">34</span><span class="token punctuation">,</span><span class="token number">242</span><span class="token punctuation">,</span><span class="token number">193</span><span class="token punctuation">,</span><span class="token number">238</span><span class="token punctuation">,</span><span class="token number">210</span><span class="token punctuation">,</span><span class="token number">144</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">191</span><span class="token punctuation">,</span><span class="token number">179</span><span class="token punctuation">,</span><span class="token number">162</span><span class="token punctuation">,</span><span class="token number">241</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span><span class="token number">51</span><span class="token punctuation">,</span><span class="token number">145</span><span class="token punctuation">,</span><span class="token number">235</span><span class="token punctuation">,</span><span class="token number">249</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">239</span><span class="token punctuation">,</span><span class="token number">107</span><span class="token punctuation">,</span>
    <span class="token number">49</span><span class="token punctuation">,</span><span class="token number">192</span><span class="token punctuation">,</span><span class="token number">214</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span><span class="token number">181</span><span class="token punctuation">,</span><span class="token number">199</span><span class="token punctuation">,</span><span class="token number">106</span><span class="token punctuation">,</span><span class="token number">157</span><span class="token punctuation">,</span><span class="token number">184</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span><span class="token number">204</span><span class="token punctuation">,</span><span class="token number">176</span><span class="token punctuation">,</span><span class="token number">115</span><span class="token punctuation">,</span><span class="token number">121</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">150</span><span class="token punctuation">,</span><span class="token number">254</span><span class="token punctuation">,</span>
    <span class="token number">138</span><span class="token punctuation">,</span><span class="token number">236</span><span class="token punctuation">,</span><span class="token number">205</span><span class="token punctuation">,</span><span class="token number">93</span><span class="token punctuation">,</span><span class="token number">222</span><span class="token punctuation">,</span><span class="token number">114</span><span class="token punctuation">,</span><span class="token number">67</span><span class="token punctuation">,</span><span class="token number">29</span><span class="token punctuation">,</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token number">72</span><span class="token punctuation">,</span><span class="token number">243</span><span class="token punctuation">,</span><span class="token number">141</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token number">195</span><span class="token punctuation">,</span><span class="token number">78</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">215</span><span class="token punctuation">,</span><span class="token number">61</span><span class="token punctuation">,</span><span class="token number">156</span><span class="token punctuation">,</span><span class="token number">180</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> p<span class="token punctuation">;</span>                                <span class="token comment">// 重复一个排列表避免下标越界</span>

<span class="token keyword">static</span> <span class="token function">Perlin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span></span><span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>x<span class="token operator">&lt;</span><span class="token number">512</span><span class="token punctuation">;</span>x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> permutation<span class="token punctuation">[</span>x<span class="token operator">%</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>p[]</code> 排列表将用于 hash 函数，该函数将决定之后使用哪个梯度向量，我们将在后面详细描述函数实现细节</p><p>接下来是噪声函数</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">perlin</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">double</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> y<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> z<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>repeat <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                    <span class="token comment">// 如果开启了重复，就求余获得防止越界</span>
        x <span class="token operator">=</span> x<span class="token operator">%</span>repeat<span class="token punctuation">;</span>
        y <span class="token operator">=</span> y<span class="token operator">%</span>repeat<span class="token punctuation">;</span>
        z <span class="token operator">=</span> z<span class="token operator">%</span>repeat<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token class-name"><span class="token keyword">int</span></span> xi <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>x <span class="token operator">&amp;</span> <span class="token number">255</span><span class="token punctuation">;</span>                              <span class="token comment">// 计算单位点位置</span>
    <span class="token class-name"><span class="token keyword">int</span></span> yi <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>y <span class="token operator">&amp;</span> <span class="token number">255</span><span class="token punctuation">;</span>                              <span class="token comment">// 左下角是( |_x_|,|_y_|,|_z_| )</span>
    <span class="token class-name"><span class="token keyword">int</span></span> zi <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>z <span class="token operator">&amp;</span> <span class="token number">255</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">double</span></span> xf <span class="token operator">=</span> x<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>x<span class="token punctuation">;</span>                               <span class="token comment">// 计算点在单位点在中的局部位置</span>
    <span class="token class-name"><span class="token keyword">double</span></span> yf <span class="token operator">=</span> y<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>y<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">double</span></span> zf <span class="token operator">=</span> z<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>z<span class="token punctuation">;</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这份代码很容易理解，首先如果代码使用了重复排列表方法，使用求余运算计算下标以避免越界。接下来创建变量 <code>xi, yi, zi</code>，其代表了输入点对应单位点及其所在立方体。我们也可以将坐标归一化到 <span class="math inline">\([0,255]\)</span> 这可以避免在访问 <code>p[]</code> 时下标越界。但是这也会造成副作用：柏林噪声结果会每 256 重复一次。但这并不是一个问题，因为我们可以用是十进制坐标实现柏林噪声。最后最后我们要找到点在单位立方体中的位置，也就是 <span class="math inline">\(n = n \% 1.0\)</span> ，其中 <span class="math inline">\(n\)</span> 是一个坐标。</p><h3 id="缓动曲线">缓动曲线</h3><p>现在我们需要定义上图中的缓动曲线，正如上面提到的，缓动曲线方程是 <span class="math display">\[ 6t^5-15t^4+10t^3 \]</span> 代码实现为</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">fade</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">double</span></span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>           <span class="token comment">// Ken Perlin 定义的函数. 这缓动了坐标值，</span>
                                                <span class="token comment">// 让坐标值趋向边界</span>
    <span class="token keyword">return</span> t <span class="token operator">*</span> t <span class="token operator">*</span> t <span class="token operator">*</span> <span class="token punctuation">(</span>t <span class="token operator">*</span> <span class="token punctuation">(</span>t <span class="token operator">*</span> <span class="token number">6</span> <span class="token operator">-</span> <span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6t^5 - 15t^4 + 10t^3</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">perlin</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">double</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> y<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> z<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>

    <span class="token class-name"><span class="token keyword">double</span></span> u <span class="token operator">=</span> <span class="token function">fade</span><span class="token punctuation">(</span>xf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">double</span></span> v <span class="token operator">=</span> <span class="token function">fade</span><span class="token punctuation">(</span>yf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">double</span></span> w <span class="token operator">=</span> <span class="token function">fade</span><span class="token punctuation">(</span>zf<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中 <code>u / v / w</code> 将在之后插值时使用</p><h3 id="hash-函数">Hash 函数</h3><p>柏林噪声的 hash 函数输入一组坐标并返回一个独一无二的值， hash 函数的维基百科定义如下</p><blockquote><p>一种函数可以将任意范围的数据映射到固定范围，输入数据微小的差异会导致结果巨大的差异</p></blockquote><p>如下是柏林噪声中的 hash 函数，它使用了我们之前创建的排列表 <code>p[]</code></p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">perlin</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">double</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> y<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> z<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>

    <span class="token class-name"><span class="token keyword">int</span></span> aaa<span class="token punctuation">,</span> aba<span class="token punctuation">,</span> aab<span class="token punctuation">,</span> abb<span class="token punctuation">,</span> baa<span class="token punctuation">,</span> bba<span class="token punctuation">,</span> bab<span class="token punctuation">,</span> bbb<span class="token punctuation">;</span>
    aaa <span class="token operator">=</span> p<span class="token punctuation">[</span>p<span class="token punctuation">[</span>p<span class="token punctuation">[</span>    xi <span class="token punctuation">]</span><span class="token operator">+</span>    yi <span class="token punctuation">]</span><span class="token operator">+</span>    zi <span class="token punctuation">]</span><span class="token punctuation">;</span>
    aba <span class="token operator">=</span> p<span class="token punctuation">[</span>p<span class="token punctuation">[</span>p<span class="token punctuation">[</span>    xi <span class="token punctuation">]</span><span class="token operator">+</span><span class="token function">inc</span><span class="token punctuation">(</span>yi<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">+</span>    zi <span class="token punctuation">]</span><span class="token punctuation">;</span>
    aab <span class="token operator">=</span> p<span class="token punctuation">[</span>p<span class="token punctuation">[</span>p<span class="token punctuation">[</span>    xi <span class="token punctuation">]</span><span class="token operator">+</span>    yi <span class="token punctuation">]</span><span class="token operator">+</span><span class="token function">inc</span><span class="token punctuation">(</span>zi<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    abb <span class="token operator">=</span> p<span class="token punctuation">[</span>p<span class="token punctuation">[</span>p<span class="token punctuation">[</span>    xi <span class="token punctuation">]</span><span class="token operator">+</span><span class="token function">inc</span><span class="token punctuation">(</span>yi<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token function">inc</span><span class="token punctuation">(</span>zi<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    baa <span class="token operator">=</span> p<span class="token punctuation">[</span>p<span class="token punctuation">[</span>p<span class="token punctuation">[</span><span class="token function">inc</span><span class="token punctuation">(</span>xi<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">+</span>    yi <span class="token punctuation">]</span><span class="token operator">+</span>    zi <span class="token punctuation">]</span><span class="token punctuation">;</span>
    bba <span class="token operator">=</span> p<span class="token punctuation">[</span>p<span class="token punctuation">[</span>p<span class="token punctuation">[</span><span class="token function">inc</span><span class="token punctuation">(</span>xi<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token function">inc</span><span class="token punctuation">(</span>yi<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">+</span>    zi <span class="token punctuation">]</span><span class="token punctuation">;</span>
    bab <span class="token operator">=</span> p<span class="token punctuation">[</span>p<span class="token punctuation">[</span>p<span class="token punctuation">[</span><span class="token function">inc</span><span class="token punctuation">(</span>xi<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">+</span>    yi <span class="token punctuation">]</span><span class="token operator">+</span><span class="token function">inc</span><span class="token punctuation">(</span>zi<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    bbb <span class="token operator">=</span> p<span class="token punctuation">[</span>p<span class="token punctuation">[</span>p<span class="token punctuation">[</span><span class="token function">inc</span><span class="token punctuation">(</span>xi<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token function">inc</span><span class="token punctuation">(</span>yi<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token function">inc</span><span class="token punctuation">(</span>zi<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">inc</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> num<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    num<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>repeat <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> num <span class="token operator">%=</span> repeat<span class="token punctuation">;</span>

    <span class="token keyword">return</span> num<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用上面的 hash 函数哈希输入点周围的八个单位点，<code>inc()</code> 函数用于获取坐标值的后继并保证不会越界。如果你没有设置 <code>repeat</code> ，那么 <code>inc(xi) = xi + 1</code>。由于我们使用了 <code>p[]</code> 数组，结果将介于 0 - 255</p><h3 id="梯度函数">梯度函数</h3><p>我一直认为 Ken Perlin 原始的梯度函数 <code>grad()</code> 是杂乱且不必要的。记住， <code>grad()</code> 的目标是计算随机选取的伪梯度向量与八个距离向量的点积。Ken Perlin 使用了一些花哨的位运算方法实现了这个函数</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">grad</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> hash<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> y<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> z<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name"><span class="token keyword">int</span></span> h <span class="token operator">=</span> hash <span class="token operator">&amp;</span> <span class="token number">15</span><span class="token punctuation">;</span>                                    <span class="token comment">// 取 hash 的后四位</span>
    <span class="token class-name"><span class="token keyword">double</span></span> u <span class="token operator">=</span> h <span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token comment">/* 0b1000 */</span> <span class="token punctuation">?</span> x <span class="token punctuation">:</span> y<span class="token punctuation">;</span>                <span class="token comment">// 如果最高为为0就设置 u = x，否则y</span>
    <span class="token class-name"><span class="token keyword">double</span></span> v<span class="token punctuation">;</span>                                             <span class="token comment">// 原版中是用的?:运算</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>h <span class="token operator">&lt;</span> <span class="token number">4</span> <span class="token comment">/* 0b0100 */</span><span class="token punctuation">)</span>                                <span class="token comment">// 判断第二位为0</span>
        v <span class="token operator">=</span> y<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>h <span class="token operator">==</span> <span class="token number">12</span> <span class="token comment">/* 0b1100 */</span> <span class="token operator">||</span> h <span class="token operator">==</span> <span class="token number">14</span> <span class="token comment">/* 0b1110*/</span><span class="token punctuation">)</span>  <span class="token comment">// 判断最高位与第二位为1</span>
        v <span class="token operator">=</span> x<span class="token punctuation">;</span>
    <span class="token keyword">else</span>                                                  <span class="token comment">// 判断一二位不同</span>
        v <span class="token operator">=</span> z<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>h<span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">?</span> u <span class="token punctuation">:</span> <span class="token operator">-</span>u<span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">(</span>h<span class="token operator">&amp;</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">?</span> v <span class="token punctuation">:</span> <span class="token operator">-</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 判断后两位</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>下面的代码是上面代码的另一种实现，这种方法更加易懂（在部分语言中更快）</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">// 来源: http://riven8192.blogspot.com/2010/08/calculate-perlinnoise-twice-as-fast.html</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">grad</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> hash<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> y<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> z<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>hash <span class="token operator">&amp;</span> <span class="token number">0xF</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token number">0x0</span><span class="token punctuation">:</span> <span class="token keyword">return</span>  x <span class="token operator">+</span> y<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">0x1</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token operator">-</span>x <span class="token operator">+</span> y<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">0x2</span><span class="token punctuation">:</span> <span class="token keyword">return</span>  x <span class="token operator">-</span> y<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">0x3</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token operator">-</span>x <span class="token operator">-</span> y<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">0x4</span><span class="token punctuation">:</span> <span class="token keyword">return</span>  x <span class="token operator">+</span> z<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">0x5</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token operator">-</span>x <span class="token operator">+</span> z<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">0x6</span><span class="token punctuation">:</span> <span class="token keyword">return</span>  x <span class="token operator">-</span> z<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">0x7</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token operator">-</span>x <span class="token operator">-</span> z<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">0x8</span><span class="token punctuation">:</span> <span class="token keyword">return</span>  y <span class="token operator">+</span> z<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">0x9</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token operator">-</span>y <span class="token operator">+</span> z<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">0xA</span><span class="token punctuation">:</span> <span class="token keyword">return</span>  y <span class="token operator">-</span> z<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">0xB</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token operator">-</span>y <span class="token operator">-</span> z<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">0xC</span><span class="token punctuation">:</span> <span class="token keyword">return</span>  y <span class="token operator">+</span> x<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">0xD</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token operator">-</span>y <span class="token operator">+</span> z<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">0xE</span><span class="token punctuation">:</span> <span class="token keyword">return</span>  y <span class="token operator">-</span> x<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">0xF</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token operator">-</span>y <span class="token operator">-</span> z<span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 永不到达</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面的代码可以在<span class="exturl" data-url="aHR0cDovL3JpdmVuODE5Mi5ibG9nc3BvdC5jb20vMjAxMC8wOC9jYWxjdWxhdGUtcGVybGlubm9pc2UtdHdpY2UtYXMtZmFzdC5odG1s">这里<i class="fa fa-external-link-alt"></i></span>找到，这两种代码结果完全相同，他们随机从下面几个向量中选取结果</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>选取结果由 hash 函数结果后四位决定（通过 <code>grad()</code> 的第一个参数输入）另外三个参数用来表述距离向量（他们将用于计算点积）</p><h3 id="将函数连起来">将函数连起来</h3><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">perlin</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">double</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> y<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> z<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>

    <span class="token class-name"><span class="token keyword">double</span></span> x1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> y2<span class="token punctuation">;</span>
    x1 <span class="token operator">=</span> <span class="token function">lerp</span><span class="token punctuation">(</span>    grad <span class="token punctuation">(</span>aaa<span class="token punctuation">,</span> xf  <span class="token punctuation">,</span> yf  <span class="token punctuation">,</span> zf<span class="token punctuation">)</span><span class="token punctuation">,</span>           <span class="token comment">// grad 函数计算点积</span>
                grad <span class="token punctuation">(</span>baa<span class="token punctuation">,</span> xf<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> yf  <span class="token punctuation">,</span> zf<span class="token punctuation">)</span><span class="token punctuation">,</span>             <span class="token comment">// 梯度向量与输入周围单位点</span>
                u<span class="token punctuation">)</span><span class="token punctuation">;</span>
    x2 <span class="token operator">=</span> <span class="token function">lerp</span><span class="token punctuation">(</span>    grad <span class="token punctuation">(</span>aba<span class="token punctuation">,</span> xf  <span class="token punctuation">,</span> yf<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> zf<span class="token punctuation">)</span><span class="token punctuation">,</span>           <span class="token comment">// 将这些点做线性插值</span>
                grad <span class="token punctuation">(</span>bba<span class="token punctuation">,</span> xf<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> yf<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> zf<span class="token punctuation">)</span><span class="token punctuation">,</span>
                  u<span class="token punctuation">)</span><span class="token punctuation">;</span>
    y1 <span class="token operator">=</span> <span class="token function">lerp</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>

    x1 <span class="token operator">=</span> <span class="token function">lerp</span><span class="token punctuation">(</span>    grad <span class="token punctuation">(</span>aab<span class="token punctuation">,</span> xf  <span class="token punctuation">,</span> yf  <span class="token punctuation">,</span> zf<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                grad <span class="token punctuation">(</span>bab<span class="token punctuation">,</span> xf<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> yf  <span class="token punctuation">,</span> zf<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                u<span class="token punctuation">)</span><span class="token punctuation">;</span>
    x2 <span class="token operator">=</span> <span class="token function">lerp</span><span class="token punctuation">(</span>    grad <span class="token punctuation">(</span>abb<span class="token punctuation">,</span> xf  <span class="token punctuation">,</span> yf<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> zf<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  grad <span class="token punctuation">(</span>bbb<span class="token punctuation">,</span> xf<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> yf<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> zf<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  u<span class="token punctuation">)</span><span class="token punctuation">;</span>
    y2 <span class="token operator">=</span> lerp <span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>lerp <span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>                      <span class="token comment">// 将插值结果从 [0, 1] 转为 [-1, 1]</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 线性插值</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">lerp</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">double</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> b<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> x <span class="token operator">*</span> <span class="token punctuation">(</span>b <span class="token operator">-</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="处理震幅">处理震幅</h2><p>我们要讨论的最后一件事是如何处理柏林噪声让他看起来开更加自然。虽然柏林噪声一定程度上模拟了自然现象，但是他不能完全描述自然界中人们期望的所有行为。例如，一个地形可以像山一样大而宽广，也可以像小山，盆地一样小，还可以像巨石一样小，甚至像鹅卵石一样小。（获得不同尺度震幅）方法很简单：可以生成各种各样的不同震幅与频率的柏林噪声并将他们叠加在一起。当然，频率是采样的周期，震幅是变化的范围。</p><p><img src="./理解柏林噪声/octave01.png"></p><p>把上图叠加在一起就得到</p><p><img src="./理解柏林噪声/octave02.png"></p><p>显然这个结果很有说服力。上面六组噪声成为不同振幅的噪声。每个振幅的值对结果影响很小。当然每一个振幅生成都需要线性时间复杂度，因此在运行的时候不要用太多组振幅函数（例如在生成 60FPS 的火焰效果时）。然而，多组震幅在预处理数据（例如在生成地形时）很有效。</p><p>但是多震幅噪声会在多大程度上影响效率呢？这个问题可以用另一个叫做<strong>持久性</strong>的变量度量。<span class="exturl" data-url="aHR0cDovL2ZyZWVzcGFjZS52aXJnaW4ubmV0L2h1Z28uZWxpYXMvbW9kZWxzL21fcGVybGluLmh0bQ==">Hugo Elias<i class="fa fa-external-link-alt"></i></span> 是这样定义持久性的：</p><blockquote><p><span class="math inline">\(频率 = 2^i\)</span> <span class="math inline">\(震幅 = 持久性^i\)</span></p></blockquote><p><span class="math inline">\(i\)</span> 就是我们定义的震幅</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">OctavePerlin</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">double</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> y<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> z<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> octaves<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> persistence<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name"><span class="token keyword">double</span></span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">double</span></span> frequency <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">double</span></span> amplitude <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">double</span></span> maxValue <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 通常范围在 0.0 - 1.0</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>octaves<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        total <span class="token operator">+=</span> <span class="token function">perlin</span><span class="token punctuation">(</span>x <span class="token operator">*</span> frequency<span class="token punctuation">,</span> y <span class="token operator">*</span> frequency<span class="token punctuation">,</span> z <span class="token operator">*</span> frequency<span class="token punctuation">)</span> <span class="token operator">*</span> amplitude<span class="token punctuation">;</span>

        maxValue <span class="token operator">+=</span> amplitude<span class="token punctuation">;</span>

        amplitude <span class="token operator">*=</span> persistence<span class="token punctuation">;</span>
        frequency <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> total<span class="token operator">/</span>maxValue<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="结论">结论</h2><p>就是这样，我们已经知道如何生成噪声了。此外，你可以在这里找到所有源码。如果你有任何问题，请在<span class="exturl" data-url="aHR0cHM6Ly9hZHJpYW5iLmlvLzIwMTQvMDgvMDkvcGVybGlubm9pc2UjZGlzcXVzX3RocmVhZA==">下面评论区<i class="fa fa-external-link-alt"></i></span>评论。</p><h3 id="参考文献">参考文献</h3><p>这是一些参考资料，如果您有兴趣，可以查看：</p><ul><li><span class="exturl" data-url="aHR0cDovL21ybC5ueXUuZWR1L35wZXJsaW4vbm9pc2Uv">Ken Perlin 的“官方”改进柏林噪声<i class="fa fa-external-link-alt"></i></span> - 这是 Ken Perlin 写的原始算法.</li><li><span class="exturl" data-url="aHR0cDovL3dlYnN0YWZmLml0bi5saXUuc2UvfnN0ZWd1L1ROTTAyMi0yMDA1L3Blcmxpbm5vaXNlbGlua3MvcGVybGluLW5vaXNlLW1hdGgtZmFxLmh0bWw=">”柏林噪声常见数学问题解答“<i class="fa fa-external-link-alt"></i></span> - 这是关于该算法非常棒的参考。然而，记住他使用的 1980 年代的<em>原始的</em>柏林噪声算法，并不是本文讨论的。</li><li><span class="exturl" data-url="aHR0cDovL2ZyZWVzcGFjZS52aXJnaW4ubmV0L2h1Z28uZWxpYXMvbW9kZWxzL21fcGVybGluLmh0bQ==">Hugo Elias 的论文<i class="fa fa-external-link-alt"></i></span> - 最受欢迎的柏林噪声文章之一。这是一个关于震幅与实际应用最好的参考. 然而<strong>这不是真正的柏林噪声</strong>! Hugo 的算法并<em>不是</em>基于柏林噪声梯度的。相反，它使用的是<em>值噪声</em>，本质上是模糊的白噪声。 不要混淆两者！</li><li><span class="exturl" data-url="aHR0cDovL2Rldm1hZy5vcmcuemEvMjAwOS8wNC8yNS9wZXJsaW4tbm9pc2Uv">"如何在你的游戏中使用柏林噪声" - Devmag<i class="fa fa-external-link-alt"></i></span> - 一篇非常棒的关于柏林噪声的潜在使用的文章。这是非常棒的读物，但是<strong>再次注意，这不是真正的柏林噪声！</strong> Devmag 使用的是值噪声。</li><li><span class="exturl" data-url="aHR0cDovL2h0dHAuZGV2ZWxvcGVyLm52aWRpYS5jb20vR1BVR2VtczIvZ3B1Z2VtczJfY2hhcHRlcjI2Lmh0bWw=">GPU Gems - "改进柏林噪声实践"<i class="fa fa-external-link-alt"></i></span> - 本文利用 GPU 的强大功能，使用柏林噪声<em>实时</em>渲染令人惊叹的海洋。着色器很酷！</li></ul><p>感谢你的阅读！</p><h3 id="更新">更新</h3><p>8/9/14 - 我更新了更多关于点积的表示, 并且我更新了一些错别字. 非常感谢诶 Reddit 给我提供的建议 <span class="exturl" data-url="aHR0cDovL3d3dy5yZWRkaXQuY29tL3IvcHJvZ3JhbW1pbmcvY29tbWVudHMvMmQyOHA2L3VuZGVyc3RhbmRpbmdfcGVybGluX25vaXNlX2FuX2luZGVwdGhfbG9va19hdF90aGUv">/r/programming<i class="fa fa-external-link-alt"></i></span>, <span class="exturl" data-url="aHR0cDovL3d3dy5yZWRkaXQuY29tL3IvZ2FtZWRldi9jb21tZW50cy8yZDI4NG4vdW5kZXJzdGFuZGluZ19wZXJsaW5fbm9pc2VfYW5faW5kZXB0aF9sb29rX2F0X3RoZS8=">/r/gamedev<i class="fa fa-external-link-alt"></i></span>, 与 <span class="exturl" data-url="aHR0cDovL3d3dy5yZWRkaXQuY29tL3IvVW5pdHkzRC9jb21tZW50cy8yZDI5amovdW5kZXJzdGFuZGluZ19wZXJsaW5fbm9pc2VfYW5faW5kZXB0aF9sb29rX2F0X3RoZS8=">/r/Unity3D<i class="fa fa-external-link-alt"></i></span>.</p></div><footer class="post-footer"><p class="post-end-coffee">-------- 本文结束 <i class="fa-solid fa-mug-hot"></i> 感谢阅读 --------</p><script>let post_body = document.querySelector('.post-body');
  let theme_switch = document.getElementById('theme_switch');
  const theme = {};
  Object.defineProperty(theme, 'value', {
    set(v){
      post_body.setAttribute('theme', v);
      localStorage.setItem('md_theme', v);
      theme_switch.value = v;
    }
  })
  theme.value = localStorage.getItem('md_theme') || 'sneh';
  theme_switch.addEventListener('change',e=>theme.value = e.target.value)
  document.getElementById('theme_switch_wapper').classList.remove('hidden');</script><div class="reward-container"><div></div><button>赞赏</button><div class="post-reward"><div><img src="/images/wechatpay.png" alt="Liu Kairui 微信"> <span>微信</span></div><div><img src="/images/alipay.png" alt="Liu Kairui 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"><strong>本文作者： </strong>Liu Kairui</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/" title="理解柏林噪声">https://blog.liukairui.me/article/理解柏林噪声/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div><div class="post-tags"><a href="/tags/%E6%95%B0%E5%AD%A6/" rel="tag"><i class="fa fa-tag"></i> 数学</a> <a href="/tags/%E6%B8%B8%E6%88%8F/" rel="tag"><i class="fa fa-tag"></i> 游戏</a> <a href="/tags/%E7%BF%BB%E8%AF%91/" rel="tag"><i class="fa fa-tag"></i> 翻译</a></div><div class="post-nav"><div class="post-nav-item"><a href="/article/%E7%90%86%E8%A7%A3%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/" rel="prev" title="理解傅里叶变换"><i class="fa fa-chevron-left"></i> 理解傅里叶变换</a></div><div class="post-nav-item"><a href="/article/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84JavaScript%E5%AD%A6%E4%B9%A0/" rel="next" title="《你不知道的JavaScript》学习">《你不知道的JavaScript》学习 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Liu Kairui</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span>总字数：</span> <span title="总字数">1.8m</span></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="powered-by">由 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9taXN0Lw==">NexT.Mist</span> 强力驱动</div><div class="addthis_inline_share_toolbox"><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-630c5bd30a606ba8" async></script></div><div id="time_and_count"></div><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/moment.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment-precise-range-plugin@1.3.0/moment-precise-range.min.js"></script><script>function timer() {
    var ages = moment.preciseDiff(moment(),moment(20201101,"YYYYMMDD"));
    ages = ages.replace(/years?/, "年");
    ages = ages.replace(/months?/, "月");
    ages = ages.replace(/days?/, "天");
    ages = ages.replace(/hours?/, "小时");
    ages = ages.replace(/minutes?/, "分");
    ages = ages.replace(/seconds?/, "秒");
    ages = ages.replace(/\d+/g, '<span class="daysCnt" style="color: #1890ff">$&</span>');
    div.innerHTML = `小站已悄悄运行了 ${ages}`;
    div.className="workDays";
  }
  let div = document.createElement("div");
  let time_and_count = document.getElementById("time_and_count");
  time_and_count.appendChild(div);
  timer();
  setInterval("timer()",1000)</script><script>let footer = document.querySelector('.footer-inner')

let wordCount = document.querySelector('.wordcount')
wordCount.innerHTML = wordCount.innerText.replace('：',': ').replace('m','M')
if(wordCount){
  time_and_count.appendChild(wordCount);
}

let busaunzi = document.querySelector('.busuanzi-count')
if(busaunzi){
  footer.appendChild(busaunzi);
}

let powerby = document.querySelector('.powered-by')
if(powerby){
  footer.appendChild(powerby);
}</script></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/algoliasearch/4.14.2/algoliasearch-lite.umd.js" integrity="sha256-dImjLPUsG/6p3+i7gVKBiDM8EemJAhQ0VvkRK2pVsQY=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/instantsearch.js/4.46.3/instantsearch.production.min.js" integrity="sha256-TDBtvQ4sIGgJS5bk8VOKto+yvrblCB/JxE/9odR5u+M=" crossorigin="anonymous"></script><script src="/js/third-party/search/algolia-search.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.8/pdfobject.min.js","integrity":"sha256-tu9j5pBilBQrWSDePOOajCUdz6hWsid/lBNzK4KgEPM="},"url":"/lib/pdf/web/viewer"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":"forest","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.1.7/mermaid.min.js","integrity":"sha256-G58AID1YoX5YaEtWfXSI0VLrZ6N4kvNvwg0BI8zUFxE="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/fancybox.js"></script><script src="/js/third-party/pace.js"></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"ABKlVtS4cyaWYEwunPyK3sXt-9Nh9j0Va","app_key":"xxGXdTTEGEVifs2TLB35844I","server_url":"https://abklvts4.lc-cn-e1-shared.com","security":false}</script><script src="/js/third-party/statistics/lean-analytics.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/js/third-party/math/mathjax.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script><script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":false,"archive":false,"delay":true,"timeout":3000,"priority":true,"url":"https://blog.liukairui.me/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/"}</script><script src="/js/third-party/quicklink.js"></script><script src="https://unpkg.com/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script><script>var options = {
  bottom: '71px',
  right: 'unset',
  left: '30px',
  time: '0s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#222',
  buttonColorLight: '#222',
  saveInCookies: true,
  label: '',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();</script><script>NexT.utils.loadComments('#valine-comments', () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    new Valine(Object.assign({"enable":true,"appId":"ABKlVtS4cyaWYEwunPyK3sXt-9Nh9j0Va","appKey":"xxGXdTTEGEVifs2TLB35844I","serverURLs":"https://abklvts4.lc-cn-e1-shared.com","placeholder":"请开始你的表演","avatar":"identicon","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-CN","visitor":false,"comment_count":true,"recordIP":true,"enableQQ":true,"requiredFields":[]}, {
      el: '#valine-comments',
      path: "/article/%E7%90%86%E8%A7%A3%E6%9F%8F%E6%9E%97%E5%99%AA%E5%A3%B0/",
      serverURLs: "https://abklvts4.lc-cn-e1-shared.com"
    }));
  }, window.Valine);
});</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,log:!1,model:{jsonPath:"/live2dw/assets/hijiki.model.json"},display:{position:"right",width:150,height:300},mobile:{show:!1},react:{opacity:.7}})</script></body></html>